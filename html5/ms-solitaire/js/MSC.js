// @preserve © 2020 Microsoft. All rights reserved.
var requirejs,require,define;!function(global){function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t){var i;for(i=0;i<t.length&&(!t[i]||!e(t[i],i,t));i+=1);}}function eachReverse(t,e){if(t){var i;for(i=t.length-1;i>-1&&(!t[i]||!e(t[i],i,t));i-=1);}}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var i;for(i in t)if(hasProp(t,i)&&e(t[i],i))break}function mixin(t,e,i,n){return e&&eachProp(e,function(e,r){!i&&hasProp(t,r)||(!n||"object"!=typeof e||!e||isArray(e)||isFunction(e)||e instanceof RegExp?t[r]=e:(t[r]||(t[r]={}),mixin(t[r],e,i,n)))}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,i,n){var r=new Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t);return r.requireType=t,r.requireModules=n,i&&(r.originalError=i),r}function newContext(t){function e(t){var e,i;for(e=0;e<t.length;e++)if("."===(i=t[e]))t.splice(e,1),e-=1;else if(".."===i){if(0===e||1===e&&".."===t[2]||".."===t[e-1])continue;e>0&&(t.splice(e-1,2),e-=2)}}function i(t,i,n){var r,o,a,s,l,h,u,d,c,p,g,f=i&&i.split("/"),y=x.map,m=y&&y["*"];if(t&&(t=t.split("/"),h=t.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(t[h])&&(t[h]=t[h].replace(jsSuffixRegExp,"")),"."===t[0].charAt(0)&&f&&(g=f.slice(0,f.length-1),t=g.concat(t)),e(t),t=t.join("/")),n&&y&&(f||m)){o=t.split("/");t:for(a=o.length;a>0;a-=1){if(l=o.slice(0,a).join("/"),f)for(s=f.length;s>0;s-=1)if((r=getOwn(y,f.slice(0,s).join("/")))&&(r=getOwn(r,l))){u=r,d=a;break t}!c&&m&&getOwn(m,l)&&(c=getOwn(m,l),p=a)}!u&&c&&(u=c,d=p),u&&(o.splice(0,d,u),t=o.join("/"))}return getOwn(x.pkgs,t)||t}function n(t){isBrowser&&each(scripts(),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===b.contextName)return e.parentNode.removeChild(e),!0})}function r(t){var e=getOwn(x.paths,t);if(e&&isArray(e)&&e.length>1)return e.shift(),b.require.undef(t),b.makeRequire(null,{skipMap:!0})([t]),!0}function o(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function a(t,e,n,r){var a,s,l,h,u=null,d=e?e.name:null,c=t,p=!0,g="";return t||(p=!1,t="_@r"+(F+=1)),h=o(t),u=h[0],t=h[1],u&&(u=i(u,d,r),s=getOwn(A,u)),t&&(u?g=s&&s.normalize?s.normalize(t,function(t){return i(t,d,r)}):-1===t.indexOf("!")?i(t,d,r):t:(g=i(t,d,r),h=o(g),u=h[0],g=h[1],n=!0,a=b.nameToUrl(g))),l=!u||s||n?"":"_unnormalized"+(E+=1),{prefix:u,name:g,parentMap:e,unnormalized:!!l,url:a,originalName:c,isDefine:p,id:(u?u+"!"+g:g)+l}}function s(t){var e=t.id,i=getOwn(T,e);return i||(i=T[e]=new b.Module(t)),i}function l(t,e,i){var n=t.id,r=getOwn(T,n);!hasProp(A,n)||r&&!r.defineEmitComplete?(r=s(t),r.error&&"error"===e?i(r.error):r.on(e,i)):"defined"===e&&i(A[n])}function h(t,e){var i=t.requireModules,n=!1;e?e(t):(each(i,function(e){var i=getOwn(T,e);i&&(i.error=t,i.events.error&&(n=!0,i.emit("error",t)))}),n||req.onError(t))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(t){var e=t[0];"string"==typeof e&&(b.defQueueMap[e]=!0),P.push(t)}),globalDefQueue=[])}function d(t){delete T[t],delete M[t]}function c(t,e,i){var n=t.map.id;t.error?t.emit("error",t.error):(e[n]=!0,each(t.depMaps,function(n,r){var o=n.id,a=getOwn(T,o);!a||t.depMatched[r]||i[o]||(getOwn(e,o)?(t.defineDep(r,A[o]),t.check()):c(a,e,i))}),i[n]=!0)}function p(){var t,e,i=1e3*x.waitSeconds,o=i&&b.startTime+i<(new Date).getTime(),a=[],s=[],l=!1,u=!0;if(!C){if(C=!0,eachProp(M,function(t){var i=t.map,h=i.id;if(t.enabled&&(i.isDefine||s.push(t),!t.error))if(!t.inited&&o)r(h)?(e=!0,l=!0):(a.push(h),n(h));else if(!t.inited&&t.fetched&&i.isDefine&&(l=!0,!i.prefix))return u=!1}),o&&a.length)return t=makeError("timeout","Load timeout for modules: "+a,null,a),t.contextName=b.contextName,h(t);u&&each(s,function(t){c(t,{},{})}),o&&!e||!l||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,p()},50)),C=!1}}function g(t){hasProp(A,t[0])||s(a(t[0],null,!0)).init(t[1],t[2])}function f(t,e,i,n){t.detachEvent&&!isOpera?n&&t.detachEvent(n,e):t.removeEventListener(i,e,!1)}function y(t){var e=t.currentTarget||t.srcElement;return f(e,b.onScriptLoad,"load","onreadystatechange"),f(e,b.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function m(){var t;for(u();P.length;){if(t=P.shift(),null===t[0])return h(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));g(t)}b.defQueueMap={}}var C,S,b,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},T={},M={},_={},P=[],A={},k={},D={},F=1,E=1;return v={require:function(t){return t.require?t.require:t.require=b.makeRequire(t.map)},exports:function(t){if(t.usingExports=!0,t.map.isDefine)return t.exports?A[t.map.id]=t.exports:t.exports=A[t.map.id]={}},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return getOwn(x.config,t.map.id)||{}},exports:t.exports||(t.exports={})}}},S=function(t){this.events=getOwn(_,t.id)||{},this.map=t,this.shim=getOwn(x.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},S.prototype={init:function(t,e,i,n){n=n||{},this.inited||(this.factory=e,i?this.on("error",i):this.events.error&&(i=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var t=this.map;if(!this.shim)return t.prefix?this.callPlugin():this.load();b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()}))}},load:function(){var t=this.map.url;k[t]||(k[t]=!0,b.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,i=this.map.id,n=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){try{r=b.execCb(i,o,n,r)}catch(e){t=e}if(this.map.isDefine&&void 0===r&&(e=this.module,e?r=e.exports:this.usingExports&&(r=this.exports)),t){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",h(this.error=t);"undefined"!=typeof console&&console.error?console.error(t):req.onError(t)}}else r=o;if(this.exports=r,this.map.isDefine&&!this.ignore&&(A[i]=r,req.onResourceLoad)){var a=[];each(this.depMaps,function(t){a.push(t.normalizedMap||t)}),req.onResourceLoad(b,this.map,a)}d(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(b.defQueueMap,i)||this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,n=a(t.prefix);this.depMaps.push(n),l(n,"defined",bind(this,function(n){var r,o,u,c=getOwn(D,this.map.id),p=this.map.name,g=this.map.parentMap?this.map.parentMap.name:null,f=b.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(p=n.normalize(p,function(t){return i(t,g,!0)})||""),o=a(t.prefix+"!"+p,this.map.parentMap),l(o,"defined",bind(this,function(t){this.map.normalizedMap=o,this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),void((u=getOwn(T,o.id))&&(this.depMaps.push(o),this.events.error&&u.on("error",bind(this,function(t){this.emit("error",t)})),u.enable()))):c?(this.map.url=b.nameToUrl(c),void this.load()):(r=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),r.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],eachProp(T,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&d(t.map.id)}),h(t)}),r.fromText=bind(this,function(i,n){var o=t.name,l=a(o),u=useInteractive;n&&(i=n),u&&(useInteractive=!1),s(l),hasProp(x.config,e)&&(x.config[o]=x.config[e]);try{req.exec(i)}catch(t){return h(makeError("fromtexteval","fromText eval for "+e+" failed: "+t,t,[e]))}u&&(useInteractive=!0),this.depMaps.push(l),b.completeLoad(o),f([o],r)}),void n.load(t.name,f,r,x))})),b.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){M[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var i,n,r;if("string"==typeof t){if(t=a(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,r=getOwn(v,t.id))return void(this.depExports[e]=r(this));this.depCount+=1,l(t,"defined",bind(this,function(t){this.undefed||(this.defineDep(e,t),this.check())})),this.errback?l(t,"error",bind(this,this.errback)):this.events.error&&l(t,"error",bind(this,function(t){this.emit("error",t)}))}i=t.id,n=T[i],hasProp(v,i)||!n||n.enabled||b.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(T,t.id);e&&!e.enabled&&b.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var i=this.events[t];i||(i=this.events[t]=[]),i.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},b={config:x,contextName:t,registry:T,defined:A,urlFetched:k,defQueue:P,defQueueMap:{},Module:S,makeModuleMap:a,nextTick:req.nextTick,onError:h,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var e=x.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(t,function(t,e){i[e]?(x[e]||(x[e]={}),mixin(x[e],t,!0,!0)):x[e]=t}),t.bundles&&eachProp(t.bundles,function(t,e){each(t,function(t){t!==e&&(D[t]=e)})}),t.shim&&(eachProp(t.shim,function(t,i){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=b.makeShimExports(t)),e[i]=t}),x.shim=e),t.packages&&each(t.packages,function(t){var e,i;t="string"==typeof t?{name:t}:t,i=t.name,e=t.location,e&&(x.paths[i]=t.location),x.pkgs[i]=t.name+"/"+(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(T,function(t,e){t.inited||t.map.unnormalized||(t.map=a(e,null,!0))}),(t.deps||t.callback)&&b.require(t.deps||[],t.callback)},makeShimExports:function(t){function e(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}return e},makeRequire:function(e,r){function o(i,n,l){var u,d,c;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?h(makeError("requireargs","Invalid require call"),l):e&&hasProp(v,i)?v[i](T[e.id]):req.get?req.get(b,i,e,o):(d=a(i,e,!1,!0),u=d.id,hasProp(A,u)?A[u]:h(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(m(),b.nextTick(function(){m(),c=s(a(null,e)),c.skipMap=r.skipMap,c.init(i,n,l,{enabled:!0}),p()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(t){var n,r=t.lastIndexOf("."),o=t.split("/")[0],a="."===o||".."===o;return-1!==r&&(!a||r>1)&&(n=t.substring(r,t.length),t=t.substring(0,r)),b.nameToUrl(i(t,e&&e.id,!0),n,!0)},defined:function(t){return hasProp(A,a(t,e,!1,!0).id)},specified:function(t){return t=a(t,e,!1,!0).id,hasProp(A,t)||hasProp(T,t)}}),e||(o.undef=function(t){u();var i=a(t,e,!0),r=getOwn(T,t);r.undefed=!0,n(t),delete A[t],delete k[i.url],delete _[t],eachReverse(P,function(e,i){e[0]===t&&P.splice(i,1)}),delete b.defQueueMap[t],r&&(r.events.defined&&(_[t]=r.events),d(t))}),o},enable:function(t){getOwn(T,t.id)&&s(t).enable()},completeLoad:function(t){var e,i,n,o=getOwn(x.shim,t)||{},a=o.exports;for(u();P.length;){if(i=P.shift(),null===i[0]){if(i[0]=t,e)break;e=!0}else i[0]===t&&(e=!0);g(i)}if(b.defQueueMap={},n=getOwn(T,t),!e&&!hasProp(A,t)&&n&&!n.inited){if(!(!x.enforceDefine||a&&getGlobal(a)))return r(t)?void 0:h(makeError("nodefine","No define call for "+t,null,[t]));g([t,o.deps||[],o.exportsFn])}p()},nameToUrl:function(t,e,i){var n,r,o,a,s,l,h,u=getOwn(x.pkgs,t);if(u&&(t=u),h=getOwn(D,t))return b.nameToUrl(h,e,i);if(req.jsExtRegExp.test(t))s=t+(e||"");else{for(n=x.paths,r=t.split("/"),o=r.length;o>0;o-=1)if(a=r.slice(0,o).join("/"),l=getOwn(n,a)){isArray(l)&&(l=l[0]),r.splice(0,o,l);break}s=r.join("/"),s+=e||(/^data\:|\?/.test(s)||i?"":".js"),s=("/"===s.charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+s}return x.urlArgs?s+(-1===s.indexOf("?")?"?":"&")+x.urlArgs:s},load:function(t,e){req.load(b,t,e)},execCb:function(t,e,i,n){return e.apply(n,i)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=y(t);b.completeLoad(e.id)}},onScriptError:function(t){var e=y(t);if(!r(e.id)){var i=[];return eachProp(T,function(t,n){0!==n.indexOf("_@r")&&each(t.depMaps,function(t){return t.id===e.id&&i.push(n),!0})}),h(makeError("scripterror",'Script error for "'+e.id+(i.length?'", needed by: '+i.join(", "):'"'),t,[e.id]))}}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){if("interactive"===t.readyState)return interactiveScript=t}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,i,n){var r,o,a=defContextName;return isArray(t)||"string"==typeof t||(o=t,isArray(e)?(t=e,e=i,i=n):t=[]),o&&o.context&&(a=o.context),r=getOwn(contexts,a),r||(r=contexts[a]=req.s.newContext(a)),o&&r.configure(o),r.require(t,e,i)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t,e,i){var n=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=t.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(t,e,i){var n,r=t&&t.config||{};if(isBrowser)return n=req.createNode(r,e,i),r.onNodeCreated&&r.onNodeCreated(n,r,e,i),n.setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",e),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(i),t.completeLoad(e)}catch(n){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+i,n,[e]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){if(head||(head=t.parentNode),dataMain=t.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(t,e,i){var n,r;"string"!=typeof t&&(i=e,e=t,t=null),isArray(e)||(i=e,e=null),!e&&isFunction(i)&&(e=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(t,i){e.push(i)}),e=(1===i.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript())&&(t||(t=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")]),r?(r.defQueue.push([t,e,i]),r.defQueueMap[t]=!0):globalDefQueue.push([t,e,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("text",["module"],function(t){"use strict";function e(t,e){return void 0===t||""===t?e:t}function i(t,i,n,r){if(i===r)return!0;if(t===n){if("http"===t)return e(i,"80")===e(r,"80");if("https"===t)return e(i,"443")===e(r,"443")}return!1}var n,r,o,a,s,l=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),p=d&&location.hostname,g=d&&(location.port||void 0),f={},y=t.config&&t.config()||{};return n={version:"2.0.16",strip:function(t){if(t){t=t.replace(h,"");var e=t.match(u);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:y.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=l[e];try{t=new ActiveXObject(i)}catch(t){}if(t){l=[i];break}}return t},parseName:function(t){var e,i,n,r=!1,o=t.lastIndexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==o&&(!a||o>1)?(e=t.substring(0,o),i=t.substring(o+1)):e=t,n=i||e,o=n.indexOf("!"),-1!==o&&(r="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:e=n),{moduleName:e,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,e,r,o){var a,s,l,h=n.xdRegExp.exec(t);return!h||(a=h[2],s=h[3],s=s.split(":"),l=s[1],s=s[0],(!a||a===e)&&(!s||s.toLowerCase()===r.toLowerCase())&&(!l&&!s||i(a,l,e,o)))},finishLoad:function(t,e,i,r){i=e?n.strip(i):i,y.isBuild&&(f[t]=i),r(i)},load:function(t,e,i,r){if(r&&r.isBuild&&!r.inlineText)return void i();y.isBuild=r&&r.isBuild;var o=n.parseName(t),a=o.moduleName+(o.ext?"."+o.ext:""),s=e.toUrl(a),l=y.useXhr||n.useXhr;if(0===s.indexOf("empty:"))return void i();!d||l(s,c,p,g)?n.get(s,function(e){n.finishLoad(t,o.strip,e,i)},function(t){i.error&&i.error(t)}):e([a],function(t){n.finishLoad(o.moduleName+"."+o.ext,o.strip,t,i)},function(t){i.error&&i.error(t)})},write:function(t,e,i,r){if(f.hasOwnProperty(e)){var o=n.jsEscape(f[e]);i.asModule(t+"!"+e,"define(function () { return '"+o+"';});\n")}},writeFile:function(t,e,i,r,o){var a=n.parseName(e),s=a.ext?"."+a.ext:"",l=a.moduleName+s,h=i.toUrl(a.moduleName+s)+".js";n.load(l,i,function(e){var i=function(t){return r(h,t)};i.asModule=function(t,e){return r.asModule(t,h,e)},n.write(t,l,i,o)},o)}},"node"===y.env||!y.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(r=require.nodeRequire("fs"),n.get=function(t,e,i){try{var n=r.readFileSync(t,"utf8");"\ufeff"===n[0]&&(n=n.substring(1)),e(n)}catch(t){i&&i(t)}}):"xhr"===y.env||!y.env&&n.createXhr()?n.get=function(t,e,i,r){var o,a=n.createXhr();if(a.open("GET",t,!0),r)for(o in r)r.hasOwnProperty(o)&&a.setRequestHeader(o.toLowerCase(),r[o]);y.onXhr&&y.onXhr(a,t),a.onreadystatechange=function(n){var r,o;4===a.readyState&&(r=a.status||0,r>399&&r<600?(o=new Error(t+" HTTP status: "+r),o.xhr=a,i&&i(o)):e(a.responseText),y.onXhrComplete&&y.onXhrComplete(a,t))},a.send(null)}:"rhino"===y.env||!y.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?n.get=function(t,e){var i,n,r=new java.io.File(t),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),s="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(o),i.append(n);s=String(i.toString())}finally{a.close()}e(s)}:("xpconnect"===y.env||!y.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,a=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in o,n.get=function(t,e){var i,n,r,l={};s&&(t=t.replace(/\//g,"\\")),r=new FileUtils.File(t);try{i=o["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),i.init(r,1,0,!1),n=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),n.init(i,"utf-8",i.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),n.readString(i.available(),l),n.close(),i.close(),e(l.value)}catch(t){throw new Error((r&&r.path||"")+": "+t)}}),n}),define("version",["text!version.json"],function(t){var e=JSON.parse(t);return{name:function(){return e.name},id:function(){return e.id},version:function(){return e.string+"_"+e.date+"_"+e.time},shortVersion:function(){return e.string}}}),define("absolute/asyncqueue",[],function(){"use strict";var t=function(){this._initAsyncQueue()};return t.prototype._initAsyncQueue=function(){this.tasks=new Array,this.current=0},t.prototype.reset=function(){this.current=0},t.prototype.clear=function(){this.tasks=new Array,this.reset()},t.prototype.pushTask=function(t){this.tasks.push(t)},t.prototype.pushTasks=function(t){for(var e in t)this.tasks.push(t[e])},t.prototype.run=function(t,e){this.onProgress=t,this.onComplete=e;var i=this;if("function"!=typeof this.tasks[0])throw"Error: task is a "+typeof this.tasks[0]+" not a function!";this.tasks[this.current](function(t){i._updateProgress(t)},function(){i._runNext()})},t.prototype._runNext=function(){var t=this;if(++this.current<this.tasks.length){if("function"!=typeof this.tasks[this.current])throw"Error: task is a "+typeof this.tasks[0]+" not a function!";this.tasks[this.current](function(e){t._updateProgress(e)},function(){t._runNext()})}else this.onComplete()},t.prototype._updateProgress=function(t){var e=0;this.tasks.length>0&&(e=this.current/this.tasks.length+1/this.tasks.length*t),this.onProgress(e)},t}),define("absoluteaudio/audioclip",[],function(){var t=(navigator.userAgent.indexOf("iPhone OS"),function(t,e){this.init(t,e)});return t.constructor=t,t.prototype.init=function(t,e){},t.prototype.load=function(t,e){},t.prototype.seek=function(t){},t.prototype.play=function(t,e,i){},t.prototype.pause=function(){},t.prototype.stop=function(){},t.prototype.setVolume=function(t){},t.prototype.getVolume=function(){},t.prototype.mute=function(){},t.prototype.unmute=function(){},t.prototype.isMuted=function(){},t.prototype.prime=function(){},t}),define("absolute/debug",[],function(){return{enabled:!1,custom:{},log:function(t){this.enabled&&console.log(t)}}}),define("absoluteaudio/webaudioclip",["absoluteaudio/audioclip","absolute/debug"],function(t,e){var i=function(t,e,i){this.init(t,e,i)};return i.constructor=i,i.prototype=Object.create(t.prototype),i.prototype.init=function(e,i,n){t.prototype.init.call(e,i),this.audioContext=n,this.url=e,this.volume=1,this.offset=0,this.sourceNode=null,this.gainNode=null,this.muted=!1,this.load(e,i)},i.prototype.load=function(t,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){this.audioContext.decodeAudioData(n.response,function(t){this.buffer=t,i&&"function"==typeof i&&i()}.bind(this),function(){e.log("error loading audio clip "+t),i&&"function"==typeof i&&i()}.bind(this))}.bind(this),n.send()},i.prototype.play=function(t,e,i){var n=t||0;this.loop=!!e,this.onComplete=i,this.sourceNode=this.audioContext.createBufferSource(),void 0!==this.audioContext.createGainNode?this.gainNode=this.audioContext.createGainNode():this.gainNode=this.audioContext.createGain();try{this.sourceNode.loop=e,this.sourceNode.buffer=this.buffer,this.sourceNode.onended=function(){i&&"function"==typeof i&&i(),this.sourceNode=null,this.gainNode=null}.bind(this),this.gainNode.gain.value=this.muted?0:this.volume,this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),0!==n&&(n+=this.audioContext.currentTime),void 0===this.sourceNode.start?this.sourceNode.noteOn(n):this.sourceNode.start(n,this.offset)}catch(t){"undefined"!=typeof Raygun&&Raygun.send(t)}},i.prototype.pause=function(){this.stop(),this.offset=this.audioContext.currentTime},i.prototype.stop=function(){this.sourceNode&&(this.offset=0,void 0===this.sourceNode.start?this.sourceNode.noteOff(0):this.sourceNode.stop(0),this.sourceNode=null,this.gainNode=null)},i.prototype.setVolume=function(t){t<0?t=0:t>1&&(t=1),this.volume=t,this.gainNode&&(this.gainNode.gain.value=t)},i.prototype.getVolume=function(){return this.volume},i.prototype.mute=function(){this.muted=!0,this.gainNode&&(this.gainNode.gain.value=0)},i.prototype.unmute=function(){this.muted=!1,this.gainNode&&(this.gainNode.gain.value=this.volume)},i.prototype.isMuted=function(){return this.muted},i}),define("absoluteaudio/streamedwebaudioclip",[],function(){var t=(navigator.userAgent.indexOf("iPhone OS"),function(t,e,i){this.init(t,e,i)});return t.prototype.init=function(t,e,i){this.audioContext=i,this.url=t,this.volume=1,this.offset=0,this.audioElement=null,this.source=null,this.gainNode=null,this.muted=!1,this.load(t,e)},t.prototype.load=function(t,e){this.audioElement=new Audio,this.audioElement.addEventListener("loadstart",function(){e&&"function"==typeof e&&e()},!1),this.audioElement.src=this.url},t.prototype.play=function(t,e,i){this.audioElement.loop=e,this.source||(this.source=this.audioContext.createMediaElementSource(this.audioElement),this.gainNode=this.audioContext.createGainNode(),this.source.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.gainNode.gain.value=this.muted?0:this.volume),this.audioElement.addEventListener("ended",function(){i&&"function"==typeof i&&i()},!1),this.audioElement.play()},t.prototype.pause=function(){this.audioElement&&this.audioElement.pause()},t.prototype.stop=function(){this.audioElement&&this.audioElement.pause()},t.prototype.setVolume=function(t){t<0?t=0:t>1&&(t=1),this.volume=t,this.gainNode&&(this.gainNode.gain.value=t)},t.prototype.getVolume=function(){return this.volume},t.prototype.mute=function(){this.muted=!0,this.gainNode&&(this.gainNode.gain.value=0)},t.prototype.unmute=function(){this.gainNode&&(this.gainNode.gain.value=this.volume),this.muted=!1},t.prototype.isMuted=function(){return this.muted},t}),define("absoluteaudio/html5audioelementclip",["absoluteaudio/audioclip"],function(t){var e=function(t,e,i){this.init(t,e,i)};return e.constructor=e,e.prototype=Object.create(t.prototype),e.prototype.init=function(e,i,n){t.prototype.init.call(e,i),this.duration=n,this.url=e,this.volume=1,this.audioElement=null,this.muted=!1,this.loopTimer=null,this.delay=0,this.loop=!1,this.onComplete=null,this.paused=!0,this.offset=0,this.isSilent=!1,this.load(e,i)},e.prototype.load=function(t,e){this.audioElement=new Audio;var i=0,n=function(){4===this.audioElement.readyState||i++>4?e():setTimeout(n,250)}.bind(this);this.audioElement.addEventListener("loadstart",function(){n()}.bind(this),!1),this.audioElement.src=this.url},t.prototype.seek=function(t){this.offset=t},e.prototype.play=function(t,e,i){try{if(this.delay=t,this.loop=e,this.onComplete=i,this.muted)return void(e&&(this.paused=!1));if(void 0!==this.duration){var n=function(){this.audioElement.currentTime>=this.duration?(this.paused=!1,e?(this.audioElement.pause(),this.audioElement.currentTime=this.offset,this.play(t,e,i)):(this.paused=!0,this.audioElement.pause(),i&&"function"==typeof i&&i())):this.audioElement.paused||requestAnimationFrame(n)}.bind(this);requestAnimationFrame(n)}this.audioElement.currentTime=this.offset,this.audioElement.play()}catch(t){}},e.prototype.pause=function(){this._actualPause(),this.paused=!0},e.prototype._actualPause=function(){this.audioElement&&(this.loopTimer&&(clearTimeout(this.loopTimer),this.loopTimer=null),this.audioElement.pause())},e.prototype.stop=function(){try{this.audioElement&&(this.loopTimer&&(clearTimeout(this.loopTimer),this.loopTimer=null),this.audioElement.pause(),this.audioElement.currentTime=this.offset)}catch(t){}},e.prototype.setVolume=function(t){t<0?t=0:t>1&&(t=1),this.volume=t,this.audioElement&&(this.audioElement=t)},e.prototype.getVolume=function(){return this.volume},e.prototype.mute=function(){this.muted=!0,this.audioElement&&(this.paused||this._actualPause())},e.prototype.unmute=function(){this.audioElement&&this.muted&&!this.paused&&(this.muted=!1,this.play(this.delay,this.loop,this.onComplete)),this.muted=!1},e.prototype.isMuted=function(){return this.muted},e.prototype.prime=function(){this.audioElement&&(this.audioElement.play(),this.audioElement.pause())},e.prototype.playSilent=function(){this.isSilent=!0;var t=function(){if(this.isSilent){try{this.audioElement.currentTime=1e3}catch(t){}setTimeout(t,500)}}.bind(this);t()},e}),define("absoluteaudio/audiosprite",[],function(){var t=null,e=function(t,e,i){this.init(t,e,i)};return e.constructor=e,e.prototype.init=function(t,e,i){this.baseClip=t,this.start=e,this.end=i,this.cancelled=!1,this.muted=!1,this.paused=!0},e.prototype.seek=function(t){this.baseClip.seek(this.offset+t)},e.prototype.play=function(e,i,n){this.delay=e,this.loop=i,this.onComplete=n;var r=e||0;if(!this.muted){var o=function(){try{this.paused=!0,this.baseClip.audioElement.currentTime=this.start;var e=function(){this.baseClip.audioElement.currentTime=this.start,this.baseClip.audioElement.currentTime!==this.start?setTimeout(e,100):(this!==t&&(t&&(t.cancelled=!0),t=this,this.cancelled=!1),this.paused=!1,this.baseClip.audioElement.paused&&this.baseClip.audioElement.play(),this.baseClip.isSilent=!1,requestAnimationFrame(a))}.bind(this);e()}catch(t){}}.bind(this),a=function(){this.cancelled||(this.baseClip.audioElement.currentTime>=this.end?(this.paused=!1,i?o():(this.paused=!0,this.baseClip.playSilent(),n&&"function"==typeof n&&n())):this.paused||requestAnimationFrame(a))}.bind(this);r>0?setTimeout(function(){o()}.bind(this),1e3*r):o()}},e.prototype.pause=function(){this.baseClip.playSilent()},e.prototype.stop=function(){this.baseClip.playSilent(),this.cancelled=!0},e.prototype.setVolume=function(t){this.baseClip.setVolume()},e.prototype.getVolume=function(){return this.baseClip.getVolume()},e.prototype.mute=function(){this.paused||this.cancelled||this.baseClip.playSilent(),this.muted=!0,this.cancelled=!0},e.prototype.unmute=function(){this.muted=!1,this.paused||this.play(this.delay,this.loop,this.onComplete)},e.prototype.isMuted=function(){return this.baseClip.isMuted()},e.prototype.prime=function(){},e}),define("absoluteaudio/cordovaclip",[],function(){var t=function(t,e){this.init(t,e)};return t.constructor=t,
t.prototype.init=function(t,e){this.clip=new Media(t,function(){this.loop&&!this.cancelled?this.clip.play():this.onComplete&&"function"==typeof this.onComplete&&this.onComplete()}.bind(this)),this.muted=!1,this.cancelled=!1,this.paused=!0,e&&"function"==typeof e&&e()},t.prototype.seek=function(t){},t.prototype.play=function(t,e,i){this.delay=t,this.loop=e,this.onComplete=i;var n=t||0;this.paused=!1,this.cancelled=!1,n>0?setTimeout(function(){this.clip.play()}.bind(this),1e3*n):this.clip.play()},t.prototype.pause=function(){this.clip.pause(),this.paused=!0},t.prototype.stop=function(){this.cancelled=!0,this.clip.stop()},t.prototype.setVolume=function(t){},t.prototype.getVolume=function(){},t.prototype.mute=function(){setTimeout(function(){this.clip.setVolume("0.0"),this.muted=!0}.bind(this),0)},t.prototype.unmute=function(){setTimeout(function(){this.clip.setVolume("1.0"),this.muted=!1}.bind(this),0)},t.prototype.isMuted=function(){return this.muted},t.prototype.prime=function(){},t}),define("absoluteaudio/soundmanagerclip",[],function(){var t=function(t,e){this.init(t,e)};return t.constructor=t,t.prototype.init=function(t,e){this.load(t,e)},t.prototype.load=function(t,e){var i=t.substring(t.lastIndexOf("/")+1);this.sound=soundManager.createSound({id:i,url:t,autoLoad:!0,onload:function(){e()}})},t.prototype.seek=function(t){},t.prototype.play=function(t,e,i){var n=!!e,r=function(){n?this.sound.play({onfinish:function(){r()}}):i&&"function"==typeof i&&i()}.bind(this);this.sound.play({onfinish:function(){r()}})},t.prototype.pause=function(){this.sound.stop()},t.prototype.stop=function(){this.sound.stop()},t.prototype.setVolume=function(t){},t.prototype.getVolume=function(){},t.prototype.mute=function(){this.sound.mute()},t.prototype.unmute=function(){this.sound.unmute()},t.prototype.isMuted=function(){return this.muted},t.prototype.prime=function(){},t}),define("absoluteaudio/debug",[],function(){for(var t,e={},i=/\+/g,n=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(i," "))},o=window.location.search.substring(1);t=n.exec(o);)e[r(t[1])]=r(t[2]);return{enabled:e.debugAudio&&"true"===e.debugAudio}}),function(){var t=this,e=e||{};e.WEBGL_RENDERER=0,e.CANVAS_RENDERER=1,e.VERSION="v2.2.9",e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},e._UID=0,"undefined"!=typeof Float32Array?(e.Float32Array=Float32Array,e.Uint16Array=Uint16Array,e.Uint32Array=Uint32Array,e.ArrayBuffer=ArrayBuffer):(e.Float32Array=Array,e.Uint16Array=Array),e.INTERACTION_FREQUENCY=30,e.AUTO_PREVENT_DEFAULT=!0,e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RETINA_PREFIX="@2x",e.dontSayHello=!1,e.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},e.sayHello=function(t){if(!e.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+e.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+e.VERSION+" - http://www.pixijs.com/");e.dontSayHello=!0}},e.Point=function(t,e){this.x=t||0,this.y=e||0},e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)},e.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},e.Point.prototype.constructor=e.Point,e.Rectangle=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},e.Rectangle.prototype.clone=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)},e.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},e.Rectangle.prototype.constructor=e.Rectangle,e.EmptyRectangle=new e.Rectangle(0,0,0,0),e.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof e.Point){for(var i=[],n=0,r=t.length;n<r;n++)i.push(t[n].x,t[n].y);t=i}this.closed=!0,this.points=t},e.Polygon.prototype.clone=function(){var t=this.points.slice();return new e.Polygon(t)},e.Polygon.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,r=0,o=n-1;r<n;o=r++){var a=this.points[2*r],s=this.points[2*r+1],l=this.points[2*o],h=this.points[2*o+1];s>e!=h>e&&t<(l-a)*(e-s)/(h-s)+a&&(i=!i)}return i},e.Polygon.prototype.constructor=e.Polygon,e.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},e.Circle.prototype.clone=function(){return new e.Circle(this.x,this.y,this.radius)},e.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,n=this.y-e,r=this.radius*this.radius;return i*=i,n*=n,i+n<=r},e.Circle.prototype.getBounds=function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e.Circle.prototype.constructor=e.Circle,e.Ellipse=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},e.Ellipse.prototype.clone=function(){return new e.Ellipse(this.x,this.y,this.width,this.height)},e.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1},e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},e.Ellipse.prototype.constructor=e.Ellipse,e.RoundedRectangle=function(t,e,i,n,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.radius=r||20},e.RoundedRectangle.prototype.clone=function(){return new e.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},e.RoundedRectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var n=this.y;if(e>=n&&e<=n+this.height)return!0}return!1},e.RoundedRectangle.prototype.constructor=e.RoundedRectangle,e.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},e.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},e.Matrix.prototype.toArray=function(t){this.array||(this.array=new e.Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},e.Matrix.prototype.apply=function(t,i){return i=i||new e.Point,i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i},e.Matrix.prototype.applyInverse=function(t,i){i=i||new e.Point;var n=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*n*t.x+-this.c*n*t.y+(this.ty*this.c-this.tx*this.d)*n,i.y=this.a*n*t.y+-this.b*n*t.x+(-this.ty*this.a+this.tx*this.b)*n,i},e.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},e.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},e.Matrix.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},e.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.identityMatrix=new e.Matrix,e.DisplayObject=function(){this.position=new e.Point,this.scale=new e.Point(1,1),this.pivot=new e.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new e.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new e.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},e.DisplayObject.prototype.constructor=e.DisplayObject,Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,r=0;r<n.length;r++)e.push(n[r]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),e.DisplayObject.prototype.updateTransform=function(){var t,i,n,r,o,a,s=this.parent.worldTransform,l=this.worldTransform;this.rotation%e.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,i=this._sr*this.scale.x,n=-this._sr*this.scale.y,r=this._cr*this.scale.y,o=this.position.x,a=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*t+this.pivot.y*n,a-=this.pivot.x*i+this.pivot.y*r),l.a=t*s.a+i*s.c,l.b=t*s.b+i*s.d,l.c=n*s.a+r*s.c,l.d=n*s.b+r*s.d,l.tx=o*s.a+a*s.c+s.tx,l.ty=o*s.b+a*s.d+s.ty):(t=this.scale.x,r=this.scale.y,o=this.position.x-this.pivot.x*t,a=this.position.y-this.pivot.y*r,l.a=t*s.a,l.b=t*s.b,l.c=r*s.c,l.d=r*s.d,l.tx=o*s.a+a*s.c+s.tx,l.ty=o*s.b+a*s.d+s.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform,e.DisplayObject.prototype.getBounds=function(t){return t=t,e.EmptyRectangle},e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)},e.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},e.DisplayObject.prototype.generateTexture=function(t,i,n){var r=this.getLocalBounds(),o=new e.RenderTexture(0|r.width,0|r.height,n,i,t);return e.DisplayObject._tempMatrix.tx=-r.x,e.DisplayObject._tempMatrix.ty=-r.y,o.render(this,e.DisplayObject._tempMatrix),o},e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},e.DisplayObject.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},e.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},e.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|t.width,0|t.height);else{var i=new e.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new e.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var n=this._filters;this._filters=null,this._cachedSprite.filters=n,e.DisplayObject._tempMatrix.tx=-t.x,e.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._filters=n,this._cacheAsBitmap=!0},e.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},e.DisplayObject.prototype._renderWebGL=function(t){t=t},e.DisplayObject.prototype._renderCanvas=function(t){t=t},e.DisplayObject._tempMatrix=new e.Matrix,Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),e.DisplayObjectContainer=function(){e.DisplayObject.call(this),this.children=[]},e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype),e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer,Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),e.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},e.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},e.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(i<0||n<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},e.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},e.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},e.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},e.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},e.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,n="number"==typeof e?e:this.children.length,r=n-i;if(r>0&&r<=n){for(var o=this.children.splice(i,r),a=0;a<o.length;a++){var s=o[a];this.stage&&s.removeStageReference(),s.parent=void 0}return o}if(0===r&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform,e.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return e.EmptyRectangle;for(var t,i,n,r=1/0,o=1/0,a=-1/0,s=-1/0,l=!1,h=0,u=this.children.length;h<u;h++){this.children[h].visible&&(l=!0,t=this.children[h].getBounds(),r=r<t.x?r:t.x,o=o<t.y?o:t.y,i=t.width+t.x,n=t.height+t.y,a=a>i?a:i,s=s>n?s:n)}if(!l)return e.EmptyRectangle;var d=this._bounds;return d.x=r,d.y=o,d.width=a-r,d.height=s-o,d},e.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=e.identityMatrix;for(var i=0,n=this.children.length;i<n;i++)this.children[i].updateTransform();var r=this.getBounds();return this.worldTransform=t,r},e.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;e<i;e++){this.children[e].setStageReference(t)}},e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;t<e;t++){this.children[t].removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},e.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e,i;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)}},e.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;e<i;e++){this.children[e]._renderCanvas(t)}this._mask&&t.maskManager.popMask(t)}},e.Sprite=function(t){e.DisplayObjectContainer.call(this),this.anchor=new e.Point,this.texture=t||e.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Sprite.prototype.constructor=e.Sprite,Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},e.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,o=i*(1-this.anchor.y),a=i*-this.anchor.y,s=t||this.worldTransform,l=s.a,h=s.b,u=s.c,d=s.d,c=s.tx,p=s.ty,g=-1/0,f=-1/0,y=1/0,m=1/0;if(0===h&&0===u)l<0&&(l*=-1),d<0&&(d*=-1),y=l*r+c,g=l*n+c,m=d*a+p,f=d*o+p;else{var C=l*r+u*a+c,S=d*a+h*r+p,b=l*n+u*a+c,v=d*a+h*n+p,w=l*n+u*o+c,x=d*o+h*n+p,T=l*r+u*o+c,M=d*o+h*r+p;y=C<y?C:y,y=b<y?b:y,y=w<y?w:y,y=T<y?T:y,m=S<m?S:m,m=v<m?v:m,m=x<m?x:m,m=M<m?M:m,g=C>g?C:g,g=b>g?b:g,g=w>g?w:g,g=T>g?T:g,f=S>f?S:f,f=v>f?v:f,f=x>f?x:f,f=M>f?M:f}var _=this._bounds;return _.x=y,_.width=g-y,_.y=m,_.height=f-m,this._currentBounds=_,_},e.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){var e,i;if(this._mask||this._filters){var n=t.spriteBatch;for(this._filters&&(n.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),t.maskManager.pushMask(this.mask,t),n.start()),n.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);n.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),n.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t)}},e.Sprite.prototype._renderCanvas=function(t){if(!(!1===this.visible||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var i=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===e.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),n|=0,r|=0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/i,r/i,this.texture.crop.width/i,this.texture.crop.height/i)}for(var o=0,a=this.children.length;o<a;o++)this.children[o]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.Sprite.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new e.Sprite(i)},e.Sprite.fromImage=function(t,i,n){var r=e.Texture.fromImage(t,i,n);return new e.Sprite(r)},e.SpriteBatch=function(t){e.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(t),this.ready=!0},e.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},e.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},e.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,n=!0,r=0;r<this.children.length;r++){var o=this.children[r];if(o.visible){var a=o.texture,s=a.frame;if(e.globalAlpha=this.worldAlpha*o.alpha,o.rotation%(2*Math.PI)==0)n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),e.drawImage(a.baseTexture.source,s.x,s.y,s.width,s.height,o.anchor.x*(-s.width*o.scale.x)+o.position.x+.5|0,o.anchor.y*(-s.height*o.scale.y)+o.position.y+.5|0,s.width*o.scale.x,s.height*o.scale.y);else{n||(n=!0),o.displayObjectUpdateTransform();var l=o.worldTransform;t.roundPixels?e.setTransform(l.a,l.b,l.c,l.d,0|l.tx,0|l.ty):e.setTransform(l.a,l.b,l.c,l.d,l.tx,l.ty),e.drawImage(a.baseTexture.source,s.x,s.y,s.width,s.height,o.anchor.x*-s.width+.5|0,o.anchor.y*-s.height+.5|0,s.width,s.height)}}}}},e.MovieClip=function(t){e.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},e.MovieClip.prototype=Object.create(e.Sprite.prototype),e.MovieClip.prototype.constructor=e.MovieClip,Object.defineProperty(e.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),e.MovieClip.prototype.stop=function(){this.playing=!1},e.MovieClip.prototype.play=function(){this.playing=!0},e.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},e.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},e.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},e.MovieClip.fromFrames=function(t){for(var i=[],n=0;n<t.length;n++)i.push(new e.Texture.fromFrame(t[n]));return new e.MovieClip(i)},e.MovieClip.fromImages=function(t){for(var i=[],n=0;n<t.length;n++)i.push(new e.Texture.fromImage(t[n]));return new e.MovieClip(i)},e.FilterBlock=function(){this.visible=!0,this.renderable=!0},e.FilterBlock.prototype.constructor=e.FilterBlock,e.Text=function(t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,e.Sprite.call(this,e.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(i)},e.Text.prototype=Object.create(e.Sprite.prototype),e.Text.prototype.constructor=e.Text,Object.defineProperty(e.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Segoe UI",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",t.lineJoin=t.lineJoin||"miter",t.lineHeight=t.lineHeight||!1,this.style=t,this.dirty=!0},e.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,r=this.determineFontProperties(this.style.font),o=0;o<e.length;o++){var a=this.context.measureText(e[o]).width;i[o]=a,n=Math.max(n,a)}var s=n+this.style.strokeThickness;this.style.dropShadow&&(s+=this.style.dropShadowDistance),this.canvas.width=(s+this.context.lineWidth)*this.resolution;var l=this.style.lineHeight||r.fontSize+this.style.strokeThickness,h=l*e.length;this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.height=h*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin;var u,d;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var c=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(o=0;o<e.length;o++)u=this.style.strokeThickness/2,d=this.style.strokeThickness/2+o*l+r.ascent,"right"===this.style.align?u+=n-i[o]:"center"===this.style.align&&(u+=(n-i[o])/2),this.style.fill&&this.context.fillText(e[o],u+c,d+p)}for(this.context.fillStyle=this.style.fill,o=0;o<e.length;o++)u=this.style.strokeThickness/2,d=this.style.strokeThickness/2+o*l+r.ascent,"right"===this.style.align?u+=n-i[o]:"center"===this.style.align&&(u+=(n-i[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[o],u,d),this.style.fill&&this.context.fillText(e[o],u,d);this.updateTexture()},e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},e.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderWebGL.call(this,t)},e.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderCanvas.call(this,t)},e.Text.prototype.determineFontProperties=function(t){var i=e.Text.fontPropertiesCache[t];if(!i){i={};var n=e.Text.fontPropertiesCanvas,r=e.Text.fontPropertiesContext;r.font=t;var o=Math.ceil(r.measureText("|Mq").width),a=Math.ceil(r.measureText("M").width),s=2*a;a=1.4*a|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,a);var l,h,u=r.getImageData(0,0,o,s).data,d=u.length,c=4*o,p=0,g=!1;for(l=0;l<a;l++){for(h=0;h<c;h+=4)if(255!==u[p+h]){g=!0;break}if(g)break;p+=c}for(i.ascent=a-l,p=d-c,g=!1,l=s;l>a;l--){for(h=0;h<c;h+=4)if(255!==u[p+h]){g=!0;break}if(g)break;p-=c}i.descent=l-a,i.descent+=6,i.fontSize=i.ascent+i.descent,e.Text.fontPropertiesCache[t]=i}return i},e.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var r=this.style.wordWrapWidth,o=i[n].split(" "),a=0;a<o.length;a++){var s=this.context.measureText(o[a]).width,l=s+this.context.measureText(" ").width;0===a||l>r?(a>0&&(e+="\n"),e+=o[a],r=this.style.wordWrapWidth-s):(r-=l,e+=" "+o[a])}n<i.length-1&&(e+="\n")}return e},e.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),e.Sprite.prototype.getBounds.call(this,t)},e.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t||t)},e.Text.fontPropertiesCache={},e.Text.fontPropertiesCanvas=document.createElement("canvas"),e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d"),e.BitmapText=function(t,i){e.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(t),this.setStyle(i),this.updateText(),this.dirty=!1},e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype),e.BitmapText.prototype.constructor=e.BitmapText,e.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},e.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):e.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=t.tint},e.BitmapText.prototype.updateText=function(){
for(var t=e.BitmapText.fonts[this.fontName],i=new e.Point,n=null,r=[],o=0,a=[],s=0,l=this.fontSize/t.size,h=0;h<this.text.length;h++){var u=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h)))a.push(i.x),o=Math.max(o,i.x),s++,i.x=0,i.y+=t.lineHeight,n=null;else{var d=t.chars[u];d&&(n&&d.kerning[n]&&(i.x+=d.kerning[n]),r.push({texture:d.texture,line:s,charCode:u,position:new e.Point(i.x+d.xOffset,i.y+d.yOffset)}),i.x+=d.xAdvance,n=u)}}a.push(i.x),o=Math.max(o,i.x);var c=[];for(h=0;h<=s;h++){var p=0;"right"===this.style.align?p=o-a[h]:"center"===this.style.align&&(p=(o-a[h])/2),c.push(p)}var g=this.children.length,f=r.length,y=this.tint||16777215;for(h=0;h<f;h++){var m=h<g?this.children[h]:this._pool.pop();m?m.setTexture(r[h].texture):m=new e.Sprite(r[h].texture),m.position.x=(r[h].position.x+c[r[h].line])*l,m.position.y=r[h].position.y*l,m.scale.x=m.scale.y=l,m.tint=y,m.parent||this.addChild(m)}for(;this.children.length>f;){var C=this.getChildAt(this.children.length-1);this._pool.push(C),this.removeChild(C)}this.textWidth=o*l,this.textHeight=(i.y+t.lineHeight)*l},e.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),e.DisplayObjectContainer.prototype.updateTransform.call(this)},e.BitmapText.fonts={},e.InteractionData=function(){this.global=new e.Point,this.target=null,this.originalEvent=null},e.InteractionData.prototype.getLocalPosition=function(t,i,n){var r=t.worldTransform,o=n||this.global,a=r.a,s=r.c,l=r.tx,h=r.b,u=r.d,d=r.ty,c=1/(a*u+s*-h);return i=i||new e.Point,i.x=u*c*o.x+-s*c*o.y+(d*s-l*u)*c,i.y=a*c*o.y+-h*c*o.x+(-d*a+l*h)*c,i},e.InteractionData.prototype.constructor=e.InteractionData,e.InteractionManager=function(t){this.stage=t,this.mouse=new e.InteractionData,this.touches={},this.tempPoint=new e.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new e.Point},e.InteractionManager.prototype.constructor=e.InteractionManager,e.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,n=i.length,r=n-1;r>=0;r--){var o=i[r];o._interactive?(e.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,e))}},e.InteractionManager.prototype.setTarget=function(t){this.target=t,this.resolution=t.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(t.view)},e.InteractionManager.prototype.setTargetDomElement=function(t){this.removeEvents(),window.navigator.msPointerEnabled&&(t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none"),this.interactionDOMElement=t,t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseout",this.onMouseOut,!0),t.addEventListener("touchstart",this.onTouchStart,!0),t.addEventListener("touchend",this.onTouchEnd,!0),t.addEventListener("touchleave",this.onTouchCancel,!0),t.addEventListener("touchcancel",this.onTouchCancel,!0),t.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},e.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchleave",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},e.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),i=t-this.last;if(!((i=i*e.INTERACTION_FREQUENCY/1e3)<1)){this.last=t;var n=0;this.dirty&&this.rebuildInteractiveGraph();var r=this.interactiveItems.length,o="inherit",a=!1;for(n=0;n<r;n++){var s=this.interactiveItems[n];s.__hit=this.hitTest(s,this.mouse),this.mouse.target=s,s.__hit&&!a?(s.buttonMode&&(o=s.defaultCursor),s.interactiveChildren||(a=!0),s.__isOver||(s.mouseover&&s.mouseover(this.mouse),s.__isOver=!0)):s.__isOver&&(s.mouseout&&s.mouseout(this.mouse),s.__isOver=!1)}this.currentCursorStyle!==o&&(this.currentCursorStyle=o,this.interactionDOMElement.style.cursor=o)}}},e.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,e=0;e<t;e++)this.interactiveItems[e].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},e.InteractionManager.prototype.onMouseMove=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width)/this.resolution,this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height)/this.resolution;for(var i=this.interactiveItems.length,n=0;n<i;n++){var r=this.interactiveItems[n];r.mousemove&&r.mousemove(this.mouse)}},e.InteractionManager.prototype.onMouseDown=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t,e.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var i=this.interactiveItems.length,n=this.mouse.originalEvent,r=2===n.button||3===n.which,o=r?"rightdown":"mousedown",a=r?"rightclick":"click",s=r?"__rightIsDown":"__mouseIsDown",l=r?"__isRightDown":"__isDown",h=0;h<i;h++){var u=this.interactiveItems[h];if((u[o]||u[a])&&(u[s]=!0,u.__hit=this.hitTest(u,this.mouse),u.__hit&&(u[o]&&u[o](this.mouse),u[l]=!0,!u.interactiveChildren)))break}},e.InteractionManager.prototype.onMouseOut=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;var e=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;i<e;i++){var n=this.interactiveItems[i];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},e.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,i=!1,n=this.mouse.originalEvent,r=2===n.button||3===n.which,o=r?"rightup":"mouseup",a=r?"rightclick":"click",s=r?"rightupoutside":"mouseupoutside",l=r?"__isRightDown":"__isDown",h=0;h<e;h++){var u=this.interactiveItems[h];(u[a]||u[o]||u[s])&&(u.__hit=this.hitTest(u,this.mouse),u.__hit&&!i?(u[o]&&u[o](this.mouse),u[l]&&u[a]&&u[a](this.mouse),u.interactiveChildren||(i=!0)):u[l]&&u[s]&&u[s](this.mouse),u[l]=!1)}},e.InteractionManager.prototype.hitTest=function(t,i){var n=i.global;if(!t.worldVisible)return!1;t.worldTransform.applyInverse(n,this._tempPoint);var r,o=this._tempPoint.x,a=this._tempPoint.y;if(i.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(o,a);if(t instanceof e.Sprite){var s,l=t.texture.frame.width,h=t.texture.frame.height,u=-l*t.anchor.x;if(o>u&&o<u+l&&(s=-h*t.anchor.y,a>s&&a<s+h))return!0}else if(t instanceof e.Graphics){var d=t.graphicsData;for(r=0;r<d.length;r++){var c=d[r];if(c.fill&&(c.shape&&c.shape.contains(o,a)))return!0}}var p=t.children.length;for(r=0;r<p;r++){var g=t.children[r];if(this.hitTest(g,i))return i.target=t,!0}return!1},e.InteractionManager.prototype.onTouchMove=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i,n=this.interactionDOMElement.getBoundingClientRect(),r=t.changedTouches,o=r.length,a=this.target.width/n.width,s=this.target.height/n.height,l=navigator.isCocoonJS&&!n.left&&!n.top&&!t.target.style.width&&!t.target.style.height,h=0;h<o;h++)i=r[h],l?(i.globalX=i.clientX,i.globalY=i.clientY):(i.globalX=(i.clientX-n.left)*a/this.resolution,i.globalY=(i.clientY-n.top)*s/this.resolution);for(var u=0;u<o;u++){i=r[u],e=this.touches[i.identifier],e.originalEvent=t,l?(e.global.x=i.clientX,e.global.y=i.clientY):(i.globalX=e.global.x=(i.clientX-n.left)*a/this.resolution,i.globalY=e.global.y=(i.clientY-n.top)*s/this.resolution);for(var d=0;d<this.interactiveItems.length;d++){var c=this.interactiveItems[d];c.touchmove&&c.__touchData&&c.__touchData[i.identifier]&&c.touchmove(e)}}},e.InteractionManager.prototype.onTouchStart=function(t){this.dirty&&this.rebuildInteractiveGraph();var i=this.interactionDOMElement.getBoundingClientRect();e.AUTO_PREVENT_DEFAULT&&t.preventDefault();for(var n,r=t.changedTouches,o=r.length,a=this.target.width/i.width,s=this.target.height/i.height,l=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,h=0;h<o;h++)n=r[h],l?(n.globalX=n.clientX,n.globalY=n.clientY):(n.globalX=(n.clientX-i.left)*a/this.resolution,n.globalY=(n.clientY-i.top)*s/this.resolution);for(var u=0;u<o;u++){n=r[u];var d=this.pool.pop();d||(d=new e.InteractionData),d.originalEvent=t,this.touches[n.identifier]=d,l?(d.global.x=n.clientX,d.global.y=n.clientY):(d.global.x=(n.clientX-i.left)*a/this.resolution,d.global.y=(n.clientY-i.top)*s/this.resolution);for(var c=this.interactiveItems.length,p=0;p<c;p++){var g=this.interactiveItems[p];if((g.touchstart||g.tap)&&(g.__hit=this.hitTest(g,d),g.__hit&&(g.touchstart&&g.touchstart(d),g.__isDown=!0,g.__touchData=g.__touchData||{},g.__touchData[n.identifier]=d,!g.interactiveChildren)))break}}},e.InteractionManager.prototype.onTouchEnd=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,o=this.target.width/i.width,a=this.target.height/i.height,s=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=n[l],s?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*o/this.resolution,e.globalY=(e.clientY-i.top)*a/this.resolution);for(var h=0;h<r;h++){e=n[h];var u=this.touches[e.identifier],d=!1;s?(u.global.x=e.clientX,u.global.y=e.clientY):(u.global.x=(e.clientX-i.left)*o/this.resolution,u.global.y=(e.clientY-i.top)*a/this.resolution);for(var c=this.interactiveItems.length,p=0;p<c;p++){var g=this.interactiveItems[p];g.__touchData&&g.__touchData[e.identifier]&&(g.__hit=this.hitTest(g,g.__touchData[e.identifier]),u.originalEvent=t,(g.touchend||g.tap)&&(g.__hit&&!d?(g.touchend&&g.touchend(u),g.__isDown&&g.tap&&g.tap(u),g.interactiveChildren||(d=!0)):g.__isDown&&g.touchendoutside&&g.touchendoutside(u),g.__isDown=!1),g.__touchData[e.identifier]=null)}this.pool.push(u),this.touches[e.identifier]=null}},e.InteractionManager.prototype.onTouchCancel=function(t){this.dirty&&this.rebuildInteractiveGraph();for(var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=n.length,o=this.target.width/i.width,a=this.target.height/i.height,s=navigator.isCocoonJS&&!i.left&&!i.top&&!t.target.style.width&&!t.target.style.height,l=0;l<r;l++)e=n[l],s?(e.globalX=e.clientX,e.globalY=e.clientY):(e.globalX=(e.clientX-i.left)*o/this.resolution,e.globalY=(e.clientY-i.top)*a/this.resolution);for(var h=0;h<r;h++){e=n[h];var u=this.touches[e.identifier],d=!1;s?(u.global.x=e.clientX,u.global.y=e.clientY):(u.global.x=(e.clientX-i.left)*o/this.resolution,u.global.y=(e.clientY-i.top)*a/this.resolution);for(var c=this.interactiveItems.length,p=0;p<c;p++){var g=this.interactiveItems[p];g.__touchData&&g.__touchData[e.identifier]&&(g.__hit=this.hitTest(g,g.__touchData[e.identifier]),u.originalEvent=t,g.touchcancel&&!d&&(g.touchcancel(u),g.interactiveChildren||(d=!0)),g.__isDown=!1,g.__touchData[e.identifier]=null)}this.pool.push(u),this.touches[e.identifier]=null}},e.Stage=function(t){e.DisplayObjectContainer.call(this),this.worldTransform=new e.Matrix,this.interactive=!0,this.interactionManager=new e.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new e.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t)},e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Stage.prototype.constructor=e.Stage,e.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},e.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),o=t.setTimeout(function(){i(n+r)},r);return e=n+r,o}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),e.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(t){function e(){for(var n=arguments.length,o=new Array(n);n--;)o[n]=arguments[n];return o=r.concat(o),i.apply(this instanceof e?this:t,o)}var i=this,n=arguments.length-1,r=[];if(n>0)for(r.length=n;n--;)r[n]=arguments[n+1];if("function"!=typeof i)throw new TypeError;return e.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(i.prototype),e}}()),e.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return!!window.XMLHttpRequest&&new window.XMLHttpRequest;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(t){}},e.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},e.getNextPowerOfTwo=function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},e.isPowerOfTwo=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},e.EventTarget={call:function(t){t&&(t=t.prototype||t,e.EventTarget.mixin(t))},mixin:function(t){t.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},t.emit=t.dispatchEvent=function(t,i){if(this._listeners=this._listeners||{},"object"==typeof t&&(i=t,t=t.type),i&&!0===i.__isEventObject||(i=new e.Event(this,t,i)),this._listeners&&this._listeners[t]){var n,r=this._listeners[t].slice(0),o=r.length,a=r[0];for(n=0;n<o;a=r[++n])if(a.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i),this},t.on=t.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},t.once=function(t,e){function i(){e.apply(n.off(t,i),arguments)}this._listeners=this._listeners||{};var n=this;return i._originalHandler=e,this.on(t,i)},t.off=t.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var i=this._listeners[t],n=e?i.length:0;n-- >0;)i[n]!==e&&i[n]._originalHandler!==e||i.splice(n,1);return 0===i.length&&delete this._listeners[t],this},t.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},e.Event=function(t,e,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=i,this.content=i,this.timeStamp=Date.now()},e.Event.prototype.stopPropagation=function(){this.stopped=!0},e.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},e.autoDetectRenderer=function(t,i,n){return t||(t=800),i||(i=600),function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}()?new e.WebGLRenderer(t,i,n):new e.CanvasRenderer(t,i,n)},e.autoDetectRecommendedRenderer=function(t,i,n){t||(t=800),i||(i=600);var r=function(){try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),o=/Android/i.test(navigator.userAgent);return r&&!o?new e.WebGLRenderer(t,i,n):new e.CanvasRenderer(t,i,n)},e.PolyK={};e.PolyK.Triangulate=function(t){var i=!0,n=t.length>>1;if(n<3)return[];for(var r=[],o=[],a=0;a<n;a++)o.push(a);a=0;for(var s=n;s>3;){var l=o[(a+0)%s],h=o[(a+1)%s],u=o[(a+2)%s],d=t[2*l],c=t[2*l+1],p=t[2*h],g=t[2*h+1],f=t[2*u],y=t[2*u+1],m=!1;if(e.PolyK._convex(d,c,p,g,f,y,i)){m=!0;for(var C=0;C<s;C++){var S=o[C];if(S!==l&&S!==h&&S!==u&&e.PolyK._PointInTriangle(t[2*S],t[2*S+1],d,c,p,g,f,y)){m=!1;break}}}if(m)r.push(l,h,u),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!i)return null;for(r=[],o=[],a=0;a<n;a++)o.push(a);a=0,s=n,i=!1}}return r.push(o[0],o[1],o[2]),r},e.PolyK._PointInTriangle=function(t,e,i,n,r,o,a,s){var l=a-i,h=s-n,u=r-i,d=o-n,c=t-i,p=e-n,g=l*l+h*h,f=l*u+h*d,y=l*c+h*p,m=u*u+d*d,C=u*c+d*p,S=1/(g*m-f*f),b=(m*y-f*C)*S,v=(g*C-f*y)*S;return b>=0&&v>=0&&b+v<1},e.PolyK._convex=function(t,e,i,n,r,o,a){return(e-n)*(r-i)+(i-t)*(o-n)>=0===a},e.initDefaultShaders=function(){},e.CompileVertexShader=function(t,i){return e._CompileShader(t,i,t.VERTEX_SHADER)},e.CompileFragmentShader=function(t,i){return e._CompileShader(t,i,t.FRAGMENT_SHADER)},e._CompileShader=function(t,e,i){var n=e.join("\n"),r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(window.console.log(t.getShaderInfoLog(r)),null)},e.compileProgram=function(t,i,n){var r=e.CompileFragmentShader(t,n),o=e.CompileVertexShader(t,i),a=t.createProgram();return t.attachShader(a,o),t.attachShader(a,r),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),a},e.PixiShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},e.PixiShader.prototype.constructor=e.PixiShader,e.PixiShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var n in this.uniforms)this.uniforms[n].uniformLocation=t.getUniformLocation(i,n);this.initUniforms(),this.program=i},e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];var n=t.type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=e.uniformMatrix2fv:"mat3"===n?t.glFunc=e.uniformMatrix3fv:"mat4"===n&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)}},e.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,n=i.magFilter?i.magFilter:e.LINEAR,r=i.minFilter?i.minFilter:e.LINEAR,o=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,a=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,s=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(o=e.REPEAT,a=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var l=i.width?i.width:512,h=i.height?i.height:2,u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,s,l,h,u,s,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,s,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var n in this.uniforms)t=this.uniforms[n],1===t.glValueLength?!0===t.glMatrix?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?e.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],e.PixiFastShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},e.PixiFastShader.prototype.constructor=e.PixiFastShader,e.PixiFastShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.StripShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},e.StripShader.prototype.constructor=e.StripShader,e.StripShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.PrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},e.PrimitiveShader.prototype.constructor=e.PrimitiveShader,e.PrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.ComplexPrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader,e.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.WebGLGraphics=function(){},e.WebGLGraphics.renderGraphics=function(t,i){var n,r=i.gl,o=i.projection,a=i.offset,s=i.shaderManager.primitiveShader;t.dirty&&e.WebGLGraphics.updateGraphics(t,r);for(var l=t._webGL[r.id],h=0;h<l.data.length;h++)1===l.data[h].mode?(n=l.data[h],i.stencilManager.pushStencil(t,n,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(n.indices.length-4)),i.stencilManager.popStencil(t,n,i)):(n=l.data[h],i.shaderManager.setShader(s),s=i.shaderManager.primitiveShader,r.uniformMatrix3fv(s.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(s.flipY,1),r.uniform2f(s.projectionVector,o.x,-o.y),r.uniform2f(s.offsetVector,-a.x,-a.y),r.uniform3fv(s.tintColor,e.hex2rgb(t.tint)),r.uniform1f(s.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,n.buffer),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(s.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,n.indices.length,r.UNSIGNED_SHORT,0))},e.WebGLGraphics.updateGraphics=function(t,i){var n=t._webGL[i.id];n||(n=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1;var r;if(t.clearDirty){for(t.clearDirty=!1,r=0;r<n.data.length;r++){var o=n.data[r];o.reset(),e.WebGLGraphics.graphicsDataPool.push(o)}n.data=[],n.lastIndex=0}var a;for(r=n.lastIndex;r<t.graphicsData.length;r++){var s=t.graphicsData[r];if(s.type===e.Graphics.POLY){
if(s.points=s.shape.points.slice(),s.shape.closed&&(s.points[0]===s.points[s.points.length-2]&&s.points[1]===s.points[s.points.length-1]||s.points.push(s.points[0],s.points[1])),s.fill&&s.points.length>=6)if(s.points.length<12){a=e.WebGLGraphics.switchMode(n,0);var l=e.WebGLGraphics.buildPoly(s,a);l||(a=e.WebGLGraphics.switchMode(n,1),e.WebGLGraphics.buildComplexPoly(s,a))}else a=e.WebGLGraphics.switchMode(n,1),e.WebGLGraphics.buildComplexPoly(s,a);s.lineWidth>0&&(a=e.WebGLGraphics.switchMode(n,0),e.WebGLGraphics.buildLine(s,a))}else a=e.WebGLGraphics.switchMode(n,0),s.type===e.Graphics.RECT?e.WebGLGraphics.buildRectangle(s,a):s.type===e.Graphics.CIRC||s.type===e.Graphics.ELIP?e.WebGLGraphics.buildCircle(s,a):s.type===e.Graphics.RREC&&e.WebGLGraphics.buildRoundedRectangle(s,a);n.lastIndex++}for(r=0;r<n.data.length;r++)a=n.data[r],a.dirty&&a.upload()},e.WebGLGraphics.switchMode=function(t,i){var n;return t.data.length?(n=t.data[t.data.length-1],n.mode===i&&1!==i||(n=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),n.mode=i,t.data.push(n))):(n=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),n.mode=i,t.data.push(n)),n.dirty=!0,n},e.WebGLGraphics.buildRectangle=function(t,i){var n=t.shape,r=n.x,o=n.y,a=n.width,s=n.height;if(t.fill){var l=e.hex2rgb(t.fillColor),h=t.fillAlpha,u=l[0]*h,d=l[1]*h,c=l[2]*h,p=i.points,g=i.indices,f=p.length/6;p.push(r,o),p.push(u,d,c,h),p.push(r+a,o),p.push(u,d,c,h),p.push(r,o+s),p.push(u,d,c,h),p.push(r+a,o+s),p.push(u,d,c,h),g.push(f,f,f+1,f+2,f+3,f+3)}if(t.lineWidth){var y=t.points;t.points=[r,o,r+a,o,r+a,o+s,r,o+s,r,o],e.WebGLGraphics.buildLine(t,i),t.points=y}},e.WebGLGraphics.buildRoundedRectangle=function(t,i){var n=t.shape,r=n.x,o=n.y,a=n.width,s=n.height,l=n.radius,h=[];if(h.push(r,o+l),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(r,o+s-l,r,o+s,r+l,o+s)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(r+a-l,o+s,r+a,o+s,r+a,o+s-l)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(r+a,o+l,r+a,o,r+a-l,o)),h=h.concat(e.WebGLGraphics.quadraticBezierCurve(r+l,o,r,o,r,o+l)),t.fill){var u=e.hex2rgb(t.fillColor),d=t.fillAlpha,c=u[0]*d,p=u[1]*d,g=u[2]*d,f=i.points,y=i.indices,m=f.length/6,C=e.PolyK.Triangulate(h),S=0;for(S=0;S<C.length;S+=3)y.push(C[S]+m),y.push(C[S]+m),y.push(C[S+1]+m),y.push(C[S+2]+m),y.push(C[S+2]+m);for(S=0;S<h.length;S++)f.push(h[S],h[++S],c,p,g,d)}if(t.lineWidth){var b=t.points;t.points=h,e.WebGLGraphics.buildLine(t,i),t.points=b}},e.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,r,o){function a(t,e,i){return t+(e-t)*i}for(var s,l,h,u,d,c,p=[],g=0,f=0;f<=20;f++)g=f/20,s=a(t,i,g),l=a(e,n,g),h=a(i,r,g),u=a(n,o,g),d=a(s,h,g),c=a(l,u,g),p.push(d,c);return p},e.WebGLGraphics.buildCircle=function(t,i){var n,r,o=t.shape,a=o.x,s=o.y;t.type===e.Graphics.CIRC?(n=o.radius,r=o.radius):(n=o.width,r=o.height);var l=2*Math.PI/40,h=0;if(t.fill){var u=e.hex2rgb(t.fillColor),d=t.fillAlpha,c=u[0]*d,p=u[1]*d,g=u[2]*d,f=i.points,y=i.indices,m=f.length/6;for(y.push(m),h=0;h<41;h++)f.push(a,s,c,p,g,d),f.push(a+Math.sin(l*h)*n,s+Math.cos(l*h)*r,c,p,g,d),y.push(m++,m++);y.push(m-1)}if(t.lineWidth){var C=t.points;for(t.points=[],h=0;h<41;h++)t.points.push(a+Math.sin(l*h)*n,s+Math.cos(l*h)*r);e.WebGLGraphics.buildLine(t,i),t.points=C}},e.WebGLGraphics.buildLine=function(t,i){var n=0,r=t.points;if(0!==r.length){if(t.lineWidth%2)for(n=0;n<r.length;n++)r[n]+=.5;var o=new e.Point(r[0],r[1]),a=new e.Point(r[r.length-2],r[r.length-1]);if(o.x===a.x&&o.y===a.y){r=r.slice(),r.pop(),r.pop(),a=new e.Point(r[r.length-2],r[r.length-1]);var s=a.x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);r.unshift(s,l),r.push(s,l)}var h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_,P,A,k,D,F,E=i.points,I=i.indices,G=r.length/2,O=r.length,B=E.length/6,L=t.lineWidth/2,R=e.hex2rgb(t.lineColor),N=t.lineAlpha,U=R[0]*N,V=R[1]*N,H=R[2]*N;for(d=r[0],c=r[1],p=r[2],g=r[3],m=-(c-g),C=d-p,F=Math.sqrt(m*m+C*C),m/=F,C/=F,m*=L,C*=L,E.push(d-m,c-C,U,V,H,N),E.push(d+m,c+C,U,V,H,N),n=1;n<G-1;n++)d=r[2*(n-1)],c=r[2*(n-1)+1],p=r[2*n],g=r[2*n+1],f=r[2*(n+1)],y=r[2*(n+1)+1],m=-(c-g),C=d-p,F=Math.sqrt(m*m+C*C),m/=F,C/=F,m*=L,C*=L,S=-(g-y),b=p-f,F=Math.sqrt(S*S+b*b),S/=F,b/=F,S*=L,b*=L,x=-C+c-(-C+g),T=-m+p-(-m+d),M=(-m+d)*(-C+g)-(-m+p)*(-C+c),_=-b+y-(-b+g),P=-S+p-(-S+f),A=(-S+f)*(-b+g)-(-S+p)*(-b+y),k=x*P-_*T,Math.abs(k)<.1?(k+=10.1,E.push(p-m,g-C,U,V,H,N),E.push(p+m,g+C,U,V,H,N)):(h=(T*A-P*M)/k,u=(_*M-x*A)/k,D=(h-p)*(h-p)+(u-g)+(u-g),D>19600?(v=m-S,w=C-b,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,E.push(p-v,g-w),E.push(U,V,H,N),E.push(p+v,g+w),E.push(U,V,H,N),E.push(p-v,g-w),E.push(U,V,H,N),O++):(E.push(h,u),E.push(U,V,H,N),E.push(p-(h-p),g-(u-g)),E.push(U,V,H,N)));for(d=r[2*(G-2)],c=r[2*(G-2)+1],p=r[2*(G-1)],g=r[2*(G-1)+1],m=-(c-g),C=d-p,F=Math.sqrt(m*m+C*C),m/=F,C/=F,m*=L,C*=L,E.push(p-m,g-C),E.push(U,V,H,N),E.push(p+m,g+C),E.push(U,V,H,N),I.push(B),n=0;n<O;n++)I.push(B++);I.push(B-1)}},e.WebGLGraphics.buildComplexPoly=function(t,i){var n=t.points.slice();if(!(n.length<6)){var r=i.indices;i.points=n,i.alpha=t.fillAlpha,i.color=e.hex2rgb(t.fillColor);for(var o,a,s=1/0,l=-1/0,h=1/0,u=-1/0,d=0;d<n.length;d+=2)o=n[d],a=n[d+1],s=o<s?o:s,l=o>l?o:l,h=a<h?a:h,u=a>u?a:u;n.push(s,h,l,h,l,u,s,u);var c=n.length/2;for(d=0;d<c;d++)r.push(d)}},e.WebGLGraphics.buildPoly=function(t,i){var n=t.points;if(!(n.length<6)){var r=i.points,o=i.indices,a=n.length/2,s=e.hex2rgb(t.fillColor),l=t.fillAlpha,h=s[0]*l,u=s[1]*l,d=s[2]*l,c=e.PolyK.Triangulate(n);if(!c)return!1;var p=r.length/6,g=0;for(g=0;g<c.length;g+=3)o.push(c[g]+p),o.push(c[g]+p),o.push(c[g+1]+p),o.push(c[g+2]+p),o.push(c[g+2]+p);for(g=0;g<a;g++)r.push(n[2*g],n[2*g+1],h,u,d,l);return!0}},e.WebGLGraphics.graphicsDataPool=[],e.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},e.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},e.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new e.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new e.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},e.glContexts=[],e.instances=[],e.WebGLRenderer=function(t,i,n){if(n)for(var r in e.defaultRenderOptions)void 0===n[r]&&(n[r]=e.defaultRenderOptions[r]);else n=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("webGL"),e.defaultRenderer=this),this.type=e.WEBGL_RENDERER,this.resolution=n.resolution,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this.width=t||800,this.height=i||600,this.view=n.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.projection=new e.Point,this.offset=new e.Point(0,0),this.shaderManager=new e.WebGLShaderManager,this.spriteBatch=new e.WebGLSpriteBatch,this.maskManager=new e.WebGLMaskManager,this.filterManager=new e.WebGLFilterManager,this.stencilManager=new e.WebGLStencilManager,this.blendModeManager=new e.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},e.WebGLRenderer.prototype.constructor=e.WebGLRenderer,e.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=e.WebGLRenderer.glContextId++,e.glContexts[this.glContextId]=t,e.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},e.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},e.WebGLRenderer.prototype.renderDisplayObject=function(t,i,n){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=n?-1:1,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,n),t._renderWebGL(this.renderSession),this.spriteBatch.end()},e.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},e.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&e.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}},e.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},e.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var t in e.TextureCache){e.TextureCache[t].baseTexture._glTextures=[]}this.contextLost=!1},e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),e.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},e.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;e.blendModesWebGL||(e.blendModesWebGL=[],e.blendModesWebGL[e.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],e.blendModesWebGL[e.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],e.blendModesWebGL[e.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])},e.WebGLRenderer.glContextId=0,e.WebGLBlendModeManager=function(){this.currentBlendMode=99999},e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager,e.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},e.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=e.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},e.WebGLMaskManager=function(){},e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager,e.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},e.WebGLMaskManager.prototype.pushMask=function(t,i){var n=i.gl;t.dirty&&e.WebGLGraphics.updateGraphics(t,n),t._webGL[n.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[n.id].data[0],i)},e.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},e.WebGLMaskManager.prototype.destroy=function(){this.gl=null},e.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},e.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},e.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var r=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(r+1),255):n.stencilFunc(n.EQUAL,r+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r+1,255):n.stencilFunc(n.EQUAL,255-(r+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},e.WebGLStencilManager.prototype.bindGraphics=function(t,i,n){this._currentGraphics=t;var r,o=this.gl,a=n.projection,s=n.offset;1===i.mode?(r=n.shaderManager.complexPrimitiveShader,n.shaderManager.setShader(r),o.uniform1f(r.flipY,n.flipY),o.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),o.uniform2f(r.projectionVector,a.x,-a.y),o.uniform2f(r.offsetVector,-s.x,-s.y),o.uniform3fv(r.tintColor,e.hex2rgb(t.tint)),o.uniform3fv(r.color,i.color),o.uniform1f(r.alpha,t.worldAlpha*i.alpha),o.bindBuffer(o.ARRAY_BUFFER,i.buffer),o.vertexAttribPointer(r.aVertexPosition,2,o.FLOAT,!1,8,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(r=n.shaderManager.primitiveShader,n.shaderManager.setShader(r),o.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),o.uniform1f(r.flipY,n.flipY),o.uniform2f(r.projectionVector,a.x,-a.y),o.uniform2f(r.offsetVector,-s.x,-s.y),o.uniform3fv(r.tintColor,e.hex2rgb(t.tint)),o.uniform1f(r.alpha,t.worldAlpha),o.bindBuffer(o.ARRAY_BUFFER,i.buffer),o.vertexAttribPointer(r.aVertexPosition,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(r.colorAttribute,4,o.FLOAT,!1,24,8),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},e.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)n.disable(n.STENCIL_TEST);else{var r=this.count;this.bindGraphics(t,e,i),n.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)):(this.reverse?(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},e.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager,e.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new e.PrimitiveShader(t),this.complexPrimitiveShader=new e.ComplexPrimitiveShader(t),this.defaultShader=new e.PixiShader(t),this.fastShader=new e.PixiFastShader(t),this.stripShader=new e.StripShader(t),this.setShader(this.defaultShader)},e.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},e.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},e.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new e.ArrayBuffer(t),this.positions=new e.Float32Array(this.vertices),this.colors=new e.Uint32Array(this.vertices),this.indices=new e.Uint16Array(i),this.lastIndexCount=0;for(var n=0,r=0;n<i;n+=6,r+=4)this.indices[n+0]=r+0,this.indices[n+1]=r+1,this.indices[n+2]=r+2,this.indices[n+3]=r+0,this.indices[n+4]=r+2,this.indices[n+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},e.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new e.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},e.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},e.WebGLSpriteBatch.prototype.end=function(){this.flush()},e.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var n,r,o,a,s=t.anchor.x,l=t.anchor.y;if(e.trim){var h=e.trim;r=h.x-s*h.width,n=r+e.crop.width,a=h.y-l*h.height,o=a+e.crop.height}else n=e.frame.width*(1-s),r=e.frame.width*-s,o=e.frame.height*(1-l),a=e.frame.height*-l;var u=4*this.currentBatchSize*this.vertSize,d=e.baseTexture.resolution,c=t.worldTransform,p=c.a/d,g=c.b/d,f=c.c/d,y=c.d/d,m=c.tx,C=c.ty,S=this.colors,b=this.positions;this.renderSession.roundPixels?(b[u]=p*r+f*a+m|0,b[u+1]=y*a+g*r+C|0,b[u+5]=p*n+f*a+m|0,b[u+6]=y*a+g*n+C|0,b[u+10]=p*n+f*o+m|0,b[u+11]=y*o+g*n+C|0,b[u+15]=p*r+f*o+m|0,b[u+16]=y*o+g*r+C|0):(b[u]=p*r+f*a+m,b[u+1]=y*a+g*r+C,b[u+5]=p*n+f*a+m,b[u+6]=y*a+g*n+C,b[u+10]=p*n+f*o+m,b[u+11]=y*o+g*n+C,b[u+15]=p*r+f*o+m,b[u+16]=y*o+g*r+C),b[u+2]=i.x0,b[u+3]=i.y0,b[u+7]=i.x1,b[u+8]=i.y1,b[u+12]=i.x2,b[u+13]=i.y2,b[u+17]=i.x3,b[u+18]=i.y3;var v=t.tint;S[u+4]=S[u+9]=S[u+14]=S[u+19]=(v>>16)+(65280&v)+((255&v)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},e.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var i=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),t._uvs||(t._uvs=new e.TextureUvs);var n=t._uvs;t.tilePosition.x%=i.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=i.baseTexture.height*t.tileScaleOffset.y;var r=t.tilePosition.x/(i.baseTexture.width*t.tileScaleOffset.x),o=t.tilePosition.y/(i.baseTexture.height*t.tileScaleOffset.y),a=t.width/i.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),s=t.height/i.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);n.x0=0-r,n.y0=0-o,n.x1=1*a-r,n.y1=0-o,n.x2=1*a-r,n.y2=1*s-o,n.x3=0-r,n.y3=1*s-o;var l=t.tint,h=(l>>16)+(65280&l)+((255&l)<<16)+(255*t.alpha<<24),u=this.positions,d=this.colors,c=t.width,p=t.height,g=t.anchor.x,f=t.anchor.y,y=c*(1-g),m=c*-g,C=p*(1-f),S=p*-f,b=4*this.currentBatchSize*this.vertSize,v=i.baseTexture.resolution,w=t.worldTransform,x=w.a/v,T=w.b/v,M=w.c/v,_=w.d/v,P=w.tx,A=w.ty;u[b++]=x*m+M*S+P,u[b++]=_*S+T*m+A,u[b++]=n.x0,u[b++]=n.y0,d[b++]=h,u[b++]=x*y+M*S+P,u[b++]=_*S+T*y+A,u[b++]=n.x1,u[b++]=n.y1,d[b++]=h,u[b++]=x*y+M*C+P,u[b++]=_*C+T*y+A,u[b++]=n.x2,u[b++]=n.y2,d[b++]=h,u[b++]=x*m+M*C+P,u[b++]=_*C+T*m+A,u[b++]=n.x3,u[b++]=n.y3,d[b++]=h,this.sprites[this.currentBatchSize++]=t},e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i=this.gl;if(this.dirty){this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id];var n=4*this.vertSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,n,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,n,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,n,16)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{var r=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);i.bufferSubData(i.ARRAY_BUFFER,0,r)}for(var o,a,s,l,h=0,u=0,d=null,c=this.renderSession.blendModeManager.currentBlendMode,p=null,g=!1,f=!1,y=0,m=this.currentBatchSize;y<m;y++){if(l=this.sprites[y],o=l.texture.baseTexture,a=l.blendMode,s=l.shader||this.defaultShader,g=c!==a,f=p!==s,(d!==o||g||f)&&(this.renderBatch(d,h,u),u=y,h=0,d=o,g&&(c=a,this.renderSession.blendModeManager.setBlendMode(c)),f)){p=s,t=p.shaders[i.id],t||(t=new e.PixiShader(i),t.fragmentSrc=p.fragmentSrc,t.uniforms=p.uniforms,t.init(),p.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var C=this.renderSession.projection;i.uniform2f(t.projectionVector,C.x,C.y);var S=this.renderSession.offset;i.uniform2f(t.offsetVector,S.x,S.y)}h++}this.renderBatch(d,h,u),this.currentBatchSize=0}},e.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;t._dirty[n.id]?this.renderSession.renderer.updateTexture(t):n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]),n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},e.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},e.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var i=4*this.size*this.vertSize,n=6*this.maxSize;this.vertices=new e.Float32Array(i),this.indices=new e.Uint16Array(n),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,o=0;r<n;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch,e.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},e.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var n=0,r=e.length;n<r;n++)this.renderSprite(e[n]);this.flush()}},e.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,n,r,o,a,s=this.vertices;if(e=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var l=t.texture.trim;n=l.x-t.anchor.x*l.width,i=n+t.texture.crop.width,o=l.y-t.anchor.y*l.height,r=o+t.texture.crop.height}else i=t.texture.frame.width*(1-t.anchor.x),n=t.texture.frame.width*-t.anchor.x,r=t.texture.frame.height*(1-t.anchor.y),o=t.texture.frame.height*-t.anchor.y;a=4*this.currentBatchSize*this.vertSize,s[a++]=n,s[a++]=o,s[a++]=t.position.x,s[a++]=t.position.y,s[a++]=t.scale.x,s[a++]=t.scale.y,s[a++]=t.rotation,s[a++]=e.x0,s[a++]=e.y1,s[a++]=t.alpha,s[a++]=i,s[a++]=o,s[a++]=t.position.x,s[a++]=t.position.y,s[a++]=t.scale.x,s[a++]=t.scale.y,s[a++]=t.rotation,s[a++]=e.x1,s[a++]=e.y1,s[a++]=t.alpha,s[a++]=i,s[a++]=r,s[a++]=t.position.x,s[a++]=t.position.y,s[a++]=t.scale.x,s[a++]=t.scale.y,s[a++]=t.rotation,s[a++]=e.x2,s[a++]=e.y2,s[a++]=t.alpha,s[a++]=n,s[a++]=r,s[a++]=t.position.x,s[a++]=t.position.y,s[a++]=t.scale.x,s[a++]=t.scale.y,s[a++]=t.rotation,s[a++]=e.x3,s[a++]=e.y3,s[a++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},e.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager,e.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},e.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},e.WebGLFilterManager.prototype.pushFilter=function(t){var i=this.gl,n=this.renderSession.projection,r=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t);var o=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var a=this.texturePool.pop();a?a.resize(this.width,this.height):a=new e.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,a.texture);var s=t._filterArea,l=o.padding;s.x-=l,s.y-=l,s.width+=2*l,s.height+=2*l,s.x<0&&(s.x=0),s.width>this.width&&(s.width=this.width),s.y<0&&(s.y=0),s.height>this.height&&(s.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,a.frameBuffer),i.viewport(0,0,s.width,s.height),n.x=s.width/2,n.y=-s.height/2,r.x=-s.x,r.y=-s.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),t._glFilterTexture=a},e.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),n=i._filterArea,r=i._glFilterTexture,o=this.renderSession.projection,a=this.renderSession.offset;if(i.filterPasses.length>1){t.viewport(0,0,n.width,n.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=n.height,this.vertexArray[2]=n.width,this.vertexArray[3]=n.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=n.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),
t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var s=r,l=this.texturePool.pop();l||(l=new e.FilterTexture(this.gl,this.width,this.height)),l.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,l.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var h=0;h<i.filterPasses.length-1;h++){var u=i.filterPasses[h];t.bindFramebuffer(t.FRAMEBUFFER,l.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s.texture),this.applyFilterPass(u,n,n.width,n.height);var d=s;s=l,l=d}t.enable(t.BLEND),r=s,this.texturePool.push(l)}var c=i.filterPasses[i.filterPasses.length-1];this.offsetX-=n.x,this.offsetY-=n.y;var p=this.width,g=this.height,f=0,y=0,m=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var C=this.filterStack[this.filterStack.length-1];n=C._filterArea,p=n.width,g=n.height,f=n.x,y=n.y,m=C._glFilterTexture.frameBuffer}o.x=p/2,o.y=-g/2,a.x=f,a.y=y,n=i._filterArea;var S=n.x-f,b=n.y-y;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=S,this.vertexArray[1]=b+n.height,this.vertexArray[2]=S+n.width,this.vertexArray[3]=b+n.height,this.vertexArray[4]=S,this.vertexArray[5]=b,this.vertexArray[6]=S+n.width,this.vertexArray[7]=b,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,p*this.renderSession.resolution,g*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,m),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.applyFilterPass(c,n,p,g),this.texturePool.push(r),i._glFilterTexture=null},e.WebGLFilterManager.prototype.applyFilterPass=function(t,i,n,r){var o=this.gl,a=t.shaders[o.id];a||(a=new e.PixiShader(o),a.fragmentSrc=t.fragmentSrc,a.uniforms=t.uniforms,a.init(),t.shaders[o.id]=a),this.renderSession.shaderManager.setShader(a),o.uniform2f(a.projectionVector,n/2,-r/2),o.uniform2f(a.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),a.syncUniforms(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.vertexAttribPointer(a.aVertexPosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.uvBuffer),o.vertexAttribPointer(a.aTextureCoord,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.vertexAttribPointer(a.colorAttribute,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0),this.renderSession.drawCount++},e.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new e.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new e.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},e.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},e.FilterTexture=function(t,i,n,r){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),r=r||e.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,n)},e.FilterTexture.prototype.constructor=e.FilterTexture,e.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},e.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},e.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},e.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},e.CanvasBuffer.prototype.constructor=e.CanvasBuffer,e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},e.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},e.CanvasMaskManager=function(){},e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager,e.CanvasMaskManager.prototype.pushMask=function(t,i){var n=i.context;n.save();var r=t.alpha,o=t.worldTransform,a=i.resolution;n.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),e.CanvasGraphics.renderGraphicsMask(t,n),n.clip(),t.worldAlpha=r},e.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},e.CanvasTinter=function(){},e.CanvasTinter.getTintedTexture=function(t,i){var n=t.texture;i=e.CanvasTinter.roundColor(i);var r="#"+("00000"+(0|i).toString(16)).substr(-6);if(n.tintCache=n.tintCache||{},n.tintCache[r])return n.tintCache[r];var o=e.CanvasTinter.canvas||document.createElement("canvas");if(e.CanvasTinter.tintMethod(n,i,o),e.CanvasTinter.convertTintToImage){var a=new Image;a.src=o.toDataURL(),n.tintCache[r]=a}else n.tintCache[r]=o,e.CanvasTinter.canvas=null;return o},e.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},e.CanvasTinter.tintWithOverlay=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=r.width,i.height=r.height,n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},e.CanvasTinter.tintWithPerPixel=function(t,i,n){var r=n.getContext("2d"),o=t.crop;n.width=o.width,n.height=o.height,r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);for(var a=e.hex2rgb(i),s=a[0],l=a[1],h=a[2],u=r.getImageData(0,0,o.width,o.height),d=u.data,c=0;c<d.length;c+=4)d[c+0]*=s,d[c+1]*=l,d[c+2]*=h;r.putImageData(u,0,0)},e.CanvasTinter.roundColor=function(t){var i=e.CanvasTinter.cacheStepsPerColorChannel,n=e.hex2rgb(t);return n[0]=Math.min(255,n[0]/i*i),n[1]=Math.min(255,n[1]/i*i),n[2]=Math.min(255,n[2]/i*i),e.rgb2hex(n)},e.CanvasTinter.cacheStepsPerColorChannel=8,e.CanvasTinter.convertTintToImage=!1,e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes(),e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel,e.CanvasRenderer=function(t,i,n){if(n)for(var r in e.defaultRenderOptions)void 0===n[r]&&(n[r]=e.defaultRenderOptions[r]);else n=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("Canvas"),e.defaultRenderer=this),this.type=e.CANVAS_RENDERER,this.resolution=n.resolution,this.clearBeforeRender=n.clearBeforeRender,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.width=t||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=n.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new e.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(t,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},e.CanvasRenderer.prototype.constructor=e.CanvasRenderer,e.CanvasRenderer.prototype.render=function(t){t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=e.blendModes.NORMAL,this.context.globalCompositeOperation=e.blendModesCanvas[e.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)))},e.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},e.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},e.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},e.CanvasRenderer.prototype.mapBlendModes=function(){e.blendModesCanvas||(e.blendModesCanvas=[],e.canUseNewCanvasBlendModes()?(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply",e.blendModesCanvas[e.blendModes.SCREEN]="screen",e.blendModesCanvas[e.blendModes.OVERLAY]="overlay",e.blendModesCanvas[e.blendModes.DARKEN]="darken",e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge",e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light",e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference",e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion",e.blendModesCanvas[e.blendModes.HUE]="hue",e.blendModesCanvas[e.blendModes.SATURATION]="saturation",e.blendModesCanvas[e.blendModes.COLOR]="color",e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"):(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over",e.blendModesCanvas[e.blendModes.SCREEN]="source-over",e.blendModesCanvas[e.blendModes.OVERLAY]="source-over",e.blendModesCanvas[e.blendModes.DARKEN]="source-over",e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over",e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over",e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over",e.blendModesCanvas[e.blendModes.HUE]="source-over",e.blendModesCanvas[e.blendModes.SATURATION]="source-over",e.blendModesCanvas[e.blendModes.COLOR]="source-over",e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"))},e.CanvasGraphics=function(){},e.CanvasGraphics.renderGraphics=function(t,i){var n=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var r=0;r<t.graphicsData.length;r++){var o=t.graphicsData[r],a=o.shape,s=o._fillTint,l=o._lineTint;if(i.lineWidth=o.lineWidth,o.type===e.Graphics.POLY){i.beginPath();var h=a.points;i.moveTo(h[0],h[1]);for(var u=1;u<h.length/2;u++)i.lineTo(h[2*u],h[2*u+1]);a.closed&&i.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}else if(o.type===e.Graphics.RECT)(o.fillColor||0===o.fillColor)&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),i.fillRect(a.x,a.y,a.width,a.height)),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.strokeRect(a.x,a.y,a.width,a.height));else if(o.type===e.Graphics.CIRC)i.beginPath(),i.arc(a.x,a.y,a.radius,0,2*Math.PI),i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke());else if(o.type===e.Graphics.ELIP){var d=2*a.width,c=2*a.height,p=a.x-d/2,g=a.y-c/2;i.beginPath();var f=d/2*.5522848,y=c/2*.5522848,m=p+d,C=g+c,S=p+d/2,b=g+c/2;i.moveTo(p,b),i.bezierCurveTo(p,b-y,S-f,g,S,g),i.bezierCurveTo(S+f,g,m,b-y,m,b),i.bezierCurveTo(m,b+y,S+f,C,S,C),i.bezierCurveTo(S-f,C,p,b+y,p,b),i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}else if(o.type===e.Graphics.RREC){var v=a.x,w=a.y,x=a.width,T=a.height,M=a.radius,_=Math.min(x,T)/2|0;M=M>_?_:M,i.beginPath(),i.moveTo(v,w+M),i.lineTo(v,w+T-M),i.quadraticCurveTo(v,w+T,v+M,w+T),i.lineTo(v+x-M,w+T),i.quadraticCurveTo(v+x,w+T,v+x,w+T-M),i.lineTo(v+x,w+M),i.quadraticCurveTo(v+x,w,v+x-M,w),i.lineTo(v+M,w),i.quadraticCurveTo(v,w,v,w+M),i.closePath(),(o.fillColor||0===o.fillColor)&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),i.stroke())}}},e.CanvasGraphics.renderGraphicsMask=function(t,i){var n=t.graphicsData.length;if(0!==n){n>1&&(n=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;r<1;r++){var o=t.graphicsData[r],a=o.shape;if(o.type===e.Graphics.POLY){i.beginPath();var s=a.points;i.moveTo(s[0],s[1]);for(var l=1;l<s.length/2;l++)i.lineTo(s[2*l],s[2*l+1]);s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&i.closePath()}else if(o.type===e.Graphics.RECT)i.beginPath(),i.rect(a.x,a.y,a.width,a.height),i.closePath();else if(o.type===e.Graphics.CIRC)i.beginPath(),i.arc(a.x,a.y,a.radius,0,2*Math.PI),i.closePath();else if(o.type===e.Graphics.ELIP){var h=2*a.width,u=2*a.height,d=a.x-h/2,c=a.y-u/2;i.beginPath();var p=h/2*.5522848,g=u/2*.5522848,f=d+h,y=c+u,m=d+h/2,C=c+u/2;i.moveTo(d,C),i.bezierCurveTo(d,C-g,m-p,c,m,c),i.bezierCurveTo(m+p,c,f,C-g,f,C),i.bezierCurveTo(f,C+g,m+p,y,m,y),i.bezierCurveTo(m-p,y,d,C+g,d,C),i.closePath()}else if(o.type===e.Graphics.RREC){var S=a.points,b=S[0],v=S[1],w=S[2],x=S[3],T=S[4],M=Math.min(w,x)/2|0;T=T>M?M:T,i.beginPath(),i.moveTo(b,v+T),i.lineTo(b,v+x-T),i.quadraticCurveTo(b,v+x,b+T,v+x),i.lineTo(b+w-T,v+x),i.quadraticCurveTo(b+w,v+x,b+w,v+x-T),i.lineTo(b+w,v+T),i.quadraticCurveTo(b+w,v,b+w-T,v),i.lineTo(b+T,v),i.quadraticCurveTo(b,v,b,v+T),i.closePath()}}}},e.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var o=t.graphicsData[r],a=0|o.fillColor,s=0|o.lineColor;o._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255,o._lineTint=((s>>16&255)/255*e*255<<16)+((s>>8&255)/255*i*255<<8)+(255&s)/255*n*255}},e.Graphics=function(){e.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=e.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new e.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Graphics.prototype.constructor=e.Graphics,Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),e.Graphics.prototype.lineStyle=function(t,i,n){if(this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=void 0===n?1:n,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},e.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new e.Polygon([t,i])),this},e.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},e.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,o,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var s=a[a.length-2],l=a[a.length-1],h=0,u=1;u<=20;u++)h=u/20,r=s+(t-s)*h,o=l+(e-l)*h,a.push(r+(t+(i-t)*h-r)*h,o+(e+(n-e)*h-o)*h);return this.dirty=!0,this},e.Graphics.prototype.bezierCurveTo=function(t,e,i,n,r,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var a,s,l,h,u,d=this.currentPath.shape.points,c=d[d.length-2],p=d[d.length-1],g=0,f=1;f<=20;f++)g=f/20,a=1-g,s=a*a,l=s*a,h=g*g,u=h*g,d.push(l*c+3*s*g*t+3*a*h*i+u*r,l*p+3*s*g*e+3*a*h*n+u*o);return this.dirty=!0,this},e.Graphics.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,a=o[o.length-2],s=o[o.length-1],l=s-e,h=a-t,u=n-e,d=i-t,c=Math.abs(l*d-h*u);if(c<1e-8||0===r)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var p=l*l+h*h,g=u*u+d*d,f=l*u+h*d,y=r*Math.sqrt(p)/c,m=r*Math.sqrt(g)/c,C=y*f/p,S=m*f/g,b=y*d+m*h,v=y*u+m*l,w=h*(m+C),x=l*(m+C),T=d*(y+S),M=u*(y+S),_=Math.atan2(x-v,w-b),P=Math.atan2(M-v,T-b);this.arc(b+t,v+e,r,_,P,h*u>d*l)}return this.dirty=!0,this},e.Graphics.prototype.arc=function(t,e,i,n,r,o){if(o=o||!1,n===r)return this;!o&&r<=n?r+=2*Math.PI:o&&n<=r&&(n+=2*Math.PI);var a=o?-1*(n-r):r-n,s=Math.abs(a)/(2*Math.PI)*40;if(0===a)return this;var l=t+Math.cos(n)*i,h=e+Math.sin(n)*i;o&&this.filling?this.moveTo(t,e):this.moveTo(l,h);for(var u=this.currentPath.shape.points,d=a/(2*s),c=2*d,p=Math.cos(d),g=Math.sin(d),f=s-1,y=f%1/f,m=0;m<=f;m++){var C=m+y*m,S=d+n+c*C,b=Math.cos(S),v=-Math.sin(S);u.push((p*b+g*v)*i+t,(p*-v+g*b)*i+e)}return this.dirty=!0,this},e.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.Graphics.prototype.drawRect=function(t,i,n,r){return this.drawShape(new e.Rectangle(t,i,n,r)),this},e.Graphics.prototype.drawRoundedRect=function(t,i,n,r,o){return this.drawShape(new e.RoundedRectangle(t,i,n,r,o)),this},e.Graphics.prototype.drawCircle=function(t,i,n){return this.drawShape(new e.Circle(t,i,n)),this},e.Graphics.prototype.drawEllipse=function(t,i,n,r){return this.drawShape(new e.Ellipse(t,i,n,r)),this},e.Graphics.prototype.drawPolygon=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new e.Polygon(t)),this},e.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},e.Graphics.prototype.generateTexture=function(t,i){t=t||1;var n=this.getBounds(),r=new e.CanvasBuffer(n.width*t,n.height*t),o=e.Texture.fromCanvas(r.canvas,i);return o.baseTexture.resolution=t,r.context.scale(t,t),r.context.translate(-n.x,-n.y),e.CanvasGraphics.renderGraphics(this,r.context),o},e.Graphics.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var i=e.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),e.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var n=0,r=this.children.length;n<r;n++)this.children[n]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},e.Graphics.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var i=t.context,n=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var r=t.resolution;i.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r),e.CanvasGraphics.renderGraphics(this,i);for(var o=0,a=this.children.length;o<a;o++)this.children[o]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.Graphics.prototype.getBounds=function(t){if(this.isMask)return e.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var i=this._localBounds,n=i.x,r=i.width+i.x,o=i.y,a=i.height+i.y,s=t||this.worldTransform,l=s.a,h=s.b,u=s.c,d=s.d,c=s.tx,p=s.ty,g=l*r+u*a+c,f=d*a+h*r+p,y=l*n+u*a+c,m=d*a+h*n+p,C=l*n+u*o+c,S=d*o+h*n+p,b=l*r+u*o+c,v=d*o+h*r+p,w=g,x=f,T=g,M=f;return T=y<T?y:T,T=C<T?C:T,T=b<T?b:T,M=m<M?m:M,M=S<M?S:M,M=v<M?v:M,w=y>w?y:w,w=C>w?C:w,w=b>w?b:w,x=m>x?m:x,x=S>x?S:x,x=v>x?v:x,this._bounds.x=T,this._bounds.width=w-T,this._bounds.y=M,this._bounds.height=x-M,this._bounds},e.Graphics.prototype.updateLocalBounds=function(){var t=1/0,i=-1/0,n=1/0,r=-1/0;if(this.graphicsData.length)for(var o,a,s,l,h,u,d=0;d<this.graphicsData.length;d++){var c=this.graphicsData[d],p=c.type,g=c.lineWidth;if(o=c.shape,p===e.Graphics.RECT||p===e.Graphics.RREC)s=o.x-g/2,l=o.y-g/2,h=o.width+g,u=o.height+g,t=s<t?s:t,i=s+h>i?s+h:i,n=l<n?l:n,r=l+u>r?l+u:r;else if(p===e.Graphics.CIRC)s=o.x,l=o.y,h=o.radius+g/2,u=o.radius+g/2,t=s-h<t?s-h:t,i=s+h>i?s+h:i,n=l-u<n?l-u:n,r=l+u>r?l+u:r;else if(p===e.Graphics.ELIP)s=o.x,l=o.y,h=o.width+g/2,u=o.height+g/2,t=s-h<t?s-h:t,i=s+h>i?s+h:i,n=l-u<n?l-u:n,r=l+u>r?l+u:r;else{a=o.points;for(var f=0;f<a.length;f+=2)s=a[f],l=a[f+1],t=s-g<t?s-g:t,i=s+g>i?s+g:i,n=l-g<n?l-g:n,r=l+g>r?l+g:r}}else t=0,i=0,n=0,r=0;var y=this.boundsPadding;this._localBounds.x=t-y,this._localBounds.width=i-t+2*y,this._localBounds.y=n-y,this._localBounds.height=r-n+2*y},e.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var i=new e.CanvasBuffer(t.width,t.height),n=e.Texture.fromCanvas(i.canvas);this._cachedSprite=new e.Sprite(n),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},e.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},e.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var i=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===e.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i},e.GraphicsData=function(t,e,i,n,r,o,a){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=o,this.shape=a,this.type=a.type},e.Graphics.POLY=0,e.Graphics.RECT=1,e.Graphics.CIRC=2,e.Graphics.ELIP=3,e.Graphics.RREC=4,e.Polygon.prototype.type=e.Graphics.POLY,e.Rectangle.prototype.type=e.Graphics.RECT,e.Circle.prototype.type=e.Graphics.CIRC,e.Ellipse.prototype.type=e.Graphics.ELIP,e.RoundedRectangle.prototype.type=e.Graphics.RREC,e.Strip=function(t){e.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new e.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new e.Float32Array([1,1,1,1]),this.indices=new e.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=e.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=e.Strip.DrawModes.TRIANGLE_STRIP},e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Strip.prototype.constructor=e.Strip,e.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},e.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},e.Strip.prototype._renderStrip=function(t){var i=t.gl,n=t.projection,r=t.offset,o=t.shaderManager.stripShader,a=this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(o.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(o.projectionVector,n.x,-n.y),i.uniform2f(o.offsetVector,-r.x,-r.y),i.uniform1f(o.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(o.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(o.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(o.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(o.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(a,this.indices.length,i.UNSIGNED_SHORT,0)},e.Strip.prototype._renderCanvas=function(t){var i=t.context,n=this.worldTransform;t.roundPixels?i.setTransform(n.a,n.b,n.c,n.d,0|n.tx,0|n.ty):i.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.drawMode===e.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(i):this._renderCanvasTriangles(i)},e.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,n=e.length/2;this.count++;for(var r=0;r<n-2;r++){var o=2*r;this._renderCanvasDrawTriangle(t,e,i,o,o+2,o+4)}},e.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,n=this.indices,r=n.length;this.count++;for(var o=0;o<r;o+=3){var a=2*n[o],s=2*n[o+1],l=2*n[o+2];this._renderCanvasDrawTriangle(t,e,i,a,s,l)}},e.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,o){var a=this.texture.baseTexture.source,s=this.texture.width,l=this.texture.height,h=e[n],u=e[r],d=e[o],c=e[n+1],p=e[r+1],g=e[o+1],f=i[n]*s,y=i[r]*s,m=i[o]*s,C=i[n+1]*l,S=i[r+1]*l,b=i[o+1]*l;if(this.canvasPadding>0){var v=this.canvasPadding/this.worldTransform.a,w=this.canvasPadding/this.worldTransform.d,x=(h+u+d)/3,T=(c+p+g)/3,M=h-x,_=c-T,P=Math.sqrt(M*M+_*_);h=x+M/P*(P+v),
c=T+_/P*(P+w),M=u-x,_=p-T,P=Math.sqrt(M*M+_*_),u=x+M/P*(P+v),p=T+_/P*(P+w),M=d-x,_=g-T,P=Math.sqrt(M*M+_*_),d=x+M/P*(P+v),g=T+_/P*(P+w)}t.save(),t.beginPath(),t.moveTo(h,c),t.lineTo(u,p),t.lineTo(d,g),t.closePath(),t.clip();var A=f*S+C*m+y*b-S*m-C*y-f*b,k=h*S+C*d+u*b-S*d-C*u-h*b,D=f*u+h*m+y*d-u*m-h*y-f*d,F=f*S*d+C*u*m+h*y*b-h*S*m-C*y*d-f*u*b,E=c*S+C*g+p*b-S*g-C*p-c*b,I=f*p+c*m+y*g-p*m-c*y-f*g,G=f*S*g+C*p*m+c*y*b-c*S*m-C*y*g-f*p*b;t.transform(k/A,E/A,D/A,I/A,F/A,G/A),t.drawImage(a,0,0),t.restore()},e.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;this.count++,e.beginPath();for(var r=1;r<n-2;r++){var o=2*r,a=i[o],s=i[o+2],l=i[o+4],h=i[o+1],u=i[o+3],d=i[o+5];e.moveTo(a,h),e.lineTo(s,u),e.lineTo(l,d)}e.fillStyle="#FF0000",e.fill(),e.closePath()},e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},e.Strip.prototype.getBounds=function(t){for(var i=t||this.worldTransform,n=i.a,r=i.b,o=i.c,a=i.d,s=i.tx,l=i.ty,h=-1/0,u=-1/0,d=1/0,c=1/0,p=this.vertices,g=0,f=p.length;g<f;g+=2){var y=p[g],m=p[g+1],C=n*y+o*m+s,S=a*m+r*y+l;d=C<d?C:d,c=S<c?S:c,h=C>h?C:h,u=S>u?S:u}if(d===-1/0||u===1/0)return e.EmptyRectangle;var b=this._bounds;return b.x=d,b.width=h-d,b.y=c,b.height=u-c,this._currentBounds=b,b};e.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},e.Rope=function(t,i){e.Strip.call(this,t),this.points=i,this.vertices=new e.Float32Array(4*i.length),this.uvs=new e.Float32Array(4*i.length),this.colors=new e.Float32Array(2*i.length),this.indices=new e.Uint16Array(2*i.length),this.refresh()},e.Rope.prototype=Object.create(e.Strip.prototype),e.Rope.prototype.constructor=e.Rope,e.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),n=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var r,o,a,s=t.length,l=1;l<s;l++)r=t[l],o=4*l,a=l/(s-1),e[o]=a,e[o+1]=0,e[o+2]=a,e[o+3]=1,o=2*l,n[o]=1,n[o+1]=1,o=2*l,i[o]=o,i[o+1]=o+1,r}},e.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var i,n=t[0],r={x:0,y:0};this.count-=.2;for(var o,a,s,l,h,u=this.vertices,d=t.length,c=0;c<d;c++)o=t[c],a=4*c,i=c<t.length-1?t[c+1]:o,r.y=-(i.x-n.x),r.x=i.y-n.y,s=10*(1-c/(d-1)),s>1&&(s=1),l=Math.sqrt(r.x*r.x+r.y*r.y),h=this.texture.height/2,r.x/=l,r.y/=l,r.x*=h,r.y*=h,u[a]=o.x+r.x,u[a+1]=o.y+r.y,u[a+2]=o.x-r.x,u[a+3]=o.y-r.y,n=o;e.DisplayObjectContainer.prototype.updateTransform.call(this)}},e.Rope.prototype.setTexture=function(t){this.texture=t},e.TilingSprite=function(t,i,n){e.Sprite.call(this,t),this._width=i||100,this._height=n||100,this.tileScale=new e.Point(1,1),this.tileScaleOffset=new e.Point(1,1),this.tilePosition=new e.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL},e.TilingSprite.prototype=Object.create(e.Sprite.prototype),e.TilingSprite.prototype.constructor=e.TilingSprite,Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),e.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},e.TilingSprite.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha){var e,i;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),e=0,i=this.children.length;e<i;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},e.TilingSprite.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha){var i=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),i.globalAlpha=this.worldAlpha;var n,r,o=this.worldTransform,a=t.resolution;if(i.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]);var s=this.tilePosition,l=this.tileScale;for(s.x%=this.tilingTexture.baseTexture.width,s.y%=this.tilingTexture.baseTexture.height,i.scale(l.x,l.y),i.translate(s.x+this.anchor.x*-this._width,s.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-s.x,-s.y,this._width/l.x,this._height/l.y),i.scale(1/l.x,1/l.y),i.translate(-s.x+this.anchor.x*this._width,-s.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t),n=0,r=this.children.length;n<r;n++)this.children[n]._renderCanvas(t)}},e.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,r=e*(1-this.anchor.y),o=e*-this.anchor.y,a=this.worldTransform,s=a.a,l=a.b,h=a.c,u=a.d,d=a.tx,c=a.ty,p=s*n+h*o+d,g=u*o+l*n+c,f=s*i+h*o+d,y=u*o+l*i+c,m=s*i+h*r+d,C=u*r+l*i+c,S=s*n+h*r+d,b=u*r+l*n+c,v=-1/0,w=-1/0,x=1/0,T=1/0;x=p<x?p:x,x=f<x?f:x,x=m<x?m:x,x=S<x?S:x,T=g<T?g:T,T=y<T?y:T,T=C<T?C:T,T=b<T?b:T,v=p>v?p:v,v=f>v?f:v,v=m>v?m:v,v=S>v?S:v,w=g>w?g:w,w=y>w?y:w,w=C>w?C:w,w=b>w?b:w;var M=this._bounds;return M.x=x,M.width=v-x,M.y=T,M.height=w-T,this._currentBounds=M,M},e.TilingSprite.prototype.onTextureUpdate=function(){},e.TilingSprite.prototype.generateTilingTexture=function(t){if(this.texture.baseTexture.hasLoaded){var i,n,r=this.originalTexture||this.texture,o=r.frame,a=o.width!==r.baseTexture.width||o.height!==r.baseTexture.height,s=!1;if(t?(i=e.getNextPowerOfTwo(o.width),n=e.getNextPowerOfTwo(o.height),(o.width!==i||o.height!==n||r.baseTexture.width!==i||r.baseTexture.height||n)&&(s=!0)):a&&(r.trim?(i=r.trim.width,n=r.trim.height):(i=o.width,n=o.height),s=!0),s){var l;this.tilingTexture&&this.tilingTexture.isTiling?(l=this.tilingTexture.canvasBuffer,l.resize(i,n),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(l=new e.CanvasBuffer(i,n),this.tilingTexture=e.Texture.fromCanvas(l.canvas),this.tilingTexture.canvasBuffer=l,this.tilingTexture.isTiling=!0),l.context.drawImage(r.baseTexture.source,r.crop.x,r.crop.y,r.crop.width,r.crop.height,0,0,i,n),this.tileScaleOffset.x=o.width/i,this.tileScaleOffset.y=o.height/n}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=r;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},e.TilingSprite.prototype.destroy=function(){e.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};var i={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};i.BoneData=function(t,e){this.name=t,this.parent=e},i.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},i.SlotData=function(t,e){this.name=t,this.boneData=e},i.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},i.IkConstraintData=function(t){this.name=t,this.bones=[]},i.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},i.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},i.Bone.yDown=!1,i.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var e=this.skeleton.flipX,n=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=n!=i.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=n!=this.flipY}var r=this.worldRotation*i.degRad,o=Math.cos(r),a=Math.sin(r);this.worldFlipX?(this.m00=-o*this.worldScaleX,this.m01=a*this.worldScaleY):(this.m00=o*this.worldScaleX,this.m01=-a*this.worldScaleY),this.worldFlipY!=i.Bone.yDown?(this.m10=-a*this.worldScaleX,this.m11=-o*this.worldScaleY):(this.m10=a*this.worldScaleX,this.m11=o*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,n=t[1]-this.worldY,r=this.m00,o=this.m10,a=this.m01,s=this.m11;this.worldFlipX!=(this.worldFlipY!=i.Bone.yDown)&&(r=-r,s=-s);var l=1/(r*s-a*o);t[0]=e*r*l-n*a*l,t[1]=n*s*l-e*o*l},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},i.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},i.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;i<n;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},i.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},i.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:i.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:i.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},i.IkConstraint.apply1=function(t,e,n,r){var o=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,a=t.rotation,s=Math.atan2(n-t.worldY,e-t.worldX)*i.radDeg-o;t.rotationIK=a+(s-a)*r},i.IkConstraint.apply2=function(t,e,n,r,o,a){var s=e.rotation,l=t.rotation;if(!a)return e.rotationIK=s,void(t.rotationIK=l);var h,u,d=i.temp,c=t.parent;c?(d[0]=n,d[1]=r,c.worldToLocal(d),n=(d[0]-t.x)*c.worldScaleX,r=(d[1]-t.y)*c.worldScaleY):(n-=t.x,r-=t.y),e.parent==t?(h=e.x,u=e.y):(d[0]=e.x,d[1]=e.y,e.parent.localToWorld(d),t.worldToLocal(d),h=d[0],u=d[1]);var p=h*t.worldScaleX,g=u*t.worldScaleY,f=Math.atan2(g,p),y=Math.sqrt(p*p+g*g),m=e.data.length*e.worldScaleX,C=2*y*m;if(C<1e-4)return void(e.rotationIK=s+(Math.atan2(r,n)*i.radDeg-l-s)*a);var S=(n*n+r*r-y*y-m*m)/C;S<-1?S=-1:S>1&&(S=1);var b=Math.acos(S)*o,v=y+m*S,w=m*Math.sin(b),x=Math.atan2(r*v-n*w,n*v+r*w),T=(x-f)*i.radDeg-l;T>180?T-=360:T<-180&&(T+=360),t.rotationIK=l+T*a,T=(b+f)*i.radDeg-s,T>180?T-=360:T<-180&&(T+=360),e.rotationIK=s+(T+t.worldRotation-e.parent.worldRotation)*a},i.Skin=function(t){this.name=t,this.attachments={}},i.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),o=i.substring(n+1),a=t.slots[r];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(r,o);s&&a.setAttachment(s)}}}},i.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},i.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var o=this.timelines,a=0,s=o.length;a<s;a++)o[a].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,o){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var a=this.timelines,s=0,l=a.length;s<l;s++)a[s].apply(t,e,i,r,o)}},i.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var o=r>>>1;;){if(t[(o+1)*i]<=e?n=o+1:r=o,n==r)return(n+1)*i;o=n+r>>>1}},i.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},i.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},i.Curves=function(t){this.curves=[]},i.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var o=.1*.1*.1*6,a=2*-e+n,s=2*-i+r,l=3*(e-n)+1,h=3*(i-r)+1,u=e*(3*.1)+a*(.1*.1*3)+l*(.1*.1*.1),d=i*(3*.1)+s*(.1*.1*3)+h*(.1*.1*.1),c=a*(.1*.1*6)+l*o,p=s*(.1*.1*6)+h*o,g=l*o,f=h*o,y=19*t,m=this.curves;m[y++]=2;for(var C=u,S=d,b=y+19-1;y<b;y+=2)m[y]=C,m[y+1]=S,u+=c,d+=p,c+=g,p+=f,C+=u,S+=d},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;n++;for(var o=0,a=n,s=n+19-1;n<s;n+=2)if((o=i[n])>=e){var l,h;return n==a?(l=0,h=0):(l=i[n-2],h=i[n-1]),h+(i[n+1]-h)*(e-l)/(o-l)}var u=i[n-1];return u+(1-u)*(e-o)/(1-o)}},i.RotateTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s=t.bones[this.boneIndex];if(n>=a[a.length-2]){for(var l=s.data.rotation+a[a.length-1]-s.rotation;l>180;)l-=360;for(;l<-180;)l+=360;return void(s.rotation+=l*o)}var h=i.Animation.binarySearch(a,n,2),u=a[h-1],d=a[h],c=1-(n-d)/(a[h-2]-d);c=this.curves.getCurvePercent(h/2-1,c);for(var l=a[h+1]-u;l>180;)l-=360;for(;l<-180;)l+=360;for(l=s.data.rotation+(u+l*c)-s.rotation;l>180;)l-=360;for(;l<-180;)l+=360;s.rotation+=l*o}}},i.TranslateTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s=t.bones[this.boneIndex];if(n>=a[a.length-3])return s.x+=(s.data.x+a[a.length-2]-s.x)*o,void(s.y+=(s.data.y+a[a.length-1]-s.y)*o);var l=i.Animation.binarySearch(a,n,3),h=a[l-2],u=a[l-1],d=a[l],c=1-(n-d)/(a[l+-3]-d);c=this.curves.getCurvePercent(l/3-1,c),s.x+=(s.data.x+h+(a[l+1]-h)*c-s.x)*o,s.y+=(s.data.y+u+(a[l+2]-u)*c-s.y)*o}}},i.ScaleTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s=t.bones[this.boneIndex];if(n>=a[a.length-3])return s.scaleX+=(s.data.scaleX*a[a.length-2]-s.scaleX)*o,void(s.scaleY+=(s.data.scaleY*a[a.length-1]-s.scaleY)*o);var l=i.Animation.binarySearch(a,n,3),h=a[l-2],u=a[l-1],d=a[l],c=1-(n-d)/(a[l+-3]-d);c=this.curves.getCurvePercent(l/3-1,c),s.scaleX+=(s.data.scaleX*(h+(a[l+1]-h)*c)-s.scaleX)*o,s.scaleY+=(s.data.scaleY*(u+(a[l+2]-u)*c)-s.scaleY)*o}}},i.ColorTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=5*t},i.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,o){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=o},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s,l,h,u;if(n>=a[a.length-5]){var d=a.length-1;s=a[d-3],l=a[d-2],h=a[d-1],u=a[d]}else{var c=i.Animation.binarySearch(a,n,5),p=a[c-4],g=a[c-3],f=a[c-2],y=a[c-1],m=a[c],C=1-(n-m)/(a[c-5]-m);C=this.curves.getCurvePercent(c/5-1,C),s=p+(a[c+1]-p)*C,l=g+(a[c+2]-g)*C,h=f+(a[c+3]-f)*C,u=y+(a[c+4]-y)*C}var S=t.slots[this.slotIndex];o<1?(S.r+=(s-S.r)*o,S.g+=(l-S.g)*o,S.b+=(h-S.b)*o,S.a+=(u-S.a)*o):(S.r=s,S.g=l,S.b=h,S.a=u)}}},i.AttachmentTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},i.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,n,r,o){var a=this.frames;if(n<a[0])return void(e>n&&this.apply(t,e,Number.MAX_VALUE,null,0));e>n&&(e=-1);var s=n>=a[a.length-1]?a.length-1:i.Animation.binarySearch1(a,n)-1;if(!(a[s]<e)){var l=this.attachmentNames[s];t.slots[this.slotIndex].setAttachment(l?t.getAttachmentBySlotIndex(this.slotIndex,l):null)}}},i.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},i.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,n,r,o){if(r){var a=this.frames,s=a.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,o),e=-1;else if(e>=a[s-1])return;if(!(n<a[0])){var l;if(e<a[0])l=0;else{l=i.Animation.binarySearch1(a,e);for(var h=a[l];l>0&&a[l-1]==h;)l--}for(var u=this.events;l<s&&n>=a[l];l++)r.push(u[l])}}}},i.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},i.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s;s=n>=a[a.length-1]?a.length-1:i.Animation.binarySearch1(a,n)-1;var l=t.drawOrder,h=(t.slots,this.drawOrders[s]);if(h)for(var u=0,d=h.length;u<d;u++)l[u]=h[u]}}},i.FfdTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},i.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,n,r,o){var a=t.slots[this.slotIndex];if(a.attachment==this.attachment){var s=this.frames;if(!(n<s[0])){var l=this.frameVertices,h=l[0].length,u=a.attachmentVertices;if(u.length!=h&&(o=1),u.length=h,n>=s[s.length-1]){var d=l[s.length-1];if(o<1)for(var c=0;c<h;c++)u[c]+=(d[c]-u[c])*o;else for(var c=0;c<h;c++)u[c]=d[c]}else{var p=i.Animation.binarySearch1(s,n),g=s[p],f=1-(n-g)/(s[p-1]-g);f=this.curves.getCurvePercent(p-1,f<0?0:f>1?1:f);var y=l[p-1],m=l[p];if(o<1)for(var c=0;c<h;c++){var C=y[c];u[c]+=(C+(m[c]-C)*f-u[c])*o}else for(var c=0;c<h;c++){var C=y[c];u[c]=C+(m[c]-C)*f}}}}}},i.IkConstraintTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=3*t},i.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,n,r,o){var a=this.frames;if(!(n<a[0])){var s=t.ikConstraints[this.ikConstraintIndex];if(n>=a[a.length-3])return s.mix+=(a[a.length-2]-s.mix)*o,void(s.bendDirection=a[a.length-1]);var l=i.Animation.binarySearch(a,n,3),h=a[l+-2],u=a[l],d=1-(n-u)/(a[l+-3]-u);d=this.curves.getCurvePercent(l/3-1,d);var c=h+(a[l+1]-h)*d;s.mix+=(c-s.mix)*o,s.bendDirection=a[l+-1]}}},i.FlipXTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,n,r,o){var a=this.frames;if(n<a[0])return void(e>n&&this.apply(t,e,Number.MAX_VALUE,null,0));e>n&&(e=-1);var s=(n>=a[a.length-2]?a.length:i.Animation.binarySearch(a,n,2))-2;a[s]<e||(t.bones[this.boneIndex].flipX=0!=a[s+1])}},i.FlipYTimeline=function(t){this.curves=new i.Curves(t),this.frames=[],this.frames.length=2*t},i.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,n,r,o){var a=this.frames;if(n<a[0])return void(e>n&&this.apply(t,e,Number.MAX_VALUE,null,0));e>n&&(e=-1);var s=(n>=a[a.length-2]?a.length:i.Animation.binarySearch(a,n,2))-2;a[s]<e||(t.bones[this.boneIndex].flipY=0!=a[s+1])}},i.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},i.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}},i.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,n=t.bones.length;e<n;e++){var r=t.bones[e],o=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new i.Bone(r,this,o))}this.slots=[],this.drawOrder=[];for(var e=0,n=t.slots.length;e<n;e++){var a=t.slots[e],s=this.bones[t.bones.indexOf(a.boneData)],l=new i.Slot(a,s);this.slots.push(l),this.drawOrder.push(e)}this.ikConstraints=[];for(var e=0,n=t.ikConstraints.length;e<n;e++)this.ikConstraints.push(new i.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},i.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,o=n.length;r<o;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var a=n[0],s=this.bones;t:for(var r=0,o=s.length;r<o;r++){var l=s[r],h=l;do{for(var u=0;u<e;u++)for(var d=t[u],c=d.bones[0],p=d.bones[d.bones.length-1];;){if(h==p){n[u].push(l),n[u+1].push(l);continue t}if(p==c)break;p=p.parent}h=h.parent}while(h);a[a.length]=l}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}for(var e=0,r=this.boneCache.length-1;;){for(var o=this.boneCache[e],a=0,s=o.length;a<s;a++)o[a].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;e<i;e++)t[e].setToSetupPose(e);this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],o=r.data.attachmentName;if(o){var a=t.getAttachment(i,o);a&&r.setAttachment(a)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;n<r;n++){var o=i[n];if(o.data.name==t){var a=null;if(e&&!(a=this.getAttachmentBySlotIndex(n,e)))throw"Attachment not found: "+e+", for slot: "+t;return void o.setAttachment(a)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t},resetDrawOrder:function(){for(var t=0,e=this.drawOrder.length;t<e;t++)this.drawOrder[t]=t}},i.EventData=function(t){this.name=t},i.EventData.prototype={intValue:0,floatValue:0,stringValue:null},i.Event=function(t){this.data=t},i.Event.prototype={intValue:0,floatValue:0,stringValue:null},i.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},i.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},i.RegionAttachment.prototype={type:i.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var o=this.uvs;r?(o[2]=t,o[3]=n,o[4]=t,o[5]=e,o[6]=i,o[7]=e,o[0]=i,o[1]=n):(o[0]=t,o[1]=n,o[2]=t,o[3]=e,o[4]=i,o[5]=e,o[6]=i,o[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*e,o=n+this.regionWidth*t,a=r+this.regionHeight*e,s=this.rotation*i.degRad,l=Math.cos(s),h=Math.sin(s),u=n*l+this.x,d=n*h,c=r*l+this.y,p=r*h,g=o*l+this.x,f=o*h,y=a*l+this.y,m=a*h,C=this.offset;C[0]=u-p,C[1]=c+d,C[2]=u-m,C[3]=y+d,C[4]=g-m,C[5]=y+f,C[6]=g-p,C[7]=c+f},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,o=i.m01,a=i.m10,s=i.m11,l=this.offset;n[0]=l[0]*r+l[1]*o+t,n[1]=l[0]*a+l[1]*s+e,n[2]=l[2]*r+l[3]*o+t,n[3]=l[2]*a+l[3]*s+e,n[4]=l[4]*r+l[5]*o+t,n[5]=l[4]*a+l[5]*s+e,n[6]=l[6]*r+l[7]*o+t,n[7]=l[6]*a+l[7]*s+e}},i.MeshAttachment=function(t){this.name=t},i.MeshAttachment.prototype={type:i.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,n=this.regionUVs.length;if(this.uvs&&this.uvs.length==n||(this.uvs=new i.Float32Array(n)),this.regionRotate)for(var r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+e-this.regionUVs[r]*e;else for(var r=0;r<n;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*e},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var o=r.m00,a=r.m01,s=r.m10,l=r.m11,h=this.vertices,u=h.length;i.attachmentVertices.length==u&&(h=i.attachmentVertices);for(var d=0;d<u;d+=2){var c=h[d],p=h[d+1];n[d]=c*o+p*a+t,n[d+1]=c*s+p*l+e}}},i.SkinnedMeshAttachment=function(t){this.name=t},i.SkinnedMeshAttachment.prototype={type:i.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,n,r,o){var a=this.regionU2-this.regionU,s=this.regionV2-this.regionV,l=this.regionUVs.length;if(this.uvs&&this.uvs.length==l||(this.uvs=new i.Float32Array(l)),this.regionRotate)for(var h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h+1]*a,this.uvs[h+1]=this.regionV+s-this.regionUVs[h]*s;else for(var h=0;h<l;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h]*a,this.uvs[h+1]=this.regionV+this.regionUVs[h+1]*s},computeWorldVertices:function(t,e,i,n){var r,o,a,s,l,h,u,d=i.bone.skeleton.bones,c=this.weights,p=this.bones,g=0,f=0,y=0,m=0,C=p.length;if(i.attachmentVertices.length)for(var S=i.attachmentVertices;f<C;g+=2){for(o=0,a=0,r=p[f++]+f;f<r;f++,y+=3,m+=2)s=d[p[f]],l=c[y]+S[m],h=c[y+1]+S[m+1],u=c[y+2],o+=(l*s.m00+h*s.m01+s.worldX)*u,a+=(l*s.m10+h*s.m11+s.worldY)*u;n[g]=o+t,n[g+1]=a+e}else for(;f<C;g+=2){for(o=0,a=0,r=p[f++]+f;f<r;f++,y+=3)s=d[p[f]],l=c[y],h=c[y+1],u=c[y+2],o+=(l*s.m00+h*s.m01+s.worldX)*u,a+=(l*s.m10+h*s.m11+s.worldY)*u;n[g]=o+t,n[g+1]=a+e}}},i.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},i.BoundingBoxAttachment.prototype={type:i.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,o=i.m01,a=i.m10,s=i.m11,l=this.vertices,h=0,u=l.length;h<u;h+=2){var d=l[h],c=l[h+1];n[h]=d*r+c*o+t,n[h+1]=d*a+c*s+e}}},i.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},i.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},i.TrackEntry=function(){},i.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},i.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},i.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){t.resetDrawOrder();for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,o=i.endTime,a=i.loop;!a&&n>o&&(n=o);var s=i.previous;if(s){var l=s.time;!s.loop&&l>s.endTime&&(l=s.endTime),s.animation.apply(t,l,l,s.loop,null);var h=i.mixTime/i.mixDuration*i.mix;h>=1&&(h=1,i.previous=null),i.animation.mix(t,i.lastTime,n,a,this.events,h)
}else 1==i.mix?i.animation.apply(t,i.lastTime,n,a,this.events):i.animation.mix(t,i.lastTime,n,a,this.events,i.mix);for(var u=0,d=this.events.length;u<d;u++){var c=this.events[u];i.onEvent&&i.onEvent(e,c),this.onEvent&&this.onEvent(e,c)}if(a?r%o>n%o:r<o&&n>=o){var p=Math.floor(n/o);i.onComplete&&i.onComplete(e,p),this.onComplete&&this.onComplete(e,p)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5?e.previous=n:e.previous=i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,n){var r=new i.TrackEntry;return r.animation=e,r.loop=n,r.endTime=e.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,n,r){var o=new i.TrackEntry;o.animation=e,o.loop=n,o.endTime=e.duration;var a=this._expandToIndex(t);if(a){for(;a.next;)a=a.next;a.next=o}else this.tracks[t]=o;return r<=0&&(a?r+=a.endTime-this.data.getMix(a.animation,e):r=0),o.delay=r,o},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},i.SkeletonJson=function(t){this.attachmentLoader=t},i.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var n=new i.SkeletonData;n.name=e;var r=t.skeleton;r&&(n.hash=r.hash,n.version=r.spine,n.width=r.width||0,n.height=r.height||0);for(var o=t.bones,a=0,s=o.length;a<s;a++){var l=o[a],h=null;if(l.parent&&!(h=n.findBone(l.parent)))throw"Parent bone not found: "+l.parent;var u=new i.BoneData(l.name,h);u.length=(l.length||0)*this.scale,u.x=(l.x||0)*this.scale,u.y=(l.y||0)*this.scale,u.rotation=l.rotation||0,u.scaleX=l.hasOwnProperty("scaleX")?l.scaleX:1,u.scaleY=l.hasOwnProperty("scaleY")?l.scaleY:1,u.inheritScale=!l.hasOwnProperty("inheritScale")||l.inheritScale,u.inheritRotation=!l.hasOwnProperty("inheritRotation")||l.inheritRotation,n.bones.push(u)}var d=t.ik;if(d)for(var a=0,s=d.length;a<s;a++){for(var c=d[a],p=new i.IkConstraintData(c.name),o=c.bones,g=0,f=o.length;g<f;g++){var y=n.findBone(o[g]);if(!y)throw"IK bone not found: "+o[g];p.bones.push(y)}if(p.target=n.findBone(c.target),!p.target)throw"Target bone not found: "+c.target;p.bendDirection=!c.hasOwnProperty("bendPositive")||c.bendPositive?1:-1,p.mix=c.hasOwnProperty("mix")?c.mix:1,n.ikConstraints.push(p)}for(var m=t.slots,a=0,s=m.length;a<s;a++){var C=m[a],u=n.findBone(C.bone);if(!u)throw"Slot bone not found: "+C.bone;var S=new i.SlotData(C.name,u),b=C.color;b&&(S.r=this.toColor(b,0),S.g=this.toColor(b,1),S.b=this.toColor(b,2),S.a=this.toColor(b,3)),S.attachmentName=C.attachment,S.additiveBlending=C.additive&&"true"==C.additive,n.slots.push(S)}var v=t.skins;for(var w in v)if(v.hasOwnProperty(w)){var x=v[w],T=new i.Skin(w);for(var M in x)if(x.hasOwnProperty(M)){var _=n.findSlotIndex(M),P=x[M];for(var A in P)if(P.hasOwnProperty(A)){var k=this.readAttachment(T,A,P[A]);k&&T.addAttachment(_,A,k)}}n.skins.push(T),"default"==T.name&&(n.defaultSkin=T)}var D=t.events;for(var F in D)if(D.hasOwnProperty(F)){var E=D[F],I=new i.EventData(F);I.intValue=E.int||0,I.floatValue=E.float||0,I.stringValue=E.string||null,n.events.push(I)}var G=t.animations;for(var O in G)G.hasOwnProperty(O)&&this.readAnimation(O,G[O],n);return n},readAttachment:function(t,e,n){e=n.name||e;var r=i.AttachmentType[n.type||"region"],o=n.path||e,a=this.scale;if(r==i.AttachmentType.region){var s=this.attachmentLoader.newRegionAttachment(t,e,o);if(!s)return null;s.path=o,s.x=(n.x||0)*a,s.y=(n.y||0)*a,s.scaleX=n.hasOwnProperty("scaleX")?n.scaleX:1,s.scaleY=n.hasOwnProperty("scaleY")?n.scaleY:1,s.rotation=n.rotation||0,s.width=(n.width||0)*a,s.height=(n.height||0)*a;var l=n.color;return l&&(s.r=this.toColor(l,0),s.g=this.toColor(l,1),s.b=this.toColor(l,2),s.a=this.toColor(l,3)),s.updateOffset(),s}if(r==i.AttachmentType.mesh){var h=this.attachmentLoader.newMeshAttachment(t,e,o);return h?(h.path=o,h.vertices=this.getFloatArray(n,"vertices",a),h.triangles=this.getIntArray(n,"triangles"),h.regionUVs=this.getFloatArray(n,"uvs",1),h.updateUVs(),l=n.color,l&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(n.hull||0),n.edges&&(h.edges=this.getIntArray(n,"edges")),h.width=(n.width||0)*a,h.height=(n.height||0)*a,h):null}if(r==i.AttachmentType.skinnedmesh){var h=this.attachmentLoader.newSkinnedMeshAttachment(t,e,o);if(!h)return null;h.path=o;for(var u=this.getFloatArray(n,"uvs",1),d=this.getFloatArray(n,"vertices",1),c=[],p=[],g=0,f=d.length;g<f;){var y=0|d[g++];p[p.length]=y;for(var m=g+4*y;g<m;)p[p.length]=d[g],c[c.length]=d[g+1]*a,c[c.length]=d[g+2]*a,c[c.length]=d[g+3],g+=4}return h.bones=p,h.weights=c,h.triangles=this.getIntArray(n,"triangles"),h.regionUVs=u,h.updateUVs(),l=n.color,l&&(h.r=this.toColor(l,0),h.g=this.toColor(l,1),h.b=this.toColor(l,2),h.a=this.toColor(l,3)),h.hullLength=2*(n.hull||0),n.edges&&(h.edges=this.getIntArray(n,"edges")),h.width=(n.width||0)*a,h.height=(n.height||0)*a,h}if(r==i.AttachmentType.boundingbox){for(var C=this.attachmentLoader.newBoundingBoxAttachment(t,e),d=n.vertices,g=0,f=d.length;g<f;g++)C.vertices.push(d[g]*a);return C}throw"Unknown attachment type: "+r},readAnimation:function(t,e,n){var r=[],o=0,a=e.slots;for(var s in a)if(a.hasOwnProperty(s)){var l=a[s],h=n.findSlotIndex(s);for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];if("color"==u){var c=new i.ColorTimeline(d.length);c.slotIndex=h;for(var p=0,g=0,f=d.length;g<f;g++){var y=d[g],m=y.color,C=this.toColor(m,0),S=this.toColor(m,1),b=this.toColor(m,2),v=this.toColor(m,3);c.setFrame(p,y.time,C,S,b,v),this.readCurve(c,p,y),p++}r.push(c),o=Math.max(o,c.frames[5*c.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+s+")";var c=new i.AttachmentTimeline(d.length);c.slotIndex=h;for(var p=0,g=0,f=d.length;g<f;g++){var y=d[g];c.setFrame(p++,y.time,y.name)}r.push(c),o=Math.max(o,c.frames[c.getFrameCount()-1])}}}var w=e.bones;for(var x in w)if(w.hasOwnProperty(x)){var T=n.findBoneIndex(x);if(-1==T)throw"Bone not found: "+x;var M=w[x];for(var u in M)if(M.hasOwnProperty(u)){var d=M[u];if("rotate"==u){var c=new i.RotateTimeline(d.length);c.boneIndex=T;for(var p=0,g=0,f=d.length;g<f;g++){var y=d[g];c.setFrame(p,y.time,y.angle),this.readCurve(c,p,y),p++}r.push(c),o=Math.max(o,c.frames[2*c.getFrameCount()-2])}else if("translate"==u||"scale"==u){var c,_=1;"scale"==u?c=new i.ScaleTimeline(d.length):(c=new i.TranslateTimeline(d.length),_=this.scale),c.boneIndex=T;for(var p=0,g=0,f=d.length;g<f;g++){var y=d[g],P=(y.x||0)*_,A=(y.y||0)*_;c.setFrame(p,y.time,P,A),this.readCurve(c,p,y),p++}r.push(c),o=Math.max(o,c.frames[3*c.getFrameCount()-3])}else{if("flipX"!=u&&"flipY"!=u)throw"Invalid timeline type for a bone: "+u+" ("+x+")";var P="flipX"==u,c=P?new i.FlipXTimeline(d.length):new i.FlipYTimeline(d.length);c.boneIndex=T;for(var k=P?"x":"y",p=0,g=0,f=d.length;g<f;g++){var y=d[g];c.setFrame(p,y.time,y[k]||!1),p++}r.push(c),o=Math.max(o,c.frames[2*c.getFrameCount()-2])}}}var D=e.ik;for(var F in D)if(D.hasOwnProperty(F)){var E=n.findIkConstraint(F),d=D[F],c=new i.IkConstraintTimeline(d.length);c.ikConstraintIndex=n.ikConstraints.indexOf(E);for(var p=0,g=0,f=d.length;g<f;g++){var y=d[g],I=y.hasOwnProperty("mix")?y.mix:1,G=!y.hasOwnProperty("bendPositive")||y.bendPositive?1:-1;c.setFrame(p,y.time,I,G),this.readCurve(c,p,y),p++}r.push(c),o=Math.max(o,c.frames[3*c.getFrameCount()-3])}var O=e.ffd;for(var B in O){var L=n.findSkin(B),l=O[B];for(s in l){var h=n.findSlotIndex(s),R=l[s];for(var N in R){var d=R[N],c=new i.FfdTimeline(d.length),U=L.getAttachment(h,N);if(!U)throw"FFD attachment not found: "+N;c.slotIndex=h,c.attachment=U;var V,H=U.type==i.AttachmentType.mesh;V=H?U.vertices.length:U.weights.length/3*2;for(var p=0,g=0,f=d.length;g<f;g++){var W,y=d[g];if(y.vertices){var K=y.vertices,W=[];W.length=V;var z=y.offset||0,j=K.length;if(1==this.scale)for(var Y=0;Y<j;Y++)W[Y+z]=K[Y];else for(var Y=0;Y<j;Y++)W[Y+z]=K[Y]*this.scale;if(H)for(var X=U.vertices,Y=0,j=W.length;Y<j;Y++)W[Y]+=X[Y]}else H?W=U.vertices:(W=[],W.length=V);c.setFrame(p,y.time,W),this.readCurve(c,p,y),p++}r[r.length]=c,o=Math.max(o,c.frames[c.getFrameCount()-1])}}}var q=e.drawOrder;if(q||(q=e.draworder),q){for(var c=new i.DrawOrderTimeline(q.length),Z=n.slots.length,p=0,g=0,f=q.length;g<f;g++){var J=q[g],Q=null;if(J.offsets){Q=[],Q.length=Z;for(var Y=Z-1;Y>=0;Y--)Q[Y]=-1;var $=J.offsets,tt=[];tt.length=Z-$.length;for(var et=0,it=0,Y=0,j=$.length;Y<j;Y++){var nt=$[Y],h=n.findSlotIndex(nt.slot);if(-1==h)throw"Slot not found: "+nt.slot;for(;et!=h;)tt[it++]=et++;Q[et+nt.offset]=et++}for(;et<Z;)tt[it++]=et++;for(var Y=Z-1;Y>=0;Y--)-1==Q[Y]&&(Q[Y]=tt[--it])}c.setFrame(p++,J.time,Q)}r.push(c),o=Math.max(o,c.frames[c.getFrameCount()-1])}var rt=e.events;if(rt){for(var c=new i.EventTimeline(rt.length),p=0,g=0,f=rt.length;g<f;g++){var ot=rt[g],at=n.findEvent(ot.name);if(!at)throw"Event not found: "+ot.name;var st=new i.Event(at);st.intValue=ot.hasOwnProperty("int")?ot.int:at.intValue,st.floatValue=ot.hasOwnProperty("float")?ot.float:at.floatValue,st.stringValue=ot.hasOwnProperty("string")?ot.string:at.stringValue,c.setFrame(p++,ot.time,st)}r.push(c),o=Math.max(o,c.frames[c.getFrameCount()-1])}n.animations.push(new i.Animation(t,r,o))},readCurve:function(t,e,i){var n=i.curve;n?"stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,n){var r=t[e],o=new i.Float32Array(r.length),a=0,s=r.length;if(1==n)for(;a<s;a++)o[a]=r[a];else for(;a<s;a++)o[a]=r[a]*n;return o},getIntArray:function(t,e){for(var n=t[e],r=new i.Uint16Array(n.length),o=0,a=n.length;o<a;o++)r[o]=0|n[o];return r}},i.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var n=new i.AtlasReader(t),r=[];r.length=4;for(var o=null;;){var a=n.readLine();if(null===a)break;if(a=n.trim(a),a.length)if(o){var s=new i.AtlasRegion;s.name=a,s.page=o,s.rotate="true"==n.readValue(),n.readTuple(r);var l=parseInt(r[0]),h=parseInt(r[1]);n.readTuple(r);var u=parseInt(r[0]),d=parseInt(r[1]);s.u=l/o.width,s.v=h/o.height,s.rotate?(s.u2=(l+d)/o.width,s.v2=(h+u)/o.height):(s.u2=(l+u)/o.width,s.v2=(h+d)/o.height),s.x=l,s.y=h,s.width=Math.abs(u),s.height=Math.abs(d),4==n.readTuple(r)&&(s.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(s.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),s.originalWidth=parseInt(r[0]),s.originalHeight=parseInt(r[1]),n.readTuple(r),s.offsetX=parseInt(r[0]),s.offsetY=parseInt(r[1]),s.index=parseInt(n.readValue()),this.regions.push(s)}else{o=new i.AtlasPage,o.name=a,2==n.readTuple(r)&&(o.width=parseInt(r[0]),o.height=parseInt(r[1]),n.readTuple(r)),o.format=i.Atlas.Format[r[0]],n.readTuple(r),o.minFilter=i.Atlas.TextureFilter[r[0]],o.magFilter=i.Atlas.TextureFilter[r[1]];var c=n.readValue();o.uWrap=i.Atlas.TextureWrap.clampToEdge,o.vWrap=i.Atlas.TextureWrap.clampToEdge,"x"==c?o.uWrap=i.Atlas.TextureWrap.repeat:"y"==c?o.vWrap=i.Atlas.TextureWrap.repeat:"xy"==c&&(o.uWrap=o.vWrap=i.Atlas.TextureWrap.repeat),e.load(o,a,this),this.pages.push(o)}else o=null}},i.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},i.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},i.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},i.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},i.AtlasPage=function(){},i.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},i.AtlasRegion=function(){},i.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},i.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},i.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,r=i+1;n<3;n++){var o=e.indexOf(",",r);if(-1==o)break;t[n]=this.trim(e.substr(r,o-r)),r=o+1}return t[n]=this.trim(e.substring(r)),n+1}},i.AtlasAttachmentLoader=function(t){this.atlas=t},i.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (region attachment: "+e+")";var o=new i.RegionAttachment(e);return o.rendererObject=r,o.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),o.regionOffsetX=r.offsetX,o.regionOffsetY=r.offsetY,o.regionWidth=r.width,o.regionHeight=r.height,o.regionOriginalWidth=r.originalWidth,o.regionOriginalHeight=r.originalHeight,o},newMeshAttachment:function(t,e,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (mesh attachment: "+e+")";var o=new i.MeshAttachment(e);return o.rendererObject=r,o.regionU=r.u,o.regionV=r.v,o.regionU2=r.u2,o.regionV2=r.v2,o.regionRotate=r.rotate,o.regionOffsetX=r.offsetX,o.regionOffsetY=r.offsetY,o.regionWidth=r.width,o.regionHeight=r.height,o.regionOriginalWidth=r.originalWidth,o.regionOriginalHeight=r.originalHeight,o},newSkinnedMeshAttachment:function(t,e,n){var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" (skinned mesh attachment: "+e+")";var o=new i.SkinnedMeshAttachment(e);return o.rendererObject=r,o.regionU=r.u,o.regionV=r.v,o.regionU2=r.u2,o.regionV2=r.v2,o.regionRotate=r.rotate,o.regionOffsetX=r.offsetX,o.regionOffsetY=r.offsetY,o.regionWidth=r.width,o.regionHeight=r.height,o.regionOriginalWidth=r.originalWidth,o.regionOriginalHeight=r.originalHeight,o},newBoundingBoxAttachment:function(t,e){return new i.BoundingBoxAttachment(e)}},i.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},i.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var n=t.slots,r=n.length,o=t.x,a=t.y,s=this.boundingBoxes,l=this.polygonPool,h=this.polygons;s.length=0;for(var u=0,d=h.length;u<d;u++)l.push(h[u]);h.length=0;for(var u=0;u<r;u++){var c=n[u],p=c.attachment;if(p.type==i.AttachmentType.boundingbox){s.push(p);var g,f=l.length;f>0?(g=l[f-1],l.splice(f-1,1)):g=[],h.push(g),g.length=p.vertices.length,p.computeWorldVertices(o,a,c.bone,g)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,o=0,a=t.length;o<a;o++)for(var s=t[o],l=0,h=s.length;l<h;l+=2){var u=s[l],d=s[l+1];e=Math.min(e,u),i=Math.min(i,d),n=Math.max(n,u),r=Math.max(r,d)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,o=this.minY,a=this.maxX,s=this.maxY;if(t<=r&&i<=r||e<=o&&n<=o||t>=a&&i>=a||e>=s&&n>=s)return!1;var l=(n-e)/(i-t),h=l*(r-t)+e;if(h>o&&h<s)return!0;if((h=l*(a-t)+e)>o&&h<s)return!0;var u=(o-e)/l+t;return u>r&&u<a||(u=(s-e)/l+t)>r&&u<a},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,o=0,a=r.length;o<a;o++)if(r[o].intersectsSegment(t,e,i,n))return this.boundingBoxes[o];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,o=!1,a=0;a<n;a+=2){var s=t[a+1],l=t[r+1];if(s<i&&l>=i||l<i&&s>=i){var h=t[a];h+(i-s)/(l-s)*(t[r]-h)<e&&(o=!o)}r=a}return o},polygonIntersectsSegment:function(t,e,i,n,r){for(var o=t.length,a=e-n,s=i-r,l=e*r-i*n,h=t[o-2],u=t[o-1],d=0;d<o;d+=2){var c=t[d],p=t[d+1],g=h*p-u*c,f=h-c,y=u-p,m=a*y-s*f,C=(l*f-a*g)/m;if((C>=h&&C<=c||C>=c&&C<=h)&&(C>=e&&C<=n||C>=n&&C<=e)){var S=(l*y-s*g)/m;if((S>=u&&S<=p||S>=p&&S<=u)&&(S>=i&&S<=r||S>=r&&S<=i))return!0}h=c,u=p}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},i.Bone.yDown=!0,e.AnimCache={},e.SpineTextureLoader=function(t,i){e.EventTarget.call(this),this.basePath=t,this.crossorigin=i,this.loadingCount=0},e.SpineTextureLoader.prototype=e.SpineTextureLoader,e.SpineTextureLoader.prototype.load=function(t,i){if(t.rendererObject=e.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!t.rendererObject.hasLoaded){var n=this;++n.loadingCount,t.rendererObject.addEventListener("loaded",function(){--n.loadingCount,n.dispatchEvent({type:"loadedBaseTexture",content:n})})}},e.SpineTextureLoader.prototype.unload=function(t){t.destroy(!0)},e.Spine=function(t){if(e.DisplayObjectContainer.call(this),this.spineData=e.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new i.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new i.AnimationStateData(this.spineData),this.state=new i.AnimationState(this.stateData),this.slotContainers=[];for(var n=0,r=this.skeleton.slots.length;n<r;n++){var o=this.skeleton.slots[n],a=o.attachment,s=new e.DisplayObjectContainer;if(this.slotContainers.push(s),this.addChild(s),a instanceof i.RegionAttachment){var l=a.rendererObject.name,h=this.createSprite(o,a);o.currentSprite=h,o.currentSpriteName=l,s.addChild(h)}else{if(!(a instanceof i.MeshAttachment))continue;var u=this.createMesh(o,a);o.currentMesh=u,o.currentMeshName=a.name,s.addChild(u)}}this.autoUpdate=!0},e.Spine.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Spine.prototype.constructor=e.Spine,Object.defineProperty(e.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===e.Spine.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?e.Spine.prototype.autoUpdateTransform:e.DisplayObjectContainer.prototype.updateTransform}}),e.Spine.prototype.update=function(t){this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var n=this.skeleton.drawOrder,r=this.skeleton.slots,o=0,a=n.length;o<a;o++)this.children[o]=this.slotContainers[n[o]];for(o=0,a=r.length;o<a;o++){var s=r[o],l=s.attachment,h=this.slotContainers[o];if(l){var u=l.type;if(u===i.AttachmentType.region){if(l.rendererObject&&(!s.currentSpriteName||s.currentSpriteName!==l.name)){var d=l.rendererObject.name;if(void 0!==s.currentSprite&&(s.currentSprite.visible=!1),s.sprites=s.sprites||{},void 0!==s.sprites[d])s.sprites[d].visible=!0;else{var c=this.createSprite(s,l);h.addChild(c)}s.currentSprite=s.sprites[d],s.currentSpriteName=d}var p=s.bone;h.position.x=p.worldX+l.x*p.m00+l.y*p.m01,h.position.y=p.worldY+l.x*p.m10+l.y*p.m11,h.scale.x=p.worldScaleX,h.scale.y=p.worldScaleY,h.rotation=-s.bone.worldRotation*i.degRad,s.currentSprite.tint=e.rgb2hex([s.r,s.g,s.b])}else{if(u!==i.AttachmentType.skinnedmesh){h.visible=!1;continue}if(!s.currentMeshName||s.currentMeshName!==l.name){var g=l.name;if(void 0!==s.currentMesh&&(s.currentMesh.visible=!1),s.meshes=s.meshes||{},void 0!==s.meshes[g])s.meshes[g].visible=!0;else{var f=this.createMesh(s,l);h.addChild(f)}s.currentMesh=s.meshes[g],s.currentMeshName=g}l.computeWorldVertices(s.bone.skeleton.x,s.bone.skeleton.y,s,s.currentMesh.vertices)}h.visible=!0,h.alpha=s.a}else h.visible=!1}},e.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t),e.DisplayObjectContainer.prototype.updateTransform.call(this)},e.Spine.prototype.createSprite=function(t,n){var r=n.rendererObject,o=r.page.rendererObject,a=new e.Rectangle(r.x,r.y,r.rotate?r.height:r.width,r.rotate?r.width:r.height),s=new e.Texture(o,a),l=new e.Sprite(s),h=r.rotate?.5*Math.PI:0;return l.scale.set(r.width/r.originalWidth*n.scaleX,r.height/r.originalHeight*n.scaleY),l.rotation=h-n.rotation*i.degRad,l.anchor.x=l.anchor.y=.5,l.alpha=n.a,t.sprites=t.sprites||{},t.sprites[r.name]=l,l},e.Spine.prototype.createMesh=function(t,i){var n=i.rendererObject,r=n.page.rendererObject,o=new e.Texture(r),a=new e.Strip(o);return a.drawMode=e.Strip.DrawModes.TRIANGLES,a.canvasPadding=1.5,a.vertices=new e.Float32Array(i.uvs.length),a.uvs=i.uvs,a.indices=i.triangles,a.alpha=i.a,t.meshes=t.meshes||{},t.meshes[i.name]=a,a},e.BaseTextureCache={},e.BaseTextureCacheIdGenerator=0,e.BaseTexture=function(t,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||e.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=e._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var n=this;this.source.onload=function(){n.hasLoaded=!0,n.width=n.source.naturalWidth||n.source.width,n.height=n.source.naturalHeight||n.source.height,n.dirty(),n.dispatchEvent({type:"loaded",content:n})},this.source.onerror=function(){n.dispatchEvent({type:"error",content:n})}}this.imageUrl=null,this._powerOf2=!1}},e.BaseTexture.prototype.constructor=e.BaseTexture,e.EventTarget.mixin(e.BaseTexture.prototype),e.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete e.BaseTextureCache[this.imageUrl],delete e.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},e.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},e.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],n=e.glContexts[t];n&&i&&n.deleteTexture(i)}this._glTextures.length=0,this.dirty()},e.BaseTexture.fromImage=function(t,i,n){var r=e.BaseTextureCache[t];if(void 0===i&&-1===t.indexOf("data:")&&(i=!0),!r){var o=new Image;i&&(o.crossOrigin=""),o.src=t,r=new e.BaseTexture(o,n),r.imageUrl=t,e.BaseTextureCache[t]=r,-1!==t.indexOf(e.RETINA_PREFIX+".")&&(r.resolution=2)}return r},e.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+e.TextureCacheIdGenerator++);var n=e.BaseTextureCache[t._pixiId];return n||(n=new e.BaseTexture(t,i),e.BaseTextureCache[t._pixiId]=n),n},e.TextureCache={},e.FrameCache={},e.TextureCacheIdGenerator=0,e.Texture=function(t,i,n,r){this.noFrame=!1,i||(this.noFrame=!0,i=new e.Rectangle(0,0,1,1)),t instanceof e.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||new e.Rectangle(0,0,1,1),t.hasLoaded?(this.noFrame&&(i=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},e.Texture.prototype.constructor=e.Texture,e.EventTarget.mixin(e.Texture.prototype),e.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},e.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},e.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var t=this.crop,i=this.baseTexture.width,n=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/n,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/n,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/n,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/n},e.Texture.fromImage=function(t,i,n){var r=e.TextureCache[t];return r||(r=new e.Texture(e.BaseTexture.fromImage(t,i,n)),e.TextureCache[t]=r),r},e.Texture.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i},e.Texture.fromCanvas=function(t,i){var n=e.BaseTexture.fromCanvas(t,i);return new e.Texture(n)},e.Texture.addTextureToCache=function(t,i){e.TextureCache[i]=t},e.Texture.removeTextureFromCache=function(t){var i=e.TextureCache[t];return delete e.TextureCache[t],delete e.BaseTextureCache[t],i},e.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},e.Texture.emptyTexture=new e.Texture(new e.BaseTexture),e.RenderTexture=function(t,i,n,r,o){if(this.width=t||100,this.height=i||100,this.resolution=o||1,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new e.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=r||e.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=n||e.defaultRenderer,this.renderer.type===e.WEBGL_RENDERER){var a=this.renderer.gl;this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new e.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new e.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},e.RenderTexture.prototype=Object.create(e.Texture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.resize=function(t,i,n){t===this.width&&i===this.height||(this.valid=t>0&&i>0,this.width=t,this.height=i,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=i*this.resolution,n&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===e.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},e.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1),t.worldAlpha=1;for(var r=t.children,o=0,a=r.length;o<a;o++)r[o].updateTransform();var s=this.renderer.gl;s.viewport(0,0,this.width*this.resolution,this.height*this.resolution),s.bindFramebuffer(s.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},e.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),e&&n.append(e),t.worldAlpha=1;for(var r=t.children,o=0,a=r.length;o<a;o++)r[o].updateTransform();i&&this.textureBuffer.clear();var s=this.textureBuffer.context,l=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,s),this.renderer.resolution=l}},e.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,n=this.textureBuffer.height,r=new Uint8Array(4*i*n);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,r),t.bindFramebuffer(t.FRAMEBUFFER,null);var o=new e.CanvasBuffer(i,n),a=o.context.getImageData(0,0,i,n);return a.data.set(r),o.context.putImageData(a,0,0),o.canvas}return this.textureBuffer.canvas},e.RenderTexture.tempMatrix=new e.Matrix,e.VideoTexture=function(t,i){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),e.BaseTexture.call(this,t,i),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),t.complete||(this._onCanPlay=this.onCanPlay.bind(this),t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this.onPlayStart.bind(this)),t.addEventListener("pause",this.onPlayStop.bind(this)))},e.VideoTexture.prototype=Object.create(e.BaseTexture.prototype),e.VideoTexture.constructor=e.VideoTexture,e.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},e.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},e.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},e.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,
this.dispatchEvent({type:"loaded",content:this}))))},e.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(e.BaseTextureCache[this.source._pixiId]=null,delete e.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),e.BaseTexture.prototype.destroy.call(this)},e.VideoTexture.baseTextureFromVideo=function(t,i){t._pixiId||(t._pixiId="video_"+e.TextureCacheIdGenerator++);var n=e.BaseTextureCache[t._pixiId];return n||(n=new e.VideoTexture(t,i),e.BaseTextureCache[t._pixiId]=n),n},e.VideoTexture.textureFromVideo=function(t,i){var n=e.VideoTexture.baseTextureFromVideo(t,i);return new e.Texture(n)},e.VideoTexture.fromUrl=function(t,i){var n=document.createElement("video");return n.src=t,n.autoPlay=!0,n.play(),e.VideoTexture.textureFromVideo(n,i)},e.AssetLoader=function(t,i){this.assetURLs=t,this.crossorigin=i,this.loadersByType={jpg:e.ImageLoader,jpeg:e.ImageLoader,png:e.ImageLoader,gif:e.ImageLoader,webp:e.ImageLoader,json:e.JsonLoader,atlas:e.AtlasLoader,anim:e.SpineLoader,xml:e.BitmapFontLoader,fnt:e.BitmapFontLoader}},e.EventTarget.mixin(e.AssetLoader.prototype),e.AssetLoader.prototype.constructor=e.AssetLoader,e.AssetLoader.prototype._getDataType=function(t){if("data:"===t.slice(0,"data:".length).toLowerCase()){var e=t.slice("data:".length),i=e.indexOf(",");if(-1===i)return null;var n=e.slice(0,i).split(";")[0];return n&&"text/plain"!==n.toLowerCase()?n.split("/").pop().toLowerCase():"txt"}return null},e.AssetLoader.prototype.load=function(){function t(t){e.onAssetLoaded(t.data.content)}var e=this;this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var n=this.assetURLs[i],r=this._getDataType(n);r||(r=n.split("?").shift().split(".").pop().toLowerCase());var o=this.loadersByType[r];if(!o)throw new Error(r+" is an unsupported file type");var a=new o(n,this.crossorigin);a.on("loaded",t),a.load()}},e.AssetLoader.prototype.onAssetLoaded=function(t){this.loadCount--,this.emit("onProgress",{content:this,loader:t,loaded:this.assetURLs.length-this.loadCount,total:this.assetURLs.length}),this.onProgress&&this.onProgress(t),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},e.JsonLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},e.JsonLoader.prototype.constructor=e.JsonLoader,e.EventTarget.mixin(e.JsonLoader.prototype),e.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},e.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},e.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var t=this.json.meta.image;-1===t.indexOf("data:")&&(t=this.baseUrl+t);var n=new e.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",this.onLoaded.bind(this));for(var o in r){var a=r[o].frame;if(a){var s=new e.Rectangle(a.x,a.y,a.w,a.h),l=s.clone(),h=null;if(r[o].trimmed){var u=r[o].sourceSize,d=r[o].spriteSourceSize;h=new e.Rectangle(d.x,d.y,u.w,u.h)}e.TextureCache[o]=new e.Texture(this.texture,s,l,h)}}n.load()}else if(this.json.bones)if(e.AnimCache[this.url])this.onLoaded();else{var c=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",p=new e.JsonLoader(c,this.crossorigin),g=this;p.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();var t=new e.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),n=new i.Atlas(this.ajaxRequest.responseText,t),r=new i.AtlasAttachmentLoader(n),o=new i.SkeletonJson(r),a=o.readSkeletonData(g.json);e.AnimCache[g.url]=a,g.spine=a,g.spineAtlas=n,g.spineAtlasLoader=p,t.loadingCount>0?t.addEventListener("loadedBaseTexture",function(t){t.content.content.loadingCount<=0&&g.onLoaded()}):g.onLoaded()},p.load()}else this.onLoaded()},e.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},e.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},e.AtlasLoader=function(t,e){this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=e,this.loaded=!1},e.AtlasLoader.constructor=e.AtlasLoader,e.EventTarget.mixin(e.AtlasLoader.prototype),e.AtlasLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},e.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var t=this.ajaxRequest.responseText.split(/\r?\n/),i=-3,n=0,r=null,o=!1,a=0,s=0,l=this.onLoaded.bind(this);for(a=0;a<t.length;a++)if(t[a]=t[a].replace(/^\s+|\s+$/g,""),""===t[a]&&(o=a+1),t[a].length>0){if(o===a)this.atlas.meta.image.push(t[a]),n=this.atlas.meta.image.length-1,this.atlas.frames.push({}),i=-3;else if(i>0)if(i%7==1)null!=r&&(this.atlas.frames[n][r.name]=r),r={name:t[a],frame:{}};else{var h=t[a].split(" ");if(i%7==3)r.frame.x=Number(h[1].replace(",","")),r.frame.y=Number(h[2]);else if(i%7==4)r.frame.w=Number(h[1].replace(",","")),r.frame.h=Number(h[2]);else if(i%7==5){var u={x:0,y:0,w:Number(h[1].replace(",","")),h:Number(h[2])};u.w>r.frame.w||u.h>r.frame.h?(r.trimmed=!0,r.realSize=u):r.trimmed=!1}}i++}if(null!=r&&(this.atlas.frames[n][r.name]=r),this.atlas.meta.image.length>0){for(this.images=[],s=0;s<this.atlas.meta.image.length;s++){var d=this.baseUrl+this.atlas.meta.image[s],c=this.atlas.frames[s];this.images.push(new e.ImageLoader(d,this.crossorigin));for(a in c){var p=c[a].frame;p&&(e.TextureCache[a]=new e.Texture(this.images[s].texture.baseTexture,{x:p.x,y:p.y,width:p.w,height:p.h}),c[a].trimmed&&(e.TextureCache[a].realSize=c[a].realSize,e.TextureCache[a].trim.x=0,e.TextureCache[a].trim.y=0))}}for(this.currentImageId=0,s=0;s<this.images.length;s++)this.images[s].on("loaded",l);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},e.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},e.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},e.SpriteSheetLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},e.SpriteSheetLoader.prototype.constructor=e.SpriteSheetLoader,e.EventTarget.mixin(e.SpriteSheetLoader.prototype),e.SpriteSheetLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json,t.onLoaded()}),i.load()},e.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.ImageLoader=function(t,i){this.texture=e.Texture.fromImage(t,i),this.frames=[]},e.ImageLoader.prototype.constructor=e.ImageLoader,e.EventTarget.mixin(e.ImageLoader.prototype),e.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},e.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,n){this.frames=[];for(var r=Math.floor(this.texture.width/t),o=Math.floor(this.texture.height/i),a=0,s=0;s<o;s++)for(var l=0;l<r;l++,a++){var h=new e.Texture(this.texture.baseTexture,{x:l*t,y:s*i,width:t,height:i});this.frames.push(h),n&&(e.TextureCache[n+"-"+a]=h)}this.load()},e.BitmapFontLoader=function(t,e){this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},e.BitmapFontLoader.prototype.constructor=e.BitmapFontLoader,e.EventTarget.mixin(e.BitmapFontLoader.prototype),e.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new e.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},e.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var t=this.ajaxRequest.responseXML;if(!t||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var i=new DOMParser;t=i.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var n=document.createElement("div");n.innerHTML=this.ajaxRequest.responseText,t=n}var r=this.baseUrl+t.getElementsByTagName("page")[0].getAttribute("file"),o=new e.ImageLoader(r,this.crossorigin);this.texture=o.texture.baseTexture;var a={},s=t.getElementsByTagName("info")[0],l=t.getElementsByTagName("common")[0];a.font=s.getAttribute("face"),a.size=parseInt(s.getAttribute("size"),10),a.lineHeight=parseInt(l.getAttribute("lineHeight"),10),a.chars={};for(var h=t.getElementsByTagName("char"),u=0;u<h.length;u++){var d=parseInt(h[u].getAttribute("id"),10),c=new e.Rectangle(parseInt(h[u].getAttribute("x"),10),parseInt(h[u].getAttribute("y"),10),parseInt(h[u].getAttribute("width"),10),parseInt(h[u].getAttribute("height"),10));a.chars[d]={xOffset:parseInt(h[u].getAttribute("xoffset"),10),yOffset:parseInt(h[u].getAttribute("yoffset"),10),xAdvance:parseInt(h[u].getAttribute("xadvance"),10),kerning:{},texture:e.TextureCache[d]=new e.Texture(this.texture,c)}}var p=t.getElementsByTagName("kerning");for(u=0;u<p.length;u++){var g=parseInt(p[u].getAttribute("first"),10),f=parseInt(p[u].getAttribute("second"),10),y=parseInt(p[u].getAttribute("amount"),10);a.chars[f].kerning[g]=y}e.BitmapText.fonts[a.font]=a,o.addEventListener("loaded",this.onLoaded.bind(this)),o.load()}},e.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},e.SpineLoader=function(t,e){this.url=t,this.crossorigin=e,this.loaded=!1},e.SpineLoader.prototype.constructor=e.SpineLoader,e.EventTarget.mixin(e.SpineLoader.prototype),e.SpineLoader.prototype.load=function(){var t=this,i=new e.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(e){t.json=e.data.content.json,t.onLoaded()}),i.load()},e.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},e.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},e.AbstractFilter.prototype.constructor=e.AbstractFilter,e.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},e.AlphaMaskFilter=function(t){e.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mask.value.x=t.width,this.uniforms.mask.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},e.AlphaMaskFilter.prototype=Object.create(e.AbstractFilter.prototype),e.AlphaMaskFilter.prototype.constructor=e.AlphaMaskFilter,e.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(e.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}}),e.ColorMatrixFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},e.ColorMatrixFilter.prototype=Object.create(e.AbstractFilter.prototype),e.ColorMatrixFilter.prototype.constructor=e.ColorMatrixFilter,Object.defineProperty(e.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=t}}),e.GrayFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},e.GrayFilter.prototype=Object.create(e.AbstractFilter.prototype),e.GrayFilter.prototype.constructor=e.GrayFilter,Object.defineProperty(e.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}),e.DisplacementFilter=function(t){e.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},e.DisplacementFilter.prototype=Object.create(e.AbstractFilter.prototype),e.DisplacementFilter.prototype.constructor=e.DisplacementFilter,e.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(e.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(t){this.uniforms.displacementMap.value=t}}),Object.defineProperty(e.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}}),Object.defineProperty(e.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}),e.PixelateFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new e.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},e.PixelateFilter.prototype=Object.create(e.AbstractFilter.prototype),e.PixelateFilter.prototype.constructor=e.PixelateFilter,Object.defineProperty(e.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.dirty=!0,this.uniforms.pixelSize.value=t}}),e.BlurXFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},e.BlurXFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurXFilter.prototype.constructor=e.BlurXFilter,Object.defineProperty(e.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),e.BlurYFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},e.BlurYFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurYFilter.prototype.constructor=e.BlurYFilter,Object.defineProperty(e.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),e.BlurFilter=function(){this.blurXFilter=new e.BlurXFilter,this.blurYFilter=new e.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},e.BlurFilter.prototype=Object.create(e.AbstractFilter.prototype),e.BlurFilter.prototype.constructor=e.BlurFilter,Object.defineProperty(e.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}}),Object.defineProperty(e.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}}),Object.defineProperty(e.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}),e.InvertFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},e.InvertFilter.prototype=Object.create(e.AbstractFilter.prototype),e.InvertFilter.prototype.constructor=e.InvertFilter,Object.defineProperty(e.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}),e.SepiaFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},e.SepiaFilter.prototype=Object.create(e.AbstractFilter.prototype),e.SepiaFilter.prototype.constructor=e.SepiaFilter,Object.defineProperty(e.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}),e.TwistFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},e.TwistFilter.prototype=Object.create(e.AbstractFilter.prototype),e.TwistFilter.prototype.constructor=e.TwistFilter,Object.defineProperty(e.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(t){this.dirty=!0,this.uniforms.offset.value=t}}),Object.defineProperty(e.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(t){this.dirty=!0,this.uniforms.radius.value=t}}),Object.defineProperty(e.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),e.ColorStepFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},e.ColorStepFilter.prototype=Object.create(e.AbstractFilter.prototype),e.ColorStepFilter.prototype.constructor=e.ColorStepFilter,Object.defineProperty(e.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}),e.DotScreenFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},e.DotScreenFilter.prototype=Object.create(e.AbstractFilter.prototype),e.DotScreenFilter.prototype.constructor=e.DotScreenFilter,Object.defineProperty(e.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(t){this.dirty=!0,this.uniforms.scale.value=t}}),Object.defineProperty(e.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(t){this.dirty=!0,this.uniforms.angle.value=t}}),e.CrossHatchFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},e.CrossHatchFilter.prototype=Object.create(e.AbstractFilter.prototype),e.CrossHatchFilter.prototype.constructor=e.CrossHatchFilter,Object.defineProperty(e.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(t){this.uniforms.blur.value=1/7e3*t}}),e.RGBSplitFilter=function(){e.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},e.RGBSplitFilter.prototype=Object.create(e.AbstractFilter.prototype),e.RGBSplitFilter.prototype.constructor=e.RGBSplitFilter,Object.defineProperty(e.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}}),Object.defineProperty(e.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}}),Object.defineProperty(e.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):void 0!==define&&define.amd?define("pixi",e):t.PIXI=e}.call(this),define("absolute/platform",["pixi","absolute/debug"],function(t,e){var i={artPathPrefix:"art",soundPathPrefix:"sound",maxWidth:window.innerWidth,maxHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio||1,documentRoot:null,getDocumentRoot:function(){if(null===this.documentRoot)if(this.isCordova()){var t=window.location.href.indexOf("/index.html");this.documentRoot=window.location.href.substring(0,t)+"/"}else this.documentRoot="";return this.documentRoot},getClickAction:function(){return this.supportsTouch()?"touchstart":"click"},isCrapAudio:function(){return navigator.userAgent.indexOf("Android")>=0||(navigator.userAgent.indexOf("Silk")>=0||(!!navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i)||!!navigator.userAgent.match(/OS 4(_\d)+ like Mac OS X/i)))},_isiPhone:navigator.userAgent.match(/iPhone/i),_isiPod:navigator.userAgent.match(/iPod/i),_isiPad:navigator.userAgent.match(/iPad/i),_isAndroid:function(){return"android"===this.getMobileUserAgentData().os.toLowerCase()},_isSafari:function(){return navigator.userAgent.toLowerCase().indexOf("safari")>-1&&-1==navigator.userAgent.toLowerCase().indexOf("opera")&&-1==navigator.userAgent.toLowerCase().indexOf("opr")},_isChrome:function(){return navigator.userAgent.indexOf("Android")>=0&&navigator.userAgent.indexOf("CrMo")>=0},_isChromeGeneric:function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&-1==navigator.userAgent.toLowerCase().indexOf("opera")&&-1==navigator.userAgent.toLowerCase().indexOf("opr")},_isIE:function(){return navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0},_isIOS:function(){var t=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),e=navigator.userAgent.toLowerCase();return t||(t=e.indexOf("iphone")>-1||e.indexOf("ipad")>-1||e.indexOf("macintosh")>-1&&"ontouchend"in document),t},_isFirefox:function(){return navigator.userAgent.indexOf("Firefox")>=0},_isWindows:function(){return navigator.userAgent.indexOf("Windows NT")>=0},_isOpera:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("opera")>=0||t.indexOf("opr")>=0},_isMac:function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},_isNodeWebkit:function(){try{return void 0!==require("nw.gui")}catch(t){return!1}},supportsWebGL:function(){return!(this._isStockAndroid()||this._isIE()||this._isWindows()&&this._isFirefox())},supportsTouch:function(){try{return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}catch(t){return!1}},isCordova:function(){return"undefined"!=typeof cordova},isCocoonJS:function(){return"undefined"!=typeof CocoonJS&&CocoonJS.nativeExtensionObjectAvailable},
isNativeMobile:function(){return i.isCordova()||i.isCocoonJS()},isPhone:function(){var t=navigator.userAgent,e=/iPhone|BlackBerry|IEMobile|Opera Mini/i,i=t.match(e);return void 0!==i&&null!==i&&i.length>0},hasChromeTintingBug:function(t,e){var i,n,r=document.createElement("canvas"),o=r.getContext("2d"),a=new Image;r.width=1,r.height=1,a.src=e,a.onload=function(){o.drawImage(a,0,0),i=o.getImageData(0,0,1,1).data,o.fillStyle="#"+("00000"+(0).toString(16)).substr(-6),o.fillRect(0,0,1,1),o.globalCompositeOperation="multiply",o.drawImage(a,0,0),o.globalCompositeOperation="destination-atop",o.drawImage(a,0,0),n=o.getImageData(0,0,1,1).data,t(i[0]==n[0])}},hasPutImageDataBug:function(){var t,e,i=document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=1,t=n.createImageData(1,1),e=t.data,e[0]=e[3]=128,n.putImageData(t,0,0),t=n.getImageData(0,0,1,1),e=t.data,255===e[0]},supportsLayeredDivs:function(){var t=this.getMobileUserAgentData();return!("Android"===t.os&&!/^[3-9](\.[0-9])*$/.test(t.osVersion))},supportsFixedPosition:function(){var t=this.getMobileUserAgentData();return"Android"===t.os&&/^[3-9](\.[0-9])*$/.test(t.osVersion)||"iPhone"===t.os&&/^[5-9]/.test(t.osVersion)||"iPhone"!==t.os&&"Android"!==t.os},supportsDeviceOrientation:function(){return void 0!==window.DeviceOrientationEvent},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},getMobileUserAgentData:function(){for(var t=navigator.userAgent,e={os:"",osVersion:"",browser:"",browserVersion:""},i=[{os:"iPhone",osVersionRegex:/(?:iPhone OS )([0-9,_]*)(?: like)/,browser:"WebKit",browserVersionRegex:/(?:AppleWebKit\/)([0-9,.]*)/},{os:"Android",osVersionRegex:/(?:Android )([0-9,.]*)/,browser:"WebKit",browserVersionRegex:/(?:AppleWebKit\/)([0-9,.]*)/},{os:"Linux",osVersionRegex:/(?:Android )([0-9,.]*)/,browser:"Silk",browserVersionRegex:/(?:Silk\/)([0-9._-]+)/}],n=0,r=i.length;n<r;n++){var o=i[n];if(-1!==t.indexOf(o.os)){e.os=o.os,void 0!==o.osVersionRegex&&(e.osVersion=t.match(o.osVersionRegex)||"0.0",e.osVersion=e.osVersion[1].replace("_",".")),-1!==t.indexOf(o.browser)&&(e.browser=o.browser,void 0!==o.browserVersionRegex&&(e.browserVersion=t.match(o.browserVersionRegex)[1].replace("_",".")));break}}return e},isSilk:function(){return!!/\bSilk\b/.test(navigator.userAgent)},_isOldAndroid:function(){var t=this.getMobileUserAgentData(),e=t.osVersion.split("."),i=0,n=0,r=!1;return("android"===t.os.toLowerCase()||"linux"===t.os.toLowerCase())&&e.length>1&&(i=e[0],n=e[1],(i<4||4==i&&n<=2)&&(r=!0)),r},_isStockAndroid:function(){return this._isAndroid()&&-1==navigator.userAgent.indexOf("Chrome")&&-1==navigator.userAgent.indexOf("Firefox")},getResStepsDown:function(i,n,r){var o=0;return r?(this._isStockAndroid()&&(o=2),o):(t.canUseNewCanvasBlendModes()?n&&this.isPhone()?(e.log("Lowering resClass because this is a phone."),o++):n&&this._isiPad&&i>=3&&(e.log("Lowering resClass because this is an ipad device that can't handle big textures."),o++):(e.log("Lowering resClass because this device does not support canvas blends."),o++),this._isOldAndroid()&&(e.log("Lowering resClass because this is an older android device."),o++),this._isOldAndroid()&&i>=3&&(e.log("Lowering resClass because this is an older android device and it is enormous."),o++),n&&i>=3&&this._isAndroid()&&(e.log("Lowering resClass because this is a hires android device and probably lacks memory."),o=2),n&&0==o&&(o=1),o)},supportsFullscreenApi:function(){return!!(document.documentElement.requestFullscreen||document.documentElement.mozRequestFullScreen||document.documentElement.webkitRequestFullscreen||document.documentElement.msRequestFullscreen)}};return i}),define("absoluteaudio/audio",["absoluteaudio/webaudioclip","absoluteaudio/streamedwebaudioclip","absoluteaudio/html5audioelementclip","absoluteaudio/audiosprite","absoluteaudio/cordovaclip","absoluteaudio/soundmanagerclip","absoluteaudio/debug","absolute/platform"],function(t,e,i,n,r,o,a,s){"use strict";var l=null;return"undefined"!=typeof AudioContext?l=new AudioContext:"undefined"!=typeof webkitAudioContext?l=new webkitAudioContext:"undefined"!=typeof mozAudioContext&&(l=new mozAudioContext),a.enabled&&(l=null),{createAudioClip:function(n,a,h,u){return null!==l?h?new e(n,a,l):new t(n,a,l):"undefined"!=typeof soundManager&&s._isIE()?new o(n,a):"undefined"!=typeof Media?new r(n,a):new i(n,a,u)},createAudioSprite:function(t,e,i){return new n(t,e,i)},usingWebAudio:function(){return null!==l},usingCordovaAudio:function(){return"undefined"!=typeof Media},usingSoundManagerAudio:function(){return"undefined"!=typeof soundManager&&s._isIE()}}}),define("absoluteaudio",["require","absoluteaudio/audio"],function(t){"use strict";return{version:"1.0",context:t("absoluteaudio/audio")}}),define("absolute/storagemanager",["absolute/debug"],function(t){return{prefix:null,store:function(e,i){if(!this.prefix)throw"Error: you must set StorageManager.prefix for this game!";try{localStorage[this.prefix+e]=JSON.stringify(i)}catch(e){t.log("error creating local storage "+e)}},fetch:function(e){if(!this.prefix)throw"Error: you must set StorageManager.prefix for this game!";try{var i=localStorage[this.prefix+e];if(i)return JSON.parse(i)}catch(e){t.log("error accessing local storage "+e)}return null}}}),define("absolute/gameconfig",["absolute/storagemanager"],function(t){return{defaults:{},options:{},reset:function(){this.options=this.defaults,this.save()},load:function(e){if(this.defaults=e,this.options=t.fetch("options")||this.defaults,!this.options.version||this.options.version<this.defaults.version)for(var i in this.defaults)this.defaults.hasOwnProperty(i)&&!this.options.hasOwnProperty(i)&&(this.options[i]=this.defaults[i])},save:function(){t.store("options",this.options)},setVal:function(t,e){this.options[t]=e,this.save()},getVal:function(t){return this.options[t]}}}),define("absolute/audiomanager",["absoluteaudio","absolute/debug","absolute/gameconfig","absolute/platform"],function(t,e,i,n){return{lastPlayed:0,music:null,sounds:{},format:"mp3",sfxEnabled:!0,init:function(t){audioTest=new Audio;var i={m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),mp3:!!audioTest.canPlayType("audio/mpeg;").replace(/^no$/,"")};i.m4a?this.format="m4a":i.ogg?this.format="ogg":i.mp3&&(this.format="mp3"),n._isIE()&&(this.format="mp3"),(n._isOpera()||n._isNodeWebkit()||n._isFirefox())&&(this.format="ogg"),e.log("Audio format "+this.format),t&&"function"==typeof t&&t()},setFormat:function(t){this.format=t},loadSounds:function(e,n,r){if(!e||0==e.length)return void r();this.audioAssets=e,this.usingWebAudio()?this.loadClips(e,n,r):this.createSound({id:"as",url:"as/as",volume:100,onLoad:function(){for(var e=0,o=this.audioAssets.length;e<o;e+=1){var a=this.audioAssets[e],s=this.sounds.as;this.sounds[a.id]=t.context.createAudioSprite(s,a.start,a.end),n(e/o)}n(e/o),this.setSfxEnabled(i.getVal("sfxEnabled")),setTimeout(function(){r()},500)}.bind(this),buffer:!1,loop:!1,duration:0})},loadClips:function(t,n,r){var o=t.length,a=0,s=t[0].lazyload,l=function(){if(++a===o)this.setSfxEnabled(i.getVal("sfxEnabled")),n(a/o),r();else{n(a/o);var h=t[a];s=h.lazyload,s?(e.log("skipped loading sound "+h.id),l()):this.createSound({id:h.id,url:h.url,volume:h.volume,onLoad:l,buffer:!1,loop:h.loop,duration:h.end-h.start})}}.bind(this);s?(e.log("skipped loading sound "+t[0].id),l()):this.createSound({id:t[0].id,url:t[0].url,volume:t[0].volume,onLoad:l,buffer:!1,loop:t[0].loop,duration:t[0].end-t[0].start})},createSound:function(e){var i,r;r=n.getDocumentRoot()+n.soundPathPrefix+"/"+this.format+"/"+e.url+"."+this.format,i=t.context.createAudioClip(r,e.onLoad,!1,e.duration),this.sounds[e.id]=i},soundLoaded:function(t){return void 0!=this.sounds[t]},playSound:function(t,i,n){this.sounds[t]?this.sounds[t].play(n/1e3,this.isMusic(t),i):e.log("Warning: Attempt to play sound that isn't loaded: "+t)},loopSound:function(t,e,i){this.sounds[t]&&this.sounds[t].play(i/1e3,!0,e)},stopSound:function(t){this.sounds[t]&&(this.sounds[t].stopping=!0,this.sounds[t].stop())},stopAll:function(){for(s in this.sounds)this.stopSound(s)},pauseSound:function(t){this.sounds[t]&&this.sounds[t].pause()},muteSound:function(t){this.sounds[t]&&this.sounds[t].mute()},unmuteSound:function(t){this.sounds[t]&&this.sounds[t].unmute()},setSfxEnabled:function(t){this.sfxEnabled=t,i.setVal("sfxEnabled",t),t?this.unmuteAll():this.muteAll()},isSfxEnabled:function(){return this.sfxEnabled},muteAll:function(){for(var t in this.sounds)this.muteSound(t)},unmuteAll:function(){for(s in this.sounds)this.unmuteSound(s)},unmuteAllSfx:function(){for(s in this.sounds)this.isMusic(s)||this.unmuteSound(s)},usingWebAudio:function(){try{return t.context.usingWebAudio()||t.context.usingCordovaAudio()||t.context.usingSoundManagerAudio()}catch(t){return!1}},isMusic:function(t){return-1!==t.indexOf("music")},sfxSupported:function(){return!0},musicSupported:function(){return!0},simulSoundSupport:function(){try{return t.context.usingWebAudio()||t.context.usingCordovaAudio()||t.context.usingSoundManagerAudio()||!i.getVal("musicEnabled")}catch(t){return!1}},primeClips:function(){var t;for(t in this.sounds)this.sounds[t].prime()}}}),function(){function t(t,e){if(t!==e){var i=t===t,n=e===e;if(t>e||!i||void 0===t&&n)return 1;if(t<e||!n||void 0===e&&i)return-1}return 0}function e(t,e,i){if(e!==e)return c(t,i);for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}function i(t){return"function"==typeof t||!1}function n(t){return"string"==typeof t?t:null==t?"":t+""}function r(t){return t.charCodeAt(0)}function o(t,e){for(var i=-1,n=t.length;++i<n&&e.indexOf(t.charAt(i))>-1;);return i}function a(t,e){for(var i=t.length;i--&&e.indexOf(t.charAt(i))>-1;);return i}function s(e,i){return t(e.criteria,i.criteria)||e.index-i.index}function l(e,i,n){for(var r=-1,o=e.criteria,a=i.criteria,s=o.length,l=n.length;++r<s;){var h=t(o[r],a[r]);if(h)return r>=l?h:h*(n[r]?1:-1)}return e.index-i.index}function h(t){return Ot[t]}function u(t){return Bt[t]}function d(t){return"\\"+Nt[t]}function c(t,e,i){for(var n=t.length,r=e+(i?0:-1);i?r--:++r<n;){var o=t[r];if(o!==o)return r}return-1}function p(t){return t&&"object"==typeof t||!1}function g(t){return t<=160&&t>=9&&t<=13||32==t||160==t||5760==t||6158==t||t>=8192&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function f(t,e){for(var i=-1,n=t.length,r=-1,o=[];++i<n;)t[i]===e&&(t[i]=U,o[++r]=i);return o}function y(t,e){for(var i,n=-1,r=t.length,o=-1,a=[];++n<r;){var s=t[n],l=e?e(s,n,t):s;n&&i===l||(i=l,a[++o]=s)}return a}function m(t){for(var e=-1,i=t.length;++e<i&&g(t.charCodeAt(e)););return e}function C(t){for(var e=t.length;e--&&g(t.charCodeAt(e)););return e}function S(t){return Lt[t]}function b(g){function Ot(t){if(p(t)&&!is(t)&&!(t instanceof Rt)){if(t instanceof Lt)return t;if(aa.call(t,"__chain__")&&aa.call(t,"__wrapped__"))return Ri(t)}return new Lt(t)}function Bt(){}function Lt(t,e,i){this.__wrapped__=t,this.__actions__=i||[],this.__chain__=!!e}function Rt(t){this.__wrapped__=t,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=Ba,this.__views__=null}function Nt(){var t=this.__actions__,e=this.__iteratees__,i=this.__views__,n=new Rt(this.__wrapped__);return n.__actions__=t?Qt(t):null,n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=e?Qt(e):null,n.__takeCount__=this.__takeCount__,n.__views__=i?Qt(i):null,n}function Ut(){if(this.__filtered__){var t=new Rt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Vt(){var t=this.__wrapped__.value();if(!is(t))return Je(t,this.__actions__);var e=this.__dir__,i=e<0,n=vi(0,t.length,this.__views__),r=n.start,o=n.end,a=o-r,s=i?o:r-1,l=Da(a,this.__takeCount__),h=this.__iteratees__,u=h?h.length:0,d=0,c=[];t:for(;a--&&d<l;){s+=e;for(var p=-1,g=t[s];++p<u;){var f=h[p],y=f.iteratee,m=f.type;if(m==B){if(f.done&&(i?s>f.index:s<f.index)&&(f.count=0,f.done=!1),f.index=s,!f.done){var C=f.limit;if(!(f.done=C>-1?f.count++>=C:!y(g)))continue t}}else{var S=y(g);if(m==R)g=S;else if(!S){if(m==L)continue t;break t}}}c[d++]=g}return c}function Ht(){this.__data__={}}function Wt(t){return this.has(t)&&delete this.__data__[t]}function jt(t){return"__proto__"==t?v:this.__data__[t]}function Yt(t){return"__proto__"!=t&&aa.call(this.__data__,t)}function Xt(t,e){return"__proto__"!=t&&(this.__data__[t]=e),this}function qt(t){var e=t?t.length:0;for(this.data={hash:_a(null),set:new Sa};e--;)this.push(t[e])}function Zt(t,e){var i=t.data;return("string"==typeof e||kr(e)?i.set.has(e):i.hash[e])?0:-1}function Jt(t){var e=this.data;"string"==typeof t||kr(t)?e.set.add(t):e.hash[t]=!0}function Qt(t,e){var i=-1,n=t.length;for(e||(e=Ko(n));++i<n;)e[i]=t[i];return e}function $t(t,e){for(var i=-1,n=t.length;++i<n&&!1!==e(t[i],i,t););return t}function te(t,e){for(var i=t.length;i--&&!1!==e(t[i],i,t););return t}function ee(t,e){for(var i=-1,n=t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function ie(t,e){for(var i=-1,n=t.length,r=-1,o=[];++i<n;){var a=t[i];e(a,i,t)&&(o[++r]=a)}return o}function ne(t,e){for(var i=-1,n=t.length,r=Ko(n);++i<n;)r[i]=e(t[i],i,t);return r}function re(t){for(var e=-1,i=t.length,n=Oa;++e<i;){var r=t[e];r>n&&(n=r)}return n}function oe(t){for(var e=-1,i=t.length,n=Ba;++e<i;){var r=t[e];r<n&&(n=r)}return n}function ae(t,e,i,n){var r=-1,o=t.length;for(n&&o&&(i=t[++r]);++r<o;)i=e(i,t[r],r,t);return i}function se(t,e,i,n){var r=t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function le(t,e){for(var i=-1,n=t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function he(t,e){return void 0===t?e:t}function ue(t,e,i,n){return void 0!==t&&aa.call(n,i)?t:e}function de(t,e,i){var n=ss(e);if(!i)return pe(e,t,n);for(var r=-1,o=n.length;++r<o;){var a=n[r],s=t[a],l=i(s,e[a],a,t,e);(l===l?l===s:s!==s)&&(void 0!==s||a in t)||(t[a]=l)}return t}function ce(t,e){for(var i=-1,n=t.length,r=Ai(n),o=e.length,a=Ko(o);++i<o;){var s=e[i];r?(s=parseFloat(s),a[i]=_i(s,n)?t[s]:v):a[i]=t[s]}return a}function pe(t,e,i){i||(i=e,e={});for(var n=-1,r=i.length;++n<r;){var o=i[n];e[o]=t[o]}return e}function ge(t,e){for(var i=-1,n=e.length;++i<n;){var r=e[i];t[r]=gi(t[r],x,t)}return t}function fe(t,e,i){var n=typeof t;return"function"==n?void 0!==e&&Mi(t)?ti(t,e,i):t:null==t?Fo:"object"==n?Le(t):void 0===e?Ve(t+""):Re(t+"",e)}function ye(t,e,i,n,r,o,a){var s;if(i&&(s=r?i(t,n,r):i(t)),void 0!==s)return s;if(!kr(t))return t;var l=is(t);if(l){if(s=wi(t),!e)return Qt(t,s)}else{var h=la.call(t),u=h==j;if(h!=X&&h!=V&&(!u||r))return It[h]?Ti(t,h,e):r?t:{};if(s=xi(u?{}:t),!e)return pe(t,s,ss(t))}o||(o=[]),a||(a=[]);for(var d=o.length;d--;)if(o[d]==t)return a[d];return o.push(t),a.push(s),(l?$t:ke)(t,function(n,r){s[r]=ye(n,e,i,r,t,o,a)}),s}function me(t,e,i,n){if("function"!=typeof t)throw new $o(N);return ba(function(){t.apply(v,ze(i,n))},e)}function Ce(t,i){var n=t?t.length:0,r=[];if(!n)return r;var o=-1,a=bi(),s=a==e,l=s&&i.length>=200?ja(i):null,h=i.length;l&&(a=Zt,s=!1,i=l);t:for(;++o<n;){var u=t[o];if(s&&u===u){for(var d=h;d--;)if(i[d]===u)continue t;r.push(u)}else a(i,u,0)<0&&r.push(u)}return r}function Se(t,e){var i=t?t.length:0;if(!Ai(i))return ke(t,e);for(var n=-1,r=Li(t);++n<i&&!1!==e(r[n],n,r););return t}function be(t,e){var i=t?t.length:0;if(!Ai(i))return De(t,e);for(var n=Li(t);i--&&!1!==e(n[i],i,n););return t}function ve(t,e){var i=!0;return Se(t,function(t,n,r){return i=!!e(t,n,r)}),i}function we(t,e,i,n){var r=t.length;for(i=null==i?0:+i||0,i<0&&(i=-i>r?0:r+i),n=void 0===n||n>r?r:+n||0,n<0&&(n+=r),r=i>n?0:n>>>0,i>>>=0;i<r;)t[i++]=e;return t}function xe(t,e){var i=[];return Se(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i}function Te(t,e,i,n){var r;return i(t,function(t,i,o){if(e(t,i,o))return r=n?i:t,!1}),r}function Me(t,e,i,n){for(var r=n-1,o=t.length,a=-1,s=[];++r<o;){var l=t[r];if(p(l)&&Ai(l.length)&&(is(l)||wr(l))){e&&(l=Me(l,e,i,0));var h=-1,u=l.length;for(s.length+=u;++h<u;)s[++a]=l[h]}else i||(s[++a]=l)}return s}function _e(t,e,i){for(var n=-1,r=Li(t),o=i(t),a=o.length;++n<a;){var s=o[n];if(!1===e(r[s],s,r))break}return t}function Pe(t,e,i){for(var n=Li(t),r=i(t),o=r.length;o--;){var a=r[o];if(!1===e(n[a],a,n))break}return t}function Ae(t,e){return _e(t,e,Qr)}function ke(t,e){return _e(t,e,ss)}function De(t,e){return Pe(t,e,ss)}function Fe(t,e){for(var i=-1,n=e.length,r=-1,o=[];++i<n;){var a=e[i];rs(t[a])&&(o[++r]=a)}return o}function Ee(t,e,i){var n=-1,r="function"==typeof e,o=t?t.length:0,a=Ai(o)?Ko(o):[];return Se(t,function(t){var o=r?e:null!=t&&t[e];a[++n]=o?o.apply(t,i):v}),a}function Ie(t,e,i,n,r,o){if(t===e)return 0!==t||1/t==1/e;var a=typeof t,s=typeof e;return"function"!=a&&"object"!=a&&"function"!=s&&"object"!=s||null==t||null==e?t!==t&&e!==e:Ge(t,e,Ie,i,n,r,o)}function Ge(t,e,i,n,r,o,a){var s=is(t),l=is(e),h=H,u=H;s||(h=la.call(t),h==V?h=X:h!=X&&(s=Lr(t))),l||(u=la.call(e),u==V?u=X:u!=X&&(l=Lr(e)));var d=h==X,c=u==X,p=h==u;if(p&&!s&&!d)return yi(t,e,h);var g=d&&aa.call(t,"__wrapped__"),f=c&&aa.call(e,"__wrapped__");if(g||f)return i(g?t.value():t,f?e.value():e,n,r,o,a);if(!p)return!1;o||(o=[]),a||(a=[]);for(var y=o.length;y--;)if(o[y]==t)return a[y]==e;o.push(t),a.push(e);var m=(s?fi:mi)(t,e,i,n,r,o,a);return o.pop(),a.pop(),m}function Oe(t,e,i,n,r){var o=e.length;if(null==t)return!o;for(var a=-1,s=!r;++a<o;)if(s&&n[a]?i[a]!==t[e[a]]:!aa.call(t,e[a]))return!1;for(a=-1;++a<o;){var l=e[a];if(s&&n[a])var h=aa.call(t,l);else{var u=t[l],d=i[a];h=r?r(u,d,l):v,void 0===h&&(h=Ie(d,u,r,!0))}if(!h)return!1}return!0}function Be(t,e){var i=[];return Se(t,function(t,n,r){i.push(e(t,n,r))}),i}function Le(t){var e=ss(t),i=e.length;if(1==i){var n=e[0],r=t[n];if(ki(r))return function(t){return null!=t&&t[n]===r&&aa.call(t,n)}}for(var o=Ko(i),a=Ko(i);i--;)r=t[e[i]],o[i]=r,a[i]=ki(r);return function(t){return Oe(t,e,o,a)}}function Re(t,e){return ki(e)?function(i){return null!=i&&i[t]===e}:function(i){return null!=i&&Ie(e,i[t],null,!0)}}function Ne(t,e,i,n,r){if(!kr(t))return t;var o=Ai(e.length)&&(is(e)||Lr(e));return(o?$t:ke)(e,function(e,a,s){if(p(e))return n||(n=[]),r||(r=[]),Ue(t,s,a,Ne,i,n,r);var l=t[a],h=i?i(l,e,a,t,s):v,u=void 0===h;u&&(h=e),!o&&void 0===h||!u&&(h===h?h===l:l!==l)||(t[a]=h)}),t}function Ue(t,e,i,n,r,o,a){for(var s=o.length,l=e[i];s--;)if(o[s]==l)return void(t[i]=a[s]);var h=t[i],u=r?r(h,l,i,t,e):v,d=void 0===u;d&&(u=l,Ai(l.length)&&(is(l)||Lr(l))?u=is(h)?h:h?Qt(h):[]:os(l)||wr(l)?u=wr(h)?Ur(h):os(h)?h:{}:d=!1),o.push(l),a.push(u),d?t[i]=n(u,l,r,o,a):(u===u?u!==h:h===h)&&(t[i]=u)}function Ve(t){return function(e){return null==e?v:e[t]}}function He(e,i){var n=i.length,r=ce(e,i);for(i.sort(t);n--;){var o=parseFloat(i[n]);if(o!=a&&_i(o)){var a=o;va.call(e,o,1)}}return r}function We(t,e){return t+fa(Ga()*(e-t+1))}function Ke(t,e,i,n,r){return r(t,function(t,r,o){i=n?(n=!1,t):e(i,t,r,o)}),i}function ze(t,e,i){var n=-1,r=t.length;e=null==e?0:+e||0,e<0&&(e=-e>r?0:r+e),i=void 0===i||i>r?r:+i||0,i<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var o=Ko(r);++n<r;)o[n]=t[n+e];return o}function je(t,e){var i;return Se(t,function(t,n,r){return!(i=e(t,n,r))}),!!i}function Ye(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}function Xe(t,e,i){var n=-1,r=t.length,o=Ai(r)?Ko(r):[];return Se(t,function(t){for(var i=e.length,r=Ko(i);i--;)r[i]=null==t?v:t[e[i]];o[++n]={criteria:r,index:n,value:t}}),Ye(o,function(t,e){return l(t,e,i)})}function qe(t,i){var n=-1,r=bi(),o=t.length,a=r==e,s=a&&o>=200,l=s?ja():null,h=[];l?(r=Zt,a=!1):(s=!1,l=i?[]:h);t:for(;++n<o;){var u=t[n],d=i?i(u,n,t):u;if(a&&u===u){for(var c=l.length;c--;)if(l[c]===d)continue t;i&&l.push(d),h.push(u)}else r(l,d,0)<0&&((i||s)&&l.push(d),h.push(u))}return h}function Ze(t,e){for(var i=-1,n=e.length,r=Ko(n);++i<n;)r[i]=t[e[i]];return r}function Je(t,e){var i=t;i instanceof Rt&&(i=i.value());for(var n=-1,r=e.length;++n<r;){var o=[i],a=e[n];ma.apply(o,a.args),i=a.func.apply(a.thisArg,o)}return i}function Qe(t,e,i){var n=0,r=t?t.length:n;if("number"==typeof e&&e===e&&r<=Na){for(;n<r;){var o=n+r>>>1,a=t[o];(i?a<=e:a<e)?n=o+1:r=o}return r}return $e(t,e,Fo,i)}function $e(t,e,i,n){e=i(e);for(var r=0,o=t?t.length:0,a=e!==e,s=void 0===e;r<o;){var l=fa((r+o)/2),h=i(t[l]),u=h===h;if(a)var d=u||n;else d=s?u&&(n||void 0!==h):n?h<=e:h<e;d?r=l+1:o=l}return Da(o,Ra)}function ti(t,e,i){if("function"!=typeof t)return Fo;if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)};case 5:return function(i,n,r,o,a){return t.call(e,i,n,r,o,a)}}return function(){return t.apply(e,arguments)}}function ei(t){return ca.call(t,0)}function ii(t,e,i){for(var n=i.length,r=-1,o=ka(t.length-n,0),a=-1,s=e.length,l=Ko(o+s);++a<s;)l[a]=e[a];for(;++r<n;)l[i[r]]=t[r];for(;o--;)l[a++]=t[r++];return l}function ni(t,e,i){for(var n=-1,r=i.length,o=-1,a=ka(t.length-r,0),s=-1,l=e.length,h=Ko(a+l);++o<a;)h[o]=t[o];for(var u=o;++s<l;)h[u+s]=e[s];for(;++n<r;)h[u+i[n]]=t[o++];return h}function ri(t,e){return function(i,n,r){var o=e?e():{};if(n=Si(n,r,3),is(i))for(var a=-1,s=i.length;++a<s;){var l=i[a];t(o,l,n(l,a,i),i)}else Se(i,function(e,i,r){t(o,e,n(e,i,r),r)});return o}}function oi(t){return function(){var e=arguments,i=e.length,n=e[0];if(i<2||null==n)return n;var r=e[i-2],o=e[i-1],a=e[3];i>3&&"function"==typeof r?(r=ti(r,o,5),i-=2):(r=i>2&&"function"==typeof o?o:null,i-=r?1:0),a&&Pi(e[1],e[2],a)&&(r=3==i?null:r,i=2);for(var s=0;++s<i;){var l=e[s];l&&t(n,l,r)}return n}}function ai(t,e){function i(){return(this&&this!==Kt&&this instanceof i?n:t).apply(e,arguments)}var n=hi(t);return i}function si(t){return function(){var e=arguments.length,i=e,n=t?e-1:0;if(!e)return function(){return arguments[0]};for(var r=Ko(e);i--;)if(r[i]=arguments[i],"function"!=typeof r[i])throw new $o(N);return function(){for(var i=n,o=r[i].apply(this,arguments);t?i--:++i<e;)o=r[i].call(this,o);return o}}}function li(t){return function(e){for(var i=-1,n=Po(uo(e)),r=n.length,o="";++i<r;)o=t(o,n[i],i);return o}}function hi(t){return function(){var e=Ka(t.prototype),i=t.apply(e,arguments);return kr(i)?i:e}}function ui(t,e){return function(i,n,o){o&&Pi(i,n,o)&&(n=null);var a=Si(),s=null==n;if(a===fe&&s||(s=!1,n=a(n,o,3)),s){var l=is(i);if(l||!Br(i))return t(l?i:Bi(i));n=r}return Ci(i,n,e)}}function di(t,e,i,n,r,o,a,s,l,h){function u(){for(var b=arguments.length,v=b,w=Ko(b);v--;)w[v]=arguments[v];if(n&&(w=ii(w,n,r)),o&&(w=ni(w,o,a)),g||m){var M=u.placeholder,_=f(w,M);if((b-=_.length)<h){var P=s?Qt(s):null,D=ka(h-b,0),F=g?_:null,E=g?null:_,I=g?w:null,G=g?null:w;e|=g?A:k,e&=~(g?k:A),y||(e&=~(x|T));var O=di(t,e,i,I,F,G,E,P,l,D);return O.placeholder=M,O}}var B=c?i:this;return p&&(t=B[S]),s&&(w=Ii(w,s)),d&&l<w.length&&(w.length=l),(this&&this!==Kt&&this instanceof u?C||hi(t):t).apply(B,w)}var d=e&F,c=e&x,p=e&T,g=e&_,y=e&M,m=e&P,C=!p&&hi(t),S=t;return u}function ci(t,e,i){var n=t.length;if(e=+e,n>=e||!Pa(e))return"";var r=e-n;return i=null==i?" ":i+"",So(i,pa(r/i.length)).slice(0,r)}function pi(t,e,i,n){function r(){for(var e=-1,s=arguments.length,l=-1,h=n.length,u=Ko(s+h);++l<h;)u[l]=n[l];for(;s--;)u[l++]=arguments[++e];return(this&&this!==Kt&&this instanceof r?a:t).apply(o?i:this,u)}var o=e&x,a=hi(t);return r}function gi(t,e,i,n,r,o,a,s){var l=e&T;if(!l&&"function"!=typeof t)throw new $o(N);var h=n?n.length:0;if(h||(e&=~(A|k),n=r=null),h-=r?r.length:0,e&k){var u=n,d=r;n=r=null}var c=!l&&Ya(t),p=[t,e,i,n,r,u,d,o,a,s];if(c&&!0!==c&&(Di(p,c),e=p[1],s=p[9]),p[9]=null==s?l?0:t.length:ka(s-h,0)||0,e==x)var g=ai(p[0],p[2]);else g=e!=A&&e!=(x|A)||p[4].length?di.apply(v,p):pi.apply(v,p);return(c?za:Xa)(g,p)}function fi(t,e,i,n,r,o,a){var s=-1,l=t.length,h=e.length,u=!0;if(l!=h&&!(r&&h>l))return!1;for(;u&&++s<l;){var d=t[s],c=e[s];if(u=v,n&&(u=r?n(c,d,s):n(d,c,s)),void 0===u)if(r)for(var p=h;p--&&(c=e[p],!(u=d&&d===c||i(d,c,n,r,o,a))););else u=d&&d===c||i(d,c,n,r,o,a)}return!!u}function yi(t,e,i){switch(i){case W:case K:return+t==+e;case z:return t.name==e.name&&t.message==e.message;case Y:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case q:case Z:return t==e+""}return!1}function mi(t,e,i,n,r,o,a){var s=ss(t),l=s.length;if(l!=ss(e).length&&!r)return!1;for(var h,u=-1;++u<l;){var d=s[u],c=aa.call(e,d);if(c){var p=t[d],g=e[d];c=v,n&&(c=r?n(g,p,d):n(p,g,d)),void 0===c&&(c=p&&p===g||i(p,g,n,r,o,a))}if(!c)return!1;h||(h="constructor"==d)}if(!h){var f=t.constructor,y=e.constructor;if(f!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof f&&f instanceof f&&"function"==typeof y&&y instanceof y))return!1}return!0}function Ci(t,e,i){var n=i?Ba:Oa,r=n,o=r;return Se(t,function(t,a,s){var l=e(t,a,s);((i?l<r:l>r)||l===n&&l===o)&&(r=l,o=t)}),o}function Si(t,e,i){var n=Ot.callback||ko;return n=n===ko?fe:n,i?n(t,e,i):n}function bi(t,i,n){var r=Ot.indexOf||Qi;return r=r===Qi?e:r,t?r(t,i,n):r}function vi(t,e,i){for(var n=-1,r=i?i.length:0;++n<r;){var o=i[n],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Da(e,t+a);break;case"takeRight":t=ka(t,e-a)}}return{start:t,end:e}}function wi(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&aa.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function xi(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Zo),new e}function Ti(t,e,i){var n=t.constructor;switch(e){case J:return ei(t);case W:case K:return new n(+t);case Q:case $:case tt:case et:case it:case nt:case rt:case ot:case at:var r=t.buffer;return new n(i?ei(r):r,t.byteOffset,t.length);case Y:case Z:return new n(t);case q:var o=new n(t.source,Ct.exec(t));o.lastIndex=t.lastIndex}return o}function Mi(t){var e=Ot.support,i=!(e.funcNames?t.name:e.funcDecomp);if(!i){var n=ra.call(t);e.funcNames||(i=!St.test(n)),i||(i=_t.test(n)||Er(t),za(t,i))}return i}function _i(t,e){return t=+t,e=null==e?Va:e,t>-1&&t%1==0&&t<e}function Pi(t,e,i){if(!kr(i))return!1;var n=typeof e;if("number"==n)var r=i.length,o=Ai(r)&&_i(e,r);else o="string"==n&&e in i;if(o){var a=i[e];return t===t?t===a:a!==a}return!1}function Ai(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Va}function ki(t){return t===t&&(0===t?1/t>0:!kr(t))}function Di(t,e){var i=t[1],n=e[1],r=i|n,o=F|D,a=x|T,s=o|a|M|P,l=i&F&&!(n&F),h=i&D&&!(n&D),u=(h?t:e)[7],d=(l?t:e)[8],c=!(i>=D&&n>a||i>a&&n>=D),p=r>=o&&r<=s&&(i<D||(h||l)&&u.length<=d);if(!c&&!p)return t;n&x&&(t[2]=e[2],r|=i&x?0:M);var g=e[3];if(g){var y=t[3];t[3]=y?ii(y,g,e[4]):Qt(g),t[4]=y?f(t[3],U):Qt(e[4])}return g=e[5],g&&(y=t[5],t[5]=y?ni(y,g,e[6]):Qt(g),t[6]=y?f(t[5],U):Qt(e[6])),g=e[7],g&&(t[7]=Qt(g)),n&F&&(t[8]=null==t[8]?e[8]:Da(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r,t}function Fi(t,e){t=Li(t);for(var i=-1,n=e.length,r={};++i<n;){var o=e[i];o in t&&(r[o]=t[o])}return r}function Ei(t,e){var i={};return Ae(t,function(t,n,r){e(t,n,r)&&(i[n]=t)}),i}function Ii(t,e){for(var i=t.length,n=Da(e.length,i),r=Qt(t);n--;){var o=e[n];t[n]=_i(o,i)?r[o]:v}return t}function Gi(t){var e;Ot.support;if(!p(t)||la.call(t)!=X||!aa.call(t,"constructor")&&"function"==typeof(e=t.constructor)&&!(e instanceof e))return!1;var i;return Ae(t,function(t,e){i=e}),void 0===i||aa.call(t,i)}function Oi(t){for(var e=Qr(t),i=e.length,n=i&&t.length,r=Ot.support,o=n&&Ai(n)&&(is(t)||r.nonEnumArgs&&wr(t)),a=-1,s=[];++a<i;){var l=e[a];(o&&_i(l,n)||aa.call(t,l))&&s.push(l)}return s}function Bi(t){return null==t?[]:Ai(t.length)?kr(t)?t:Zo(t):oo(t)}function Li(t){return kr(t)?t:Zo(t)}function Ri(t){return t instanceof Rt?t.clone():new Lt(t.__wrapped__,t.__chain__,Qt(t.__actions__))}function Ni(t,e,i){e=(i?Pi(t,e,i):null==e)?1:ka(+e||1,1);for(var n=0,r=t?t.length:0,o=-1,a=Ko(pa(r/e));n<r;)a[++o]=ze(t,n,n+=e);return a}function Ui(t){for(var e=-1,i=t?t.length:0,n=-1,r=[];++e<i;){var o=t[e];o&&(r[++n]=o)}return r}function Vi(){for(var t=arguments,e=-1,i=t.length;++e<i;){var n=t[e];if(is(n)||wr(n))break}return Ce(n,Me(t,!1,!0,++e))}function Hi(t,e,i){return(t?t.length:0)?((i?Pi(t,e,i):null==e)&&(e=1),ze(t,e<0?0:e)):[]}function Wi(t,e,i){var n=t?t.length:0;return n?((i?Pi(t,e,i):null==e)&&(e=1),e=n-(+e||0),ze(t,0,e<0?0:e)):[]}function Ki(t,e,i){var n=t?t.length:0;if(!n)return[];for(e=Si(e,i,3);n--&&e(t[n],n,t););return ze(t,0,n+1)}function zi(t,e,i){var n=t?t.length:0;if(!n)return[];var r=-1;for(e=Si(e,i,3);++r<n&&e(t[r],r,t););return ze(t,r)}function ji(t,e,i,n){var r=t?t.length:0;return r?(i&&"number"!=typeof i&&Pi(t,e,i)&&(i=0,n=r),we(t,e,i,n)):[]}function Yi(t,e,i){var n=-1,r=t?t.length:0;for(e=Si(e,i,3);++n<r;)if(e(t[n],n,t))return n;return-1}function Xi(t,e,i){var n=t?t.length:0;for(e=Si(e,i,3);n--;)if(e(t[n],n,t))return n;return-1}function qi(t){return t?t[0]:v}function Zi(t,e,i){var n=t?t.length:0;return i&&Pi(t,e,i)&&(e=!1),n?Me(t,e,!1,0):[]}function Ji(t){return(t?t.length:0)?Me(t,!0,!1,0):[]}function Qi(t,i,n){var r=t?t.length:0;if(!r)return-1;if("number"==typeof n)n=n<0?ka(r+n,0):n;else if(n){var o=Qe(t,i),a=t[o];return(i===i?i===a:a!==a)?o:-1}return e(t,i,n||0)}function $i(t){return Wi(t,1)}function tn(){for(var t=[],i=-1,n=arguments.length,r=[],o=bi(),a=o==e;++i<n;){var s=arguments[i];(is(s)||wr(s))&&(t.push(s),r.push(a&&s.length>=120?ja(i&&s):null))}n=t.length;var l=t[0],h=-1,u=l?l.length:0,d=[],c=r[0];t:for(;++h<u;)if(s=l[h],(c?Zt(c,s):o(d,s,0))<0){for(i=n;--i;){var p=r[i];if((p?Zt(p,s):o(t[i],s,0))<0)continue t}c&&c.push(s),d.push(s)}return d}function en(t){var e=t?t.length:0;return e?t[e-1]:v}function nn(t,e,i){var n=t?t.length:0;if(!n)return-1;var r=n;if("number"==typeof i)r=(i<0?ka(n+i,0):Da(i||0,n-1))+1;else if(i){r=Qe(t,e,!0)-1;var o=t[r];return(e===e?e===o:o!==o)?r:-1}if(e!==e)return c(t,r,!0);for(;r--;)if(t[r]===e)return r;return-1}function rn(){var t=arguments,e=t[0];if(!e||!e.length)return e;for(var i=0,n=bi(),r=t.length;++i<r;)for(var o=0,a=t[i];(o=n(e,a,o))>-1;)va.call(e,o,1);return e}function on(t){return He(t||[],Me(arguments,!1,!1,1))}function an(t,e,i){var n=-1,r=t?t.length:0,o=[];for(e=Si(e,i,3);++n<r;){var a=t[n];e(a,n,t)&&(o.push(a),va.call(t,n--,1),r--)}return o}function sn(t){return Hi(t,1)}function ln(t,e,i){var n=t?t.length:0;return n?(i&&"number"!=typeof i&&Pi(t,e,i)&&(e=0,i=n),ze(t,e,i)):[]}function hn(t,e,i,n){var r=Si(i);return r===fe&&null==i?Qe(t,e):$e(t,e,r(i,n,1))}function un(t,e,i,n){var r=Si(i);return r===fe&&null==i?Qe(t,e,!0):$e(t,e,r(i,n,1),!0)}function dn(t,e,i){return(t?t.length:0)?((i?Pi(t,e,i):null==e)&&(e=1),ze(t,0,e<0?0:e)):[]}function cn(t,e,i){var n=t?t.length:0;return n?((i?Pi(t,e,i):null==e)&&(e=1),e=n-(+e||0),ze(t,e<0?0:e)):[]}function pn(t,e,i){var n=t?t.length:0;if(!n)return[];for(e=Si(e,i,3);n--&&e(t[n],n,t););return ze(t,n+1)}function gn(t,e,i){var n=t?t.length:0;if(!n)return[];var r=-1;for(e=Si(e,i,3);++r<n&&e(t[r],r,t););return ze(t,0,r)}function fn(){return qe(Me(arguments,!1,!0,0))}function yn(t,i,n,r){if(!(t?t.length:0))return[];null!=i&&"boolean"!=typeof i&&(r=n,n=Pi(t,i,r)?null:i,i=!1);var o=Si();return o===fe&&null==n||(n=o(n,r,3)),i&&bi()==e?y(t,n):qe(t,n)}function mn(t){for(var e=-1,i=(t&&t.length&&re(ne(t,oa)))>>>0,n=Ko(i);++e<i;)n[e]=ne(t,Ve(e));return n}function Cn(t){return Ce(t,ze(arguments,1))}function Sn(){for(var t=-1,e=arguments.length;++t<e;){var i=arguments[t];if(is(i)||wr(i))var n=n?Ce(n,i).concat(Ce(i,n)):i}return n?qe(n):[]}function bn(){for(var t=arguments.length,e=Ko(t);t--;)e[t]=arguments[t];return mn(e)}function vn(t,e){var i=-1,n=t?t.length:0,r={};for(!n||e||is(t[0])||(e=[]);++i<n;){var o=t[i];e?r[o]=e[i]:o&&(r[o[0]]=o[1])}return r}function wn(t){var e=Ot(t);return e.__chain__=!0,e}function xn(t,e,i){return e.call(i,t),t}function Tn(t,e,i){return e.call(i,t)}function Mn(){return wn(this)}function _n(){return new Lt(this.value(),this.__chain__)}function Pn(t){for(var e,i=this;i instanceof Bt;){var n=Ri(i);e?r.__wrapped__=n:e=n;var r=n;i=i.__wrapped__}return r.__wrapped__=t,e}function An(){var t=this.__wrapped__
;return t instanceof Rt?(this.__actions__.length&&(t=new Rt(this)),new Lt(t.reverse(),this.__chain__)):this.thru(function(t){return t.reverse()})}function kn(){return this.value()+""}function Dn(){return Je(this.__wrapped__,this.__actions__)}function Fn(t){return Ai(t?t.length:0)&&(t=Bi(t)),ce(t,Me(arguments,!1,!1,1))}function En(t,e,i){var n=is(t)?ee:ve;return"function"==typeof e&&void 0===i||(e=Si(e,i,3)),n(t,e)}function In(t,e,i){var n=is(t)?ie:xe;return e=Si(e,i,3),n(t,e)}function Gn(t,e,i){if(is(t)){var n=Yi(t,e,i);return n>-1?t[n]:v}return e=Si(e,i,3),Te(t,e,Se)}function On(t,e,i){return e=Si(e,i,3),Te(t,e,be)}function Bn(t,e){return Gn(t,Le(e))}function Ln(t,e,i){return"function"==typeof e&&void 0===i&&is(t)?$t(t,e):Se(t,ti(e,i,3))}function Rn(t,e,i){return"function"==typeof e&&void 0===i&&is(t)?te(t,e):be(t,ti(e,i,3))}function Nn(t,e,i){var n=t?t.length:0;return Ai(n)||(t=oo(t),n=t.length),!!n&&(i="number"==typeof i?i<0?ka(n+i,0):i||0:0,"string"==typeof t||!is(t)&&Br(t)?i<n&&t.indexOf(e,i)>-1:bi(t,e,i)>-1)}function Un(t,e){return Ee(t,e,ze(arguments,2))}function Vn(t,e,i){var n=is(t)?ne:Be;return e=Si(e,i,3),n(t,e)}function Hn(t,e){return Vn(t,Ve(e))}function Wn(t,e,i,n){return(is(t)?ae:Ke)(t,Si(e,n,4),i,arguments.length<3,Se)}function Kn(t,e,i,n){return(is(t)?se:Ke)(t,Si(e,n,4),i,arguments.length<3,be)}function zn(t,e,i){var n=is(t)?ie:xe;return e=Si(e,i,3),n(t,function(t,i,n){return!e(t,i,n)})}function jn(t,e,i){if(i?Pi(t,e,i):null==e){t=Bi(t);var n=t.length;return n>0?t[We(0,n-1)]:v}var r=Yn(t);return r.length=Da(e<0?0:+e||0,r.length),r}function Yn(t){t=Bi(t);for(var e=-1,i=t.length,n=Ko(i);++e<i;){var r=We(0,e);e!=r&&(n[e]=n[r]),n[r]=t[e]}return n}function Xn(t){var e=t?t.length:0;return Ai(e)?e:ss(t).length}function qn(t,e,i){var n=is(t)?le:je;return"function"==typeof e&&void 0===i||(e=Si(e,i,3)),n(t,e)}function Zn(t,e,i){if(null==t)return[];var n=-1,r=t.length,o=Ai(r)?Ko(r):[];return i&&Pi(t,e,i)&&(e=null),e=Si(e,i,3),Se(t,function(t,i,r){o[++n]={criteria:e(t,i,r),index:n,value:t}}),Ye(o,s)}function Jn(t){if(null==t)return[];var e=arguments,i=e[3];return i&&Pi(e[1],e[2],i)&&(e=[t,e[1]]),Xe(t,Me(e,!1,!1,1),[])}function Qn(t,e,i,n){return null==t?[]:(n&&Pi(e,i,n)&&(i=null),is(e)||(e=null==e?[]:[e]),is(i)||(i=null==i?[]:[i]),Xe(t,e,i))}function $n(t,e){return In(t,Le(e))}function tr(t,e){if("function"!=typeof e){if("function"!=typeof t)throw new $o(N);var i=t;t=e,e=i}return t=Pa(t=+t)?t:0,function(){if(--t<1)return e.apply(this,arguments)}}function er(t,e,i){return i&&Pi(t,e,i)&&(e=null),e=t&&null==e?t.length:ka(+e||0,0),gi(t,F,null,null,null,null,e)}function ir(t,e){var i;if("function"!=typeof e){if("function"!=typeof t)throw new $o(N);var n=t;t=e,e=n}return function(){return--t>0?i=e.apply(this,arguments):e=null,i}}function nr(t,e){var i=x;if(arguments.length>2){var n=ze(arguments,2),r=f(n,nr.placeholder);i|=A}return gi(t,i,e,n,r)}function rr(t){return ge(t,arguments.length>1?Me(arguments,!1,!1,1):qr(t))}function or(t,e){var i=x|T;if(arguments.length>2){var n=ze(arguments,2),r=f(n,or.placeholder);i|=A}return gi(e,i,t,n,r)}function ar(t,e,i){i&&Pi(t,e,i)&&(e=null);var n=gi(t,_,null,null,null,null,null,e);return n.placeholder=ar.placeholder,n}function sr(t,e,i){i&&Pi(t,e,i)&&(e=null);var n=gi(t,P,null,null,null,null,null,e);return n.placeholder=sr.placeholder,n}function lr(t,e,i){function n(){c&&ga(c),l&&ga(l),l=c=p=v}function r(){var i=e-($a()-u);if(i<=0||i>e){l&&ga(l);var n=p;l=c=p=v,n&&(g=$a(),h=t.apply(d,s),c||l||(s=d=null))}else c=ba(r,i)}function o(){c&&ga(c),l=c=p=v,(y||f!==e)&&(g=$a(),h=t.apply(d,s),c||l||(s=d=null))}function a(){if(s=arguments,u=$a(),d=this,p=y&&(c||!m),!1===f)var i=m&&!c;else{l||m||(g=u);var n=f-(u-g),a=n<=0||n>f;a?(l&&(l=ga(l)),g=u,h=t.apply(d,s)):l||(l=ba(o,n))}return a&&c?c=ga(c):c||e===f||(c=ba(r,e)),i&&(a=!0,h=t.apply(d,s)),!a||c||l||(s=d=null),h}var s,l,h,u,d,c,p,g=0,f=!1,y=!0;if("function"!=typeof t)throw new $o(N);if(e=e<0?0:+e||0,!0===i){var m=!0;y=!1}else kr(i)&&(m=i.leading,f="maxWait"in i&&ka(+i.maxWait||0,e),y="trailing"in i?i.trailing:y);return a.cancel=n,a}function hr(t){return me(t,1,arguments,1)}function ur(t,e){return me(t,e,arguments,2)}function dr(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new $o(N);var i=function(){var n=arguments,r=i.cache,o=e?e.apply(this,n):n[0];if(r.has(o))return r.get(o);var a=t.apply(this,n);return r.set(o,a),a};return i.cache=new dr.Cache,i}function cr(t){if("function"!=typeof t)throw new $o(N);return function(){return!t.apply(this,arguments)}}function pr(t){return ir(t,2)}function gr(t){var e=ze(arguments,1),i=f(e,gr.placeholder);return gi(t,A,null,e,i)}function fr(t){var e=ze(arguments,1),i=f(e,fr.placeholder);return gi(t,k,null,e,i)}function yr(t){var e=Me(arguments,!1,!1,1);return gi(t,D,null,null,null,e)}function mr(t){if("function"!=typeof t)throw new $o(N);return function(e){return t.apply(this,e)}}function Cr(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new $o(N);return!1===i?n=!1:kr(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Gt.leading=n,Gt.maxWait=+e,Gt.trailing=r,lr(t,e,Gt)}function Sr(t,e){return e=null==e?Fo:e,gi(e,A,null,[t],[])}function br(t,e,i,n){return e&&"boolean"!=typeof e&&Pi(t,e,i)?e=!1:"function"==typeof e&&(n=i,i=e,e=!1),i="function"==typeof i&&ti(i,n,1),ye(t,e,i)}function vr(t,e,i){return e="function"==typeof e&&ti(e,i,1),ye(t,!0,e)}function wr(t){return Ai(p(t)?t.length:v)&&la.call(t)==V||!1}function xr(t){return!0===t||!1===t||p(t)&&la.call(t)==W||!1}function Tr(t){return p(t)&&la.call(t)==K||!1}function Mr(t){return t&&1===t.nodeType&&p(t)&&la.call(t).indexOf("Element")>-1||!1}function _r(t){if(null==t)return!0;var e=t.length;return Ai(e)&&(is(t)||Br(t)||wr(t)||p(t)&&rs(t.splice))?!e:!ss(t).length}function Pr(t,e,i,n){if(!(i="function"==typeof i&&ti(i,n,3))&&ki(t)&&ki(e))return t===e;var r=i?i(t,e):v;return void 0===r?Ie(t,e,i):!!r}function Ar(t){return p(t)&&"string"==typeof t.message&&la.call(t)==z||!1}function kr(t){var e=typeof t;return"function"==e||t&&"object"==e||!1}function Dr(t,e,i,n){var r=ss(e),o=r.length;if(!(i="function"==typeof i&&ti(i,n,3))&&1==o){var a=r[0],s=e[a];if(ki(s))return null!=t&&s===t[a]&&aa.call(t,a)}for(var l=Ko(o),h=Ko(o);o--;)s=l[o]=e[r[o]],h[o]=ki(s);return Oe(t,r,l,h,i)}function Fr(t){return Gr(t)&&t!=+t}function Er(t){return null!=t&&(la.call(t)==j?ua.test(ra.call(t)):p(t)&&vt.test(t)||!1)}function Ir(t){return null===t}function Gr(t){return"number"==typeof t||p(t)&&la.call(t)==Y||!1}function Or(t){return p(t)&&la.call(t)==q||!1}function Br(t){return"string"==typeof t||p(t)&&la.call(t)==Z||!1}function Lr(t){return p(t)&&Ai(t.length)&&Et[la.call(t)]||!1}function Rr(t){return void 0===t}function Nr(t){var e=t?t.length:0;return Ai(e)?e?Qt(t):[]:oo(t)}function Ur(t){return pe(t,Qr(t))}function Vr(t,e,i){var n=Ka(t);return i&&Pi(t,e,i)&&(e=null),e?pe(e,n,ss(e)):n}function Hr(t){if(null==t)return t;var e=Qt(arguments);return e.push(he),as.apply(v,e)}function Wr(t,e,i){return e=Si(e,i,3),Te(t,e,ke,!0)}function Kr(t,e,i){return e=Si(e,i,3),Te(t,e,De,!0)}function zr(t,e,i){return"function"==typeof e&&void 0===i||(e=ti(e,i,3)),_e(t,e,Qr)}function jr(t,e,i){return e=ti(e,i,3),Pe(t,e,Qr)}function Yr(t,e,i){return"function"==typeof e&&void 0===i||(e=ti(e,i,3)),ke(t,e)}function Xr(t,e,i){return e=ti(e,i,3),Pe(t,e,ss)}function qr(t){return Fe(t,Qr(t))}function Zr(t,e){return!!t&&aa.call(t,e)}function Jr(t,e,i){i&&Pi(t,e,i)&&(e=null);for(var n=-1,r=ss(t),o=r.length,a={};++n<o;){var s=r[n],l=t[s];e?aa.call(a,l)?a[l].push(s):a[l]=[s]:a[l]=s}return a}function Qr(t){if(null==t)return[];kr(t)||(t=Zo(t));var e=t.length;e=e&&Ai(e)&&(is(t)||Wa.nonEnumArgs&&wr(t))&&e||0;for(var i=t.constructor,n=-1,r="function"==typeof i&&i.prototype===t,o=Ko(e),a=e>0;++n<e;)o[n]=n+"";for(var s in t)a&&_i(s,e)||"constructor"==s&&(r||!aa.call(t,s))||o.push(s);return o}function $r(t,e,i){var n={};return e=Si(e,i,3),ke(t,function(t,i,r){n[i]=e(t,i,r)}),n}function to(t,e,i){if(null==t)return{};if("function"!=typeof e){var n=ne(Me(arguments,!1,!1,1),Qo);return Fi(t,Ce(Qr(t),n))}return e=ti(e,i,3),Ei(t,function(t,i,n){return!e(t,i,n)})}function eo(t){for(var e=-1,i=ss(t),n=i.length,r=Ko(n);++e<n;){var o=i[e];r[e]=[o,t[o]]}return r}function io(t,e,i){return null==t?{}:"function"==typeof e?Ei(t,ti(e,i,3)):Fi(t,Me(arguments,!1,!1,1))}function no(t,e,i){var n=null==t?v:t[e];return void 0===n&&(n=i),rs(n)?n.call(t):n}function ro(t,e,i,n){var r=is(t)||Lr(t);if(e=Si(e,n,4),null==i)if(r||kr(t)){var o=t.constructor;i=r?is(t)?new o:[]:Ka(rs(o)&&o.prototype)}else i={};return(r?$t:ke)(t,function(t,n,r){return e(i,t,n,r)}),i}function oo(t){return Ze(t,ss(t))}function ao(t){return Ze(t,Qr(t))}function so(t,e,i){return e=+e||0,void 0===i?(i=e,e=0):i=+i||0,t>=e&&t<i}function lo(t,e,i){i&&Pi(t,e,i)&&(e=i=null);var n=null==t,r=null==e;if(null==i&&(r&&"boolean"==typeof t?(i=t,t=1):"boolean"==typeof e&&(i=e,r=!0)),n&&r&&(e=1,r=!1),t=+t||0,r?(e=t,t=0):e=+e||0,i||t%1||e%1){var o=Ga();return Da(t+o*(e-t+parseFloat("1e-"+((o+"").length-1))),e)}return We(t,e)}function ho(t){return(t=n(t))&&t.charAt(0).toUpperCase()+t.slice(1)}function uo(t){return(t=n(t))&&t.replace(wt,h)}function co(t,e,i){t=n(t),e+="";var r=t.length;return i=void 0===i?r:Da(i<0?0:+i||0,r),(i-=e.length)>=0&&t.indexOf(e,i)==i}function po(t){return t=n(t),t&&pt.test(t)?t.replace(dt,u):t}function go(t){return t=n(t),t&&Mt.test(t)?t.replace(Tt,"\\$&"):t}function fo(t,e,i){t=n(t),e=+e;var r=t.length;if(r>=e||!Pa(e))return t;var o=(e-r)/2,a=fa(o);return i=ci("",pa(o),i),i.slice(0,a)+t+i}function yo(t,e,i){return(t=n(t))&&ci(t,e,i)+t}function mo(t,e,i){return(t=n(t))&&t+ci(t,e,i)}function Co(t,e,i){return i&&Pi(t,e,i)&&(e=0),Ia(t,e)}function So(t,e){var i="";if(t=n(t),(e=+e)<1||!t||!Pa(e))return i;do{e%2&&(i+=t),e=fa(e/2),t+=t}while(e);return i}function bo(t,e,i){return t=n(t),i=null==i?0:Da(i<0?0:+i||0,t.length),t.lastIndexOf(e,i)==i}function vo(t,e,i){var r=Ot.templateSettings;i&&Pi(t,e,i)&&(e=i=null),t=n(t),e=de(de({},i||e),r,ue);var o,a,s=de(de({},e.imports),r.imports,ue),l=ss(s),h=Ze(s,l),u=0,c=e.interpolate||xt,p="__p += '",g=Jo((e.escape||xt).source+"|"+c.source+"|"+(c===yt?mt:xt).source+"|"+(e.evaluate||xt).source+"|$","g"),f="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Ft+"]")+"\n";t.replace(g,function(e,i,n,r,s,l){return n||(n=r),p+=t.slice(u,l).replace(Pt,d),i&&(o=!0,p+="' +\n__e("+i+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+e.length,e}),p+="';\n";var y=e.variable;y||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(st,""):p).replace(lt,"$1").replace(ht,"$1;"),p="function("+(y||"obj")+") {\n"+(y?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m=Ao(function(){return Yo(l,f+"return "+p).apply(v,h)});if(m.source=p,Ar(m))throw m;return m}function wo(t,e,i){var r=t;return(t=n(t))?(i?Pi(r,e,i):null==e)?t.slice(m(t),C(t)+1):(e+="",t.slice(o(t,e),a(t,e)+1)):t}function xo(t,e,i){var r=t;return t=n(t),t?(i?Pi(r,e,i):null==e)?t.slice(m(t)):t.slice(o(t,e+"")):t}function To(t,e,i){var r=t;return t=n(t),t?(i?Pi(r,e,i):null==e)?t.slice(0,C(t)+1):t.slice(0,a(t,e+"")+1):t}function Mo(t,e,i){i&&Pi(t,e,i)&&(e=null);var r=E,o=I;if(null!=e)if(kr(e)){var a="separator"in e?e.separator:a;r="length"in e?+e.length||0:r,o="omission"in e?n(e.omission):o}else r=+e||0;if(t=n(t),r>=t.length)return t;var s=r-o.length;if(s<1)return o;var l=t.slice(0,s);if(null==a)return l+o;if(Or(a)){if(t.slice(s).search(a)){var h,u,d=t.slice(0,s);for(a.global||(a=Jo(a.source,(Ct.exec(a)||"")+"g")),a.lastIndex=0;h=a.exec(d);)u=h.index;l=l.slice(0,null==u?s:u)}}else if(t.indexOf(a,s)!=s){var c=l.lastIndexOf(a);c>-1&&(l=l.slice(0,c))}return l+o}function _o(t){return t=n(t),t&&ct.test(t)?t.replace(ut,S):t}function Po(t,e,i){return i&&Pi(t,e,i)&&(e=null),t=n(t),t.match(e||At)||[]}function Ao(){for(var t=arguments[0],e=arguments.length,i=Ko(e?e-1:0);--e>0;)i[e-1]=arguments[e];try{return t.apply(v,i)}catch(t){return Ar(t)?t:new jo(t)}}function ko(t,e,i){return i&&Pi(t,e,i)&&(e=null),p(t)?Eo(t):fe(t,e)}function Do(t){return function(){return t}}function Fo(t){return t}function Eo(t){return Le(ye(t,!0))}function Io(t,e){return Re(t+"",ye(e,!0))}function Go(t,e,i){if(null==i){var n=kr(e),r=n&&ss(e),o=r&&r.length&&Fe(e,r);(o?o.length:n)||(o=!1,i=e,e=t,t=this)}o||(o=Fe(e,ss(e)));var a=!0,s=-1,l=rs(t),h=o.length;!1===i?a=!1:kr(i)&&"chain"in i&&(a=i.chain);for(;++s<h;){var u=o[s],d=e[u];t[u]=d,l&&(t.prototype[u]=function(e){return function(){var i=this.__chain__;if(a||i){var n=t(this.__wrapped__);return(n.__actions__=Qt(this.__actions__)).push({func:e,args:arguments,thisArg:t}),n.__chain__=i,n}var r=[this.value()];return ma.apply(r,arguments),e.apply(t,r)}}(d))}return t}function Oo(){return g._=ha,this}function Bo(){}function Lo(t){return Ve(t+"")}function Ro(t){return function(e){return null==t?v:t[e]}}function No(t,e,i){i&&Pi(t,e,i)&&(e=i=null),t=+t||0,i=null==i?1:+i||0,null==e?(e=t,t=0):e=+e||0;for(var n=-1,r=ka(pa((e-t)/(i||1)),0),o=Ko(r);++n<r;)o[n]=t,t+=i;return o}function Uo(t,e,i){if((t=+t)<1||!Pa(t))return[];var n=-1,r=Ko(Da(t,La));for(e=ti(e,i,1);++n<t;)n<La?r[n]=e(n):e(n);return r}function Vo(t){var e=++sa;return n(t)+e}function Ho(t,e){return t+e}function Wo(t){is(t)||(t=Bi(t));for(var e=t.length,i=0;e--;)i+=+t[e]||0;return i}g=g?zt.defaults(Kt.Object(),g,zt.pick(Kt,Dt)):Kt;var Ko=g.Array,zo=g.Date,jo=g.Error,Yo=g.Function,Xo=g.Math,qo=g.Number,Zo=g.Object,Jo=g.RegExp,Qo=g.String,$o=g.TypeError,ta=Ko.prototype,ea=Zo.prototype,ia=Qo.prototype,na=(na=g.window)&&na.document,ra=Yo.prototype.toString,oa=Ve("length"),aa=ea.hasOwnProperty,sa=0,la=ea.toString,ha=g._,ua=Jo("^"+go(la).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),da=Er(da=g.ArrayBuffer)&&da,ca=Er(ca=da&&new da(0).slice)&&ca,pa=Xo.ceil,ga=g.clearTimeout,fa=Xo.floor,ya=Er(ya=Zo.getPrototypeOf)&&ya,ma=ta.push,Ca=ea.propertyIsEnumerable,Sa=Er(Sa=g.Set)&&Sa,ba=g.setTimeout,va=ta.splice,wa=Er(wa=g.Uint8Array)&&wa,xa=Er(xa=g.WeakMap)&&xa,Ta=function(){try{var t=Er(t=g.Float64Array)&&t,e=new t(new da(10),0,1)&&t}catch(t){}return e}(),Ma=Er(Ma=Ko.isArray)&&Ma,_a=Er(_a=Zo.create)&&_a,Pa=g.isFinite,Aa=Er(Aa=Zo.keys)&&Aa,ka=Xo.max,Da=Xo.min,Fa=Er(Fa=zo.now)&&Fa,Ea=Er(Ea=qo.isFinite)&&Ea,Ia=g.parseInt,Ga=Xo.random,Oa=qo.NEGATIVE_INFINITY,Ba=qo.POSITIVE_INFINITY,La=Xo.pow(2,32)-1,Ra=La-1,Na=La>>>1,Ua=Ta?Ta.BYTES_PER_ELEMENT:0,Va=Xo.pow(2,53)-1,Ha=xa&&new xa,Wa=Ot.support={};!function(t){Wa.funcDecomp=!Er(g.WinRTError)&&_t.test(b),Wa.funcNames="string"==typeof Yo.name;try{Wa.dom=11===na.createDocumentFragment().nodeType}catch(t){Wa.dom=!1}try{Wa.nonEnumArgs=!Ca.call(arguments,1)}catch(t){Wa.nonEnumArgs=!0}}(0,0),Ot.templateSettings={escape:gt,evaluate:ft,interpolate:yt,variable:"",imports:{_:Ot}};var Ka=function(){function t(){}return function(e){if(kr(e)){t.prototype=e;var i=new t;t.prototype=null}return i||g.Object()}}(),za=Ha?function(t,e){return Ha.set(t,e),t}:Fo;ca||(ei=da&&wa?function(t){var e=t.byteLength,i=Ta?fa(e/Ua):0,n=i*Ua,r=new da(e);if(i){var o=new Ta(r,0,i);o.set(new Ta(t,0,i))}return e!=n&&(o=new wa(r,n),o.set(new wa(t,n))),r}:Do(null));var ja=_a&&Sa?function(t){return new qt(t)}:Do(null),Ya=Ha?function(t){return Ha.get(t)}:Bo,Xa=function(){var t=0,e=0;return function(i,n){var r=$a(),o=O-(r-e);if(e=r,o>0){if(++t>=G)return i}else t=0;return za(i,n)}}(),qa=ri(function(t,e,i){aa.call(t,i)?++t[i]:t[i]=1}),Za=ri(function(t,e,i){aa.call(t,i)?t[i].push(e):t[i]=[e]}),Ja=ri(function(t,e,i){t[i]=e}),Qa=ri(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]}),$a=Fa||function(){return(new zo).getTime()},ts=si(),es=si(!0),is=Ma||function(t){return p(t)&&Ai(t.length)&&la.call(t)==H||!1};Wa.dom||(Mr=function(t){return t&&1===t.nodeType&&p(t)&&!os(t)||!1});var ns=Ea||function(t){return"number"==typeof t&&Pa(t)},rs=i(/x/)||wa&&!i(wa)?function(t){return la.call(t)==j}:i,os=ya?function(t){if(!t||la.call(t)!=X)return!1;var e=t.valueOf,i=Er(e)&&(i=ya(e))&&ya(i);return i?t==i||ya(t)==i:Gi(t)}:Gi,as=oi(de),ss=Aa?function(t){if(t)var e=t.constructor,i=t.length;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&i&&Ai(i)?Oi(t):kr(t)?Aa(t):[]}:Oi,ls=oi(Ne),hs=li(function(t,e,i){return e=e.toLowerCase(),t+(i?e.charAt(0).toUpperCase()+e.slice(1):e)}),us=li(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()});8!=Ia(kt+"08")&&(Co=function(t,e,i){return(i?Pi(t,e,i):null==e)?e=0:e&&(e=+e),t=wo(t),Ia(t,e||(bt.test(t)?16:10))});var ds=li(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}),cs=li(function(t,e,i){return t+(i?" ":"")+(e.charAt(0).toUpperCase()+e.slice(1))}),ps=ui(re),gs=ui(oe,!0);return Ot.prototype=Bt.prototype,Lt.prototype=Ka(Bt.prototype),Lt.prototype.constructor=Lt,Rt.prototype=Ka(Bt.prototype),Rt.prototype.constructor=Rt,Ht.prototype.delete=Wt,Ht.prototype.get=jt,Ht.prototype.has=Yt,Ht.prototype.set=Xt,qt.prototype.push=Jt,dr.Cache=Ht,Ot.after=tr,Ot.ary=er,Ot.assign=as,Ot.at=Fn,Ot.before=ir,Ot.bind=nr,Ot.bindAll=rr,Ot.bindKey=or,Ot.callback=ko,Ot.chain=wn,Ot.chunk=Ni,Ot.compact=Ui,Ot.constant=Do,Ot.countBy=qa,Ot.create=Vr,Ot.curry=ar,Ot.curryRight=sr,Ot.debounce=lr,Ot.defaults=Hr,Ot.defer=hr,Ot.delay=ur,Ot.difference=Vi,Ot.drop=Hi,Ot.dropRight=Wi,Ot.dropRightWhile=Ki,Ot.dropWhile=zi,Ot.fill=ji,Ot.filter=In,Ot.flatten=Zi,Ot.flattenDeep=Ji,Ot.flow=ts,Ot.flowRight=es,Ot.forEach=Ln,Ot.forEachRight=Rn,Ot.forIn=zr,Ot.forInRight=jr,Ot.forOwn=Yr,Ot.forOwnRight=Xr,Ot.functions=qr,Ot.groupBy=Za,Ot.indexBy=Ja,Ot.initial=$i,Ot.intersection=tn,Ot.invert=Jr,Ot.invoke=Un,Ot.keys=ss,Ot.keysIn=Qr,Ot.map=Vn,Ot.mapValues=$r,Ot.matches=Eo,Ot.matchesProperty=Io,Ot.memoize=dr,Ot.merge=ls,Ot.mixin=Go,Ot.negate=cr,Ot.omit=to,Ot.once=pr,Ot.pairs=eo,Ot.partial=gr,Ot.partialRight=fr,Ot.partition=Qa,Ot.pick=io,Ot.pluck=Hn,Ot.property=Lo,Ot.propertyOf=Ro,Ot.pull=rn,Ot.pullAt=on,Ot.range=No,Ot.rearg=yr,Ot.reject=zn,Ot.remove=an,Ot.rest=sn,Ot.shuffle=Yn,Ot.slice=ln,Ot.sortBy=Zn,Ot.sortByAll=Jn,Ot.sortByOrder=Qn,Ot.spread=mr,Ot.take=dn,Ot.takeRight=cn,Ot.takeRightWhile=pn,Ot.takeWhile=gn,Ot.tap=xn,Ot.throttle=Cr,Ot.thru=Tn,Ot.times=Uo,Ot.toArray=Nr,Ot.toPlainObject=Ur,Ot.transform=ro,Ot.union=fn,Ot.uniq=yn,Ot.unzip=mn,Ot.values=oo,Ot.valuesIn=ao,Ot.where=$n,Ot.without=Cn,Ot.wrap=Sr,Ot.xor=Sn,Ot.zip=bn,Ot.zipObject=vn,Ot.backflow=es,Ot.collect=Vn,Ot.compose=es,Ot.each=Ln,Ot.eachRight=Rn,Ot.extend=as,Ot.iteratee=ko,Ot.methods=qr,Ot.object=vn,Ot.select=In,Ot.tail=sn,Ot.unique=yn,Go(Ot,Ot),Ot.add=Ho,Ot.attempt=Ao,Ot.camelCase=hs,Ot.capitalize=ho,Ot.clone=br,Ot.cloneDeep=vr,Ot.deburr=uo,Ot.endsWith=co,Ot.escape=po,Ot.escapeRegExp=go,Ot.every=En,Ot.find=Gn,Ot.findIndex=Yi,Ot.findKey=Wr,Ot.findLast=On,Ot.findLastIndex=Xi,Ot.findLastKey=Kr,Ot.findWhere=Bn,Ot.first=qi,Ot.has=Zr,Ot.identity=Fo,Ot.includes=Nn,Ot.indexOf=Qi,Ot.inRange=so,Ot.isArguments=wr,Ot.isArray=is,Ot.isBoolean=xr,Ot.isDate=Tr,Ot.isElement=Mr,Ot.isEmpty=_r,Ot.isEqual=Pr,Ot.isError=Ar,Ot.isFinite=ns,Ot.isFunction=rs,Ot.isMatch=Dr,Ot.isNaN=Fr,Ot.isNative=Er,Ot.isNull=Ir,Ot.isNumber=Gr,Ot.isObject=kr,Ot.isPlainObject=os,Ot.isRegExp=Or,Ot.isString=Br,Ot.isTypedArray=Lr,Ot.isUndefined=Rr,Ot.kebabCase=us,Ot.last=en,Ot.lastIndexOf=nn,Ot.max=ps,Ot.min=gs,Ot.noConflict=Oo,Ot.noop=Bo,Ot.now=$a,Ot.pad=fo,Ot.padLeft=yo,Ot.padRight=mo,Ot.parseInt=Co,Ot.random=lo,Ot.reduce=Wn,Ot.reduceRight=Kn,Ot.repeat=So,Ot.result=no,Ot.runInContext=b,Ot.size=Xn,Ot.snakeCase=ds,Ot.some=qn,Ot.sortedIndex=hn,Ot.sortedLastIndex=un,Ot.startCase=cs,Ot.startsWith=bo,Ot.sum=Wo,Ot.template=vo,Ot.trim=wo,Ot.trimLeft=xo,Ot.trimRight=To,Ot.trunc=Mo,Ot.unescape=_o,Ot.uniqueId=Vo,Ot.words=Po,Ot.all=En,Ot.any=qn,Ot.contains=Nn,Ot.detect=Gn,Ot.foldl=Wn,Ot.foldr=Kn,Ot.head=qi,Ot.include=Nn,Ot.inject=Wn,Go(Ot,function(){var t={};return ke(Ot,function(e,i){Ot.prototype[i]||(t[i]=e)}),t}(),!1),Ot.sample=jn,Ot.prototype.sample=function(t){return this.__chain__||null!=t?this.thru(function(e){return jn(e,t)}):jn(this.value())},Ot.VERSION=w,$t(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){Ot[t].placeholder=Ot}),$t(["dropWhile","filter","map","takeWhile"],function(t,e){var i=e!=R,n=e==B;Rt.prototype[t]=function(t,r){var o=this.__filtered__,a=o&&n?new Rt(this):this.clone();return(a.__iteratees__||(a.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:Si(t,r,1),limit:-1,type:e}),a.__filtered__=o||i,a}}),$t(["drop","take"],function(t,e){var i=t+"While";Rt.prototype[t]=function(i){var n=this.__filtered__,r=n&&!e?this.dropWhile():this.clone();if(i=null==i?1:ka(fa(i)||0,0),n)e?r.__takeCount__=Da(r.__takeCount__,i):en(r.__iteratees__).limit=i;else{(r.__views__||(r.__views__=[])).push({size:i,type:t+(r.__dir__<0?"Right":"")})}return r},Rt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()},Rt.prototype[t+"RightWhile"]=function(t,e){return this.reverse()[i](t,e).reverse()}}),$t(["first","last"],function(t,e){var i="take"+(e?"Right":"");Rt.prototype[t]=function(){return this[i](1).value()[0]}}),$t(["initial","rest"],function(t,e){var i="drop"+(e?"":"Right");Rt.prototype[t]=function(){return this[i](1)}}),$t(["pluck","where"],function(t,e){var i=e?"filter":"map",n=e?Le:Ve;Rt.prototype[t]=function(t){return this[i](n(t))}}),Rt.prototype.compact=function(){return this.filter(Fo)},Rt.prototype.reject=function(t,e){return t=Si(t,e,1),this.filter(function(e){return!t(e)})},Rt.prototype.slice=function(t,e){t=null==t?0:+t||0;var i=t<0?this.takeRight(-t):this.drop(t);return void 0!==e&&(e=+e||0,i=e<0?i.dropRight(-e):i.take(e-t)),i},Rt.prototype.toArray=function(){return this.drop(0)},ke(Rt.prototype,function(t,e){var i=Ot[e],n=/^(?:filter|map|reject)|While$/.test(e),r=/^(?:first|last)$/.test(e);Ot.prototype[e]=function(){var e=arguments,o=(e.length,this.__chain__),a=this.__wrapped__,s=!!this.__actions__.length,l=a instanceof Rt,h=e[0],u=l||is(a);u&&n&&"function"==typeof h&&1!=h.length&&(l=u=!1);var d=l&&!s;if(r&&!o)return d?t.call(a):i.call(Ot,this.value());var c=function(t){var n=[t];return ma.apply(n,e),i.apply(Ot,n)};if(u){var p=d?a:new Rt(this),g=t.apply(p,e);if(!r&&(s||g.__actions__)){(g.__actions__||(g.__actions__=[])).push({func:Tn,args:[c],thisArg:Ot})}return new Lt(g,o)}return this.thru(c)}}),$t(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(t){var e=(/^(?:replace|split)$/.test(t)?ia:ta)[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:join|pop|replace|shift)$/.test(t);Ot.prototype[t]=function(){var t=arguments;return n&&!this.__chain__?e.apply(this.value(),t):this[i](function(i){return e.apply(i,t)})}}),Rt.prototype.clone=Nt,Rt.prototype.reverse=Ut,Rt.prototype.value=Vt,Ot.prototype.chain=Mn,Ot.prototype.commit=_n,Ot.prototype.plant=Pn,Ot.prototype.reverse=An,Ot.prototype.toString=kn,Ot.prototype.run=Ot.prototype.toJSON=Ot.prototype.valueOf=Ot.prototype.value=Dn,Ot.prototype.collect=Ot.prototype.map,Ot.prototype.head=Ot.prototype.first,Ot.prototype.select=Ot.prototype.filter,Ot.prototype.tail=Ot.prototype.rest,Ot}var v,w="3.5.0",x=1,T=2,M=4,_=8,P=16,A=32,k=64,D=128,F=256,E=30,I="...",G=150,O=16,B=0,L=1,R=2,N="Expected a function",U="__lodash_placeholder__",V="[object Arguments]",H="[object Array]",W="[object Boolean]",K="[object Date]",z="[object Error]",j="[object Function]",Y="[object Number]",X="[object Object]",q="[object RegExp]",Z="[object String]",J="[object ArrayBuffer]",Q="[object Float32Array]",$="[object Float64Array]",tt="[object Int8Array]",et="[object Int16Array]",it="[object Int32Array]",nt="[object Uint8Array]",rt="[object Uint8ClampedArray]",ot="[object Uint16Array]",at="[object Uint32Array]",st=/\b__p \+= '';/g,lt=/\b(__p \+=) '' \+/g,ht=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ut=/&(?:amp|lt|gt|quot|#39|#96);/g,dt=/[&<>"'`]/g,ct=RegExp(ut.source),pt=RegExp(dt.source),gt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,yt=/<%=([\s\S]+?)%>/g,mt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ct=/\w*$/,St=/^\s*function[ \n\r\t]+\w/,bt=/^0[xX]/,vt=/^\[object .+?Constructor\]$/,wt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,xt=/($^)/,Tt=/[.*+?^${}()|[\]\/\\]/g,Mt=RegExp(Tt.source),_t=/\bthis\b/,Pt=/['\n\r\u2028\u2029\\]/g,At=function(){var t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",e="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(t+"+(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")}(),kt=" \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",Dt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],Ft=-1,Et={};Et[Q]=Et[$]=Et[tt]=Et[et]=Et[it]=Et[nt]=Et[rt]=Et[ot]=Et[at]=!0,Et[V]=Et[H]=Et[J]=Et[W]=Et[K]=Et[z]=Et[j]=Et["[object Map]"]=Et[Y]=Et[X]=Et[q]=Et["[object Set]"]=Et[Z]=Et["[object WeakMap]"]=!1;var It={};It[V]=It[H]=It[J]=It[W]=It[K]=It[Q]=It[$]=It[tt]=It[et]=It[it]=It[Y]=It[X]=It[q]=It[Z]=It[nt]=It[rt]=It[ot]=It[at]=!0,It[z]=It[j]=It["[object Map]"]=It["[object Set]"]=It["[object WeakMap]"]=!1;var Gt={leading:!1,maxWait:0,trailing:!1},Ot={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Lt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Rt={function:!0,object:!0},Nt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ut=Rt[typeof exports]&&exports&&!exports.nodeType&&exports,Vt=Rt[typeof module]&&module&&!module.nodeType&&module,Ht=Ut&&Vt&&"object"==typeof global&&global,Wt=Rt[typeof window]&&window,Kt=Ht||Wt!==(this&&this.window)&&Wt||this,zt=b();"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define("lodash/main",[],function(){return zt})}.call(this),define("lodash",["lodash/main"],function(t){return t}),define("absolute/screenmetrics",["absolute/debug","absolute/platform","lodash"],function(t,e,i){return{kDefaultWidth:1536,kDefaultHeight:2008,resClass:"",stepDownResClass:!1,stepDownResClassAggressively:!0,stepDownStockAndroidOnly:!1,realWindow:function(){var t,e;try{e=window.self!==window.top,t=e&&parent.window.devicePixelRatio&&void 0!==parent.window.devicePixelRatio?parent.window:window}catch(e){t=window}return t}(),realScreen:function(){var t;try{t=parent!==window&&parent.screen?parent.screen:screen}catch(e){t=screen}return t}(),refresh:function(){this.devicePixelRatio=this.realWindow.devicePixelRatio||1,this.screenWidth=this.realScreen.width,this.screenHeight=this.realScreen.height,this.innerWidth=this.realWindow.innerWidth,this.innerHeight=this.realWindow.innerHeight,this.outerWidth=this.realWindow.outerWidth,this.outerHeight=this.realWindow.outerHeight},getMinNonZero:function(t){return Math.min.apply(null,i.filter(t,function(t){return t>0}))},isPortrait:function(){this.refresh();var t=this.getMinNonZero([this.innerWidth,this.screenWidth,this.clientWidth]),i=this.getMinNonZero([this.innerHeight,this.screenHeight,this.clientHeight]);return e._isAndroid()&&(t=this.getMinNonZero([this.innerWidth,this.clientWidth]),i=this.getMinNonZero([this.innerHeight,this.clientHeight])),t<i},getWidth:function(t){t=void 0!==t&&t;var i=this.clientWidth,n=this.clientHeight;if(t&&(i*=this.devicePixelRatio,n*=this.devicePixelRatio),this.isPortrait()&&i>0)return i;if(i<n)return i;if(1280===i)return 800;if(e._isAndroid())return Math.max(this.realScreen.height,n);var r=this.realScreen.width;return t&&(r*=this.devicePixelRatio),Math.max(r,n)},getHeight:function(t){t=void 0!==t&&t;var e;return e=this.isPortrait()&&this.clientHeight>0?this.clientHeight:this.screenWidth<this.screenHeight?this.screenHeight-(this.screenWidth-(this.innerHeight||0)):this.screenWidth-(this.screenHeight-(this.innerHeight||0)),t&&(e*=this.devicePixelRatio),navigator.userAgent.match(/iPhone/i)&&(e-=16),e},getScaledViewportWidth:function(){return this.getWidth()/this.getViewportScale()},getScaledViewportHeight:function(){return this.getHeight()/this.getViewportScale()},getScaledContentWidth:function(){return this.getContentWidth()*this.getViewportScale()},getScaledContentHeight:function(){return this.getContentHeight()*this.getViewportScale()},getContentWidth:function(){return this.kDefaultWidth*this.getResScale()/this.devicePixelRatio},getContentHeight:function(){return this.kDefaultHeight*this.getResScale()/this.devicePixelRatio},getViewportScale:function(){var t=this.getWidth()/this.getContentWidth(),e=this.getHeight()/this.getContentHeight();return Math.min(t,e)},resClasses:[{id:"r320",resfloor:0},{id:"r640",resfloor:320},{id:"r768",resfloor:640},{id:"r1280",resfloor:768}],getResClass:function(){if(""!==this.resClass)return this.resClass;if(e._isNodeWebkit())return this.resClasses[this.resClasses.length-1].id;for(var t=Math.min(this.getHeight(!0),this.getWidth(!0)),i=0,n=this.resClasses.length-1;n>0;n--)if(t>this.resClasses[n].resfloor){i=n;break}return this.stepDownResClass&&(i-=e.getResStepsDown(i,this.stepDownResClassAggressively,this.stepDownStockAndroidOnly))<0&&(i=0),this.resClass=this.resClasses[i].id,this.resClass},getResScale:function(){switch(this.getResClass()){case"r320":return.21;case"r640":return.42;case"r768":return.5;case"r1280":return.83;case"r1536":default:return 1}},getScaleX:function(){return this.getWidth()*this.devicePixelRatio/(this.kDefaultWidth*this.getResScale())},getScaleY:function(){return this.getHeight()*this.devicePixelRatio/(this.kDefaultHeight*this.getResScale())},log:function(){t.log("devicePixelRatio "+this.devicePixelRatio),t.log("screenWidth "+this.screenWidth),t.log("screenHeight "+this.screenHeight),t.log("innerWidth "+this.innerWidth),t.log("innerHeight "+this.innerHeight),t.log("outerWidth "+this.outerWidth),t.log("outerHeight "+this.outerHeight),t.log("isPortrait() "+this.isPortrait()),t.log("getWidth() "+this.getWidth()),t.log("getHeight() "+this.getHeight()),t.log("getResClass() "+this.getResClass()),t.log("getResScale() "+this.getResScale()),t.log("getContentWidth() "+this.getContentWidth()),t.log("getContentHeight() "+this.getContentHeight()),t.log("getViewportScale() "+this.getViewportScale()),t.log("getScaledContentWidth "+this.getScaledContentWidth()),t.log("getScaledContentHeight "+this.getScaledContentHeight()),t.log("getScaledViewportWidth "+this.getScaledViewportWidth()),t.log("getScaledViewportHeight "+this.getScaledViewportHeight())},getScreenParams:function(){return"devicePixelRatio="+this.devicePixelRatio+"&screen.width="+this.realScreen.width+"&screen.height="+this.realScreen.height+"&window.innerWidth="+this.realWindow.innerWidth+"&window.innerHeight="+this.realWindow.innerHeight+"&window.outerWidth="+this.realWindow.outerWidth+"&window.outerHeight="+this.realWindow.outerHeight+"&document.documentElement.clientWidth="+document.documentElement.clientWidth+"&document.documentElement.clientHeight="+document.documentElement.clientHeight+"&resClass="+this.getResClass()+"&resScale="+this.getResScale()},detectOrientationChange:function(t){function e(){var e=this.getOrientation();this.lastOrienation!==e&&(t(e),this.lastOrienation=e)}this.lastOrienation=this.getOrientation(),this.realWindow.addEventListener("resize",e.bind(this))},getOrientation:function(){return this.refresh(),this.isPortrait()?"portrait":"landscape"}}}),define("absolute/coords",["absolute/screenmetrics"],function(t){return{x:function(e){return Math.round(e*t.getResScale())},y:function(e){return Math.round(e*t.getResScale())},
worldX:function(e){return Math.round(e/t.getResScale())},worldY:function(e){return Math.round(e/t.getResScale())},offsetX:function(t,e){return e.position.x+t},offsetY:function(t,e){return e.position.y+t},centerX:function(t,e){return(e.width-t.width)/2},centerY:function(t,e){return(e.height-t.height)/2}}}),define("absolute/snapshot",["pixi"],function(t){var e=function(t){this.initSnapshot(t)};return e.constructor=e,e.prototype.initSnapshot=function(e){var i=new t.Stage;this.renderer=new t.CanvasRenderer(e.width,e.height,null,!0),i.addChild(e),this.renderer.render(i)},e.prototype.getSnapshot=function(){return t.Texture.fromCanvas(this.renderer.view)},e}),define("absolute/spriteutils",["absolute/snapshot","pixi","lodash","absolute/platform"],function(t,e,i,n){var r={offScreenRenderer:new e.CanvasRenderer(512,512,null,!0),brightness:function(t,e){var i,n="function"==typeof t.generateTexture?t.generateTexture():t,r=null;if(n.textureBuffer.context){r=n.textureBuffer.context.getImageData(n.frame.x,n.frame.y,n.frame.width,n.frame.height);var o=255*e||255,a=r.data;for(i=0;i<a.length;i+=4)a[i]+=o,a[i+1]+=o,a[i+2]+=o;n.textureBuffer.context.putImageData(r,0,0)}return n},greyscale:function(t,e){var i,n=t.generateTexture(),r=null;if(n.textureBuffer.context){r=n.textureBuffer.context.getImageData(n.frame.x,n.frame.y,n.frame.width,n.frame.height);var o=e||1,a=-128*o+128,s=r.data;for(i=0;i<s.length;i+=4){var l=s[i],h=s[i+1],u=s[i+2],d=.2126*l+.7152*h+.0722*u;d=d*o+a,s[i]=s[i+1]=s[i+2]=d}n.textureBuffer.context.putImageData(r,0,0)}return n},blur:function(t){var e=t.generateTexture(),i=e.textureBuffer.context.getImageData(e.frame.x,e.frame.y,e.frame.width,e.frame.height);return e.textureBuffer.context.putImageData(this.convolute(i,e.textureBuffer.context,[1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16,1/16]),0,0),e},convolute:function(t,e,i,n){for(var r=Math.round(Math.sqrt(i.length)),o=Math.floor(r/2),a=t.data,s=t.width,l=t.height,h=s,u=l,d=e.createImageData(h,u),c=d.data,p=n?1:0,g=0;g<u;g++)for(var f=0;f<h;f++){for(var y=g,m=f,C=4*(g*h+f),S=0,b=0,v=0,w=0,x=0;x<r;x++)for(var T=0;T<r;T++){var M=y+x-o,_=m+T-o;if(M>=0&&M<l&&_>=0&&_<s){var P=4*(M*s+_),A=i[x*r+T];S+=a[P]*A,b+=a[P+1]*A,v+=a[P+2]*A,w+=a[P+3]*A}}c[C]=S,c[C+1]=b,c[C+2]=v,c[C+3]=w+p*(255-w)}return d},hitTest:function(t,e,i,n,r,o,a,s){return t+i>r&&t<r+a&&e+n>o&&e<o+s},destroyAllChildren:function(t){t&&t.children&&t.children.length>0&&i.each(t.children,function(t){this.destroyAllChildren.call(this,t)},this),t&&"function"==typeof t.destroy&&t.destroy(!0)},removeAllChildren:function(t){for(;t.children[0];)t.removeChild(t.children[0])},rectsIntersect:function(t,e){return r.hitTest(t.x,t.y,t.width,t.height,e.x,e.y,e.width,e.height)},loadMovieClip:function(t,i,n){n=n||0;for(var r=[],o=n;o<n+i-1;o++){var a=e.Texture.fromFrame(t+(o<10?"0":"")+o+".png");r.push(a)}return new e.MovieClip(r)},bindInteraction:function(t,e,i){i=!!i,t.interactive=!0,t.buttonMode=!0,n.supportsTouch()?(t.touchstart=e.bind(this),(n._isWindows()||n._isMac()&&!n._isIOS())&&(t.mousedown=e.bind(this),i&&(t.mouseup=e.bind(this)))):(t.mousedown=e.bind(this),i&&(t.mouseup=e.bind(this)))}};return r}),define("absolute/threeslice",["pixi","lodash"],function(t,e){var i=function(t){var i={width:"470",height:"126",images:{left:"LW_3slice_btn_01.png",center:"LW_3slice_btn_02.png",right:"LW_3slice_btn_03.png"}};this._initThreeSlice(e.extend(i,t))};return i.prototype=Object.create(t.Sprite.prototype),i.prototype._initThreeSlice=function(e){this.options=e,t.Sprite.call(this,this._createBackground())},i.prototype._createBackground=function(){var e,i,n,r,o=t.Texture.fromFrame(this.options.images.center),a=new t.DisplayObjectContainer;return e=t.Sprite.fromFrame(this.options.images.left),e.position.x=0,e.position.y=0,n=t.Sprite.fromFrame(this.options.images.right),n.position.x=this.options.width-n.width,n.position.y=0,i=new t.TilingSprite(o,this.options.width-e.width-n.width,o.height),i.position.x=e.width,i.position.y=0,a.addChild(i),a.addChild(e),a.addChild(n),r=a.generateTexture(),i.tilingTexture&&i.tilingTexture.destroy(!0),r},i.prototype.destroy=function(){this.texture.destroy(!0)},i}),define("absolute/button",["pixi","absolute/coords","absolute/audiomanager","absolute/platform","absolute/spriteutils","absolute/threeslice","lodash"],function(t,e,i,n,r,o,a){var s=function(t,e,i,n,r,o,a){this._initButton(t,e,i,n,r,o,a)};return s.constructor=s,s.prototype=Object.create(t.Sprite.prototype),s.prototype._initButton=function(i,r,o,a,s,l,h){this.muteSound=!!h,this.replaceOnHover=!!a,s=void 0!==s&&s,this.replaceOnHover||(this.replaceOnHover=!0),l&&"object"==typeof l&&(this.container=new t.DisplayObjectContainer,this.texture=this._createThreeSliceImage(l),i=this.texture),t.Sprite.call(this,i),this.active=!0,this.action=o,this.images={},this.defaultImage=i,this.hoverImage=void 0!==r&&null!==r&&r!==i?r:this.buildHover(),this.disabledTexture=null,this.buttonMode=!0,this.setInteractive(!0),this.startPos=new t.Point,this.moveThreshold=e.x(5),this.down=!1;var u=this;this.triggerAction=function(){u.setTexture(u.defaultImage),u.doAction()},n.supportsTouch()?(s?(this.touchstart=function(t){this.clickCanceled=!1,this.startPos=t.global.clone(),this.down=!0,this.setTexture(this.hoverImage)}.bind(this),this.touchmove=function(t){this.down&&(Math.abs(this.startPos.x-t.global.x)>this.moveThreshold||Math.abs(this.startPos.y-t.global.y)>this.moveThreshold)&&(this.clickCanceled=!0,this.setTexture(this.defaultImage))}.bind(this),this.touchend=function(t){this.clickCanceled||this.triggerAction(),this.clickCancelled=!1,this.down=!1,this.setTexture(this.defaultImage)}.bind(this)):this.touchstart=function(t){this.triggerAction()},(n._isWindows()||n._isMac()&&!n._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},s.prototype.setInteractive=function(t){this.interactive=t},s.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.hoverImage)},this.mouseout=function(t){this.setTexture(this.defaultImage)},this.mousedown=function(t){this.clickCanceled=!1,this.startPos=t.global.clone(),this.down=!0}.bind(this),this.mousemove=function(t){this.down&&(Math.abs(this.startPos.x-t.global.x)>this.moveThreshold||Math.abs(this.startPos.y-t.global.y)>this.moveThreshold)&&(this.clickCanceled=!0)}.bind(this),this.mouseup=function(t){this.clickCanceled||this.triggerAction(),this.clickCancelled=!1,this.down=!1}.bind(this)},s.prototype.doAction=function(){i.simulSoundSupport()&&!this.muteSound&&i.playSound("button_click"),this.action&&this.action()},s.prototype.isActive=function(){return this.active},s.prototype.disable=function(t){t?this.setActive(!1):(this.active=!1,this.interactive=!1)},s.prototype.enable=function(){this.setActive(!0)},s.prototype.buildHover=function(){return r.brightness(this,.2)},s.prototype.buildDisabled=function(){var e=new t.DisplayObjectContainer,i=new t.Sprite(r.greyscale(this,.5)),n=new t.Sprite(this.defaultImage);return i.alpha=.8,e.addChild(n),e.addChild(i),e.generateTexture()},s.prototype.updateHover=function(t){this.defaultImage=t,this.hoverImage=r.brightness(this,.2)},s.prototype.setActive=function(t){this.active!==t&&(this.active=t,t?this.setTexture(this.defaultImage):(this.disabledTexture||(this.disabledTexture=this.buildDisabled()),this.setTexture(this.disabledTexture)),this.interactive=t)},s.prototype.getWidth=function(){return this.defaultImage.width},s.prototype.getHeight=function(){return this.defaultImage.height},s.prototype._createThreeSliceImage=function(t){return this.threeSlice=new o(t),this.threeSlice.generateTexture()},s.prototype.destroy=function(){this.threeSlice&&this.threeSlice.destroy()},s}),define("absolute/digitsprite",["pixi"],function(t){"use strict";var e=function(t){this.initDigitSprite(t)};return e.constructor=e,e.prototype=Object.create(t.Sprite.prototype),e.prototype.initDigitSprite=function(e){var i;for(this.textures=[],i=0;i<10;i+=1)this.textures.push(t.Texture.fromFrame(e+"_0"+i+".png"));this.textures.push(t.Texture.fromFrame(e+"_colon.png")),this.textures.push(t.Texture.fromFrame(e+"_comma.png")),this.index=0,t.Sprite.call(this,this.textures[0])},e.prototype.setDigit=function(t){var e=parseInt(t);this.index=e>=0&&e<10?e:":"===t?10:","===t?11:0,this.setTexture(this.textures[this.index])},e.prototype.getDigitWidth=function(){return this.width},e}),define("absolute/digitlabel",["pixi","absolute/digitsprite"],function(t,e){var i=function(t,e,i){this.initDigitLabel(t,e,i)};return i.constructor=i,i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype.initDigitLabel=function(i,n,r){t.DisplayObjectContainer.call(this),r=r||"number_large",n=n||1,this.text="",this.numDigits=i||8,this.numCommas=Math.ceil(this.numDigits/3-1),this.numSprites=this.numDigits+this.numCommas,this.sprites=[];for(var o=0;o<this.numSprites;++o){var a=new e(r);a.scale.x=a.scale.y=n,this.sprites.push(a),this.addChild(a)}this.layout()},i.prototype.getText=function(){return this.text},i.prototype.setText=function(t){this.text=t,this.layout()},i.prototype.layout=function(){for(var t=0,e=0;e<this.sprites.length;e++)this.sprites[e].visible=!1;if(this.text.length>0)for(var i=0,n=this.text.length;i<n&&i<this.sprites.length;++i)this.sprites&&this.sprites[i]&&(this.sprites[i].visible=!0,this.sprites[i].setDigit(this.text[i]),this.sprites[i].position.x=t,t+=this.sprites[i].getDigitWidth());this.width=t,this.height=this.sprites[0].height},i}),define("absolute/eventbus",[],function(){return{events:{},addEventListener:function(t,e){void 0===this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},removeEventListener:function(t,e){var i=this.events[t];if(i)for(var n=0,r=i.length;n<r;++n)if(e===i[n])return void i.splice(n,1)},dispatchEvent:function(t){var e=this.events[t];if(e)for(var i in e){var n=e[i];"function"==typeof n&&n(t)}}}}),define("absolute/analytics",[],function(){return{init:function(t){this.useFlurry=!1,"undefined"!=typeof FlurryAgent&&(FlurryAgent.startSession(t.flurry.apiKey),this.useFlurry=!0)},setGameVersion:function(t){this.useFlurry&&FlurryAgent.setAppVersion(t)},logEvent:function(t,e,i){e=e||{},i=!!i,this.useFlurry&&FlurryAgent.logEvent(t,e,i)},endTimedEvent:function(t){this.useFlurry&&FlurryAgent.endTimedEvent(t)}}}),define("absolute/game",["absolute/storagemanager","absolute/gameconfig","absolute/analytics","absolute/debug"],function(t,e,i,n){var r=function(t,e){this._initGame(t,e)};return r.prototype._initGame=function(n,r){t.prefix=n+"_",e.load(r),i.init(r.config.analytics),i.setGameVersion(r.versionString),this.ui=null,this.config=r.config,this.initVisibilityChangeHandlers()},r.prototype.start=function(){},r.prototype.initVisibilityChangeHandlers=function(){"hidden"in document?document.addEventListener("visibilitychange",function(){n.log("visibilitychange"),this.handleVisibilityChange(document.hidden)}.bind(this),!1):"mozHidden"in document?document.addEventListener("mozvisibilitychange",function(){n.log("mozvisibilitychange"),this.handleVisibilityChange(document.mozHidden)}.bind(this),!1):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",function(){n.log("webkitvisibilitychange"),this.handleVisibilityChange(document.webkitHidden)}.bind(this),!1):"msHidden"in document?document.addEventListener("msvisibilitychange",function(){n.log("msvisibilitychange"),this.handleVisibilityChange(document.msHidden)}.bind(this),!1):"onpagehide"in window&&(window.addEventListener("pagehide",function(){n.log("pagehide"),this.handleVisibilityChange(!0)}.bind(this),!1),window.addEventListener("pageshow",function(){n.log("pageshow"),this.handleVisibilityChange(!1)}.bind(this),!1)),"onblur"in document&&(window.addEventListener("blur",function(){n.log("blur"),this.handleVisibilityChange(!0)}.bind(this),!1),window.addEventListener("focus",function(){n.log("focus"),this.handleVisibilityChange(!1)}.bind(this),!1),visHandled=!0),"onfocusout"in document&&(window.addEventListener("focusout",function(){n.log("onfocusout"),this.handleVisibilityChange(!0)}.bind(this),!1),window.addEventListener("focusin",function(){n.log("onfocusin"),this.handleVisibilityChange(!1)}.bind(this),!1))},r.prototype.handleVisibilityChange=function(t){},r.prototype.load=function(t,e,i){this.ui.load(t,e,i)},r});var TWEEN=TWEEN||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e,i){if(0===t.length)return!1;var n=0;for(e=void 0!==e?e:TWEEN.now();n<t.length;)t[n].update(e)||i?n++:t.splice(n,1);return!0}}}();"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(t){var e,i=t,n={},r={},o={},a=1e3,s=0,l=!1,h=!1,u=!1,d=0,c=null,p=TWEEN.Easing.Linear.None,g=TWEEN.Interpolation.Linear,f=[],y=null,m=!1,C=null,S=null,b=null;this.to=function(t,e){return r=t,void 0!==e&&(a=e),this},this.start=function(t){TWEEN.add(this),h=!0,m=!1,c=void 0!==t?t:TWEEN.now(),c+=d;for(var e in r){if(r[e]instanceof Array){if(0===r[e].length)continue;r[e]=[i[e]].concat(r[e])}void 0!==i[e]&&(n[e]=i[e],n[e]instanceof Array==!1&&(n[e]*=1),o[e]=n[e]||0)}return this},this.stop=function(){return h?(TWEEN.remove(this),h=!1,null!==b&&b.call(i,i),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+a),this},this.stopChainedTweens=function(){for(var t=0,e=f.length;t<e;t++)f[t].stop()},this.delay=function(t){return d=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return g=t,this},this.chain=function(){return f=arguments,this},this.onStart=function(t){return y=t,this},this.onUpdate=function(t){return C=t,this},this.onComplete=function(t){return S=t,this},this.onStop=function(t){return b=t,this},this.update=function(t){var h,b,v;if(t<c)return!0;!1===m&&(null!==y&&y.call(i,i),m=!0),b=(t-c)/a,b=b>1?1:b,v=p(b);for(h in r)if(void 0!==n[h]){var w=n[h]||0,x=r[h];x instanceof Array?i[h]=g(x,v):("string"==typeof x&&(x="+"===x.charAt(0)||"-"===x.charAt(0)?w+parseFloat(x):parseFloat(x)),"number"==typeof x&&(i[h]=w+(x-w)*v))}if(null!==C&&C.call(i,v),1===b){if(s>0){isFinite(s)&&s--;for(h in o){if("string"==typeof r[h]&&(o[h]=o[h]+parseFloat(r[h])),l){var T=o[h];o[h]=r[h],r[h]=T}n[h]=o[h]}return l&&(u=!u),c=void 0!==e?t+e:t+d,!0}null!==S&&S.call(i,i);for(var M=0,_=f.length;M<_;M++)f[M].start(c+a);return!1}return!0}},TWEEN.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},TWEEN.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),o=TWEEN.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],n):e>1?o(t[i],t[i-1],i-n):o(t[r],t[r+1>i?i:r+1],n-r)},Bezier:function(t,e){for(var i=0,n=t.length-1,r=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=n;a++)i+=r(1-e,n-a)*r(e,a)*t[a]*o(n,a);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),o=TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),o(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):o(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=TWEEN.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;n>1;n--)i*=n;return t[e]=i,i}}(),CatmullRom:function(t,e,i,n,r){var o=.5*(i-t),a=.5*(n-e),s=r*r;return(2*e-2*i+o+a)*(r*s)+(-3*e+3*i-2*o-a)*s+o*r+e}}},function(t){"function"==typeof define&&define.amd?define("tween",[],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==t&&(t.TWEEN=TWEEN)}(this),function(t,e){"use strict";function i(t){return document.createElement(t)}function n(t,e){for(var i in e)try{t.style[i]=e[i]}catch(t){}return t}function r(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function o(t,e){if("array"!==r(e))return-1;if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}function a(){var t=arguments;for(var e in t[1])if(t[1].hasOwnProperty(e))switch(r(t[1][e])){case"object":t[0][e]=a({},t[0][e],t[1][e]);break;case"array":t[0][e]=t[1][e].slice(0);break;default:t[0][e]=t[1][e]}return t.length>2?a.apply(null,[t[0]].concat(Array.prototype.slice.call(t,2))):t[0]}function s(t,e,i){var n,r,o,a,s,h,u,d,c;return a=i<=.5?i*(1+e):i+e-i*e,0===a?"#000":(s=2*i-a,h=(a-s)/a,t*=6,u=Math.floor(t),d=t-u,c=a*h*d,0===u||6===u?(n=a,r=s+c,o=s):1===u?(n=a-c,r=a,o=s):2===u?(n=s,r=a,o=s+c):3===u?(n=s,r=a-c,o=a):4===u?(n=s+c,r=s,o=a):(n=a,r=s,o=a-c),"#"+l(n)+l(r)+l(o))}function l(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}function h(t,e,i,n){t.addEventListener?t[n?"removeEventListener":"addEventListener"](e,i,!1):t.attachEvent&&t[n?"detachEvent":"attachEvent"]("on"+e,i)}function u(t,l){function m(){for(G=L.history;G--;)j[G]=0===G?B.fps:j[G-1],Y[G]=0===G?B.duration:Y[G-1]}function C(t,e,i,n){return A[0|t][Math.round(Math.min((e-i)/(n-i)*U,U))]}function S(){R.legend.fps!==X&&(R.legend.fps=X,R.legend[g]=X?"FPS":"ms"),I=X?B.fps:B.duration,R.count[g]=I>999?"999+":I.toFixed(I>99?0:L.decimals)}function b(){if(k=d(),z<k-L.threshold&&(B.fps-=B.fps/Math.max(1,60*L.smoothing/L.interval),B.duration=1e3/B.fps),m(),S(),L.heat){if(V.length)for(G=V.length;G--;)V[G].el.style[P[V[G].name].heatOn]=X?C(P[V[G].name].heatmap,B.fps,0,L.maxFps):C(P[V[G].name].heatmap,B.duration,L.threshold,0);if(R.graph&&P.column.heatOn)for(G=N.length;G--;)N[G].style[P.column.heatOn]=X?C(P.column.heatmap,j[G],0,L.maxFps):C(P.column.heatmap,Y[G],L.threshold,0)}if(R.graph)for(O=0;O<L.history;O++)N[O].style.height=(X?j[O]?Math.round(E/L.maxFps*Math.min(j[O],L.maxFps)):0:Y[O]?Math.round(E/L.threshold*Math.min(Y[O],L.threshold)):0)+"px"}function v(){L.interval<20?(D=p(v),b()):(D=setTimeout(v,L.interval),F=p(b))}function w(t){t=t||window.event,t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),B.toggle()}function x(){L.toggleOn&&h(R.container,L.toggleOn,w,1),t.removeChild(R.container)}function T(){if(P=u.theme[L.theme],A=P.compiledHeatmaps||[],!A.length&&P.heatmaps.length){for(O=0;O<P.heatmaps.length;O++)for(A[O]=[],G=0;G<=U;G++)A[O][G]=s(.33/U*G,P.heatmaps[O].saturation,P.heatmaps[O].lightness);P.compiledHeatmaps=A}}function M(){R.container&&x(),T(),R.container=n(i("div"),P.container),R.count=R.container.appendChild(n(i("div"),P.count)),R.legend=R.container.appendChild(n(i("div"),P.legend)),R.graph=L.graph?R.container.appendChild(n(i("div"),P.graph)):0,V.length=0;for(var e in R)R[e]&&P[e].heatOn&&V.push({name:e,el:R[e]});if(N.length=0,R.graph)for(R.graph.style.width=L.history*P.column.width+(L.history-1)*P.column.spacing+"px",G=0;G<L.history;G++)N[G]=R.graph.appendChild(n(i("div"),P.column)),N[G].style.position="absolute",N[G].style.bottom=0,N[G].style.right=G*P.column.width+G*P.column.spacing+"px",N[G].style.width=P.column.width+"px",N[G].style.height="0px";_(),S(),t.appendChild(R.container),R.graph&&(E=R.graph.clientHeight),L.toggleOn&&("click"===L.toggleOn&&(R.container.style.cursor="pointer"),h(R.container,L.toggleOn,w))}function _(){n(R.container,L)}"object"===r(t)&&t.nodeType===e&&(l=t,t=document.body),t||(t=document.body);var P,A,k,D,F,E,I,G,O,B=this,L=a({},u.defaults,l||{}),R={},N=[],U=100,V=[],H=0,W=L.threshold,K=0,z=d()-W,j=[],Y=[],X="fps"===L.show;B.options=L,B.fps=0,B.duration=0,B.isPaused=0,B.tickStart=function(){K=d()},B.tick=function(){k=d(),H=k-z,W+=(H-W)/L.smoothing,B.fps=1e3/W,B.duration=K<z?W:k-K,z=k},B.pause=function(){return D&&(B.isPaused=1,clearTimeout(D),c(D),c(F),D=F=0),B},B.resume=function(){return D||(B.isPaused=0,v()),B},B.set=function(t,e){return L[t]=e,X="fps"===L.show,-1!==o(t,f)&&M(),-1!==o(t,y)&&_(),B},B.showDuration=function(){return B.set("show","ms"),B},B.showFps=function(){return B.set("show","fps"),B},B.toggle=function(){return B.set("show",X?"ms":"fps"),B},B.hide=function(){return B.pause(),R.container.style.display="none",B},B.show=function(){return B.resume(),R.container.style.display="block",B},B.destroy=function(){B.pause(),x(),B.tick=B.tickStart=function(){}},function(){M(),v()}()}var d;!function(){var e=t.performance;if(e&&(e.now||e.webkitNow)){var i=e.now?"now":"webkitNow";d=e[i].bind(e)}else d=function(){return+new Date}}();var c=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,p=t.requestAnimationFrame;!function(){for(var e=["moz","webkit","o"],i=0,n=0,r=e.length;n<r&&!c;++n)c=t[e[n]+"CancelAnimationFrame"]||t[e[n]+"CancelRequestAnimationFrame"],p=c&&t[e[n]+"RequestAnimationFrame"];c||(p=function(e){var n=d(),r=Math.max(0,16-(n-i));return i=n+r,t.setTimeout(function(){e(n+r)},r)},c=function(t){clearTimeout(t)})}();var g="string"===r(document.createElement("div").textContent)?"textContent":"innerText";u.extend=a,window.FPSMeter=u,u.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var f=["toggleOn","theme","heat","graph","history"],y=["position","zIndex","left","top","right","bottom","margin"]}(window),function(t,e,i){"use strict";e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter),define("fpsmeter",function(t){return function(){return t.FPSMeter}}(this)),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("jszip",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSZip=t()}}(function(){return function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return r(i||t)},u,u.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){"use strict";var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,r,a,s,l,h,u=[],d=0,c=t.length,p=c,g="string"!==n.getTypeOf(t);d<t.length;)p=c-d,g?(e=t[d++],i=d<c?t[d++]:0,r=d<c?t[d++]:0):(e=t.charCodeAt(d++),i=d<c?t.charCodeAt(d++):0,r=d<c?t.charCodeAt(d++):0),a=e>>2,s=(3&e)<<4|i>>4,l=p>1?(15&i)<<2|r>>6:64,h=p>2?63&r:64,u.push(o.charAt(a)+o.charAt(s)+o.charAt(l)+o.charAt(h));return u.join("")},i.decode=function(t){var e,i,n,a,s,l,h,u=0,d=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");var c=3*t.length/4;if(t.charAt(t.length-1)===o.charAt(64)&&c--,t.charAt(t.length-2)===o.charAt(64)&&c--,c%1!=0)throw new Error("Invalid base64 input, bad content length.");var p;for(p=r.uint8array?new Uint8Array(0|c):new Array(0|c);u<t.length;)a=o.indexOf(t.charAt(u++)),s=o.indexOf(t.charAt(u++)),l=o.indexOf(t.charAt(u++)),h=o.indexOf(t.charAt(u++)),e=a<<2|s>>4,i=(15&s)<<4|l>>2,n=(3&l)<<6|h,p[d++]=e,64!==l&&(p[d++]=i),64!==h&&(p[d++]=n);return p}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";function n(t,e,i,n,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=n,this.compressedContent=r}var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/DataLengthProbe"),s=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");n.prototype={getContentWorker:function(){var t=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(t,e,i){return t.pipe(new s).pipe(new a("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=n},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";function n(t,e,i,n){var r=a,o=n+i;t^=-1;for(var s=n;s<o;s++)t=t>>>8^r[255&(t^e[s])];return-1^t}function r(t,e,i,n){var r=a,o=n+i;t^=-1;for(var s=n;s<o;s++)t=t>>>8^r[255&(t^e.charCodeAt(s))];return-1^t}var o=t("./utils"),a=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==o.getTypeOf(t)?n(0|e,t,t.length,0):r(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:58}],7:[function(t,e,i){"use strict";function n(t,e){s.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=t("pako"),a=t("./utils"),s=t("./stream/GenericWorker"),l=r?"uint8array":"array";i.magic="\b\0",a.inherits(n,s),n.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(l,t.data),!1)},n.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},n.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},n.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new n("Deflate",t)},i.uncompressWorker=function(){return new n("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(t,e,i){"use strict";function n(t,e,i,n){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=t("../utils"),o=t("../stream/GenericWorker"),a=t("../utf8"),s=t("../crc32"),l=t("../signature"),h=function(t,e){var i,n="";for(i=0;i<e;i++)n+=String.fromCharCode(255&t),t>>>=8;return n},u=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16},d=function(t,e){return 63&(t||0)},c=function(t,e,i,n,o,c){var p,g,f=t.file,y=t.compression,m=c!==a.utf8encode,C=r.transformTo("string",c(f.name)),S=r.transformTo("string",a.utf8encode(f.name)),b=f.comment,v=r.transformTo("string",c(b)),w=r.transformTo("string",a.utf8encode(b)),x=S.length!==f.name.length,T=w.length!==b.length,M="",_="",P="",A=f.dir,k=f.date,D={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(D.crc32=t.crc32,
D.compressedSize=t.compressedSize,D.uncompressedSize=t.uncompressedSize);var F=0;e&&(F|=8),m||!x&&!T||(F|=2048);var E=0,I=0;A&&(E|=16),"UNIX"===o?(I=798,E|=u(f.unixPermissions,A)):(I=20,E|=d(f.dosPermissions)),p=k.getUTCHours(),p<<=6,p|=k.getUTCMinutes(),p<<=5,p|=k.getUTCSeconds()/2,g=k.getUTCFullYear()-1980,g<<=4,g|=k.getUTCMonth()+1,g<<=5,g|=k.getUTCDate(),x&&(_=h(1,1)+h(s(C),4)+S,M+="up"+h(_.length,2)+_),T&&(P=h(1,1)+h(s(v),4)+w,M+="uc"+h(P.length,2)+P);var G="";return G+="\n\0",G+=h(F,2),G+=y.magic,G+=h(p,2),G+=h(g,2),G+=h(D.crc32,4),G+=h(D.compressedSize,4),G+=h(D.uncompressedSize,4),G+=h(C.length,2),G+=h(M.length,2),{fileRecord:l.LOCAL_FILE_HEADER+G+C+M,dirRecord:l.CENTRAL_FILE_HEADER+h(I,2)+G+h(v.length,2)+"\0\0\0\0"+h(E,4)+h(n,4)+C+M+v}},p=function(t,e,i,n,o){var a=r.transformTo("string",o(n));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+h(t,2)+h(t,2)+h(e,4)+h(i,4)+h(a.length,2)+a},g=function(t){return l.DATA_DESCRIPTOR+h(t.crc32,4)+h(t.compressedSize,4)+h(t.uncompressedSize,4)};r.inherits(n,o),n.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,o.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-n-1))/i:100}}))},n.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=c(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},n.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=c(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:g(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,n=p(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},n.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},n.prototype.error=function(t){var e=this._sources;if(!o.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},n.prototype.lock=function(){o.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=n},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var n=t("../compressions"),r=t("./ZipFileWorker"),o=function(t,e){var i=t||e,r=n[i];if(!r)throw new Error(i+" is not a valid compression method !");return r};i.generateWorker=function(t,e,i){var n=new r(e.streamFiles,i,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,i){a++;var r=o(i.options.compression,e.compression),s=i.options.compressionOptions||e.compressionOptions||{},l=i.dir,h=i.date;i._compressWorker(r,s).withStreamInfo("file",{name:t,dir:l,date:h,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(n)}),n.entriesCount=a}catch(t){n.error(t)}return n}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}n.prototype=t("./object"),n.prototype.loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.1.5",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";function n(t){return new o.Promise(function(e,i){var n=t.decompressed.getContentWorker().pipe(new l);n.on("error",function(t){i(t)}).on("end",function(){n.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}var r=t("./utils"),o=t("./external"),a=t("./utf8"),r=t("./utils"),s=t("./zipEntries"),l=t("./stream/Crc32Probe"),h=t("./nodejsUtils");e.exports=function(t,e){var i=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(t)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var i=new s(e);return i.load(t),i}).then(function(t){var i=[o.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var a=0;a<r.length;a++)i.push(n(r[a]));return o.Promise.all(i)}).then(function(t){for(var n=t.shift(),r=n.files,o=0;o<r.length;o++){var a=r[o];i.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(i.comment=n.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";function n(t,e){o.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}var r=t("../utils"),o=t("../stream/GenericWorker");r.inherits(n,o),n.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},n.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";function n(t,e,i){r.call(this,e),this._helper=t;var n=this;t.on("data",function(t,e){n.push(t)||n._helper.pause(),i&&i(e)}).on("error",function(t){n.emit("error",t)}).on("end",function(){n.push(null)})}var r=t("readable-stream").Readable;t("../utils").inherits(n,r),n.prototype._read=function(){this._helper.resume()},e.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){return new Buffer(t,e)},allocBuffer:function(t){return Buffer.alloc?Buffer.alloc(t):new Buffer(t)},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function n(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),l=t("./defaults"),h=t("./compressedObject"),u=t("./zipObject"),d=t("./generate"),c=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),g=function(t,e,i){var n,r=o.getTypeOf(e),s=o.extend(i||{},l);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=y(t)),s.createFolders&&(n=f(t))&&m.call(this,n,!0);var d="string"===r&&!1===s.binary&&!1===s.base64;i&&void 0!==i.binary||(s.binary=!d),(e instanceof h&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e="",s.compression="STORE",r="string");var g=null;g=e instanceof h||e instanceof a?e:c.isNode&&c.isStream(e)?new p(t,e):o.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64);var C=new u(t,g,s);this.files[t]=C},f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},y=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:l.createFolders,t=y(t),this.files[t]||g.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,n;for(e in this.files)this.files.hasOwnProperty(e)&&(n=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,n))},filter:function(t){var e=[];return this.forEach(function(i,n){t(i,n)&&e.push(n)}),e},file:function(t,e,i){if(1===arguments.length){if(n(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var o=this.files[this.root+t];return o&&!o.dir?o:null}return t=this.root+t,g.call(this,t,e,i),this},folder:function(t){if(!t)return this;if(n(t))return this.filter(function(e,i){return i.dir&&t.test(e)});var e=this.root+t,i=m.call(this,e),r=this.clone();return r.root=i.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter(function(e,i){return i.name.slice(0,t.length)===t}),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if(i=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode}),i.type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");o.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";e=d.generateWorker(this,i,n)}catch(t){e=new a("error"),e.error(t)}return new s(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return t=t||{},t.type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";function n(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}var r=t("./DataReader");t("../utils").inherits(n,r),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===i&&this.data[o+2]===n&&this.data[o+3]===r)return o-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),r=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&i===o[1]&&n===o[2]&&r===o[3]},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}var r=t("../utils");n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=n},{"../utils":32}],19:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./Uint8ArrayReader");t("../utils").inherits(n,r),n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./DataReader");t("../utils").inherits(n,r),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./ArrayReader");t("../utils").inherits(n,r),n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),s=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new s(t):r.uint8array?new l(n.transformTo("uint8array",t)):new o(n.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";function n(t){r.call(this,"ConvertWorker to "+t),this.destType=t}var r=t("./GenericWorker"),o=t("../utils");o.inherits(n,r),n.prototype.processChunk=function(t){this.push({data:o.transformTo(this.destType,t.data),meta:t.meta})},e.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var r=t("./GenericWorker"),o=t("../crc32");t("../utils").inherits(n,r),n.prototype.processChunk=function(t){this.streamInfo.crc32=o(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";function n(t){o.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}var r=t("../utils"),o=t("./GenericWorker");r.inherits(n,o),n.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}o.prototype.processChunk.call(this,t)},e.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";function n(t){o.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}var r=t("../utils"),o=t("./GenericWorker");r.inherits(n,o),n.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,i){"use strict";function n(t,e,i){switch(t){case"blob":return s.newBlob(s.transformTo("arraybuffer",e),i);case"base64":return u.encode(e);default:return s.transformTo(t,e)}}function r(t,e){var i,n=0,r=null,o=0;for(i=0;i<e.length;i++)o+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(o),i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}function o(t,e){return new c.Promise(function(i,o){var a=[],s=t._internalType,l=t._outputType,h=t._mimeType;t.on("data",function(t,i){a.push(t),e&&e(i)}).on("error",function(t){a=[],o(t)}).on("end",function(){try{var t=n(l,r(s,a),h);i(t)}catch(t){o(t)}a=[]}).resume()})}function a(t,e,i){var n=e;switch(e){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=e,this._mimeType=i,s.checkSupport(n),this._worker=t.pipe(new l(n)),t.lock()}catch(t){this._worker=new h("error"),this._worker.error(t)}}var s=t("../utils"),l=t("./ConvertWorker"),h=t("./GenericWorker"),u=t("../base64"),d=t("../support"),c=t("../external"),p=null;if(d.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}a.prototype={accumulate:function(t){return o(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,function(t){e.call(i,t.data,t.meta)}):this._worker.on(t,function(){s.delay(e,arguments,i)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,o=new r;o.append(n),i.blob=0===o.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";function n(){l.call(this,"utf-8 decode"),this.leftOver=null}function r(){l.call(this,"utf-8 encode")}for(var o=t("./utils"),a=t("./support"),s=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;h[254]=h[254]=1;var d=function(t){var e,i,n,r,o,s=t.length,l=0;for(r=0;r<s;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=a.uint8array?new Uint8Array(l):new Array(l),o=0,r=0;o<l;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e},c=function(t,e){var i;for(e=e||t.length,e>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+h[t[i]]>e?i:e},p=function(t){var e,i,n,r,a=t.length,s=new Array(2*a);for(i=0,e=0;e<a;)if((n=t[e++])<128)s[i++]=n;else if((r=h[n])>4)s[i++]=65533,e+=r-1;else{for(n&=2===r?31:3===r?15:7;r>1&&e<a;)n=n<<6|63&t[e++],r--;r>1?s[i++]=65533:n<65536?s[i++]=n:(n-=65536,s[i++]=55296|n>>10&1023,s[i++]=56320|1023&n)}return s.length!==i&&(s.subarray?s=s.subarray(0,i):s.length=i),o.applyFromCharCode(s)};i.utf8encode=function(t){return a.nodebuffer?s.newBufferFrom(t,"utf-8"):d(t)},i.utf8decode=function(t){return a.nodebuffer?o.transformTo("nodebuffer",t).toString("utf-8"):(t=o.transformTo(a.uint8array?"uint8array":"array",t),p(t))},o.inherits(n,l),n.prototype.processChunk=function(t){var e=o.transformTo(a.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var n=e;e=new Uint8Array(n.length+this.leftOver.length),e.set(this.leftOver,0),e.set(n,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var r=c(e),s=e;r!==e.length&&(a.uint8array?(s=e.subarray(0,r),this.leftOver=e.subarray(r,e.length)):(s=e.slice(0,r),this.leftOver=e.slice(r,e.length))),this.push({data:i.utf8decode(s),meta:t.meta})},n.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=n,o.inherits(r,l),r.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=r},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";function n(t){var e=null;return e=l.uint8array?new Uint8Array(t.length):new Array(t.length),o(t,e)}function r(t){return t}function o(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}function a(t){var e=65536,n=i.getTypeOf(t),r=!0;if("uint8array"===n?r=p.applyCanBeUsed.uint8array:"nodebuffer"===n&&(r=p.applyCanBeUsed.nodebuffer),r)for(;e>1;)try{return p.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return p.stringifyByChar(t)}function s(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}var l=t("./support"),h=t("./base64"),u=t("./nodejsUtils"),d=t("core-js/library/fn/set-immediate"),c=t("./external");i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var n=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,r=new n;return r.append(t),r.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(t,e,i){var n=[],r=0,o=t.length;if(o<=i)return String.fromCharCode.apply(null,t);for(;r<o;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,o)))):n.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,o)))),r+=i;return n.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,u.allocBuffer(1)).length}catch(t){return!1}}()}};i.applyFromCharCode=a;var g={};g.string={string:r,array:function(t){return o(t,new Array(t.length))},arraybuffer:function(t){return g.string.uint8array(t).buffer},uint8array:function(t){return o(t,new Uint8Array(t.length))},nodebuffer:function(t){return o(t,u.allocBuffer(t.length))}},g.array={string:a,array:r,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return u.newBufferFrom(t)}},g.arraybuffer={string:function(t){return a(new Uint8Array(t))},array:function(t){return s(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:r,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return u.newBufferFrom(new Uint8Array(t))}},g.uint8array={string:a,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:r,nodebuffer:function(t){return u.newBufferFrom(t)}},g.nodebuffer={string:a,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return g.nodebuffer.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:r},i.transformTo=function(t,e){if(e||(e=""),!t)return e;i.checkSupport(t);var n=i.getTypeOf(e);return g[n][t](e)},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":l.nodebuffer&&u.isBuffer(t)?"nodebuffer":l.uint8array&&t instanceof Uint8Array?"uint8array":l.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!l[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,n="";for(i=0;i<(t||"").length;i++)e=t.charCodeAt(i),n+="\\x"+(e<16?"0":"")+e.toString(16).toUpperCase();return n},i.delay=function(t,e,i){d(function(){t.apply(i||null,e||[])})},i.inherits=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,r,o,a){return c.Promise.resolve(e).then(function(t){return l.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new c.Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){i(t.target.error)},n.readAsArrayBuffer(t)}):t}).then(function(e){var s=i.getTypeOf(e);return s?("arraybuffer"===s?e=i.transformTo("uint8array",e):"string"===s&&(a?e=h.decode(e):r&&!0!==o&&(e=n(e))),e):c.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(t,e,i){"use strict";function n(t){this.files=[],this.loadOptions=t}var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),s=t("./zipEntry"),l=(t("./utf8"),t("./support"));n.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(e)+", expected "+o.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4),r=n===e;return this.reader.setIndex(i),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=l.uint8array?"uint8array":"array",i=o.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)t=new s({zip64:this.zip64
},this.loadOptions),t.readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0){throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(t);var e=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=e-i;if(n>0)this.isSignature(e,a.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=n},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";function n(t,e){this.options=t,this.loadOptions=e}var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),s=t("./crc32"),l=t("./utf8"),h=t("./compressions"),u=t("./support"),d=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null};n.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=d(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,n,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<r;)e=t.readInt(2),i=t.readInt(2),n=t.readData(i),this.extraFields[e]={id:e,length:i,value:n}},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=o.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var r=o.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:s(this.fileName)!==e.readInt(4)?null:l.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:s(this.fileComment)!==e.readInt(4)?null:l.utf8decode(e.readData(t.length-5))}return null}},e.exports=n},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";var n=t("./stream/StreamHelper"),r=t("./stream/DataWorker"),o=t("./utf8"),a=t("./compressedObject"),s=t("./stream/GenericWorker"),l=function(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};l.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");i=t.toLowerCase();var r="string"===i||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!r&&(e=e.pipe(new o.Utf8EncodeWorker)),!a&&r&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){e=new s("error"),e.error(t)}return new n(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)l.prototype[h[d]]=u;e.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){t("../modules/web.immediate"),e.exports=t("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(t,e,i){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],38:[function(t,e,i){var n=t("./_is-object");e.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":51}],39:[function(t,e,i){var n={}.toString;e.exports=function(t){return n.call(t).slice(8,-1)}},{}],40:[function(t,e,i){var n=e.exports={version:"2.3.0"};"number"==typeof __e&&(__e=n)},{}],41:[function(t,e,i){var n=t("./_a-function");e.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},{"./_a-function":37}],42:[function(t,e,i){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(t,e,i){var n=t("./_is-object"),r=t("./_global").document,o=n(r)&&n(r.createElement);e.exports=function(t){return o?r.createElement(t):{}}},{"./_global":46,"./_is-object":51}],44:[function(t,e,i){var n=t("./_global"),r=t("./_core"),o=t("./_ctx"),a=t("./_hide"),s=function(t,e,i){var l,h,u,d=t&s.F,c=t&s.G,p=t&s.S,g=t&s.P,f=t&s.B,y=t&s.W,m=c?r:r[e]||(r[e]={}),C=m.prototype,S=c?n:p?n[e]:(n[e]||{}).prototype;c&&(i=e);for(l in i)(h=!d&&S&&void 0!==S[l])&&l in m||(u=h?S[l]:i[l],m[l]=c&&"function"!=typeof S[l]?i[l]:f&&h?o(u,n):y&&S[l]==u?function(t){var e=function(e,i,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(u):g&&"function"==typeof u?o(Function.call,u):u,g&&((m.virtual||(m.virtual={}))[l]=u,t&s.R&&C&&!C[l]&&a(C,l,u)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(t,e,i){e.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],46:[function(t,e,i){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],47:[function(t,e,i){var n=t("./_object-dp"),r=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(t,e,i){e.exports=t("./_global").document&&document.documentElement},{"./_global":46}],49:[function(t,e,i){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(t,e,i){e.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},{}],51:[function(t,e,i){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],52:[function(t,e,i){var n=t("./_an-object"),r=t("./_ie8-dom-define"),o=t("./_to-primitive"),a=Object.defineProperty;i.f=t("./_descriptors")?Object.defineProperty:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(t,e,i){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],54:[function(t,e,i){var n,r,o,a=t("./_ctx"),s=t("./_invoke"),l=t("./_html"),h=t("./_dom-create"),u=t("./_global"),d=u.process,c=u.setImmediate,p=u.clearImmediate,g=u.MessageChannel,f=0,y={},m=function(){var t=+this;if(y.hasOwnProperty(t)){var e=y[t];delete y[t],e()}},C=function(t){m.call(t.data)};c&&p||(c=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return y[++f]=function(){s("function"==typeof t?t:Function(t),e)},n(f),f},p=function(t){delete y[t]},"process"==t("./_cof")(d)?n=function(t){d.nextTick(a(m,t,1))}:g?(r=new g,o=r.port2,r.port1.onmessage=C,n=a(o.postMessage,o,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(t){u.postMessage(t+"","*")},u.addEventListener("message",C,!1)):n="onreadystatechange"in h("script")?function(t){l.appendChild(h("script")).onreadystatechange=function(){l.removeChild(this),m.call(t)}}:function(t){setTimeout(a(m,t,1),0)}),e.exports={set:c,clear:p}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(t,e,i){var n=t("./_is-object");e.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(t,e,i){var n=t("./_export"),r=t("./_task");n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},{"./_export":44,"./_task":54}],57:[function(t,e,i){(function(t){"use strict";function i(){u=!0;for(var t,e,i=d.length;i;){for(e=d,d=[],t=-1;++t<i;)e[t]();i=d.length}u=!1}function n(t){1!==d.push(t)||u||r()}var r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var a=0,s=new o(i),l=t.document.createTextNode("");s.observe(l,{characterData:!0}),r=function(){l.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){i(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(i,0)};else{var h=new t.MessageChannel;h.port1.onmessage=i,r=function(){h.port2.postMessage(0)}}var u,d=[];e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(t,e,i){"use strict";function n(){}function r(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=C,this.queue=[],this.outcome=void 0,t!==n&&l(this,t)}function o(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function a(t,e,i){g(function(){var n;try{n=e(i)}catch(e){return f.reject(t,e)}n===t?f.reject(t,new TypeError("Cannot resolve promise with itself")):f.resolve(t,n)})}function s(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function l(t,e){function i(e){o||(o=!0,f.reject(t,e))}function n(e){o||(o=!0,f.resolve(t,e))}function r(){e(n,i)}var o=!1,a=h(r);"error"===a.status&&i(a.value)}function h(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}function u(t){return t instanceof this?t:f.resolve(new this(n),t)}function d(t){var e=new this(n);return f.reject(e,t)}function c(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,s=-1,l=new this(n);++s<i;)!function(t,n){function s(t){o[n]=t,++a!==i||r||(r=!0,f.resolve(l,o))}e.resolve(t).then(s,function(t){r||(r=!0,f.reject(l,t))})}(t[s],s);return l}function p(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var o=-1,a=new this(n);++o<i;)!function(t){e.resolve(t).then(function(t){r||(r=!0,f.resolve(a,t))},function(t){r||(r=!0,f.reject(a,t))})}(t[o]);return a}var g=t("immediate"),f={},y=["REJECTED"],m=["FULFILLED"],C=["PENDING"];e.exports=r,r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){if("function"!=typeof t&&this.state===m||"function"!=typeof e&&this.state===y)return this;var i=new this.constructor(n);if(this.state!==C){a(i,this.state===m?t:e,this.outcome)}else this.queue.push(new o(i,t,e));return i},o.prototype.callFulfilled=function(t){f.resolve(this.promise,t)},o.prototype.otherCallFulfilled=function(t){a(this.promise,this.onFulfilled,t)},o.prototype.callRejected=function(t){f.reject(this.promise,t)},o.prototype.otherCallRejected=function(t){a(this.promise,this.onRejected,t)},f.resolve=function(t,e){var i=h(s,e);if("error"===i.status)return f.reject(t,i.value);var n=i.value;if(n)l(t,n);else{t.state=m,t.outcome=e;for(var r=-1,o=t.queue.length;++r<o;)t.queue[r].callFulfilled(e)}return t},f.reject=function(t,e){t.state=y,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},r.resolve=u,r.reject=d,r.all=c,r.race=p},{immediate:57}],59:[function(t,e,i){"use strict";var n=t("./lib/utils/common").assign,r=t("./lib/deflate"),o=t("./lib/inflate"),a=t("./lib/zlib/constants"),s={};n(s,r,o,a),e.exports=s},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=l.assign({level:g,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==p)throw new Error(u[i]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(r="string"==typeof e.dictionary?h.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=s.deflateSetDictionary(this.strm,r))!==p)throw new Error(u[i]);this._dict_set=!0}}function r(t,e){var i=new n(e);if(i.push(t,!0),i.err)throw i.msg||u[i.err];return i.result}function o(t,e){return e=e||{},e.raw=!0,r(t,e)}function a(t,e){return e=e||{},e.gzip=!0,r(t,e)}var s=t("./zlib/deflate"),l=t("./utils/common"),h=t("./utils/strings"),u=t("./zlib/messages"),d=t("./zlib/zstream"),c=Object.prototype.toString,p=0,g=-1,f=0,y=8;n.prototype.push=function(t,e){var i,n,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=h.string2buf(t):"[object ArrayBuffer]"===c.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new l.Buf8(o),r.next_out=0,r.avail_out=o),1!==(i=s.deflate(r,n))&&i!==p)return this.onEnd(i),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(h.buf2binstring(l.shrinkBuf(r.output,r.next_out))):this.onData(l.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&1!==i);return 4===n?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===p):2!==n||(this.onEnd(p),r.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=n,i.deflate=r,i.deflateRaw=o,i.gzip=a},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var i=a.inflateInit2(this.strm,e.windowBits);if(i!==h.Z_OK)throw new Error(u[i]);this.header=new c,a.inflateGetHeader(this.strm,this.header)}function r(t,e){var i=new n(e);if(i.push(t,!0),i.err)throw i.msg||u[i.err];return i.result}function o(t,e){return e=e||{},e.raw=!0,r(t,e)}var a=t("./zlib/inflate"),s=t("./utils/common"),l=t("./utils/strings"),h=t("./zlib/constants"),u=t("./zlib/messages"),d=t("./zlib/zstream"),c=t("./zlib/gzheader"),p=Object.prototype.toString;n.prototype.push=function(t,e){var i,n,r,o,u,d,c=this.strm,g=this.options.chunkSize,f=this.options.dictionary,y=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?h.Z_FINISH:h.Z_NO_FLUSH,"string"==typeof t?c.input=l.binstring2buf(t):"[object ArrayBuffer]"===p.call(t)?c.input=new Uint8Array(t):c.input=t,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(g),c.next_out=0,c.avail_out=g),i=a.inflate(c,h.Z_NO_FLUSH),i===h.Z_NEED_DICT&&f&&(d="string"==typeof f?l.string2buf(f):"[object ArrayBuffer]"===p.call(f)?new Uint8Array(f):f,i=a.inflateSetDictionary(this.strm,d)),i===h.Z_BUF_ERROR&&!0===y&&(i=h.Z_OK,y=!1),i!==h.Z_STREAM_END&&i!==h.Z_OK)return this.onEnd(i),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&i!==h.Z_STREAM_END&&(0!==c.avail_in||n!==h.Z_FINISH&&n!==h.Z_SYNC_FLUSH)||("string"===this.options.to?(r=l.utf8border(c.output,c.next_out),o=c.next_out-r,u=l.buf2string(c.output,r),c.next_out=o,c.avail_out=g-o,o&&s.arraySet(c.output,c.output,r,o,0),this.onData(u)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(y=!0)}while((c.avail_in>0||0===c.avail_out)&&i!==h.Z_STREAM_END);return i===h.Z_STREAM_END&&(n=h.Z_FINISH),n===h.Z_FINISH?(i=a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h.Z_OK):n!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),c.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===h.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=n,i.inflate=r,i.inflateRaw=o,i.ungzip=r},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)return void t.set(e.subarray(i,i+n),r);for(var o=0;o<n;o++)t[r+o]=e[i+o]},flattenChunks:function(t){var e,i,n,r,o,a;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(a=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)o=t[e],a.set(o,r),r+=o.length;return a}},o={arraySet:function(t,e,i,n,r){for(var o=0;o<n;o++)t[r+o]=e[i+o]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],63:[function(t,e,i){"use strict";function n(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var i="",n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i}var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new r.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,i.string2buf=function(t){var e,i,n,o,a,s=t.length,l=0;for(o=0;o<s;o++)i=t.charCodeAt(o),55296==(64512&i)&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(n-56320),o++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new r.Buf8(l),a=0,o=0;a<l;o++)i=t.charCodeAt(o),55296==(64512&i)&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(n-56320),o++),i<128?e[a++]=i:i<2048?(e[a++]=192|i>>>6,e[a++]=128|63&i):i<65536?(e[a++]=224|i>>>12,e[a++]=128|i>>>6&63,e[a++]=128|63&i):(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63,e[a++]=128|i>>>6&63,e[a++]=128|63&i);return e},i.buf2binstring=function(t){return n(t,t.length)},i.binstring2buf=function(t){for(var e=new r.Buf8(t.length),i=0,n=e.length;i<n;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,r,o,a,l=e||t.length,h=new Array(2*l);for(r=0,i=0;i<l;)if((o=t[i++])<128)h[r++]=o;else if((a=s[o])>4)h[r++]=65533,i+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&i<l;)o=o<<6|63&t[i++],a--;a>1?h[r++]=65533:o<65536?h[r++]=o:(o-=65536,h[r++]=55296|o>>10&1023,h[r++]=56320|1023&o)}return n(h,r)},i.utf8border=function(t,e){var i;for(e=e||t.length,e>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},{"./common":62}],64:[function(t,e,i){"use strict";function n(t,e,i,n){for(var r=65535&t|0,o=t>>>16&65535|0,a=0;0!==i;){a=i>2e3?2e3:i,i-=a;do{r=r+e[n++]|0,o=o+r|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}e.exports=n},{}],65:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(t,e,i){"use strict";function n(t,e,i,n){var o=r,a=n+i;t^=-1;for(var s=n;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}var r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=n},{}],67:[function(t,e,i){"use strict";function n(t,e){return t.msg=G[e],e}function r(t){return(t<<1)-(t>4?9:0)}function o(t){for(var e=t.length;--e>=0;)t[e]=0}function a(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(D.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function s(t,e){F._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,a(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function h(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function u(t,e,i,n){var r=t.avail_in;return r>n&&(r=n),0===r?0:(t.avail_in-=r,D.arraySet(e,t.input,t.next_in,r,i),1===t.state.wrap?t.adler=E(t.adler,e,r,i):2===t.state.wrap&&(t.adler=I(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)}function d(t,e){var i,n,r=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-ht?t.strstart-(t.w_size-ht):0,h=t.window,u=t.w_mask,d=t.prev,c=t.strstart+lt,p=h[o+a-1],g=h[o+a];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do{if(i=e,h[i+a]===g&&h[i+a-1]===p&&h[i]===h[o]&&h[++i]===h[o+1]){o+=2,i++;do{}while(h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&o<c);if(n=lt-(c-o),o=c-lt,n>a){if(t.match_start=e,a=n,n>=s)break;p=h[o+a-1],g=h[o+a]}}}while((e=d[e&u])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function c(t){var e,i,n,r,o,a=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=a+(a-ht)){D.arraySet(t.window,t.window,a,a,0),t.match_start-=a,t.strstart-=a,t.block_start-=a,i=t.hash_size,e=i;do{n=t.head[--e],t.head[e]=n>=a?n-a:0}while(--i);i=a,e=i;do{n=t.prev[--e],t.prev[e]=n>=a?n-a:0}while(--i);r+=a}if(0===t.strm.avail_in)break;if(i=u(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=i,t.lookahead+t.insert>=st)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+st-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<st)););}while(t.lookahead<ht&&0!==t.strm.avail_in)}function p(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(c(t),0===t.lookahead&&e===O)return Ct;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,s(t,!1),0===t.strm.avail_out))return Ct;if(t.strstart-t.block_start>=t.w_size-ht&&(s(t,!1),0===t.strm.avail_out))return Ct}return t.insert=0,e===R?(s(t,!0),0===t.strm.avail_out?bt:vt):(t.strstart>t.block_start&&(s(t,!1),t.strm.avail_out),Ct)}function g(t,e){for(var i,n;;){if(t.lookahead<ht){if(c(t),t.lookahead<ht&&e===O)return Ct;if(0===t.lookahead)break}if(i=0,t.lookahead>=st&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-ht&&(t.match_length=d(t,i)),t.match_length>=st)if(n=F._tr_tally(t,t.strstart-t.match_start,t.match_length-st),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=st){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(s(t,!1),0===t.strm.avail_out))return Ct}return t.insert=t.strstart<st-1?t.strstart:st-1,e===R?(s(t,!0),0===t.strm.avail_out?bt:vt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?Ct:St}function f(t,e){for(var i,n,r;;){if(t.lookahead<ht){if(c(t),t.lookahead<ht&&e===O)return Ct;if(0===t.lookahead)break}if(i=0,t.lookahead>=st&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=st-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-ht&&(t.match_length=d(t,i),t.match_length<=5&&(t.strategy===j||t.match_length===st&&t.strstart-t.match_start>4096)&&(t.match_length=st-1)),t.prev_length>=st&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-st,n=F._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-st),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+st-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=st-1,t.strstart++,n&&(s(t,!1),0===t.strm.avail_out))return Ct}else if(t.match_available){if(n=F._tr_tally(t,0,t.window[t.strstart-1]),n&&s(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Ct}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=F._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<st-1?t.strstart:st-1,e===R?(s(t,!0),0===t.strm.avail_out?bt:vt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?Ct:St}function y(t,e){for(var i,n,r,o,a=t.window;;){if(t.lookahead<=lt){if(c(t),t.lookahead<=lt&&e===O)return Ct;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=st&&t.strstart>0&&(r=t.strstart-1,(n=a[r])===a[++r]&&n===a[++r]&&n===a[++r])){o=t.strstart+lt
;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);t.match_length=lt-(o-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=st?(i=F._tr_tally(t,1,t.match_length-st),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(s(t,!1),0===t.strm.avail_out))return Ct}return t.insert=0,e===R?(s(t,!0),0===t.strm.avail_out?bt:vt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?Ct:St}function m(t,e){for(var i;;){if(0===t.lookahead&&(c(t),0===t.lookahead)){if(e===O)return Ct;break}if(t.match_length=0,i=F._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(s(t,!1),0===t.strm.avail_out))return Ct}return t.insert=0,e===R?(s(t,!0),0===t.strm.avail_out?bt:vt):t.last_lit&&(s(t,!1),0===t.strm.avail_out)?Ct:St}function C(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function S(t){t.window_size=2*t.w_size,o(t.head),t.max_lazy_match=k[t.level].max_lazy,t.good_match=k[t.level].good_length,t.nice_match=k[t.level].nice_length,t.max_chain_length=k[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=st-1,t.match_available=0,t.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new D.Buf16(2*ot),this.dyn_dtree=new D.Buf16(2*(2*nt+1)),this.bl_tree=new D.Buf16(2*(2*rt+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new D.Buf16(at+1),this.heap=new D.Buf16(2*it+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new D.Buf16(2*it+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=J,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?dt:yt,t.adler=2===e.wrap?0:1,e.last_flush=O,F._tr_init(e),U):n(t,H)}function w(t){var e=v(t);return e===U&&S(t.state),e}function x(t,e){return t&&t.state?2!==t.state.wrap?H:(t.state.gzhead=e,U):H}function T(t,e,i,r,o,a){if(!t)return H;var s=1;if(e===z&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>$||i!==Q||r<8||r>15||e<0||e>9||a<0||a>q)return n(t,H);8===r&&(r=9);var l=new b;return t.state=l,l.strm=t,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+st-1)/st),l.window=new D.Buf8(2*l.w_size),l.head=new D.Buf16(l.hash_size),l.prev=new D.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new D.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=i,w(t)}function M(t,e){return T(t,e,Q,tt,et,Z)}function _(t,e){var i,s,u,d;if(!t||!t.state||e>N||e<0)return t?n(t,H):H;if(s=t.state,!t.output||!t.input&&0!==t.avail_in||s.status===mt&&e!==R)return n(t,0===t.avail_out?K:H);if(s.strm=t,i=s.last_flush,s.last_flush=e,s.status===dt)if(2===s.wrap)t.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=I(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ct):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,wt),s.status=yt);else{var c=Q+(s.w_bits-8<<4)<<8,p=-1;p=s.strategy>=Y||s.level<2?0:s.level<6?1:6===s.level?2:3,c|=p<<6,0!==s.strstart&&(c|=ut),c+=31-c%31,s.status=yt,h(s,c),0!==s.strstart&&(h(s,t.adler>>>16),h(s,65535&t.adler)),t.adler=1}if(s.status===ct)if(s.gzhead.extra){for(u=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),a(t),u=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=pt)}else s.status=pt;if(s.status===pt)if(s.gzhead.name){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),a(t),u=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),0===d&&(s.gzindex=0,s.status=gt)}else s.status=gt;if(s.status===gt)if(s.gzhead.comment){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),a(t),u=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>u&&(t.adler=I(t.adler,s.pending_buf,s.pending-u,u)),0===d&&(s.status=ft)}else s.status=ft;if(s.status===ft&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(t),s.pending+2<=s.pending_buf_size&&(l(s,255&t.adler),l(s,t.adler>>8&255),t.adler=0,s.status=yt)):s.status=yt),0!==s.pending){if(a(t),0===t.avail_out)return s.last_flush=-1,U}else if(0===t.avail_in&&r(e)<=r(i)&&e!==R)return n(t,K);if(s.status===mt&&0!==t.avail_in)return n(t,K);if(0!==t.avail_in||0!==s.lookahead||e!==O&&s.status!==mt){var g=s.strategy===Y?m(s,e):s.strategy===X?y(s,e):k[s.level].func(s,e);if(g!==bt&&g!==vt||(s.status=mt),g===Ct||g===bt)return 0===t.avail_out&&(s.last_flush=-1),U;if(g===St&&(e===B?F._tr_align(s):e!==N&&(F._tr_stored_block(s,0,0,!1),e===L&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(t),0===t.avail_out))return s.last_flush=-1,U}return e!==R?U:s.wrap<=0?V:(2===s.wrap?(l(s,255&t.adler),l(s,t.adler>>8&255),l(s,t.adler>>16&255),l(s,t.adler>>24&255),l(s,255&t.total_in),l(s,t.total_in>>8&255),l(s,t.total_in>>16&255),l(s,t.total_in>>24&255)):(h(s,t.adler>>>16),h(s,65535&t.adler)),a(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?U:V)}function P(t){var e;return t&&t.state?(e=t.state.status)!==dt&&e!==ct&&e!==pt&&e!==gt&&e!==ft&&e!==yt&&e!==mt?n(t,H):(t.state=null,e===yt?n(t,W):U):H}function A(t,e){var i,n,r,a,s,l,h,u,d=e.length;if(!t||!t.state)return H;if(i=t.state,2===(a=i.wrap)||1===a&&i.status!==dt||i.lookahead)return H;for(1===a&&(t.adler=E(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===a&&(o(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new D.Buf8(i.w_size),D.arraySet(u,e,d-i.w_size,i.w_size,0),e=u,d=i.w_size),s=t.avail_in,l=t.next_in,h=t.input,t.avail_in=d,t.next_in=0,t.input=e,c(i);i.lookahead>=st;){n=i.strstart,r=i.lookahead-(st-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+st-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--r);i.strstart=n,i.lookahead=st-1,c(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=st-1,i.match_available=0,t.next_in=l,t.input=h,t.avail_in=s,i.wrap=a,U}var k,D=t("../utils/common"),F=t("./trees"),E=t("./adler32"),I=t("./crc32"),G=t("./messages"),O=0,B=1,L=3,R=4,N=5,U=0,V=1,H=-2,W=-3,K=-5,z=-1,j=1,Y=2,X=3,q=4,Z=0,J=2,Q=8,$=9,tt=15,et=8,it=286,nt=30,rt=19,ot=2*it+1,at=15,st=3,lt=258,ht=lt+st+1,ut=32,dt=42,ct=69,pt=73,gt=91,ft=103,yt=113,mt=666,Ct=1,St=2,bt=3,vt=4,wt=3;k=[new C(0,0,0,0,p),new C(4,4,8,4,g),new C(4,5,16,8,g),new C(4,6,32,32,g),new C(4,4,16,16,f),new C(8,16,32,32,f),new C(8,16,128,128,f),new C(8,32,128,256,f),new C(32,128,258,1024,f),new C(32,258,258,4096,f)],i.deflateInit=M,i.deflateInit2=T,i.deflateReset=w,i.deflateResetKeep=v,i.deflateSetHeader=x,i.deflate=_,i.deflateEnd=P,i.deflateSetDictionary=A,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(t,e,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],69:[function(t,e,i){"use strict";e.exports=function(t,e){var i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_;i=t.state,n=t.next_in,M=t.input,r=n+(t.avail_in-5),o=t.next_out,_=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),l=i.dmax,h=i.wsize,u=i.whave,d=i.wnext,c=i.window,p=i.hold,g=i.bits,f=i.lencode,y=i.distcode,m=(1<<i.lenbits)-1,C=(1<<i.distbits)-1;t:do{g<15&&(p+=M[n++]<<g,g+=8,p+=M[n++]<<g,g+=8),S=f[p&m];e:for(;;){if(b=S>>>24,p>>>=b,g-=b,0===(b=S>>>16&255))_[o++]=65535&S;else{if(!(16&b)){if(0==(64&b)){S=f[(65535&S)+(p&(1<<b)-1)];continue e}if(32&b){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}v=65535&S,b&=15,b&&(g<b&&(p+=M[n++]<<g,g+=8),v+=p&(1<<b)-1,p>>>=b,g-=b),g<15&&(p+=M[n++]<<g,g+=8,p+=M[n++]<<g,g+=8),S=y[p&C];i:for(;;){if(b=S>>>24,p>>>=b,g-=b,!(16&(b=S>>>16&255))){if(0==(64&b)){S=y[(65535&S)+(p&(1<<b)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&S,b&=15,g<b&&(p+=M[n++]<<g,(g+=8)<b&&(p+=M[n++]<<g,g+=8)),(w+=p&(1<<b)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=b,g-=b,b=o-a,w>b){if((b=w-b)>u&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(x=0,T=c,0===d){if(x+=h-b,b<v){v-=b;do{_[o++]=c[x++]}while(--b);x=o-w,T=_}}else if(d<b){if(x+=h+d-b,(b-=d)<v){v-=b;do{_[o++]=c[x++]}while(--b);if(x=0,d<v){b=d,v-=b;do{_[o++]=c[x++]}while(--b);x=o-w,T=_}}}else if(x+=d-b,b<v){v-=b;do{_[o++]=c[x++]}while(--b);x=o-w,T=_}for(;v>2;)_[o++]=T[x++],_[o++]=T[x++],_[o++]=T[x++],v-=3;v&&(_[o++]=T[x++],v>1&&(_[o++]=T[x++]))}else{x=o-w;do{_[o++]=_[x++],_[o++]=_[x++],_[o++]=_[x++],v-=3}while(v>2);v&&(_[o++]=_[x++],v>1&&(_[o++]=_[x++]))}break}}break}}while(n<r&&o<s);v=g>>3,n-=v,g-=v<<3,p&=(1<<g)-1,t.next_in=n,t.next_out=o,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=o<s?s-o+257:257-(o-s),i.hold=p,i.bits=g}},{}],70:[function(t,e,i){"use strict";function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new C.Buf16(320),this.work=new C.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=L,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new C.Buf32(ft),e.distcode=e.distdyn=new C.Buf32(yt),e.sane=1,e.back=-1,k):E}function a(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,o(t)):E}function s(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?E:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,a(t))):E}function l(t,e){var i,n;return t?(n=new r,t.state=n,n.window=null,i=s(t,e),i!==k&&(t.state=null),i):E}function h(t){return l(t,mt)}function u(t){if(Ct){var e;for(y=new C.Buf32(512),m=new C.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(w(T,t.lens,0,288,y,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;w(M,t.lens,0,32,m,0,t.work,{bits:5}),Ct=!1}t.lencode=y,t.lenbits=9,t.distcode=m,t.distbits=5}function d(t,e,i,n){var r,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new C.Buf8(o.wsize)),n>=o.wsize?(C.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>n&&(r=n),C.arraySet(o.window,e,i-n,r,o.wnext),n-=r,n?(C.arraySet(o.window,e,i-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function c(t,e){var i,r,o,a,s,l,h,c,p,g,f,y,m,ft,yt,mt,Ct,St,bt,vt,wt,xt,Tt,Mt,_t=0,Pt=new C.Buf8(4),At=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return E;i=t.state,i.mode===X&&(i.mode=q),s=t.next_out,o=t.output,h=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,c=i.hold,p=i.bits,g=l,f=h,xt=k;t:for(;;)switch(i.mode){case L:if(0===i.wrap){i.mode=q;break}for(;p<16;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(2&i.wrap&&35615===c){i.check=0,Pt[0]=255&c,Pt[1]=c>>>8&255,i.check=b(i.check,Pt,2,0),c=0,p=0,i.mode=R;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",i.mode=ct;break}if((15&c)!==B){t.msg="unknown compression method",i.mode=ct;break}if(c>>>=4,p-=4,wt=8+(15&c),0===i.wbits)i.wbits=wt;else if(wt>i.wbits){t.msg="invalid window size",i.mode=ct;break}i.dmax=1<<wt,t.adler=i.check=1,i.mode=512&c?j:X,c=0,p=0;break;case R:for(;p<16;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(i.flags=c,(255&i.flags)!==B){t.msg="unknown compression method",i.mode=ct;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=ct;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(Pt[0]=255&c,Pt[1]=c>>>8&255,i.check=b(i.check,Pt,2,0)),c=0,p=0,i.mode=N;case N:for(;p<32;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.head&&(i.head.time=c),512&i.flags&&(Pt[0]=255&c,Pt[1]=c>>>8&255,Pt[2]=c>>>16&255,Pt[3]=c>>>24&255,i.check=b(i.check,Pt,4,0)),c=0,p=0,i.mode=U;case U:for(;p<16;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(Pt[0]=255&c,Pt[1]=c>>>8&255,i.check=b(i.check,Pt,2,0)),c=0,p=0,i.mode=V;case V:if(1024&i.flags){for(;p<16;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(Pt[0]=255&c,Pt[1]=c>>>8&255,i.check=b(i.check,Pt,2,0)),c=0,p=0}else i.head&&(i.head.extra=null);i.mode=H;case H:if(1024&i.flags&&(y=i.length,y>l&&(y=l),y&&(i.head&&(wt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),C.arraySet(i.head.extra,r,a,y,wt)),512&i.flags&&(i.check=b(i.check,r,y,a)),l-=y,a+=y,i.length-=y),i.length))break t;i.length=0,i.mode=W;case W:if(2048&i.flags){if(0===l)break t;y=0;do{wt=r[a+y++],i.head&&wt&&i.length<65536&&(i.head.name+=String.fromCharCode(wt))}while(wt&&y<l);if(512&i.flags&&(i.check=b(i.check,r,y,a)),l-=y,a+=y,wt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=K;case K:if(4096&i.flags){if(0===l)break t;y=0;do{wt=r[a+y++],i.head&&wt&&i.length<65536&&(i.head.comment+=String.fromCharCode(wt))}while(wt&&y<l);if(512&i.flags&&(i.check=b(i.check,r,y,a)),l-=y,a+=y,wt)break t}else i.head&&(i.head.comment=null);i.mode=z;case z:if(512&i.flags){for(;p<16;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(c!==(65535&i.check)){t.msg="header crc mismatch",i.mode=ct;break}c=0,p=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=X;break;case j:for(;p<32;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}t.adler=i.check=n(c),c=0,p=0,i.mode=Y;case Y:if(0===i.havedict)return t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=l,i.hold=c,i.bits=p,F;t.adler=i.check=1,i.mode=X;case X:if(e===P||e===A)break t;case q:if(i.last){c>>>=7&p,p-=7&p,i.mode=ht;break}for(;p<3;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}switch(i.last=1&c,c>>>=1,p-=1,3&c){case 0:i.mode=Z;break;case 1:if(u(i),i.mode=it,e===A){c>>>=2,p-=2;break t}break;case 2:i.mode=$;break;case 3:t.msg="invalid block type",i.mode=ct}c>>>=2,p-=2;break;case Z:for(c>>>=7&p,p-=7&p;p<32;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",i.mode=ct;break}if(i.length=65535&c,c=0,p=0,i.mode=J,e===A)break t;case J:i.mode=Q;case Q:if(y=i.length){if(y>l&&(y=l),y>h&&(y=h),0===y)break t;C.arraySet(o,r,a,y,s),l-=y,a+=y,h-=y,s+=y,i.length-=y;break}i.mode=X;break;case $:for(;p<14;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(i.nlen=257+(31&c),c>>>=5,p-=5,i.ndist=1+(31&c),c>>>=5,p-=5,i.ncode=4+(15&c),c>>>=4,p-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=ct;break}i.have=0,i.mode=tt;case tt:for(;i.have<i.ncode;){for(;p<3;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.lens[At[i.have++]]=7&c,c>>>=3,p-=3}for(;i.have<19;)i.lens[At[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Tt={bits:i.lenbits},xt=w(x,i.lens,0,19,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,xt){t.msg="invalid code lengths set",i.mode=ct;break}i.have=0,i.mode=et;case et:for(;i.have<i.nlen+i.ndist;){for(;_t=i.lencode[c&(1<<i.lenbits)-1],yt=_t>>>24,mt=_t>>>16&255,Ct=65535&_t,!(yt<=p);){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(Ct<16)c>>>=yt,p-=yt,i.lens[i.have++]=Ct;else{if(16===Ct){for(Mt=yt+2;p<Mt;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(c>>>=yt,p-=yt,0===i.have){t.msg="invalid bit length repeat",i.mode=ct;break}wt=i.lens[i.have-1],y=3+(3&c),c>>>=2,p-=2}else if(17===Ct){for(Mt=yt+3;p<Mt;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}c>>>=yt,p-=yt,wt=0,y=3+(7&c),c>>>=3,p-=3}else{for(Mt=yt+7;p<Mt;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}c>>>=yt,p-=yt,wt=0,y=11+(127&c),c>>>=7,p-=7}if(i.have+y>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=ct;break}for(;y--;)i.lens[i.have++]=wt}}if(i.mode===ct)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=ct;break}if(i.lenbits=9,Tt={bits:i.lenbits},xt=w(T,i.lens,0,i.nlen,i.lencode,0,i.work,Tt),i.lenbits=Tt.bits,xt){t.msg="invalid literal/lengths set",i.mode=ct;break}if(i.distbits=6,i.distcode=i.distdyn,Tt={bits:i.distbits},xt=w(M,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Tt),i.distbits=Tt.bits,xt){t.msg="invalid distances set",i.mode=ct;break}if(i.mode=it,e===A)break t;case it:i.mode=nt;case nt:if(l>=6&&h>=258){t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=l,i.hold=c,i.bits=p,v(t,f),s=t.next_out,o=t.output,h=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,c=i.hold,p=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;_t=i.lencode[c&(1<<i.lenbits)-1],yt=_t>>>24,mt=_t>>>16&255,Ct=65535&_t,!(yt<=p);){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(mt&&0==(240&mt)){for(St=yt,bt=mt,vt=Ct;_t=i.lencode[vt+((c&(1<<St+bt)-1)>>St)],yt=_t>>>24,mt=_t>>>16&255,Ct=65535&_t,!(St+yt<=p);){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}c>>>=St,p-=St,i.back+=St}if(c>>>=yt,p-=yt,i.back+=yt,i.length=Ct,0===mt){i.mode=lt;break}if(32&mt){i.back=-1,i.mode=X;break}if(64&mt){t.msg="invalid literal/length code",i.mode=ct;break}i.extra=15&mt,i.mode=rt;case rt:if(i.extra){for(Mt=i.extra;p<Mt;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,p-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=ot;case ot:for(;_t=i.distcode[c&(1<<i.distbits)-1],yt=_t>>>24,mt=_t>>>16&255,Ct=65535&_t,!(yt<=p);){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(0==(240&mt)){for(St=yt,bt=mt,vt=Ct;_t=i.distcode[vt+((c&(1<<St+bt)-1)>>St)],yt=_t>>>24,mt=_t>>>16&255,Ct=65535&_t,!(St+yt<=p);){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}c>>>=St,p-=St,i.back+=St}if(c>>>=yt,p-=yt,i.back+=yt,64&mt){t.msg="invalid distance code",i.mode=ct;break}i.offset=Ct,i.extra=15&mt,i.mode=at;case at:if(i.extra){for(Mt=i.extra;p<Mt;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,p-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=ct;break}i.mode=st;case st:if(0===h)break t;if(y=f-h,i.offset>y){if((y=i.offset-y)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=ct;break}y>i.wnext?(y-=i.wnext,m=i.wsize-y):m=i.wnext-y,y>i.length&&(y=i.length),ft=i.window}else ft=o,m=s-i.offset,y=i.length;y>h&&(y=h),h-=y,i.length-=y;do{o[s++]=ft[m++]}while(--y);0===i.length&&(i.mode=nt);break;case lt:if(0===h)break t;o[s++]=i.length,h--,i.mode=nt;break;case ht:if(i.wrap){for(;p<32;){if(0===l)break t;l--,c|=r[a++]<<p,p+=8}if(f-=h,t.total_out+=f,i.total+=f,f&&(t.adler=i.check=i.flags?b(i.check,o,f,s-f):S(i.check,o,f,s-f)),f=h,(i.flags?c:n(c))!==i.check){t.msg="incorrect data check",i.mode=ct;break}c=0,p=0}i.mode=ut;case ut:if(i.wrap&&i.flags){for(;p<32;){if(0===l)break t;l--,c+=r[a++]<<p,p+=8}if(c!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=ct;break}c=0,p=0}i.mode=dt;case dt:xt=D;break t;case ct:xt=I;break t;case pt:return G;case gt:default:return E}return t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=l,i.hold=c,i.bits=p,(i.wsize||f!==t.avail_out&&i.mode<ct&&(i.mode<ht||e!==_))&&d(t,t.output,t.next_out,f-t.avail_out)?(i.mode=pt,G):(g-=t.avail_in,f-=t.avail_out,t.total_in+=g,t.total_out+=f,i.total+=f,i.wrap&&f&&(t.adler=i.check=i.flags?b(i.check,o,f,t.next_out-f):S(i.check,o,f,t.next_out-f)),t.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===it||i.mode===J?256:0),(0===g&&0===f||e===_)&&xt===k&&(xt=O),xt)}function p(t){if(!t||!t.state)return E;var e=t.state;return e.window&&(e.window=null),t.state=null,k}function g(t,e){var i;return t&&t.state?(i=t.state,0==(2&i.wrap)?E:(i.head=e,e.done=!1,k)):E}function f(t,e){var i,n,r=e.length;return t&&t.state?(i=t.state,0!==i.wrap&&i.mode!==Y?E:i.mode===Y&&(n=1,(n=S(n,e,r,0))!==i.check)?I:d(t,e,r,r)?(i.mode=pt,G):(i.havedict=1,k)):E}var y,m,C=t("../utils/common"),S=t("./adler32"),b=t("./crc32"),v=t("./inffast"),w=t("./inftrees"),x=0,T=1,M=2,_=4,P=5,A=6,k=0,D=1,F=2,E=-2,I=-3,G=-4,O=-5,B=8,L=1,R=2,N=3,U=4,V=5,H=6,W=7,K=8,z=9,j=10,Y=11,X=12,q=13,Z=14,J=15,Q=16,$=17,tt=18,et=19,it=20,nt=21,rt=22,ot=23,at=24,st=25,lt=26,ht=27,ut=28,dt=29,ct=30,pt=31,gt=32,ft=852,yt=592,mt=15,Ct=!0;i.inflateReset=a,i.inflateReset2=s,i.inflateResetKeep=o,i.inflateInit=h,i.inflateInit2=l,i.inflate=c,i.inflateEnd=p,i.inflateGetHeader=g,i.inflateSetDictionary=f,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(t,e,i){"use strict";var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,l,h,u,d,c){var p,g,f,y,m,C,S,b,v,w=c.bits,x=0,T=0,M=0,_=0,P=0,A=0,k=0,D=0,F=0,E=0,I=null,G=0,O=new n.Buf16(16),B=new n.Buf16(16),L=null,R=0;for(x=0;x<=15;x++)O[x]=0;for(T=0;T<l;T++)O[e[i+T]]++;for(P=w,_=15;_>=1&&0===O[_];_--);if(P>_&&(P=_),0===_)return h[u++]=20971520,h[u++]=20971520,c.bits=1,0;for(M=1;M<_&&0===O[M];M++);for(P<M&&(P=M),D=1,x=1;x<=15;x++)if(D<<=1,(D-=O[x])<0)return-1;if(D>0&&(0===t||1!==_))return-1;for(B[1]=0,x=1;x<15;x++)B[x+1]=B[x]+O[x];for(T=0;T<l;T++)0!==e[i+T]&&(d[B[e[i+T]]++]=T);if(0===t?(I=L=d,C=19):1===t?(I=r,G-=257,L=o,R-=257,C=256):(I=a,L=s,C=-1),E=0,T=0,x=M,m=u,A=P,k=0,f=-1,F=1<<P,y=F-1,1===t&&F>852||2===t&&F>592)return 1;for(;;){S=x-k,d[T]<C?(b=0,v=d[T]):d[T]>C?(b=L[R+d[T]],v=I[G+d[T]]):(b=96,v=0),p=1<<x-k,g=1<<A,M=g;do{g-=p,h[m+(E>>k)+g]=S<<24|b<<16|v|0}while(0!==g);for(p=1<<x-1;E&p;)p>>=1;if(0!==p?(E&=p-1,E+=p):E=0,T++,0==--O[x]){if(x===_)break;x=e[i+d[T]]}if(x>P&&(E&y)!==f){for(0===k&&(k=P),m+=M,A=x-k,D=1<<A;A+k<_&&!((D-=O[A+k])<=0);)A++,D<<=1;if(F+=1<<A,1===t&&F>852||2===t&&F>592)return 1;f=E&y,h[f]=P<<24|A<<16|m-u|0}}return 0!==E&&(h[m+E]=x-k<<24|64<<16|0),c.bits=P,0}},{"../utils/common":62}],72:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(t,e,i){"use strict";function n(t){for(var e=t.length;--e>=0;)t[e]=0}function r(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function o(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function a(t){return t<256?ot[t]:ot[256+(t>>>7)]}function s(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function l(t,e,i){t.bi_valid>Y-i?(t.bi_buf|=e<<t.bi_valid&65535,s(t,t.bi_buf),t.bi_buf=e>>Y-t.bi_valid,t.bi_valid+=i-Y):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function h(t,e,i){l(t,i[2*e],i[2*e+1])}function u(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function d(t){16===t.bi_valid?(s(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function c(t,e){var i,n,r,o,a,s,l=e.dyn_tree,h=e.max_code,u=e.stat_desc.static_tree,d=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,g=e.stat_desc.max_length,f=0;for(o=0;o<=j;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<z;i++)n=t.heap[i],o=l[2*l[2*n+1]+1]+1,o>g&&(o=g,f++),l[2*n+1]=o,n>h||(t.bl_count[o]++,a=0,n>=p&&(a=c[n-p]),s=l[2*n],t.opt_len+=s*(o+a),d&&(t.static_len+=s*(u[2*n+1]+a)));if(0!==f){do{for(o=g-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[g]--,f-=2}while(f>0);for(o=g;0!==o;o--)for(n=t.bl_count[o];0!==n;)(r=t.heap[--i])>h||(l[2*r+1]!==o&&(t.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),n--)}}function p(t,e,i){var n,r,o=new Array(j+1),a=0;for(n=1;n<=j;n++)o[n]=a=a+i[n-1]<<1;for(r=0;r<=e;r++){var s=t[2*r+1];0!==s&&(t[2*r]=u(o[s]++,s))}}function g(){var t,e,i,n,o,a=new Array(j+1);for(i=0,n=0;n<U-1;n++)for(st[n]=i,t=0;t<1<<$[n];t++)at[i++]=n;for(at[i-1]=n,o=0,n=0;n<16;n++)for(lt[n]=o,t=0;t<1<<tt[n];t++)ot[o++]=n;for(o>>=7;n<W;n++)for(lt[n]=o<<7,t=0;t<1<<tt[n]-7;t++)ot[256+o++]=n;for(e=0;e<=j;e++)a[e]=0;for(t=0;t<=143;)nt[2*t+1]=8,t++,a[8]++;for(;t<=255;)nt[2*t+1]=9,t++,a[9]++;for(;t<=279;)nt[2*t+1]=7,t++,a[7]++;for(;t<=287;)nt[2*t+1]=8,t++,a[8]++;for(p(nt,H+1,a),t=0;t<W;t++)rt[2*t+1]=5,rt[2*t]=u(t,5);ht=new r(nt,$,V+1,H,j),ut=new r(rt,tt,0,W,j),dt=new r(new Array(0),et,0,K,X)}function f(t){var e;for(e=0;e<H;e++)t.dyn_ltree[2*e]=0;for(e=0;e<W;e++)t.dyn_dtree[2*e]=0;for(e=0;e<K;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*q]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function y(t){t.bi_valid>8?s(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function m(t,e,i,n){y(t),n&&(s(t,i),s(t,~i)),E.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}function C(t,e,i,n){var r=2*e,o=2*i;return t[r]<t[o]||t[r]===t[o]&&n[e]<=n[i]}function S(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&C(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!C(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function b(t,e,i){var n,r,o,s,u=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*u]<<8|t.pending_buf[t.d_buf+2*u+1],r=t.pending_buf[t.l_buf+u],u++,0===n?h(t,r,e):(o=at[r],h(t,o+V+1,e),s=$[o],0!==s&&(r-=st[o],l(t,r,s)),n--,o=a(n),h(t,o,i),0!==(s=tt[o])&&(n-=lt[o],l(t,n,s)))}while(u<t.last_lit);h(t,q,e)}function v(t,e){var i,n,r,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=z,i=0;i<l;i++)0!==o[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):o[2*i+1]=0;for(;t.heap_len<2;)r=t.heap[++t.heap_len]=h<2?++h:0,o[2*r]=1,t.depth[r]=0,t.opt_len--,s&&(t.static_len-=a[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)S(t,o,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],S(t,o,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,o[2*r]=o[2*i]+o[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,o[2*i+1]=o[2*n+1]=r,t.heap[1]=r++,S(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],c(t,e),p(o,h,t.bl_count)}function w(t,e,i){var n,r,o=-1,a=e[1],s=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=a,a=e[2*(n+1)+1],++s<l&&r===a||(s<h?t.bl_tree[2*r]+=s:0!==r?(r!==o&&t.bl_tree[2*r]++,t.bl_tree[2*Z]++):s<=10?t.bl_tree[2*J]++:t.bl_tree[2*Q]++,s=0,o=r,0===a?(l=138,h=3):r===a?(l=6,h=3):(l=7,h=4))}function x(t,e,i){var n,r,o=-1,a=e[1],s=0,u=7,d=4;for(0===a&&(u=138,d=3),n=0;n<=i;n++)if(r=a,a=e[2*(n+1)+1],!(++s<u&&r===a)){if(s<d)do{h(t,r,t.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(h(t,r,t.bl_tree),s--),h(t,Z,t.bl_tree),l(t,s-3,2)):s<=10?(h(t,J,t.bl_tree),l(t,s-3,3)):(h(t,Q,t.bl_tree),l(t,s-11,7));s=0,o=r,0===a?(u=138,d=3):r===a?(u=6,d=3):(u=7,d=4)}}function T(t){var e;for(w(t,t.dyn_ltree,t.l_desc.max_code),w(t,t.dyn_dtree,t.d_desc.max_code),v(t,t.bl_desc),e=K-1;e>=3&&0===t.bl_tree[2*it[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function M(t,e,i,n){var r;for(l(t,e-257,5),l(t,i-1,5),l(t,n-4,4),r=0;r<n;r++)l(t,t.bl_tree[2*it[r]+1],3);x(t,t.dyn_ltree,e-1),x(t,t.dyn_dtree,i-1)}function _(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return G;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return O;for(e=32;e<V;e++)if(0!==t.dyn_ltree[2*e])return O;return G}function P(t){ct||(g(),ct=!0),t.l_desc=new o(t.dyn_ltree,ht),t.d_desc=new o(t.dyn_dtree,ut),t.bl_desc=new o(t.bl_tree,dt),t.bi_buf=0,t.bi_valid=0,f(t)}function A(t,e,i,n){l(t,(L<<1)+(n?1:0),3),m(t,e,i,!0)}function k(t){l(t,R<<1,3),h(t,q,nt),d(t)}function D(t,e,i,n){var r,o,a=0;t.level>0?(t.strm.data_type===B&&(t.strm.data_type=_(t)),v(t,t.l_desc),v(t,t.d_desc),a=T(t),r=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=r&&(r=o)):r=o=i+5,i+4<=r&&-1!==e?A(t,e,i,n):t.strategy===I||o===r?(l(t,(R<<1)+(n?1:0),3),b(t,nt,rt)):(l(t,(N<<1)+(n?1:0),3),M(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),b(t,t.dyn_ltree,t.dyn_dtree)),f(t),n&&y(t)}function F(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(at[i]+V+1)]++,t.dyn_dtree[2*a(e)]++),t.last_lit===t.lit_bufsize-1}var E=t("../utils/common"),I=4,G=0,O=1,B=2,L=0,R=1,N=2,U=29,V=256,H=V+1+U,W=30,K=19,z=2*H+1,j=15,Y=16,X=7,q=256,Z=16,J=17,Q=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],et=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],it=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nt=new Array(2*(H+2));n(nt);var rt=new Array(2*W);n(rt);var ot=new Array(512);n(ot);var at=new Array(256);n(at);var st=new Array(U);n(st);var lt=new Array(W);n(lt);var ht,ut,dt,ct=!1;i._tr_init=P,i._tr_stored_block=A,i._tr_flush_block=D,i._tr_tally=F,i._tr_align=k},{"../utils/common":62}],74:[function(t,e,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}]},{},[10])(10)}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("jsziputils",t):"undefined"!=typeof window?window.JSZipUtils=t():"undefined"!=typeof global?global.JSZipUtils=t():"undefined"!=typeof self&&(self.JSZipUtils=t())}(function(){return function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return r(i||t)},h,h.exports,t,e,i,n)}
return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){"use strict";function n(){try{return new window.XMLHttpRequest}catch(t){}}function r(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}var o={};o._getBinaryFromXHR=function(t){return t.response||t.responseText};var a=window.ActiveXObject?function(){return n()||r()}:n;o.getBinaryContent=function(t,e){try{var i=a();i.open("GET",t,!0),"responseType"in i&&(i.responseType="arraybuffer"),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(n){var r,a;if(4===i.readyState)if(200===i.status||0===i.status){r=null,a=null;try{r=o._getBinaryFromXHR(i)}catch(t){a=new Error(t)}e(a,r)}else e(new Error("Ajax error for "+t+" : "+this.status+" "+this.statusText),null)},i.send()}catch(t){e(new Error(t),null)}},e.exports=o},{}]},{},[1])(1)}),define("gameconfig",["text!gameconfig.json"],function(t){return JSON.parse(t)}),define("Solitaire/MvvmStructure/Service/ManifestService",["jszip","jsziputils","gameconfig"],function(t,e,i){"use strict";return{_manifestURLBase:i.manifest.baseURL,_manifest:null,GetManifestURL:function(){return this._manifestURLBase+="&timestamp="+(new Date).getTime()+"&random="+Math.floor(9007199254740991*Math.random())},Load:function(i,n){e.getBinaryContent(this.GetManifestURL(),function(e,r){e&&n(e);try{t.loadAsync(r).then(function(t){t.file("manifest.js").async("string").then(function(t){this.SetManifest(t),i()}.bind(this))}.bind(this))}catch(t){n(t)}}.bind(this))},SetManifest:function(t){this._manifest=JSON.parse(t)},GetSettings:function(t,e){if(!this._manifest||!this._manifest.Settings)return null;for(var i=0;i<this._manifest.Settings.length;i++){var n=this._manifest.Settings[i];if(n.Group==t)for(var r=0;r<n.Items.length;r++){var o=n.Items[r];if(o.Key==e)return o}}return null},IsValid:function(){return null!=this._manifest}}}),define("absolute/musicmanager",["absolute/gameconfig","absolute/audiomanager","absoluteaudio"],function(t,e,i){return{currentTrack:null,isMuted:function(){return!t.getVal("musicEnabled")},playMusic:function(t){t!==this.currentTrack&&(this.currentTrack&&e.stopSound(this.currentTrack),this.currentTrack=t,this.isMuted()?e.muteSound(this.currentTrack):e.unmuteSound(this.currentTrack),!e.simulSoundSupport()&&e.isSfxEnabled()||(i.context.usingWebAudio()||i.context.usingSoundManagerAudio()?e.playSound(this.currentTrack):window.setTimeout(function(){e.playSound(this.currentTrack)}.bind(this),500)))},stopMusic:function(){e.stopSound(this.currentTrack),this.currentTrack=null},setMuted:function(i,n){if(!n){if(i===this.isMuted())return;t.setVal("musicEnabled",!i)}this.currentTrack&&(i?e.muteSound(this.currentTrack):e.unmuteSound(this.currentTrack))}}}),define("Managers/TelemetryManager",["absolute/storagemanager"],function(t){"use strict";return{_installId:null,_key:"InstallId",_appInsights:null,setInstallId:function(){t.prefix&&(this._installId||(this._installId=t.fetch(this._key)))},appException:function(t){this.setInstallId(),console.info("ApplicationInsightsException: ",t);var e={gameURL:window.location.href,installId:this._installId};this._appInsights.trackException({exception:t,severityLevel:"Error",properties:e})},appLaunch:function(t){this._appInsights=t,this._trackEvent("AppLaunch")},badgeAwarded:function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y){this._trackEvent("BadgeAwarded",{badge:t,month:e,year:i,bronzeBadges:n,silverBadges:r,goldBadges:o,diamondBadges:a,perfectBadges:s,klondikeChallenges:l,spiderChallenges:h,freecellChallenges:u,pyramidChallenges:d,tripeaksChallenges:c,easyChallenges:p,mediumChallenges:g,hardChallenges:f,expertChallenges:y})},challengeComplete:function(t,e,i,n,r){this._trackEvent("ChallengeComplete",{gameResult:t,gameMode:e,timeSpent:i,releaseDate:n,difficulty:r})},challengeStart:function(t,e,i){this._trackEvent("ChallengeStart",{releaseDate:t,gameMode:e,source:i?"Restart":"New"})},classicGameComplete:function(t,e,i,n,r,o){this._trackEvent("ClassicComplete",{gameResult:t,gameMode:e,timeSpent:i,scoringOption:n||null,drawOption:r||null,numSuits:o||null})},classicGameStart:function(t,e,i,n,r){this._trackEvent("ClassicStart",{gameMode:t,startType:e,scoringOption:i||null,drawOption:n||null,numSuits:r||null})},fullscreenButtonClick:function(t){t?this._trackEvent("FullscreenButtonWindowed"):this._trackEvent("FullscreenButtonFullscreen")},gameSettingChanged:function(t,e,i){this._trackEvent("GameSettingChanged",{settingPrefix:t,setting:e,state:i})},mainMenuLoad:function(t,e,i){this._trackEvent("MainMenuLoad",{completed:{starClub:t,dailyChallenges:e,gameModes:i}})},manifestError:function(t){this._trackEvent("AppManifest Error",{error:t})},menuOptionSelected:function(t){this._trackEvent("MenuOptionSelected",{option:t})},newInstall:function(){this._trackEvent("NewInstall")},newsShown:function(t,e){this._trackEvent("NewsShown",{type:t,reason:e})},saveMigrationCompleted:function(t,e,i,n){this._trackEvent("SaveMigrationCompleted",{oldProgressionGamesPlayed:t,oldRegularGamesPlayed:e,newProgressionGamesPlayed:i,newRegularGamesPlayed:n})},saveMigrationFailed:function(t,e){this._trackEvent("SaveMigrationFailed",{exception:t,localStorageSizes:e}),this.appException(t)},starClubComplete:function(t,e,i,n,r,o){this._trackEvent("StarClubComplete",{gameResult:t,timeSpent:e,gameMode:i,difficulty:n,collectionName:r,packName:o})},starClubStart:function(t){this._trackEvent("StarClubStart",{gameMode:t})},_trackEvent:function(t,e){void 0===e&&(e={}),this.setInstallId(),e.installId=this._installId,e.gameURL=window.location.href,console.info("ApplicationInsightsEvent: ",t,e),this._appInsights.trackEvent({name:t},e)}}}),define("Managers/BrowserUtils",[],function(){function t(t,e){var i=0,n=!1,r=window.setInterval(function(){t()&&(window.clearInterval(r),e(n)),i++>50&&(window.clearInterval(r),n=!0,e(n))},10)}function e(t){var e=t.toLowerCase();if(0===e.indexOf("msie")&&0===e.indexOf("trident"))return!1;var i=/(?:msie|rv:)\s?([\d\.]+)/.exec(e);if(i&&parseInt(i[1],10)>=10)return!0;var n=/edge/.exec(e);return!(!n||"edge"!=n[0])}return{detectPrivateMode:function(i,n){var r;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){r=!1},function(t){console.log(t),r=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{o=window.indexedDB.open("test")}catch(t){r=!0}void 0===r&&t(function(){return"done"===o.readyState},function(t){t||(r=!o.result)})}else if(e(window.navigator.userAgent)){r=!1;try{window.indexedDB||(r=!0)}catch(t){r=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(t){r=!0}void 0===r&&(r=!1,window.localStorage.removeItem("test"))}t(function(){return void 0!==r},function(t){i.call(n,r)})},isInIframe:function(){try{return window.self!==window.top}catch(t){return!0}},getNavigatorInfo:function(){var t,e,i;if(t=navigator.appName,e=navigator.userAgent,null===new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(e)){var n=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return n&&null!=(i=e.match(/version\/([\.\d]+)/i))&&(n[2]=i[1]),n=n?[n[1],n[2]]:[t,navigator.appVersion,"-?"]}var n=["Internet Explorer"];return n&&null!=(i=e.match(/rv:([0-9]{1,}[\.0-9]{0,})/))&&(n[2]=i[1]),n=n?[n[0],n[2]]:[t,navigator.appVersion,"-?"]}}}),define("Managers/AdManager",["Solitaire/MvvmStructure/Service/ManifestService","absolute/storagemanager","absolute/musicmanager","absolute/audiomanager","absolute/gameconfig","Managers/TelemetryManager","Managers/BrowserUtils"],function(t,e,i,n,r,o,a){"use strict";var s={game:null,numCompletedLevels:0,soundMuted:r.getVal("sfxEnabled"),musicMuted:!1,sfxEnabled:!1,onMSNUnpause:function(){},onMSNPause:function(){},onMSNToggleMute:function(){var t=!!s.soundMuted;s.soundMuted=!t,i.setMuted(s.soundMuted),n.setSfxEnabled(!s.soundMuted)},onMSNAdPlaybackCompleted:function(){},mute:function(){this.game&&this.game.ui&&this.game.ui.showLoadingScreen(),this.musicMuted=i.isMuted(),this.sfxEnabled=n.sfxEnabled,i.setMuted(!0),n.setSfxEnabled(!1)},unMute:function(){i.setMuted(this.musicMuted),n.setSfxEnabled(this.sfxEnabled),this.game&&this.game.ui&&(this.game.ui.hideLoadingScreen(),this.game.ui.loadingScreen.resetLoadingProgress(),this.game.ui.gameScreen.visible=!0,this.game.solitaire&&this.game.solitaire.SupplyView&&(this.game.solitaire.SupplyView.dealSoundIsAllowed||(this.game.solitaire.SupplyView.dealSoundIsAllowed=!0,this.game.solitaire.DealNewGame(null,!1,!0))))},initialize:function(t){this.game=t,this.musicMuted=i.isMuted(),this.sfxEnabled=n.sfxEnabled,window.InitMsnAdWrapper&&window.InitMsnAdWrapper(),window.msnAdWrapper&&(window.msnAdWrapper.onAdPlaybackCompleted=function(){s.onMSNAdPlaybackCompleted(),s.unMute()},window.msnAdWrapper.onReceivingMuteGame=function(){console.info("onReceivingMuteGame"),s.onMSNToggleMute()},window.msnAdWrapper.onReceivingPauseGame=function(){console.info("onReceivingPauseGame"),s.setPaused(!s.paused),window.msnAdWrapper.gamePaused(s.paused?1:0),s.paused?s.onMSNPause():s.onMSNUnpause()},window.msnAdWrapper.onReceivingPlayAd=function(){s.setPaused(!0),s.mute(),window.msnAdWrapper.startAdPlayback()},window.msnAdWrapper.onQuitGame=function(){console.info("onQuitGame")},window.msnAdWrapper.readyForComm()),window.GD_OPTIONS&&(window.GD_OPTIONS.SDK_GAME_START=function(){s.setPaused(!1),s.unMute()},window.GD_OPTIONS.SDK_GAME_PAUSE=function(){s.setPaused(!0),s.mute()})},gameStarted:function(){window.msnAdWrapper&&(s.numCompletedLevels++,console.log("GDK: completedLevel "+s.numCompletedLevels),window.msnAdWrapper.completedLevel()),"undefined"!=typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd()},setPaused:function(t){s.paused=t},tryShowAd:function(t,e,i,n){t()}};return s}),define("Managers/ScaleManager",["lodash"],function(t){var e={elements:{WidthBase:[],HeightBase:[],Full:[]},prevWidth:0,prevHeight:0,scaleFactorX:0,scaleFactorY:0,scaleFactor:0,slideOutMenuBreakPoint:640,addElement:function(t,e){-1===this.elements[e.scaleChangeSource].indexOf(t)&&t.handleResize&&(this.elements[e.scaleChangeSource].push(t),t.handleResize())},removeElement:function(t){var e=this.elements.Full.indexOf(t);-1!==e&&this.elements.Full.splice(e,1)},handleResize:function(t,i){this.prevWidth=this.width,this.prevHeight=this.height,this.width=t,this.height=i,this.scaleFactorX=t/1920,this.scaleFactorY=i/1080;var n=[];this.width!==this.prevWidth&&(n=[].concat(this.elements.WidthBase,this.elements.Full)),this.height!==this.prevHeight&&(n=[].concat(this.elements.HeightBase,this.elements.Full)),n.forEach(function(t){e.resizeElement(t)})},resizeElement:function(t){t.handleResize()},load:function(t){this.scaleParams=JSON.parse(t)}};return e}),define("absolute/gameui",["pixi","tween","absolute/debug","absolute/screenmetrics","absolute/platform","absolute/coords","fpsmeter","lodash","Managers/AdManager","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t,e,i,n,r,o,a,s){n=n||16777215,document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?this.windowBlurred():this.windowFocused()}.bind(this)),l.onMSNPause=function(){this.paused=!0}.bind(this),l.onMSNUnpause=function(){this.paused=!1}.bind(this),this._initGameUI(t,e,i,n,r,o,a,s)};return u.prototype.windowBlurred=function(){this.paused=!0},u.prototype.windowFocused=function(){this.paused=!1,this.animate()},u.prototype._initGameUI=function(e,n,o,s,l,h,u,d){this.currentScreen=null,this.modal=null,this.lastRender=0,this.frameRequest=0,this.width=Math.round(n),this.height=Math.round(o),this.baseWidth=n,this.baseHeight=o,this.origWidth=this.width,this.origHeight=this.height,this.origBaseWidth=this.baseWidth,this.origBaseHeight=this.baseHeight,this.container=document.getElementById(e),this.stage=[],this.refreshBackground=!1,this.backgroundColor=s,this.supportsOrientationChange=!!l,this.supportsLiquidLayout=!!h,this.supportsWebGL=!!u&&r.supportsWebGL(),this.usingWebGL=!1,this.lockAspectRatio=!!d,this.DIALOG_LAYER=0,this.modalStack=[],this.modalBgStack=[],this.paused=!1,this.stage.push(new t.Stage(0,!0)),this.stage.push(new t.Stage(0,!0)),this.stage.push(new t.Stage(0,!0)),i.enabled&&(this.meter=new a),"undefined"!=typeof kik&&document.getElementsByTagName("body")[0].appendChild(document.createElement("div")),this.container.onmousedown=this.container.ontouchstart=function(t){t.preventDefault()},this.renderer=[],window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("orientationchange",function(){this.resize(),window.setTimeout(function(){this.resize()}.bind(this),250),window.setTimeout(function(){this.resize()}.bind(this),500),window.setTimeout(function(){this.resize()}.bind(this),700)}.bind(this)),this.resize()},u.prototype._createPIXIRenderer=function(e,i,n){var r,o=t.VERSION.substring(1).split(".");if(parseInt(o[0])<2)r=n?t.autoDetectRenderer(e,i,null,!0):new t.CanvasRenderer(e,i,null,!0);else{var a={view:null,transparent:!0,autoResize:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1};r=n?t.autoDetectRenderer(e,i,a):new t.CanvasRenderer(e,i,a)}return r},u.prototype.buildRenderers=function(e,i){if(r._isOldAndroid()&&!this.supportsOrientationChange&&(e=this.baseWidth,i=this.baseHeight),0===this.renderer.length)this.supportsWebGL?(this.renderer.push(this._createPIXIRenderer(e,i,!0)),this.renderer.push(this._createPIXIRenderer(e,i,!0)),this.renderer[1]instanceof t.WebGLRenderer&&(this.renderer.push(this._createPIXIRenderer(e,i,!0)),this.usingWebGL=!0,this.DIALOG_LAYER=2)):(this.renderer.push(this._createPIXIRenderer(e,i,!1)),this.renderer.push(this._createPIXIRenderer(e,i,!1))),this.offScreenRenderer=this._createPIXIRenderer(e,i,!1),this.container.appendChild(this.renderer[1].view),this.container.appendChild(this.renderer[0].view),this.usingWebGL&&(this.renderer[2].view.style.display="none",this.container.appendChild(this.renderer[2].view));else{for(var n=0;n<this.renderer.length;n+=1)this.renderer[n].resize(e,i);this.refreshBackground=!0}},u.prototype.isPortrait=function(){return this.portrait},u.prototype.isFullScreen=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},u.prototype.requestFullscreen=function(t){if(this.fullScreenElementStyles=t.cssText,this.fullScreenElementClass=t.className,t.removeAttribute("style"),t.style.position="static",t.className="",t.requestFullscreen)t.requestFullscreen();else if(t.msRequestFullscreen)t.msRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(void 0!==window.ActiveXObject){var e=new ActiveXObject("WScript.Shell");null!==e&&e.SendKeys("{F11}")}},u.prototype.exitFullScreen=function(t){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),t&&(t.className=this.fullScreenElementClass,t.removeAttribute("style"),t.cssText=this.fullScreenElementStyles),window.setTimeout(function(){this.resize()}.bind(this),1e3)},u.prototype.resize=function(){function t(){!r._isiPad||this.portrait||r.isNativeMobile()||(s-=o.y(30));var t=this.baseWidth/this.baseHeight,e=this.container.style.minWidth||0,i=this.container.style.maxWidth||0,n=this.container.style.minHeight||0;0!==e&&(e=parseInt(e.slice(0,e.indexOf("px")))),0!==i&&(i=parseInt(i.slice(0,i.indexOf("px")))),0!==n&&(n=parseInt(n.slice(0,n.indexOf("px")))),l<=e?(l=e,u=l/t):l>=i&&i>0?(l=i,u=l/t):u<n?(u=n,l=u*t):l>u?(u=l/t)>s&&(l*=s/u,u=l/t):(l=u*t)>s&&(u*=a/l,l=u*t)}h.handleResize(window.innerWidth,window.innerHeight);var e,i=this.isFullScreen();if(""===this.container.style.width||""===this.container.style.height||i){n.refresh();var a=n.clientWidth>0?n.clientWidth:n.screenWidth,s=n.clientWidth>0?n.clientHeight:n.screenHeight,l=a,u=s;this.supportsOrientationChange?this.portrait=l<u:this.portrait=this.width<this.height;var d=a/s;this.supportsLiquidLayout?this.supportsLiquidLayout&&(this.portrait?(this.width=Math.floor(1536*n.getResScale()),this.height=Math.floor(this.width*(s/a))):(r._isiPad&&!r.isNativeMobile()&&(s-=o.y(18),u-=o.y(18)),this.height=Math.floor(1536*n.getResScale()),this.width=Math.floor(Math.floor(this.height*(a/s))))):(this.portrait?this.lockAspectRatio?t.call(this):d>.85?l=.85*s:d<.56&&(u=a/.56):(r._isiPad&&!r.isNativeMobile()&&(u-=o.y(18)),this.supportsOrientationChange&&this.height>this.width&&(this.baseWidth=this.origBaseWidth,this.baseHeight=this.origBaseHeight,this.width=this.origWidth,this.height=this.origHeight),d=1/d,this.lockAspectRatio?t.call(this):d>.8?u=.8*a:d<.56&&(l=s/.56)),l=Math.floor(l),u=Math.floor(u)),this.buildRenderers(this.width,this.height);var c="static"==this.container.className;for(e=0;e<this.renderer.length;e+=1)if(this.renderer[e].view.style.width=window.innerWidth+"px",this.renderer[e].view.style.height=window.innerHeight+"px",this.renderer[e].view.style.position="absolute",c){this.renderer[e].view.style.left="0px",this.renderer[e].view.style.top="0px",this.container.style.height=this.renderer[e].view.style.height;var p=document.getElementById("menuwrapper");void 0!==p&&null!==p&&(p.style.width=this.renderer[e].view.style.width)}this.supportsOrientationChange&&this.currentScreen?this.currentScreen.handleOrientationChange(this.portrait):this.currentScreen&&"function"==typeof this.currentScreen.handleResize&&this.currentScreen.handleResize(this.portait),this.refreshModal()}else{for(this.width=this.origWidth,this.height=this.origHeight,this.buildRenderers(this.width,this.height),e=0;e<this.renderer.length;e+=1)this.renderer[e].view.style.width=this.container.style.width,this.renderer[e].view.style.height=this.container.style.height,this.renderer[e].view.style.position="absolute",this.renderer[e].view.style.left="",this.renderer[e].view.style.top="";this.supportsOrientationChange&&this.currentScreen&&(this.portait=this.height>this.width,this.currentScreen.handleOrientationChange(this.portrait))}},u.prototype.refreshModal=function(){if(this.supportsOrientationChange&&this.modalStack.length>0){var t=this.modalStack[this.modalStack.length-1];this.hideModal(),void 0!==t.handleOrientationChange&&t.handleOrientationChange(this.portrait),this.showModal(t)}},u.prototype.render=function(){this.paused||(this.renderer[1].render(this.stage[1]),this.renderer[0].render(this.stage[0]))},u.prototype.renderOffScreen=function(){this.offScreenRenderer.render(this.stage[0])},u.prototype.animate=function(){var t=function(){this.paused||(Date.now()-this.lastRender>200&&(cancelAnimationFrame(this.frameRequest),this.frameRequest=requestAnimFrame(this._animate.bind(this))),setTimeout(t,100))}.bind(this);this.frameRequest&&cancelAnimationFrame(this.frameRequest),this.frameRequest=requestAnimFrame(this._animate.bind(this)),setTimeout(t,100)},u.prototype._animate=function(){this.paused||(i.enabled&&this.meter.tick(),this.beforeRender(),e.update(),this.renderer[0].render(this.stage[0]),this.refreshBackground&&(this.refreshBackground=!1,this.renderer[1].render(this.stage[1])),this.hasModal()&&this.renderer.length>2&&this.renderer[2].render(this.stage[2]),this.afterRender(),this.lastRender=Date.now(),this.frameRequest=requestAnimFrame(this._animate.bind(this)))},u.prototype.beforeRender=function(){},u.prototype.afterRender=function(){},u.prototype.showScreen=function(t,e){this.currentScreen&&this.currentScreen.onHide(),this.currentScreen=t,this.hideCurrent(),this.showCurrent(),this.currentScreen.onShow(this.portrait,e),this.showActiveAtlases()},u.prototype.showModal=function(t,i,n){if(i=void 0===i?.5:i,n=!!n,0===this.modalStack.length)if(this.usingWebGL){if(this.modalOverlay=this.buildModalOverlay(i),n){this.modalOverlay.alpha=0;var r=this;new e.Tween({a:0}).to({a:1},1500).easing(e.Easing.Cubic.InOut).onUpdate(function(){r.modalOverlay.alpha=this.a}).start()}this.stage[0].addChildAt(this.modalOverlay,this.stage[0].children.indexOf(this.currentScreen)+1),this.renderer[2].view.style.display="block"}else if(this.modalBG=this.buildModalBackground(i),n){this.modalBG.alpha=0,this.stage[0].addChild(this.modalBG);var r=this;new e.Tween({a:0}).to({a:1},1500).easing(e.Easing.Cubic.InOut).onUpdate(function(){r.modalBG.alpha=this.a}).onComplete(function(){r.stage[0].removeChild(r.currentScreen)}).start()}else this.stage[0].removeChild(this.currentScreen),this.stage[0].addChildAt(this.modalBG,0);else this.stage[this.DIALOG_LAYER].removeChild(this.modalStack[this.modalStack.length-1]);this.modalStack.push(t),this.stage[this.DIALOG_LAYER].addChild(t),t.onShow(),this.showActiveAtlases()},u.prototype.hasModal=function(){return this.modalStack.length>0},u.prototype.hideModal=function(){if(this.modalStack.length>0){var t=this.modalStack.pop();t.onHide(),-1!=this.stage[this.DIALOG_LAYER].children.indexOf(t)&&this.stage[this.DIALOG_LAYER].removeChild(t);var e=this.modalStack.length;if(0===e)this.usingWebGL?(-1!=this.stage[0].children.indexOf(this.modalOverlay)&&this.stage[0].removeChild(this.modalOverlay),this.renderer[2].render(this.stage[2]),this.renderer[2].view.style.display="none"):(-1!=this.stage[0].children.indexOf(this.modalBG)&&this.stage[0].removeChild(this.modalBG),this.modalBG.texture.destroy(!0),this.modalBG=null,this.stage[0].addChildAt(this.currentScreen,0));else{var i=this.modalStack[e-1];this.stage[this.DIALOG_LAYER].addChild(this.modalStack[e-1]),this.supportsOrientationChange&&void 0!==i.handleOrientationChange&&i.handleOrientationChange(this.portrait)}}},u.prototype.hideCurrent=function(){if(this.stage[0].children.length>0){var t=this.stage[0].getChildAt(0);this.stage[0].removeChild(t)}if(this.stage[1].children.length>0){var e=this.stage[1].getChildAt(0);this.stage[1].removeChild(e)}},u.prototype.buildModalOverlay=function(e){var i=new t.DisplayObjectContainer,n=new t.Graphics;return n.beginFill(65793,e),n.drawRect(0,0,this.width,this.height),n.endFill(),i.addChild(n),i},u.prototype.buildModalBackground=function(e){var i,n,r,o=Math.ceil(.5*this.width),a=Math.ceil(.5*this.height),s=this._createPIXIRenderer(o,a,!1),l=new t.Graphics;for(s.clearBeforeRender=!1,s.roundPixels=!0,l.beginFill(0,e),l.drawRect(0,0,o,a),l.endFill(),r=0;r<this.stage[0].children.length;r++)n=this.stage[0].getChildAt(r),n.scale.x=n.scale.y=.5;for(this.stage[0].addChild(l),s.render(this.stage[0]),this.stage[0].removeChild(l),r=0;r<this.stage[0].children.length;r++)n=this.stage[0].getChildAt(r),n.scale.x=n.scale.y=1;return i=new t.Sprite(t.Texture.fromCanvas(s.view)),i.scale.x=i.scale.y=2,i},u.prototype.showCurrent=function(){if(this.currentScreen)try{this.stage[0].addChildAt(this.currentScreen,0),this.stage[1].addChildAt(this.currentScreen.background,0),this.renderer[1].render(this.stage[1]),this.refreshBackground=!0}catch(t){}},u.prototype.showActiveAtlases=function(e){if(e=!!e,i.enabled||e){var n={},r=e?console:i;this.walkSprites(this.stage[0],function(e){if(e instanceof t.Sprite&&e.texture&&e.texture.baseTexture){var i=e.texture.baseTexture.source.src||"/offscreen";n[i]=(n[i]||0)+1}}),r.log("\n"),r.log("Active Atlases"),r.log("--------------");for(var o in n)if(n.hasOwnProperty(o)){var a=o.substr(o.lastIndexOf("/")+1);r.log(a+" has "+n[o]+" sprites active")}r.log("--------------"),r.log("There are "+s.size(t.BaseTextureCache)+" textures in the PIXI.BaseTextureCache."),r.log("There are "+s.size(t.TextureCache)+" textures in the PIXI.TextureCache."),r.log("-------------- \n")}},u.prototype.walkSprites=function(t,e){e(t);for(var i=0;i<t.children.length;i+=1)this.walkSprites(t.children[i],e)},u.prototype.handleCommand=function(t){},u}),define("absolute/textutils",[],function(){return{_thousandsSep:",",formatInt:function(t,e){return t>999?("fr-CA"!==e&&"fr-FR"!==e||(this._thousandsSep=" "),this.formatInt(Math.floor(t/1e3))+this._thousandsSep+this.zeroPad(t%1e3)):t+""},zeroPad:function(t){var e="";return t<100&&(e+="0"),t<10&&(e+="0"),e+=t},wrapText:function(t,e){for(var i=t.text,n=0,r=[],o=0,a=0;a<t.children.length;a++)" "==i[a]&&(o=a),r.push(i[a]),t.children[a].x-n>=e&&(n=t.children[o].x,r[o]="\n");return r.join("")}}}),define("absolute/togglebutton",["pixi","absolute/button"],function(t,e){var i=function(t,e,i,n){this.initToggleButton(t,e,i,n)};return i.constructor=i,i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype.initToggleButton=function(i,n,r,o){this.enabled=!!r,this.action=n,o=void 0===o||o;var a=o?"button_overlay.png":i+"_1.png",s=o?"button_overlay.png":i+"OFF_1.png";t.DisplayObjectContainer.call(this),this.enabledButton=new e(t.Texture.fromFrame(i+"_1.png"),t.Texture.fromFrame(a),this.onAction.bind(this)),this.disabledButton=new e(t.Texture.fromFrame(i+"OFF_1.png"),t.Texture.fromFrame(s),this.onAction.bind(this)),this.enabled?this.addChild(this.enabledButton):this.addChild(this.disabledButton),this.width=t.Texture.fromFrame(i+"_1.png").width,this.height=t.Texture.fromFrame(i+"_1.png").height},i.prototype.onAction=function(){this.setEnabled(!this.enabled),this.action&&this.action()},i.prototype.setEnabled=function(t){t!==this.enabled&&(this.enabled=t,this.enabled?(this.removeChild(this.disabledButton),this.addChild(this.enabledButton)):(this.removeChild(this.enabledButton),this.addChild(this.disabledButton)))},i}),define("absolute/tweenutils",["tween"],function(t){var e={fadeIn:function(t,i,n){this._doTween(t,i,n,e._fadeIn)},_fadeIn:function(e,i,n){void 0===i.delay&&(i.delay=0);var r=new t.Tween({alpha:e.alpha}).delay(i.delay).to({alpha:1},i.duration).easing(t.Easing.Cubic.In).onUpdate(function(){e.alpha=this.alpha}).onComplete(function(){setTimeout(function(){n(),t.remove(r)}.bind(this),0)}).start()},fadeOut:function(t,i,n){this._doTween(t,i,n,e._fadeOut)},_fadeOut:function(e,i,n){void 0===i.delay&&(i.delay=0);var r=new t.Tween({alpha:e.alpha}).delay(i.delay).to({alpha:0},i.duration).easing(t.Easing.Cubic.In).onUpdate(function(){e.alpha=this.alpha}).onComplete(function(){setTimeout(function(){n(),t.remove(r)}.bind(this),0)}).start()},bounceIn:function(t,i,n){this._doTween(t,i,n,e._bounceIn)},_bounceIn:function(e,i,n){void 0===i.endScale&&(i.endScale=1);var r=new t.Tween({scale:e.scale.x}).to({scale:i.endScale},i.duration).easing(t.Easing.Elastic.Out).onUpdate(function(){e.scale.x=e.scale.y=this.scale}).onComplete(function(){setTimeout(function(){n(),t.remove(r)}.bind(this),0)}).start()},_doTween:function(t,e,i,n){var r,o,a=0,s=function(){(a+=1)===o&&i&&"function"==typeof i&&i()};if(t instanceof Array)if((o=t.length)>0)for(r=0;r<o;r+=1)n(t[r],e,s);else i();else n(t,e,function(){i&&"function"==typeof i&&i()})}};return e}),define("absolute/progressbar",["pixi","absolute/coords","absolute/tweenutils"],function(t,e,i){var n=function(t,e,i,n,r){this._initProgressBar(t,e,i,n,r)};return n.constructor=n,n.prototype=Object.create(t.Sprite.prototype),n.prototype._initProgressBar=function(e,i,n,r){t.Sprite.call(this,e),this.fillSprite=new t.Sprite(i),this.previousWidth=0,this.start=n||0,this.end=r||this.fillSprite.texture.frame.width,this.fillMask=new t.Graphics,this.fillMask.beginFill(0,0),this.fillMask.drawRect(this.start,0,0,this.height),this.fillMask.endFill(),this.addChild(this.fillMask),this.fillSprite.mask=this.fillMask,this.addChild(this.fillSprite)},n.prototype.setProgress=function(t,e,i,n){t<0?t=0:t>1&&(t=1),n=n||500;var r=(this.end-this.start)*t;if(e){var o=this;new TWEEN.Tween({width:this.previousWidth}).to({width:r},n).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){o.fillMask.clear(),o.fillMask.beginFill(0,0),o.fillMask.drawRect(o.start,0,this.width,o.height),o.fillMask.endFill(),o.previousWidth=this.width}).onComplete(function(){"function"==typeof i&&i()}).start()}else this.fillMask.clear(),this.fillMask.beginFill(0,0),this.fillMask.drawRect(this.start,0,r,this.height),this.fillMask.endFill();this.waitContainer&&(this.waitContainer.mask=null,this.removeChild(this.waitContainer),this.waitContainer=null)},n.prototype.showWaiting=function(i){if(this.waitImage=i,this.waitImage){this.setProgress(100),this.waitContainer=new t.DisplayObjectContainer,this.waitSprites=[];for(var n=0;n<11;n+=1)this.waitSprites.push(new t.Sprite(this.waitImage)),this.waitSprites[n].position.x=n*this.waitSprites[n].width,this.waitContainer.addChild(this.waitSprites[n]);this.addChild(this.waitContainer);var r=new t.Graphics;r.beginFill(),r.drawRect(e.x(50),0,this.width-e.x(100),this.height),r.endFill(),this.waitContainer.addChild(r),this.waitContainer.mask=r}},n.prototype.updateWaiting=function(){for(var t=0;t<11;t+=1)this.waitSprites[t].position.x+=e.x(4);this.waitSprites[10].position.x>this.width&&(this.waitSprites[10].position.x=this.waitSprites[0].position.x-this.waitSprites[10].width,this.waitSprites.unshift(this.waitSprites.pop()))},n}),define("absolute/progressdial",["pixi"],function(t){var e=function(t,e){this._initProgressDial(t,e)};return e.constructor=e,e.prototype=Object.create(t.Sprite.prototype),e.prototype._initProgressDial=function(e,i){t.Sprite.call(this,e),this.fillSprite=new t.Sprite(i),this.previousRotation=-180*Math.PI/180,this.fillMask=new t.Graphics,this.fillMask.beginFill(0,0),this.fillMask.drawRect(1.1*-this.fillSprite.width/2,1.1*-this.fillSprite.height,1.1*this.fillSprite.width,1.1*this.fillSprite.height),this.fillMask.position.x=this.fillSprite.width/2,this.fillMask.position.y=this.fillSprite.height,this.fillMask.endFill(),this.addChild(this.fillMask),this.fillSprite.mask=this.fillMask,this.addChild(this.fillSprite)},e.prototype.setProgress=function(t,e,i){t<0?t=0:t>1&&(t=1);var n=(180*t-180)*Math.PI/180;if(e){var r=this;new TWEEN.Tween({rotation:this.previousRotation}).to({rotation:n},500).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){r.fillMask.rotation=this.rotation,r.previousRotation=this.rotation}).onComplete(function(){"function"==typeof i&&i()}).start()}else this.fillMask.rotation=n},e}),define("absolute/screen",["pixi","absolute/button","absolute/togglebutton","absolute/debug"],function(t,e,i,n){var r=function(){this._initScreen()};return r.constructor=r,r.prototype=Object.create(t.DisplayObjectContainer.prototype),r.prototype._initScreen=function(){t.DisplayObjectContainer.call(this),this.background=new t.DisplayObjectContainer},r.prototype.addButton=function(i,r,o,a,s){var l,h=!!s,u=t.Texture.fromFrame(i+"_1.png");l=h?t.Texture.fromFrame("button_small_overlay.png"):t.Texture.fromFrame("button_overlay.png");var d=new e(u,l,function(){n.log(i+" pressed!"),a()});return d.position.x=r,d.position.y=o,this.addChild(d),d},r.prototype.addToggleButton=function(t,e,r,o,a){var s=new i(t,function(){n.log(t+" pressed!"),o()},a);return s.position.x=e,s.position.y=r,this.addChild(s),s},r.prototype.onShow=function(){},r.prototype.onHide=function(){},r.prototype.beforeRender=function(){},r.prototype.afterRender=function(){},r.prototype.handleVisibilityChange=function(){},r.prototype.handleOrientationChange=function(t){},r.prototype.handleCommand=function(t){},r.prototype.showError=function(){this.artInitialized=!1,this.ui.hideLoadingScreen(),this.showLoadError()},r}),define("absolute/simplemessagebox",["pixi","absolute/button","absolute/coords"],function(t,e,i){var n=function(t,e,i){this._initSimpleMessageBox(t,e,i)};return n.constructor=n,n.prototype=Object.create(t.DisplayObjectContainer.prototype),n.prototype._initSimpleMessageBox=function(e,i,n){t.DisplayObjectContainer.call(this),this.width=e,this.height=i,this.textStyle=n,this.textStyle.wordWrapWidth=e-60,this.textStyle.wordWrap=!0;var r=new t.Graphics;r.lineStyle(8,0,1),r.beginFill(16777215,1),r.drawRect(0,0,e,i),r.endFill(),this.addChild(r),this.text=null},n.prototype.setText=function(e){this.text&&this.removeChild(this.text),this.text=new t.Text(e,this.textStyle),this.text.position.x=(this.width-this.text.width)/2,this.text.position.y=i.y(30),
this.addChild(this.text)},n}),define("absolute/spritemessagebox",["pixi","absolute/button","absolute/coords"],function(t,e,i){var n=function(t,e,i){this._initSpriteMessageBox(t,e,i)};return n.constructor=n,n.prototype=Object.create(t.Sprite.prototype),n.prototype._initSpriteMessageBox=function(i,n,r,o){t.Sprite.call(this,t.Texture.fromFrame(i)),this.action=null,this.buttonText=null,this.button=new e(t.Texture.fromFrame(n),t.Texture.fromFrame(n),function(){this.action&&"function"==typeof this.action&&this.action()}.bind(this)),this.button.position.x=(this.width-this.button.width)/2,this.button.position.y=this.height-this.button.height/2,this.addChild(this.button),this.textStyle=r,this.textStyle.wordWrapWidth=this.width-40,this.text=null},n.prototype.setText=function(e){this.text&&this.removeChild(this.text),this.text=new t.Text(e,this.textStyle),this.text.position.x=(this.width-this.text.width)/2,this.text.position.y=i.y(30),this.addChild(this.text)},n.prototype.setButtonTextAndAction=function(e,i){this.button&&(this.buttonText&&this.button.removeChild(this.buttonText),this.buttonText=new t.Text(e,this.textStyle),this.buttonText.position.x=(this.button.width-this.buttonText.width)/2,this.buttonText.position.y=this.button.height/4,this.button.addChild(this.buttonText),this.action=i)},n}),define("absolute/loader",["pixi","absolute/platform","absolute/audiomanager","absolute/asyncqueue","absolute/screenmetrics"],function(t,e,i,n,r){"use strict";var o=function(){this._initLoader()};return o.prototype._initLoader=function(){},o.prototype.loadSound=function(t,e,n,r){try{i.init(function(){i.loadSounds(t,e,n)})}catch(t){"function"==typeof r&&r()}},o.prototype.loadAtlases=function(i,n,o,a){var s=i.length,l=0;this.error=!1;for(var h=0;h<s;++h)if(!this.error){var u=i[h].name;-1===u.indexOf(".json")&&(u+=".json");var d=new t.JsonLoader(e.artPathPrefix+"/"+r.getResClass()+"/"+u,!1);d.addEventListener("error",function(){this.error||(this.error=!0,a())}.bind(this)),d.addEventListener("loaded",function(){++l==s?o():n(l/s)}.bind(this)),d.load()}},o.prototype.loadArt=function(i,n,o,a){for(var s=i.length,l=[],h=0;h<s;++h){var u=i[h],d="image";void 0!==u.lazyload&&u.lazyload||("string"!=typeof u&&(u.type&&(d=u.type),u=u.name),"image"===d?-1===u.indexOf(".json")&&(u+=".json"):"font"===d&&-1===u.indexOf(".fnt")&&(u+=".fnt"),l.push(e.artPathPrefix+"/"+r.getResClass()+"/"+u))}this.assetLoader=new t.AssetLoader(l,!1),this.assetLoader.addEventListener("onComplete",function(){o()}),this.assetLoader.addEventListener("onProgress",function(t){var e=t.content.loadCount;void 0===e&&t.content.content&&(e=t.content.content.loadCount),n(1-e/s)}),this.assetLoader.load()},o.prototype.loadAssets=function(t,e,i){var r=new n;r.pushTasks([function(e,i){this.loadArt(t.artAssets,e,i)}.bind(this),function(e,i){this.loadSound(t.audioAssets,e,i)}.bind(this)]),r.run(e,i)},o}),define("absolute/layouthelper",["absolute/coords"],function(t){var e=null;return{setLayoutMap:function(t){e=t},layout:function(i,n,r){if(void 0!==e[n]&&void 0!==e[n][r]){var o=e[n][r].x||0,a=e[n][r].y||0;i.position.x=t.x(o),i.position.y=t.y(a)}}}}),define("absolute/draggable",["pixi","absolute/platform"],function(t,e){var i=function(t,e,i,n,r,o){this._initDraggable(t,e,i,n,r,o)};return i.constructor=i,i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype._initDraggable=function(i,n,r,o,a,s){t.DisplayObjectContainer.call(this),this.addChild(i),this.child=i,this.positionChild=void 0!==s&&s,this.limit=n||new t.Rectangle(0,0,0,0),this.onGrab=r,this.onMove=o,this.onDrop=a,this.interactive=!0,this.data=null,this.dragging=!1,e.supportsTouch()?(this.touchstart=this._onGrab,this.touchend=this.touchendoutside=this._onDrop,this.touchmove=this._onMove):(this.mousedown=this._onGrab,this.mouseup=this.mouseupoutside=this._onDrop,this.mousemove=this._onMove)},i.prototype._onGrab=function(t,e){t.originalEvent.preventDefault(),e=void 0!==e?e:.8,this.data=t,this.alpha=e,this.dragging=!0,"function"==typeof this.onGrab&&this.onGrab(this)},i.prototype._onDrop=function(t){t.originalEvent.preventDefault(),this.alpha=1,this.dragging=!1,this.data=null,"function"==typeof this.onDrop&&this.onDrop(this)},i.prototype._onMove=function(t){if(t.originalEvent.preventDefault(),this.dragging){var e=this.data.getLocalPosition(this.parent);if(this.limit&&e.x>this.limit.x&&e.x<this.limit.x+this.limit.width&&e.y>this.limit.y&&e.y<this.limit.y+this.limit.height){var i=this.positionChild?this.child:this;i.position.x=Math.round(e.x),i.position.y=Math.round(e.y)}"function"==typeof this.onMove&&this.onMove(this)}},i}),define("text!absolute/ui/assetmap.json",[],function(){return'{\r\n    "loading_bar_frame": "loading_bar_frame.png",\r\n    "loading_bar_marker": "loading_bar_marker.png",\r\n    \r\n    "dialogNineSlice": {\r\n        "topLeft":"MDS_9slice_modal_01.png",\r\n        "topCenter":"MDS_9slice_modal_02.png",\r\n        "topRight":"MDS_9slice_modal_03.png",\r\n        "middleLeft":"MDS_9slice_modal_04.png",\r\n        "middleCenter":"MDS_9slice_modal_05.png",\r\n        "middleRight":"MDS_9slice_modal_06.png",\r\n        "bottomLeft":"MDS_9slice_modal_07.png",\r\n        "bottomCenter":"MDS_9slice_modal_08.png",\r\n        "bottomRight":"MDS_9slice_modal_09.png",\r\n        "close": "btn_level_exit.png"\r\n    }\r\n}'}),define("absolute/assetmap",["lodash","text!absolute/ui/assetmap.json"],function(t,e){function i(t){for(var e=0,i=t.split("."),r=n;r&&"object"==typeof r;)r=r[i[e++]];return r}var n=JSON.parse(e),r=function(t){return i(t)||t};return r.load=function(e){var i=JSON.parse(e);t.merge(n,i)},r}),define("absolute/stringmanager",["lodash"],function(t){function e(t,e,i){for(var n=0,o=t.split("."),a=r[e];a&&"object"==typeof a;){if(i&&"[object Array]"===Object.prototype.toString.call(a[o[n]]))return a[o[n]];a=a[o[n++]]}return a}function i(){var t,e=n("locale");if(e&&(e=e.toLowerCase(),t=o.filter(function(t){return t.toLowerCase()===e||-1!==t.toLowerCase().indexOf(e)})[0]),!t){var i=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;t=o.filter(function(t){return t===i||-1!==t.indexOf(i)})[0],t=t||o[0]}return t}function n(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=i.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var r={},o=["en-US","es-ES","fr-FR","fr-CA","de-DE","it-IT","ja-JP","nb-NO","pt-BR","pt-PT","ru-RU","sv-SE","zh-CN","zh-HK","zh-TW"],a=i(),s=function(t,i,n){n=!!n;var r=e(t,a,n)||e(t,"en-US",n);if(r&&"string"==typeof r&&""!==r&&i&&i.length>0)for(var o=0;o<i.length;o+=1)r=r.replace("%"+o,String(i[o]));return r||t};return s.setLocale=function(t){a=t},s.load=function(e){t.merge(r,e)},s.getUserLanguage=function(){return i()},s.shrinkToFit=function(t,e,i,n,r){for(;(n&&t.width>n||r&&t.height>r)&&e>1;)e-=1,t.style.font=[i," ",e,"px Segoe UI"].join(""),t.updateText()},s.enlargeText=function(t,e,i,n,r){if(n&&r)for(;t.width<n&&t.height<r;)if(e++,t.style.font=[i," ",e,"px Segoe UI"].join(""),t.updateText(),t.width>n){t.style.font=[i," ",e--,"px Segoe UI"].join("");break}},s.extractNumbersFromString=function(t){return t.replace(/[^0-9^.]/g,"")},s.doesUserLanguageSupportWordWrap=function(){var t=i();return"zh-CN"!==t&&"ja-JP"!==t&&"zh-TW"!==t&&"zh-HK"!==t},s.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s}),define("absolute/nineslice",["pixi","absolute/screen","absolute/debug","lodash"],function(t,e,i,n){var r=function(t){var e={width:"100",height:"100",images:{topLeft:"MDS_9slice_modal_01.png",topCenter:"MDS_9slice_modal_02.png",topRight:"MDS_9slice_modal_03.png",middleLeft:"MDS_9slice_modal_04.png",middleCenter:"MDS_9slice_modal_05.png",middleRight:"MDS_9slice_modal_06.png",bottomLeft:"MDS_9slice_modal_07.png",bottomCenter:"MDS_9slice_modal_08.png",bottomRight:"MDS_9slice_modal_09.png"}};this._initNineSlice(n.extend(e,t))};return r.prototype=Object.create(t.DisplayObjectContainer.prototype),r.prototype._initNineSlice=function(e){t.DisplayObjectContainer.call(this),this.options=e,this.cachedContent=this.options.content,this._setSize(),this._createBackground()},r.prototype._setSize=function(){this.width=this.options.width,this.height=this.options.height},r.prototype._createBackground=function(){this.container=new t.DisplayObjectContainer;var e=t.Sprite.fromFrame(this.options.images.topLeft);e.position.x=0,e.position.y=0;var i=t.Sprite.fromFrame(this.options.images.topRight);i.position.x=this.options.width-i.width,i.position.y=0;var n=t.Sprite.fromFrame(this.options.images.bottomLeft);n.position.x=0,n.position.y=this.options.height-n.height;var r=t.Sprite.fromFrame(this.options.images.bottomRight);r.position.x=this.options.width-r.width,r.position.y=this.options.height-r.height;var o=t.Texture.fromFrame(this.options.images.middleLeft);this.middleLeftTile=new t.TilingSprite(o,o.width,this.options.height-e.height-n.height),this.middleLeftTile.position.x=0,this.middleLeftTile.position.y=e.height;var a=t.Texture.fromFrame(this.options.images.middleRight);this.middleRightTile=new t.TilingSprite(a,a.width,this.options.height-e.height-n.height),this.middleRightTile.position.x=this.options.width-i.width,this.middleRightTile.position.y=i.height;var s=t.Texture.fromFrame(this.options.images.topCenter);this.topCenterTile=new t.TilingSprite(s,this.options.width-e.width-i.width,s.height),this.topCenterTile.position.x=e.width,this.topCenterTile.position.y=0;var l=t.Texture.fromFrame(this.options.images.bottomCenter);this.bottomCenterTile=new t.TilingSprite(l,this.options.width-n.width-r.width,l.height),this.bottomCenterTile.position.x=n.width,this.bottomCenterTile.position.y=this.options.height-n.height;var h=t.Texture.fromFrame(this.options.images.middleCenter);this.middleCenterTile=new t.TilingSprite(h,this.options.width-e.width-i.width,Math.ceil(this.options.height-r.height-i.height)),this.middleCenterTile.position.x=e.width,this.middleCenterTile.position.y=e.height,this.container.addChild(e),this.container.addChild(this.topCenterTile),this.container.addChild(i),this.container.addChild(this.middleLeftTile),this.container.addChild(this.middleCenterTile),this.container.addChild(this.middleRightTile),this.container.addChild(n),this.container.addChild(this.bottomCenterTile),this.container.addChild(r),this.addChild(this.container),this.container.cacheAsBitmap=!0},r.prototype.destroy=function(){this.topCenterTile.tilingTexture.destroy(!0),this.middleLeftTile.tilingTexture.destroy(!0),this.middleCenterTile.tilingTexture.destroy(!0),this.middleRightTile.tilingTexture.destroy(!0),this.bottomCenterTile.tilingTexture.destroy(!0)},r}),define("absolute/animatedbutton",["pixi","absolute/button","lodash","absolute/screenmetrics","absolute/platform"],function(t,e,i,n,r){var o=function(t,e,i,n,r,o,a){this._initAnimatedButton(t,e,i,n,r,o,a)};return o.constructor=o,o.prototype=Object.create(e.prototype),o.prototype._initAnimatedButton=function(t,i,n,o,a,s,l){e.call(this,t,i,n,o,a,s,l),r.supportsTouch()||(this.mouseover=function(t){this.setTexture(this.hoverImage),this.defaultY=this.position.y,this.position.y=this.defaultY+2},this.mouseout=function(t){this.setTexture(this.defaultImage),this.position.y=this.defaultY})},o}),define("absolute/textbutton",["pixi","absolute/button","absolute/threeslice","lodash","absolute/screenmetrics","absolute/coords"],function(t,e,i,n,r,o){var a=function(t,e,i,a,s,l,h){var u={text:"",textStyle:{font:Math.floor(90*r.getResScale())+"px Segoe UI",fontFamily:"segoe",align:"center"},useBitmapFont:!0,buttonPadding:o.x(80)},d=l||u;this._initTextButton(t,e,i,a,s,n.extend(u,d),h)};return a.constructor=a,a.prototype=Object.create(e.prototype),a.prototype._initTextButton=function(t,i,n,r,o,a,s){this.textStyleOptions=a,e.call(this,t,i,n,r,o,s),this.setText(this.textStyleOptions.text)},a.prototype.setText=function(e){var i;if(this.label&&(this.removeChild(this.label),"function"==typeof this.label.destroy&&this.label.destroy(!0)),this.textStyleOptions.useBitmapFont){i=new t.Text(e,this.textStyleOptions).generateTexture()}else{var n=new t.Text(e,this.textStyleOptions),r=new t.DisplayObjectContainer;r.addChild(n),i=r.generateTexture(),n.destroy(!0)}this.label=new t.Sprite(i),this.label.anchor.x=this.label.anchor.y=.5,this.textStyleOptions.scaleToFit&&this.label.width>this.width-this.textStyleOptions.buttonPadding&&(this.label.scale.x=this.label.scale.y=(this.width-this.textStyleOptions.buttonPadding)/this.label.width),void 0!==this.textStyleOptions.position?("number"==typeof this.textStyleOptions.position.x?this.label.x=this.textStyleOptions.position.x:this.label.x=this.width/2,"number"==typeof this.textStyleOptions.position.y?this.label.y=this.textStyleOptions.position.y:this.label.y=this.height/2):(this.label.x=this.width/2,this.label.y=this.height/2),this.addChild(this.label)},a.prototype.destroy=function(){"function"==typeof this.label.destroy&&this.label.destroy(!0),e.prototype.destroy.call(this)},a}),define("absolute/animatedtextbutton",["pixi","absolute/textbutton","lodash","absolute/platform"],function(t,e,i,n){var r=function(t,e,i,n,r,o,a){this._initAnimatedTextButton(t,e,i,n,r,o,a)};return r.constructor=r,r.prototype=Object.create(e.prototype),r.prototype._initAnimatedTextButton=function(t,i,r,o,a,s,l){e.call(this,t,i,r,o,a,s,l),n.supportsTouch()||(this.mouseover=function(t){this.setTexture(this.hoverImage),this.defaultY=this.position.y,this.position.y=this.defaultY+2},this.mouseout=function(t){this.setTexture(this.defaultImage),this.position.y=this.defaultY})},r}),define("text!absolute/ui/layout.json",[],function(){return"{\r\n\r\n}"}),define("util/CustomWordWrapper",["lodash","absolute/stringmanager"],function(t,e){var i=function(t,e,i){return{Character:t,IsNonBeginningCharacter:e,IsNonEndingCharacter:i}},n=[i(33,!0,!1),i(36,!1,!0),i(37,!0,!1),i(39,!0,!0),i(40,!1,!0),i(41,!0,!1),i(44,!0,!1),i(46,!0,!1),i(47,!0,!0),i(58,!0,!1),i(59,!0,!1),i(63,!0,!1),i(91,!1,!0),i(92,!1,!0),i(93,!0,!1),i(123,!1,!0),i(125,!0,!1),i(162,!0,!1),i(163,!1,!0),i(165,!1,!0),i(167,!1,!0),i(168,!0,!1),i(169,!0,!1),i(174,!0,!1),i(176,!0,!1),i(183,!0,!0),i(711,!0,!1),i(713,!0,!1),i(8211,!0,!1),i(8212,!0,!1),i(8213,!0,!1),i(8214,!0,!1),i(8216,!1,!0),i(8217,!0,!1),i(8220,!1,!0),i(8221,!0,!1),i(8226,!0,!1),i(8229,!0,!1),i(8230,!0,!1),i(8231,!0,!1),i(8242,!0,!1),i(8243,!0,!1),i(8245,!1,!0),i(8451,!0,!1),i(8482,!0,!1),i(8758,!0,!1),i(9588,!0,!1),i(9839,!1,!0),i(12289,!0,!1),i(12290,!0,!1),i(12291,!0,!1),i(12293,!0,!1),i(12296,!1,!0),i(12297,!0,!1),i(12298,!1,!0),i(12299,!0,!1),i(12300,!1,!0),i(12301,!0,!1),i(12302,!1,!0),i(12303,!0,!1),i(12304,!1,!0),i(12305,!0,!1),i(12306,!1,!0),i(12308,!1,!0),i(12309,!0,!1),i(12310,!1,!0),i(12311,!0,!1),i(12317,!1,!0),i(12318,!0,!1),i(12319,!0,!1),i(12353,!0,!1),i(12355,!0,!1),i(12357,!0,!1),i(12359,!0,!1),i(12361,!0,!1),i(12387,!0,!1),i(12419,!0,!1),i(12421,!0,!1),i(12423,!0,!1),i(12430,!0,!1),i(12441,!0,!1),i(12442,!0,!1),i(12443,!0,!1),i(12444,!0,!1),i(12445,!0,!1),i(12446,!0,!1),i(12449,!0,!1),i(12451,!0,!1),i(12453,!0,!1),i(12455,!0,!1),i(12457,!0,!1),i(12483,!0,!1),i(12515,!0,!1),i(12517,!0,!1),i(12519,!0,!1),i(12526,!0,!1),i(12533,!0,!1),i(12534,!0,!1),i(12539,!0,!1),i(12540,!0,!1),i(12541,!0,!1),i(12542,!0,!1),i(65072,!0,!1),i(65104,!0,!1),i(65105,!0,!1),i(65106,!0,!1),i(65108,!0,!1),i(65109,!0,!1),i(65110,!0,!1),i(65111,!0,!1),i(65113,!1,!0),i(65114,!0,!1),i(65115,!1,!0),i(65116,!0,!1),i(65117,!1,!0),i(65118,!0,!1),i(65281,!0,!1),i(65282,!0,!1),i(65284,!1,!0),i(65285,!0,!1),i(65287,!0,!1),i(65288,!1,!0),i(65289,!0,!1),i(65292,!0,!1),i(65294,!0,!1),i(65306,!0,!1),i(65307,!0,!1),i(65311,!0,!1),i(65312,!1,!0),i(65339,!1,!0),i(65341,!0,!1),i(65344,!0,!1),i(65371,!1,!0),i(65372,!0,!1),i(65373,!0,!1),i(65374,!0,!1),i(65377,!0,!1),i(65380,!0,!1),i(65392,!0,!1),i(65438,!0,!1),i(65439,!0,!1),i(65504,!0,!0),i(65505,!1,!0),i(65509,!1,!0),i(65510,!1,!0)],r=function(t){for(var e=0,i=n.length,r=0;e<=i;){if(r=(i-e)/2+e,r=Math.round(r),n[r].Character===t.charCodeAt(0))return n[r].IsNonBeginningCharacter;t.charCodeAt(0)<n[r].Character?i=r-1:e=r+1}return!1},o=function(t){for(var e=0,i=n.Length,r=0;e<=i;){if(r=(i-e)/2+e,r=Math.round(r),n[r].Character===t.charCodeAt(0))return n[r].IsNonEndingCharacter;t<n[r].Character?i=r-1:e=r+1}return!1},a=function(t){var e=t.charCodeAt(0);return!(4352<=e&&e<=4607||12592<=e&&e<=12687||44032<=e&&e<=55203)&&(4352<=e&&e<=4607||12288<=e&&e<=55215||63744<=e&&e<=64255||65280<=e&&e<=65500)},s=function(t){var e=t.charCodeAt(0);return"\t"===t||"\r"===t||" "===t||12288===e},l=function(t,e){if(t[e]&&t[e-2]&&t[e-1]&&t[e+1])return 0!==e&&((!s(t[e])||!r(t[e+1]))&&(!(e>1&&s(t[e-2])&&'"'===t[e-1]&&!s(t[e]))&&(!(!s(t[e-1])&&'"'===t[e]&&s(t[e+1]))&&((s(t[e])||a(t[e])||a(t[e-1])||"-"===t[e-1])&&!r(t[e])&&!o(t[e-1])))))};return{doTextCustomWrap:function(t,i,n,r,o){if(!e.doesUserLanguageSupportWordWrap()&&t&&t.style&&t.text&&!(i<=1||t.width<=r&&t.height<=o)){var a,s=t.text,h=t.text;if(t.parent){if(t.style.wordWrap&&(t.style.wordWrap=!1,t.updateText()),t.updateTransform(),t.width>r||t.height>o){for(var u=[];s;){if(a=!1,t.setText(s),t.updateTransform(),t.width<=r){u.push(s);break}for(var d=s.length-1;d>=0;d--){var c=s.substring(0,d+1);if(t.setText(c),t.updateTransform(),t.width<=r&&l(s,d)){u.push(c),a=!0,s=s.slice(d+1);break}}if(!a){u.push(s);break}}u.length&&(t.setText(u.join("\n")),t.updateTransform()),(t.width>r||t.height>o)&&(t.setText(h),i-=1,t.style.font=[n," ",i,"px Segoe UI"].join(""),t.updateText(),this.doTextCustomWrap(t,i,n,r,o))}}else e.shrinkToFit(t,i,n,r,o)}}}}),define("absolute/uibuilder",["pixi","lodash","absolute/assetmap","absolute/stringmanager","absolute/coords","absolute/screenmetrics","absolute/progressbar","absolute/nineslice","absolute/animatedbutton","absolute/animatedtextbutton","absolute/togglebutton","text!absolute/ui/layout.json","absolute/textutils","util/CustomWordWrapper"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){var g=JSON.parse(d);return{load:function(t){try{var i=JSON.parse(t);e.extend(g,i)}catch(t){throw alert("UIBuilder: error in layout.json"),t}},findWidget:function(t,e){var i=null;for(var n in e.widgets)if(e.widgets.hasOwnProperty(n)&&(i=n==t?e.widgets[n]:this.findWidget(t,e.widgets[n])),i)return i;return null},findAllWidgetsOfType:function(t,e,i){var n=i||[];for(var r in e.widgets)e.widgets.hasOwnProperty(r)&&(e.widgets[r].widgetType.indexOf(t)>-1?n.push(e.widgets[r]):n=this.findWidget(key,e.widgets[r],n));return n},getConfigData:function(t){return g[t]},buildLayout:function(e,d,f,y,m,C){var S=null,b=this;switch(y&&m&&(d.optionalWidth=y,d.optionalHeight=m),"string"==typeof e&&(e=g[e]),e.type){case"ProgressBar":this.checkParams({frame:"string",fill:"string"},e.params),S=new a(t.Texture.fromFrame(i(e.params.frame)),t.Texture.fromFrame(i(e.params.fill)));break;case"Text":this.checkParams({text:"string",font:"string",fontFamily:"string",fill:"string",align:"string"},e.params);var v=e.params.fontWeight||"normal",w=e.params.wordWrap||!1,x=r.x(e.params.wordWrapWidth)||0;if(C){var T={font:v+" "+Math.floor(e.params.fontSize*o.getResScale())+"px "+e.params.font,fontFamily:e.params.fontFamily,fill:e.params.fill,align:e.params.align,wordWrap:w,wordWrapWidth:x},M=n(e.params.text).split(":"),_=M[0]+": ",P=M[1].substring(1),A=t.Sprite.fromFrame(C),k=new t.Text(_,T),D=new t.Text(P,T),F=new t.DisplayObjectContainer;A.x=k.x+k.width+r.x(5),D.x=A.x+A.width,A.scale.set(.7,.7),F.addChild(k),F.addChild(A),F.addChild(D),S=F}else S=new t.Text(n(e.params.text),{font:v+" "+Math.floor(e.params.fontSize*o.getResScale())+"px "+e.params.font,fontFamily:e.params.fontFamily,fill:e.params.fill,align:e.params.align,wordWrap:w,wordWrapWidth:x});S._setText=S.setText,S.setText=function(t){this._setText(t),this.updateText(),b.positionWidget(this,e,this.parent)};break;case"BitmapText":var E="0xFFFFFF",I="left";this.checkParams({text:"string",fontSize:"number",fontFamily:"string"},e.params),e.params.tint&&(E=e.params.tint),e.params.align&&(I=e.params.align);var G={font:Math.floor(e.params.fontSize*o.getResScale())+"px "+e.params.fontFamily,tint:E,align:I};S=new t.BitmapText(n(e.params.text),G),e.params.wordWrap&&(S=new t.BitmapText(c.wrapText(S,r.x(e.params.wordWrapWidth)||r.x(400)),G)),S.tint=parseInt(E,16),S._setText=S.setText,S.setText=function(t,i){i=void 0===i||i,this._setText(t),i&&(this.updateText(),b.positionWidget(this,e,this.parent))};break;case"Sprite":this.checkParams({texture:"string"},e.params);var O=1,B=1;e.params.scale&&(O=e.params.scale.x,B=e.params.scale.y);try{S=t.Sprite.fromFrame(i(e.params.texture)),S.scale.x=O,S.scale.y=B}catch(t){alert(t)}S.configWidth=S.width,S.configHeight=S.height;break;case"Container":S=new t.DisplayObjectContainer,e.params&&e.params.padding&&(S.padding={x:r.x(e.params.padding.x),y:r.y(e.params.padding.y)}),e.params?(S.width=S.width_=r.x(e.params.width)||d.width||d.width_,S.height=S.height_=r.y(e.params.height)||d.height||d.height_):(S.width=S.width_=d.width||d.width_,S.height=S.height_=d.height||d.height_);break;case"NineSlice":this.checkParams({width:"number",height:"number",imageBase:"string"},e.params);var L={width:r.x(e.params.width),height:r.y(e.params.height),images:{topLeft:i(e.params.imageBase+".topLeft"),topCenter:i(e.params.imageBase+".topCenter"),topRight:i(e.params.imageBase+".topRight"),middleLeft:i(e.params.imageBase+".middleLeft"),middleCenter:i(e.params.imageBase+".middleCenter"),middleRight:i(e.params.imageBase+".middleRight"),bottomLeft:i(e.params.imageBase+".bottomLeft"),bottomCenter:i(e.params.imageBase+".bottomCenter"),bottomRight:i(e.params.imageBase+".bottomRight")}};S=new s(L);break;case"AnimatedButton":this.checkParams({action:"string"},e.params);var R=e.params.threeSlice||null;R&&this.checkParams({width:"number",height:"number",imageBase:"string"},e.params.threeSlice);var N=e.params.defaultTexture&&"string"==typeof e.params.defaultTexture?e.params.defaultTexture:null,U=e.params.hoverTexture&&"string"==typeof e.params.hoverTexture?e.params.hoverTexture:null,V=null!==N?t.Texture.fromFrame(i(N)):null,H=null!==U?t.Texture.fromFrame(i(U)):null,W=f&&f[e.params.action]&&f[e.params.action].bind(f)||null,K=e.params.replaceOnHover||!1,z=e.params.replaceOnHover||null,j=e.params.muteSound||!1,Y=null;R&&(Y={width:r.x(e.params.threeSlice.width),height:r.y(e.params.threeSlice.height),images:{left:i(e.params.threeSlice.imageBase+".left"),center:i(e.params.threeSlice.imageBase+".center"),right:i(e.params.threeSlice.imageBase+".right")}}),S=new l(V,H,W,K,z,Y,j);break;case"AnimatedTextButton":this.checkParams({action:"string"},e.params),this.checkParams({text:"string",fontSize:"number",fontFamily:"string"},e.params.textStyle);var R=e.params.threeSlice||null;R&&this.checkParams({width:"number",height:"number",imageBase:"string"},e.params.threeSlice);var N=e.params.defaultTexture&&"string"==typeof e.params.defaultTexture?e.params.defaultTexture:null,U=e.params.hoverTexture&&"string"==typeof e.params.hoverTexture?e.params.hoverTexture:null,V=null!==N?t.Texture.fromFrame(i(N)):null,H=null!==U?t.Texture.fromFrame(i(U)):null,K=e.params.replaceOnHover||null,z=e.params.replaceOnHover||null,W=f&&f[e.params.action]&&f[e.params.action].bind(f)||null,X={text:n(e.params.textStyle.text),font:Math.floor(e.params.textStyle.fontSize*o.getResScale())+"px "+e.params.textStyle.fontFamily,align:e.params.textStyle.align,fontSize:e.params.textStyle.fontSize,useBitmapFont:void 0===e.params.textStyle.useBitmapFont||e.params.textStyle.useBitmapFont};e.params.textStyle.fill&&(X.fill=e.params.textStyle.fill),e.params.textStyle.stroke&&(X.stroke=e.params.textStyle.stroke),e.params.textStyle.strokeThickness&&(X.strokeThickness=r.x(e.params.textStyle.strokeThickness)),e.params.textStyle.tint&&(X.tint=parseInt(e.params.textStyle.tint,16)),e.params.textStyle.position&&(X.position={},e.params.textStyle.position.x&&(X.position.x=r.x(e.params.textStyle.position.x)),e.params.textStyle.position.y&&(X.position.y=r.x(e.params.textStyle.position.y))),void 0!==e.params.textStyle.scaleToFit&&(X.scaleToFit=e.params.textStyle.scaleToFit);var Y=null;R&&(Y={width:r.x(e.params.threeSlice.width),height:r.y(e.params.threeSlice.height),images:{left:i(e.params.threeSlice.imageBase+".left"),center:i(e.params.threeSlice.imageBase+".center"),right:i(e.params.threeSlice.imageBase+".right")}}),S=new h(V,H,W,K,z,X,Y);break;case"ToggleButton":this.checkParams({baseName:"string",action:"string",enabled:"boolean"},e.params);var W=f&&f[e.params.action]&&f[e.params.action].bind(f)||null,q=e.params.useOverlay||!1;S=new u(e.params.baseName,W,e.params.enabled,q)}if(e.params&&e.params.width&&(S.configWidth=r.x(e.params.width)),e.params&&e.params.height&&(S.configHeight=r.x(e.params.height)),S){if(S.widgetType=e.type,S instanceof t.DisplayObjectContainer&&e.children){S.widgets={};for(var Z in e.children)e.children.hasOwnProperty(Z)&&(S.widgets[Z]=this.buildLayout(e.children[Z],S,f,S.configWidth||y,S.configHeight||m,e.children[Z].params.header?C:null),S.addChild(S.widgets[Z]),"Text"===e.children[Z].type&&S.widgets[Z].style&&S.widgets[Z].style.wordWrap&&p.doTextCustomWrap(S.widgets[Z],n.extractNumbersFromString(S.widgets[Z].style.font),"",S.widgets[Z].style.wordWrapWidth,r.y(250)))}this.anchorWidget(S,e),this.scaleWidget(S,e,d),this.rotateWidget(S,e,d),this.positionWidget(S,e,d)}return S},rebuildLayout:function(t,i,n,r){var o;n&&r&&(i.optionalWidth=n,i.optionalHeight=r),"string"==typeof t&&(t=g[t],o=i.getChildAt(0)),t.key?o=this.findWidget(t.key,i):o||(o=i),"Container"==t.type&&e.each(t.children,function(t,e){t.key=e,this.rebuildLayout(t,o,o.configWidth||n,o.configHeight||r)},this),o&&(this.anchorWidget(o,t),this.scaleWidget(o,t,i),this.rotateWidget(o,t,i),this.positionWidget(o,t,i))},checkParams:function(t,e){for(var i in t)if(t.hasOwnProperty(i)){if(!e||!e[i]&&""!==e[i])throw"Error: missing required parameter: "+i;if(typeof e[i]!==t[i])throw"Error: parameter '"+i+"' must be of type "+t[i]}},anchorWidget:function(t,e){e.anchor&&(e.anchor.x&&(t.anchor.x=e.anchor.x),e.anchor.y&&(t.anchor.y=e.anchor.y))},scaleWidget:function(t,e,i){if(e.scale){if(e.scale.x)if("string"==typeof e.scale.x){if("height"===e.scale.x){if(!i||!i.height&&!i.height_)throw"Error: relative scale used but parent height not set!";t.scale.x=(i.height||i.height_)/t.height}if("width"===e.scale.x){if(!i||!i.width&&!i.width_)throw"Error: relative scale used but parent width not set!";t.scale.x=(i.width||i.width_)/t.width}}else t.scale.x=e.scale.x;if(e.scale.y)if("string"==typeof e.scale.y){if("height"===e.scale.y){if(!i||!i.height&&!i.height_)throw"Error: relative scale used but parent height not set!";t.scale.y=(i.height||i.height_)/t.height}if("width"===e.scale.y){if(!i||!i.width&&!i.width_)throw"Error: relative scale used but parent width not set!";t.scale.y=(i.width||i.width_)/t.width}}else t.scale.y=e.scale.y}},rotateWidget:function(t,e,i){e.rotation&&(t.rotation=e.rotation)},getParentHeight:function(t){var e=0;if(t&&t.optionalHeight)e=t.optionalHeight;else if(t&&t.height_)e=t.height_;else if(t&&0==t.height){var i=t.getLocalBounds();e=i.height}else{if(!t||!t.height&&!t.height_)throw"Error: relative position used but parent height not set!";e=t.height||t.height_}return e},getParentwidth:function(t){var e=0;if(t&&t.optionalWidth)e=t.optionalWidth;else if(t&&t.width_)e=t.width_;else if(t&&0==t.width){var i=t.getLocalBounds();e=i.width}else{if(!t||!t.width&&!t.width_)throw"Error: relative position used but parent width not set!";e=t.width||t.width_}return e},positionWidget:function(t,e,i){var n,o,a,s,l=t.width||t.configWidth,h=t.height||t.configHeight;if(e.position){if("string"==typeof e.position.x)if(a=this.getParentwidth(i),-1!==e.position.x.indexOf("%"))n=e.position.x.split("%"),o=parseInt(n[0])/100,t.position.x=a*o;else switch(e.position.x){case"left":t.x=0,i.padding&&i.padding.x&&(t.x=i.padding.x);break;case"right":t.x=a-l,i.padding&&i.padding.x&&(t.x-=i.padding.x);break;case"center":t.position.x=(a-l)/2}else"number"==typeof e.position.x&&(t.position.x=r.x(e.position.x));if("string"==typeof e.position.y)if(s=this.getParentHeight(i),-1!==e.position.y.indexOf("%"))n=e.position.y.split("%"),o=parseInt(n[0])/100,t.position.y=s*o;else switch(e.position.y){case"top":t.position.y=0,i.padding&&i.padding.y&&(t.y=i.padding.y);break;case"bottom":t.position.y=s-h,i.padding&&i.padding.y&&(t.y-=i.padding.y);break;case"middle":t.position.y=(s-h)/2}else"number"==typeof e.position.y&&(t.position.y=r.y(e.position.y))}}}}),define("absolute/dialog",["pixi","absolute/uibuilder","absolute/assetmap","absolute/coords","absolute/screen","absolute/debug","lodash","absolute/button","absolute/audiomanager","absolute/nineslice"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t,e){var r={width:"80%",height:"70%",x:null,y:null,landscapeX:null,landscapeY:null,portraitX:null,portraitY:null,name:"default",images:{topLeft:i("dialogNineSlice.topLeft"),topCenter:i("dialogNineSlice.topCenter"),topRight:i("dialogNineSlice.topRight"),middleLeft:i("dialogNineSlice.middleLeft"),middleCenter:i("dialogNineSlice.middleCenter"),middleRight:i("dialogNineSlice.middleRight"),bottomLeft:i("dialogNineSlice.bottomLeft"),bottomCenter:i("dialogNineSlice.bottomCenter"),bottomRight:i("dialogNineSlice.bottomRight"),close:i("dialogNineSlice.close")},closeButtonPosition:null,fillOpacity:.95,content:"",displayCloseButton:!0,callbacks:{onClose:null},audio:{close:"",open:"show_details_window"},tween:{type:"none",onClose:!1},buttons:[],buttonSpacing:n.x(20),layout:"",backgroundAlpha:.5};this._initDialog(t,a.extend(r,e))};return u.prototype=Object.create(r.prototype),u.prototype._initDialog=function(e,i){r.call(this),this.ui=e,this.options=i,this.cachedContent=this.options.content,this.isOpen=!1,this.container=new t.DisplayObjectContainer,this._setSize(),this._setPosition(),this._createBackground(),this.options.displayCloseButton&&this._createCloseButton(),this.options.buttons.length>0&&this.addButtons(this.options.buttons,this.options.buttonSpacing),this._setContent(this.options.content),this.addChild(this.container)},u.prototype.open=function(t,e,i){this.nineSlice&&null!==this.nineSlice||this._createBackground(),"function"==typeof t&&(this.options.callbacks.onClose=t),this.options.audio.open&&""!==this.options.audio.open&&l.playSound(this.options.audio.open),"none"!==this.options.tween.type?this.tweenIn():this.onOpenComplete(),this.ui.showModal(this,this.options.backgroundAlpha,i),this.isOpen=!0},u.prototype.tweenIn=function(){var t=this,e=this.position.x;this.position.x=this.ui.width,new TWEEN.Tween({x:this.position.x}).to({x:e},500).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){t.position.x=this.x}).onComplete(function(){t.onOpenComplete()}).start()},u.prototype.onOpenComplete=function(){},u.prototype.close=function(t){if(this.options.audio.close&&""!==this.options.audio.close&&l.playSound(this.options.audio.close),this.options.tween.onClose){var e=this,i=this.ui.width;new TWEEN.Tween({x:this.position.x}).to({x:i},500).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){e.position.x=this.x}).onComplete(function(){e.ui.hideModal(this),e.destroy(),t&&t()}).start()}else this.destroy(),this.ui.hideModal(this);this.isOpen=!1},u.prototype._setSize=function(){function t(t,e){var i=parseInt(e.slice(0,e.length-1))/100;return Math.round(t*i)}if(this.options.layout){var i=e.getConfigData(this.options.layout);i&&(i.width&&(this.options.width=n.x(i.width)),i.height&&(this.options.height=n.y(i.height)))}else"string"==typeof this.options.width&&this.options.width.indexOf("%")>-1&&(this.options.width=t(this.ui.width,this.options.width)),"string"==typeof this.options.height&&this.options.height.indexOf("%")>-1&&(this.options.height=t(this.ui.height,this.options.height));this.width_=this.options.width,this.height_=this.options.height},u.prototype.setLandscapePositions=function(t){"number"==typeof t.x&&(this.options.landscapeX=Math.round(t.x)),"number"==typeof t.y&&(this.options.landscapeY=Math.round(t.y))},u.prototype.setPortraitPositions=function(t){
"number"==typeof t.x&&(this.options.portraitX=Math.round(t.x)),"number"==typeof t.y&&(this.options.portraitY=Math.round(t.y))},u.prototype._setPosition=function(t){void 0!==t?t?(void 0===this.options.portraitX||null===this.options.portraitX?this._setStandardX():this.position.x=Math.round(this.options.portraitX),void 0===this.options.portraitY||null===this.options.portraitY?this._setStandardY():this.position.y=Math.round(this.options.portraitY)):(void 0===this.options.landscapeX||null===this.options.landscapeX?this._setStandardX():this.position.x=Math.round(this.options.landscapeX),void 0===this.options.landscapeY||null===this.options.landscapeY?this._setStandardY():this.position.y=Math.round(this.options.landscapeY)):(this._setStandardX(),this._setStandardY())},u.prototype._setStandardX=function(){null===this.options.x?this.position.x=Math.round((this.ui.width-this.options.width)/2):this.position.x=Math.round(this.options.x)},u.prototype._setStandardY=function(){null===this.options.y?this.position.y=Math.round((this.ui.height-this.options.height)/2):this.position.y=Math.round(this.options.y)},u.prototype._onClose=function(){this.close(),"function"==typeof this.options.callbacks.onClose&&this.options.callbacks.onClose(this)},u.prototype._createCloseButton=function(){this.closeButton=new s(t.Texture.fromFrame(this.options.images.close),t.Texture.fromFrame(this.options.images.close),a.bind(this._onClose,this),!0),this.closeButton.hitArea=new t.Rectangle(-this.closeButton.width/3,-this.closeButton.height/3,1.6*this.closeButton.width,1.6*this.closeButton.height),this.options.closeButtonPosition?this.options.closeButtonPosition?(this.closeButton.position.x=this.options.closeButtonPosition.x,this.closeButton.position.y=this.options.closeButtonPosition.y):(this.closeButton.position.x=this.options.width-this.closeButton.width/1.5,this.closeButton.position.y=-this.closeButton.height/3):(this.closeButton.position.x=this.options.width-this.closeButton.width,this.closeButton.position.y=0),this.container.addChild(this.closeButton)},u.prototype.addButtons=function(e,i){var n=0,r=0;if(i=i||0,e.length>0){this.buttonContainer&&this.removeChild(this.buttonContainer),this.buttonContainer=new t.DisplayObjectContainer;for(var o=0;o<e.length;o+=1){var a=e[o];a.x=n,this.buttonContainer.addChild(a),n+=a.width+i,a.height>r&&(r=a.height)}this.buttonContainer.position.x=(this.options.width-(n-i))/2,this.buttonContainer.position.y=this.options.height-r,this.container.addChild(this.buttonContainer)}},u.prototype.enableCloseButton=function(){this.closeButton&&this.closeButton.setInteractive(!0)},u.prototype.disableCloseButton=function(){this.closeButton&&this.closeButton.setInteractive(!1)},u.prototype._createBackground=function(){if(this.nineSlice){this.nineSlice.destroy(!0);try{this.container.removeChild(this.nineSlice)}catch(t){}}this.nineSlice=new h(this.options),this.container.addChildAt(this.nineSlice,0)},u.prototype._setContent=function(t){if(void 0!==t){try{this.removeChild(this.cachedContent)}catch(t){}this.cachedContent=t}void 0===this.cachedContent||a.isEmpty(this.cachedContent)||(this.container.addChild(this.cachedContent),this.container.getChildAt(0).cacheAsBitmap=!0)},u.prototype.resize=function(t,e){this.updateDialog(t,e)},u.prototype.updateDialog=function(e,i){a.extend(this.options,e);try{this.removeChild(this.container)}catch(t){}this.container=new t.DisplayObjectContainer,this._setSize(),this._setPosition(i),this._createBackground(),this.options.displayCloseButton&&this._createCloseButton(),this._setContent(this.options.content),this.addChild(this.container)},u.prototype.resetContent=function(t){this.options.content=t;try{this.container.removeChild(this.cachedContent)}catch(t){}this.cachedContent=t,this.container.addChild(this.cachedContent)},u.prototype.handleOrientationChange=function(t){this.updateDialog(this.options,t)},Object.defineProperty(u.prototype,"isOpen",{get:function(){return this.openState},set:function(t){this.openState=t}}),u.prototype.destroy=function(){this.nineSlice&&(this.container.removeChild(this.nineSlice),this.nineSlice.destroy(),this.nineSlice=null)},u}),define("absolute/shims",["pixi","absolute/platform"],function(t,e){if(window.navigator.userAgent.indexOf("Linux; U; Android 4")>=0){var i=Math.sin,n=Math.cos;Math.sin=function(t){return 0==t?0:i(t)},Math.cos=function(t){return 0==t?1:n(t)}}Date.now||(Date.now=function(){return+new Date});var r=parseInt(t.VERSION.slice(1,t.VERSION.indexOf(".")));t.JsonLoader&&(t.JsonLoader.prototype.load=function(){-1!=this.url.indexOf(".atlas")&&(this.url=this.url.substr(0,this.url.lastIndexOf("."))+".txt"),this.ajaxRequest=new window.XMLHttpRequest;var t=this;this.ajaxRequest.onload=function(){try{t.onJSONLoaded()}catch(e){t.onError()}},this.ajaxRequest.onerror=function(){t.onError()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()}),r<3&&(t.InteractionManager.prototype.onMouseUp=function(t){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t;for(var e=this.interactiveItems.length,i=!1,n=this.mouse.originalEvent,r=2===n.button||3===n.which,o=r?"rightup":"mouseup",a=r?"rightclick":"click",s=r?"rightupoutside":"mouseupoutside",l=r?"__isRightDown":"__isDown",h=0;h<e;h++){var u=this.interactiveItems[h];void 0!==u&&null!==u&&((u[a]||u[o]||u[s])&&(u.__hit=this.hitTest(u,this.mouse),u.__hit&&!i?(u[o]&&u[o](this.mouse),u[l]&&u[a]&&u[a](this.mouse),u.interactiveChildren||(i=!0)):u[l]&&u[s]&&u[s](this.mouse),u[l]=!1))}}),"v1.5.3"==t.VERSION&&(t.InteractionManager.prototype.onTouchMove=function(t){var e,i=this.interactionDOMElement.getBoundingClientRect(),n=t.changedTouches,r=0;for(r=0;r<n.length;r++){var o=n[r];e=this.touchs[o.identifier],e.originalEvent=t||window.event,e.global.x=(o.clientX-i.left)*(this.target.width/i.width),e.global.y=(o.clientY-i.top)*(this.target.height/i.height),navigator.isCocoonJS&&(e.global.x=o.clientX,e.global.y=o.clientY);for(var a=0;a<this.interactiveItems.length;a++){var s=this.interactiveItems[a];s.touchmove&&s.__touchData&&s.__touchData[o.identifier]&&s.touchmove(e)}}},t.Text.prototype.destroy=function(t){this.texture.destroy(t)},t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,t.texturesToDestroy&&t.texturesToDestroy.push(this)}),t.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(window.XMLHttpRequest)return new window.XMLHttpRequest;if(!window.ActiveXObject)return!1;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(t){}},e.hasPutImageDataBug()&&(t.CanvasTinter.tintWithPerPixel=function(e,i,n){var r=n.getContext("2d"),o=e.frame;n.width=o.width,n.height=o.height,r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);for(var a=t.hex2rgb(i),s=a[0],l=a[1],h=a[2],u=r.getImageData(0,0,o.width,o.height),d=u.data,c=0;c<d.length;c+=4){d[c+0]*=s,d[c+1]*=l,d[c+2]*=h;var p=d[c+3];d[c]/=255/p,d[c+1]/=255/p,d[c+2]/=255/p}r.putImageData(u,0,0)},t.CanvasTinter.tintMethod=t.CanvasTinter.tintWithPerPixel),Object.defineProperty(t.Point.prototype,"X",{get:function(){throw"PIXI.Point has no member X"},set:function(t){throw"PIXI.Point has no member X"}}),Object.defineProperty(t.Point.prototype,"Y",{get:function(){throw"PIXI.Point has no member Y"},set:function(t){throw"PIXI.Point has no member Y"}})}),define("absolute/sprite",["pixi","absolute/screenmetrics","absolute/debug"],function(t,e,i){return{fromFrame:function(n){var r;try{if(r=t.Sprite.fromFrame(n),i.enabled){var o=r.texture.baseTexture.imageUrl.substr(r.texture.baseTexture.imageUrl.lastIndexOf("/")+1),a=new t.Text(o,{font:Math.floor(30*e.getResScale())+"px Segoe UI, Helvetica, sans-serif",fill:"white",align:"center"});a.position.y=0,a.position.x=0,r.addChild(a)}}catch(o){if(!i.enabled)throw o;r=t.Sprite.fromFrame("missing.png");var s=new t.Text(n,{font:Math.floor(40*e.getResScale())+"px Segoe UI, Helvetica, sans-serif",fill:"black",align:"center"});s.position.y=r.height,s.position.x=(r.width-s.width)/2,r.addChild(s)}return r}}}),define("absolute/texture",["pixi","absolute/platform","absolute/debug"],function(t,e,i){return{fromFrame:function(e){var n;try{n=t.Texture.fromFrame(e)}catch(e){if(!i.enabled)throw e;n=t.Texture.fromFrame("missing.png")}return n}}}),define("absolute/mathutils",[],function(){return MathUtils={distance:function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},degreesToRadians:function(t){return t*Math.PI/180}},MathUtils}),define("absolute/randomutils",["absolute/mathutils","absolute/coords","pixi","lodash","absolute/spriteutils"],function(t,e,i,n,r){return{getRandomIntFromRange:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},distributeItems:function(e,o,a,s,l){function h(e,n){for(var o=g.getRandomIntFromRange(0,a.width),u=g.getRandomIntFromRange(a.y,a.y+a.height),c=0;c<s.children.length;c++){var p=t.distance(o,u,s.children[c].position.x,s.children[c].position.y);if(e>=n)return!1;if(p<l.minSpacing)return e++,h(e,n),!1}if(d.sprite=i.Sprite.fromFrame(d.url),d.sprite.anchor.x=l.anchor.x,d.sprite.anchor.y=l.anchor.y,l.shade>0){var f=new i.Sprite(r.greyscale(i.Sprite.fromFrame(d.url),.5));f.alpha=l.shade,d.sprite.addChild(f)}if(null!==l.lockX?d.sprite.position.x=l.lockX:d.sprite.position.x=o,null!==l.lockY?d.sprite.position.y=l.lockY:d.sprite.position.y=u,l.scaleWithY){var y=(u-a.y)/a.height;y+=l.minScale,y>1&&(y=1),d.sprite.scale.x=d.sprite.scale.y=y,d.sprite.alpha=Math.max(d.sprite.scale.y,l.minAlpha)}else{var m=g.getRandomIntFromRange(100*l.minScale,100*l.maxScale)/100;d.sprite.scale.x=d.sprite.scale.y=m,Math.random()>.5&&!l.lockScale&&(d.sprite.scale.x=-d.sprite.scale.x),m>1&&(d.sprite.y=d.sprite.texture.height-d.sprite.texture.height*m)}s.addChild(d.sprite)}l=n.extend({minSpacing:100,scaleWithY:!0,minScale:.3,maxScale:1,lockScale:!1,minAlpha:.2,lockY:null,lockX:null,anchor:{x:0,y:0},shade:0},l),this.ui=e,a.area=a.width*a.height;for(var u=0;u<o.length;u++){var d=o[u],c=new i.Texture.fromFrame(d.url);d.area=c.width*c.height,d.count=Math.ceil(d.fillDensity*a.area/d.area);for(var p=0;p<d.count;p++){var g=this;h(0,1e3)}}return s}}}),define("absolute/pageindicator",["absolute/coords","pixi","lodash","absolute/spriteutils"],function(t,e,i,n){var r=function(e,n,r){n=void 0!==n?n:0;var o={pageIndicators:{empty:"btn_main_pagepip_empty.png",full:"btn_main_pagepip_full.png"},pipPadding:t.x(10),clickCallback:function(){}};this.initPageIndicator(e,n,i.extend(o,r))};return r.prototype=Object.create(e.DisplayObjectContainer.prototype),r.prototype.initPageIndicator=function(t,i,n){e.DisplayObjectContainer.call(this),this.pageCount=t,this.currentPage=i,this.options=n,this.pips=[],this.makePips()},r.prototype.setPageIndex=function(t){this.currentPage=t,this._update()},r.prototype.makePips=function(){for(var t=0;t<this.pageCount;t++){var i=new e.DisplayObjectContainer;i.on=e.Sprite.fromFrame(this.options.pageIndicators.full),i.off=e.Sprite.fromFrame(this.options.pageIndicators.empty),i.position.x=(i.on.width+this.options.pipPadding)*t,t!==this.currentPage?(i.on.visible=!1,i.off.visible=!0):(i.on.visible=!0,i.off.visible=!1),i.addChild(i.on),i.addChild(i.off),i.off.interactive=!0,i.off.pageIndex=t,n.bindInteraction(i.off,function(t){this.options.clickCallback(t.target.pageIndex)}.bind(this)),this.addChild(i),this.pips.push(i)}this.totalHeight=i.on.height,this.totalWidth=(i.on.width+this.options.pipPadding)*this.pageCount,this.height=this.totalHeight,this.width=this.totalWidth},r.prototype._update=function(){for(var t=0;t<this.pips.length;t++){var e=this.pips[t];this.currentPage==t?(e.on.visible=!0,e.off.visible=!1):(e.on.visible=!1,e.off.visible=!0)}},r.prototype.nextPage=function(){this.currentPage++,this.currentPage>=this.pageCount&&this.currentPage,this._update()},r.prototype.previousPage=function(){this.currentPage--,this.currentPage<0&&this.currentPage,this._update()},r}),define("absolute/multipagedialog",["pixi","absolute/dialog","absolute/button","absolute/screenmetrics","lodash","absolute/pageindicator","absolute/coords","absolute/platform"],function(t,e,i,n,r,o,a,s){var l=function(t,e){var i={pages:[],pagePadding:{x:a.x(10),y:a.y(100)},borderThickness:{left:a.x(18),right:a.x(35)},interfacePadding:{arrows:{x:a.x(50),y:a.y(50)},pips:a.y(50)},buttonScale:.5,pageButtonImage:"btn_main_LAGOONRETURN.png",pageChangedCallback:function(){},startPage:0};this.initMultiPageDialog(t,r.extend(i,e))};return l.prototype=Object.create(e.prototype),l.prototype.initMultiPageDialog=function(t,i){e.call(this,t,i),this.pages=this.options.pages;var n=this.options.startPage<this.pages.length?this.options.startPage:0;this.reset(!1,n)},l.prototype.reset=function(t,e,i){if(t)try{this.removeChild(this.pageTray),this.removeChild(this.pips),this.removeChild(this.nextpageButton),this.removeChild(this.prevpageButton)}catch(t){}i&&(this.options.pages=i,this.pages=i),this.initContent(),this.initNonTouchInterface(),s._isOldAndroid()||this.initTouchInterface(),this.initPagePips(),this.scrollToPage(e)},l.prototype.initContent=function(){this.pageTray=new t.DisplayObjectContainer;for(var e=0,i=this.pages.length;e<i;e+=1){var n=this.pages[e],r=n.pageWidth||n.width;n.position.x=e*r,n.position.y=this.options.pagePadding.y,this.pageTray.addChild(n)}this.kPanThreshold=r/5,this.centerOffset=(this.options.width-r)/2,this.pageTray.position.x=this.centerOffset;var o=new t.Graphics;o.beginFill(16777215,1),o.drawRect(this.position.x+this.options.borderThickness.left,this.position.y,this.options.width-this.options.borderThickness.right,this.options.height),o.endFill(),this.pageTray.mask=o,this.container.addChild(this.pageTray)},l.prototype.initTouchInterface=function(){var e=0;this.closeButton&&(e=this.closeButton.height),this.lastDeltaX=0,this.startX=0;var i=new t.Rectangle(0,e,this.options.width,this.options.height-e-this.nextpageButton.height);this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.pageTray),this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},l.prototype.initNonTouchInterface=function(){this.nextpageButton=new i(t.Texture.fromFrame(this.options.pageButtonImage),t.Texture.fromFrame(this.options.pageButtonImage),function(){this.currentPage<this.pages.length-1&&this.scrollToPage(this.currentPage+1)}.bind(this),!1);var e=this.options.height-this.nextpageButton.height*this.options.buttonScale-this.options.interfacePadding.arrows.y;this.nextpageButton.scale.x=-1*this.options.buttonScale,this.nextpageButton.scale.y=this.options.buttonScale,this.nextpageButton.position.x=this.options.width-this.options.interfacePadding.arrows.x,this.nextpageButton.position.y=e,this.nextpageButton.setActive(!1),this.container.addChild(this.nextpageButton),this.prevpageButton=new i(t.Texture.fromFrame(this.options.pageButtonImage),t.Texture.fromFrame(this.options.pageButtonImage),function(){this.currentPage>0&&this.scrollToPage(this.currentPage-1)}.bind(this),!1),this.prevpageButton.position.y=e,this.prevpageButton.scale.x=this.prevpageButton.scale.y=this.options.buttonScale,this.prevpageButton.position.x=this.options.interfacePadding.arrows.x,this.prevpageButton.setActive(!1),this.container.addChild(this.prevpageButton)},l.prototype.initPagePips=function(){this.pages.length>1&&(this.pips=new o(this.pages.length,0,r.extend(this.options,{clickCallback:this.scrollToPage.bind(this)})),this.pips.position.x=(this.options.width-this.pips.totalWidth)/2,this.pips.position.y=this.options.height-this.pips.totalHeight-this.options.interfacePadding.pips,this.container.addChild(this.pips))},l.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.pages.length;e<i;e++)this.pages[e].enableButtons(t)},l.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaX=0,this.startX=t.getLocalPosition(this.parent).x,this.enableButtons(!1)},l.prototype.handleDrag=function(t){var e=t.getLocalPosition(this.parent),i=e.x-this.startX;this.pageTray.x+=(i-this.lastDeltaX)*n.devicePixelRatio*.7,this.lastDeltaX=i},l.prototype.handleDragEnd=function(t){if(this.lastDeltaX=0,void 0!==this.parent){var e=this.currentPage,i=t.getLocalPosition(this.parent),n=i.x-this.startX;n<=-this.kPanThreshold?e+=1:n>=this.kPanThreshold&&(e-=1),e<0?e=0:e>this.pages.length-1&&(e=this.pages.length-1),this.scrollToPage(e)}},l.prototype.scrollToPage=function(t){this.pips&&this.pips.setPageIndex(t);var e=this.pages[t].pageWidth||this.pages[t].width,i=-t*e+this.centerOffset,n=this;new TWEEN.Tween({x:this.pageTray.position.x}).to({x:i},200).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){n.pageTray.position.x=this.x}).onComplete(function(){n.enableButtons(!0),n.setCurrentPage(t)}).start()},l.prototype.setCurrentPage=function(t){this.currentPage=t,this.nextpageButton.setActive(t!==this.pages.length-1),this.prevpageButton.setActive(0!==t),this.options.pageChangedCallback(t)},l.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.pages.length;e<i;e++)this.pages[e].interactive=t},l.prototype.handleOrientationChange=function(t){e.prototype.handleOrientationChange.call(this,t),this.scale.x=this.scale.y=1,this.reset(!0,this.currentPage)},l}),define("absolute/multipagegenerator",["pixi","absolute/coords","lodash"],function(t,e,i){var n=function(t){var n={width:0,height:0,cardScale:.83,padding:{x:e.x(50),y:e.y(50)},itemWidth:0,itemHeight:0};this.initMultiPageGenerator(i.extend(n,t))};return n.prototype.initMultiPageGenerator=function(t){this.settings=t,this.width=this.settings.width,this.height=this.settings.height,this.startY=t.startY||0},n.prototype.getPages=function(t){this.items=t,this.pages=[],this.cellWidth=this.settings.itemWidth*this.settings.cardScale+this.settings.padding.x,this.colsPerPage=Math.floor((this.settings.maxWidth||this.width)/this.cellWidth),this.cardScale=this.settings.cardScale+(this.settings.maxWidth||this.width)/this.cellWidth%1/this.colsPerPage,this.rowsPerPage=Math.ceil(this.items.length/this.colsPerPage);for(var e=this.items.length/this.colsPerPage,i=Math.ceil(e/this.rowsPerPage),n=0;n<i;n+=1){var r=this.rowsPerPage*this.colsPerPage*n,o=this.rowsPerPage*this.colsPerPage*(n+1);o>this.items.length&&(o=this.items.length),this.pages.push(this.makePage(this.items.slice(r,o),this.cardScale))}return this.pages},n.prototype.makePage=function(e,i){var n,r,o,a=new t.DisplayObjectContainer,s=0,l=Math.ceil(this.items.length/this.colsPerPage);for(this.checkAndUpdateGraphicsSize(e),r=0;r<this.rowsPerPage;r++)for(o=0;o<this.colsPerPage&&s<e.length;o++){var h=r===l-1&&this.colsPerPage>1&&"center"===this.settings.align;n=e[s],n.x=h?a.width/2+o*(n.width*i/2+this.settings.padding.x)-(n.width*i+this.settings.padding.x)*(this.colsPerPage-o-1)/2:o*(n.width*i+this.settings.padding.x),n.y=r*(n.height*i+this.settings.padding.y)+this.startY||0,n.scale.x=n.scale.y=i,a.addChild(n),s++}return a},n.prototype.checkAndUpdateGraphicsSize=function(e){if(this.settings.keepOneLine)for(var i=1;i<e.length;i++)e[i]instanceof t.Graphics&&(e[i].width=e[0].width,e[i].height=e[0].height)},n.prototype.updateSettings=function(t){this.settings=t},n}),define("absolute/graphserializer",["pixi","absolute/button"],function(t,e){return{serialize:function(i){var n,r,o={position:{x:i.position.x,y:i.position.y}};if(i instanceof e)o.type="button",o.asset=this.lookupTexture(i),o.id=o.asset.substring(0,o.asset.indexOf(".png"));else if(i instanceof t.Sprite)for(r=i.children.length,o.type="sprite",o.asset=this.lookupTexture(i),o.id=o.asset.substring(0,o.asset.indexOf(".png")),o.children=[],n=0;n<r;n+=1)o.children.push(this.serialize(i.getChildAt(n)));else if(i instanceof t.DisplayObjectContainer)for(r=i.children.length,o.type="container",o.children=[],n=0;n<r;n+=1)o.children.push(this.serialize(i.getChildAt(n)));return o},lookupTexture:function(e){var i;for(i in t.TextureCache)if(t.TextureCache.hasOwnProperty(i)&&t.TextureCache[i]===e.texture)return i;return""}}}),define("absolute/scrollarea",["pixi","absolute/platform"],function(t,e){var i=function(t,e,i,n,r){this._initScrollArea(t,e,i,n,r)};return i.constructor=i,i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype._initScrollArea=function(i,n,r,o,a){t.DisplayObjectContainer.call(this),r&&(r.x?(this.constrainX=!0,this.constrainXType=r.x):r.y?(this.constrainY=!0,this.constrainYType=r.y):this.constrainX=this.constrainY=!1),o&&(this.scrollArrow=new t.Sprite(o),this.scrollArrow.anchor.x=this.scrollArrow.anchor.y=.5),this.moveCompleteCallback=a,this.moving=!1,this.contents=new t.DisplayObjectContainer,this.interactive=!0,this.buttonMode=!0,e.supportsTouch()?(this.touchstart=this.onMoveStart.bind(this),this.touchmove=this.onMove.bind(this),this.touchend=this.onMoveEnd.bind(this),(e._isWindows()||e._isMac()&&!e._isIOS())&&(this.mousedown=this.onMoveStart.bind(this),this.mousemove=this.onMove.bind(this),this.mouseup=this.onMoveEnd.bind(this),this.mouseupoutside=this.onMoveEnd.bind(this))):(this.mousedown=this.onMoveStart.bind(this),this.mousemove=this.onMove.bind(this),this.mouseup=this.onMoveEnd.bind(this),this.mouseupoutside=this.onMoveEnd.bind(this)),this.addChild(this.contents),this.resize(i,n)},i.prototype.resize=function(e,i){this.width_=e,this.height_=i,this.mask&&this.removeChild(this.mask);var n=new t.Graphics;n.beginFill(16777215,1),n.drawRect(0,0,this.width_,this.height_),n.endFill(),this.mask=n,this.addChild(this.mask),this.updateContentBounds(),this.hitArea=new t.Rectangle(0,0,this.width_,this.height_)},i.prototype.addItem=function(t){this.contents.addChild(t),this.updateContentBounds()},i.prototype.scrollXAbsolute=function(t){this.constrainX||t<=0&&t>=this.width_-this.contents.width&&(this.contents.position.x=Math.round(t))},i.prototype.scrollYAbsolute=function(t){this.constrainY||t<=0&&t>=this.height_-this.contents.height&&(this.contents.position.y=Math.round(t))},i.prototype.scrollX=function(t){if(!this.constrainX){var e=this.contents.position.x+t;e<=0&&e>=this.width_-this.contents.width&&(this.contents.position.x=Math.round(e))}},i.prototype.scrollY=function(t){if(!this.constrainY){var e=this.contents.position.y+t;e<=0&&e>=this.height_-this.contents.height&&(this.contents.position.y=Math.round(e))}},i.prototype.scrollTop=function(){this.constrainY||(this.contents.position.y=0)},i.prototype.scrollBottom=function(){this.constrainY||(this.contents.position.y=this.height_-this.contents.height)},i.prototype.scrollLeft=function(){this.constrainX||(this.contents.position.x=0)},i.prototype.scrollRight=function(){this.constrainX||(this.contents.position.x=this.width_-this.contents.width)},i.prototype.updateContentBounds=function(){if(this.contents.width&&this.contents.height);else{var t;t=this.computeAABB(this.contents),this.contents.width_=t.width,this.contents.height_=t.height}if(this.constrainX)switch(this.constrainXType){case"left":this.contents.position.x=0;break;case"right":this.contents.position.x=this.width_-this.contents.width;break;case"center":this.contents.position.x=(this.width_-this.contents.width)/2}if(this.constrainY)switch(this.constrainYType){case"top":this.contents.position.y=0;break;case"bottom":this.contents.position.y=this.height_-this.contents.height;break;case"center":this.contents.position.y=(this.height_-this.contents.height)/2}},i.prototype.computeAABB=function(e){if(e instanceof t.Sprite)return new t.Rectangle(e.position.x,e.position.y,e.width,e.height);if(e instanceof t.DisplayObjectContainer){if(e.width_&&e.height_)return new t.Rectangle(e.position.x,e.position.y,e.width_,e.height_);if(e.width&&e.height)return new t.Rectangle(e.position.x,e.position.y,e.width,e.height);if(e.children.length>0){for(var i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MAX_VALUE,o=Number.MIN_VALUE,a=0;a<e.children.length;a+=1){var s=this.computeAABB(e.children[a]);s.x<i&&(i=s.x),s.y<r&&(r=s.y),s.x+s.width>n&&(n=s.x+s.width),s.y+s.height>o&&(o=s.y+s.height)}return i*=e.scale.x,n*=e.scale.x,r*=e.scale.y,o*=e.scale.y,new t.Rectangle(e.position.x+i,e.position.y+r,n-i,o-r)}return new t.Rectangle(e.position.x,e.position.y,0,0)}},i.prototype.onMoveStart=function(t){this.moving=!0,t.originalEvent.preventDefault();var e=t.getLocalPosition(this.parent);this.lastX=e.x,this.lastY=e.y,this.startX=e.x,this.startY=e.y,this.scrollArrow&&(this.addChild(this.scrollArrow),this.scrollArrow.position.x=e.x,this.scrollArrow.position.y=e.y,this.scrollArrow.anchor.x=this.scrollArrow.anchor.y=.5,this.scrollArrow.visible=!1)},i.prototype.onMove=function(t){if(this.moving){var e=t.getLocalPosition(this.parent),i=e.x,n=e.y,r=i-this.lastX,o=n-this.lastY;this.lastX=i,this.lastY=n,this.scrollY(o),this.scrollX(r),this.scrollArrow&&(this.scrollArrow.visible||(this.scrollArrow.visible=!0),this.constrainX||(this.scrollArrow.position.x=e.x),this.constrainY||(this.scrollArrow.position.y=e.y))}},i.prototype.onMoveEnd=function(t){this.moving=!1;var e=t.getLocalPosition(this.parent),i=e.x,n=e.y;this.startX,this.startY;this.scrollArrow&&this.removeChild(this.scrollArrow),this.moveCompleteCallback&&this.moveCompleteCallback()},i.prototype.isChildVisible=function(e){this.contents.updateTransform();var i=new t.Rectangle(e.worldTransform.tx,e.worldTransform.ty,e.width_,e.height_),n=new t.Rectangle(this.worldTransform.tx,this.worldTransform.ty,this.width_,this.height_),r=n.contains(i.x+i.width/2,i.y+i.height/2),o=n.contains(i.x,i.y),a=n.contains(i.x+i.width,i.y),s=n.contains(i.x+i.width,i.y+i.height),l=n.contains(i.x+i.width,i.y+i.height);return r||o||a||s||l},i}),define("absolute/messagedialog",["pixi","absolute/dialog","lodash","absolute/button","absolute/coords","absolute/screenmetrics"],function(t,e,i,n,r,o){var a=function(t,e,n){var a={okFunc:function(){},displayOkButton:!0,okButtonText:"OK",okButtonImage:"dlg_btn_blank.png",okButtonTextStyle:{font:Math.floor(90*o.getResScale())+"px Ganache",align:"center",wordWrap:!0,wordWrapWidth:n.width-r.x(200)},okButtonLabelPosition:{x:"center",y:r.y(-20)},textStyle:{font:Math.floor(80*o.getResScale())+"px Ganache",align:"center",wordWrap:!0,wordWrapWidth:n.width-r.x(200)},textImage:null};this.initMessageDialog(t,e,i.extend(a,n))};return a.prototype=Object.create(e.prototype),a.prototype.initMessageDialog=function(i,r,o){if(e.call(this,i,o),this.ui=i,this.message=r,this.content=this.initContent(),this.options.content=this.content,this._setContent(this.content),this.options.displayOkButton){this.okButton=new n(t.Texture.fromFrame(this.options.okButtonImage),t.Texture.fromFrame(this.options.okButtonImage),function(){"function"==typeof this.options.okFunc&&this.options.okFunc()}.bind(this)),this.okButton.position.x=(this.options.width-this.okButton.width)/2,this.okButton.position.y=this.options.height-this.okButton.height,this.addChild(this.okButton);var a=new t.Text(this.options.okButtonText,this.options.okButtonTextStyle);"center"===this.options.okButtonLabelPosition.x?a.position.x=(this.okButton.width-a.textWidth)/2:a.position.x=this.options.okButtonLabelPosition.x,a.position.y=this.options.okButtonLabelPosition.y,this.okButton.addChild(a)}},a.prototype.initContent=function(){var e=new t.DisplayObjectContainer;return null==this.options.textImage?(this.text=new t.Text(this.message,this.options.textStyle),this.text.position.y=this.options.textY||r.y(120)):(this.text=this.options.textImage,this.text.setText(this.message)),this.text.position.x=(this.options.width-this.text.textWidth)/2,e.addChild(this.text),e},a.prototype.setPosition=function(t,e,i){t.position.x=r.x(e),t.position.y=r.y(i)},a.prototype.setMessage=function(t){this.text.setText(t),setTimeout(function(){this.text.position.x=(this.options.width-this.text.textWidth)/2}.bind(this),10)},a.prototype.setMessageY=function(t){this.text.position.y=t},a}),define("absolute/integration",["absolute/debug","absolute/gameconfig"],function(t,e){return{spil:{gameBreak:function(e,i){function n(){a||(e.call(this),a=!0),window.clearTimeout(o)}var r=window.SpilGameAPIInstance||window.GameAPI;if(r&&r.GameBreak){var o,a=!1;r.GameBreak.request(i.bind(this),n.bind(this)),o=window.setTimeout(function(){t.log("ahg: Spil api failure: gamebreak"),n.call(this)}.bind(this),1e4)}else e.call(this)}},iwin:{ready:function(e){window.iConsole?window.iConsole.game.ready().result(function(){e.call(this)}):t.log("ahg: iWin api not available game ready failed.")},loadProgress:function(e){window.iConsole?window.iConsole.game.loadProgress({progress:e,file:"ahg: file name not available."}):t.log("ahg: iWin api not available loadProgress failed.")},loaded:function(e,i){window.iConsole?window.iConsole.game.loaded({success:e}):(t.log("ahg: iWin api not available loaded failed."),i.call(this))},levelStarted:function(t,e){window.iConsole?window.iConsole.game.levelStarted({level:t}).result(function(t){e.call(this,t)}.bind(this)):e.call(this)},levelFinished:function(t,e,i,n,r,o){window.iConsole?window.iConsole.game.levelFinished({level:e,score:i,time:n,won:r,data:o||{}}).result(function(){t.call(this)}):t.call(this)},getGameData:function(t,i){window.iConsole?window.iConsole.game.getGameData().result(function(e){var i={};if(void 0!==e&&null!==e&&""!==e)try{i=JSON.parse(e)}catch(t){}else i.data={};t.call(this,i.data)}.bind(this)):t.call(this,e.getVal(i))},setGameData:function(t,i){window.iConsole?window.iConsole.game.setGameData({data:t}):e.setVal(i,t)}}}}),define("absolute/lazyloadedsprite",["pixi","absolute/loader"],function(t,e){var i=function(t,e,i){this._initLazyLoadedSprite(t,e,i)};return i.constructor=i,i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype._initLazyLoadedSprite=function(e,i,n){t.DisplayObjectContainer.call(this),this.atlasName=e,this.assetName=i,this.placeholder=n,this.isLoaded=!1,this.isLoading=!1,this.addChild(this.placeholder)},i.prototype.load=function(i){if(t.TextureCache[this.assetName]&&t.TextureCache[this.assetName].isValid)this._replaceAsset();else{var n=new e;this.isLoading=!0,n.loadArt([{name:this.atlasName}],function(){},function(){this._replaceAsset(),this.isLoaded=!0,"function"==typeof i&&i(this)}.bind(this))}},i.prototype._replaceAsset=function(){this.placeholder&&(this.removeChild(this.placeholder),this.placeholder=null),this.asset=t.Sprite.fromFrame(this.assetName),this.addChild(this.asset)},Object.defineProperty(i.prototype,"loaded",{get:function(){return this.isLoaded}}),Object.defineProperty(i.prototype,"loading",{get:function(){return this.isLoading}}),i.prototype.unload=function(){this.asset&&(this.removeChildAt(0),this.asset.texture.destroy(!0),this.asset=null,this.isLoaded=!1,this.isLoading=!1)},i}),define("absolute/utils",[],function(){return{makeGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},makeUniqueId:function(){return"yxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getUrlParams:function(){for(var t,e={},i=/\+/g,n=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(i," "))},o=window.location.search.substring(1);t=n.exec(o);)e[r(t[1])]=r(t[2]);return e}}}),define("absolute/parallaxlayer",["pixi","absolute/screenmetrics"],function(t,e){var i=function(t,e){this.initParallaxLayer(t,e)};return i.prototype=Object.create(t.DisplayObjectContainer.prototype),i.prototype.initParallaxLayer=function(e,i){t.DisplayObjectContainer.call(this),this.ui=e,this.scenes=[];var n=0,r=this.generateScene(null);for(r.position.x=n,this.scenes.push(r),this.addChild(r),n+=r.width;n<this.ui.width+this.scenes[0].width;)r=this.generateScene(null),r.position.x=n,this.scenes.push(r),this.addChild(r),n+=r.width
;this.originalVelocity=i,this.velocityX=i,this.px=0},i.prototype.setVelocity=function(t){this.velocityX=this.originalVelocity*t},i.prototype.beforeRender=function(){if(this.lastTime){var t=Date.now(),i=(t-this.lastTime)*this.velocityX;this.px-=i;for(var n=this.px*e.getResScale(),r=0;r<this.scenes.length;r+=1)this.scenes[r].position.x=n,n+=this.scenes[r].width;this.scenes[0].position.x<-this.scenes[0].width&&(this.scenes.push(this.scenes.shift()),this.scenes[this.scenes.length-1].position.x=n,this.px=0),this.lastTime=t}else this.lastTime=Date.now()},i.prototype.afterRender=function(){},i.prototype.generateScene=function(t){},i.prototype.handlePause=function(){},i.prototype.handleResume=function(){this.lastTime=Date.now()},i.prototype.reset=function(t){this.lastTime=null,this.px=0},i}),define("absolute",["require","absolute/asyncqueue","absolute/audiomanager","absolute/button","absolute/snapshot","absolute/coords","absolute/platform","absolute/screenmetrics","absolute/digitlabel","absolute/debug","absolute/digitsprite","absolute/eventbus","absolute/gameconfig","absolute/storagemanager","absolute/spriteutils","absolute/game","absolute/gameui","absolute/textutils","absolute/togglebutton","absolute/musicmanager","absolute/progressbar","absolute/progressdial","absolute/tweenutils","absolute/screen","absolute/simplemessagebox","absolute/spritemessagebox","absolute/loader","absolute/layouthelper","absolute/draggable","absolute/analytics","absolute/dialog","absolute/shims","absolute/sprite","absolute/texture","absolute/mathutils","absolute/randomutils","absolute/pageindicator","absolute/multipagedialog","absolute/multipagegenerator","absolute/graphserializer","absolute/scrollarea","absolute/textbutton","absolute/nineslice","absolute/threeslice","absolute/messagedialog","absolute/integration","absolute/assetmap","absolute/uibuilder","absolute/stringmanager","absolute/animatedbutton","absolute/animatedtextbutton","absolute/lazyloadedsprite","absolute/utils","absolute/parallaxlayer"],function(t){"use strict";return{version:"1.0",AsyncQueue:t("absolute/asyncqueue"),AudioManager:t("absolute/audiomanager"),Button:t("absolute/button"),Snapshot:t("absolute/snapshot"),Coords:t("absolute/coords"),Platform:t("absolute/platform"),ScreenMetrics:t("absolute/screenmetrics"),DigitLabel:t("absolute/digitlabel"),Debug:t("absolute/debug"),DigitSprite:t("absolute/digitsprite"),EventBus:t("absolute/eventbus"),GameConfig:t("absolute/gameconfig"),StorageManager:t("absolute/storagemanager"),SpriteUtils:t("absolute/spriteutils"),Game:t("absolute/game"),GameUI:t("absolute/gameui"),TextUtils:t("absolute/textutils"),ToggleButton:t("absolute/togglebutton"),MusicManager:t("absolute/musicmanager"),ProgressBar:t("absolute/progressbar"),ProgressDial:t("absolute/progressdial"),TweenUtils:t("absolute/tweenutils"),Screen:t("absolute/screen"),SimpleMessageBox:t("absolute/simplemessagebox"),SpriteMessageBox:t("absolute/spritemessagebox"),Loader:t("absolute/loader"),LayoutHelper:t("absolute/layouthelper"),Draggable:t("absolute/draggable"),Analytics:t("absolute/analytics"),Dialog:t("absolute/dialog"),Shims:t("absolute/shims"),Sprite:t("absolute/sprite"),Texture:t("absolute/texture"),MathUtils:t("absolute/mathutils"),RandomUtils:t("absolute/randomutils"),PageIndicator:t("absolute/pageindicator"),MultiPageDialog:t("absolute/multipagedialog"),MultiPageGenerator:t("absolute/multipagegenerator"),GraphSerializer:t("absolute/graphserializer"),ScrollArea:t("absolute/scrollarea"),TextButton:t("absolute/textbutton"),NineSlice:t("absolute/nineslice"),ThreeSlice:t("absolute/threeslice"),MessageDialog:t("absolute/messagedialog"),Integration:t("absolute/integration"),AssetMap:t("absolute/assetmap"),UIBuilder:t("absolute/uibuilder"),StringManager:t("absolute/stringmanager"),AnimatedButton:t("absolute/animatedbutton"),AnimatedTextButton:t("absolute/animatedtextbutton"),LazyLoadedSprite:t("absolute/lazyloadedsprite"),Utils:t("absolute/utils"),ParallaxLayer:t("absolute/parallaxlayer")}}),define("text!audiosprites.json",[],function(){return'[\r\n    {\r\n        "id": "pickupCard",\r\n        "url": "card_pickup",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 354,\r\n        "end": 354.3700680272109,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "hint",\r\n        "url": "Hint_C",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 354,\r\n        "end": 354.3700680272109,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "foundation",\r\n        "url": "card_foundation",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 339,\r\n        "end": 341.29732426303855,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "Deal_Spider_Draw",\r\n        "url": "deal_spider_draw",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 393,\r\n        "end": 394.15954648526076,\r\n        "lazyload": true,\r\n        "loadgroup": "spider"\r\n    },\r\n    {\r\n        "id": "Deal_Spider",\r\n        "url": "deal_spider",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 389,\r\n        "end": 391.6013378684807,\r\n        "lazyload": true,\r\n        "loadgroup": "spider"\r\n    },\r\n    {\r\n        "id": "Deal_FreeCell",\r\n        "url": "deal_freecell",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 377,\r\n        "end": 380.11333333333334,\r\n        "lazyload": true,\r\n        "loadgroup": "freecell"\r\n    },\r\n    {\r\n        "id": "Deal_Klondike",\r\n        "url": "deal_klondike",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 382,\r\n        "end": 383.4149659863946,\r\n        "lazyload": true,\r\n        "loadgroup": "klondike"\r\n    },\r\n    {\r\n        "id": "Deal_TriPeaks",\r\n        "url": "deal_tripeaks",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 396,\r\n        "end": 397.59868480725623,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "Deal_Pyramid",\r\n        "url": "deal_pyramid",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 385,\r\n        "end": 387.2813378684807,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "threeCards",\r\n        "url": "three_card",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 865,\r\n        "end": 865.4629478458049,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "singleCard",\r\n        "url": "single_deal",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 508,\r\n        "end": 508.50938775510207,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "illegalMove",\r\n        "url": "card_illegal",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 343,\r\n        "end": 343.30040816326533,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "legalMove",\r\n        "url": "card_legal",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 345,\r\n        "end": 345.0914285714286,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "drawReset",\r\n        "url": "draw_reset",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 399,\r\n        "end": 399.48616780045353,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "flipCardOffScreen",\r\n        "url": "card_flip_off_screen",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 336,\r\n        "end": 337.02022675736964,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "deselectCard",\r\n        "url": "card_deselect",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 332,\r\n        "end": 332.16108843537415,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "matchCard1",\r\n        "url": "CardMatch_1",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 8,\r\n        "end": 9.856145124716553,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "matchCard2",\r\n        "url": "CardMatch_2",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 35,\r\n        "end": 36.8097052154195,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard3",\r\n        "url": "CardMatch_3",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 38,\r\n        "end": 39.8097052154195,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard4",\r\n        "url": "CardMatch_4",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 41,\r\n        "end": 42.83292517006803,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard5",\r\n        "url": "CardMatch_5",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 44,\r\n        "end": 45.8097052154195,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard6",\r\n        "url": "CardMatch_6",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 47,\r\n        "end": 48.8097052154195,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard7",\r\n        "url": "CardMatch_7",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 50,\r\n        "end": 51.8097052154195,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard8",\r\n        "url": "CardMatch_8",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 53,\r\n        "end": 54.740045351473924,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard9",\r\n        "url": "CardMatch_9",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 56,\r\n        "end": 57.740045351473924,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard10",\r\n        "url": "CardMatch_10",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 11,\r\n        "end": 12.856145124716553,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard11",\r\n        "url": "CardMatch_11",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 14,\r\n        "end": 17.620861678004534,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard12",\r\n        "url": "CardMatch_12",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 19,\r\n        "end": 20.925804988662133,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard13",\r\n        "url": "CardMatch_13",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 22,\r\n        "end": 23.902585034013605,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard14",\r\n        "url": "CardMatch_14",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 25,\r\n        "end": 26.902585034013605,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard15",\r\n        "url": "CardMatch_15",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 28,\r\n        "end": 30.018684807256236,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "matchCard16",\r\n        "url": "CardMatch_16",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 32,\r\n        "end": 33.02022675736961,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "undo",\r\n        "url": "undo",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 872,\r\n        "end": 872.7648072562358,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "firework1",\r\n        "url": "firework1",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 445,\r\n        "end": 447.3219954648526,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "firework2",\r\n        "url": "firework2",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 449,\r\n        "end": 451.78639455782314,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "firework3",\r\n        "url": "firework3",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 453,\r\n        "end": 456.134693877551,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "firework4",\r\n        "url": "firework4",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 458,\r\n        "end": 459.8575963718821,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "win",\r\n        "url": "win",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 874,\r\n        "end": 878.2710204081633,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "winBounce",\r\n        "url": "KlondikeWinAnim2_B",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 132,\r\n        "end": 148.67192743764173,\r\n        "lazyload": true,\r\n        "loadgroup": "endgameanimation"\r\n    },\r\n    {\r\n        "id": "winButterfly",\r\n        "url": "ending_butterfly",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 403,\r\n        "end": 422.38721088435375,\r\n        "lazyload": true,\r\n        "loadgroup": "endgameanimation"\r\n    },\r\n    {\r\n        "id": "winKaleidoscope",\r\n        "url": "ending_kaleidoscope",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 424,\r\n        "end": 443.22467120181403,\r\n        "lazyload": true,\r\n        "loadgroup": "endgameanimation"\r\n    },\r\n    {\r\n        "id": "winFireworks",\r\n        "url": "KlondikeWinAnim3_B_Music",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 150,\r\n        "end": 175.7509297052154,\r\n        "lazyload": true,\r\n        "loadgroup": "endgameanimation"\r\n    },\r\n    {\r\n        "id": "gameOver",\r\n        "url": "GameOverPopUp_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 106,\r\n        "end": 109.50621315192744,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "dc_ribbonHit",\r\n        "url": "RibbonHit_A",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 252,\r\n        "end": 255.08825396825398,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "dc_coinsToBar",\r\n        "url": "CoinsFlyToBar_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 68,\r\n        "end": 74.29260770975057,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "CoinProgress_A",\r\n        "url": "CoinProgress_A",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 64,\r\n        "end": 66.8560544217687,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "dc_fly",\r\n        "url": "dcGoalFly_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 370,\r\n        "end": 372.7631746031746,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "sc_starUnlock",\r\n        "url": "StarUnlock_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 297,\r\n        "end": 297.92879818594105,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "sc_starFlying",\r\n        "url": "StarsFlying_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 299,\r\n        "end": 305.59446712018143,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "sc_starFlying_isolated",\r\n        "url": "StarsFlying_D_Gliss",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 307,\r\n        "end": 313.59446712018143,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "sc_starLand",\r\n        "url": "StarsLand_F",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 315,\r\n        "end": 317.73995464852607,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "CrownAppearance",\r\n        "url": "CrownAppearance",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 76,\r\n        "end": 81.45668934240362,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "ui_kickOffClose",\r\n        "url": "ui_collapsing",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 870,\r\n        "end": 870.835918367347,\r\n        "lazyload": true,\r\n        "loadgroup": "challenge"\r\n    },\r\n    {\r\n        "id": "music_theme_aquarium",\r\n        "url": "theme_aquarium",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 523,\r\n        "end": 551.6534240362812,\r\n        "lazyload": true,\r\n        "loadgroup": "music_theme_aquarium"\r\n    },\r\n    {\r\n        "id": "music_theme_autumn",\r\n        "url": "theme_autumn",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 553,\r\n        "end": 623.6351020408163,\r\n        "lazyload": true,\r\n        "loadgroup": "music_theme_autumn"\r\n    },\r\n    {\r\n        "id": "music_theme_beach",\r\n        "url": "theme_beach",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 625,\r\n        "end": 687.5313378684807,\r\n        "lazyload": true,\r\n        "loadgroup": "music_theme_beach"\r\n    },\r\n    {\r\n        "id": "music_theme_fable",\r\n        "url": "theme_fable",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 689,\r\n        "end": 771.7326984126984,\r\n        "lazyload": true,\r\n        "loadgroup": "music_theme_fable"\r\n    },\r\n    {\r\n        "id": "music_theme_western",\r\n        "url": "theme_western",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 773,\r\n        "end": 863.0005442176871,\r\n        "lazyload": true,\r\n        "loadgroup": "music_theme_western"\r\n    },\r\n    {\r\n        "id": "button",\r\n        "url": "button",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 330,\r\n        "end": 330.16108843537415,\r\n        "lazyload": false,\r\n        "loadgroup": "init"\r\n    },\r\n    {\r\n        "id": "wildCard",\r\n        "url": "WildCardUse_D",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 319,\r\n        "end": 321.3219954648526,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "cardOnWildCard",\r\n        "url": "CardOnWildCard_F",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 59,\r\n        "end": 60.74149659863946,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "peak1",\r\n        "url": "peak_clear_1",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 475,\r\n        "end": 478.13467120181406,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "peak2",\r\n        "url": "peak_clear_2",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 480,\r\n        "end": 483.11002267573696,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "peak3",\r\n        "url": "peak_clear_3",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 485,\r\n        "end": 488.00666666666666,\r\n        "lazyload": true,\r\n        "loadgroup": "tripeaks"\r\n    },\r\n    {\r\n        "id": "perfect",\r\n        "url": "peak_perfect",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 490,\r\n        "end": 494.2710204081633,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "row1",\r\n        "url": "RowClear_1",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 257,\r\n        "end": 259.9939229024943,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row2",\r\n        "url": "RowClear_2",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 261,\r\n        "end": 264.01714285714286,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row3",\r\n        "url": "RowClear_3",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 266,\r\n        "end": 269.01714285714286,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row4",\r\n        "url": "RowClear_4",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 271,\r\n        "end": 274.52798185941043,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row5",\r\n        "url": "RowClear_5",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 276,\r\n        "end": 279.0403628117914,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row6",\r\n        "url": "RowClear_6",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 281,\r\n        "end": 284.01714285714286,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "row7",\r\n        "url": "RowClear_7",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 286,\r\n        "end": 289.01714285714286,\r\n        "lazyload": true,\r\n        "loadgroup": "pyramid"\r\n    },\r\n    {\r\n        "id": "flipCard",\r\n        "url": "card_flip",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 334,\r\n        "end": 334.34684807256235,\r\n        "lazyload": true,\r\n        "loadgroup": "game"\r\n    },\r\n    {\r\n        "id": "completeStack_chime",\r\n        "url": "stack_complete",\r\n        "loop": false,\r\n        "volume": 100,\r\n        "start": 514,\r\n        "end": 515.2059863945578,\r\n        "lazyload": true,\r\n        "loadgroup": "spider"\r\n    }\r\n]\r\n'}),define("audiosprites",["text!audiosprites.json"],function(t){return JSON.parse(t)}),define("text!artassets.json",[],function(){return'[\r\n    {\r\n        "name": "loading",\r\n        "format": "png"\r\n    },\r\n    {\r\n        "name": "menu",\r\n        "format": "png"\r\n    },\r\n    {\r\n        "name": "fue",\r\n        "format": "png"\r\n    },\r\n    {\r\n        "name": "menu_bg",\r\n        "format": "jpg"\r\n    },\r\n    {\r\n        "name": "dc_menu",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "shared",\r\n        "format": "png"\r\n    },\r\n    {\r\n        "name": "dailychallenge",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "dailychallenge_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "dialogs",\r\n        "format": "png"\r\n    },\r\n    {\r\n        "name": "segoe1",\r\n        "format": "png",\r\n        "type": "font"\r\n    },\r\n    {\r\n        "name": "segoe2",\r\n        "format": "png",\r\n        "type": "font"\r\n    },\r\n    {\r\n        "name": "segoe2_large_digit",\r\n        "format": "png",\r\n        "type": "font"\r\n    },\r\n    {\r\n        "name": "classic",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "classic_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "aquarium",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "autumn",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "fable",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "beach",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "western",\r\n        "format": "png",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "fable_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "aquarium_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "autumn_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "beach_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "western_bg",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n\r\n    },\r\n    {\r\n        "name": "htp_klondike",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_spider",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_freecell",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_pyramid",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_tripeaks",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_dailychallenge",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    },\r\n    {\r\n        "name": "htp_starclub",\r\n        "format": "jpg",\r\n        "lazyload": true\r\n    }\r\n\r\n]\r\n'}),define("artassets",["text!artassets.json"],function(t){return JSON.parse(t)}),function(t){var e={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,i){var n="string"==typeof t.initial?{state:t.initial}:t.initial,r=t.terminal||t.final,o=i||t.target||{},a=t.events||[],s=t.callbacks||{},l={},h=function(t){var i=t.from instanceof Array?t.from:t.from?[t.from]:[e.WILDCARD];l[t.name]=l[t.name]||{};for(var n=0;n<i.length;n++)l[t.name][i[n]]=t.to||i[n]};n&&(n.event=n.event||"startup",h({name:n.event,from:"none",to:n.state}));for(var u=0;u<a.length;u++)h(a[u]);for(var d in l)l.hasOwnProperty(d)&&(o[d]=e.buildEvent(d,l[d]));for(var d in s)s.hasOwnProperty(d)&&(o[d]=s[d]);return o.current="none",o.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},o.can=function(t){return!this.transition&&(l[t].hasOwnProperty(this.current)||l[t].hasOwnProperty(e.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.error=t.error||function(t,e,i,n,r,o,a){throw a||o},o.isFinished=function(){return this.is(r)},n&&!n.defer&&o[n.event](),o},doCallback:function(t,i,n,r,o,a){if(i)try{return i.apply(t,[n,r,o].concat(a))}catch(i){return t.error(n,r,o,a,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",i)}},beforeAnyEvent:function(t,i,n,r,o){return e.doCallback(t,t.onbeforeevent,i,n,r,o)},afterAnyEvent:function(t,i,n,r,o){return e.doCallback(t,t.onafterevent||t.onevent,i,n,r,o)},leaveAnyState:function(t,i,n,r,o){return e.doCallback(t,t.onleavestate,i,n,r,o)},enterAnyState:function(t,i,n,r,o){return e.doCallback(t,t.onenterstate||t.onstate,i,n,r,o)},changeState:function(t,i,n,r,o){return e.doCallback(t,t.onchangestate,i,n,r,o)},beforeThisEvent:function(t,i,n,r,o){return e.doCallback(t,t["onbefore"+i],i,n,r,o)},afterThisEvent:function(t,i,n,r,o){return e.doCallback(t,t["onafter"+i]||t["on"+i],i,n,r,o)},leaveThisState:function(t,i,n,r,o){return e.doCallback(t,t["onleave"+n],i,n,r,o)},enterThisState:function(t,i,n,r,o){return e.doCallback(t,t["onenter"+r]||t["on"+r],i,n,r,o)},beforeEvent:function(t,i,n,r,o){if(!1===e.beforeThisEvent(t,i,n,r,o)||!1===e.beforeAnyEvent(t,i,n,r,o))return!1},afterEvent:function(t,i,n,r,o){e.afterThisEvent(t,i,n,r,o),e.afterAnyEvent(t,i,n,r,o)},leaveState:function(t,i,n,r,o){var a=e.leaveThisState(t,i,n,r,o),s=e.leaveAnyState(t,i,n,r,o);return!1!==a&&!1!==s&&(e.ASYNC===a||e.ASYNC===s?e.ASYNC:void 0)},enterState:function(t,i,n,r,o){e.enterThisState(t,i,n,r,o),e.enterAnyState(t,i,n,r,o)},buildEvent:function(t,i){return function(){var n=this.current,r=i[n]||i[e.WILDCARD]||n,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,n,r,o,e.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,n,r,o,e.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,t,n,r,o))return e.Result.CANCELLED;if(n===r)return e.afterEvent(this,t,n,r,o),e.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=r,e.enterState(a,t,n,r,o),e.changeState(a,t,n,r,o),e.afterEvent(a,t,n,r,o),e.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,e.afterEvent(a,t,n,r,o)};var s=e.leaveState(this,t,n,r,o);return!1===s?(this.transition=null,e.Result.CANCELLED):e.ASYNC===s?e.Result.PENDING:this.transition?this.transition():void 0}}};"function"==typeof define?define("state-machine",["require"],function(t){return e}):t.StateMachine=e}(this),define("dependencies/libs/ninepatch/ninepatch",["pixi"],function(t){return t.NinePatch=function(e,i,n,r){t.DisplayObjectContainer.call(this),this.scaleMode=r||t.NinePatch.scaleModes.NINEPATCH,this.targetWidth=e,this.targetHeight=i,this.loaded=0,this.updateCallback=null,this.readyCallback=null;this.onTextureUpdateBind=this.onTextureUpdate.bind(this);for(var o=0;o<9;o++)this.addChild(n[o]),this.children[o].texture.baseTexture.hasLoaded?this.loaded++:this.children[o].texture.on("update",this.onTextureUpdateBind);this.children[2].anchor.set(1,0),this.children[5].anchor.set(1,0),this.children[6].anchor.set(0,1),this.children[7].anchor.set(0,1),this.children[8].anchor.set(1,1),this.head=this.children[1],this.body=this.children[4],this.loaded<9?this.alpha=0:this.update()},t.NinePatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.NinePatch.prototype.constructor=t.NinePatch,t.NinePatch.scaleModes={DEFAULT:1,NINEPATCH:2},Object.defineProperty(t.NinePatch.prototype,"width",{get:function(){return this.scaleMode===t.NinePatch.scaleModes.DEFAULT?this.scale.x*this.getLocalBounds().width:this.scale.x*this.targetWidth},set:function(e){if(this.scaleMode===t.NinePatch.scaleModes.DEFAULT){var i=this.getLocalBounds().width;this.scale.x=0!==i?e/(i/this.scale.x):1,this._width=e}else this.update(e,this.targetHeight)}}),Object.defineProperty(t.NinePatch.prototype,"height",{get:function(){return this.scaleMode===t.NinePatch.scaleModes.DEFAULT?this.scale.y*this.getLocalBounds().height:this.scale.y*this.targetHeight},set:function(e){
if(this.scaleMode===t.NinePatch.scaleModes.DEFAULT){var i=this.getLocalBounds().height;this.scale.y=0!==i?e/(i/this.scale.y):1,this._height=e}else this.update(this.targetWidth,e)}}),t.NinePatch.prototype.onUpdate=function(t){return this.updateCallback=t,this},t.NinePatch.prototype.onReady=function(t){return 9===this.loaded?t():this.readyCallback=t,this},t.NinePatch.prototype.update=function(t,e){if(void 0!==t&&(this.targetWidth=t),void 0!==e&&(this.targetHeight=e),9===this.loaded){var i;i=this.children[1],i.position.set(this.children[0].width,0),i.width=this.targetWidth-i.x-this.children[2].width,i=this.children[2],i.position.set(this.targetWidth,0),i=this.children[3],i.position.set(0,this.children[0].height),i.height=this.targetHeight-i.y-this.children[6].height,i=this.children[4],i.position.set(this.children[1].x,this.children[3].y),i.height=this.children[3].height,i.width=this.children[1].width,i=this.children[5],i.position.set(this.targetWidth,this.children[3].y),i.height=this.children[3].height,i=this.children[6],i.position.set(0,this.targetHeight),i=this.children[7],i.position.set(this.children[1].x,this.targetHeight),i.width=this.children[1].width,i=this.children[8],i.position.set(this.targetWidth,this.targetHeight),this.updateCallback&&this.updateCallback()}},t.NinePatch.prototype.onTextureUpdate=function(){9==++this.loaded&&(this.alpha=1,this.update(),this.readyCallback&&(this.readyCallback(),this.readyCallback=null))},t.NinePatch}),define("util/NineSliceWrapper",["dependencies/libs/ninepatch/ninepatch","pixi"],function(t,e){var i=function(i,n,r,o,a,s,l){var h=new e.Sprite(e.Texture.fromFrame(i));this.originTexture=h.generateTexture(),this.frame=i;var u=this.originTexture.width-a-o,d=this.originTexture.width-a;this.topLeftSprite=this.createCroppedSprite(0,0,o,s),this.topCenterSprite=this.createCroppedSprite(o,0,u,s),this.topRightSprite=this.createCroppedSprite(d,0,a,s);var c=this.originTexture.height-s-l;this.middleLeftSprite=this.createCroppedSprite(0,s,o,c),this.middleCenterTexture=this.createCroppedSprite(o,s,u,c),this.middleRightSprite=this.createCroppedSprite(d,s,a,c);var p=this.originTexture.height-l;this.bottomLeftSprite=this.createCroppedSprite(0,p,o,l),this.bottomCenterSprite=this.createCroppedSprite(o,p,u,l),this.bottomRightSprite=this.createCroppedSprite(d,p,a,l),this.layers=[],this.layers.push.apply(this.layers,[this.topLeftSprite,this.topCenterSprite,this.topRightSprite,this.middleLeftSprite,this.middleCenterTexture,this.middleRightSprite,this.bottomLeftSprite,this.bottomCenterSprite,this.bottomRightSprite]),t.call(this,n,r,this.layers)};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.createCroppedSprite=function(t,i,n,r){var o,a,s=new e.Texture(this.originTexture.baseTexture,this.frame);return o=new e.Rectangle(t,i,n,r),a=new e.Texture(s,o),new e.Sprite(a)},i}),define("util/list",["lodash"],function(t){var e=function(){this.initList()};return e.prototype.initList=function(){this.items=[]},e.prototype.add=function(t){-1==this.items.indexOf(t)&&this.items.push(t)},e.prototype.remove=function(t){var e=this.items.indexOf(t);-1!=e&&this.items.splice(e,1)},e.prototype.clear=function(){this.items=[]},e.prototype.applyAll=function(e){"function"==typeof visitor&&t.forEach(this.items,function(t){visitor(t)})},e}),define("util/eventhandler",["util/list"],function(t){var e=function(){this.initEventHandler()};return e.constructor=e,e.prototype=Object.create(t.prototype),e.prototype.initEventHandler=function(){t.call(this)},e.prototype.handleEvent=function(t,e){for(var i=0;i<this.items.length;i++){var n=this.items[i];"function"==typeof n&&n(t,e)}},e.prototype.add=function(e){t.prototype.add.call(this,e)},e}),define("util/NineSliceButton",["pixi","util/NineSliceWrapper","absolute","util/eventhandler"],function(t,e,i,n){var r=function(i,r,o,a,s,l,h,u,d,c,p){this.upTexture=new e(o,a,s,l,h,u,d).generateTexture(),this.downTexture=new e(i,a,s,l,h,u,d).generateTexture(),this.overTexture=new e(r,a,s,l,h,u,d).generateTexture(),this.interactive=!0,this.onClick=new n,t.Sprite.call(this,this.upTexture),this.bindListeners(),c&&p&&this.initLabel(c,p),this.hasFocus=!1};return r.prototype=Object.create(t.Sprite.prototype),r.prototype.constructor=r,r.prototype.bindListeners=function(){this.interactive=!0,this.buttonMode=!0,i.Platform.supportsTouch()?(this.bindTouchEvents(),(i.Platform._isWindows()||i.Platform._isMac()&&!i.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},r.prototype.bindTouchEvents=function(){this.touchstart=function(t){this.setTexture(this.downTexture)},this.touchend=function(t){this.setTexture(this.upTexture),this.handleInputUp()},this.touchendoutside=function(t){this.setTexture(this.upTexture)}},r.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.overTexture)},this.mouseout=function(t){this.setTexture(this.upTexture)},this.mousedown=function(t){this.setTexture(this.downTexture)}.bind(this),this.mouseup=function(t){this.setTexture(this.upTexture),this.handleInputUp()}.bind(this)},r.prototype.initLabel=function(e,n){var r={font:n.font,fontFamily:n.fontFamily,fill:n.fill,align:n.align?n.align:"left"},e=new t.Text(e,r);i.StringManager.shrinkToFit(e,i.StringManager.extractNumbersFromString(n.font),"",this.width-i.Coords.x(20)),this.addChild(e),n.anchor&&e.anchor.set(n.anchor.x,n.anchor.y),e.position.set(n.x,n.y)},r.prototype.handleInputUp=function(){i.AudioManager.playSound("button"),this.onClick.handleEvent(this)},r.prototype.handleActivate=function(){i.AudioManager.playSound("button"),this.onClick.handleEvent(this)},r.prototype._focusChanged=function(){this.hasFocus?this.setTexture(this.overTexture):this.setTexture(this.upTexture)},Object.defineProperty(r.prototype,"focus",{get:function(){return this.hasFocus},set:function(t){return this.hasFocus=t,this._focusChanged(),t}}),r}),define("MenuUI/LoadingScreen",["pixi","absolute","lodash","absolute/stringmanager","Managers/ScaleManager","util/NineSliceButton"],function(t,e,i,n,r,o){var a=function(t){this.initLoadingScreen(t)};return a.prototype=Object.create(e.Screen.prototype),a.prototype.initLoadingScreen=function(i){t.DisplayObjectContainer.call(this),this.ui=i;var o=new t.Graphics;o.beginFill(996970),o.drawRect(0,0,1e4,1e4),o.endFill(),o.interactive=!0,o.buttonMode=!0,o.hitArea=new t.Rectangle(0,0,this.ui.width,this.ui.height),e.SpriteUtils.bindInteraction(o,function(){}),o.mouseup=function(){},this.addChild(o),this.spinner=e.SpriteUtils.loadMovieClip("solitaire loading00",30,1),this.spinner.loop=!0,this.spinner.animationSpeed=.5,this.spinner.scale.set(1),this.addChild(this.spinner),this.loadingTextStyle={font:55*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"};var a=new t.Text(n("loading"),this.loadingTextStyle);a.anchor.set(.5,0),this.loadingText=a,this.addChild(a),r.addElement(this,{scaleChangeSource:"Full"})},a.prototype.show=function(t){this.spinner.play(),this.visible=!0,this.handleResize(),t&&(this.longLoadTimeout=window.setTimeout(function(){this.show(!1)}.bind(this),4e3))},a.prototype.hide=function(){this.spinner.gotoAndStop(0),this.visible=!1,window.clearTimeout(this.longLoadTimeout)},a.prototype.start=function(){this.show(),this.spinner.gotoAndStop(0);e.ScreenMetrics.getResScale(),e.Coords.x(0),e.Coords.y(3);this.loadingText.visible=!1},a.prototype.resetLoadingProgress=function(){},a.prototype.finishLoadingProgress=function(){},a.prototype.updateLoadingProgress=function(t){e.Debug.log("loading ",t)},a.prototype.onShow=function(){e.Screen.prototype.onShow.call(this)},a.prototype.onHide=function(){e.Screen.prototype.onHide.call(this)},a.prototype.handleResize=function(){this.scale.set(1/r.scaleFactorX,1/r.scaleFactorY),this.resizeSpinner(),this.resizeLoadingText()},a.prototype.resizeSpinner=function(){this.spinner.y=(e.Coords.y(r.height)-this.spinner.height)/2,this.spinner.x=(e.Coords.x(r.width)-this.spinner.width)/2},a.prototype.resizeLoadingText=function(){this.loadingText.y=this.spinner.y-this.loadingText.height-e.Coords.x(5),this.loadingText.x=this.spinner.x+this.spinner.width/2},a.prototype.resizeText=function(t,e,i){var r=n.extractNumbersFromString(i.font);this.loadingText.width>t||this.loadingText.height>e?n.shrinkToFit(this.loadingText,r,"",t,e):n.enlargeText(this.loadingText,r,"",t,e)},a}),define("Solitaire/SolitaireGameMode",["lodash"],function(t){return{Spider:0,FreeCell:1,Pyramid:2,TriPeaks:3,Klondike:4,Unknown:5,DailyChallenge:6,StarClub:7,getModeById:function(e){var i="";return t.each(this,function(t,n){t==e&&(i=n)}),i},getModeNameByIndex:function(e){var i="";return t.each(this,function(t,n){t===e&&(i=n)}),i}}}),define("MenuUI/LoadingSingleScreen",["pixi","absolute","lodash","absolute/stringmanager","Managers/ScaleManager","Solitaire/SolitaireGameMode"],function(t,e,i,n,r,o){var a=function(t,e){this.ui=t,this.game=e,this.gameMode=this.game.config.singleGame.mode,this.initLoadingSingleScreen(t)};return a.prototype=Object.create(e.Screen.prototype),a.prototype.initLoadingSingleScreen=function(i){e.Screen.call(this),this.ui=i;var o=e.ScreenMetrics.getResClass(),a=this.ui.container.children[2];if(this.initForceScaleSprite(),this.bgIsLoaded=!1,!this.bgIsLoaded&&a){var s=new Image;s.onload=function(){a.style.backgroundImage="url("+s.src+")",a.className+=" main-canvas",a.style.backgroundSize="cover",this.bgIsLoaded=!0,this.gameLabel=new t.Text(n("headings."+this.gameMode),{font:100*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",align:"center",fill:"#ffffff",dropShadow:!0,dropShadowColor:"#000000",dropShadowDistance:5}),this.gameLabel.anchor.set(.5,.5),this.gameLabel.position.set(e.Coords.x(960),e.Coords.y(240)),this.addChild(this.gameLabel),this.tile=t.Sprite.fromFrame(this.gameMode.toLowerCase()+"/tile.png"),this.tile.anchor.set(.5,.5),this.addChild(this.tile),this.tile.position.set(e.Coords.x(960),e.Coords.y(540)),this.bar=t.Sprite.fromFrame("bar.png"),this.addChild(this.bar),this.bar.anchor.set(.5,.5),this.bar.position.set(this.tile.x+e.Coords.x(5),this.tile.y+e.Coords.y(240)),this.fill=t.Sprite.fromFrame(this.gameMode.toLowerCase()+"/fill.png"),this.addChild(this.fill),this.fill.anchor.set(.5,.5),this.fill.position.set(this.bar.x,this.bar.y),this.maskOfFill=new t.Graphics,this.maskOfFill.position.set(this.fill.x-this.fill.width/2,this.fill.y-this.fill.height/2),this.maskOfFill.beginFill(3407616,.7),this.maskOfFill.drawRect(0,0,this.fill.width,this.fill.height),this.maskOfFill.endFill(),this.addChild(this.maskOfFill),this.fill.mask=this.maskOfFill,this.maskOfFill.scale.x=0,this.handleResize()}.bind(this),s.src="./spritesheets/"+o+"/menu_bg.jpg"}r.addElement(this,{scaleChangeSource:"Full"})},a.prototype.show=function(t){this.visible=!0},a.prototype.hide=function(){this.visible=!1},a.prototype.updateLoadingProgress=function(t,e){if(this.bgIsLoaded&&!this.loadIsDone){var i=this.maskOfFill;this.scaleTween&&this.scaleTween.stop(),this.scaleTween=new TWEEN.Tween({x:this.maskOfFill.scale.x}).to({x:t},e?500:2e3).easing(TWEEN.Easing.Quadratic.In).onUpdate(function(){i.scale.x=this.x}).onComplete(function(){this.scaleTween=null}.bind(this)).start()}},a.prototype.resetLoadingProgress=function(){this.bgIsLoaded&&(this.maskOfFill.scale.x=0,this.loadIsDone=!1)},a.prototype.finishLoadingProgress=function(){this.bgIsLoaded&&(this.updateLoadingProgress(1,!0),this.loadIsDone=!0)},a.prototype.onShow=function(){e.Screen.prototype.onShow.call(this)},a.prototype.onHide=function(){e.Screen.prototype.onHide.call(this)},a.prototype.initForceScaleSprite=function(){var i=new t.Graphics;i.beginFill(16711680,.3),i.drawRect(0,0,e.Coords.x(1920),e.Coords.y(1080)),i.endFill(),this.forceScaleSprite=new t.Sprite(i.generateTexture()),this.forceOffsetX=e.Coords.x(0),this.forceOffsetY=e.Coords.y(0),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},a.prototype.handleResize=function(){if(this.bgIsLoaded){this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,o=this.height;this.scale.set(t,i);var a=e.Coords.x(1920)/r.width,s=e.Coords.y(1080)/r.height,l=r.width,h=r.height;this.width=n*a,this.height=o*s;var u=this.width/a,d=this.height/s,c=n,p=o,g=!1;if(u>l){this.width=e.Coords.x(1920);var f=l/c;if(this.height=o*s*f,this.height/s>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*a*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*a*f,this.width/a>l){this.width=e.Coords.x(1920);var f=l/c;this.height=o*s*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY}},a}),define("util/RegularButton",["pixi","absolute","util/eventhandler"],function(t,e,i){var n=function(e,n,r,o,a){this.upTexture=new t.Sprite.fromFrame(r).generateTexture(),this.downTexture=new t.Sprite.fromFrame(e).generateTexture(),this.overTexture=new t.Sprite.fromFrame(n).generateTexture(),this.interactive=!0,this.onClick=new i,t.Sprite.call(this,this.upTexture),this.bindListeners(),o&&a&&this.initLabel(o,a)};return n.prototype=Object.create(t.Sprite.prototype),n.prototype.constructor=n,n.prototype.bindListeners=function(){this.interactive=!0,this.buttonMode=!0,e.Platform.supportsTouch()?(this.bindTouchEvents(),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},n.prototype.bindTouchEvents=function(){this.touchstart=function(t){this.setTexture(this.downTexture)},this.touchend=function(t){this.setTexture(this.upTexture),this.handleInputUp()},this.touchendoutside=function(t){this.setTexture(this.upTexture)}},n.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.overTexture)},this.mouseout=function(t){this.setTexture(this.upTexture)},this.mousedown=function(t){this.setTexture(this.downTexture)}.bind(this),this.mouseup=function(t){this.setTexture(this.upTexture),this.handleInputUp()}.bind(this)},n.prototype.initLabel=function(e,i){var n={font:i.font,fontFamily:i.fontFamily,fill:i.fill,align:i.align?i.align:"left"},e=new t.Text(e,n);this.addChild(e),i.anchor&&e.anchor.set(i.anchor.x,i.anchor.y),e.position.set(i.x,i.y)},n.prototype.handleInputUp=function(){e.AudioManager.playSound("button"),this.onClick.handleEvent(this)},n}),define("Managers/ChallengeManager",["absolute/storagemanager"],function(t){"use strict";return{_storageKey:"ChallengeManagerStore",_cache:null,_dupeList:["5fb4bf8-a71c-41eb-a947-466dc32cca5d","744350d3-36f2-4b27-a14c-ab823112853f","d8b84c76-86f5-4071-a5f6-7b1395336c8c","23cc01ac-83a3-4fca-ae25-7525a871f85b","75fb4bf8-a71c-41eb-a947-466dc32cca5d"],_dupeTrack:{},StoreChallenge:function(e){this._cache||(this._cache=t.fetch(this._storageKey),this._cache||(this._cache={}));var i=e.Key||e.ID;return this._cache[i]?-1!=this._dupeList.indexOf(i)&&(this._cache[i+"_ALLOW_DUPE"]||(i+="_ALLOW_DUPE",e.Key=i,this._cache[i]=e)):this._cache[i]=e,i},StoreChallengePack:function(e){this._cache||(this._cache=t.fetch(this._storageKey),this._cache||(this._cache={})),this._cache[e.ID]||(this._cache[e.ID]=e)},Sync:function(){t.store(this._storageKey,this._cache)},SetChallengePlayed:function(e,i){var n=this._cache[e];n&&(n.Played=i,t.store(this._storageKey,this._cache))},IsChallengePlayed:function(t){var e=this._cache[t];return!!e&&(e.Played||!1)},SetChallengeCompleted:function(e,i){var n=this._cache[e];n&&(n.Completed=i,t.store(this._storageKey,this._cache))},IsChallengeCompleted:function(t){var e=this._cache[t];return!!e&&e.Completed},GetChallengeConfig:function(e){return this._cache||(this._cache=t.fetch(this._storageKey),this._cache||(this._cache={})),this._cache[e]},IsChallengePackUnlocked:function(t){var e=this._cache[t];return!!e&&(e.Unlocked||!1)},SetChallengePackUnlocked:function(e,i){var n=this._cache[e];n&&(n.Unlocked=i,t.store(this._storageKey,this._cache))},GetChallengePackConfig:function(t){return this._cache[t]},IsChallengeCollectionUnlocked:function(t){var e=this._cache[t];return!!e&&(e.Unlocked||!1)},SetChallengeCollectionUnlocked:function(e,i){var n=this._cache[e];n&&(n.Unlocked=i,t.store(this._storageKey,this._cache))},GetChallengeCollectionConfig:function(t){return this._cache[t]}}}),define("CardUI/IChallengeDefinition",["lodash","absolute","Managers/ChallengeManager"],function(t,e,i){"use strict";var n=function(t,e,i){this.initIChallengeDefinition(t,e,i)};return n.prototype.initIChallengeDefinition=function(e,i,n){this.AllowedTime=0,this.AllowedMoves=0,this.DealScript=null,this.ChallengeType=e,this.Parameters={},this.DeckSeeds=[],this.theme="dailychallenge",this.config=n,t.forEach(i,function(t,e){this.Parameters[e.toUpperCase()]||(this.Parameters[e.toUpperCase()]=t)},this),this.GoalDescription=this.GetGoalDescription(),this.ShortGoalDescription=this.GetShortGoalDescription(),this.DailyChallengeTileTitle=this.GetModeName()+": "+this.ShortGoalDescription,this.ChallengeIconUrl=this.GetChallengeIconUrl()},Object.defineProperty(n.prototype,"IsStarClub",{get:function(){return t.has(this.config,"PremiumMultiplier")}}),Object.defineProperty(n.prototype,"ChallengeName",{get:function(){return this.ShortGoalDescription},set:function(t){this.ShortGoalDescription=t}}),Object.defineProperty(n.prototype,"Coins",{get:function(){return this.config.Coins}}),Object.defineProperty(n.prototype,"Difficulty",{get:function(){return this.config.Difficulty}}),Object.defineProperty(n.prototype,"DifficultyName",{get:function(){return e.StringManager("difficulty",null,!0)[this.config.Difficulty-1]}}),Object.defineProperty(n.prototype,"Theme",{get:function(){return this.theme},set:function(t){this.theme=t}}),Object.defineProperty(n.prototype,"Completed",{get:function(){return i.IsChallengeCompleted(this.config.Key)},set:function(t){i.SetChallengeCompleted(this.config.Key,t)}}),Object.defineProperty(n.prototype,"Played",{get:function(){return i.IsChallengePlayed(this.config.Key)},set:function(t){i.SetChallengePlayed(this.config.Key,t)}}),n.prototype.ConstructAuthority=function(){},n.prototype.GetGoalDescription=function(){},n.prototype.GetShortGoalDescription=function(){},n.prototype.GetModeName=function(){},n.prototype.GetChallengeIconUrl=function(){},n.prototype.SetupOptionsForAuthority=function(t){if(t.IsChallenge){this.AllowedMoves>0&&(t.MovesAllowed=this.AllowedMoves),this.AllowedTime>0&&(t.StartingTime=this.AllowedTime),null!=this.DealScript&&t.SetDealScript(this.DealScript);for(var e=0;e<this.DeckSeeds.length;e++)t.DeckSeeds.push(this.DeckSeeds[e])}},n.prototype.ToDictionary=function(){var e={};e.CHDEF_ChallengeType=this.ChallengeType,e.CHDEF_AllowedTime=this.AllowedTime,e.CHDEF_AllowedMoves=this.AllowedMoves,e.CHDEF_ChallengeName=this.ChallengeName;for(var i=0;i<this.DeckSeeds.length;i++)e["CHDEF_DeckSeed#"+i]=this.DeckSeeds[i];return this.DeckSeeds.length<=1?e.CHDEF_DealScript=this.DealScript:e.CHDEF_DeckScript=this.DealScript,t.forEach(this.Parameters,function(t,i){e["PARAM_"+i]=t}),e},n.prototype.FromDictionaryInternal=function(t){this.AllowedMoves=parseInt(t.CHDEF_AllowedMoves),this.AllowedTime=parseInt(t.CHDEF_AllowedTime),this.ChallengeName=t.CHDEF_ChallengeName;for(var e=0;t["CHDEF_DeckSeed#"+e];)this.DeckSeeds.push(t["CHDEF_DeckSeed#"+e]),e++;t.CHDEF_DealScript&&(this.DealScript=t.CHDEF_DealScript),this.GoalDescription=this.GetGoalDescription(),this.ShortGoalDescription=this.GetShortGoalDescription(),this.DailyChallengeTileTitle=this.GetModeName()+": "+this.ShortGoalDescription,this.coins=parseInt(t.coins)},n.prototype.CompleteGoalLocString=function(t){var e=t;return this.AllowedTime>0&&(e+="_Time"),this.AllowedMoves>0&&(e+="_Moves"),e},n.prototype.GetTimeFormat=function(t){var e=new Date(1e3*t),i=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds();return(i>0?i+":":"")+(i>0?"0"+n+":":n+":")+(r<10?"0"+r:r)},n}),define("SolitaireShared/CardLogic/ChallengeConstants",{KeyScoreRequired:"SCOREREQUIRED",KeyBoardsToClear:"BOARDSTOCLEAR",KeyStacksRequired:"STACKSREQUIRED"}),define("SolitaireShared/CardLogic/CardValue",["lodash"],function(t){return{Values:{Joker:0,Ace:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9,Ten:10,Jack:11,Queen:12,King:13},IntMap:{0:"Joker",1:"Ace",2:"Two",3:"Three",4:"Four",5:"Five",6:"Six",7:"Seven",8:"Eight",9:"Nine",10:"Ten",11:"Jack",12:"Queen",13:"King"},getValue:function(e){var i=e;return t.isString(e)&&e.length>2?i=e[0].toUpperCase()+e.slice(1).toLowerCase():t.isString(e)&&(i=this.IntMap[e]),this.Values[i]}}}),define("SolitaireShared/CardLogic/CardColor",{None:0,Red:1,Black:2}),define("SolitaireShared/CardLogic/CardSuit",{None:0,Clubs:1,Diamonds:2,Hearts:3,Spades:4}),define("SolitaireShared/CardLogic/Card",["lodash","require","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardSuit"],function(t,e,i,n,r){var o=function(t,e,i,n,r){this.initCard(t,e,i,n,r)};return o.CardColor={None:0,Red:1,Black:2},o.NumSuits=4,o.ValueNamesShort=["JO","A","2","3","4","5","6","7","8","9","10","J","Q","K"],o.SuitNamesShort=["","C","D","H","S"],o.NameLookup={ACE:"Ace",2:"Two",TWO:"Two",3:"Three",THREE:"Three",4:"Four",FOUR:"Four",5:"Five",FIVE:"Five",6:"Six",SIX:"Six",7:"Seven",SEVEN:"Seven",8:"Eight",EIGHT:"Eight",9:"Nine",NINE:"Nine",10:"Ten",TEN:"Ten",JACK:"Jack",QUEEN:"Queen",KING:"King"},o.NumValues=13,o.prototype.initCard=function(t,e,i,n,r){this.Supply=t,this.Value=e,this.Suit=i,this.DeckNum=n,this.Sequence=r,this.Pile=null},Object.defineProperty(o.prototype,"Color",{get:function(){return this.Suit==r.Clubs||this.Suit==r.Spades?o.CardColor.Black:this.Suit==r.Diamonds||this.Suit==r.Hearts?n.Red:n.None}}),Object.defineProperty(o.prototype,"ValueNum",{get:function(){return this.Value}}),Object.defineProperty(o.prototype,"SuitNum",{get:function(){return this.Suit}}),o.prototype.GetThemeItem=function(){var t=o.SuitNamesShort[this.Suit];return(o.ValueNamesShort[this.Value]+t).toLowerCase()},o.prototype.ToString=function(){return this.CardNameShort()},o.prototype.CardNameShort=function(){var t;return this.Value==i.Values.Joker?(t=this.Suit,o.ValueNamesShort[this.Value]+t):(t=o.SuitNamesShort[this.Suit],o.ValueNamesShort[this.Value]+t)},o.prototype.CompareTo=function(t){return t instanceof o?this.Sequence-t.Sequence:0},o.GetSymbolStringFromShortName=function(t){var e=t.toUpperCase();switch(e[t.length-1]){case"D":return e.replace("D","♦");case"C":return e.replace("C","♣");case"H":return e.replace("H","♥");case"S":return e.replace("S","♠")}return e},o.GetShortValueString=function(t){return o.ValueNamesShort[t]},o.GetLongValueName=function(t){return o.NameLookup[t.toUpperCase()]},o}),define("Arkadium/GameEngine/Core/EngineManagers",["absolute/audiomanager","absolute/musicmanager"],function(t,e){var i={game:null,ui:null,startTime:0,totalGameTime:0,elapsedGameTime:0,Init:function(t,e){this.game=t,this.ui=e,this.startTime=Date.now(),this.totalGameTime=0,this.elapsedGameTime=0},Sounds:{PlaySound:function(e){t.playSound(e)},StopSound:function(e){t.stopSound(e)},UpdateSoundState:function(i,n){i=-1!==i?i:t.isSfxEnabled(),n=-1!==n?n:!e.isMuted(),e.setMuted(!n),t.setSfxEnabled(i)}},Display:{},Time:{Update:function(t){isNaN(t)||(i.elapsedGameTime=t,i.totalGameTime+=t)},ElapsedGameTime:{},TotalGameTime:{}}};return Object.defineProperty(i,"UI",{get:function(){return i.ui}}),Object.defineProperty(i.Time.ElapsedGameTime,"TotalSeconds",{get:function(){return i.elapsedGameTime/1e3}}),Object.defineProperty(i.Time.ElapsedGameTime,"TotalMilliseconds",{get:function(){return i.elapsedGameTime}}),Object.defineProperty(i.Time.ElapsedGameTime,"Milliseconds",{get:function(){return i.elapsedGameTime}}),Object.defineProperty(i.Time.TotalGameTime,"TotalSeconds",{get:function(){return i.totalGameTime/1e3}}),Object.defineProperty(i.Time.TotalGameTime,"TotalMilliseconds",{get:function(){return i.totalGameTime}}),Object.defineProperty(i.Time.TotalGameTime,"Milliseconds",{get:function(){return i.totalGameTime}}),Object.defineProperty(i.Display,"Width",{get:function(){return i.ui?i.ui.width:0}}),Object.defineProperty(i.Display,"Height",{get:function(){return i.ui?i.ui.height:0}}),i}),define("util/SettingsManager",["lodash","absolute","absolute/storagemanager"],function(t,e,i){return{localStorageBaseKey:"settings",defaultSettingsKey:"settingsDefault",settings:{},syncData:!0,load:function(){var t=i.fetch("options")[this.localStorageBaseKey];void 0===t&&(t=e.GameConfig.getVal("config")[this.defaultSettingsKey]),this.settings=t,this.syncData=!1,this.save()},setSetting:function(t,e,i){this.settings[t]||(this.settings[t]={}),this.settings[t][e]=i,this.syncData=!0,this.save()},getSetting:function(t,e){return this.syncData&&this.load(),this.settings[t]||(this.settings[t]={}),this.settings[t][e]},reset:function(){this.settings=e.GameConfig.getVal(this.defaultSettingsKey),this.save()},save:function(){e.GameConfig.setVal(this.localStorageBaseKey,this.settings)}}}),define("MenuUI/MsftButton",["pixi","absolute","lodash","absolute/stringmanager"],function(t,e,i,n){var r=function(t){this._initMsftButton(t)};return r.constructor=r,r.prototype=Object.create(t.Sprite.prototype),r.prototype._initMsftButton=function(i){this.options=i,this.container=new t.DisplayObjectContainer,this.upTexture=this._createTexture(this.options.threeSlice,"up"),this.overTexture=this._createTexture(this.options.threeSlice,"over"),this.downTexture=this._createTexture(this.options.threeSlice,"down"),t.Sprite.call(this,this.upTexture),this.interactive=!0,this.buttonMode=!0,this._hasFocus=!1,this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(1,16777215);var n=e.Coords.x(2);this.focusIndicator.drawRect(n,n,this.width-2*n,this.height-2*n),e.Platform.supportsTouch()?(this.touchstart=function(t){this.setTexture(this.downTexture)},this.touchend=function(t){this.setTexture(this.upTexture),this.handleAction()},this.touchendoutside=function(t){this.setTexture(this.upTexture)},(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},r.prototype.createBorder=function(){var i=new t.Graphics;return i.beginFill(this.options.border.color),i.drawRect(0,0,this.options.width+this.options.border.thickness+e.Coords.x(2),this.options.minHeight+this.options.border.thickness),i.endFill(),i},r.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.overTexture)},this.mouseout=function(t){this.setTexture(this.upTexture)},this.mousedown=function(t){this.setTexture(this.downTexture)}.bind(this),this.mouseup=function(t){this.setTexture(this.upTexture),this.handleAction()}.bind(this)},r.prototype.handleActivate=function(){this.handleAction()},r.prototype.handleAction=function(){e.AudioManager.playSound("button"),this.options.action()},r.prototype._createTexture=function(i,r){var o,a=new t.DisplayObjectContainer,s={width:this.options.width,height:this.options.height,minHeight:this.options.minHeight,images:{left:i.images.left,center:i.images.center,right:i.images.right}},l={font:this.options.letterStyle.font,align:"center",fill:this.options.letterStyle.fill};if(i.multistate){var h="";"down"===r?(h="_down",this.options.keepTintOnDown||(l.fill="#ffffff"==l.fill?"#1":"#ffffff",this.options.downFill&&(l.fill=this.options.downFill))):"over"===r&&(h="_hover"),s.images.left=i.images.left.split(".")[0]+h+".png",s.images.center=i.images.center.split(".")[0]+h+".png",s.images.right=i.images.right.split(".")[0]+h+".png"}o=new e.ThreeSlice(s),this.options&&this.options.minHeight&&(o.height=this.options.minHeight);var u,d=new t.Text(this.options.text,l),c=n.extractNumbersFromString(l.font);n.shrinkToFit(d,c,"",this.options.maxWidth);var p=new t.Sprite(d.generateTexture());if(p.anchor.x=p.anchor.y=.5,p.x=this.options.width/2,p.y=o.height/2+e.Coords.y(3),this.options.backgroundColor&&(o.tint=parseInt(this.options.backgroundColor)),this.options.border){var g=this.createBorder();o.x=g.x+(g.width-o.width)/2,o.y=g.y+(g.height-o.height)/2,p.x=o.x+o.width/2,p.y=o.y+e.Coords.y(2)+o.height/2,a.addChild(g)}return a.addChild(o),a.addChild(p),u=a.generateTexture(),o.destroy(),u},r.prototype.destroy=function(){},r.prototype._focusChanged=function(){this._hasFocus?(this.setTexture(this.overTexture),this.addChild(this.focusIndicator)):-1!=this.children.indexOf(this.focusIndicator)&&(this.setTexture(this.upTexture),this.removeChild(this.focusIndicator))},Object.defineProperty(r.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),r}),define("MenuUI/MsftToggleButton",["pixi","absolute","lodash"],function(t,e,i){var n=function(t){var n={text:"",setting:!1,letterStyle:{font:23*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},toggleOff:"toggle_switch_off.png",toggleOn:"toggle_switch_on.png",onLabel:"buttons.on",offLabel:"buttons.off",toggleDot:"toggle_dot.png"};this._initMsftToggleButton(i.extend(n,t))};return n.prototype=Object.create(t.DisplayObjectContainer.prototype),n.prototype.constructor=n,n.prototype._initMsftToggleButton=function(i){t.DisplayObjectContainer.call(this),this.options=i,this.on=this.options.setting,this.onLabel=e.StringManager(this.options.onLabel),this.offLabel=e.StringManager(this.options.offLabel),this.value=this.options.value,this.label=new t.Text(this.options.text,this.options.letterStyle),e.StringManager.shrinkToFit(this.label,e.StringManager.extractNumbersFromString(this.options.letterStyle.font),"",e.Coords.x(250)),this.addChild(this.label),this.offDisplay=this._createDisplay("off"),this.onDisplay=this._createDisplay("on"),this.offDisplay.y=this.onDisplay.y=""!==this.label.text.trim()?this.label.height+e.Coords.y(5):0,this.interactive=!0,this.buttonMode=!0,this._hasFocus=!1,this.focusIndicator=new t.Graphics,this.focusIndicator.clear(),this.focusIndicator.lineStyle(1,16777215);var n=e.Coords.x(4);this.focusIndicator.drawRect(-n,-n,this.offDisplay.width+2*n,this.offDisplay.height+2*n),this.focusIndicator.position.set(this.offDisplay.x,this.offDisplay.y),e.Platform.supportsTouch()?(this.touchstart=function(t){this.handleAction()},(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents(),this.updateState(this.on),this._height=this.height+e.Coords.y(12),this.hitArea=new t.Rectangle(0,0,1.2*this.width,1.2*this.height)},n.prototype.bindMouseEvents=function(){this.mousedown=function(t){return!1},this.mouseup=function(t){this.handleAction()}.bind(this)},n.prototype.handleAction=function(){e.AudioManager.playSound("button"),this.on=!this.on,this.updateState(this.on),this.options.action(this.options.settingPrefix,this.options.settingsKey,this.on)},n.prototype.updateState=function(t){this.options.setting=t,this.on=t,this.on?(-1!=this.children.indexOf(this.offDisplay)&&this.removeChild(this.offDisplay),this.addChild(this.onDisplay)):(-1!=this.children.indexOf(this.onDisplay)&&this.removeChild(this.onDisplay),this.addChild(this.offDisplay))},n.prototype._createDisplay=function(i){var n=new t.DisplayObjectContainer,r=t.Sprite.fromFrame("on"===i?this.options.toggleOn:this.options.toggleOff),o=new t.Text("off"===i?this.offLabel:this.onLabel,this.options.letterStyle),a=e.Coords.x(8),s=e.Coords.x(-2);if(r.x=e.Coords.x(4),o.x=r.x+r.width+e.Coords.x(10),r.y=(o.height-r.height)/2+e.Coords.y(3),o.y=e.Coords.y(6),n.addChild(r),n.addChild(o),"noDot"!==this.options.toggleDot){var l=t.Sprite.fromFrame(this.options.toggleDot);l.scale.set(1.4,1.4),l.y=r.y+(r.height-l.height)/2,l.x="on"===i?r.x+r.width-l.width-a:r.x+l.width+s}return"noDot"!==this.options.toggleDot&&n.addChild(l),n.addChild(o),new t.Sprite(n.generateTexture())},n.prototype.handleActivate=function(){this.handleAction()},n.prototype._focusChanged=function(){this._hasFocus?this.addChild(this.focusIndicator):-1!==this.children.indexOf(this.focusIndicator)&&this.removeChild(this.focusIndicator)},Object.defineProperty(n.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),n}),
define("MenuUI/ControlFocusManager",[],function(){"use strict";var t=function(){this.initControlFocusManager()};return t.prototype.initControlFocusManager=function(){this._controlList=[],this._currentControlIndex=-1,this.currentFocusGroup=null},t.prototype.getCurrentControl=function(){return this._currentControlIndex>=0&&this._currentControlIndex<this._controlList.length?this._controlList[this._currentControlIndex].control:null},t.prototype.addControl=function(t,e,i,n){this._controlList.push({control:t,active:e,focusGroup:i,index:n})},t.prototype.removeAllControls=function(){for(var t=0;t<this._controlList.length;t++)this._controlList[t].control.focus=!1,this._controlList[t].control.active=!1;this._controlList=[],this._currentControlIndex=-1,this.currentFocusGroup=null},t.prototype.removeControls=function(t){this._controlList=this._controlList.filter(function(e,i){return e.focusGroup!==t}.bind(this))},t.prototype.setControlActive=function(t,e){for(var i=0;i<this._controlList.length;i++)if(this._controlList[i].control==t){this._controlList[i].active=e;break}},t.prototype.sortActives=function(){var t=this._controlList.filter(function(t){return t.active}).sort(function(t,e){return t.index-e.index}),e=this._controlList.filter(function(t){return!t.active});this._controlList=t.concat(e)},t.prototype.setFocusGroup=function(t){if(this.currentFocusGroup!=t){this.currentFocusGroup=t;for(var e=0;e<this._controlList.length;e++)this._controlList[e].focusGroup==t?this._controlList[e].active=!0:this._controlList[e].active=!1;this.focusNextControl(1,!0)}},t.prototype.nextFocusGroup=function(){if(!this.currentFocusGroup||this._currentControlIndex<0)this.setFocusGroup(this._controlList[0].focusGroup);else for(var t=this._currentControlIndex;t<this._controlList.length;t++)if(this._controlList[t].focusGroup!==this.currentFocusGroup){this.setFocusGroup(this._controlList[t].focusGroup,!0);break}},t.prototype.prevFocusGroup=function(){if(!this.currentFocusGroup||this._currentControlIndex<0)this.setFocusGroup(this._controlList[0].focusGroup);else for(var t=this._currentControlIndex;t>=0;t--)if(this._controlList[t].focusGroup!=this.currentFocusGroup){this.setFocusGroup(this._controlList[t].focusGroup);break}},t.prototype.focusNextControl=function(t,e){for(var i,n,r=1===t?this._controlList.length-1:0,o=0;o<this._controlList.length;o++)this._controlList[o].active&&(n=o);this._currentControlIndex>=0&&this._currentControlIndex<this._controlList.length&&(r=this._currentControlIndex,this._controlList[this._currentControlIndex].control.focus=!1);do{if(this._currentControlIndex=this._currentControlIndex+t,!e&&(!this._controlList[this._currentControlIndex]||this._controlList[this._currentControlIndex]&&!this._controlList[this._currentControlIndex].active&&this._currentControlIndex>=n)){i=!0,this._currentControlIndex-=t;break}if(this._currentControlIndex<0?this._currentControlIndex=this._controlList.length-1:this._currentControlIndex>this._controlList.length-1&&(this._currentControlIndex=0),this._currentControlIndex===r)break}while(!this._controlList[this._currentControlIndex].active);var a=this._controlList[this._currentControlIndex];return a&&a.active&&(a.control.focus=!0,this.currentFocusGroup=a.focusGroup),i},t.prototype.activateCurrentControl=function(){this._currentControlIndex>=0&&this._controlList[this._currentControlIndex].control.handleActivate&&this._controlList[this._currentControlIndex].control.handleActivate()},t.prototype.unfocusCurrentControl=function(){this._currentControlIndex>=0&&(this._controlList[this._currentControlIndex].control.focus=!1,this._currentControlIndex=-1)},t.prototype.focusCurrentControl=function(){-1===this._currentControlIndex&&(this._currentControlIndex=0,this._controlList[this._currentControlIndex].control.focus=!0)},t.prototype.setFocusOnCurrentTile=function(t){if(this._controlList[this._currentControlIndex].control.focus=!1,t)for(var e=this._controlList.length-1;e>=0&&(this._controlList[e].focusGroup!==this.currentFocusGroup||(this._currentControlIndex=e,!this._controlList[this._currentControlIndex].active));e--);else for(var e=0;e<=this._controlList.length-1&&(this._controlList[e].focusGroup!==this.currentFocusGroup||(this._currentControlIndex=e,!this._controlList[this._currentControlIndex].active));e++);this._controlList[this._currentControlIndex].control.focus=!0,this.currentFocusGroup=this._controlList[this._currentControlIndex].focusGroup},t.prototype.getLastControl=function(){return this._controlList[this._controlList.length-1]},t.prototype.getFirstControl=function(){return this._controlList[0]},t}),define("MenuUI/TipDialog",["lodash","pixi","absolute/coords","absolute/screenmetrics","absolute/stringmanager","MenuUI/MsftButton","MenuUI/MsftToggleButton","MenuUI/ControlFocusManager","util/CustomWordWrapper","Managers/ScaleManager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(e,i,r,o){var a={text:"",letterStyle:{font:"bold "+20*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},buttonLetterStyle:{font:"bold "+24*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"}};this.initTipDialog(e,t.extend(a,i),r,o)};return d.constuctor=d,d.prototype=Object.create(e.DisplayObjectContainer.prototype),d.prototype.initTipDialog=function(t,u,d,c){e.DisplayObjectContainer.call(this);var p=r(t.TipId,t.Args);this.config=u;var g=new e.Text(p,this.config.letterStyle);g.style.wordWrap=!0,g.style.wordWrapWidth=i.x(480),g.x=i.x(30),g.y=i.y(20),this.message=p,this.labelText=g,this.addChild(g),l.doTextCustomWrap(g,r.extractNumbersFromString(g.style.font),"bold",i.x(500),i.y(90)),this.removeChild(g);var f=new e.Graphics;f.beginFill(0),f.drawRect(0,0,i.x(850),g.y+g.height+i.y(120)),f.endFill(),f.buttonMode=!1,f.interactive=!0,f.hitArea=new e.Rectangle(0,0,i.x(540),g.y+g.height+i.y(100)),f.mouseup=f.mousedown=f.touchstart=function(){},this.background=f,this.backgroundWidth=this.background.width,this.backgroundHeight=this.background.height;var y=new o({action:function(){"function"==typeof d&&d()}.bind(this),text:r("buttons.close"),width:i.x(156),height:i.y(45),minHeight:i.y(60),letterStyle:this.config.buttonLetterStyle,threeSlice:{multistate:!0,images:{left:"MS_3slice_btn_black_01.png",center:"MS_3slice_btn_black_02.png",right:"MS_3slice_btn_black_03.png"}}});this.addChild(f),y.y=this.background.y+this.background.height-y.height+i.x(10),this.closeButton=y;var m=new a({action:function(t,e,i){"function"==typeof c&&c(!i)}.bind(this),settingPrefix:"general",settingsKey:"showAlerts",text:"",setting:!1,letterStyle:{font:"bold "+16*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},toggleOff:"checkbox_off.png",toggleOn:"checkbox_on.png",onLabel:"buttons.doNotShowAgain",offLabel:"buttons.doNotShowAgain",toggleDot:"noDot"});this.doNotShowAlert=m,m.x=i.x(10),m.y=this.background.y+this.background.height-this.doNotShowAlert.height+i.x(10),this.addChild(g),this.addChild(y),this.addChild(m),this.controlFocusManager=new s,this.controlFocusManager.addControl(y,!0),this.controlFocusManager.addControl(m,!0),h.addElement(this,{scaleChangeSource:"Full"}),this.y=i.y(1080)-this.height-i.y(20)},d.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},d.prototype.updateText=function(t){this.labelText.text=t,this.labelText.updateText(),this.resizeText(this.background.width-i.x(40)*h.scaleFactorX,.3*this.background.height,this.config.letterStyle)},d.prototype.handleResize=function(){this.scale.set(1/h.scaleFactorX,1/h.scaleFactorY),this.resize(),this.y=h.height-this.background.height*h.scaleFactorY},d.prototype.resize=function(){if(u.Platform.isMobile())u.ScreenMetrics.isPortrait()?(this.resizeBackground(.785*h.width,200),this.resizeText(.785*h.width,.6*this.background.height,this.config.letterStyle)):(this.resizeBackground(.69*h.width,120),this.resizeText(.69*h.width,.4*this.background.height,this.config.letterStyle)),this.resizeDoNotShowAlert(),this.resizeCloseButton();else{if(h.scaleFactorX<=.4){this.resizeBackground(.7*h.width,i.x(500)*h.scaleFactorX),this.resizeDoNotShowAlert(!0),this.resizeCloseButton(!0)}else h.width<=this.backgroundWidth+i.x(20)?(this.resizeBackground(h.width-i.x(15),i.x(450)*h.scaleFactorX),this.resizeDoNotShowAlert(),this.resizeCloseButton()):(this.resizeBackground(this.backgroundWidth,this.backgroundHeight),this.resetScales());this.resizeText(this.background.width-i.x(40)*h.scaleFactorX,.3*this.background.height,this.config.letterStyle)}},d.prototype.resetScales=function(){this.doNotShowAlert.scale.set(1,1),this.closeButton.scale.set(1,1),this.closeButton.x=this.background.x+this.background.width-this.closeButton.width-i.x(15),this.closeButton.y=this.background.y+this.background.height-this.closeButton.height-i.x(15),this.doNotShowAlert.x=i.x(10),this.doNotShowAlert.y=this.background.y+this.background.height-this.doNotShowAlert.height-i.x(10)},d.prototype.resizeText=function(t,e,n){var o=r.extractNumbersFromString(n.font);this.labelText.width>t||this.labelText.height>e?r.shrinkToFit(this.labelText,o,"",t,e):r.enlargeText(this.labelText,o,"",t,e),this.labelText.style.wordWrap=!0,this.labelText.style.wordWrapWidth=t-2*i.x(30),this.labelText.x=this.background.x+i.x(30),this.labelText.y=this.background.y+i.x(20)},d.prototype.resizeDoNotShowAlert=function(){var t=2*Math.max(.2,h.scaleFactorX);u.Platform.isMobile()&&u.ScreenMetrics.isPortrait()&&(t=.7),this.doNotShowAlert.scale.set(t,t),this.doNotShowAlert.y=this.background.y+this.background.height-this.doNotShowAlert.height-i.y(10)},d.prototype.resizeCloseButton=function(t){var e=t?2.5*Math.max(.2,h.scaleFactorX):2*Math.max(.2,h.scaleFactorX);this.closeButton.scale.set(e,e),this.closeButton.y=this.background.y+this.background.height-this.closeButton.height-i.x(15),this.closeButton.x=this.background.x+this.background.width-this.closeButton.width-i.x(15)},d.prototype.resizeBackground=function(t,e){this.background.width=t,this.background.height=e},d.prototype.removeScaling=function(){this.visible=!1,h.removeElement(this)},d}),define("util/TipManager",["absolute/stringmanager","absolute/coords","util/SettingsManager","MenuUI/TipDialog","Managers/ScaleManager"],function(t,e,i,n,r){"use strict";return{ui:null,game:null,settingsManager:null,init:function(t,e,n){this.ui=t,this.game=e,this.gameScreenUI=n,this.settingsManager=i,this.dialogShowing=!1},tryShowTip:function(i){if(this.settingsManager.getSetting("general","showAlerts")&&!this.game.solitaire.Authority.IsChallenge){var r=!1;this.tipDialog&&(window.clearTimeout(this.hideTimer),r=!0);var o=t(i.TipId,i.Args);if(r)this.dialogShowing=!0,o!==this.tipDialog.text&&(this.tipDialog.updateText(o),this.tipDialog.resize());else{this.tipDialog=new n(i,{},this.hideTipDialog.bind(this),this.setShowAlerts.bind(this)),this.tipDialog.position.x=-this.tipDialog.width,this.game.menuBar.addChild(this.tipDialog);var a=e.x(15),s=this;this.tipDialog.resize(),this.showTipTween=new TWEEN.Tween({x:this.tipDialog.position.x}).to({x:a},250).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){s.tipDialog&&(s.tipDialog.x=this.x,s.tipDialog.updateText(o),s.tipDialog.resize())}).onComplete(function(){s.dialogShowing=!0,s.tipDialog&&(s.tipDialog.updateText(o),s.tipDialog.resize())}).start()}this.hideTimer=setTimeout(function(){this.hideTipDialog()}.bind(this),5e3)}},hideTipDialog:function(){if(window.clearTimeout(this.hideTimer),this.showTipTween&&this.showTipTween.Stop&&this.showTipTween.Stop(),this.tipDialog){var t=-this.tipDialog.width,e=this;this.hideTipTween=new TWEEN.Tween({x:this.tipDialog.position.x}).to({x:t},250).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){e.tipDialog&&(e.tipDialog.x=this.x)}).onComplete(function(){e.tipDialog&&(-1!=e.gameScreenUI.children.indexOf(e.tipDialog)&&e.gameScreenUI.removeChild(e.tipDialog),e.tipDialog.removeScaling(),e.tipDialog=null),e.dialogShowing=!1}).start()}},setShowAlerts:function(t){this.settingsManager.setSetting("general","showAlerts",t)}}}),define("SolitaireShared/CardLogic/IGameAuthority",["util/TipManager"],function(t){var e=function(){};return e.MoveState={CanMove:0,CanDealNextDeck:1,NoMovesLeft:2},e.prototype.OnTip=function(e,i){t&&t.tryShowTip(i)},e}),define("SolitaireShared/CardLogic/TipEventArgs",[],function(){return function(t,e){this.TipId=t,this.Args=e}});var bigInt=function(){function t(t,e){this.value=t,this.sign=e}function e(t){for(;0===t[t.length-1]&&t.length>1;)t.pop();return t}function i(i,r){var o=r<0;if(i.sign!==o)return o?n(i.abs(),-r):n(i.abs(),r).negate();o&&(r=-r);for(var a=i.value,s=[],l=0,h=0;h<a.length||l>0;h++){var u=(a[h]||0)+(h>0?0:r)+l;l=u>=C?1:0,s.push(u%C)}return new t(e(s),i.sign)}function n(n,r){var o=n.value;if(1===o.length)return o=o[0],n.sign&&(o=-o),new t([Math.abs(o-r)],o-r<0);if(n.sign!==r<0)return i(n,-r);var a=!1;if(n.sign&&(a=!0),1===o.length&&o[0]<r)return new t([r-o[0]],!a);a&&(r=-r);for(var s=[],l=0,h=0;h<o.length;h++){var u=o[h]-l-(h>0?0:r);l=u<0?1:0,s.push(l*C+u)}return new t(e(s),a)}function r(t,e){for(var i=[],n=0,r=0;r<t.length;r++){n+=e*t[r];var o=Math.floor(n/C);i[r]=n-o*C|0,n=o}return i[t.length]=0|n,i}function o(i,n){return new t(e(r(i.value,n<0?-n:n)),n<0?!i.sign:i.sign)}function a(t,e){for(var i=[],n=0;n<t.length;n++)i[n]=0;for(var r=0,n=t.length-1;n>=0;n--){var o=r*C+t[n],a=Math.floor(o/e);r=o-a*e,i[n]=0|a}return{quotient:i,remainder:0|r}}function s(i,n){if(0===n)throw new Error("Cannot divide by zero.");var r=a(i.value,n<0?-n:n);return{quotient:new t(e(r.quotient),n<0?!i.sign:i.sign),remainder:new t([r.remainder],i.sign)}}function l(e){return("number"==typeof e||"string"==typeof e)&&+Math.abs(e)<=C||e instanceof t&&e.value.length<=1}function h(t,e){return t=f(t).abs(),e=f(e).abs(),t.equals(e)?t:t.equals(M)?e:e.equals(M)?t:t.isEven()?e.isOdd()?h(t.divide(2),e):h(t.divide(2),e.divide(2)).multiply(2):e.isEven()?h(t,e.divide(2)):t.greater(e)?h(t.subtract(e).divide(2),e):h(e.subtract(t).divide(2),t)}function u(t,e){return t=f(t).abs(),e=f(e).abs(),t.multiply(e).divide(h(t,e))}function d(t,e){return t=f(t),e=f(e),t.greater(e)?t:e}function c(t,e){return t=f(t),e=f(e),t.lesser(e)?t:e}function p(e,i){e=f(e),i=f(i);for(var n=c(e,i),r=d(e,i),o=r.subtract(n),a=o.value.length-1,s=[],l=!0,h=a;h>=0;h--){var u=l?o.value[h]:C,p=Math.floor(Math.random()*u);s.unshift(p),p<u&&(l=!1)}return n.add(new t(s,!1))}function g(t,e,i){for(var n=M,r=d(t.abs(),e.abs()),a=_;a.lesserOrEquals(r);){var s,l;s=t.over(a).isEven()?0:1,l=e.over(a).isEven()?0:1,n=n.add(a.times(i(s,l))),a=o(a,2)}return n}function f(i){if(i instanceof t)return i;if(Math.abs(+i)<C&&+i==(0|+i)){var n=+i;return new t([Math.abs(n)],n<0||1/n==-1/0)}i+="";var r=v.positive,n=[];"-"===i[0]&&(r=v.negative,i=i.slice(1));var i=i.split(/e/i);if(i.length>2)throw new Error("Invalid integer: "+i.join("e"));if(i[1]){var o=i[1];"+"===o[0]&&(o=o.slice(1)),o=f(o);var a=i[0].indexOf(".");if(a>=0&&(o=o.minus(i[0].length-a),i[0]=i[0].slice(0,a)+i[0].slice(a+1)),o.lesser(0))throw new Error("Cannot include negative exponent part for integers");for(;o.notEquals(0);)i[0]+="0",o=o.prev()}if(i=i[0],"-0"===i&&(i="0"),!/^([0-9][0-9]*)$/.test(i))throw new Error("Invalid integer: "+i);for(;i.length;){var s=i.length>S?i.length-S:0;n.push(+i.slice(s)),i=i.slice(0,s)}return new t(e(n),r)}function y(t){var e=t.value;return 1===e.length&&e[0]<=36?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e[0]):"<"+e+">"}function m(t,e){if(e=bigInt(e),e.equals(0)){if(t.equals(0))return"0";throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1))return t.equals(0)?"0":t.lesser(0)?Array(1-t).join("10"):"1"+Array(+t).join("01");var i="";if(t.isNegative()&&e.isPositive()&&(i="-",t=t.abs()),e.equals(1))return t.equals(0)?"0":i+Array(+t+1).join(1);for(var n,r=[],o=t;o.lesser(0)||o.compareAbs(e)>=0;){n=o.divmod(e),o=n.quotient;var a=n.remainder;a.lesser(0)&&(a=e.minus(a).abs(),o=o.next()),r.push(y(a))}return r.push(y(o)),i+r.reverse().join("")}var C=1e7,S=7,b="0000000",v={positive:!1,negative:!0};t.prototype.negate=function(){return new t(this.value,!this.sign)},t.prototype.abs=function(){return new t(this.value,v.positive)},t.prototype.add=function(n){if(l(n))return i(this,+n);if(n=f(n),this.sign!==n.sign)return this.sign===v.positive?this.abs().subtract(n.abs()):n.abs().subtract(this.abs());for(var r=this.value,o=n.value,a=[],s=0,h=Math.max(r.length,o.length),u=0;u<h||s>0;u++){var d=(r[u]||0)+(o[u]||0)+s;s=d>=C?1:0,a.push(d%C)}return new t(e(a),this.sign)},t.prototype.plus=t.prototype.add,t.prototype.subtract=function(i){if(l(i))return n(this,+i);if(i=f(i),this.sign!==i.sign)return this.add(i.negate());if(this.sign===v.negative)return i.negate().subtract(this.negate());if(this.compare(i)<0)return i.subtract(this).negate();for(var r=this.value,o=i.value,a=[],s=0,h=Math.max(r.length,o.length),u=0;u<h;u++){var d=r[u]||0,c=o[u]||0,p=d-s;s=p<c?1:0,a.push(s*C+p-c)}return new t(e(a),v.positive)},t.prototype.minus=t.prototype.subtract,t.prototype.multiply=function(i){if(l(i))return o(this,+i);i=f(i);for(var n=this.sign!==i.sign,r=this.value,a=i.value,s=[],h=r.length+a.length;h>0;h--)s.push(0);for(var h=0;h<r.length;h++)for(var u=r[h],d=0;d<a.length;d++){var c=a[d],p=u*c+s[h+d],g=Math.floor(p/C);s[h+d]=p-g*C,s[h+d+1]+=g}return new t(e(s),n)},t.prototype.times=t.prototype.multiply,t.prototype.divmod=function(i){if(l(i))return s(this,+i);i=f(i);var n=this.sign!==i.sign;if(i.equals(M))throw new Error("Cannot divide by zero");if(this.equals(M))return{quotient:new t([0],v.positive),remainder:new t([0],v.positive)};for(var o=this.value,h=i.value,u=[0],d=0;d<h.length;d++)u[d]=0;var c=h[h.length-1],p=Math.ceil(C/2/c),g=r(o,p),y=r(h,p);c=y[h.length-1];for(var m=o.length-h.length;m>=0;m--){var S=C-1;g[m+h.length]!==c&&(S=Math.floor((g[m+h.length]*C+g[m+h.length-1])/c));for(var b=0,w=0,d=0;d<y.length;d++){b+=S*y[d];var x=Math.floor(b/C);w+=g[m+d]-(b-x*C),b=x,w<0?(g[m+d]=w+C|0,w=-1):(g[m+d]=0|w,w=0)}for(;0!==w;){S-=1;for(var b=0,d=0;d<y.length;d++)b+=g[m+d]-C+y[d],b<0?(g[m+d]=b+C|0,b=0):(g[m+d]=0|b,b=1);w+=b}u[m]=0|S}return g=a(g,p).quotient,{quotient:new t(e(u),n),remainder:new t(e(g),this.sign)}},t.prototype.divide=function(t){return this.divmod(t).quotient},t.prototype.over=t.prototype.divide,t.prototype.mod=function(t){return this.divmod(t).remainder},t.prototype.remainder=t.prototype.mod,t.prototype.pow=function(t){t=f(t);var e=this,i=t,n=_;if(i.equals(M))return n;if(e.equals(M)||i.lesser(M))return M;for(;;){if(i.isOdd()&&(n=n.times(e)),i=i.divide(2),i.equals(M))break;e=e.times(e)}return n},t.prototype.modPow=function(t,e){if(t=f(t),e=f(e),e.equals(M))throw new Error("Cannot take modPow with modulus 0");var i=_,n=this.mod(e);if(n.equals(M))return M;for(;t.greater(0);)t.isOdd()&&(i=i.multiply(n).mod(e)),t=t.divide(2),n=n.square().mod(e);return i},t.prototype.square=function(){return this.multiply(this)},t.prototype.next=function(){return i(this,1)},t.prototype.prev=function(){return n(this,1)},t.prototype.compare=function(t){var e=this,i=f(t);if(1===e.value.length&&1===i.value.length&&0===e.value[0]&&0===i.value[0])return 0;if(i.sign!==e.sign)return e.sign===v.positive?1:-1;for(var n=e.sign===v.positive?1:-1,r=e.value,o=i.value,a=Math.max(r.length,o.length)-1,s=a;s>=0;s--){var l=r[s]||0,h=o[s]||0;if(l>h)return 1*n;if(h>l)return-1*n}return 0},t.prototype.compareAbs=function(t){return this.abs().compare(t.abs())},t.prototype.equals=function(t){return 0===this.compare(t)},t.prototype.notEquals=function(t){return!this.equals(t)},t.prototype.lesser=function(t){return this.compare(t)<0},t.prototype.greater=function(t){return this.compare(t)>0},t.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},t.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},t.prototype.compareTo=t.prototype.compare,t.prototype.lt=t.prototype.lesser,t.prototype.leq=t.prototype.lesserOrEquals,t.prototype.gt=t.prototype.greater,t.prototype.geq=t.prototype.greaterOrEquals,t.prototype.eq=t.prototype.equals,t.prototype.neq=t.prototype.notEquals,t.prototype.isPositive=function(){return(1!==this.value.length||0!==this.value[0])&&this.sign===v.positive},t.prototype.isNegative=function(){return(1!==this.value.length||0!==this.value[0])&&this.sign===v.negative},t.prototype.isEven=function(){return this.value[0]%2==0},t.prototype.isOdd=function(){return this.value[0]%2==1},t.prototype.isUnit=function(){return 1===this.value.length&&1===this.value[0]},t.prototype.isZero=function(){return 1===this.value.length&&0===this.value[0]},t.prototype.isDivisibleBy=function(t){return t=f(t),!t.isZero()&&this.mod(t).equals(M)},t.prototype.isPrime=function(){var t=this.abs(),e=t.prev();if(t.isUnit())return!1;if(t.equals(2)||t.equals(3)||t.equals(5))return!0;if(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))return!1;if(t.lesser(25))return!0;for(var i,n,r,o,a=[2,3,5,7,11,13,17,19],s=e;s.isEven();)s=s.divide(2);for(r=0;r<a.length;r++)if(o=bigInt(a[r]).modPow(s,t),!o.equals(_)&&!o.equals(e)){for(n=!0,i=s;n&&i.lesser(e);i=i.multiply(2))o=o.square().mod(t),o.equals(e)&&(n=!1);if(n)return!1}return!0};for(var w=[1];w[w.length-1]<=C;)w.push(2*w[w.length-1]);var x=w.length,T=w[x-1];t.prototype.shiftLeft=function(t){if(!l(t))return t.isNegative()?this.shiftRight(t.abs()):this.times(bigInt(2).pow(t));if((t=+t)<0)return this.shiftRight(-t);for(var e=this;t>=x;)e=o(e,T),t-=x-1;return o(e,w[t])},t.prototype.shiftRight=function(t){if(!l(t))return t.isNegative()?this.shiftLeft(t.abs()):this.over(bigInt(2).pow(t));if((t=+t)<0)return this.shiftLeft(-t);for(var e=this;t>=x;){if(e.equals(M))return e;e=s(e,T).quotient,t-=x-1}return s(e,w[t]).quotient},t.prototype.not=function(){var t=g(this,this,function(t){return(t+1)%2});return this.sign?t:t.negate()},t.prototype.and=function(t){t=f(t);var e=g(this,t,function(t,e){return t*e});return this.sign&&t.sign?e.negate():e},t.prototype.or=function(t){t=f(t);var e=g(this,t,function(t,e){return(t+e+t*e)%2});return this.sign||t.sign?e.negate():e},t.prototype.xor=function(t){t=f(t);var e=g(this,t,function(t,e){return(t+e)%2});return this.sign^t.sign?e.negate():e},t.prototype.toString=function(t){if(void 0===t&&(t=10),10!==t)return m(this,t);var e=this,i="",n=e.value.length;if(0===n||1===n&&0===e.value[0])return"0";for(n-=1,i=e.value[n].toString();--n>=0;){var r=e.value[n].toString();i+=b.slice(r.length)+r}return(e.sign===v.positive?"":"-")+i},t.prototype.toJSNumber=function(){return this.valueOf()},t.prototype.valueOf=function(){return 1===this.value.length?this.sign?-this.value[0]:this.value[0]:+this.toString()};var M=new t([0],v.positive),_=new t([1],v.positive),P=new t([1],v.negative),A=function(t,e){e=f(e);var i,n=M,r=[],o=!1;for(i=0;i<t.length;i++)!function(t){var e=t[i].toLowerCase();if(0===i&&"-"===t[i])return void(o=!0);if(/[0-9]/.test(e))r.push(f(e));else if(/[a-z]/.test(e))r.push(f(e.charCodeAt(0)-87));else{if("<"!==e)throw new Error(e+" is not a valid character");var n=i;do{i++}while(">"!==t[i]);r.push(f(t.slice(n+1,i)))}}(t);for(r.reverse(),i=0;i<r.length;i++)n=n.add(r[i].times(e.pow(i)));return o?n.negate():n},k=function(t,e){return void 0===t?M:void 0!==e?A(t,e):f(t)};return k.zero=M,k.one=_,k.minusOne=P,k.randBetween=p,k.min=c,k.max=d,k.gcd=h,k.lcm=u,k}();"undefined"!=typeof module&&(module.exports=bigInt),define("BigInteger",function(t){return function(){return t.bigInt}}(this)),define("SolitaireShared/Toolbox/PseudoRandom",[],function(){var t=function(t,e,i,n){null!=t&&"array"!=typeof t&&(t=[t]),this.initPseudoRandom(t,e,i,n)};return t.UInt32={MaxValue:4294967295},t.prototype.initPseudoRandom=function(t,e,i,n){e=e||+Date.now(),i=i||64,n=n||987657110,this.NumSeeds=i,this.Multiplier=n,this.N=0,this.Seeds=new Array(i),t=null==t||0==t.length?[+Date.now()]:t,this.Carry=((4294967295&e)>>>0)%n;for(var r=0;r<i;++r)r<t.length?this.Seeds[r]=(4294967295&t[r])>>>0:this.Seeds[r]=(4294967295*Math.random()&4294967295)>>>0,4294967295==this.Seeds[r]&&(this.Seeds[r]=1)},t.prototype.GetNextRandomBytes=function(e){var i=new Array(e),n=0,r=0,o=new Array(this.NumSeeds);i[e-1]=this.GetNext32(t.UInt32.MaxValue),r=this.Carry,n=this.N,o=this.Seeds.slice(0);for(var a=e-2;a>=0;a--)i[a]=this.GetNext32(t.UInt32.MaxValue);return this.Carry=r,this.N=n,this.Seeds=o.slice(0),i},t.prototype.GetNext32=function(t){var e=this.Multiplier*this.Seeds[this.N]+this.Carry,i=e>>>16;i>>>=16,this.Carry=i+((4294967295&e)>>>0>=4294967295-i?1:0),this.Seeds[this.N]=4294967294-((4294967295&e)>>>0)-(this.Carry-i<<32)-((4294967295&this.Carry)>>>0);var n=this.Seeds[this.N];return this.N=(this.N+1&this.NumSeeds-1)>>>0,n%t},t}),define("SolitaireShared/CardLogic/CardOp",["SolitaireShared/CardLogic/Supply"],function(t){var e=function(t){this.initCardOp(t)};return e.Op={Noop:0,Move:1,Undo:2,Game:9,Option:10,Deal:11,Challenge:16,TotalDealsExtra:20,WildCardAdd:21,Begin:29,End:30,Error:31},e.OpTypes=["Noop","Move","Begin","End","Undo","Game","Option","Deal","Challenge","Error","TotalDealsExtra","WildCardAdd"],e.eMoveParams={SourcePile:1,DestPile:2,NumCards:3},e.eUndoParams={NumMoves:1,NumMovesUndone:2,ScoreChange:3},e.eDealParams={DeckSeed:1},e.eOptionParams={Option:1,Value:2},e.eGameParams={GameName:1},e.eExtraDealsParams={DealsCount:1},e.MaxParamCount=8,e.prototype.initCardOp=function(t){this._supply=t,this.Opcode=e.Op.Noop,this._numParams=0,this._intParams=[],this._stringParams=[]},e.prototype.GetNumParams=function(){return this._numParams},e.prototype.GetPile=function(t){return this.Opcode!=e.Op.Move?null:t==e.eMoveParams.SourcePile||t==e.eMoveParams.DestPile?this._supply.GetPile(this._intParams[t]):null},e.prototype.GetCard=function(t){return this.Opcode!=e.Op.Challenge?-1:t<this._numParams&&t>=0?this._intParams[t+1]:-1},e.prototype.GetNumber=function(t){if(this.Opcode==e.Op.Move){if(t==e.eMoveParams.NumCards)return this._intParams[t]}else if(this.Opcode==e.Op.Undo){if(t==e.eUndoParams.NumMoves)return this._intParams[t];if(t==e.eUndoParams.NumMovesUndone)return this._intParams[t];if(t==e.eUndoParams.ScoreChange)return this._intParams[t]}return 0},e.prototype.GetDeck=function(t){return this.Opcode!=e.Op.Deal?null:t==e.eDealParams.DeckSeed?this._stringParams[t]:null},e.prototype.GetOptionName=function(t){return this.Opcode!=e.Op.Option?null:t==e.eOptionParams.Option?this._stringParams[t]:null},e.prototype.GetOptionValue=function(t){return this.Opcode!=e.Op.Option?null:t==e.eOptionParams.Value?this._stringParams[t]:null},e.prototype.GetGameName=function(t){return this.Opcode!=e.Op.Game?null:t==e.eGameParams.GameName?this._stringParams[t]:null},e.prototype.StringToOpcode=function(t){if(t=t.toLowerCase(),0==t.length)return e.Op.Noop;for(var i=0;i<e.OpTypes.length;i++){var n=e.OpTypes[i];if(0!=n.length){if(n.toLowerCase()[0]==t[0]){var r;try{if(!(r=e.Op[n]))return e.Op.Noop}catch(t){return e.Op.Noop}return r}}}return e.Op.Noop},e.prototype.Parse=function(t,i){var n=i;this.Opcode=this.StringToOpcode(t[n+0]),this.OpName=t[n+0],this._intParams=[],this._intParams[0]=this.Opcode;var r,o=0;switch(this.Opcode){case e.Op.Error:break;case e.Op.Noop:r=1,t.length>=r&&(o=r);break;case e.Op.Move:r=4,t.length>=r&&(o=r,this._intParams[e.eMoveParams.DestPile]=this.ParsePileID(t[n+e.eMoveParams.DestPile]),this._intParams[e.eMoveParams.SourcePile]=this.ParsePileID(t[n+e.eMoveParams.SourcePile]),this._intParams[e.eMoveParams.NumCards]=this.Parse_Count(t[n+e.eMoveParams.NumCards]),0==this._intParams[e.eMoveParams.DestPile]?o=-o:0==this._intParams[e.eMoveParams.SourcePile]?o=-o:0==this._intParams[e.eMoveParams.NumCards]&&(o=-o),this._numParams=3);break;case e.Op.Begin:case e.Op.End:r=1,t.length>=r&&(o=r);break;case e.Op.Undo:r=2,t.length>=r&&(o=r,this._intParams[e.eUndoParams.NumMoves]=this.Parse_Count(t[n+e.eUndoParams.NumMoves]),this._intParams[e.eUndoParams.NumMovesUndone]=0,0==this._intParams[e.eUndoParams.NumMoves]&&(o=0),this._numParams=1);break;case e.Op.Option:r=3,t.length>=r&&(this._stringParams=[],o=r,this._stringParams[e.eOptionParams.Option]=t[n+e.eOptionParams.Option],this._stringParams[e.eOptionParams.Value]=t[n+e.eOptionParams.Value],this._numParams=2);break;case e.Op.Deal:if(r=2,t.length>=r){if(this._stringParams=[],o=r,this._stringParams[e.eDealParams.DeckSeed]=t[n+e.eDealParams.DeckSeed],this._stringParams[e.eDealParams.DeckSeed].length>500)o=0;else for(var a=0;a<this._stringParams[e.eDealParams.DeckSeed].length;a++){var s=this._stringParams[e.eDealParams.DeckSeed][a];if(isNaN(s)&&("$"!=s||0!=a)){o=0;break}}this._numParams=1}break;case e.Op.Game:r=2,t.length>=r&&(this._stringParams=[],o=r,this._stringParams[e.eGameParams.GameName]=t[n+e.eGameParams.GameName],this.GetGameName(e.eGameParams.GameName).toLowerCase()!=this._supply.GameName.toLowerCase()&&(o=-1),this._numParams=1);break;case e.Op.Challenge:if(r=2,t.length>=r){o=r;for(var a=0;a<t.length-1;++a)this._intParams[a+1]=parseInt(t[n+a+1]);this._numParams=t.length-1}break;case e.Op.TotalDealsExtra:r=2,t.length>=r&&(o=r,this._intParams[1]=parseInt(t[n+1]),this._numParams=1);break;case e.Op.WildCardAdd:r=1,t.length>=r&&(o=r)}return o},e.prototype.ParsePileID=function(t){var e=0,i=!1;return null!=t&&(e=parseInt(t),isNaN(e)?e=0:null==this._supply.GetPile(e)&&(e=0),0==e&&("-"==t[0]&&(i=!0,t=t.substring(1)),e=this._supply.GetPileNum(t),i&&(e=-e),null==this._supply.GetPile(e)&&(e=0))),e},e.prototype.Parse_Count=function(t){var e;return null==t?0:(e=parseInt(t),isNaN(e)?0:e)},e.prototype.ToString=function(){var t="";t+=this.OpName.toUpperCase();for(var e=1;e<=this._numParams;e++)t+=" ",null!=this._stringParams&&this._stringParams.length>=e&&null!=this._stringParams[e]?t+=this._stringParams[e]:t+=this._intParams[e];return t},e.prototype.Run=function(){switch(this.Opcode){case e.Op.Move:var t=this._intParams[e.eMoveParams.SourcePile],i=this._intParams[e.eMoveParams.DestPile],n=this._intParams[e.eMoveParams.NumCards];if(0==t||0==i||0==n)return!1;var r=!1;n<0&&(n=-n,r=!("Spider"==this._supply.GameName&&"Foundation"==this._supply.GetPile(i).Type&&this._supply.CardAnimator&&!this._supply.CardAnimator.movingRunToFoundation));var o=this._supply.GetPile(t).ForceRemoveTop(n);if(null==o)return!1;r&&o.reverse(),this._supply.GetPile(i).ForceAddTop(o),this._supply.EnforceGameRules&&(this._supply.HasMovedCards=!0);break;case e.Op.Option:var a=this.GetOptionName(e.eOptionParams.Option),s=this.GetOptionValue(e.eOptionParams.Value);this._supply.SetOption(a,s);break;case e.Op.Game:this._supply.Authority.Reset();break;case e.Op.Deal:var l=this.GetDeck(e.eDealParams.DeckSeed);this._supply.DeckSeed=l,this._supply.Authority.Deal();break;case e.Op.Undo:var h=this._intParams[e.eUndoParams.NumMoves],u=this._supply.Score,d=this._supply.UndoActions(h);return this._intParams[e.eUndoParams.NumMovesUndone]=d,this._intParams[e.eUndoParams.ScoreChange]=this._supply.Score-u,d==h;case e.Op.TotalDealsExtra:var c=this._intParams[e.eExtraDealsParams.DealsCount];this._supply.Authority.AddExtraDeals(c,!1);break;case e.Op.WildCardAdd:this._supply.Authority.AddWildCard(!1)}return!0},e.prototype.IsUndoable=function(){return this.Opcode==e.Op.Move},e.prototype.Undo=function(){switch(this.Opcode){case e.Op.Move:var t=this._intParams[e.eMoveParams.SourcePile],i=this._intParams[e.eMoveParams.DestPile],n=this._intParams[e.eMoveParams.NumCards];if(0==t||0==i||0==n)return!1;var r=!1;n<0&&(n=-n,r=!0);var o=this._supply.GetPile(i).ForceRemoveTop(n);if(null==o)return!1;r&&o.reverse(),this._supply.GetPile(t).ForceAddTop(o)}return!0},e.prototype.Equals=function(t){if(null==t)return!1;if(null==this._intParams&&null==t._intParams)return!0;if(null!=this._intParams&&null!=t._intParams&&this._intParams.length==t._intParams.length){for(var e=0;e<this._intParams.length;e++)if(this._intParams[e]!=t._intParams[e])return!1;return!0}return!1},e}),define("SolitaireShared/CardLogic/CardAction",["lodash","absolute/debug","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n){
var r=function(t){this.initCardAction(t)};return r.DelimiterChars=[" ","\t","\n"],r.TimestampChars=["[","]"],r.prototype.initCardAction=function(t){this.Supply=t,this.Ops=[],this.Timestamp=-1,this.EffectiveScore=0,this.Tag=0,this.IsWildcardAction=!1,this.isAllowed=!0},r.ParseActions=function(t,e){for(var i=/\s/,n=[],o=e?e.split(i):[],a=0;a<o.length;)if(0!=o[a].length){var s=new r(t),l=s.Parse(o,a);if(l<=0)return null;n.push(s),a+=l}else a++;return n},r.RunActions=function(t,e){var i=r.ParseActions(t,e);t.SuppressAnimations||null==t.CardAnimator||t.CardAnimator.BeginAnimationSet(i.length);for(var n=0;n<i.length;n++){if(!i[n].Run())return t.SuppressAnimations||null==t.CardAnimator||t.CardAnimator.EndAnimationSet(),!1}return t.SuppressAnimations||null==t.CardAnimator||t.CardAnimator.EndAnimationSet(),!0},r.sParse=function(t,e){var i=new r(t);return i.Parse(e,0),i},r.prototype.Parse=function(t,e){e=e||0;var i=!1,r=0;if("["==t[e][0]&&"]"==t[e][t[e].length-1]){var o=t[e].substring(1,t[e].length-1),a=parseInt(o);isNaN(a)||(this.Timestamp=a),e++,r++}this.Ops=[];do{if(e>=t.length)return 0;var s=new n(this.Supply),l=s.Parse(t,e);if(0==l)return 0;if(l<0&&(l=-l,this.IsWildcardAction=!0),i||s.Opcode!=n.Op.Begin)if(i&&s.Opcode==n.Op.End)i=!1;else{if(!i&&s.Opcode==n.Op.Error)return 0;this.Ops.push(s)}else i=!0;e+=l,r+=l}while(i);return r},r.prototype.IsNewGameAction=function(){return 1==this.Ops.length&&this.Ops[0].Opcode==n.Op.Game},r.prototype.IsAllowed=function(t){return t=!!t,!this.IsWildcardAction&&(!!this.IsNewGameAction()||(!this.Supply.EnforceGameRules||null==this.Supply.Authority||this.Supply.Authority.IsActionAllowed(this,t)))},r.prototype.IsUndoable=function(){for(var t=0;t<this.Ops.length;t++)if(!this.Ops[t].IsUndoable())return!1;return!0},r.prototype.IsNoop=function(){return 1==this.Ops.length&&this.Ops[0].Opcode==n.Op.Noop},r.prototype.IsMove=function(){for(var t=this.Ops.length;--t>-1;)if(this.Ops[t].Opcode==n.Op.Move)return!0;return!1},r.prototype.IsError=function(){return 1==this.Ops.length&&this.Ops[0].Opcode==n.Op.Error},r.prototype.IsPregameAction=function(){for(var t=0;t<this.Ops.length;t++){var e=this.Ops[t];if(e.Opcode==n.Op.Deal||e.Opcode==n.Op.Option||e.Opcode==n.Op.Game)return!0}return!1},r.prototype.Run=function(t){t=void 0===t||t;var i=!0,r=!0;if(!this.IsAllowed(t))return!1;this.IsPregameAction()&&(i=!1);for(var o=!1,a=0;a<this.Ops.length;a++){var s=this.Ops[a];if(s.Opcode==n.Op.Move){o=!0;break}if(s.Opcode==n.Op.Option&&"cumulativescore"==s.GetOptionName(n.eOptionParams.Option).toLowerCase()){var l=(this.Supply.CumulativeScore,parseInt(s.GetOptionValue(n.eOptionParams.Value)));this.Supply.UseCumulativeScoring&&!isNaN(l)&&(this.Supply.CumulativeScore=l)}}!this.Supply.SuppressAnimations&&null!=this.Supply.CardAnimator&&o&&(this.Supply.IncrementActiveAnimations(),this.Supply.CardAnimator.DoesAnimationBlockInput(this)&&this.Supply.IncrementActiveBlockingAnimations(),this.Supply.CardAnimator.BeginAnimation(this,!1));for(var h=0;h<this.Ops.length;h++){var s=this.Ops[h];s.Run()||(e.log("Warning: CardOp Run failed!"),r=!1),!this.Supply.SuppressAnimations&&null!=this.Supply.CardAnimator&&o&&this.Supply.CardAnimator.ContinueAnimation(this,h)}if(r&&i){var u=this.Supply.Score;this.Supply.Score+=this.Supply.Authority.GetScoreForAction(this),this.EffectiveScore=this.Supply.Score-u,0!=this.Tag&&this.Supply.Authority.OnRunSpecialAction(this.Tag,!1),this.Supply.Authority.OnRunAction(this,!1,t),this.Supply.LogAction(this),this.Supply.CumulativeScore=this.Supply.CumulativeScore+this.EffectiveScore}return!this.Supply.SuppressAnimations&&null!=this.Supply.CardAnimator&&o&&this.Supply.CardAnimator.EndAnimation(this,function(t){this.Supply.CardAnimator.DoesAnimationBlockInput(this)&&this.Supply.DecrementActiveBlockingAnimations(),this.Supply.DecrementActiveAnimations(),this.Supply.OnAnimationEnd(this)}.bind(this)),r},r.prototype.GetActionUndoCount=function(){var e=0;return t.forEach(this.Ops,function(t){t.Opcode==n.Op.Undo&&(e+=t.GetNumber(n.eUndoParams.NumMoves))}),e},r.prototype.Undo=function(){if(!this.IsUndoable())return!1;this.Supply.Authority.ResetNoMoreMovesState(),this.Supply.SuppressAnimations||null==this.Supply.CardAnimator||(this.Supply.IncrementActiveAnimations(),this.Supply.CardAnimator.BeginAnimation(this,!0));for(var t=this.Ops.length-1;t>=0;t--){this.Ops[t].Undo()||e.log("Warning: CardOp Undo failed!"),this.Supply.SuppressAnimations||null==this.Supply.CardAnimator||this.Supply.CardAnimator.ContinueAnimation(this,t)}return this.Supply.SuppressAnimations||null==this.Supply.CardAnimator||this.Supply.CardAnimator.EndAnimation(this,function(t){this.Supply.DecrementActiveAnimations(),this.Supply.OnAnimationEnd(this)}.bind(this)),!0},r.prototype.ToString=function(){var e="";return this.Timestamp>0&&(e+="[",e+=this.Timestamp,e+="] "),this.Ops.length>1&&(e+="B "),t.forEach(this.Ops,function(t){e+=t.ToString(),e+=" "}),this.Ops.length>1&&(e+="E "),e},r.prototype.GetPotentialActions=function(t,e){var i=[];return e.IsAllowed()&&i.push(e),i},r}),define("SolitaireShared/CardLogic/Pile",["lodash","absolute/debug","BigInteger","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Card"],function(t,e,i,n,r){var o=function(t,e,i){this.initPile(t,e,i)};return o.prototype.initPile=function(t,e,i){this.PileID=0,this.Supply=t,this.Name=e,this.Type=i,this.Cards=[]},o.prototype.GetCards=function(){return this.Cards},o.prototype.ClearCards=function(){return this.Cards=[]},o.prototype.GetCardAtPos=function(t){return this.Cards[t]},o.prototype.Count=function(){return this.Cards.length},Object.defineProperty(o.prototype,"Count",{get:function(){return this.Cards.length}}),Object.defineProperty(o.prototype,"length",{get:function(){throw"Pile.length called - replace with .Count"}}),o.prototype.Clear=function(){this.Cards=[]},o.prototype.ForceAdd=function(t){var e=!0;return null!=t.Pile&&(e=t.Pile.ForceRemove(t)),e&&(this.Cards.push(t),t.Pile=this),e},o.prototype.ForceRemove=function(t){var e=this.Cards.indexOf(t);return-1!=e&&(this.Cards.splice(e,1),!0)},o.prototype.AddNew=function(t){null!=t.Pile&&t.Pile.ForceRemove(t),this.Cards.push(t),t.Pile=this},o.prototype.Sort=function(){this.Cards.sort(function(t,e){return t.CompareTo(e)})},Object.defineProperty(o.prototype,"Top",{get:function(){return 0==this.Cards.length?null:this.Cards[this.Cards.length-1]}}),Object.defineProperty(o.prototype,"Bottom",{get:function(){return 0==this.Cards.length?null:this.Cards[0]}}),o.prototype.moveCardInPile=function(t,e){var i=this.Cards[t];this.Cards.splice(t,1),this.Cards.splice(e,0,i)},o.prototype.NthFromTop=function(t){return this.Cards.length<t?null:t<=0?null:this.Cards[this.Cards.length-t]},Object.defineProperty(o.prototype,"Empty",{get:function(){return 0==this.Cards.length}}),o.prototype.Shuffle=function(t){if(t||(t=this.Supply.Options.DIFFICULTY&&"RANDOM"!==this.Supply.Options.DIFFICULTY?this.Supply.GetBakedInDeckSeed():this.Supply.GetRandomDeckSeed()),"string"==typeof t){t=new i(t)}this.Sort();var n=this.GetKeysFromSeed(t),r=this.GetSeedFromKeys(n),o=r.toString();e.log("seed = "+o);for(var a=this.Cards.length-1;a>=1;a--)if(a!=n[a]){var s=this.Cards[a];this.Cards[a]=this.Cards[n[a]],this.Cards[n[a]]=s}return o},o.prototype.GetCardPosFromEnd=function(t){for(var e=this.Cards.length-1;e>=0;e--)if(this.Cards[e]==t)return this.Cards.length-e;return 0},o.prototype.ForceRemoveTop=function(e){if(0==e)return null;var i=this.Cards.length-e;i<0&&(i=0,e=this.Cards.length);var n=this.Cards.splice(i,e);return t.forEach(n,function(t){t.Pile=null}),n},o.prototype.ForceAddTop=function(e){t.forEach(e,function(t){t.Pile=this},this),this.Cards=this.Cards.concat(e)},o.prototype.ToString=function(){var e="";return e+=PileID<10?"0"+PileID:PileID,null!=this.Name&&(e+=this.Name),e+="("+this.Cards.length+")",t.forEach(this.Cards,function(t){t!=this.Cards[0]&&(e+=" "),e+=t.ToString()},this),e},o.prototype.GetKeysFromSeed=function(t){var e=[],n=new i("0"),r=new i(this.Cards.length),o=new i(this.Cards.length);o=function(t){for(var e=new i(1),n=0;++n<=t;)e=e.multiply(new i(String(n)));return e}(o.value[0]),t=t.mod(o);for(var a=this.Cards.length;a>0;a--)n=t.mod(r),e[a-1]=n.toJSNumber(),t=t.divide(r),r=r.subtract(1);return e},o.prototype.GetSeedFromKeys=function(t,e){e||(e=this.Cards.length);for(var n=new i("0"),r=1;r<e;r++)n=n.multiply(new i((r+1).toString())),n=n.add(new i(t[r]));return n},o.prototype.IsPileAllowToRevealCard=function(){return"Stock"!=this.Name&&"Waste"!=this.Name&&"Foundation"!=this.Type},o.ConstructSeedFromDeck=function(t,e){for(var i=[],n=[],r=[],o=0;o<e;o++)n[o]=o,i[o]=o,r[o]=o;for(var o=e-1;o>=0;o--)if(r[o]!=t[o]){var a=r[o],s=n[a],l=r[n[t[o]]],h=n[l];r[o]=l,r[n[t[o]]]=a,i[o]=h,n[a]=h,n[l]=s}return this.GetSeedFromKeys(i,e)},o}),define("Solitaire/MvvmStructure/Service/BakedInSolvablesService",["lodash","jszip","jsziputils"],function(t,e,i){"use strict";return{_solvable:[],Initialize:function(t,e){this.GetBakedInSolvables(t,e)},LoadBakedInSolvablesFromCDN:function(t,n){i.getBinaryContent("./solvables001.zip",function(i,r){if(i)return void n(i);try{e.loadAsync(r).then(function(e){Object.keys(e.files).forEach(function(i){e.files[i].async("string").then(function(e){if(e){var i=this.split("/");if(i[i.length-1].includes(".csv")){var n={name:i[i.length-2],difficulty:i[i.length-1].split(".")[0],seeds:e.split("\n")};t(n)}}}.bind(i))}.bind(this))}.bind(this))}catch(t){n(t)}}.bind(this))},GetBakedInSolvables:function(t,e){this.LoadBakedInSolvablesFromCDN(function(e){this._solvable.push(e),t(e)}.bind(this),function(t){this._isValid=!1,e(t)}.bind(this))},GetSolvables:function(){return this._solvable}}}),define("SolitaireShared/CardLogic/BakedInSeeds",["../../Solitaire/MvvmStructure/Service/BakedInSolvablesService"],function(t){return function(e,i){if(this.randomBakedSeed,this.gameName=e.toLowerCase(),"klondike"==this.gameName){var n="STANDARD"==i.SCORING?i.SCORING.toLowerCase():"lasvegas",r="draw"+i.DRAW;this.gameName+=r+n}if("spider"==this.gameName){var o="";1==i.SUITS&&(o="onesuit"),2==i.SUITS&&(o="twosuits"),4==i.SUITS&&(o="foursuits"),this.gameName+=o}this.difficulty=i.DIFFICULTY.toLowerCase();for(var a=t.GetSolvables(),s=null,l=0;l<a.length;l++)if(a[l].name==this.gameName&&a[l].difficulty==this.difficulty){s=a[l];break}s&&(this.randomBakedSeed=s.seeds[Math.floor(Math.random()*Math.floor(s.seeds.length))].trim())}}),define("SolitaireShared/CardLogic/Supply",["require","lodash","absolute/debug","util/eventhandler","BigInteger","SolitaireShared/Toolbox/PseudoRandom","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/Pile","absolute/eventbus","SolitaireShared/CardLogic/BakedInSeeds"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){"use strict";var g=function(t){this.initSupply(t)};return g.prototype.OnFlipCard=function(t){},g.prototype.OnAnimationEnd=function(t){},g.prototype.GetCardList=function(){return this.CardList},g.prototype.ClearCardList=function(){return this.CardList=[]},g.prototype.GetPileList=function(){return this.PileList},Object.defineProperty(g.prototype,"CurrentTime",{get:function(){return Math.floor(this.PreciseCurrentTime)}}),Object.defineProperty(g.prototype,"TimePlayed",{get:function(){return Math.floor(this.PreciseTimePlayed)}}),Object.defineProperty(g.prototype,"ActionList",{get:function(){return this.ActionLog}}),Object.defineProperty(g.prototype,"PileCount",{get:function(){return this.PileList.length}}),g.prototype.ResetTime=function(){this.PreciseCurrentTime=this.Authority.GetStartingTime(),this.PreciseTimePlayed=0,this.OnTimeReset&&this.OnTimeReset(this)},g.prototype.AccumulateTime=function(t){this.shouldPauseTime||(t>1&&(t=1),this.IsTimerCountdown?this.PreciseCurrentTime>0&&(this.PreciseCurrentTime-=t,this.PreciseCurrentTime<=0&&(this.PreciseCurrentTime=0,this.OnTimeRanOutEvent.handleEvent(this))):this.PreciseCurrentTime+=t,this.OnTimeChangeEvent.handleEvent(this.PreciseCurrentTime),this.PreciseTimePlayed+=t,null!=this.Authority&&this.Authority.Tick(this.PreciseTimePlayed))},Object.defineProperty(g.prototype,"Score",{get:function(){return this._Score},set:function(t){null!=this.Authority&&t>this.Authority.GetMaxScore()?this._Score=this.Authority.GetMaxScore():null!=this.Authority&&t<this.Authority.GetMinScore()?this._Score=this.Authority.GetMinScore():this._Score=t,this.OnScoreEvent.handleEvent(this._Score)}}),g.prototype.IncrementActiveAnimations=function(){this._activeAnimations++},g.prototype.DecrementActiveAnimations=function(){this._activeAnimations--},g.prototype.IncrementActiveBlockingAnimations=function(){this._activeBlockingAnimations++},g.prototype.DecrementActiveBlockingAnimations=function(){this._activeBlockingAnimations--},Object.defineProperty(g.prototype,"WaitingForBlockingAnimation",{get:function(){return this._activeBlockingAnimations>0||!(null==this.CardAnimator||null==this.CardAnimator.WinAnimator||!this.CardAnimator.WinAnimator.IsAnimationRunning())}}),Object.defineProperty(g.prototype,"WaitingForAnimation",{get:function(){return this._activeAnimations>0||null!=this.CardAnimator&&null!=this.CardAnimator.WinAnimator&&this.CardAnimator.WinAnimator.IsAnimationRunning()}}),Object.defineProperty(g.prototype,"Count",{get:function(){return null!=this.CardList?this.CardList.length:0}}),g.ValueOrder=[a.Values.Ace,a.Values.Two,a.Values.Three,a.Values.Four,a.Values.Five,a.Values.Six,a.Values.Seven,a.Values.Eight,a.Values.Nine,a.Values.Ten,a.Values.Jack,a.Values.Queen,a.Values.King],g.SuitOrder=[s.Spades,s.Hearts,s.Clubs,s.Diamonds],g.prototype.GetPile=function(t){var e=0;if("string"==typeof t){if(!this.PileIndices[t])return null;e=this.PileIndices[t]}else e=t;return e<0&&(e=-e),e>=0&&e<this.PileList.length?this.PileList[e]:null},g.prototype.GetPileNum=function(t){return this.PileIndices[t]?this.PileIndices[t]:0},g.prototype.SetOption=function(t,e){t=t.toUpperCase(),this.Options[t]?null==e?delete this.Options[t]:this.Options[t]=e:null!=e&&(this.Options[t]=e)},g.prototype.CleanTemporaryOptions=function(){var t=[];for(var i in this.Options)if("+"==i[0]){t.push(i);for(var n=0;n<this.ActionLog.length;n++){var r=this.ActionLog[n];if(1==r.Ops.length&&r.Ops[0].Opcode==l.Op.Option&&r.Ops[0].GetOptionName(l.eOptionParams.Option)==i){this.ActionLog.splice(n,1);break}}}e.forEach(t,function(t){this.SetOption(t,null)},this)},g.prototype.GetOption=function(t){return t=t.toUpperCase(),this.Options[t]?this.Options[t].toUpperCase():null},g.GUID_FIELD="+GAMEID",g.prototype.GenerateGameKey=function(){var t="";t="|WEB|",this.SetOption(g.GUID_FIELD,"123456789".toUpperCase()+t+"+W".toUpperCase())},g.prototype.GetGameKey=function(t){if(!t)return this.GetOption(g.GUID_FIELD);try{var e=t.indexOf(g.GUID_FIELD);if(e>=0){e+=g.GUID_FIELD.Length+1;var n=t.substring(e).indexOf(" ");return t.substring(e,n)}}catch(t){i.log(t)}return null},g.prototype.initSupply=function(t){this.GameName=t,this.PileIndices={},this.PileList=[],this.PileList.push(null);var e=this.AddPile("Root","Root");this.RootPile=this.PileList[e],this.DebugShowAllCards=!1,this.Authority=null,this.CardsDealt=!1,this.HasMovedCards=!1,this.NumDecks=0,this.NumJokers=0,this.NumSuits=0,this.CardAnimator=null,this.SuppressAnimations=!1,this.LogMoves=!1,this.EnforceGameRules=!1,this.ActionLog=[],this.IsTimerCountdown=!1,this.PreciseCurrentTime=0,this.PreciseTimePlayed=0,this._deckSeed="",this._Score=0,this._activeAnimations=0,this._activeBlockingAnimations=0,this.IsWaitingForAds=!1,this.IsGamePageLoaded=!1,this.Options={};var i=Math.round(Math.random()*o.UInt32.MaxValue);this.RandomGenerator=new o(i),this.RandomGenerator.GetNextRandomBytes(64),this.RandomGenerator.GetNextRandomBytes(64),this.RandomGenerator.GetNextRandomBytes(64),this.RandomGenerator.GetNextRandomBytes(64),this.UseCumulativeScoring=!1,this._cumulativeScore=-52,this.OnShuffleEvent=new n,this.OnScoreEvent=new n,this.OnTimeChangeEvent=new n,this.OnBoardCompletedEvent=new n,this.OnTimeRanOutEvent=new n,this.OnWildCardAddedEvent=new n,this.OnDealEvent=new n,this.shouldPauseTime=!1},g.prototype.CreateCards=function(t,i,n){this.NumDecks=t,this.NumJokers=n,this.NumSuits=i,this.CardList=[],e.forEach(this.PileList,function(t){null!=t&&t.Clear()});for(var r=0,o=0;o<this.NumDecks;o++)for(var l=0;l<this.NumSuits;l++){for(var u=0;u<g.ValueOrder.length;u++){var d=new h(this,g.ValueOrder[u],g.SuitOrder[l],o,r++);this.CardList.push(d)}for(var c=0;c<this.NumJokers;c++){var d=new h(this,a.Values.Joker,s.None,o,r++);this.CardList.push(d)}}e.forEach(this.CardList,function(t){t.Suit!=s.None&&t.Value!=a.Values.Joker&&this.RootPile.ForceAdd(t)},this)},g.prototype.AddPile=function(t,e){if(this.PileIndices[t])return this.PileIndices[t];var i=new d(this,t,e),n=this.PileList.length;return this.PileList.push(i),this.PileIndices[t]=n,i.PileID=n,n},g.prototype.PrepareGame=function(t){void 0===t&&(t=!0),t&&this.ResetGame(),e.forEach(this.CardList,function(t){t.Pile!=this.RootPile&&(t.Value!=a.Values.Joker&&t.Suit!=s.None?this.RootPile.ForceAdd(t):null!=t.Pile&&"Joker"!=t.Pile.Name&&t.Pile.ForceRemove(t))},this)},g.prototype.ResetGame=function(){this.EnforceGameRules=!1,this.LogMoves=!1,this._activeAnimations=0,this._activeBlockingAnimations=0,null!=this.ActionLog&&(this.ActionLog=[]),this.HasMovedCards=!1,this.Score=this.Authority.GetStartingScore(),this.ResetTime()},g.prototype.StartGame=function(){this.EnforceGameRules=!0,this.LogMoves=!0,this.OnDealCards()},g.prototype.ToString=function(){var t="";return e.forEach(PileList,function(e){null!=e&&(t+=e.ToString())}),t},g.prototype.LogAction=function(t){null!=this.OnActionRun&&this.OnActionRun(this,EventArgs.Empty),t.Timestamp>0?(this.IsTimerCountdown&&t.Timestamp<this.CurrentTime||!this.IsTimerCountdown&&t.Timestamp>this.CurrentTime)&&(this.PreciseCurrentTime=t.Timestamp,this.PreciseTimePlayed=this.IsTimerCountdown?this.Authority.GetStartingTime()-t.Timestamp:t.Timestamp):(t.Timestamp=this.CurrentTime,this.PreciseTimePlayed=this.IsTimerCountdown?this.Authority.GetStartingTime()-this.CurrentTime:this.CurrentTime),this.LogMoves&&(t.IsNoop()||(this.ActionLog.push(t),c.dispatchEvent("LogActionComplete")))},g.prototype.HasPerformedAction=function(){return 0!=this.ActionLog.length&&(e.forEach(this.ActionLog,function(t){if(!t.IsNoop())return!0}),!1)},g.prototype.NumDealsSoFar=function(){var t=0;return e.forEach(this.ActionLog,function(e){1==e.Ops.length&&e.Ops[0].Opcode==l.Op.Deal&&t++}),t},g.prototype.NumExtraDealsSoFar=function(){var t=0;return e.forEach(this.ActionLog,function(e){1==e.Ops.length&&e.Ops[0].Opcode==l.Op.TotalDealsExtra&&t++}),t},g.prototype.GetActionLog=function(){if(null==this.GetGameKey()){this.GenerateGameKey();var t=new u(this);t.Parse(["OPTION",g.GUID_FIELD,this.GetGameKey()]),t.Run(),this.LogAction(t)}var n="";e.forEach(this.ActionLog,function(t){1==t.Ops.length&&t.Ops[0].Opcode==l.Op.Game?n+=t.ToString():1==t.Ops.length&&t.Ops[0].Opcode==l.Op.Option?n+=t.ToString():i.log("did not record: ",t.ToString())}),e.forEach(this.ActionLog,function(t){(1!=t.Ops.length||t.Ops[0].Opcode!=l.Op.Option&&t.Ops[0].Opcode!=l.Op.Game)&&(t.IsNoop()||(n+=t.ToString()))});var r=new u(this);return r.Parse("noop"),r.Run(),n+=r.ToString()},g.prototype.GetActionList=function(){return this.ActionLog},g.prototype.GetCollapsedActionList=function(){for(var t=[],e=0,i=this.ActionLog.length-1;i>=0;i--){var n=this.ActionLog[i],r=n.GetActionUndoCount();r>0?e+=r:e>0?e--:t.push(n)}return t.reverse(),t},g.prototype.CanUndoActions=function(){for(var t=[],e=0,i=this.ActionLog.length-1;i>=2;i--){var n=this.ActionLog[i];if("DEAL"===n.Ops[n.Ops.length-1].OpName)break;var r=n.GetActionUndoCount();r>0?e+=r:e>0?e--:t.push(n)}if(this.undoBoardCalled){t.length=0;for(var i=this.ActionLog.length-1;i>=2;i--)"DEAL"!==n.Ops[n.Ops.length-1].OpName&&this.ActionLog.splice(i,1);this.undoBoardCalled=!1}return this.undoCalled&&(t--,this.ActionLog.pop(),this.undoCalled=!1),0===t.length},g.prototype.UndoActions=function(t){for(var i=[],n=0,r=this.ActionLog.length-1;r>=2;r--){var o=this.ActionLog[r];if("DEAL"===o.Ops[o.Ops.length-1].OpName)break;var a=o.GetActionUndoCount();if(a>0)n+=a;else if(n>0)n--;else if(t>0?(i.push(o),this.ActionLog.pop(),this.undoCalled=!0,t--):t<0&&(i.push(o),this.undoBoardCalled=!0),0===t)break}-1===t&&(this.ActionLog.length=this.ActionLog.length-i.length);var s=0;return e.forEach(i,function(t){"TriPeaks"===this.GameName&&1===this.GetPile("Waste").Cards.length||t.Undo()&&(this.Score-=t.EffectiveScore,this.CumulativeScore-=t.EffectiveScore,this.Authority.OnRunAction(t,!0,!1),this.Authority.OnRunSpecialAction(t.Tag,!0),s++)},this),s},g.prototype.GetMoveCount=function(){var t=0;return e.forEach(this.ActionLog,function(i){var n=i.GetActionUndoCount();i.IsNoop()||(n>0?t-=i.GetActionUndoCount():e.forEach(i.Ops,function(e){e.Opcode==l.Op.Move&&t++}))}),t},g.prototype.GetRandomDeckSeed=function(){return new r(this.RandomGenerator.GetNextRandomBytes(16).join("")).toString()},g.prototype.GetBakedInDeckSeed=function(){var t,e=new p(this.GameName,this.Options);if(e.randomBakedSeed)t=new r(e.randomBakedSeed);else{if("FreeCell"==this.GameName){var i=Math.random();return Math.round(9999999*i)}this.Options.DIFFICULTY="RANDOM",t=new r(this.RandomGenerator.GetNextRandomBytes(16).join(""))}return t},g.prototype.GetDeckSeedStringList=function(){return[]},g.prototype.OnShuffleCards=function(){null!=this.OnShuffleEvent&&this.OnShuffleEvent.handleEvent(this)},g.prototype.OnDealCards=function(){this.ActionLog=[],this.LogAction(u.sParse(this,["GAME",this.GameName.toUpperCase()])),e.forEach(this.Options,function(t,e){var i=u.sParse(this,["OPTION",e,t.toString()]);this.LogAction(i)},this),this.LogAction(u.sParse(this,["DEAL",this.DeckSeed])),null!=this.OnDealEvent&&this.OnDealEvent.handleEvent(this),this.CardsDealt=!0},g.prototype.WildCardAdded=function(){null!=this.OnWildCardAddedEvent&&this.OnWildCardAddedEvent.handleEvent(this)},g.prototype.ForceDealEvent=function(){null!=this.OnDealEvent&&this.OnDealEvent.handleEvent(this)},Object.defineProperty(g.prototype,"CumulativeScore",{get:function(){return this._cumulativeScore},set:function(t){this.UseCumulativeScoring&&(this._cumulativeScore=t)}}),Object.defineProperty(g.prototype,"DeckSeed",{get:function(){return this._deckSeed},set:function(t){this._deckSeed=t}}),g}),define("SolitaireShared/CardLogic/MoveState",{CanMove:0,CanDealNextDeck:1,NoMovesLeft:2}),define("SolitaireShared/CardLogic/DealData",[],function(){return function(t,e){this.Script=e,this.Seed=t}}),define("SolitaireShared/KlondikeLogic/KlondikeAuthority",["absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/CardLogic/TipEventArgs","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState","SolitaireShared/CardLogic/DealData"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){var g=function(){this.initKlondikeAuthority()};return g.constructor=g,g.prototype=Object.create(i.prototype),g.STANDARD="STANDARD",g.LAS_VEGAS="LASVEGAS",g.LAS_VEGAS_CUMULATIVE="LASVEGASCUMULATIVE",g.TAG_PASSTHROUGHDECK=1,g.prototype.initKlondikeAuthority=function(){this.CardSupply=new r("Klondike"),this.CardSupply.Authority=this,this.WinSetAction=null,this.IceCastleCheck=[],this.CompletedIceCastle=!1,this.PassesThroughDeck=0,this.MaxCardsUsedFromWaste=0,this.CurrentCardsUsedFromWaste=0,this.lastStockCount=0,this.availableMovesSinceLastPassThroughDeck=!0,this.lastHint=null,this.IsChallenge=!1,this.MAX_DEALS=0,this.DealScript=g.DefaultDealScript},g.prototype.Setup=function(){this.CardSupply.AddPile("Stock","Stock"),this.CardSupply.AddPile("Waste","Waste"),this.CardSupply.AddPile("Foundation0","Foundation"),this.CardSupply.AddPile("Foundation1","Foundation"),this.CardSupply.AddPile("Foundation2","Foundation"),this.CardSupply.AddPile("Foundation3","Foundation"),this.CardSupply.AddPile("FaceDown0","FaceDown"),this.CardSupply.AddPile("Tableau0","Tableau"),this.CardSupply.AddPile("FaceDown1","FaceDown"),this.CardSupply.AddPile("Tableau1","Tableau"),this.CardSupply.AddPile("FaceDown2","FaceDown"),this.CardSupply.AddPile("Tableau2","Tableau"),this.CardSupply.AddPile("FaceDown3","FaceDown"),this.CardSupply.AddPile("Tableau3","Tableau"),this.CardSupply.AddPile("FaceDown4","FaceDown"),this.CardSupply.AddPile("Tableau4","Tableau"),this.CardSupply.AddPile("FaceDown5","FaceDown"),this.CardSupply.AddPile("Tableau5","Tableau"),this.CardSupply.AddPile("FaceDown6","FaceDown"),this.CardSupply.AddPile("Tableau6","Tableau"),this.CardSupply.CreateCards(1,4,0)},g.prototype.Reset=function(){this.IceCastleCheck=[],this.CompletedIceCastle=!1,this.PassesThroughDeck=0,this.MaxCardsUsedFromWaste=0,this.CurrentCardsUsedFromWaste=0,this.CardSupply&&(this.lastStockCount=this.CardSupply.GetPile("Stock").Count),this.availableMovesSinceLastPassThroughDeck=!0},g.prototype.BoardsCompleted=function(){return-1},g.prototype.NumDealsLeft=function(){return 0},g.prototype.Deal=function(){return this.CardSupply.PrepareGame(),null!=this.CardSupply.CardAnimator&&this.CardSupply.CardAnimator.BeginShuffleAnimation(),this.CardSupply.DeckSeed=this.CardSupply.RootPile.Shuffle(this.CardSupply.DeckSeed),this.CardSupply.OnShuffleCards(),u.RunActions(this.CardSupply,this.DealScript),this.CardSupply.StartGame(),this.PassesThroughDeck=0,this.lastStockCount=this.CardSupply.GetPile("Stock").Count,this.availableMovesSinceLastPassThroughDeck=!0,!0},g.prototype.Tick=function(t){},g.prototype.FoundationCanTakeCard=function(t,e,i){return i=!!i,null!=t&&null!=e&&(e.Value!=s.Values.Joker&&(t.Empty?e.Value==s.Values.Ace||(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_FoundationPile")),!1):!t.Empty&&e.Suit==t.Top.Suit&&e.ValueNum==t.Top.ValueNum+1&&e.Suit!=h.None||(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_FoundationPile")),!1)))},g.prototype.TableauCanTakeCard=function(t,e,i){return i=!!i,null!=t&&null!=e&&(e.Value!=s.Values.Joker&&(t.Empty?e.Value==s.Values.King||(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_Klondike_EmptyPile")),!1):e.Color==t.Top.Color?(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_SameColor")),!1):e.ValueNum!=t.Top.ValueNum-1?(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_OutOfOrder")),!1):e.Color!=l.None&&t.Top.Color!=l.None))},g.prototype.FaceDownForTableau=function(t){return null==t?null:"Tableau0"==t.Name?t.Supply.GetPile("FaceDown0"):"Tableau1"==t.Name?t.Supply.GetPile("FaceDown1"):"Tableau2"==t.Name?t.Supply.GetPile("FaceDown2"):"Tableau3"==t.Name?t.Supply.GetPile("FaceDown3"):"Tableau4"==t.Name?t.Supply.GetPile("FaceDown4"):"Tableau5"==t.Name?t.Supply.GetPile("FaceDown5"):"Tableau6"==t.Name?t.Supply.GetPile("FaceDown6"):null},g.prototype.IsActionAllowed=function(t,e){if(null==t||null==t.Ops||0==t.Ops.length)return!1;var i=t.Ops[0];if(1==t.Ops.length&&i.Opcode==d.Op.Undo)return!0;if(t.IsNoop())return!0;if(1==t.Ops.length&&i.Opcode==d.Op.Game)return!0;if(i&&i.Opcode==d.Op.Move){var n=i.GetPile(d.eMoveParams.SourcePile),r=i.GetPile(d.eMoveParams.DestPile),o=i.GetNumber(d.eMoveParams.NumCards);if(1==t.Ops.length){if(null==n||null==r)return!1;if("Tableau"==n.Type&&"Tableau"==r.Type){var a=this.FaceDownForTableau(n);if(o>0&&n.Count>=o&&null!=a&&(a.Empty||n.Count>o)&&this.TableauCanTakeCard(r,n.NthFromTop(o),e))return!0}else if("Tableau"==n.Type&&"Foundation"==r.Type){var a=this.FaceDownForTableau(n);if(1==o&&!n.Empty&&null!=a&&(a.Empty||n.Count>1)&&this.FoundationCanTakeCard(r,n.Top,e))return!0}else if("Foundation"==n.Type&&"Tableau"==r.Type){if(1==o&&!n.Empty&&this.TableauCanTakeCard(r,n.Top,e))return!0}else if("Foundation"==n.Type&&"Foundation"==r.Type){if(1==o&&n.Top.Value==s.Values.Ace&&r.Empty)return!0}else if("Stock"==n.Type&&"Waste"==r.Type){var l=parseInt(this.CardSupply.GetOption("Draw"));if(o<0&&(-o==l&&n.Count>=-o||-o<l&&n.Count==-o)&&!n.Empty)return!0}else if("Waste"==n.Type&&"Stock"==r.Type){var h=!this.IsNumDecksLimited()||this.PassesThroughDeck<2;if(o<0&&r.Empty&&n.Count==-o&&h)return!0}else if("Waste"==n.Type&&"Tableau"==r.Type){if(1==o&&!n.Empty&&this.TableauCanTakeCard(r,n.Top,e))return!0}else if("Waste"==n.Type&&"Foundation"==r.Type&&1==o&&!n.Empty&&this.FoundationCanTakeCard(r,n.Top,e))return!0}else if(2==t.Ops.length){var u=t.Ops[1];if(u.Opcode==d.Op.Move){var c=u.GetPile(d.eMoveParams.SourcePile),p=u.GetPile(d.eMoveParams.DestPile),g=u.GetNumber(d.eMoveParams.NumCards);if(null==n||null==r)return!1;if("Tableau"==n.Type&&"Tableau"==r.Type&&"FaceDown"==c.Type&&p==n){var a=this.FaceDownForTableau(n);if(o>0&&1==g&&null!=a&&a==c&&!a.Empty&&n.Count==o&&this.TableauCanTakeCard(r,n.NthFromTop(o),e))return!0}else if("Tableau"==n.Type&&"Foundation"==r.Type&&"FaceDown"==c.Type&&p==n){var a=this.FaceDownForTableau(n);if(1==o&&1==g&&null!=a&&a==c&&!a.Empty&&1==n.Count&&this.FoundationCanTakeCard(r,n.Top,e))return!0}}}}return!1},g.prototype.CanAutoSolve=function(){return!!(this.CardSupply.GetPile("FaceDown0").Empty&&this.CardSupply.GetPile("FaceDown1").Empty&&this.CardSupply.GetPile("FaceDown2").Empty&&this.CardSupply.GetPile("FaceDown3").Empty&&this.CardSupply.GetPile("FaceDown4").Empty&&this.CardSupply.GetPile("FaceDown5").Empty&&this.CardSupply.GetPile("FaceDown6").Empty&&this.CardSupply.GetPile("Stock").Empty&&this.CardSupply.GetPile("Waste").Empty&&this.CardSupply.GetPile("Foundation0").Count>0)},g.prototype.CanKeyboardFocusCard=function(t){return this.CanPickupCard(t)},g.prototype.CanPickupCard=function(t){return!this.CardSupply.WaitingForBlockingAnimation&&(!this.CardSupply.WaitingForAnimation&&("Tableau"==t.Pile.Type||("Waste"==t.Pile.Type&&1==t.Pile.GetCardPosFromEnd(t)||"Foundation"==t.Pile.Type&&1==t.Pile.GetCardPosFromEnd(t))))},g.prototype.CanAcceptCards=function(t){return"Foundation"==t.Type||"Tableau"==t.Type},g.prototype.GetScoreForAction=function(t){if(null==t||null==t.Ops||0==t.Ops.length)return 0;var e=t.Ops[0];if(1==t.Ops.length&&e.Opcode==d.Op.Undo)return 0;var i=0;if(e.Opcode==d.Op.Move){var n=e.GetPile(d.eMoveParams.SourcePile),r=e.GetPile(d.eMoveParams.DestPile),o=(e.GetNumber(d.eMoveParams.NumCards),this.CardSupply.GetOption("Scoring")==g.STANDARD);if(null==n||null==r)return 0;"Waste"==n.Type&&"Tableau"==r.Type?o&&(i=5):"Waste"==n.Type&&"Foundation"==r.Type?i=o?10:5:"Tableau"==n.Type&&"Foundation"==r.Type?o?(i=10,2==t.Ops.length&&(i+=5)):i=5:"Tableau"==n.Type&&"Tableau"==r.Type?o&&(i=0,2==t.Ops.length&&(i+=5)):"Foundation"==n.Type&&"Tableau"==r.Type?i=o?-10:-5:"Waste"==n.Type&&0==n.Count&&(t.Tag|=g.TAG_PASSTHROUGHDECK)}return i},g.prototype.GetScoreForTimer=function(t,e){return"TRUE"==this.CardSupply.GetOption("KlondikeTimer")&&this.CardSupply.GetOption("Scoring")==g.STANDARD?Math.floor(7e5/Math.max(1,this.CardSupply.CurrentTime)):0},g.prototype.GetBonusScore=function(t){return"TRUE"==this.CardSupply.GetOption("KlondikeTimer")&&t>30?Math.floor(7e5/Math.max(1,this.CardSupply.TimePlayed)):0},g.prototype.GetMaxScore=function(){return Number.MAX_VALUE},g.prototype.GetMinScore=function(){var t=0;switch(this.CardSupply.GetOption("Scoring")){case g.STANDARD:t=0;break;case g.LAS_VEGAS:t=-52;break;case g.LAS_VEGAS_CUMULATIVE:t=-(Number.MAX_VALUE-1)}return t},g.prototype.GetStartingScore=function(){var t=0;switch(this.CardSupply.GetOption("Scoring")){case g.STANDARD:return 0;case g.LAS_VEGAS:t=-52;break;case g.LAS_VEGAS_CUMULATIVE:t=this.CardSupply.CumulativeScore}return t},g.prototype.GetStartingTime=function(){return 0},g.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.CheckWin()},g.prototype.CheckWin=function(){return 4==this.GetCompletedStacks()},g.prototype.GetCompletedStacks=function(){var t=0;return 13==this.CardSupply.GetPile("Foundation0").Count&&t++,
13==this.CardSupply.GetPile("Foundation1").Count&&t++,13==this.CardSupply.GetPile("Foundation2").Count&&t++,13==this.CardSupply.GetPile("Foundation3").Count&&t++,t},g.prototype.GetHint=function(t){return t=!!t,this.GetHintInternal(t)},g.prototype.GetHintInternal=function(t){t=!!t;var e,i,n,r,o,a,l=[];for(e=0;e<7;e++)if(o=this.CardSupply.GetPile("Tableau"+e),!o.Empty)for(i=0;i<4;i++)a=this.CardSupply.GetPile("Foundation"+i),this.FoundationCanTakeCard(a,o.Top)&&(r=new d(this.CardSupply),n=["MOVE",o.Name,a.Name,"1"],r.Parse(n,0),l.push(r));if(!t&&l.length>0)return l[0];for(o=this.CardSupply.GetPile("Waste"),e=0;e<4;e++)a=this.CardSupply.GetPile("Foundation"+e),this.FoundationCanTakeCard(a,o.Top)&&(r=new d(this.CardSupply),n=["MOVE",o.Name,a.Name,"1"],r.Parse(n,0),l.push(r));if(!t&&l.length>0)return l[0];for(e=0;e<7;e++)if(o=this.CardSupply.GetPile("Tableau"+e),!(o.Empty||o.Bottom.Value==s.Values.King&&this.CardSupply.GetPile("FaceDown"+e).Empty))for(i=0;i<7;i++)e!=i&&(a=this.CardSupply.GetPile("Tableau"+i),this.TableauCanTakeCard(a,o.Bottom)&&(r=new d(this.CardSupply),n=["MOVE",o.Name,a.Name,o.Count.toString()],r.Parse(n,0),l.push(r)));if(!t&&l.length>0)return l[0];for(o=this.CardSupply.GetPile("Waste"),e=0;e<7;e++)a=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(a,o.Top)&&(r=new d(this.CardSupply),n=["MOVE",o.Name,a.Name,"1"],r.Parse(n,0),l.push(r));if(!t&&l.length>0)return l[0];if(this.CardSupply.GetPile("Stock").Count>0?(r=new d(this.CardSupply),n=["MOVE","Stock","Stock","1"],r.Parse(n,0),l.push(r)):this.CardSupply.GetPile("Waste").Count>0&&(!this.IsNumDecksLimited()||this.PassesThroughDeck<2)&&(r=new d(this.CardSupply),n=["MOVE","Stock","Stock","1"],r.Parse(n,0),l.push(r)),!t&&l.length>0)return l[0];for(e=0;e<4;e++){var h=this.CardSupply.GetPile("Foundation"+e);if(null!=h&&!h.Empty)for(var u=!1,c=h.Top.Value+1,p=h.Top.Suit,g=0;g<7&&!u;g++)for(var f=this.CardSupply.GetPile("Tableau"+g),y=1;y<=f.Count&&!u;y++){var m=f.NthFromTop(y);if(m.Value==c&&m.Suit==p){var C=f.NthFromTop(y-1);u=!0;for(var S=0;S<7;S++){var b=this.CardSupply.GetPile("Tableau"+S);this.TableauCanTakeCard(b,C)&&(r=new d(this.CardSupply),n=["MOVE",f.Name,b.Name,(y-1).toString()],r.Parse(n,0),l.push(r))}}}}if(!t&&l.length>0)return l[0];if(l.length>0){if(!t)return l[0];if(t){if(null!=this.LastHint){var v;for(v=0;v<l.length&&!l[v].Equals(this.LastHint);v++);if(v>=l.length-1){var r=l[0];return this.LastHint=r,r}return r=l[v+1],this.LastHint=r,r}return r=l[0],this.LastHint=r,r}}return new d(this.CardSupply)},g.prototype.GetCardHint=function(t){var e,i,n=t.Pile,r=new d(this.CardSupply),o=n.GetCardPosFromEnd(t),a=o.toString(),l=parseInt(n.Name[n.Name.length-1]);if("Tableau"===n.Type){if(1===o)for(e=0;e<4;e++)if(i=this.CardSupply.GetPile("Foundation"+e),this.FoundationCanTakeCard(i,t,!1))return r.Parse(["MOVE",n.Name,i.Name,a],0),r;if(n.Bottom===t&&t.Value===s.Values.King&&this.CardSupply.GetPile("FaceDown"+l).Empty)return;for(e=l+1;e<7;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t,!1))return r.Parse(["MOVE",n.Name,i.Name,a],0),r;for(e=0;e<l;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t,!1))return r.Parse(["MOVE",n.Name,i.Name,a],0),r}else if("Waste"===n.Type){for(e=0;e<4;e++)if(i=this.CardSupply.GetPile("Foundation"+e),this.FoundationCanTakeCard(i,t))return r.Parse(["MOVE",n.Name,i.Name,a],0),r;for(e=0;e<7;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t,!1))return r.Parse(["MOVE",n.Name,i.Name,a],0),r}},g.prototype.GetAutomaticMove=function(){return null},g.prototype.CurrentMoveState=function(){var t=this.GetHintInternal(!0),e=this.CardSupply.GetPile("Stock").Count;if(this.lastStockCount!=e&&this.CardSupply.GetPile("Waste").Count>0&&this.lastStockCount>0&&0==e){if(this.PassesThroughDeck>0&&!this.availableMovesSinceLastPassThroughDeck)return c.NoMovesLeft;this.availableMovesSinceLastPassThroughDeck=!1}return this.lastStockCount=e,t.Opcode!=d.Op.Noop&&"Stock"!=t.GetPile(d.eMoveParams.SourcePile).Name&&"Stock"!=t.GetPile(d.eMoveParams.DestPile).Name&&(this.availableMovesSinceLastPassThroughDeck=!0),this.CardSupply.WaitingForAnimation||this.IsGameWon()?c.CanMove:t.Opcode!=d.Op.Noop||this.CardSupply.WaitingForAnimation?c.CanMove:c.NoMovesLeft},g.prototype.ResetNoMoreMovesState=function(){this.IsNumDecksLimited()||(this.PassesThroughDeck=0)},g.prototype.TriggerTip=function(t){null!=this.OnTip&&this.OnTip(this,t)},g.prototype.OnRunAction=function(t,e,i){var n=t.Ops[0];if(n.Opcode==d.Op.Move){var r=n.GetPile(d.eMoveParams.SourcePile),o=n.GetPile(d.eMoveParams.DestPile);if("Waste"!=r.Type||"Foundation"!=o.Type&&"Tableau"!=o.Type?this.CurrentCardsUsedFromWaste=0:this.CurrentCardsUsedFromWaste=Math.max(0,e?this.CurrentCardsUsedFromWaste-1:this.CurrentCardsUsedFromWaste+1),this.MaxCardsUsedFromWaste=Math.max(this.CurrentCardsUsedFromWaste,this.MaxCardsUsedFromWaste),"Foundation"==r.Type||"Foundation"!=o.Type||e)this.IceCastleCheck=[];else if(null!=o.Top){var a=o.Top.Value;-1!=this.IceCastleCheck.indexOf(a)?this.IceCastleCheck=[]:a==s.Values.King||a==s.Values.Queen||a==s.Values.Jack?(this.IceCastleCheck.push(a),3==this.IceCastleCheck.length&&(this.CompletedIceCastle=!0)):this.IceCastleCheck=[]}}},g.prototype.OnRunSpecialAction=function(t,e){0!=(t&g.TAG_PASSTHROUGHDECK)&&(e?this.IsNumDecksLimited()&&(this.PassesThroughDeck--,this.availableMovesSinceLastPassThroughDeck=!0):this.PassesThroughDeck++)},g.prototype.OnGameOver=function(t,e){var i=this.GetBonusScore(this.CardSupply.TimePlayed);this.CardSupply.Score+=i,this.CardSupply.CumulativeScore=this.CardSupply.Score},g.prototype.IsNumDecksLimited=function(){return this.CardSupply.GetOption("Scoring")!=g.STANDARD},g.prototype.GenerateDealData=function(){var t,e,i=0,n="",r=[];for(e=this.ProcessDealDataForPile("Stock",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("Waste",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,t=3;t>=0;t--)e=this.ProcessDealDataForPile("Foundation"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;for(t=6;t>=0;t--)e=this.ProcessDealDataForPile("Tableau"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("FaceDown"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;return n="BEGIN "+n+"END",new p(a.ConstructSeedFromDeck(r,this.CardSupply.Count).ToString(),n)},g.prototype.AddExtraDeals=function(t,e){},g.prototype.AddWildCard=function(t){},g.prototype.ApplyCurrentOptInAdBonus=function(t){},g.prototype.ProcessDealDataForPile=function(t,e,i,n){var r=this.CardSupply.GetPile(t);return null==r||r.Empty||(_.forEach(r.GetCards(),function(t){e[n++]=t.Sequence}),i="MOVE Root "+t+" "+r.Count+" "+i),{deck:e,script:i,currentIndex:n}},g.prototype.ForceDealScript=function(t){this.DealScript=null!=t?t:g.DefaultDealScript},g.DefaultDealScript="BEGIN MOVE Root Stock 52 MOVE Stock Tableau0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau5 1 MOVE Stock FaceDown6 1 MOVE Stock Tableau6 1 END",g}),define("SolitaireShared/CardLogic/IDailyAuthority",[],function(){var t=function(){this.TotalMoves=0,this.TimerEnabled=0,this.MovesAllowed=0,this.StartingTime=0,this.DeckSeeds=[],this.ChallengeType=t.ChallengeType.Unknown,this.SetDealScript=function(t){},this.SetNumBoardsCompleted=function(t){}};return t.ChallengeType={AchieveScore:0,BuildStacks:1,CardToCard:2,ClearBoards:3,ClearRows:4,PlayCard:5,PlayValues:6,SolveGame:7,Unknown:8},t}),define("SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority",["SolitaireShared/KlondikeLogic/KlondikeAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){var r=function(){this.initIDailyKlondikeAuthority()};return r.constructor=r,r.prototype=Object.create(t.prototype),e.call(r.prototype),r.prototype.initIDailyKlondikeAuthority=function(){t.call(this),this.MovesAllowed=0,this._startingTime=0,this.ChallengeType=e.ChallengeType.Unknown,this.DeckSeeds=[],this.IsChallenge=!0,this.TotalMoves=0},r.prototype.GetScoreForTimer=function(t,e){return 0},r.prototype.GetStartingTime=function(){return this._startingTime},r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var o=e.Ops[n];this.MovesAllowed>0&&0==e.GetActionUndoCount()&&o.Opcode!=i.Op.Noop&&o.Opcode!=i.Op.Deal&&(e.Tag=(e.Tag|r.TAG_MOVEPERFORMED)>>>0)}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){this.MovesAllowed>0&&!(e&t.TAG_PASSTHROUGHDECK)&&(this.TotalMoves+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return this.IsGameWonPrivate()},r.prototype.GetIsGameWon=function(){return this.IsGameWonPrivate()},r.prototype.IsGameWonPrivate=function(){return this.MovesAllowed>0?t.prototype.IsGameWon.call(this)&&this.TotalMoves<=this.MovesAllowed+1:t.prototype.IsGameWon.call(this)},r.prototype.CurrentMoveState=function(){return this.MovesAllowed>0&&!this.CardSupply.WaitingForAnimation?this.GetCurrentMoveState():t.prototype.CurrentMoveState.call(this)},r.prototype.GetCurrentMoveState=function(){return this.TotalMoves>this.MovesAllowed+1?n.NoMovesLeft:this.TotalMoves==this.MovesAllowed+1?this.IsGameWon()?n.CanMove:n.NoMovesLeft:t.prototype.CurrentMoveState.call(this)},r.prototype.GetHint=function(e,n){return e=!!e,n?t.prototype.GetHint.call(this,e,n):new i(this.CardSupply)},r.prototype.Deal=function(){return this.TotalMoves=0,this.DeckSeeds.length>0&&(this.CardSupply.DeckSeed=this.DeckSeeds[0]),t.prototype.Deal.call(this)},r.prototype.SetDealScript=function(t){this.DealScript=t},r.prototype.SetNumBoardsCompleted=function(t){},r.TAG_MOVEPERFORMED=1073741824,Object.defineProperty(r.prototype,"TimerEnabled",{get:function(){return 0!=this._startingTime}}),Object.defineProperty(r.prototype,"StartingTime",{get:function(){return this._startingTime},set:function(t){this._startingTime=t,this.CardSupply.IsTimerCountdown=0!=this._startingTime}}),r}),define("SolitaireShared/CardLogic/IPlayCardDailyAuthority",[],function(){return function(){this.NumberPlayed=0,this.SuppressClearHintsOnMouseDown=!0}}),define("SolitaireShared/KlondikeLogic/ChallengeAuthorities/PlayCardDailyKlondikeAuthority",["SolitaireShared/KlondikeLogic/KlondikeAuthority","SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IPlayCardDailyAuthority","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n,r){var o=function(t){this.initPlayCardDailyKlondikeAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this.CardPlayed()?1:0}}),o.KeyCardToPlay="CARDTOPLAY",o.prototype.initPlayCardDailyKlondikeAuthority=function(t){if(e.call(this),null==t||!t[o.KeyCardToPlay])throw"Invalid parameter passed in creating Daily Challenge";this._cardToPlay=this.GetCardValue(t[o.KeyCardToPlay].toUpperCase()),this.ChallengeType=i.ChallengeType.PlayCard},o.prototype.CardPlayed=function(){for(var t=0;t<4;t++){var e=this.CardSupply.GetPile("Foundation"+t);if(!e.Empty&&e.Top.ToString()==this._cardToPlay)return!0}return!1},o.prototype.IsGameWon=function(){return this.GetIsGameWon()},o.prototype.GetIsGameWon=function(){return this.CardPlayed()},o.prototype.GetHint=function(t,i){if(i)return e.prototype.GetHint.call(this,t,i);t=!!t;for(var n=[],o=["CHALLENGE"],a=6;a>=0;a--){var s=this.CardSupply.GetPile("Tableau"+a);if(!s.Empty)for(var l=s.GetCards(),h=0;h<l.length;h++){var u=l[h];if(u.ToString()==this._cardToPlay){o.push(u.Sequence.toString());break}}}if(o.length<=1){var s=this.CardSupply.GetPile("Waste");if(!s.Empty){var d=s.Top;d.ToString()==this._cardToPlay&&o.push(d.Sequence.toString())}}if(o.length>1){var c=new r(this.CardSupply);c.Parse(o,0),n.push(c)}return n.length>0?n[0]:new r(this.CardSupply)},o.prototype.GetCardValue=function(t){return t},o}),define("SolitaireShared/CardLogic/IPlayValuesDailyAuthority",[],function(){"use strict";return function(){this.SuppressClearHintsOnMouseDown=!0}}),define("SolitaireShared/KlondikeLogic/ChallengeAuthorities/PlayValuesKlondikeAuthority",["SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority","SolitaireShared/CardLogic/IPlayValuesDailyAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardValue"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayValuesDailyKlondikeAuthority(t)};o.KeyNumToPlay="NUMTOPLAY",o.KeyValueToPlay="VALUETOPLAY";return o.constructor=o,o.prototype=Object.create(t.prototype),e.call(o.prototype),o.prototype.initPlayValuesDailyKlondikeAuthority=function(e){t.call(this,e),this._hasWon=!1,this.numPlayed=0;var i=!0;if(null!=e&&e[o.KeyNumToPlay]&&e[o.KeyValueToPlay]&&(i=!1,this.NumToPlay=parseInt(e[o.KeyNumToPlay]),this.ValueToPlay=r.getValue(e[o.KeyValueToPlay]),!isNaN(this.NumToPlay)&&this.ValueToPlay||(i=!0),i))throw"Invalid parameter passed in creating Daily Challenge"},Object.defineProperty(o.prototype,"ChallengeType",{get:function(){return i.ChallengeType.PlayValues}}),Object.defineProperty(o.prototype,"Value",{get:function(){return this.ValueToPlay}}),Object.defineProperty(o.prototype,"NumberToPlay",{get:function(){return this.NumToPlay}}),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){for(var t=0,e=0;e<4;e++){var i=this.CardSupply.GetPile("Foundation"+e);!i.Empty&&i.Top.Value>=this.ValueToPlay&&t++}return t}}),o.prototype.Reset=function(){this._numPlayed=0,t.prototype.Reset.call(this)},o.prototype.GetScoreForAction=function(e){for(var i=0;i<e.Ops;i++){var r=e.Ops[i],o=r.GetPile(n.eMoveParams.DestPile),a=r.GetPile(n.eMoveParams.SourcePile);if(r.Opcode==n.Op.Move&&"Foundation"==o.Type&&o.NthFromTop(r.GetNumber(n.eMoveParams.NumCards)).Value==this.ValueToPlay){e.Tag=(65536|e.Tag)>>>0;break}if(r.Opcode==n.Op.Move&&"Tableau"==o.Type&&"Foundation"==a.Type&&o.NthFromTop(r.GetNumber(n.eMoveParams.NumCards)).Value==this.ValueToPlay){e.Tag=69905;break}}return t.prototype.GetScoreForAction.call(this,e)},o.prototype.OnRunSpecialAction=function(e,i){65536==e&&(this._numPlayed+=i?-1:1),69905==e&&(this._numPlayed-=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},o.prototype.IsGameWon=function(){return this.GetIsGameWon()&&!this.CardSupply.WaitingForAnimation},o.prototype.GetIsGameWon=function(){return this.NumberPlayed>=this.NumToPlay},o.prototype.GetHint=function(e,i){if(i)return t.prototype.GetHint.call(this,e,i);e=!!e;var r,o=[];this.CardSupply.GetPile("Foundation");for(var a=["CHALLENGE"],s=6;s>=0;s--)if(r=this.CardSupply.GetPile("Tableau"+s),!r.Empty)for(var l=r.GetCards(),h=0;h<l.length;h++){var u=l[h];u.Value==this.ValueToPlay&&a.push(u.Sequence.toString())}if(r=this.CardSupply.GetPile("Waste"),!r.Empty){var u=r.Top;u.Value==this.ValueToPlay&&a.push(u.Sequence.toString())}if(a.length>1){var d=new n(this.CardSupply);d.Parse(a,0),o.push(d)}return o.length>0?o[0]:new n(this.CardSupply)},o}),define("SolitaireShared/CardLogic/IAchieveScoreDailyAuthority",[],function(){"use strict";return function(){this.ScoreRequired=0}}),define("SolitaireShared/KlondikeLogic/ChallengeAuthorities/AchieveScoreDailyKlondikeAuthority",["SolitaireShared/KlondikeLogic/KlondikeAuthority","SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IAchieveScoreDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants"],function(t,e,i,n,r){"use strict";var o=function(t){this.initAchieveScoreDailyKlondikeAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),o.prototype.initAchieveScoreDailyKlondikeAuthority=function(t){if(e.call(this),null==t||!t[r.KeyScoreRequired])throw"Invalid parameter passed in creating Daily Challenge";this.ScoreRequired=parseInt(t[r.KeyScoreRequired]),this.ChallengeType=i.ChallengeType.AchieveScore},o.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.GetIsGameWon()},o.prototype.GetIsGameWon=function(){return this.CardSupply.Score>=this.ScoreRequired},o}),define("SolitaireShared/KlondikeLogic/ChallengeAuthorities/CardToCardDailyKlondikeAuthority",["SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(t){this.initCardToCardDailyKlondikeAuthority(t)};return r.constructor=r,r.prototype=Object.create(t.prototype),r.prototype.initCardToCardDailyKlondikeAuthority=function(e){if(t.call(this,e),this.GoalCompleted=!1,null==e||!e.STACKCARD||!e.BASECARD)throw"Invalid parameter passed in creating Daily Challenge";this.StackCard=e.STACKCARD.toUpperCase(),this.BaseCard=e.BASECARD.toUpperCase()},Object.defineProperty(r.prototype,"ChallengeType",{get:function(){return e.ChallengeType.CardToCard}}),r.prototype.Deal=function(){return this.GoalCompleted=!1,t.prototype.Deal.call(this)},r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var r=e.Ops[n],o=r.GetPile(i.eMoveParams.DestPile);if(r.Opcode==i.Op.Move&&"Tableau"==o.Type&&o.Count>r.GetNumber(i.eMoveParams.NumCards)&&o.NthFromTop(r.GetNumber(i.eMoveParams.NumCards)).ToString().Equals(this.StackCard)&&o.NthFromTop(r.GetNumber(i.eMoveParams.NumCards)+1).ToString().Equals(this.BaseCard)){e.Tag=(2|e.Tag)>>>0;break}}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){(2&e)>>>0!=0&&(this.GoalCompleted=!0),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.GoalCompleted},r.prototype.CurrentMoveState=function(){return!this.IsGameWon()&&t.prototype.IsGameWon.call(this)?n.NoMovesLeft:t.prototype.CurrentMoveState.call(this)},r}),define("SolitaireShared/KlondikeLogic/ChallengeAuthorities/SolveGameDailyKlondikeAuthority",["SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority"],function(t){"use strict";var e=function(t){this.initSolveGameDailyKlondikeAuthority(t)};return e.constructor=e,e.prototype=Object.create(t.prototype),e.prototype.initSolveGameDailyKlondikeAuthority=function(){t.call(this)},e}),define("Solitaire/DailyChallenges/KlondikeChallenge",["lodash","absolute/stringmanager","absolute/textutils","CardUI/IChallengeDefinition","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/Card","SolitaireShared/KlondikeLogic/ChallengeAuthorities/PlayCardDailyKlondikeAuthority","SolitaireShared/KlondikeLogic/ChallengeAuthorities/PlayValuesKlondikeAuthority","SolitaireShared/KlondikeLogic/ChallengeAuthorities/AchieveScoreDailyKlondikeAuthority","SolitaireShared/KlondikeLogic/ChallengeAuthorities/CardToCardDailyKlondikeAuthority","SolitaireShared/KlondikeLogic/ChallengeAuthorities/SolveGameDailyKlondikeAuthority"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(t,e,i){this.initKlondikeChallenge(t,e,i)};return d.constructor=d,d.prototype=Object.create(n.prototype),d.GoalType={SolveGame:0,AchieveScore:1,CardToCard:2,PlayCard:3,PlayValues:4},d.prototype.GoalType=d.GoalType,d.prototype.initKlondikeChallenge=function(t,e,i){n.call(this,t,e,i)},d.prototype.ConstructAuthority=function(){var t=d.AuthorityTypes[this.ChallengeType](this.Parameters);return this.SetupOptionsForAuthority(t),t},d.prototype.SetupOptionsForAuthority=function(t){t.CardSupply.SetOption("SCORING",this.Parameters.SCORING),t.CardSupply.SetOption("DRAW",this.Parameters.DRAW),n.prototype.SetupOptionsForAuthority.call(this,t)},d.prototype.GetGoalDescription=function(){try{switch(this.ChallengeType){case d.GoalType.SolveGame:return e(this.CompleteGoalLocString("DailyChallengeGoal_SolveDeck"),[this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves,this.AllowedMoves]);case d.GoalType.AchieveScore:return e(this.CompleteGoalLocString("DailyChallengeGoal_AchieveScore"),[i.formatInt(this.Parameters[r.KeyScoreRequired]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves,this.AllowedMoves]);case d.GoalType.PlayCard:return e(this.CompleteGoalLocString("DailyChallengeGoal_PlayCardToFoundation"),[o.GetSymbolStringFromShortName(this.Parameters[a.KeyCardToPlay]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves,this.AllowedMoves]);case d.GoalType.PlayValues:var t=0,n=o.GetLongValueName(this.Parameters[s.KeyValueToPlay]),l=this.Parameters[s.KeyNumToPlay],t=parseInt(l),h="Card_"+n;return!isNaN(t)&&t>1&&("SIX"==n.toUpperCase()?h+="es":h+="s"),n=e(h),e(this.CompleteGoalLocString("DailyChallengeGoal_PlayValuesToFoundation"),[t,n,this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves]);default:return""}}catch(t){return""}},d.prototype.GetChallengeIconUrl=function(){return"klondike_challenge_btn_up.png"},d.prototype.GetModeName=function(){return"Klondike"},d.prototype.GetShortGoalDescription=function(){switch(this.ChallengeType){case d.GoalType.SolveGame:return e(this.AllowedMoves>0?"Moves_Solve_Challenge":this.AllowedTime>0?"Timed_Solve_Challenge":"Solve_Challenge");case d.GoalType.PlayValues:case d.GoalType.PlayCard:return e(this.AllowedMoves>0?"Moves_Card_Challenge":this.AllowedTime>0?"Timed_Card_Challenge":"DCTile_Card_Challenge");case d.GoalType.AchieveScore:return e(this.AllowedMoves>0?"Moves_Score_Challenge":this.AllowedTime>0?"Timed_Score_Challenge":"Score_Challenge");default:return""}},d.MakeSolveAuthority=function(t){return new u(t)},d.MakeScoreAuthority=function(t){return new l(t)},d.MakeCardToCardAuthority=function(t){return new h(t)},d.MakePlayCardAuthority=function(t){return new a(t)},d.MakePlayValuesAuthority=function(t){return new s(t)},d.FromDictionary=function(e){var i=parseInt(e.Data.CHDEF_ChallengeType),n={};t.forEach(e.Data,function(t,e){if(0==e.indexOf("PARAM_")){var i=e.substring(6);n[i]=t}});var r=new d(i,n,e);return r.FromDictionaryInternal(e.Data),r},d.FirstParameters={SolveGame:null,AchieveScore:"ScoreRequired",CardToCard:"StackCard",PlayCard:"CardToPlay",PlayValues:"NumToPlay"},d.SecondParameters={SolveGame:null,AchieveScore:null,CardToCard:"BaseCard",PlayCard:null,PlayValues:"ValueToPlay"},d.AuthorityTypes=[d.MakeSolveAuthority,d.MakeScoreAuthority,d.MakeCardToCardAuthority,d.MakePlayCardAuthority,d.MakePlayValuesAuthority],d}),define("Arkadium/GameEngine/Scenes/Nodes/SpriteNode",["lodash","pixi","util/list","util/eventhandler","absolute"],function(t,e,i,n,r){var o=function(t){this.initSpriteNode(t)};return o.prototype.constructor=o,o.prototype=Object.create(e.DisplayObjectContainer.prototype),o.ObjectId=0,o.prototype.initSpriteNode=function(t){e.DisplayObjectContainer.call(this,t),this.Id=++o.ObjectId,this.PointDown=this.MouseDown=new n,this.PointUp=this.MouseUp=new n,this.mousedown=this.handlePointDown.bind(this),this.touchstart=this.handlePointDown.bind(this),this.mouseup=this.handlePointUp.bind(this),this.touchend=this.handlePointUp.bind(this),r.Platform._isMac()&&r.Platform._isIOS()&&(this.mousedown=null,this.mouseup=null),this.TextureAlphaEnabled=!1,this.layer=0,this._layerWhileAnimating=0,this.IsLoaded=!1,t&&(this.sprite=e.Sprite.fromFrame(t),this.sprite.anchor.x=this.sprite.anchor.y=.5,this.addChild(this.sprite))},o.prototype.handlePointDown=function(t){this.PointDown.handleEvent(this,t),t.originalEvent.stopPropagation()},o.prototype.handlePointUp=function(t){this.PointUp.handleEvent(this,t),t.originalEvent.stopPropagation()},o.prototype.Register=function(t){this.Scene=t},Object.defineProperty(o.prototype,"Parent",{get:function(){return this.parent}}),Object.defineProperty(o.prototype,"InputEnabled",{get:function(){return this.interactive},set:function(t){this.interactive=t}}),Object.defineProperty(o.prototype,"Visible",{get:function(){return this.visible},set:function(t){this.visible=t}}),Object.defineProperty(o.prototype,"Layer",{get:function(){return this.layer},set:function(t){this.layer=t}}),Object.defineProperty(o.prototype,"LayerWhileAnimating",{get:function(){return this._layerWhileAnimating},set:function(t){this._layerWhileAnimating=t}}),Object.defineProperty(o.prototype,"Position",{get:function(){return this.position},set:function(t){this.position.x=t.x,this.position.y=t.y}}),Object.defineProperty(o.prototype,"X",{get:function(){return this.position.x},set:function(t){this.position.x!=t&&(this.position.x=t)}}),Object.defineProperty(o.prototype,"Y",{get:function(){return this.position.y},set:function(t){this.position.y!=t&&(this.position.y=t)}}),Object.defineProperty(o.prototype,"Scale",{get:function(){return this.scale},set:function(t){this.scale.x=t.x,this.scale.y=t.y}}),Object.defineProperty(o.prototype,"Rotation",{get:function(){return this.rotation},set:function(t){this.rotation=t}}),Object.defineProperty(o.prototype,"ScaleX",{get:function(){return this.scale.x},set:function(t){this.scale.x=t}}),Object.defineProperty(o.prototype,"ScaleY",{get:function(){return this.scale.y},set:function(t){this.scale.y=t}}),Object.defineProperty(o.prototype,"ScaleUniform",{set:function(t){this.scale.x=this.scale.y=t}}),Object.defineProperty(o.prototype,"Width",{get:function(){return this.width}}),Object.defineProperty(o.prototype,"Height",{get:function(){return this.height}}),Object.defineProperty(o.prototype,"Alpha",{get:function(){return this.alpha},set:function(t){this.alpha=t}}),o.prototype.AddChild=function(t){this.addChild(t)},o.prototype.AddChildAt=function(t,e){this.addChildAt(t,e)},o.prototype.RemoveChild=function(t){this.removeChild(t)},o.prototype.SetTexture=function(t){t&&(this.sprite?this.sprite.setTexture(e.Texture.fromFrame(t)):(this.sprite=e.Sprite.fromFrame(t),this.sprite.anchor.x=this.sprite.anchor.y=.5,this.addChild(this.sprite)),this.IsLoaded=!0)},o.prototype.Init=function(t){"function"==typeof t&&t()},o.prototype.UpdateInternal=function(t){},o.prototype.Update=function(t,e){if(this.Updated&&this.Updated.handleEvent(this,t),this.UpdateInternal(t,e),this.children)for(var i=0;i<this.children.length;i++)this.children[i].Update&&this.children[i].Update(t,e)},o.prototype.ToGlobal=function(t){return this.toGlobal(t)},o.prototype.SetPosition=function(t){this.position.x=t.x,this.position.y=t.y},o.prototype.SetScale=function(t){this.scale.x=t.x,this.scale.y=t.y},o.prototype.SetRotation=function(t){this.rotation=t},o}),define("Arkadium/GameEngine/Maths/Vector2",["pixi"],function(t){"use strict";var e=function(t,e){this.initVector2(t,e)};return e.constructor=e,e.prototype=Object.create(t.Point.prototype),e.prototype.initVector2=function(e,i){e=e||0,i=i||0,t.Point.call(this,e,i)},Object.defineProperty(e.prototype,"X",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(e.prototype,"Y",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(e.prototype,"LengthSquared",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(e.prototype,"Length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=new e(0,0),e}),define("Arkadium/GameEngine/Tween/Tween",["lodash","pixi","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Maths/Vector2"],function(t,e,i,n){var r=function(t,e,i,n,r){return i+(n-i)*t(e/r)},o=function(t,i,n,r,o){var a=new e.Point,s=r.x-n.x,l=r.y-n.y;return a.x=n.x+s*t(i/o),a.y=n.y+l*t(i/o),a},a=function(t,e){this.initTween(t,e)};a.TweenableProperty={Scale:0,Scale_X:1,Scale_Y:2,Scale_Z:3,Position:4,Position_X:5,Position_Y:6,Position_Z:7,Rotation:8,Rotation_X:9,Rotation_Y:10,Rotation_Z:11,Alpha:12,Color:13,Color_R:14,Color_G:15,Color_B:16,Custom:17},a.TweenProperties=function(){this.initTweenProperties()},a.TweenProperties.prototype.initTweenProperties=function(){this.FrameBased=!1,this.NumLoops=0},a.DurationEpsilon=1e-6,a.SyncDurations=-1,a.InfiniteLoops=-1,a.TweenByOperation={Default:0,Add:1,Multiply:2},a.ActiveTweens={},a.prototype.initTween=function(t,e){null==a.ActiveTweens&&(a.ActiveTweens={}),this.Target=t,this.Properties=e||new a.TweenProperties,this.Steps=[],this.CurrentStep=-1,this.CombineNext=!1},a.Start=function(t,e){var i=new a(t,e);return a.AddTween(t,i),i},a.prototype.Stop=function(t){t=!!t,a.RemoveTween(this.Target,this),t&&null!=this.Completed&&this.Completed(this,this.Target)},a.StopAll=function(e,i){if("boolean"==typeof e)return a.StopAllNoTarget(e);var n=a.GetTweens(e);t.forEach(n,function(t){t.Stop(i)}),null!=a.ActiveTweens&&a.ActiveTweens[e.Id.toString()]&&delete a.ActiveTweens[e.Id.toString]},a.StopAllNoTarget=function(e){null!=a.ActiveTweens&&(t.forEach(a.ActiveTweens,function(i){t.forEach(i,function(t){t.Stop(e)})}),a.ActiveTweens={})},a.GetTweens=function(t){if(null==a.ActiveTweens)return[];var e=a.ActiveTweens[t.Id.toString()];return null==e?[]:e.slice(0)},a.AddTween=function(t,e){var i=a.ActiveTweens[t.Id.toString()];null==i&&(i=[],a.ActiveTweens[t.Id.toString()]=i),i.push(e)},a.RemoveTween=function(t,e){var i=a.ActiveTweens[t.Id.toString()];if(null!=i){var n=i.indexOf(e);-1!=n&&(i.splice(n,1),0==i.length&&delete a.ActiveTweens[t.Id.toString()])}},a.RemoveAll=function(){null!=a.ActiveTweens&&t.forEach(a.ActiveTweens,function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];this.RemoveTween(i.Target,i)}},this)},a.UpdateAll=function(){null!=a.ActiveTweens&&t.forEach(a.ActiveTweens,function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];t[e].Update(i.Target)}})},a.prototype.Update=function(e,n){var r=e;-1==this.CurrentStep&&this.NextStep();var o=this.Steps[this.CurrentStep],a=!0;t.forEach(o,function(t){if(!t.Completed){var e=this.UpdateStep(t,i.Time);a=a&&e,null!=t.Update&&t.Update(r,i.Time)}},this),null!=this.Updated&&this.Updated(this),a&&this.NextStep()},a.prototype.And=function(){return this.CombineNext=!0,this},a.prototype.Then=function(){return this},a.prototype.To=function(t,i,n,a){var h;return h=i instanceof e.Point?o:r,this.ToInternal(s,l,h,t,i,n,a)},a.prototype.CustomTo=function(t,i,n,s,l){var h=r;return n instanceof e.Point&&(h=o),this.ToInternal(t,i,h,a.TweenableProperty.Custom,n,s,l)},a.prototype.ToInternal=function(t,e,i,n,r,o,s){s=s||TWEEN.Easing.Linear.None;var l=new h;return l.Duration=o<a.DurationEpsilon?a.DurationEpsilon:o,Math.abs(l.Duration-a.SyncDurations)<a.DurationEpsilon&&(l.Duration=0!=this.Steps.length&&0!=this.Steps[this.Steps.length-1].length?this.Steps[this.Steps.length-1][this.Steps[this.Steps.length-1].length-1].Duration:a.DurationEpsilon),l.Init=function(t){this.start=e(t,n),this.end=r},l.Update=function(e,r){t(e,n,i(s,this.Elapsed,this.start,this.end,this.Duration))},this.AddStep(l),this},a.prototype.By=function(t,i,n,h,u){var d=r;i instanceof e.Point&&(d=o),u=u==a.TweenByOperation.Default?this.GetDefaultTweenByOperationForProperty(t):u;var c=null;switch(u){case a.TweenByOperation.Add:c=function(t,e){return t+e};break;case a.TweenByOperation.Multiply:c=function(t,e){return t*e}}return this.ByInternal(s,l,d,c,t,i,n,h)},a.prototype.ByInternal=function(t,e,i,n,r,o,s,l){l=l||TWEEN.Easing.Linear.None;var u=new h;return u.Duration=s<a.DurationEpsilon?a.DurationEpsilon:s,Math.abs(u.Duration-a.SyncDurations)<a.DurationEpsilon&&(u.Duration=0!=this.Steps.length&&0!=this.Steps[this.Steps.length-1].length?this.Steps[this.Steps.length-1][this.Steps[this.Steps.length-1].length-1].Duration:a.DurationEpsilon),u.Init=function(t){this.start=e(t,r),this.end=n(this.start,o)},u.Update=function(e,n){t(e,r,i(l,this.Elapsed,this.start,this.end,this.Duration))},this.AddStep(u),this},a.prototype.Call=function(t){var e=new h
;return e.Update=function(e,i){t(e)},this.AddStep(e),this},a.prototype.CallTween=function(t){var e=new h;return e.Update=function(e,i){t(e)},this.AddStep(e),this},a.prototype.Wait=function(t){var e=new h;return e.Duration=t<a.DurationEpsilon?a.DurationEpsilon:t,this.AddStep(e),this},a.prototype.MoveTo=function(t,e,i){return this.To(a.TweenableProperty.Position,t,e,i)},a.prototype.MoveByBezier=function(t,e,i){var r=0,o=new n(0,0);return this.CustomTo(function(e,i,n){r=n;var a=t.PositionAt(r);e.X+=a.X-o.X,e.Y+=a.Y-o.Y,o.X=a.X,o.Y=a.Y},function(t,e,i){return r},1,e,i)},a.prototype.ScaleTo=function(t,e,i){return this.To(a.TweenableProperty.Scale,t,e,i)},a.prototype.FadeTo=function(t,e,i){return this.To(a.TweenableProperty.Alpha,t,e,i)},a.prototype.RotateTo=function(t,e,i){return i=i||null,this.To(a.TweenableProperty.Rotation,t,e,i)},a.prototype.RotateBy=function(t,e,i,n){return i=i||null,n=n||a.TweenByOperation.Default,this.By(a.TweenableProperty.Rotation,t,e,i,n)};var s=function(t,e,i){switch(e){case a.TweenableProperty.Alpha:t.Alpha=i;break;case a.TweenableProperty.Position_X:t.X=i;break;case a.TweenableProperty.Position_Y:t.Y=i;break;case a.TweenableProperty.Position_Z:t.Z=i;break;case a.TweenableProperty.Scale_X:t.ScaleX=i;break;case a.TweenableProperty.Scale_Y:t.ScaleY=i;break;case a.TweenableProperty.Scale_Z:t.ScaleZ=i;break;case a.TweenableProperty.Rotation_X:t.RotationX=i;break;case a.TweenableProperty.Rotation_Y:t.RotationY=i;break;case a.TweenableProperty.Rotation_Z:t.RotationZ=i;break;case a.TweenableProperty.Color_R:case a.TweenableProperty.Color_G:case a.TweenableProperty.Color_B:break;case a.TweenableProperty.Position:t.SetPosition(i);break;case a.TweenableProperty.Scale:t.SetScale(i);break;case a.TweenableProperty.Rotation:t.SetRotation(i);break;default:throw"Property Type "+e.ToString()+" is not implemented or property is not a float"}},l=function(t,e){var i=0;switch(e){case a.TweenableProperty.Alpha:i=t.Alpha;break;case a.TweenableProperty.Position_X:i=t.X;break;case a.TweenableProperty.Position_Y:i=t.Y;break;case a.TweenableProperty.Position_Z:i=t.Z;break;case a.TweenableProperty.Scale_X:i=t.ScaleX;break;case a.TweenableProperty.Scale_Y:i=t.ScaleY;break;case a.TweenableProperty.Scale_Z:i=t.ScaleZ;break;case a.TweenableProperty.Rotation_X:i=t.RotationX;break;case a.TweenableProperty.Rotation_Y:i=t.RotationY;break;case a.TweenableProperty.Rotation_Z:i=t.RotationZ;break;case a.TweenableProperty.Color_R:case a.TweenableProperty.Color_G:case a.TweenableProperty.Color_B:i=0;break;case a.TweenableProperty.Position:i=t.Position;break;case a.TweenableProperty.Scale:i=t.Scale;break;case a.TweenableProperty.Rotation:i=t.Rotation;break;default:throw"Property Type "+e.ToString()+" is not implemented or property is not a float"}return i};a.prototype.GetDefaultTweenByOperationForProperty=function(t){switch(t){case a.TweenableProperty.Alpha:case a.TweenableProperty.Color:case a.TweenableProperty.Color_B:case a.TweenableProperty.Color_G:case a.TweenableProperty.Color_R:case a.TweenableProperty.Position:case a.TweenableProperty.Position_X:case a.TweenableProperty.Position_Y:case a.TweenableProperty.Position_Z:case a.TweenableProperty.Rotation:case a.TweenableProperty.Rotation_X:case a.TweenableProperty.Rotation_Y:case a.TweenableProperty.Rotation_Z:return a.TweenByOperation.Add;case a.TweenableProperty.Scale:case a.TweenableProperty.Scale_X:case a.TweenableProperty.Scale_Y:case a.TweenableProperty.Scale_Z:return a.TweenByOperation.Multiply}throw"No default operation for property: "+t},a.prototype.NextStep=function(){var e=++this.CurrentStep>=this.Steps.length,i=!1;if(e&&(i=-1==this.Properties.NumLoops||0!=this.Properties.NumLoops--,this.CurrentStep=i?0:this.CurrentStep),e&&!i)this.Stop(!0);else{var n=this.Steps[this.CurrentStep];t.forEach(n,function(t){t.Clear(),null!=t.Init&&t.Init(this.Target)},this)}},a.prototype.UpdateStep=function(t,e){var i=this.Properties.FrameBased?1:e.ElapsedGameTime.TotalSeconds;return t.Elapsed+i>=t.Duration&&(i=t.Duration-t.Elapsed,t.Completed=!0),t.Elapsed+=i,t.Completed},a.prototype.AddStep=function(t){this.CombineNext&&0!=this.Steps.length?(this.CombineNext=!1,this.Steps[this.Steps.length-1].push(t)):this.Steps.push([t])};var h=function(){this.initStep()};return h.prototype.initStep=function(){this.Init=null,this.Update=null,this.Elapsed=0,this.Duration=0,this.Completed=!1,this.start=null,this.end=null},h.prototype.Clear=function(){this.Elapsed=0,this.Completed=!1},a}),define("Solitaire/HintsOption",{Enable:!0,Disable:!1}),define("Solitaire/TipsOption",{Enable:1,Disable:0}),define("Solitaire/ScoringOption",{Standard:0,Lasvegas:1,LasvegasCumulative:2}),define("Solitaire/ChallengeMode",{None:0,DailyChallenge:1,StarClub:2}),define("Solitaire/GameResult",{None:0,Win:1,NoMoreMoves:2,OutOfTime:3}),define("MenuUI/MsftModal",["pixi","absolute","MenuUI/MsftButton","lodash","MenuUI/ControlFocusManager"],function(t,e,i,n,r){var o=function(t,i,r){var o={width:e.Coords.x(1920),height:e.Coords.y(294),displayCloseButton:!1,backgroundAlpha:.5,buttonLetterStyle:{font:"Bold "+33*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},dialog:"",buttons:[],backgroundColor:16777215};this.initMsftModal(t,i,n.extend(o,r))};return o.prototype=Object.create(e.Dialog.prototype),o.prototype.initMsftModal=function(t,i,n){this.ui=t,this.game=i,this.options=n,this.options.content=this.initContent(),this.controlFocusManager=new r,e.Dialog.call(this,t,this.options),this.options.tween.type="tweenIn"},o.prototype.initContent=function(){return this.contentContainer=e.UIBuilder.buildLayout(this.options.dialog,this,this,this.options.width,this.options.height),this.contentContainer},o.prototype.cleanUp=function(){e.SpriteUtils.destroyAllChildren(this),this.destroy(!0)},o.prototype.addButtons=function(t){n.each(t,function(t){var n;t.width=e.Coords.x(t.width),t.height=e.Coords.x(t.height),n=new i(t),n.x=e.Coords.x(t.position.x),n.y=e.Coords.x(t.position.y),this.addChild(n),this.controlFocusManager.addControl(n,!0)},this)},o.prototype._createBackground=function(){var e=new t.Graphics;e.beginFill(this.options.backgroundColor,1),e.drawRect(0,0,this.options.width,this.options.height),e.endFill(),this.addChildAt(e,0)},o.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},o.prototype.onShow=function(){e.Dialog.prototype.onShow.call(this)},o}),define("MenuUI/BoostDialog",["pixi","absolute","MenuUI/MsftModal","MenuUI/MsftButton","lodash","Arkadium/GameEngine/Core/EngineManagers","util/NineSliceButton","util/eventhandler","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e,i,n,r){this.onConfirm=new s,this.onCancel=new s,this.initBoostDialog(t,e,i,n,r)};return h.prototype=Object.create(t.DisplayObjectContainer.prototype),h.prototype.initBoostDialog=function(i,n,r,o){t.DisplayObjectContainer.call(this),this.layoutType="large",this.parentToAdd=i,this.buildOverlay(),this.parentToAdd.addChild(this),this.popupContainer=new t.DisplayObjectContainer;var a,s,h,u,d=e.Coords.x(1e3),c=e.Coords.y(350),p=new t.Graphics;p.beginFill(16053492),p.drawRect(0,0,d,c),p.endFill(),a=new t.Graphics,a.beginFill(16645887),a.lineStyle(5,16645887),a.drawRect(0,0,d,c),s=new t.Sprite.fromFrame("opt-in-popup-icon.png"),s.position.set(e.Coords.x(30),e.Coords.y(30)),s.width=e.Coords.x(135),s.height=e.Coords.y(160),this.icon=s,this.titleFontSize=43;var g={font:e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#000000",tint:16777215,align:"left"};h=new t.Text(e.StringManager(n),g),h.position.set(e.Coords.x(195),e.Coords.y(20)),this.title=h,this.bodyFontSize=28;var f={font:e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#000000",align:"left",wordWrap:!0,wordWrapWidth:e.Coords.x(750)};u=new t.Text(e.StringManager(r),f),u.position.set(e.Coords.x(195),e.Coords.y(120)),this.body=u;var y=this.drawButton(14134328,9664559,13148472,"#ffffff",e.StringManager("buttons.wildCard"),function(){o("wildCard")}),m=this.drawButton(14134328,9664559,13148472,"#ffffff",e.StringManager("buttons.extraDeal"),function(){o("extraDeal")}),C=this.drawButton(15198181,11579568,15461354,"#000000",e.StringManager("buttons.noThanks"),function(){o("no")});this.popupContainer.addChild(a),this.popupContainer.addChild(p),this.popupContainer.addChild(s),this.popupContainer.addChild(h),this.popupContainer.addChild(u),this.popupContainer.addChild(y),this.popupContainer.addChild(m),this.popupContainer.addChild(C),this.addChild(this.popupContainer),this.popupContainer.visible=!0,y.position.set(e.Coords.y(25),e.Coords.y(270)),m.position.set(e.Coords.y(350),e.Coords.y(270)),C.position.set(e.Coords.y(675),e.Coords.y(270)),this.initForceScaleSprite(),l.addElement(this,{scaleChangeSource:"Full"})},h.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(20),this.forceOffsetY=e.Coords.y(20),this.forceScaleSprite.width=e.Coords.x(835),this.forceScaleSprite.height=e.Coords.y(365),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},h.prototype.handleResize=function(){l.scaleFactorX<=.35?this.changeToSmallLayout("small"):this.changeToLargeLayout("large"),this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/l.width,a=e.Coords.y(1080)/l.height,s=l.width,h=l.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>s){this.width=e.Coords.x(1920);var f=s/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>s){this.width=e.Coords.x(1920);var f=s/c;this.height=r*a*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY},h.prototype.changeToSmallLayout=function(t){this.layoutType!==t&&(this.icon.visible=!1,this.title.position.set(this.icon.x,this.icon.y),this.title.style.font=e.ScreenMetrics.getResScale()*(this.titleFontSize+7)+"px Segoe UI",this.title.updateText(),this.body.x=this.icon.x,this.body.style.font=e.ScreenMetrics.getResScale()*(this.bodyFontSize+7)+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(750),this.body.updateText(),this.layoutType=t)},h.prototype.changeToLargeLayout=function(t){this.layoutType!==t&&(this.icon.visible=!0,this.title.position.set(e.Coords.x(195),e.Coords.y(20)),this.title.style.font=e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",this.title.updateText(),this.body.position.set(e.Coords.x(195),e.Coords.y(100)),this.body.style.font=e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(600),this.body.updateText(),this.layoutType=t)},h.prototype.buildOverlay=function(){this.screenOverlay=new t.Graphics,this.screenOverlay.beginFill(0),this.screenOverlay.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.screenOverlay.alpha=.8,this.screenOverlay.interactive=!0,this.bindScreenOverlayInteractions(),this.parentToAdd.addChild(this.screenOverlay)},h.prototype.bindScreenOverlayInteractions=function(){this.screenOverlay.mouseover=function(t){},this.screenOverlay.mouseout=function(t){},this.screenOverlay.mousedown=function(t){},this.screenOverlay.mouseup=function(t){},this.screenOverlay.touchstart=function(t){},this.screenOverlay.touchend=function(t){},this.screenOverlay.touchendoutside=function(t){}},h.prototype.close=function(){this.parentToAdd.removeChild(this.screenOverlay),this.parentToAdd.removeChild(this),l.removeElement(this)},h.prototype.drawButton=function(i,n,r,o,a,s){var l=new t.Graphics,a=new t.Text(a,{font:21*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:o,align:"left"}),h=function(){l.clear(),l.beginFill(i),l.drawRect(0,0,e.Coords.x(300),e.Coords.y(60)),l.endFill()},u=function(){l.clear(),l.beginFill(n),l.drawRect(0,0,e.Coords.x(300),e.Coords.y(60)),l.endFill()},d=function(){l.clear(),l.beginFill(r),l.drawRect(0,0,e.Coords.x(300),e.Coords.y(60)),l.endFill()};return h(),l.interactive=!0,l.buttonMode=!0,l.addChild(a),a.anchor.set(.5,.5),a.position.set(e.Coords.x(150),e.Coords.y(30)),l.touchstart=function(t){u()},l.touchend=function(t){h(),s()},l.touchendoutside=function(t){h()},l.mouseover=function(t){d()},l.mouseout=function(t){h()},l.mousedown=function(t){u()}.bind(this),l.mouseup=function(t){h(),s()}.bind(this),l},h}),define("absolute/multipagelist",["pixi","absolute","absolute/button","absolute/screenmetrics","lodash","absolute/coords"],function(t,e,i,n,r,o){var a=function(t,e,i,n,a){var s={pagePadding:{x:o.x(10),y:o.y(10)},borderThickness:{left:o.x(20),right:o.x(20)},interfacePadding:{arrows:{x:o.x(50),y:o.y(50)}},buttonScale:1,pageButtonImage:"leaderboard_up_arrow.png",pageChangedCallback:function(){},startPage:0};this.direction="none",this.width_=0,this.height_=0,this.gapX=0,this.gapY=0,this.cellWidth=1,this.cellHeight=1,this.colsPerPage=1,this.rowsPerPage=1,this.currentPage=0,this.initMultiPageList(t,e,i,n,r.extend(s,a))};return a.prototype=Object.create(t.DisplayObjectContainer.prototype),a.prototype.initMultiPageList=function(e,i,n,r,o){t.DisplayObjectContainer.call(this,e),this.layoutOptions=o,this.options=o,this.lockLayout=o.lockLayout||"none",this.isPortrait=e.portrait,this.prevpageButton=n,this.nextpageButton=r,this.setItems(i)},a.prototype.setItems=function(t){this.items=t},a.prototype.createPages=function(){if(this.pages=[],this.items&&this.items.length>0){for(var e=new t.DisplayObjectContainer,i=this.items.length/this.colsPerPage,n=Math.ceil(i/this.rowsPerPage),r=0;r<n;r+=1){var o=this.rowsPerPage*this.colsPerPage*r,a=this.rowsPerPage*this.colsPerPage*(r+1);a>this.items.length&&(a=this.items.length),this.pages.push(this.makePage(this.items.slice(o,a),r))}this.pages.length>0&&(e.addChild(this.pages[0]),this.addChild(e))}},a.prototype.initHoverLayer=function(){var i=e.Coords.x(4);this.hover=new t.Graphics,this.hover.position.set(this.x-i,this.y),this.hover.beginFill(16777215,0),this.hover.lineStyle(i,16777215,1),this.hover.drawRect(0,0,this.width+2*i,this.maskRect.height+i),this.hover.endFill(),this.hover.alpha=1,this.hover.visible=!1,this.parent.addChild(this.hover)},a.prototype.makePage=function(e,i){var n=new t.DisplayObjectContainer;if("default"==this.lockLayout)for(var r=0,o=0;o<this.rowsPerPage;o+=1)for(var a=0;a<this.colsPerPage&&r<e.length;a++){var s=e[r];s.x=a*(this.cellWidth+this.gapX),s.y=o*(this.cellHeight+this.gapY),s.pageIndex=i,n.addChild(s),r++}else for(var l,h=0,u=0;u<e.length;u+=1)e[u].position.x=0,e[u].position.y=l?l.y+l.height+this.gapY:0,e[u].pageIndex=i,l=e[u],h+=l.height,n.addChild(e[u]);return n.height_=(this.cellHeight+this.gapY)*this.rowsPerPage,n.width_=(this.cellWidth+this.gapX)*this.colsPerPage,n},a.prototype.setNavigationButtons=function(t,e){this.prevpageButton=t,this.nextpageButton=e},a.prototype.reset=function(){this.pageTray&&(this.removeChild(this.pageTray),this.pageTray=null),this.createPages(),this.initContent(),this.enableButtons(!1),this.setCurrentPage(0),this.enablePage(!0,0)},a.prototype.initContent=function(){if(this.pages.length>0){this.pageTray=new t.DisplayObjectContainer;for(var e,i=0,n=this.pages.length;i<n;i+=1){var r=this.pages[i];r.position.x=0,r.position.y=e?e.y+e.height+this.gapY:0,e=r,this.pageTray.addChild(r)}if(this.kPanThreshold=r.height_/5,this.centerOffset=(this.height_-r.height_)/2,this.pageTray.position.y=this.centerOffset,this.addChild(this.pageTray),this.mask&&this.removeChild(this.mask),void 0!==this.maskRect){var o=new t.Graphics;o.beginFill(16777215,1),o.drawRect(this.maskRect.x,this.maskRect.y,this.maskRect.width,this.maskRect.height),o.endFill(),this.mask=o,this.addChild(this.mask)}}},a.prototype.initTouchInterface=function(){this.lastDeltaX=0,this.startX=0},a.prototype.scrollUp=function(t){this.currentPage<this.pages.length-1&&this.scrollToPage(this.currentPage+1,t)},a.prototype.scrollDown=function(t){this.currentPage>0&&this.scrollToPage(this.currentPage-1,t)},a.prototype.numPages=function(){return this.pages.length},a.prototype.handleDragStart=function(t){this.lastDeltaX=0,this.startX=-this.currentPage*this.pages[this.currentPage].width_+this.centerOffset,this.enableButtons(!1)},a.prototype.handleDrag=function(t){this.pageTray.position.x+=(t.gesture.deltaX-this.lastDeltaX)*n.devicePixelRatio/2,this.lastDeltaX=t.gesture.deltaX},a.prototype.handleDragEnd=function(t){this.lastDeltaX=0;var e=this.currentPage;t.gesture.deltaX<=-this.kPanThreshold?e+=1:t.gesture.deltaX>=this.kPanThreshold&&(e-=1),e<0?e=0:e>this.pages.length-1&&(e=this.pages.length-1),this.scrollToPage(e)},a.prototype.scrollToPage=function(t,e){if(this.setCurrentPage(t),this.enableButtons(!1),"horizontal"==this.direction){var i=-t*this.pages[t].width_+this.centerOffset,n=this;new TWEEN.Tween({x:this.pageTray.position.x}).to({x:i},300).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){n.pageTray.position.x=this.x}).onComplete(function(){"function"==typeof e&&e(),n.enablePage(!0,t),n.setCurrentPage(t)}).start()}else{var i=-t*this.pages[t].height_+this.centerOffset;n=this,new TWEEN.Tween({y:this.pageTray.position.y}).to({y:i},300).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){n.pageTray.position.y=this.y}).onComplete(function(){"function"==typeof e&&e(),n.enablePage(!0,t),n.setCurrentPage(t)}).start()}},a.prototype.setCurrentPage=function(t){this.currentPage=t,this.setNavigationButtonActiveStates(),this.options.pageChangedCallback(t)},a.prototype.setNavigationButtonActiveStates=function(){this.pages.length>0&&(this.nextpageButton&&this.nextpageButton.setActive(this.currentPage!==this.pages.length-1,this.nextpageButton),this.prevpageButton&&this.prevpageButton.setActive(0!==this.currentPage,this.prevpageButton))},a.prototype.enablePage=function(t,e){if(e>=0&&e<this.pages.length&&(this.pages[e].interactive=t,this.pages[e].interactiveChildren=t),this.items)for(var i=0;i<this.items.length;i++)this.items[i].interactive=!1,t&&this.items[i].pageIndex==e&&(this.items[i].interactive=t)},a.prototype.enableButtons=function(t){for(var e=0;e<this.pages.length;e++)this.pages[e].interactive=t,this.pages[e].interactiveChildren=t;if(this.items)for(var i=0;i<this.items.length;i++)this.items[i].interactive=t},a.prototype.setLayout=function(t){this.direction=t.direction,this.width_=t.pageWidth,this.height_=t.pageHeight,"number"==typeof t.gap?(this.gapX=t.gap,this.gapY=t.gap):(this.gapX=t.gapX,this.gapY=t.gapY),this.cellWidth=t.itemWidth,this.cellHeight=t.itemHeight,"number"==typeof t.colsPerPage?this.colsPerPage=t.colsPerPage:this.colsPerPage=Math.floor(t.pageWidth/this.cellWidth),"number"==typeof t.rowsPerPage?this.rowsPerPage=t.rowsPerPage:this.rowsPerPage=Math.floor(t.pageHeight/this.cellHeight),this.maskRect=t.maskRect,this.lockLayout=t.lockLayout||"none"},a.prototype.handleOrientationChange=function(t){this.isPortrait=t,this.reset()},a.prototype._focusChanged=function(){this.hover.visible=this._hasFocus},Object.defineProperty(a.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),a}),define("Solitaire/StarClub/SCCollectionGroup",["lodash"],function(t){"use strict";var e=function(t,e){this.initSCCollectionGroup(t,e)};return e.prototype.initSCCollectionGroup=function(t,e){this.Name=t,this.Priority=e,this.Collections=[]},e.prototype.addCollection=function(t){this.Collections.push(t)},e.prototype.sort=function(){this.Collections.sort(function(t,e){return t.CollectionPriority-e.CollectionPriority})},e.prototype.getCollectionGroupStats=function(){var e={totalStarsEarned:0,challengesCompleted:0,totalChallenges:0,packsUnlocked:0,collectionsUnlocked:0,crownsEarned:0,collectionsCompleted:0,collectionsTotal:0};return t.forEach(this.Collections,function(t){var i=t.getCollectionStats();e.totalStarsEarned+=i.totalStarsEarned,e.challengesCompleted+=i.challengesCompleted,e.totalChallenges+=i.totalChallenges,e.packsUnlocked+=i.packsUnlocked,e.crownsEarned+=i.crownsEarned,e.collectionsUnlocked+=t.PriceOfUnlocking>0&&t.Unlocked?1:0,e.collectionsCompleted+=i.complete?1:0,e.collectionsTotal++}),e},e}),define("SolitaireShared/FreeCellLogic/FreecellRandom",["lodash","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit"],function(t,e,i){"use strict";var n=function(t){this.initFreecellRandom(t)};return n.prototype.initFreecellRandom=function(t){this.DealNumber=t,this._state=t},n.prototype.GetNext=function(){return this._state=(214013*this._state+2531011)%(2<<30)>>>0,this._state/65536>>>0},n.GetDeal=function(r){var o=[],a=[],s=new n(r);t.forEach(e.Values,function(n){t.forEach(i,function(t){t!=i.None&&n!=e.Values.Joker&&a.push({Key:n,Value:t})})});for(var l=0,h=1;l<52;l++){var u=s.GetNext()%a.length,d=a[a.length-1];a[a.length-1]=a[u],a[u]=d,h%2==0?o[8*h-l%8-1]=a[a.length-1]:o[l]=a[a.length-1],a.splice(a.length-1),(l+1)%8==0&&h++}return o},n}),define("SolitaireShared/FreeCellLogic/FreeCellAuthority",["lodash","absolute/debug","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/CardLogic/TipEventArgs","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/MoveState","SolitaireShared/CardLogic/DealData","SolitaireShared/FreeCellLogic/FreecellRandom"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g){"use strict";var f=function(){this.initFreeCellAuthority()};return f.constructor=f,f.prototype=Object.create(i.prototype),f.prototype.initFreeCellAuthority=function(){this.CardSupply=new r("FreeCell"),this.CardSupply.Authority=this,this.MaxCardsInCells=0,this.MaxCardsInTableau=0,this.IsChallenge=!1,this.MAX_DEALS=0,this._lastHint,this.DealScript=f.DefaultDealScript,this.WinSetAction=null,this.preventAutoMove=!1},f.prototype.Setup=function(){this.CardSupply.AddPile("Stock","Stock"),this.CardSupply.AddPile("Foundation0","Foundation"),this.CardSupply.AddPile("Foundation1","Foundation"),this.CardSupply.AddPile("Foundation2","Foundation"),this.CardSupply.AddPile("Foundation3","Foundation"),this.CardSupply.AddPile("Free0","Free"),this.CardSupply.AddPile("Free1","Free"),this.CardSupply.AddPile("Free2","Free"),this.CardSupply.AddPile("Free3","Free"),this.CardSupply.AddPile("Tableau0","Tableau"),this.CardSupply.AddPile("Tableau1","Tableau"),this.CardSupply.AddPile("Tableau2","Tableau"),this.CardSupply.AddPile("Tableau3","Tableau"),this.CardSupply.AddPile("Tableau4","Tableau"),this.CardSupply.AddPile("Tableau5","Tableau"),this.CardSupply.AddPile("Tableau6","Tableau"),this.CardSupply.AddPile("Tableau7","Tableau"),this.CardSupply.CreateCards(1,4,0)},f.prototype.Reset=function(){this.MaxCardsInCells=0,this.MaxCardsInTableau=0,this.CardSupply.ResetGame()},f.prototype.BoardsCompleted=function(){return-1},f.prototype.NumDealsLeft=function(){return 0},f.prototype.UsesClassicSeeds=function(t){return null!=t&&0==t.indexOf("$")},f.prototype.Deal=function(t){try{if(this.CardSupply.PrepareGame(),null!=this.CardSupply.CardAnimator&&this.CardSupply.CardAnimator.BeginShuffleAnimation(),t)this.CardSupply.DeckSeed=t;else if(null==this.CardSupply.DeckSeed)if(this.CardSupply.Options.DIFFICULTY&&"RANDOM"!==this.CardSupply.Options.DIFFICULTY)this.CardSupply.DeckSeed="$"+this.CardSupply.GetBakedInDeckSeed();else{var i=Math.random();this.CardSupply.DeckSeed="$"+Math.round(9999999*i)}if(this.UsesClassicSeeds(this.CardSupply.DeckSeed)){var n=parseInt(this.CardSupply.DeckSeed.substring(1));if(isNaN(n))return!1;var r=g.GetDeal(n);this.CardSupply.ClearCardList(),this.CardSupply.RootPile.ClearCards();for(var a=51;a>=0;a--){var s=new o(this.CardSupply,r[a].Key,r[a].Value,0,a);this.CardSupply.GetCardList().push(s),this.CardSupply.RootPile.ForceAdd(s)}}else this.CardSupply.DeckSeed=this.CardSupply.RootPile.Shuffle(this.CardSupply.DeckSeed);this.CardSupply.OnShuffleCards(),d.RunActions(this.CardSupply,this.DealScript),this.CardSupply.StartGame()}catch(t){return e.log(t),!1}return!0},f.prototype.Tick=function(t){},f.prototype.NumEmptyFreeCells=function(){var t=0;return this.CardSupply.GetPile("Free0").Empty&&t++,this.CardSupply.GetPile("Free1").Empty&&t++,this.CardSupply.GetPile("Free2").Empty&&t++,this.CardSupply.GetPile("Free3").Empty&&t++,t},f.prototype.MaxTableauSize=function(){for(var t=0,e=0;e<=7;++e)t=Math.max(t,this.CardSupply.GetPile("Tableau"+e).Count);return t},f.prototype.NumEmptyTableaus=function(){var t=0;return this.CardSupply.GetPile("Tableau0").Empty&&t++,this.CardSupply.GetPile("Tableau1").Empty&&t++,this.CardSupply.GetPile("Tableau2").Empty&&t++,this.CardSupply.GetPile("Tableau3").Empty&&t++,this.CardSupply.GetPile("Tableau4").Empty&&t++,this.CardSupply.GetPile("Tableau5").Empty&&t++,this.CardSupply.GetPile("Tableau6").Empty&&t++,this.CardSupply.GetPile("Tableau7").Empty&&t++,t},f.prototype.CanMoveCards=function(t,e,i,r){if(r=!!r,1==i)return!0;var o=this.NumEmptyTableaus()-(null!=e&&e.Empty?1:0),a=(this.NumEmptyFreeCells()+1)*Math.round(Math.pow(2,o));return!(t.Count<i||i<1)&&(i>a?(r&&null!=this.OnTip&&(a<=1?this.OnTip(this,new n("Tips_FreeCell_InsufficientFreeSpace_Singular",[i.toString(),a.toString()])):this.OnTip(this,new n("Tips_FreeCell_InsufficientFreeSpace_Plural",[i.toString(),a.toString()]))),!1):this.CanPickupCards(t,e,i,r))},f.prototype.CanPickupCards=function(t,e,i,r){if(t.Count<i||i<1)return!1;if(i>1)for(var o=t.NthFromTop(i),a=i-1;a>0;a--){var s=t.NthFromTop(a);if(s.Color==o.Color||s.Color==h.None||o.Color==h.None)return r&&null!=this.OnTip&&this.OnTip(this,new n("Tips_FreeCell_MoveCards")),!1;if(o.ValueNum!=s.ValueNum+1)return r&&null!=this.OnTip&&this.OnTip(this,new n("Tips_FreeCell_MoveCards")),!1;o=s}return!0},f.prototype.TableauCanTakeCard=function(t,e,i){return i=!!i,null!=t&&null!=e&&(e.Value!=s.Values.Joker&&(!!t.Empty||(e.Color==t.Top.Color?(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_SameColor")),!1):t.Top.ValueNum!=e.ValueNum+1?(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_OutOfOrder")),!1):e.Color!=h.None&&t.Top.Color!=h.None)))},f.prototype.FoundationCanTakeCard=function(t,e,i){if(i=!!i,null==t||null==e)return!1;if(e.Value==s.Values.Joker)return!1;if(this.DoesFoundationSuitMatchCard(t,e)){if(t.Empty&&e.Value==s.Values.Ace)return!0;if(!t.Empty&&e.ValueNum==t.Top.ValueNum+1)return!0}return i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_FoundationPile")),!1},f.prototype.DoesFoundationSuitMatchCard=function(t,e){switch(t.Name){case"Foundation0":return e.Suit==l.Hearts;case"Foundation1":return e.Suit==l.Clubs;case"Foundation2":return e.Suit==l.Diamonds;case"Foundation3":return e.Suit==l.Spades;default:return!1}},f.prototype.GetFoundationForCard=function(t){switch(t.Suit){case l.Hearts:return this.CardSupply.GetPile("Foundation0");case l.Clubs:return this.CardSupply.GetPile("Foundation1");case l.Diamonds:return this.CardSupply.GetPile("Foundation2");default:return this.CardSupply.GetPile("Foundation3")}},f.prototype.IsActionAllowed=function(t,e){if(null==t||null==t.Ops||0==t.Ops.length)return!1;var i=t.Ops[0];if(1==t.Ops.length&&i.Opcode==u.Op.Undo)return!0;if(t.IsNoop())return!0;if(1==t.Ops.length&&i.Opcode==u.Op.Game)return!0;if(i.Opcode==u.Op.Move){var n=i.GetPile(u.eMoveParams.SourcePile),r=i.GetPile(u.eMoveParams.DestPile),o=i.GetNumber(u.eMoveParams.NumCards);if(1==t.Ops.length){if("Tableau"==n.Type&&"Tableau"==r.Type){if(o>=1&&n.Count>=o&&this.TableauCanTakeCard(r,n.NthFromTop(o),e)&&this.CanMoveCards(n,r,o,e))return!0}else if("Tableau"==n.Type&&"Free"==r.Type){if(1==o&&n.Count>=o&&r.Empty)return!0}else if("Tableau"==n.Type&&"Foundation"==r.Type){if(1==o&&n.Count>=o&&this.FoundationCanTakeCard(r,n.Top,e))return!0}else if("Free"==n.Type&&"Foundation"==r.Type&&1==o&&n.Count>=o&&this.FoundationCanTakeCard(r,n.Top,e))return!0;if("Free"==n.Type&&"Tableau"==r.Type&&o>=1&&!n.Empty&&this.TableauCanTakeCard(r,n.Top,e))return!0}}return!1},f.prototype.CanAutoSolve=function(){return!1},f.prototype.CanKeyboardFocusCard=function(t){return this.CanPickupCard(t)},f.prototype.CanPickupCard=function(t){if(this.CardSupply.WaitingForBlockingAnimation)return!1;if("Free"==t.Pile.Type)return!0;if("Tableau"==t.Pile.Type){var e=t.Pile.GetCardPosFromEnd(t);if(this.CanPickupCards(t.Pile,null,e,!1))return!0}return!1},f.prototype.CanAcceptCards=function(t){return"Foundation"==t.Type||"Tableau"==t.Type||!("Free"!=t.Type||!t.Empty)},f.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.CheckWin()},f.prototype.CheckWin=function(){return 4==this.GetCompletedStacks()},f.prototype.GetScoreForAction=function(t){for(var e=0;e<t.Ops.length;e++){var i=t.Ops[e];if(i.Opcode==u.Op.Move&&"Foundation"==i.GetPile(u.eMoveParams.DestPile).Type)return 250;if(i.Opcode==u.Op.Undo)return-100*i.GetNumber(u.eUndoParams.NumMovesUndone)}return 0},f.prototype.GetScoreForTimer=function(t,e){return 0},f.prototype.GetStartingTime=function(){return 0},f.prototype.GetCompletedStacks=function(){var t=0;return 13==this.CardSupply.GetPile("Foundation0").Count&&t++,13==this.CardSupply.GetPile("Foundation1").Count&&t++,13==this.CardSupply.GetPile("Foundation2").Count&&t++,13==this.CardSupply.GetPile("Foundation3").Count&&t++,t},f.prototype.GetBonusScore=function(t){return 0},f.prototype.GetMaxScore=function(){return Number.MAX_VALUE},f.prototype.GetMinScore=function(){return 0},f.prototype.GetStartingScore=function(){return 0},f.prototype.GetHint=function(t){return t=!!t,this.GetHintInternal(t)},f.prototype.GetHintInternal=function(t){t=!!t;for(var e,i,n=[],r=s.Values.King,o=0;o<4;o++){if(e=this.CardSupply.GetPile("Foundation"+o),e.Empty){r=s.Values.Ace;break}e.Top.Value<r&&(r=e.Top.Value)}if(!t&&n.length>0)return n[0];for(var o=0;o<4;o++)if(e=this.CardSupply.GetPile("Free"+o),!e.Empty&&e.Top.Value==r){i=this.GetFoundationForCard(e.Top);var a=new u(this.CardSupply),l=["MOVE",e.Name,i.Name,"1"];a.Parse(l,0),n.push(a)}if(!t&&n.length>0)return n[0];for(var o=0;o<8;o++)if(e=this.CardSupply.GetPile("Tableau"+o),!e.Empty&&e.Top.Value==r){i=this.GetFoundationForCard(e.Top);var a=new u(this.CardSupply),l=["MOVE",e.Name,i.Name,"1"];a.Parse(l,0),n.push(a)}if(!t&&n.length>0)return n[0];for(var o=0;o<4;o++)if(e=this.CardSupply.GetPile("Free"+o),!e.Empty)for(var h=0;h<8;h++){var d=e.Top;if(i=this.CardSupply.GetPile("Tableau"+h),this.TableauCanTakeCard(i,d)&&this.CanMoveCards(e,i,1)){var a=new u(this.CardSupply),l=["MOVE",e.Name,i.Name,"1"];a.Parse(l,0),n.push(a)}}if(!t&&n.length>0)return n[0];for(var o=0;o<8;o++)if(e=this.CardSupply.GetPile("Tableau"+o),!e.Empty)for(var h=1;h<=e.Count&&this.CanMoveCards(e,null,h);h++)for(var c=e.NthFromTop(h),p=0;p<8;p++)if(o!=p&&(i=this.CardSupply.GetPile("Tableau"+p),this.TableauCanTakeCard(i,c)&&this.CanMoveCards(e,i,h))){var a=new u(this.CardSupply),l=["MOVE",e.Name,i.Name,h.toString()];a.Parse(l,0),n.push(a)}if(!t&&n.length>0)return n[0];for(var o=0;o<8;o++)if(e=this.CardSupply.GetPile("Tableau"+o),!e.Empty)for(var h=0;h<4;h++)if(i=this.CardSupply.GetPile("Foundation"+h),this.FoundationCanTakeCard(i,e.Top)){var a=new u(this.CardSupply),l=["MOVE",e.Name,i.Name,"1"];a.Parse(l,0),n.push(a)}if(!t&&n.length>0)return n[0];for(var g=null,o=0;o<4;o++)if(i=this.CardSupply.GetPile("Free"+o),i.Empty){g=i;break}if(null!=g){for(var f=null,y=Number.MAX_VALUE,o=0;o<8;o++)if(e=this.CardSupply.GetPile("Tableau"+o),!e.Empty)for(var h=1;h<=e.Count;h++){var m=e.NthFromTop(h);if(m.Value==r&&h<y){f=e,y=h;break}}if(null!=f){var a=new u(this.CardSupply),l=["MOVE",f.Name,g.Name,"1"];a.Parse(l,0),n.push(a)}}if(!t&&n.length>0)return n[0];if(n.length>0){if(!t)return n[0];if(t){
if(null!=this._lastHint){var C;for(C=0;C<n.length&&!n[C].Equals(this._lastHint);C++);if(C>=n.length-1){var a=n[0];return this._lastHint=a,a}var a=n[C+1];return this._lastHint=a,a}var a=n[0];return this._lastHint=a,a}}return new u(this.CardSupply)},f.prototype.GetCardHint=function(t){var e,i,n=t.Pile,r=parseInt(n.Name[n.Name.length-1]),o=n.GetCardPosFromEnd(t),a=o.toString(),s=new u(this.CardSupply);if("Free"===t.Pile.Type){if(i=this.GetFoundationForCard(t),this.FoundationCanTakeCard(i,t))return s.Parse(["MOVE",n.Name,i.Name,a],0),s;for(e=0;e<8;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t)&&this.CanMoveCards(n,i,o))return s.Parse(["MOVE",n.Name,i.Name,a],0),s}else if("Tableau"===t.Pile.Type){if(i=this.GetFoundationForCard(t),1===o&&this.FoundationCanTakeCard(i,t))return s.Parse(["MOVE",n.Name,i.Name,a],0),s;for(e=r+1;e<8;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t,!1)&&this.CanMoveCards(n,i,o))return s.Parse(["MOVE",n.Name,i.Name,a],0),s;for(e=0;e<r;e++)if(i=this.CardSupply.GetPile("Tableau"+e),this.TableauCanTakeCard(i,t,!1)&&this.CanMoveCards(n,i,o))return s.Parse(["MOVE",n.Name,i.Name,a],0),s;if(1!==o)return;for(e=0;e<4;e++)if(i=this.CardSupply.GetPile("Free"+e),i.Empty)return s.Parse(["MOVE",n.Name,i.Name,a],0),s}},f.prototype.SafeToMoveToFoundation=function(t){if(this.preventAutoMove)return this.preventAutoMove=!1,!1;if(t.Value==s.Values.Ace||t.Value==s.Values.Two)return!0;for(var e=0,i=0;i<4;i++){var n=this.CardSupply.GetPile("Foundation"+i).Top;null!=n&&n.Color!=t.Color&&n.ValueNum>=t.ValueNum-1&&e++}return 2==e},f.prototype.GetAutomaticMove=function(){if(this.IsGameWon()||this.CurrentMoveState()==c.NoMovesLeft)return null;for(var t,e,i=0;i<8;i++){t=this.CardSupply.GetPile("Tableau"+i);for(var n=0;n<4;n++)if(e=this.CardSupply.GetPile("Foundation"+n),this.FoundationCanTakeCard(e,t.Top)&&this.SafeToMoveToFoundation(t.Top)){var r=new d(this.CardSupply),o=["MOVE",t.Name,e.Name,"1"];return r.Parse(o,0),r.autoMove=!0,r}}for(var i=0;i<4;i++)if(t=this.CardSupply.GetPile("Free"+i),!t.Empty)for(var n=0;n<4;n++)if(e=this.CardSupply.GetPile("Foundation"+n),this.FoundationCanTakeCard(e,t.Top)&&this.SafeToMoveToFoundation(t.Top)){var r=new d(this.CardSupply),o=["MOVE",t.Name,e.Name,"1"];return r.Parse(o,0),r.autoMove=!0,r}return null},f.prototype.CurrentMoveState=function(){if(this.CardSupply.WaitingForAnimation||this.IsGameWon())return c.CanMove;for(var t,e=0;e<4;e++)if(t=this.CardSupply.GetPile("Free"+e),0==t.Count)return c.CanMove;for(var e=0;e<8;e++)if(t=this.CardSupply.GetPile("Tableau"+e),0==t.Count)return c.CanMove;for(var e=0;e<8;e++)if(t=this.CardSupply.GetPile("Tableau"+e),!t.Empty)for(var i=0;i<4;i++)if(this.FoundationCanTakeCard(this.CardSupply.GetPile("Foundation"+i),t.Top))return c.CanMove;for(var e=0;e<8;e++)if(t=this.CardSupply.GetPile("Tableau"+e),!t.Empty)for(var i=0;i<8;i++)if(this.TableauCanTakeCard(this.CardSupply.GetPile("Tableau"+i),t.Top))return c.CanMove;for(var e=0;e<4;e++)if(t=this.CardSupply.GetPile("Free"+e),!t.Empty)for(var i=0;i<8;i++)if(this.TableauCanTakeCard(this.CardSupply.GetPile("Tableau"+i),t.Top))return c.CanMove;for(var e=0;e<4;e++)if(t=this.CardSupply.GetPile("Free"+e),!t.Empty)for(var i=0;i<4;i++)if(this.FoundationCanTakeCard(this.CardSupply.GetPile("Foundation"+i),t.Top))return c.CanMove;return c.NoMovesLeft},f.prototype.ResetNoMoreMovesState=function(){},f.prototype.TriggerTip=function(t){null!=this.OnTip&&this.OnTip(this,t)},f.prototype.OnRunAction=function(t,e,i){this.MaxCardsInCells=Math.max(this.MaxCardsInCells,4-this.NumEmptyFreeCells()),this.MaxCardsInTableau=Math.max(this.MaxCardsInTableau,this.MaxTableauSize()),e&&t.autoMove?this.preventAutoMove=!0:"noop"!==t.Ops[0].OpName&&(this.preventAutoMove=!1)},f.prototype.OnRunSpecialAction=function(t,e){},f.prototype.OnGameOver=function(t,e){},f.prototype.LaunchOptInAds=function(){},f.prototype.GenerateDealData=function(){var t,e,i=0,n="",r=new Array(this.CardSupply.Count);for(t=3;t>=0;t--)e=this.ProcessDealDataForPile("Foundation"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;for(t=3;t>=0;t--)e=this.ProcessDealDataForPile("Free"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;for(t=7;t>=0;t--)e=this.ProcessDealDataForPile("Tableau"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;return n="BEGIN "+n+"END",new p(a.ConstructSeedFromDeck(r,this.CardSupply.Count).ToString(),n)},f.prototype.AddExtraDeals=function(t,e){},f.prototype.AddWildCard=function(t){},f.prototype.ApplyCurrentOptInAdBonus=function(t){},f.prototype.ProcessDealDataForPile=function(e,i,n,r){var o=this.CardSupply.GetPile(e);return null==o||o.Empty||(t.forEach(o.GetCards(),function(t){i[r++]=t.Sequence}),n="MOVE Root "+e+" "+o.Count+" "+n),{deck:i,script:n,currentIndex:r}},f.prototype.ForceDealScript=function(t){this.DealScript=null!=t?t:f.DefaultDealScript},f.DefaultDealScript="BEGIN MOVE Root Stock 52 MOVE Stock Tableau0 1 MOVE Stock Tableau1 1 MOVE Stock Tableau2 1 MOVE Stock Tableau3 1 MOVE Stock Tableau4 1 MOVE Stock Tableau5 1 MOVE Stock Tableau6 1 MOVE Stock Tableau7 1 MOVE Stock Tableau7 1 MOVE Stock Tableau6 1 MOVE Stock Tableau5 1 MOVE Stock Tableau4 1 MOVE Stock Tableau3 1 MOVE Stock Tableau2 1 MOVE Stock Tableau1 1 MOVE Stock Tableau0 1 MOVE Stock Tableau0 1 MOVE Stock Tableau1 1 MOVE Stock Tableau2 1 MOVE Stock Tableau3 1 MOVE Stock Tableau4 1 MOVE Stock Tableau5 1 MOVE Stock Tableau6 1 MOVE Stock Tableau7 1 MOVE Stock Tableau7 1 MOVE Stock Tableau6 1 MOVE Stock Tableau5 1 MOVE Stock Tableau4 1 MOVE Stock Tableau3 1 MOVE Stock Tableau2 1 MOVE Stock Tableau1 1 MOVE Stock Tableau0 1 MOVE Stock Tableau0 1 MOVE Stock Tableau1 1 MOVE Stock Tableau2 1 MOVE Stock Tableau3 1 MOVE Stock Tableau4 1 MOVE Stock Tableau5 1 MOVE Stock Tableau6 1 MOVE Stock Tableau7 1 MOVE Stock Tableau7 1 MOVE Stock Tableau6 1 MOVE Stock Tableau5 1 MOVE Stock Tableau4 1 MOVE Stock Tableau3 1 MOVE Stock Tableau2 1 MOVE Stock Tableau1 1 MOVE Stock Tableau0 1 MOVE Stock Tableau0 1 MOVE Stock Tableau1 1 MOVE Stock Tableau2 1 MOVE Stock Tableau3 1 END",f}),define("SolitaireShared/FreeCellLogic/IDailyFreeCellAuthority",["SolitaireShared/FreeCellLogic/FreeCellAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(){this.initIDailyFreeCellAuthority()};r.constructor=r,r.prototype=Object.create(t.prototype),e.call(r.prototype),r.prototype.initIDailyFreeCellAuthority=function(){t.call(this),this.MovesAllowed=0,this._startingTime=0,this.ChallengeType=e.ChallengeType.Unknown,this.DeckSeeds=[],this.IsChallenge=!0,this.TotalMoves=0},Object.defineProperty(r.prototype,"TimerEnabled",{get:function(){return 0!=this._startingTime}}),Object.defineProperty(r.prototype,"StartingTime",{get:function(){return this._startingTime},set:function(t){this._startingTime=t,this.CardSupply.IsTimerCountdown=0!=this._startingTime}}),r.prototype.GetStartingTime=function(){return this._startingTime};return r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var r=e.Ops[n];this.MovesAllowed>0&&0==e.GetActionUndoCount()&&r.Opcode!=i.Op.Noop&&r.Opcode!=i.Op.Deal&&(e.Tag=(1073741824|e.Tag)>>>0)}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){this.MovesAllowed>0&&(this.TotalMoves+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return this.MovesAllowed>0?this.CheckWin()&&this.TotalMoves<=this.MovesAllowed+1:this.CheckWin()},r.prototype.CheckWin=function(){return 4==this.GetCompletedStacks()},r.prototype.CurrentMoveState=function(){if(this.MovesAllowed>0){if(this.TotalMoves>this.MovesAllowed+1)return n.NoMovesLeft;if(this.TotalMoves==this.MovesAllowed+1)return this.IsGameWon()?n.CanMove:n.NoMovesLeft}return t.prototype.CurrentMoveState.call(this)},r.prototype.GetHint=function(e,n){return e=!!e,n?t.prototype.GetHint.call(this,e,n):new i(this.CardSupply)},r.prototype.Deal=function(){return this.TotalMoves=0,this.DeckSeeds.length>0&&(this.CardSupply.DeckSeed=this.DeckSeeds[0]),t.prototype.Deal.call(this)},r.prototype.SetDealScript=function(t){this.DealScript=t},r.prototype.SetNumBoardsCompleted=function(t){},r}),define("SolitaireShared/FreeCellLogic/ChallengeAuthorities/CardToCardDailyFreeCellAuthority",["SolitaireShared/FreeCellLogic/IDailyFreeCellAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(t){this.initCardToCardDailyFreeCellAuthority(t)};return r.constructor=r,r.prototype=Object.create(t.prototype),r.prototype.initCardToCardDailyFreeCellAuthority=function(e){if(t.call(this,e),this.GoalCompleted=!1,null==e||!e.STACKCARD||!e.BASECARD)throw"Invalid parameter passed in creating Daily Challenge";this.StackCard=e.STACKCARD.toUpperCase(),this.BaseCard=e.BASECARD.toUpperCase()},Object.defineProperty(r.prototype,"ChallengeType",{get:function(){return e.ChallengeType.CardToCard}}),r.prototype.Deal=function(){return this.GoalCompleted=!1,t.prototype.Deal.call(this)},r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var r=e.Ops[n],o=r.GetPile(i.eMoveParams.DestPile);if(r.Opcode==i.Op.Move&&"Tableau"==o.Type&&o.Count>r.GetNumber(i.eMoveParams.NumCards)&&o.NthFromTop(r.GetNumber(i.eMoveParams.NumCards)).ToString().Equals(this.StackCard)&&o.NthFromTop(r.GetNumber(i.eMoveParams.NumCards)+1).ToString().Equals(this.BaseCard)){e.Tag=(1|e.Tag)>>>0;break}}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){(1&e)>>>0!=0&&(this.GoalCompleted=!0),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.GoalCompleted},r.prototype.CurrentMoveState=function(){return!this.IsGameWon()&&t.prototype.IsGameWon.call(this)?n.NoMovesLeft:t.prototype.CurrentMoveState.call(this)},r}),define("SolitaireShared/FreeCellLogic/ChallengeAuthorities/PlayCardDailyFreeCellAuthority",["SolitaireShared/FreeCellLogic/FreeCellAuthority","SolitaireShared/FreeCellLogic/IDailyFreeCellAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IPlayCardDailyAuthority","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayCardDailyFreeCellAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this.CardPlayed()?1:0}}),o.KeyCardToPlay="CARDTOPLAY",o.prototype.initPlayCardDailyFreeCellAuthority=function(t){if(e.call(this),null==t||!t[o.KeyCardToPlay])throw"Invalid parameter passed in creating Daily Challenge";this._cardToPlay=this.GetCardValue(t[o.KeyCardToPlay].toUpperCase()),this.ChallengeType=i.ChallengeType.PlayCard},o.prototype.IsGameWon=function(){for(var t=null,i=0;i<4;i++)if(t=this.CardSupply.GetPile("Foundation"+i),!t.Empty&&t.Top.ToString()==this._cardToPlay)return this.cardPlayed=!0,!0;return e.prototype.IsGameWon.call(this)},o.prototype.GetHint=function(t,i){if(i)return e.prototype.GetHint.call(this,t,i);t=!!t;var n,o=[],a=(this.CardSupply.GetPile("Foundation"),[]);a.push("CHALLENGE");for(var s=7;s>=0;s--)if(n=this.CardSupply.GetPile("Tableau"+s),!n.Empty)for(var l=n.GetCards(),h=0;h<l.length;h++){var u=l[h];if(u.ToString()==this._cardToPlay){a.push(u.Sequence.toString());break}}if(a.length<=1)for(var s=0;s<4;s++)if(n=this.CardSupply.GetPile("Free"+s),!n.Empty&&n.Top.ToString()==this._cardToPlay){a.push(n.Top.Sequence.toString());break}if(a.length>1){var d=new r(this.CardSupply);d.Parse(a,0),o.push(d)}return o.length>0?o[0]:new r(this.CardSupply)},o.prototype.GetCardValue=function(t){return t},o}),define("SolitaireShared/FreeCellLogic/ChallengeAuthorities/PlayValuesDailyFreeCellAuthority",["SolitaireShared/FreeCellLogic/IDailyFreeCellAuthority","SolitaireShared/CardLogic/IPlayValuesDailyAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardValue"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayValuesDailyFreeCellAuthority(t)};return o.Key_NumToPlay="NUMBERTOPLAY",o.Key_ValueToPlay="VALUETOPLAY",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,e.call(o.prototype),o.prototype.initPlayValuesDailyFreeCellAuthority=function(e){t.call(this,e),this._hasWon=!1;var n=!0;if(null!=e&&e[o.Key_NumToPlay]&&e[o.Key_ValueToPlay]&&(n=!1,this.NumToPlay=parseInt(e[o.Key_NumToPlay]),this.ValueToPlay=r.getValue(e[o.Key_ValueToPlay]),!isNaN(this.NumToPlay)&&this.ValueToPlay||(n=!0),n))throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=i.ChallengeType.PlayValues},Object.defineProperty(o.prototype,"Value",{get:function(){return this.ValueToPlay}}),Object.defineProperty(o.prototype,"NumberToPlay",{get:function(){return this.NumToPlay}}),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){for(var t=0,e=0;e<4;e++){var i=this.CardSupply.GetPile("Foundation"+e);!i.Empty&&i.Top.Value>=this.ValueToPlay&&t++}return t}}),o.prototype.Deal=function(){return this._hasWon=!1,t.prototype.Deal.call(this)},o.prototype.IsGameWon=function(){var t=0;return this._hasWon||(t=this.NumberPlayed),this._hasWon||t>=this.NumToPlay},o.prototype.GetHint=function(e,i){if(i)return t.prototype.GetHint.call(this,e,i);e=!!e;var r,o=[];this.CardSupply.GetPile("Foundation");var a=[];a.push("CHALLENGE");for(var s=7;s>=0;s--)if(r=this.CardSupply.GetPile("Tableau"+s),!r.Empty)for(var l=r.GetCards(),h=0;h<l.length;h++){var u=l[h];u.Value==this.ValueToPlay&&a.push(u.Sequence.toString())}for(var s=0;s<4;s++)r=this.CardSupply.GetPile("Free"+s),r.Empty||r.Top.Value==this.ValueToPlay&&a.push(r.Top.Sequence.toString());if(a.length>1){var d=new n(this.CardSupply);d.Parse(a,0),o.push(d)}return o.length>0?o[0]:new n(this.CardSupply)},o}),define("SolitaireShared/FreeCellLogic/ChallengeAuthorities/SolveGameDailyFreeCellAuthority",["SolitaireShared/FreeCellLogic/IDailyFreeCellAuthority","SolitaireShared/CardLogic/IDailyAuthority"],function(t,e){"use strict";var i=function(t){this.initSolveGameDailyFreeCellAuthority(t)};return i.constructor=i,i.prototype=Object.create(t.prototype),i.prototype.initSolveGameDailyFreeCellAuthority=function(i){t.call(this,i),this.ChallengeType=e.ChallengeType.SolveGame},i}),define("Solitaire/DailyChallenges/FreeCellChallenge",["lodash","absolute/stringmanager","CardUI/IChallengeDefinition","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/Card","SolitaireShared/FreeCellLogic/ChallengeAuthorities/CardToCardDailyFreeCellAuthority","SolitaireShared/FreeCellLogic/ChallengeAuthorities/PlayCardDailyFreeCellAuthority","SolitaireShared/FreeCellLogic/ChallengeAuthorities/PlayValuesDailyFreeCellAuthority","SolitaireShared/FreeCellLogic/ChallengeAuthorities/SolveGameDailyFreeCellAuthority"],function(t,e,i,n,r,o,a,s,l){"use strict";var h=function(t,e,i){this.initFreeCellChallenge(t,e,i)};return h.constructor=h,h.prototype=Object.create(i.prototype),h.GoalType={SolveGame:0,PlayValues:1,CardToCard:2,PlayCard:3},h.prototype.GoalType=h.GoalType,h.prototype.initFreeCellChallenge=function(t,e,n){i.call(this,t,e,n)},h.prototype.ConstructAuthority=function(){var t=h.AuthorityTypes[this.ChallengeType](this.Parameters);return this.SetupOptionsForAuthority(t),t},h.prototype.GetGoalDescription=function(){try{switch(this.ChallengeType){case h.GoalType.SolveGame:return e(this.CompleteGoalLocString("DailyChallengeGoal_SolveDeck"),[this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);case h.GoalType.PlayCard:return e(this.CompleteGoalLocString("DailyChallengeGoal_PlayCardToFoundation"),[r.GetSymbolStringFromShortName(this.Parameters[a.KeyCardToPlay]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);case h.GoalType.PlayValues:var t=r.GetLongValueName(this.Parameters[s.Key_ValueToPlay]),i=parseInt(this.Parameters[s.Key_NumToPlay]),n="Card_"+t;return!isNaN(i)&&i>1&&("SIX"==t.toUpperCase()?n+="es":n+="s"),t=e(n),e(this.CompleteGoalLocString("DailyChallengeGoal_PlayValuesToFoundation"),[i.toString(),t,this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);default:return""}}catch(t){return""}},h.prototype.GetChallengeIconUrl=function(){return"Content/Icons/DailyChallenges/freecell.png"},h.prototype.GetModeName=function(){return"FreeCell"},h.prototype.GetShortGoalDescription=function(){switch(this.ChallengeType){case h.GoalType.SolveGame:return e(this.AllowedMoves>0?"Moves_Solve_Challenge":this.AllowedTime>0?"Timed_Solve_Challenge":"Solve_Challenge");case h.GoalType.PlayCard:case h.GoalType.PlayValues:return e(this.AllowedMoves>0?"Moves_Card_Challenge":this.AllowedTime>0?"Timed_Card_Challenge":"DCTile_Card_Challenge");default:return""}},h.MakeSolveAuthority=function(t){return new l(t)},h.MakePlayValuesAuthority=function(t){return new s(t)},h.MakeCardToCardAuthority=function(t){return new o(t)},h.MakePlayCardAuthority=function(t){return new a(t)},h.AuthorityTypes=[h.MakeSolveAuthority,h.MakePlayValuesAuthority,h.MakeCardToCardAuthority,h.MakePlayCardAuthority],h.FromDictionary=function(e){var i=null,n=parseInt(e.Data.CHDEF_ChallengeType),r={};return t.forEach(e.Data,function(t,e){if(0==e.indexOf("PARAM_")){var i=e.substring(6);r[i]=t}}),i=new h(n,r,e),i.FromDictionaryInternal(e.Data),i},h.FirstParameters={SolveGame:null,PlayValues:"NumberToPlay",CardToCard:"StackCard",PlayCard:"CardToPlay"},h.SecondParameters={SolveGame:null,PlayValues:"ValueToPlay",CardToCard:"BaseCard",PlayCard:null},h}),define("util/dictionary",[],function(){var t=function(t,e){this.initDictionary(t,e)};return t.prototype.initDictionary=function(t,e){this.keyClass=t,this.valueClass=e,this.keys=[],this.values=[]},t.prototype.Add=function(t,e){-1!=this.keys.indexOf(t)?this.values[t]=e:(this.keys.push(t),this.values.push(e))},t.prototype.Get=function(t){var e=this.keys.indexOf(t);return-1!=e?this.values[e]:null},t.prototype.ContainsKey=function(t){return-1!=this.keys.indexOf(t)},t.prototype.Clear=function(){this.keys=[],this.values=[]},t.prototype.GetKeys=function(){return this.keys},t.prototype.GetValues=function(){return this.values},t}),define("SolitaireShared/PyramidLogic/PyramidAuthority",["lodash","absolute/debug","util/dictionary","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/CardLogic/TipEventArgs","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/MoveState","SolitaireShared/CardLogic/DealData","util/eventhandler"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){"use strict";var y=function(){this.initPyramidAuthority()};y.constructor=y,y.prototype=Object.create(n.prototype),y.prototype.initPyramidAuthority=function(){this.CardSupply=new o("Pyramid"),this.CardSupply.Authority=this,this.MaxDeals=3,this.SuppressBonusAnimations=!1,this.IsChallenge=!1,this._lastHint=null,this.DealScript=y.DefaultDealScript,this.WinSetAction=null,this.CardsClearedWerePeaks=[],this._currentConsecutiveCardsClearedWithStock=0,this.MaxConsecutiveCardsClearedWithStock=0,this._currentWasteCardsUsed=0,this.MaxWasteCardsUsed=0,this.CurrentDeal=0,this.TotalDeals=0,this.FreeDeals=0,this.NumBoardsCompleted=0,this.WonWithKing=!1,this.Matches=0,this.RowsCleared=0,this.PassesThroughDeck=0,this._redealing=!1,this.ShowOutOfMovesTip=!0,this.DealScript=y.DefaultDealScript,this.onBonusEffectEventHanlder=new f},Object.defineProperty(y.prototype,"MAX_DEALS",{get:function(){return this.MaxDeals}}),y.MaxPassesThroughDeck=3;y.prototype.Setup=function(){this.CardSupply.AddPile("DealStock","Stock"),this.CardSupply.AddPile("Stock","Stock"),this.CardSupply.AddPile("Waste","Waste"),this.CardSupply.AddPile("Joker","Joker"),this.CardSupply.AddPile("Foundation","Foundation"),this.CardSupply.AddPile("Free","Free"),this._numToTableau=new i(Number,s),this._tableauToNum=new i(s,Number);for(var t=0;t<28;t++){var e=this.CardSupply.AddPile("Tableau"+t,"Tableau"),n=this.CardSupply.GetPile(e);this._numToTableau.Add(t,n),this._tableauToNum.Add(n,t)}this.CurrentDeal=0,this.Matches=0,this.RowsCleared=0,this.NumBoardsCompleted=0,this.TotalDeals=this.MAX_DEALS,this.FreeDeals=0,this.WonWithKing=!1,this.CardSupply.CreateCards(1,4,1)},y.prototype.Reset=function(){this.CardSupply.ResetGame(),this.RemoveWildCards(),this.MaxConsecutiveCardsClearedWithStock=0,this._currentConsecutiveCardsClearedWithStock=0,this.MaxWasteCardsUsed=0,this._currentWasteCardsUsed=0,this.CurrentDeal=0,this.Matches=0,this.RowsCleared=0,this.NumBoardsCompleted=0,this.TotalDeals=this.MAX_DEALS,this.FreeDeals=0},y.prototype.RemoveWildCards=function(){var t=this.CardSupply.GetPile("Joker");null!=t&&t.ClearCards()},y.prototype.OnBoardCleared=function(){var t=this.BoardCleared;null!=t&&t.handeEvent(this)},y.prototype.BoardsCompleted=function(){return this.NumBoardsCompleted},y.prototype.NumDealsLeft=function(){return this.TotalDeals-this.CurrentDeal},y.prototype.ShuffleNumberToString=function(t){return"+SHUFFLE_"+t},y.prototype.GetIthDeckSeed=function(t){return this.CardSupply.GetOption(this.ShuffleNumberToString(t))},y.prototype.Deal=function(){null!=this.OnDealEvent&&this.OnDealEvent(),this.CurrentDeal=this.CardSupply.NumDealsSoFar(),this.PassesThroughDeck=0;var t=!1;if(0!=this.CurrentDeal&&(t=this.CheckWin()),!t&&this.CurrentDeal>=this.TotalDeals)return!1;this.CardSupply.PrepareGame(!1);var i=0==this.CurrentDeal?this.CardSupply.DeckSeed:this.GetIthDeckSeed(this.CurrentDeal);null!=this.CardSupply.CardAnimator&&this.CardSupply.CardAnimator.BeginShuffleAnimation();var n=i;if(i=this.CardSupply.RootPile.Shuffle(i),n!=i)if(0==this.CurrentDeal)this.CardSupply.DeckSeed=i;else{var r=new c(this.CardSupply);r.Parse(["OPTION",this.ShuffleNumberToString(this.CurrentDeal),i]),r.Run(),this.CardSupply.LogAction(r)}return e.log("CardSupply.DeckSeed = "+this.CardSupply.DeckSeed),this.CardSupply.OnShuffleCards(),this.CardSupply.EnforceGameRules=this.CardSupply.LogMoves=!1,c.RunActions(this.CardSupply,this.DealScript),0==this.CurrentDeal?this.CardSupply.StartGame():(this.CardSupply.LogMoves=!0,this.CardSupply.LogAction(c.sParse(this.CardSupply,["DEAL",i])),this.CardSupply.ForceDealEvent(),this.CardSupply.EnforceGameRules=!0),t&&(this.TotalDeals++,this.FreeDeals++,this.OnBoardCleared()),this.CurrentDeal=this.CardSupply.NumDealsSoFar(),this._redealing=!1,!0},y.prototype.Tick=function(t){};var m=[[1,2],[3,4],[4,5],[6,7],[7,8],[8,9],[10,11],[11,12],[12,13],[13,14],[15,16],[16,17],[17,18],[18,19],[19,20],[21,22],[22,23],[23,24],[24,25],[25,26],[26,27]];y.prototype.GetTableauNum=function(t){return this._tableauToNum.ContainsKey(t)?this._tableauToNum.Get(t):-1},y.prototype.GetTableau=function(t){return this._numToTableau.ContainsKey(t)?this._numToTableau.Get(t):null};return y.prototype.GetRow=function(t){var e=this.GetTableauNum(t);return e<0?-1:e<1?0:e<3?1:e<6?2:e<10?3:e<15?4:e<21?5:6},y.prototype.IsTableauBlocked=function(t){if("Tableau"!=t.Type)return!1;var e=this.GetRow(t),i=this.GetTableauNum(t);if(6==e||i>20)return!1;var n=this.GetTableau(m[i][0]),r=this.GetTableau(m[i][1]);return null!=n&&!n.Empty||null!=r&&!r.Empty},y.prototype.IsActionAllowed=function(t,e){if(null==t||null==t.Ops||0==t.Ops.length)return!1;var i=t.Ops[0];if(1==t.Ops.length&&i.Opcode==d.Op.Undo)return!0;if(t.IsNoop())return!0;if(1==t.Ops.length&&i.Opcode==d.Op.Game)return!0;if(i.Opcode==d.Op.TotalDealsExtra)return!0;if(i.Opcode==d.Op.WildCardAdd)return!0;if(1==t.Ops.length){if(i.Opcode==d.Op.Move){var n=i.GetPile(d.eMoveParams.SourcePile),o=i.GetPile(d.eMoveParams.DestPile),a=i.GetNumber(d.eMoveParams.NumCards);if("Stock"==n.Type&&"Waste"==o.Type){if(1==a&&!n.Empty&&!this.CheckWin())return!0}else{if("Waste"==n.Type&&"Stock"==o.Type){var s=this.PassesThroughDeck<y.MaxPassesThroughDeck-1,h=a<0&&o.Empty&&n.Count==-a&&s;return h}if(!("Tableau"!=n.Type&&"Waste"!=n.Type&&"Stock"!=n.Type||"Foundation"!=o.Type||1!=a||n.Empty||this.IsTableauBlocked(n)||n.Top.Value!=l.Values.King)){var u=this.GetTableau(m[0][0]),c=this.GetTableau(m[0][1]);return 1==this.GetTableau(0).Count&&u.Empty&&c.Empty&&(this.WonWithKing=!0),!0}}}else if(i.Opcode==d.Op.Deal){var p=i.GetDeck(d.eDealParams.DeckSeed),g=this.CardSupply.NumDealsSoFar();return p==this.CardSupply.GetOption(this.ShuffleNumberToString(g))}}else if(2==t.Ops.length){var f=t.Ops[1];if(i.Opcode==d.Op.Move&&f.Opcode==d.Op.Move){var n=i.GetPile(d.eMoveParams.SourcePile),o=i.GetPile(d.eMoveParams.DestPile),a=i.GetNumber(d.eMoveParams.NumCards),C=f.GetPile(d.eMoveParams.SourcePile),S=f.GetPile(d.eMoveParams.DestPile),b=f.GetNumber(d.eMoveParams.NumCards);if(this.CheckWin())return!1;if(!("Tableau"!=n.Type&&"Waste"!=n.Type&&"Stock"!=n.Type&&"Joker"!=n.Type||"Foundation"!=o.Type||"Tableau"!=C.Type&&"Waste"!=C.Type&&"Stock"!=C.Type&&"Joker"!=C.Type||"Foundation"!=S.Type)){if(!(1!=a||1!=b||n.Empty||C.Empty||n==C||this.IsTableauBlocked(n)||this.IsTableauBlocked(C))){if(n.Top.ValueNum+C.Top.ValueNum==13)return!0;if(n.Top.Value==l.Values.Joker||C.Top.Value==l.Values.Joker)return!0}e&&null!=this.OnTip&&this.OnTip(this,new r("Tips_Pyramid_Match"))}}}return!1},y.prototype.CanAutoSolve=function(){return!1},y.prototype.CanKeyboardFocusCard=function(t){return!!this.CanPickupCard(t)&&("Tableau"!=t.Pile.Type||!this.IsTableauBlocked(t.Pile))},y.prototype.CanPickupCard=function(t){return!this.CardSupply.WaitingForBlockingAnimation&&("Tableau"==t.Pile.Type||"Waste"==t.Pile.Type||"Free"==t.Pile.Type)},y.prototype.CanAcceptCards=function(t){return"Free"==t.Type},y.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(this.CheckWin()&&(this.WriteSolvableDeckLog(),this.Deal()),!1)},y.prototype.WriteSolvableDeckLog=function(){},y.prototype.CheckWin=function(){return 0==this.GetTableau(0).Count},y.prototype.GetCompletedStacks=function(){return 0},y.prototype.GetScoreForAction=function(t){for(var e=!1,i=!1,n=0,r=[[0,0],[1,2],[3,5],[6,9],[10,14],[15,20],[21,27]],o=[500,250,150,100,75,50,25],a=[],s=0;s<t.Ops.length;s++){var l=t.Ops[s];if(l.Opcode==d.Op.Move&&"Foundation"==l.GetPile(d.eMoveParams.DestPile).Type){var h=this.GetTableauNum(l.GetPile(d.eMoveParams.SourcePile));if(i||(n+=5,i=!0),!e){var u,c=0;for(u=0;u<r.length&&c<=0;u++){var p=r[u];if(h>=p[0]&&h<=p[1])for(var g=p[0];g<=p[1]&&(g==h||this.GetTableau(g).Empty);g++)if(g==p[1]){c=o[u],t.Tag=(2|t.Tag)>>>0;break}}if(u--,c>0){e=!0;for(var f=[],s=h-1;s>=r[u][0];s--)f.push(s);for(var y=[],s=h+1;s<=r[u][1];s++)y.push(s);n+=c,a.push({pile:l.GetPile(d.eMoveParams.SourcePile),bonus:c,tableausToLeft:f,tableausToRight:y,isPerfect:0==u,row:r.length-u})}}}else if(l.Opcode==d.Op.Move&&"Waste"==l.GetPile(d.eMoveParams.SourcePile).Type&&0==l.GetPile(d.eMoveParams.SourcePile).Count)t.Tag=(4|t.Tag)>>>0;else if(l.Opcode==d.Op.Undo)return 0;!this._redealing&&this.CardSupply.GetPile("Tableau0").Empty&&0==this.CardSupply.RootPile.Count&&(this._redealing=!0,this.NumBoardsCompleted++,this.CardSupply.OnBoardCompletedEvent.handleEvent(this.NumBoardsCompleted))}for(var s=0;s<a.length;s++)null!=this.onBonusEffectEventHanlder&&null!=a[s]&&0==this.SuppressBonusAnimations&&this.onBonusEffectEventHanlder.handleEvent(this,a[s]);return n>0&&(t.Tag=(1|t.Tag)>>>0),n},y.prototype.GetScoreForTimer=function(t,e){return this.CardSupply.IsTimerCountdown?Math.max(1e3-10*this.CardSupply.CurrentTime,0):0},y.prototype.GetBonusScore=function(t){return 0},y.prototype.GetMaxScore=function(){return Number.MAX_VALUE},y.prototype.GetMinScore=function(){return 0},y.prototype.GetStartingScore=function(){return 0},y.prototype.GetStartingTime=function(){var t=parseInt(this.CardSupply.GetOption("PyramidTimer"));return isNaN(t)?150:0},y.prototype.GetHint=function(t){return t=!!t,this.GetHintInternal(t)},y.prototype.GetHintInternal=function(t){t=!!t;var e,i,n=[];this.CardSupply.GetPile("Foundation");for(var r=27;r>=0;r--)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty&&!this.IsTableauBlocked(e))if(e.Top.Value!=l.Values.King){for(var o=r-1;o>=0;o--)if(i=this.CardSupply.GetPile("Tableau"+o),!i.Empty&&!this.IsTableauBlocked(i)&&e.Top.ValueNum+i.Top.ValueNum==13){var a=new d(this.CardSupply),s=["MOVE",e.Name,i.Name,"1"];a.Parse(s,0),n.push(a)}var h=this.CardSupply.GetPile("Joker");if(h.GetCards().length>0){var a=new d(this.CardSupply),s=["MOVE",e.Name,h.Name,"1"];a.Parse(s,0),n.push(a)}}else{var a=new d(this.CardSupply),s=["MOVE",e.Name,e.Name,"1"];a.Parse(s,0),n.push(a)}if(!t&&n.length>0)return n[0];if(e=this.CardSupply.GetPile("Stock"),!e.Empty&&(i=this.CardSupply.GetPile("Waste"),!i.Empty&&e.Top.ValueNum+i.Top.ValueNum==13)){var a=new d(this.CardSupply),s=["MOVE",e.Name,i.Name,"1"];a.Parse(s,0),n.push(a)}if(!t&&n.length>0)return n[0];if(e=this.CardSupply.GetPile("Stock"),!e.Empty)for(var r=27;r>=0;r--)if(i=this.CardSupply.GetPile("Tableau"+r),!i.Empty&&!this.IsTableauBlocked(i)&&e.Top.ValueNum+i.Top.ValueNum==13){var a=new d(this.CardSupply),s=["MOVE",e.Name,i.Name,"1"];a.Parse(s,0),n.push(a)}if(!t&&n.length>0)return n[0];if(e=this.CardSupply.GetPile("Waste"),!e.Empty)for(var r=27;r>=0;r--)if(i=this.CardSupply.GetPile("Tableau"+r),!i.Empty&&!this.IsTableauBlocked(i)&&e.Top.ValueNum+i.Top.ValueNum==13){var a=new d(this.CardSupply),s=["MOVE",e.Name,i.Name,"1"];a.Parse(s,0),n.push(a)}if(!t&&n.length>0)return n[0];var u=this.IsDeckPassesAvailable();if(!this.CardSupply.GetPile("Stock").Empty||u){var a=new d(this.CardSupply),s=["MOVE","Stock","Stock","1"];a.Parse(s,0),n.push(a)}if(!t&&n.length>0)return n[0];if(n.length>0){if(!t)return n[0];if(t){if(null!=this._lastHint){var c;for(c=0;c<n.length&&!n[c].Equals(this._lastHint);c++);if(c>=n.length-1){var a=n[0];return this._lastHint=a,a}var a=n[c+1];return this._lastHint=a,a}var a=n[0];return this._lastHint=a,a}}return new d(this.CardSupply)},y.prototype.IsDeckPassesAvailable=function(){return this.PassesThroughDeck<y.MaxPassesThroughDeck-1&&(!this.CardSupply.GetPile("Stock").Empty||!this.CardSupply.GetPile("Waste").Empty)},y.prototype.GetAutomaticMove=function(){return null},y.prototype.CurrentMoveState=function(){return this.CardSupply.WaitingForAnimation||this.IsGameWon()?p.CanMove:this.GetHintInternal().Opcode==d.Op.Noop&&this.AllowDealNextDeck()?this.CurrentDeal>=this.TotalDeals?p.NoMovesLeft:p.CanDealNextDeck:p.CanMove},y.prototype.AllowDealNextDeck=function(){var t=this.GetHintInternal();if(!this.CardSupply.GetPile("Stock").Empty)return!1;if(!this.CardSupply.GetPile("DealStock").Empty)return!1;if(this.PassesThroughDeck>=y.MaxPassesThroughDeck-1||this.CardSupply.GetPile("Waste").Empty)return!0;if(this.PassesThroughDeck<y.MaxPassesThroughDeck-1)return!1;if(t.Opcode==d.Op.Move&&"Stock"!=t.GetPile(d.eMoveParams.DestPile).Type)return!1;for(var e=this.CardSupply.GetPile("Waste").GetCards(),i=e.Count-1;i>=0;i--){if(i>0&&e[i].ValueNum+e[i-1].ValueNum==13)return!1;for(var n=0;n<28;n++){var r=this.GetTableau(n);if(!r.Empty&&!this.IsTableauBlocked(r)&&e[i].ValueNum+r.Top.ValueNum==13)return!1}}return!0},y.prototype.ResetNoMoreMovesState=function(){},y.prototype.TriggerTip=function(t){null!=this.OnTip&&this.OnTip(this,t)},y.prototype.OnRunAction=function(t,e,i){var n=e?-1:1;if(1==t.Ops.length&&t.Ops[0].Opcode==d.Op.Move){var o=t.Ops[0],a=o.GetPile(d.eMoveParams.SourcePile),s=o.GetPile(d.eMoveParams.DestPile);this._currentConsecutiveCardsClearedWithStock=Math.max(0,"Stock"==a.Type&&"Foundation"==s.Type?this._currentConsecutiveCardsClearedWithStock+n:0),this._currentWasteCardsUsed=Math.max(0,"Waste"==a.Type?this._currentWasteCardsUsed+n:0)}else if(2==t.Ops.length){var l=t.Ops[0],h=t.Ops[1]
;l.Opcode==d.Op.Move&&h.Opcode==d.Op.Move&&(this._currentConsecutiveCardsClearedWithStock=Math.max(0,"Stock"==l.GetPile(d.eMoveParams.SourcePile).Type||"Stock"==h.GetPile(d.eMoveParams.SourcePile).Type?this._currentConsecutiveCardsClearedWithStock+n:0),this._currentWasteCardsUsed=Math.max(0,"Waste"==l.GetPile(d.eMoveParams.SourcePile).Type||"Waste"==h.GetPile(d.eMoveParams.SourcePile).Type?this._currentWasteCardsUsed+n:0))}this.MaxConsecutiveCardsClearedWithStock=Math.max(this.MaxConsecutiveCardsClearedWithStock,this._currentConsecutiveCardsClearedWithStock),this.MaxWasteCardsUsed=Math.max(this.MaxWasteCardsUsed,this._currentWasteCardsUsed),i&&null!=this.OnTip&&!this.CheckWin()&&this.GetHintInternal().Opcode==d.Op.Noop&&this.AllowDealNextDeck()&&this.CurrentDeal<this.TotalDeals&&this.OnTip(this,new r("OutOfMoves"))},y.prototype.OnRunSpecialAction=function(t,e){if(0!=t)return e?((1&t)>>>0!=0&&this.Matches--,(2&t)>>>0!=0&&this.RowsCleared--,(4&t)>>>0!=0&&this.PassesThroughDeck--):((1&t)>>>0!=0&&this.Matches++,(2&t)>>>0!=0&&this.RowsCleared++,(4&t)>>>0!=0&&this.PassesThroughDeck++),t},y.prototype.OnGameOver=function(t,e){},y.prototype.GenerateDealData=function(){var t,e,i=0,n="",r=new Array(this.CardSupply.Count);e=this.ProcessDealDataForPile("Stock",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("Waste",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("Foundation",r,n,i),r=e.deck,n=e.script,i=e.cardIndex;for(var t=27;t>=0;t--)e=this.ProcessDealDataForPile("Tableau"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;return n="BEGIN "+n+"END",new g(s.ConstructSeedFromDeck(r,this.CardSupply.Count).toString(),n)},y.prototype.AddExtraDeals=function(t,e){void 0===e&&(e=!0),this.TotalDeals+=t,e&&this.CardSupply.LogAction(c.sParse(this.CardSupply,["TotalExtraDeal",t.toString()]))},y.prototype.AddWildCard=function(t){void 0===t&&(t=!0);for(var e=this.CardSupply.GetCardList(),i=0;i<e.length;i++){var n=e[i];if(n.Value==l.Values.Joker&&n.Suit==h.None){this.CardSupply.GetPile("Joker").AddNew(n),this.CardSupply.WildCardAdded();break}}t&&this.CardSupply.LogAction(c.sParse(this.CardSupply,["WildCardAdd"]))},y.prototype.ApplyCurrentOptInAdBonus=function(t){"extraDeal"==t?this.AddExtraDeals(1):"wildCard"==t&&this.AddWildCard()},y.prototype.ProcessDealDataForPile=function(e,i,n,r){var o=this.CardSupply.GetPile(e);return null==o||o.Empty||(t.forEach(o.GetCards(),function(t){i[r++]=t.Sequence}),n="MOVE Root "+e+" "+o.Count+" "+n),{deck:i,script:n,currentIndex:r}},y.prototype.ForceDealScript=function(t){this.DealScript=null!=t?t:y.DefaultDealScript},y.DefaultDealScript="BEGIN MOVE Root DealStock 52 MOVE DealStock Tableau0 1 MOVE DealStock Tableau1 1 MOVE DealStock Tableau2 1 MOVE DealStock Tableau3 1 MOVE DealStock Tableau4 1 MOVE DealStock Tableau5 1 MOVE DealStock Tableau6 1 MOVE DealStock Tableau7 1 MOVE DealStock Tableau8 1 MOVE DealStock Tableau9 1 MOVE DealStock Tableau10 1 MOVE DealStock Tableau11 1 MOVE DealStock Tableau12 1 MOVE DealStock Tableau13 1 MOVE DealStock Tableau14 1 MOVE DealStock Tableau15 1 MOVE DealStock Tableau16 1 MOVE DealStock Tableau17 1 MOVE DealStock Tableau18 1 MOVE DealStock Tableau19 1 MOVE DealStock Tableau20 1 MOVE DealStock Tableau21 1 MOVE DealStock Tableau22 1 MOVE DealStock Tableau23 1 MOVE DealStock Tableau24 1 MOVE DealStock Tableau25 1 MOVE DealStock Tableau26 1 MOVE DealStock Tableau27 1 MOVE DealStock Stock 24 END",y}),define("SolitaireShared/PyramidLogic/IDailyPyramidAuthority",["SolitaireShared/PyramidLogic/PyramidAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(){this.initIDailyPyramidAuthority()};return r.constructor=r,r.prototype=Object.create(t.prototype),e.call(r.prototype),r.prototype.initIDailyPyramidAuthority=function(){t.call(this),this.MovesAllowed=0,this._startingTime=0,this.ChallengeType=e.ChallengeType.Unknown,this.DeckSeeds=[],this.IsChallenge=!0,this.TotalMoves=0,this.MaxDeals=t.MAX_DEALS},Object.defineProperty(r.prototype,"TimerEnabled",{get:function(){return 0!=this._startingTime}}),Object.defineProperty(r.prototype,"StartingTime",{get:function(){return this._startingTime},set:function(t){this._startingTime=t,this.CardSupply.IsTimerCountdown=0!=this._startingTime}}),r.prototype.GetStartingTime=function(){return this._startingTime},r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var r=e.Ops[n];this.MovesAllowed>0&&0==e.GetActionUndoCount()&&r.Opcode!=i.Op.Noop&&r.Opcode!=i.Op.Deal&&(e.Tag=(1073741824|e.Tag)>>>0)}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){this.MovesAllowed>0&&(this.TotalMoves+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return this.MovesAllowed>0?t.prototype.IsGameWon.call(this)&&this.TotalMoves<=this.MovesAllowed+1:t.prototype.IsGameWon.call(this)},r.prototype.CurrentMoveState=function(){if(this.MovesAllowed>0){if(this.TotalMoves>this.MovesAllowed+1)return n.NoMovesLeft;if(this.TotalMoves==this.MovesAllowed+1)return this.IsGameWon()?n.CanMove:n.NoMovesLeft}return t.prototype.CurrentMoveState.call(this)},r.prototype.GetHint=function(e,n){return e=!!e,n?t.prototype.GetHint.call(this,e,n):new i(this.CardSupply)},r.prototype.Deal=function(){return this.CardSupply.IsGamePageLoaded?(this.TotalMoves=0,this.DeckSeeds.length>0&&(this.CardSupply.DeckSeed=this.DeckSeeds[0]),t.prototype.Deal.call(this)):t.prototype.Deal.call(this)},r.prototype.SetDealScript=function(t){this.DealScript=t},r.prototype.SetNumBoardsCompleted=function(t){this.NumBoardsCompleted=t},r.prototype.GetIthDeckSeed=function(e){return this.CardSupply.IsGamePageLoaded?this.DeckSeeds.length>e?this.DeckSeeds[e]:null:t.prototype.GetIthDeckSeed.call(this,e)},r}),define("SolitaireShared/PyramidLogic/ChallengeAuthorities/AchieveScoreDailyPyramidAuthority",["SolitaireShared/PyramidLogic/PyramidAuthority","SolitaireShared/PyramidLogic/IDailyPyramidAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IAchieveScoreDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants"],function(t,e,i,n,r){"use strict";var o=function(t){this.initAchieveScoreDailyPyramidAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),o.prototype.initAchieveScoreDailyPyramidAuthority=function(t){if(e.call(this),null==t||!t[r.KeyScoreRequired])throw"Invalid parameter passed in creating Daily Challenge";this.ScoreRequired=parseInt(t[r.KeyScoreRequired]),this.ChallengeType=i.ChallengeType.AchieveScore},o.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(!this.CardSupply.IsWaitingForAds&&(!!this.CardSupply.IsGamePageLoaded&&(this.CheckWin()&&this.CardSupply.Score<this.ScoreRequired&&this.Deal(),this.CardSupply.Score>=this.ScoreRequired)))},o}),define("SolitaireShared/CardLogic/IClearBoardsAuthority",[],function(){"use strict";return function(){this.BoardsToClear=0}}),define("SolitaireShared/PyramidLogic/ChallengeAuthorities/ClearBoardDailyPyramidAuthority",["SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/IClearBoardsAuthority","SolitaireShared/PyramidLogic/IDailyPyramidAuthority"],function(t,e,i,n){"use strict";var r=function(t){this.initClearBoardsDailyPyramidAuthority(t)};return r.constructor=r,r.prototype=Object.create(n.prototype),i.call(r.prototype),r.prototype.initClearBoardsDailyPyramidAuthority=function(i){n.call(this,i),this.SuppressBonusAnimations=!0;var r=!0;if(null!=i&&i[e.KeyBoardsToClear]&&(this.BoardsToClear=parseInt(i[e.KeyBoardsToClear]),r=isNaN(this.BoardsToClear)),r)throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=t.ChallengeType.ClearBoards},r.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(!this.CardSupply.IsWaitingForAds&&(!!this.CardSupply.IsGamePageLoaded&&(this.CheckWin()&&this.BoardsCompleted()<this.BoardsToClear&&this.Deal(),!this.CardSupply.WaitingForAnimation&&this.BoardsCompleted()>=this.BoardsToClear)))},r}),define("SolitaireShared/PyramidLogic/ChallengeAuthorities/ClearRowsDailyPyramidAuthority",["SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/PyramidLogic/IDailyPyramidAuthority"],function(t,e,i){"use strict";var n=function(t){this.initClearRowsDailyPyramidAuthority(t)};return n.constructor=n,n.prototype=Object.create(i.prototype),n.prototype.initClearRowsDailyPyramidAuthority=function(e){i.call(this,e),this.SuppressBonusAnimations=!0;var n=!0;if(null!=e&&e.ROWSREQUIRED&&(this.RowsRequired=parseInt(e.ROWSREQUIRED),n=isNaN(this.BoardsToClear)),n)throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=t.ChallengeType.ClearRows},n.prototype.IsGameWon=function(){return!this.CardSupply.IsWaitingForAds&&(!this.CardSupply.WaitingForAnimation&&this.RowsCleared>=this.RowsRequired)},n}),define("SolitaireShared/PyramidLogic/ChallengeAuthorities/PlayCardDailyPyramidAuthority",["SolitaireShared/PyramidLogic/PyramidAuthority","SolitaireShared/PyramidLogic/IDailyPyramidAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IPlayCardDailyAuthority","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayCardDailyPyramidAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this._goalCompleted?1:0}}),o.KeyCardToPlay="CARDTOPLAY",o.prototype.initPlayCardDailyPyramidAuthority=function(t){if(e.call(this),this.SuppressBonusAnimations=!0,null==t||!t[o.KeyCardToPlay])throw"Invalid parameter passed in creating Daily Challenge";this._cardToPlay=this.GetCardValue(t[o.KeyCardToPlay].toUpperCase()),this.ChallengeType=i.ChallengeType.PlayCard,this._goalCompleted=!1},o.prototype.Deal=function(){return this._goalCompleted=!1,e.prototype.Deal.call(this)},o.prototype.GetScoreForAction=function(t){for(var i=!1,n=0;n<t.Ops.length;n++){var o=t.Ops[n],a=o.GetPile(r.eMoveParams.DestPile);if(o.Opcode==r.Op.Move&&"Foundation"==a.Type&&!a.Empty){i=!0;break}}if(i)for(var s=this.CardSupply.GetPile("Foundation").GetCards(),l=0;l<s.length;l++){var h=s[l];if(h.ToString()==this._cardToPlay){this._goalCompleted=!0;break}}return e.prototype.GetScoreForAction.call(this,t)},o.prototype.IsGameWon=function(){return!this.CardSupply.IsWaitingForAds&&(this.CardSupply.GetPile("Foundation"),!this.CardSupply.WaitingForAnimation&&this._goalCompleted)},o.prototype.GetHint=function(t,i){if(i)return e.prototype.GetHint.call(this,t,i);t=!!t;var n,o=[];this.CardSupply.GetPile("Foundation");for(var a=["CHALLENGE"],s=27;s>=0;s--)if(n=this.CardSupply.GetPile("Tableau"+s),!n.Empty&&n.Top.ToString()==this._cardToPlay){a.push(n.Top.Sequence.toString());break}if(n=this.CardSupply.GetPile("Stock"),n.Empty||n.Top.ToString()!=this._cardToPlay||a.push(n.Top.Sequence.toString()),n=this.CardSupply.GetPile("Waste"),n.Empty||n.Top.ToString()!=this._cardToPlay||a.Add(n.Top.Sequence.toString()),a.Count>1){var l=new r(this.CardSupply);l.Parse(a,0),o.push(l)}return o.length>0?o[0]:new r(this.CardSupply)},o.prototype.GetCardValue=function(t){return t},o}),define("SolitaireShared/PyramidLogic/ChallengeAuthorities/PlayValuesDailyPyramidAuthority",["SolitaireShared/PyramidLogic/IDailyPyramidAuthority","SolitaireShared/CardLogic/IPlayValuesDailyAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardValue"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayValuesDailyPyramidAuthority(t)};o.Key_NumToPlay="NUMBERTOPLAY",o.Key_ValueToPlay="VALUETOPLAY";return o.constructor=o,o.prototype=Object.create(t.prototype),e.call(o.prototype),o.prototype.initPlayValuesDailyPyramidAuthority=function(e){t.call(this,e),this._hasWon=!1,this.SuppressBonusAnimations=!0;var n=!0;if(null!=e&&e[o.Key_NumToPlay]&&e[o.Key_ValueToPlay]&&(n=!1,this.NumToPlay=parseInt(e[o.Key_NumToPlay]),this.ValueToPlay=r.getValue(e[o.Key_ValueToPlay]),this._numPlayed=0,!isNaN(this.NumToPlay)&&this.ValueToPlay||(n=!0),n))throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=i.ChallengeType.PlayValues},Object.defineProperty(o.prototype,"Value",{get:function(){return this.ValueToPlay}}),Object.defineProperty(o.prototype,"NumberToPlay",{get:function(){return this.NumToPlay}}),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this._numPlayed}}),o.prototype.Deal=function(){return this.NumDealsLeft()==this.MaxDeals&&(this._numPlayed=0),t.prototype.Deal.call(this)},o.prototype.GetScoreForAction=function(e){for(var i=0;i<e.Ops.length;i++){var r=e.Ops[i],o=r.GetPile(n.eMoveParams.DestPile);if(r.Opcode==n.Op.Move&&"Foundation"==o.Type)for(var a=e.Ops.length,i=1;i<=a;i++)if(o.NthFromTop(i).Value==this.ValueToPlay)return e.Tag=(65536|e.Tag)>>>0,t.prototype.GetScoreForAction.call(this,e)}return t.prototype.GetScoreForAction.call(this,e)},o.prototype.OnRunSpecialAction=function(e,i){(65536&e)>>>0!=0&&(this._numPlayed+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},o.prototype.IsGameWon=function(){return!this.CardSupply.IsWaitingForAds&&(this.CheckWin()&&this._numPlayed<this.NumToPlay&&!this.CardSupply.WaitingForAnimation&&this.Deal(),this._numPlayed>=this.NumToPlay)},o.prototype.GetHint=function(e,i){if(i)return t.prototype.GetHint.call(this,e,i);e=!!e;for(var r,o=[],a=["CHALLENGE"],s=27;s>=0;s--)r=this.CardSupply.GetPile("Tableau"+s),r.Empty||r.Top.Value==this.ValueToPlay&&a.push(r.Top.Sequence.toString());if(r=this.CardSupply.GetPile("Stock"),r.Empty||r.Top.Value!=this.ValueToPlay||a.push(r.Top.Sequence.toString()),r=this.CardSupply.GetPile("Waste"),r.Empty||r.Top.Value!=this.ValueToPlay||a.push(r.Top.Sequence.toString()),a.length>1){var l=new n(this.CardSupply);l.Parse(a,0),o.push(l)}return o.length>0?o[0]:new n(this.CardSupply)},o}),define("Solitaire/DailyChallenges/PyramidChallenge",["lodash","absolute/stringmanager","absolute/textutils","CardUI/IChallengeDefinition","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/Card","SolitaireShared/PyramidLogic/ChallengeAuthorities/AchieveScoreDailyPyramidAuthority","SolitaireShared/PyramidLogic/ChallengeAuthorities/ClearBoardDailyPyramidAuthority","SolitaireShared/PyramidLogic/ChallengeAuthorities/ClearRowsDailyPyramidAuthority","SolitaireShared/PyramidLogic/ChallengeAuthorities/PlayCardDailyPyramidAuthority","SolitaireShared/PyramidLogic/ChallengeAuthorities/PlayValuesDailyPyramidAuthority"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(t,e,i){this.initPyramidChallenge(t,e,i)};return d.constructor=d,d.prototype=Object.create(n.prototype),d.GoalType={ClearBoards:0,AchieveScore:1,ClearRows:2,PlayCard:3,PlayValues:4},d.prototype.GoalType=d.GoalType,d.prototype.initPyramidChallenge=function(t,e,i){n.call(this,t,e,i),this.Parameters.MAXDEALS||(this.Parameters.MAXDEALS="3")},d.prototype.ConstructAuthority=function(){var t=d.AuthorityTypes[this.ChallengeType](this.Parameters);this.SetupOptionsForAuthority(t);var e=parseInt(this.Parameters.MAXDEALS);return!isNaN(e)&&e>0&&(t.MaxDeals=e),t},d.prototype.GetGoalDescription=function(){try{var t=this.Parameters.MAXDEALS;switch(this.ChallengeType){case d.GoalType.ClearBoards:return e(this.CompleteGoalLocString("DailyChallengeGoal_ClearBoards"),[this.Parameters[r.KeyBoardsToClear],t,this.GetTimeFormat(this.AllowedTime)]);case d.GoalType.AchieveScore:return e(this.CompleteGoalLocString("DailyChallengeGoal_AchieveScore"),[i.formatInt(this.Parameters[r.KeyScoreRequired]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):t,t]);case d.GoalType.PlayValues:var n=o.GetLongValueName(this.Parameters[u.Key_ValueToPlay]),a=parseInt(this.Parameters[u.Key_NumToPlay]),s="Card_"+n;return!isNaN(a)&&a>1&&("SIX"==n.toUpperCase()?s+="es":s+="s"),n=e(s),e(this.CompleteGoalLocString("DailyChallengeGoal_ClearValuesFromBoard"),[a.toString(),n,t,this.GetTimeFormat(this.AllowedTime)]);case d.GoalType.PlayCard:var l="DailyChallengeGoal_ClearValuesFromBoard";this.AllowedTime>0?l+="_Time":l+="_Moves";var c=o.GetSymbolStringFromShortName(this.Parameters[h.KeyCardToPlay]);return e(l,[c,t,this.GetTimeFormat(this.AllowedTime)]);default:return""}}catch(t){return""}},d.prototype.GetChallengeIconUrl=function(){return"Content/Icons/DailyChallenges/pyramid.png"},d.prototype.GetModeName=function(){return"Pyramid"},d.prototype.GetShortGoalDescription=function(){switch(this.ChallengeType){case d.GoalType.ClearBoards:return e(this.AllowedMoves>0?"Deals_Board_Challenge":this.AllowedTime>0?"Timed_Board_Challenge":"Board_Challenge");case d.GoalType.PlayCard:case d.GoalType.PlayValues:return e(this.AllowedMoves>0?"Moves_Card_Challenge":this.AllowedTime>0?"Timed_Card_Challenge":"DCTile_Card_Challenge");case d.GoalType.AchieveScore:return e(this.AllowedMoves>0?"Moves_Score_Challenge":this.AllowedTime>0?"Timed_Score_Challenge":"Score_Challenge");default:return""}},d.MakeClearBoardsAuthority=function(t){return new s(t)},d.MakeScoreAuthority=function(t){return new a(t)},d.MakeClearRowsAuthority=function(t){return new l(t)},d.MakePlayCardAuthority=function(t){return new h(t)},d.MakePlayValuesAuthority=function(t){return new u(t)},d.AuthorityTypes=[d.MakeClearBoardsAuthority,d.MakeScoreAuthority,d.MakeClearRowsAuthority,d.MakePlayCardAuthority,d.MakePlayValuesAuthority],d.FromDictionary=function(e){var i=parseInt(e.Data.CHDEF_ChallengeType),n={};t.forEach(e.Data,function(t,e){if(0==e.indexOf("PARAM_")){var i=e.substring(6);n[i]=t}});var r=new d(i,n,e);return r.FromDictionaryInternal(e.Data),r},d.FirstParameters={ClearBoards:"BoardsToClear",AchieveScore:"ScoreRequired",ClearRows:"RowsRequired",PlayCard:"CardToPlay",PlayValues:"NumberToPlay"},d.SecondParameters={ClearBoards:null,AchieveScore:null,ClearRows:null,PlayCard:null,PlayValues:"ValueToPlay"},d.prototype.CompleteGoalLocString=function(t){var e=t,i=parseInt(this.Parameters.MAXDEALS);this.AllowedTime>0&&(e+="_Time"),!isNaN(i)&&i>0&&this.ChallengeType!=d.GoalType.AchieveScore&&(e+="_Moves");var n=0,r=this.Parameters[u.Key_NumToPlay];return n=parseInt(r),!isNaN(n)&&n>1&&(e+="_Multiple"),e},d}),define("SolitaireShared/SpiderLogic/SpiderAuthority",["lodash","absolute/debug","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/CardLogic/TipEventArgs","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/MoveState","SolitaireShared/CardLogic/DealData"],function(t,e,i,n,r,o,a,s,l,h,u,d){"use strict";var c=function(){this.initSpiderAuthority()};c.constructor=c,c.prototype=Object.create(i.prototype),c.constructor=c,c.prototype.initSpiderAuthority=function(){this.CardSupply=new r("Spider"),this.CardSupply.Authority=this,this.IsChallenge=!1,this.MAX_DEALS=0,this.ExhaustedStockBeforeMoving=!1,this.LastHint=null,this.WinSetAction=null,this.DealScript=c.DefaultDealScript},c.prototype.TableauCanTakeCard=function(t,e,i){return i=!!i,null!=t&&null!=e&&(e.Value!=a.Values.Joker&&(!!t.Empty||(!t.Empty&&e.ValueNum==t.Top.ValueNum-1&&e.Color!=s.None&&t.Top.Color!=s.None||(i&&null!=this.OnTip&&this.OnTip(this,new n("Tips_OutOfOrder")),!1))))},c.prototype.Setup=function(){this.CardSupply.AddPile("Stock","Stock"),this.CardSupply.AddPile("Foundation0","Foundation"),this.CardSupply.AddPile("Foundation1","Foundation"),this.CardSupply.AddPile("Foundation2","Foundation"),this.CardSupply.AddPile("Foundation3","Foundation"),this.CardSupply.AddPile("Foundation4","Foundation"),this.CardSupply.AddPile("Foundation5","Foundation"),this.CardSupply.AddPile("Foundation6","Foundation"),this.CardSupply.AddPile("Foundation7","Foundation"),this.CardSupply.AddPile("FaceDown0","FaceDown"),this.CardSupply.AddPile("Tableau0","Tableau"),this.CardSupply.AddPile("FaceDown1","FaceDown"),this.CardSupply.AddPile("Tableau1","Tableau"),this.CardSupply.AddPile("FaceDown2","FaceDown"),this.CardSupply.AddPile("Tableau2","Tableau"),this.CardSupply.AddPile("FaceDown3","FaceDown"),this.CardSupply.AddPile("Tableau3","Tableau"),this.CardSupply.AddPile("FaceDown4","FaceDown"),this.CardSupply.AddPile("Tableau4","Tableau"),this.CardSupply.AddPile("FaceDown5","FaceDown"),this.CardSupply.AddPile("Tableau5","Tableau"),this.CardSupply.AddPile("FaceDown6","FaceDown"),this.CardSupply.AddPile("Tableau6","Tableau"),this.CardSupply.AddPile("FaceDown7","FaceDown"),this.CardSupply.AddPile("Tableau7","Tableau"),this.CardSupply.AddPile("FaceDown8","FaceDown"),this.CardSupply.AddPile("Tableau8","Tableau"),this.CardSupply.AddPile("FaceDown9","FaceDown"),this.CardSupply.AddPile("Tableau9","Tableau"),this.CreateDecks()},c.prototype.Reset=function(){this.CardSupply.ResetGame(),this.ExhaustedStockBeforeMoving=!1},c.prototype.BoardsCompleted=function(){return-1},c.prototype.NumDealsLeft=function(){return 0},c.prototype.CreateDecks=function(){"1"==this.CardSupply.GetOption("Suits")?this.CardSupply.CreateCards(8,1,0):"2"==this.CardSupply.GetOption("Suits")?this.CardSupply.CreateCards(4,2,0):this.CardSupply.CreateCards(2,4,0)},c.prototype.Deal=function(){try{this.CreateDecks(),this.CardSupply.PrepareGame(),null!=this.CardSupply.CardAnimator&&this.CardSupply.CardAnimator.BeginShuffleAnimation(),this.CardSupply.DeckSeed=this.CardSupply.RootPile.Shuffle(this.CardSupply.DeckSeed),this.CardSupply.OnShuffleCards(),h.RunActions(this.CardSupply,this.DealScript),this.CardSupply.StartGame()}catch(t){return e.log(t),!1}return!0},c.prototype.Tick=function(t){},c.prototype.SuitedRunLength=function(t){if(t.Count<=1)return t.Count;for(var e=1;e<t.Count;e++){var i=t.NthFromTop(e),n=t.NthFromTop(e+1);if(i.Suit!=n.Suit)return e;if(n.ValueNum!=i.ValueNum+1)return e}return t.Count},c.prototype.WouldCompleteRun=function(t,e,i){return!!(i>0&&e&&e.Count+i>=13&&this.SuitedRunLength(t)>=i&&this.SuitedRunLength(e)>=13-i&&t.NthFromTop(i).Suit==e.Top.Suit&&t.NthFromTop(i).Value+1==e.Top.Value)},c.prototype.IsDealAllowed=function(){return!(this.CardSupply.GetPile("Stock").Count<10||this.CardSupply.GetPile("Tableau0").Empty||this.CardSupply.GetPile("Tableau1").Empty||this.CardSupply.GetPile("Tableau2").Empty||this.CardSupply.GetPile("Tableau3").Empty||this.CardSupply.GetPile("Tableau4").Empty||this.CardSupply.GetPile("Tableau5").Empty||this.CardSupply.GetPile("Tableau6").Empty||this.CardSupply.GetPile("Tableau7").Empty||this.CardSupply.GetPile("Tableau8").Empty||this.CardSupply.GetPile("Tableau9").Empty)},c.prototype.FaceDownForTableau=function(t){return null==t?null:"Tableau0"==t.Name?t.Supply.GetPile("FaceDown0"):"Tableau1"==t.Name?t.Supply.GetPile("FaceDown1"):"Tableau2"==t.Name?t.Supply.GetPile("FaceDown2"):"Tableau3"==t.Name?t.Supply.GetPile("FaceDown3"):"Tableau4"==t.Name?t.Supply.GetPile("FaceDown4"):"Tableau5"==t.Name?t.Supply.GetPile("FaceDown5"):"Tableau6"==t.Name?t.Supply.GetPile("FaceDown6"):"Tableau7"==t.Name?t.Supply.GetPile("FaceDown7"):"Tableau8"==t.Name?t.Supply.GetPile("FaceDown8"):"Tableau9"==t.Name?t.Supply.GetPile("FaceDown9"):null},c.prototype.IsActionAllowed=function(t,e){if(null==t||null==t.Ops||0==t.Ops.length)return!1;if(this.CardSupply.WaitingForAnimation)return!1;var i=t.Ops[0];if(1==t.Ops.length&&i.Opcode==l.Op.Undo)return!0;if(1==t.Ops.length&&i.Opcode==l.Op.Game)return!0;if(t.IsNoop())return!0;if(i.Opcode==l.Op.Move){var r=i.GetPile(l.eMoveParams.SourcePile),o=i.GetPile(l.eMoveParams.DestPile),s=i.GetNumber(l.eMoveParams.NumCards);if(1==t.Ops.length){if(null==r||null==o)return!1;if("Tableau"==r.Type&&"Tableau"==o.Type){var h=this.FaceDownForTableau(r);if(s>0&&r.Count>=s&&null!=h&&(h.Empty||r.Count>s)&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&!this.WouldCompleteRun(r,o,s))return!0}}else if(2==t.Ops.length){var u=t.Ops[1];if(u.Opcode==l.Op.Move){var d=u.GetPile(l.eMoveParams.SourcePile),c=u.GetPile(l.eMoveParams.DestPile),g=u.GetNumber(l.eMoveParams.NumCards);if(null==r||null==o||null==d||null==c)return!1;if("Tableau"==r.Type&&"Tableau"==o.Type&&"Tableau"==d.Type&&"Foundation"==c.Type){var h=this.FaceDownForTableau(r),f=this.FaceDownForTableau(d);if(s>0&&r.Count>=s&&null!=h&&(h.Empty||r.Count>s)&&null!=f&&(f.Empty||s+d.Count>13)&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&d==o&&c.Empty&&-13==g&&this.WouldCompleteRun(r,o,s))return!0}else if("Tableau"==r.Type&&"Tableau"==o.Type&&"FaceDown"==d.Type&&"Tableau"==c.Type){var h=this.FaceDownForTableau(r);if(s>0&&1==g&&null!=h&&h==d&&!h.Empty&&r.Count==s&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&!this.WouldCompleteRun(r,o,s))return!0}}}else if(3==t.Ops.length){var u=t.Ops[1],y=t.Ops[2];if(u.Opcode==l.Op.Move&&y.Opcode==l.Op.Move){var d=u.GetPile(l.eMoveParams.SourcePile),c=u.GetPile(l.eMoveParams.DestPile),g=u.GetNumber(l.eMoveParams.NumCards),m=y.GetPile(l.eMoveParams.SourcePile),C=y.GetPile(l.eMoveParams.DestPile),S=y.GetNumber(l.eMoveParams.NumCards);if(null==r||null==o||null==d||null==c||null==m||null==C)return!1;if("Tableau"==r.Type&&"Tableau"==o.Type&&"FaceDown"==d.Type&&"Tableau"==c.Type&&"Tableau"==m.Type&&"Foundation"==C.Type){var h=this.FaceDownForTableau(r),f=this.FaceDownForTableau(m);if(s>0&&1==g&&null!=h&&h==d&&!h.Empty&&null!=f&&(f.Empty||s+m.Count>13)&&r.Count==s&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&m==o&&C.Empty&&-13==S&&this.WouldCompleteRun(r,o,s))return!0}else if("Tableau"==r.Type&&"Tableau"==o.Type&&"Tableau"==d.Type&&"Foundation"==c.Type&&"FaceDown"==m.Type&&"Tableau"==C.Type){var b=this.FaceDownForTableau(r),f=this.FaceDownForTableau(d);if(s>0&&-13==g&&1==S&&r.Count>=s&&null!=b&&(b.Empty||r.Count>s)&&f==m&&!f.Empty&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&d==o&&c.Empty&&this.WouldCompleteRun(r,o,s)&&d.Count+s==13)return!0}}}else if(4==t.Ops.length){var u=t.Ops[1],y=t.Ops[2],v=t.Ops[3];if(u.Opcode==l.Op.Move&&y.Opcode==l.Op.Move&&v.Opcode==l.Op.Move){var d=u.GetPile(l.eMoveParams.SourcePile),c=u.GetPile(l.eMoveParams.DestPile),g=u.GetNumber(l.eMoveParams.NumCards),m=y.GetPile(l.eMoveParams.SourcePile),C=y.GetPile(l.eMoveParams.DestPile),S=y.GetNumber(l.eMoveParams.NumCards),w=v.GetPile(l.eMoveParams.SourcePile),x=v.GetPile(l.eMoveParams.DestPile),T=v.GetNumber(l.eMoveParams.NumCards);if(null==r||null==o||null==d||null==c||null==m||null==C||null==w||null==x)return!1;if("Tableau"==r.Type&&"Tableau"==o.Type&&"FaceDown"==d.Type&&"Tableau"==c.Type&&"Tableau"==m.Type&&"Foundation"==C.Type&&"FaceDown"==w.Type&&"Tableau"==x.Type){var b=this.FaceDownForTableau(r),f=this.FaceDownForTableau(m);if(s>0&&1==g&&-13==S&&1==T&&null!=b&&b==d&&!b.Empty&&null!=f&&f==w&&!f.Empty&&r.Count==s&&this.TableauCanTakeCard(o,r.NthFromTop(s),e)&&this.SuitedRunLength(r)>=s&&m==o&&C.Empty&&this.WouldCompleteRun(r,o,s)&&m.Count+s==13)return!0}}}else if(t.Ops.length>=10){if(!this.IsDealAllowed())return e&&null!=this.OnTip&&this.OnTip(this,new n("Tips_Spider_Deal")),!1;for(var M=null,_=null,P=0;P<10;P++){var A=t.Ops[P];if(A.Opcode!=l.Op.Move)return!1;var k=A.GetPile(l.eMoveParams.SourcePile),D=A.GetPile(l.eMoveParams.DestPile),F=A.GetNumber(l.eMoveParams.NumCards);if("Stock"!=k.Name)return!1;if(1!=F)return!1;if(D.Name!=p[P])return!1;if(k.NthFromTop(P+1).Value==a.Values.Ace&&D.Top.Value==a.Values.Two&&D.Top.Suit==k.NthFromTop(P+1).Suit&&12==this.SuitedRunLength(D)){null==M&&(M=[]),M.push(D),null==_&&(_=[]);var h=this.FaceDownForTableau(D);12!=D.Count||h.Empty||_.push(D)}}if(null==M&&10==t.Ops.length)return!0;if(null==M||t.Ops.length!=10+M.length+_.length)return!1;for(var P=(r.Supply.GetPile("Stock"),10);P<t.Ops.length;P++){var A=t.Ops[P];if(A.Opcode!=l.Op.Move)return!1;var k=A.GetPile(l.eMoveParams.SourcePile),D=A.GetPile(l.eMoveParams.DestPile),F=A.GetNumber(l.eMoveParams.NumCards);if("Tableau"==k.Type&&"Foundation"==D.Type){if(-13!=F)return!1;if(!D.Empty)return!1;var E=M.indexOf(k);if(-1==E)return!1;M.splice(E,1)}else{if("FaceDown"!=k.Type||"Tableau"!=D.Type)return!1;if(1!=F)return!1;if(-1!=M.indexOf(D))return!1;var I=_.indexOf(D);if(-1==I)return!1;_.splice(I,1)}}return 0==M.length&&0==_.length}}return!1};var p=["Tableau0","Tableau1","Tableau2","Tableau3","Tableau4","Tableau5","Tableau6","Tableau7","Tableau8","Tableau9"];return c.prototype.CanAutoSolve=function(){return!1},c.prototype.CanKeyboardFocusCard=function(t){return this.CanPickupCard(t)},c.prototype.CanPickupCard=function(t,e){if(e=!!e,this.CardSupply.WaitingForBlockingAnimation)return!1;if("Tableau"!=t.Pile.Type)return!1;var i=t.Pile.GetCardPosFromEnd(t);return!(this.SuitedRunLength(t.Pile)<i)||(e&&null!=this.OnTip&&this.OnTip(this,new n("Tips_Spider_MoveCards")),!1)},c.prototype.CanAcceptCards=function(t){return"Tableau"==t.Type},c.prototype.GetScoreForAction=function(t){for(var e=!1,i=0;i<t.Ops.length;i++){var n=t.Ops[i];if(n.Opcode==l.Op.Move){if("Foundation"==n.GetPile(l.eMoveParams.DestPile).Type)return 100;if("Stock"==n.GetPile(l.eMoveParams.DestPile).Type)return 0;if("Root"==n.GetPile(l.eMoveParams.DestPile).Type)return 0;e=!0}if(n.Opcode==l.Op.Undo){var r=n.GetNumber(l.eUndoParams.ScoreChange);r<=-100&&(r+=100);return-r-n.GetNumber(l.eUndoParams.NumMovesUndone)}}return e?-1:0},c.prototype.GetScoreForTimer=function(t,e){return 0},c.prototype.GetBonusScore=function(t){return 0},c.prototype.GetMaxScore=function(){return Number.MAX_VALUE},c.prototype.GetMinScore=function(){return 0},c.prototype.GetStartingScore=function(){return 500},c.prototype.GetStartingTime=function(){return 0},c.prototype.GetCompletedStacks=function(){var t=0;return 13==this.CardSupply.GetPile("Foundation0").Count&&t++,13==this.CardSupply.GetPile("Foundation1").Count&&t++,13==this.CardSupply.GetPile("Foundation2").Count&&t++,13==this.CardSupply.GetPile("Foundation3").Count&&t++,13==this.CardSupply.GetPile("Foundation4").Count&&t++,13==this.CardSupply.GetPile("Foundation5").Count&&t++,13==this.CardSupply.GetPile("Foundation6").Count&&t++,13==this.CardSupply.GetPile("Foundation7").Count&&t++,t},c.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.CheckWin()},c.prototype.CheckWin=function(){return 8==this.GetCompletedStacks()},c.prototype.GetHint=function(t){return t=!!t,this.GetHintInternal(t)},c.prototype.GetHintInternal=function(t){t=!!t;for(var e,i,n=[],r=0;r<10;r++)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty)for(var o=0;o<10;o++)if(r!=o&&(i=this.CardSupply.GetPile("Tableau"+o),!e.Empty&&!i.Empty)){var s=this.SuitedRunLength(e),h=this.SuitedRunLength(i);if(i.NthFromTop(h).Value==a.Values.King&&e.Top.Value==a.Values.Ace&&i.NthFromTop(h).Suit==e.Top.Suit&&e.Count+i.Count>=13)for(var u=s;u>=1;u--)if(this.TableauCanTakeCard(i,e.NthFromTop(u))){var d=new l(this.CardSupply),c=["MOVE",e.Name,i.Name,u.toString()];d.Parse(c,0),n.push(d);break}}if(!t&&n.length>0)return n[0];for(var r=0;r<10;r++)if(i=this.CardSupply.GetPile("Tableau"+r),i.Empty){for(var o=0;o<10;o++){e=this.CardSupply.GetPile("Tableau"+o);var s=this.SuitedRunLength(e);if(r!=o&&!this.CardSupply.GetPile("FaceDown"+o).Empty&&(s==e.Count||9==o)){var d=new l(this.CardSupply),c=["MOVE",e.Name,i.Name,s.toString()];d.Parse(c,0),n.push(d)}}break}if(!t&&n.length>0)return n[0];for(var r=0;r<10;r++)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty)for(var o=0;o<10;o++)if(r!=o){var s=this.SuitedRunLength(e);if(i=this.CardSupply.GetPile("Tableau"+o),this.TableauCanTakeCard(i,e.NthFromTop(s))&&!i.Empty&&i.Top.Suit==e.Top.Suit){var d=new l(this.CardSupply),c=["MOVE",e.Name,i.Name,s.toString()];d.Parse(c,0),n.push(d)}}if(!t&&n.length>0)return n[0];for(var r=0;r<10;r++)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty)for(var o=0;o<10;o++)if(r!=o){var s=this.SuitedRunLength(e);if(i=this.CardSupply.GetPile("Tableau"+o),
this.TableauCanTakeCard(i,e.NthFromTop(s))&&(!i.Empty&&i.Top.Suit!=e.Top.Suit||i.Empty&&s<e.Count)){var d=new l(this.CardSupply),c=["MOVE",e.Name,i.Name,s.toString()];d.Parse(c,0),n.push(d)}}for(var r=0;r<10;r++)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty)for(var o=0;o<10;o++)if(r!=o)for(var s=this.SuitedRunLength(e),u=s-1;u>=1;u--)if(i=this.CardSupply.GetPile("Tableau"+o),this.TableauCanTakeCard(i,e.NthFromTop(u))&&(i.Empty||i.Top.Suit==e.Top.Suit)){var h=this.SuitedRunLength(i);if(h+u>s){var d=new l(this.CardSupply),c=["MOVE",e.Name,i.Name,u.toString()];d.Parse(c,0),n.push(d);break}}if(!t&&n.length>0)return n[0];if(this.CardSupply.GetPile("Stock").Count>0){var d=new l(this.CardSupply),c=["MOVE","Stock","Stock","1"];d.Parse(c,0),n.push(d)}if(!t&&n.length>0)return n[0];if(n.length>0){if(!t)return n[0];if(t){if(null!=this.LastHint){var p;for(p=0;p<n.length&&!n[p].Equals(this.LastHint);p++);if(p>=n.length-1){var d=n[0];return this.LastHint=d,d}var d=n[p+1];return this.LastHint=d,d}var d=n[0];return this.LastHint=d,d}}return new l(this.CardSupply)},c.prototype.GetCardHint=function(t){var e,i,n,r=t.Pile,o=parseInt(r.Name[r.Name.length-1]),a=r.GetCardPosFromEnd(t),s=a.toString(),h=new l(this.CardSupply),u=[];if("Tableau"===t.Pile.Type){for(e=o+1;e<10;e++)u.push(e);for(e=0;e<o;e++)u.push(e);for(e=0;e<u.length;e++)if(n=u[e],i=this.CardSupply.GetPile("Tableau"+n),this.WouldCompleteRun(r,i,a)&&this.TableauCanTakeCard(i,t,!1))return h.Parse(["MOVE",r.Name,i.Name,s],0),h;for(e=0;e<u.length;e++)if(n=u[e],i=this.CardSupply.GetPile("Tableau"+n),!i.Empty&&i.Top.Suit===r.Top.Suit&&this.TableauCanTakeCard(i,t,!1))return h.Parse(["MOVE",r.Name,i.Name,s],0),h;for(e=0;e<u.length;e++)if(n=u[e],i=this.CardSupply.GetPile("Tableau"+n),!i.Empty&&i.Top.Suit!==r.Top.Suit&&this.TableauCanTakeCard(i,t,!1))return h.Parse(["MOVE",r.Name,i.Name,s],0),h;for(e=0;e<u.length;e++)if(n=u[e],i=this.CardSupply.GetPile("Tableau"+n),i.Empty&&this.TableauCanTakeCard(i,t,!1))return h.Parse(["MOVE",r.Name,i.Name,s],0),h;for(e=0;e<u.length;e++)if(n=u[e],i=this.CardSupply.GetPile("Tableau"+n),this.TableauCanTakeCard(i,t,!1))return h.Parse(["MOVE",r.Name,i.Name,s],0),h}},c.prototype.GetEmptyColumns=function(){for(var t=[],e=0;e<10;e++){var i=this.CardSupply.GetPile("Tableau"+e);i.Empty&&t.push(i)}return t},c.prototype.GetAutomaticMove=function(){return null},c.prototype.CurrentMoveState=function(){return this.CardSupply.WaitingForAnimation||this.IsGameWon()?u.CanMove:this.GetHintInternal().Opcode==l.Op.Noop?u.NoMovesLeft:u.CanMove},c.prototype.ResetNoMoreMovesState=function(){},c.prototype.TriggerTip=function(t){null!=this.OnTip&&this.OnTip(this,t)},c.prototype.OnRunAction=function(t,e,i){},c.prototype.OnRunSpecialAction=function(t,e){},c.prototype.OnGameOver=function(t,e){this.ExhaustedStockBeforeMoving=!1},c.prototype.GenerateDealData=function(){var t,e,i=0,n="",r=[];for(e=this.ProcessDealDataForPile("Stock",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,t=7;t>=0;t--)e=this.ProcessDealDataForPile("Foundation"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;for(t=9;t>=0;t--)e=this.ProcessDealDataForPile("Tableau"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=ProcessDealDataForPile("FaceDown"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;return n="BEGIN "+n+"END",new d(o.ConstructSeedFromDeck(r,this.CardSupply.Count).ToString(),n)},c.prototype.AddExtraDeals=function(t,e){},c.prototype.AddWildCard=function(t){},c.prototype.ApplyCurrentOptInAdBonus=function(t){},c.prototype.ProcessDealDataForPile=function(e,i,n,r){var o=this.CardSupply.GetPile(e);return null==o||o.Empty||(t.forEach(o.GetCards(),function(t){i[r++]=t.Sequence}),n="MOVE Root "+e+" "+o.Count+" "+n),{deck:i,script:n,currentIndex:r}},c.prototype.ForceDealScript=function(t){this.DealScript=null!=t?t:c.DefaultDealScript},c.DefaultDealScript="BEGIN MOVE Root Stock 104 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock FaceDown7 1 MOVE Stock FaceDown8 1 MOVE Stock FaceDown9 1 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock FaceDown7 1 MOVE Stock FaceDown8 1 MOVE Stock FaceDown9 1 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock FaceDown7 1 MOVE Stock FaceDown8 1 MOVE Stock FaceDown9 1 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock FaceDown7 1 MOVE Stock FaceDown8 1 MOVE Stock FaceDown9 1 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock Tableau4 1 MOVE Stock Tableau5 1 MOVE Stock Tableau6 1 MOVE Stock Tableau7 1 MOVE Stock Tableau8 1 MOVE Stock Tableau9 1 MOVE Stock Tableau0 1 MOVE Stock Tableau1 1 MOVE Stock Tableau2 1 MOVE Stock Tableau3 1 END",c}),define("SolitaireShared/SpiderLogic/IDailySpiderAuthority",["SolitaireShared/SpiderLogic/SpiderAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(){this.initIDailySpiderAuthority()};return r.TAG_MOVEPERFORMED=1073741824,r.constructor=r,r.prototype=Object.create(t.prototype),e.call(r.prototype),r.prototype.initIDailySpiderAuthority=function(){t.call(this),this.MovesAllowed=0,this._startingTime=0,this.ChallengeType=e.ChallengeType.Unknown,this.DeckSeeds=[],this.IsChallenge=!0,this.TotalMoves=0},r.prototype.GetScoreForTimer=function(t,e){return 0},Object.defineProperty(r.prototype,"TimerEnabled",{get:function(){return 0!=this._startingTime}}),Object.defineProperty(r.prototype,"StartingTime",{get:function(){return this._startingTime},set:function(t){this._startingTime=t,this.CardSupply.IsTimerCountdown=0!=this._startingTime}}),r.prototype.GetStartingTime=function(){return this._startingTime},r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var o=e.Ops[n];this.MovesAllowed>0&&0==e.GetActionUndoCount()&&o.Opcode!=i.Op.Noop&&o.Opcode!=i.Op.Deal&&(e.Tag=(e.Tag|r.TAG_MOVEPERFORMED)>>>0)}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){this.MovesAllowed>0&&(this.TotalMoves+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return this.MovesAllowed>0?t.prototype.IsGameWon.call(this)&&this.TotalMoves<=this.MovesAllowed+1:t.prototype.IsGameWon.call(this)},r.prototype.CurrentMoveState=function(){if(this.MovesAllowed>0&&!this.CardSupply.WaitingForAnimation){if(this.TotalMoves>this.MovesAllowed+1)return n.NoMovesLeft;if(this.TotalMoves==this.MovesAllowed+1)return this.IsGameWon()?n.CanMove:n.NoMovesLeft}return t.prototype.CurrentMoveState.call(this)},r.prototype.GetHint=function(e,n){return n?t.prototype.GetHint.call(this,e,n):new i(this.CardSupply)},r.prototype.Deal=function(){return this.TotalMoves=0,this.DeckSeeds.length>0&&(this.CardSupply.DeckSeed=this.DeckSeeds[0]),t.prototype.Deal.call(this)},r.prototype.SetDealScript=function(t){this.DealScript=t},r.prototype.SetNumBoardsCompleted=function(t){},r}),define("SolitaireShared/SpiderLogic/ChallengeAuthorities/AchieveScoreDailySpiderAuthority",["SolitaireShared/SpiderLogic/SpiderAuthority","SolitaireShared/SpiderLogic/IDailySpiderAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IAchieveScoreDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants"],function(t,e,i,n,r){"use strict";var o=function(t){this.initAchieveScoreDailySpiderAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),o.prototype.initAchieveScoreDailySpiderAuthority=function(t){if(e.call(this),null==t||!t[r.KeyScoreRequired])throw"Invalid parameter passed in creating Daily Challenge";this.ScoreRequired=parseInt(t[r.KeyScoreRequired]),this.ChallengeType=i.ChallengeType.AchieveScore},o.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.CardSupply.Score>=this.ScoreRequired},o}),define("SolitaireShared/SpiderLogic/ChallengeAuthorities/BuildStacksDailySpiderAuthority",["SolitaireShared/SpiderLogic/SpiderAuthority","SolitaireShared/SpiderLogic/IDailySpiderAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants"],function(t,e,i,n){"use strict";var r=function(t){this.initBuildStacksDailySpiderAuthority(t)};return r.constructor=r,r.prototype=Object.create(e.prototype),r.prototype.initBuildStacksDailySpiderAuthority=function(t){if(e.call(this),null==t||!t[n.KeyStacksRequired])throw"Invalid parameter passed in creating Daily Challenge";this.StacksRequired=parseInt(t[n.KeyStacksRequired]),this.ChallengeType=i.ChallengeType.BuildStacks},r.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&this.GetCompletedStacks()>=this.StacksRequired},r}),define("SolitaireShared/SpiderLogic/ChallengeAuthorities/SolveGameDailySpiderAuthority",["SolitaireShared/SpiderLogic/IDailySpiderAuthority","SolitaireShared/CardLogic/IDailyAuthority"],function(t,e){"use strict";var i=function(t){this.initSolveGameDailySpiderAuthority(t)};return i.constructor=i,i.prototype=Object.create(t.prototype),i.prototype.initSolveGameDailySpiderAuthority=function(i){t.call(this,i),this.ChallengeType=e.ChallengeType.SolveGame},i}),define("Solitaire/DailyChallenges/SpiderChallenge",["lodash","absolute/stringmanager","absolute/textutils","CardUI/IChallengeDefinition","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/Card","SolitaireShared/SpiderLogic/ChallengeAuthorities/AchieveScoreDailySpiderAuthority","SolitaireShared/SpiderLogic/ChallengeAuthorities/BuildStacksDailySpiderAuthority","SolitaireShared/SpiderLogic/ChallengeAuthorities/SolveGameDailySpiderAuthority"],function(t,e,i,n,r,o,a,s,l){"use strict";var h=function(t,e,i){this.initSpiderChallenge(t,e,i)};return h.constructor=h,h.prototype=Object.create(n.prototype),h.GoalType={SolveGame:0,AchieveScore:1,BuildStacks:2},h.prototype.GoalType=h.GoalType,h.prototype.initSpiderChallenge=function(t,e,i){n.call(this,t,e,i)},h.prototype.ConstructAuthority=function(){var t=h.AuthorityTypes[this.ChallengeType](this.Parameters);return this.SetupOptionsForAuthority(t),t},h.prototype.SetupOptionsForAuthority=function(t){t.CardSupply.SetOption("SUITS",this.Parameters.SUITS),n.prototype.SetupOptionsForAuthority.call(this,t)},h.prototype.GetGoalDescription=function(){try{switch(this.ChallengeType){case h.GoalType.SolveGame:return e(this.CompleteGoalLocString("DailyChallengeGoal_SolveDeck"),[this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);case h.GoalType.AchieveScore:return e(this.CompleteGoalLocString("DailyChallengeGoal_AchieveScore"),[i.formatInt(this.Parameters[r.KeyScoreRequired]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);case h.GoalType.BuildStacks:return e(this.CompleteGoalLocString("DailyChallengeGoal_FinishStacks"),[this.Parameters[r.KeyStacksRequired],this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):this.AllowedMoves.toString(),this.AllowedMoves.toString()]);default:return""}}catch(t){return""}},h.prototype.GetChallengeIconUrl=function(){return"Content/Icons/DailyChallenges/spider.png"},h.prototype.GetModeName=function(){return"Spider"},h.prototype.GetShortGoalDescription=function(){switch(this.ChallengeType){case h.GoalType.SolveGame:return e(this.AllowedMoves>0?"Moves_Solve_Challenge":this.AllowedTime>0?"Timed_Solve_Challenge":"Solve_Challenge");case h.GoalType.BuildStacks:return e(this.AllowedMoves>0?"Moves_Stack_Challenge":this.AllowedTime>0?"Timed_Stack_Challenge":"Stack_Challenge");case h.GoalType.AchieveScore:return e(this.AllowedMoves>0?"Moves_Score_Challenge":this.AllowedTime>0?"Timed_Score_Challenge":"Score_Challenge");default:return""}},h.MakeSolveAuthority=function(t){return new l(t)},h.MakeScoreAuthority=function(t){return new a(t)},h.MakeBuildStacksAuthority=function(t){return new s(t)},h.AuthorityTypes=[h.MakeSolveAuthority,h.MakeScoreAuthority,h.MakeBuildStacksAuthority],h.FromDictionary=function(e){var i=null,n=parseInt(e.Data.CHDEF_ChallengeType),r={};return t.forEach(e.Data,function(t,e){if(0==e.indexOf("PARAM_")){var i=e.substring(6);r[i]=t}}),i=new h(n,r,e),i.FromDictionaryInternal(e.Data),i},h.FirstParameters={SolveGame:null,AchieveScore:"ScoreRequired",BuildStacks:"StacksRequired"},h.SecondParameters={SolveGame:null,AchieveScore:null,BuildStacks:null},h}),define("SolitaireShared/TriPeaksLogic/TriPeaksAuthority",["lodash","absolute/debug","util/dictionary","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/CardLogic/TipEventArgs","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardColor","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/MoveState","SolitaireShared/CardLogic/DealData","util/eventhandler"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){"use strict";var y=function(){this.initTriPeaksAuthority()};y.constructor=y,y.prototype=Object.create(n.prototype),y.prototype.initTriPeaksAuthority=function(){this.CardSupply=new o("TriPeaks"),this.CardSupply.Authority=this,this.MaxDeals=3,this.SuppressBonusAnimations=!1,this.IsChallenge=!1,this._lastHint,this.DealScript=y.DefaultDealScript,this.WinSetAction=null,this.CardsClearedWerePeaks=[],this._currentCardsRemovedWithoutUsingStock=0,this.MaxCardsRemovedWithoutUsingStock=0,this.CurrentDeal=0,this.TotalDeals=0,this.FreeDeals=0,this.NumBoardsCompleted=0,this.NumPeaksCleared=0,this.WonWithKing=!1,this.CardsChained=0,this._chainNumber=0,this.onBonusEffectEventHanlder=new f},Object.defineProperty(y.prototype,"MAX_DEALS",{get:function(){return this.MaxDeals}});y.prototype.Setup=function(){this._numToTableau=new i(Number,s),this._tableauToNum=new i(s,Number),this._numToFaceDown=new i(Number,s),this._faceDownToNum=new i(s,Number);for(var t=0;t<28;t++){var e=this.CardSupply.AddPile("FaceDown"+t,"FaceDown"),n=this.CardSupply.GetPile(e);this._numToFaceDown.Add(t,n),this._faceDownToNum.Add(n,t);var e=this.CardSupply.AddPile("Tableau"+t,"Tableau"),n=this.CardSupply.GetPile(e);this._numToTableau.Add(t,n),this._tableauToNum.Add(n,t)}this.CardSupply.AddPile("Stock","Stock"),this.CardSupply.AddPile("Waste","Waste"),this.CardSupply.AddPile("Joker","Joker"),this.CurrentDeal=0,this.NumBoardsCompleted=0,this.NumPeaksCleared=0,this.TotalDeals=this.MAX_DEALS,this.FreeDeals=0,this.WonWithKing=!1,this.CardSupply.CreateCards(1,4,1)},y.prototype.Reset=function(){this.CardSupply.ResetGame(),this.RemoveWildCards(),this.MaxCardsRemovedWithoutUsingStock=0,this._currentCardsRemovedWithoutUsingStock=0,this.CardsClearedWerePeaks=[],this.CurrentDeal=0,this.NumBoardsCompleted=0,this.NumPeaksCleared=0,this.TotalDeals=this.MAX_DEALS,this.FreeDeals=0},y.prototype.OnBoardCleared=function(){var t=this.BoardCleared;null!=t&&t.handeEvent(this)},y.prototype.RemoveWildCards=function(){var t=this.CardSupply.GetPile("Joker");null!=t&&t.ClearCards()},y.prototype.BoardsCompleted=function(){return this.NumBoardsCompleted},y.prototype.NumDealsLeft=function(){return this.TotalDeals-this.CurrentDeal},y.prototype.ShuffleNumberToString=function(t){return"+SHUFFLE_"+t},y.prototype.GetIthDeckSeed=function(t){return this.CardSupply.GetOption(this.ShuffleNumberToString(t))},y.prototype.Deal=function(){null!=this.OnDealEvent&&this.OnDealEvent(),this.CardsClearedWerePeaks=[],this.CurrentDeal=this.CardSupply.NumDealsSoFar();var t=!1;if(0!=this.CurrentDeal&&(t=this.CheckWin()),!t&&this.CurrentDeal>=this.TotalDeals)return!1;this.CardSupply.PrepareGame(!1);var i=0==this.CurrentDeal?this.CardSupply.DeckSeed:this.GetIthDeckSeed(this.CurrentDeal);null!=this.CardSupply.CardAnimator&&this.CardSupply.CardAnimator.BeginShuffleAnimation();var n=i;if(i=this.CardSupply.RootPile.Shuffle(i),n!=i)if(0==this.CurrentDeal)this.CardSupply.DeckSeed=i;else{var r=new c(this.CardSupply);r.Parse(["OPTION",this.ShuffleNumberToString(this.CurrentDeal),i]),r.Run(),this.CardSupply.LogAction(r)}return e.log("CardSupply.DeckSeed = "+this.CardSupply.DeckSeed),this.CardSupply.OnShuffleCards(),this.CardSupply.EnforceGameRules=this.CardSupply.LogMoves=!1,c.RunActions(this.CardSupply,this.DealScript),0==this.CurrentDeal?this.CardSupply.StartGame():(this.CardSupply.LogMoves=!0,this.CardSupply.LogAction(c.sParse(this.CardSupply,["DEAL",i])),this.CardSupply.ForceDealEvent(),this.CardSupply.EnforceGameRules=!0),this.CurrentDeal=this.CardSupply.NumDealsSoFar(),t&&this.NumDealsLeft()<this.MAX_DEALS-1+this.CardSupply.NumExtraDealsSoFar()&&(this.TotalDeals++,this.FreeDeals++,this.OnBoardCleared()),this._chainNumber=0,!0},y.prototype.Tick=function(t){};var m=[[3,4],[5,6],[7,8],[9,10],[10,11],[12,13],[13,14],[15,16],[16,17],[18,19],[19,20],[20,21],[21,22],[22,23],[23,24],[24,25],[25,26],[26,27]];y.prototype.GetTableauNum=function(t){return this._tableauToNum.ContainsKey(t)?this._tableauToNum.Get(t):-1},y.prototype.GetTableau=function(t){return this._numToTableau.ContainsKey(t)?this._numToTableau.Get(t):null},y.prototype.GetFaceDownNum=function(t){return this._faceDownToNum.ContainsKey(t)?this._faceDownToNum.Get(t):-1},y.prototype.GetFaceDown=function(t){return this._numToFaceDown.ContainsKey(t)?this._numToFaceDown.Get(t):null},y.prototype.GetFaceDownForTableau=function(t){var e=this.GetTableauNum(t);return this.GetFaceDown(e)};return y.prototype.GetRow=function(t){var e=this.GetTableauNum(t);return e<0?-1:e<3?1:e<9?2:e<18?3:4},y.prototype.GetTableausUnderTableau=function(t){var e=[];if(0==this.GetRow(t))return e;for(var i=this.GetTableauNum(t),n=0;n<18;n++)m[n][0]!=i&&m[n][1]!=i||e.push(this.GetTableau(n));return e},y.prototype.GetTableausRevealedByRemoving=function(t){var e=[];if(0==this.GetRow(t))return e;for(var i=this.GetTableausUnderTableau(t),n=0;n<i.length;n++){var r=i[n];this.IsTheOnlyOneBlocking(t,r)&&e.push(r)}return e},y.prototype.IsTableauBlocked=function(t,e){if(e=e||-1,"Tableau"!=t.Type)return!1;var i=this.GetRow(t),n=this.GetTableauNum(t);if(-1==n&&(n=this.GetFaceDownNum(t)),4==i||n>17)return!1;var r=m[n][0],o=m[n][1];r==e&&(r=-1),o==e&&(o=-1);var a=this.GetTableau(r),s=this.GetTableau(o);return null!=a&&!a.Empty||(null!=s&&!s.Empty||(a=this.GetFaceDown(m[n][0]),s=this.GetFaceDown(m[n][1]),null!=a&&!a.Empty||null!=s&&!s.Empty))},y.prototype.IsPileAPeak=function(t){var e=this.GetTableauNum(t);return e>=0&&e<=2},y.prototype.IsTheOnlyOneBlocking=function(t,e){return!(!this.IsTableauBlocked(e)||this.IsTableauBlocked(e,this.GetTableauNum(t)))},y.prototype.WasteCanTakeCard=function(t,e){return this.WasteCanTakeCard(t,e,!1)},y.prototype.WasteCanTakeCard=function(t,e,i){var n=t.Top;if(null==n)return!0;if(n.Value==l.Values.Joker||e.Value==l.Values.Joker)return!0;if(n.Value==l.Values.Ace&&e.Value==l.Values.King)return!0;if(n.Value==l.Values.King&&e.Value==l.Values.Ace)return!0;var o=n.ValueNum-e.ValueNum;return 1==o||-1==o||(i&&null!=this.OnTip&&this.OnTip(this,new r("Tips_TriPeaks_InvalidMove")),!1)},y.prototype.IsActionAllowed=function(t,e){if(null==t||null==t.Ops||0==t.Ops.length)return!1;var i=t.Ops[0];if(1==t.Ops.length&&i.Opcode==d.Op.Undo)return!0;if(t.IsNoop())return!0;if(1==t.Ops.length&&i.Opcode==d.Op.Game)return!0;if(1==t.Ops.length&&i.Opcode==d.Op.Option)return!0;if(i.Opcode==d.Op.TotalDealsExtra)return!0;if(i.Opcode==d.Op.WildCardAdd)return!0;if(i.Opcode==d.Op.Deal){var n=i.GetDeck(d.eDealParams.DeckSeed),r=this.CurrentDeal;return n==this.CardSupply.GetOption(this.ShuffleNumberToString(r))}if(1==t.Ops.length){var o=i.GetPile(d.eMoveParams.SourcePile),a=i.GetPile(d.eMoveParams.DestPile),s=i.GetNumber(d.eMoveParams.NumCards);if(("Stock"==o.Type||"Joker"==o.Type)&&"Waste"==a.Type)return 1==s&&!o.Empty&&!this.CheckWin();if("Tableau"==o.Type&&"Waste"==a.Type&&1==s&&!o.Empty&&this.WasteCanTakeCard(a,o.Top,e)){var h=this.GetTableausRevealedByRemoving(o);if(0==this.GetRow(o)||0==h.length){if(o.Top.Value==l.Values.King){1==this.GetTableau(0).Count+this.GetFaceDown(0).Count+this.GetTableau(1).Count+this.GetFaceDown(1).Count+this.GetTableau(2).Count+this.GetFaceDown(2).Count&&(this.WonWithKing=!0)}return!0}}}else if(2==t.Ops.length){var u=t.Ops[1];if(i.Opcode==d.Op.Move&&u.Opcode==d.Op.Move){var o=i.GetPile(d.eMoveParams.SourcePile),a=i.GetPile(d.eMoveParams.DestPile),s=i.GetNumber(d.eMoveParams.NumCards),c=u.GetPile(d.eMoveParams.SourcePile),p=u.GetPile(d.eMoveParams.DestPile),g=u.GetNumber(d.eMoveParams.NumCards);if("Tableau"==o.Type&&"Waste"==a.Type&&"FaceDown"==c.Type&&"Tableau"==p.Type&&1==s&&1==g&&!o.Empty&&!c.Empty&&p.Empty&&this.WasteCanTakeCard(a,o.Top,e)&&c==this.GetFaceDownForTableau(p)){var h=this.GetTableausRevealedByRemoving(o);if(1==h.length&&h[0]==p)return!0}}}else if(3==t.Ops.length){var u=t.Ops[1],f=t.Ops[2];if(i.Opcode==d.Op.Move&&u.Opcode==d.Op.Move){var o=i.GetPile(d.eMoveParams.SourcePile),a=i.GetPile(d.eMoveParams.DestPile),s=i.GetNumber(d.eMoveParams.NumCards),c=u.GetPile(d.eMoveParams.SourcePile),p=u.GetPile(d.eMoveParams.DestPile),g=u.GetNumber(d.eMoveParams.NumCards),y=f.GetPile(d.eMoveParams.SourcePile),m=f.GetPile(d.eMoveParams.DestPile),C=f.GetNumber(d.eMoveParams.NumCards);if("Tableau"==o.Type&&"Waste"==a.Type&&"FaceDown"==c.Type&&"Tableau"==p.Type&&"FaceDown"==y.Type&&"Tableau"==m.Type&&1==s&&1==g&&1==C&&!o.Empty&&!c.Empty&&!y.Empty&&p.Empty&&m.Empty&&m!=p&&this.WasteCanTakeCard(a,o.Top,e)&&c==this.GetFaceDownForTableau(p)&&y==this.GetFaceDownForTableau(m)){var h=this.GetTableausRevealedByRemoving(o);if(2==h.length&&h[0]==p&&h[1]==m||h[1]==p&&h[0]==m)return!0}}}return!1},y.prototype.CanAutoSolve=function(){return!1},y.prototype.CanKeyboardFocusCard=function(t){return!!this.CanPickupCard(t)&&("Tableau"!=t.Pile.Type||!this.IsTableauBlocked(t.Pile))},y.prototype.CanPickupCard=function(t){return!this.CardSupply.WaitingForBlockingAnimation&&"Tableau"==t.Pile.Type},y.prototype.CanAcceptCards=function(t){return"Waste"==t.Type},y.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(this.CheckWin()&&(this.WriteSolvableDeckLog(),this.Deal()),!1)},y.prototype.WriteSolvableDeckLog=function(){},y.prototype.CheckWin=function(){return 0==this.GetTableau(0).Count&&0==this.GetFaceDown(0).Count&&0==this.GetTableau(1).Count&&0==this.GetFaceDown(1).Count&&0==this.GetTableau(2).Count&&0==this.GetFaceDown(2).Count},y.prototype.GetCompletedStacks=function(){return 0},y.prototype.GetScoreForAction=function(t){for(var e=0,i=0;i<t.Ops.length;i++){var n=t.Ops[i],r=n.GetPile(d.eMoveParams.SourcePile),o=n.GetPile(d.eMoveParams.DestPile);if(n.Opcode==d.Op.Move&&"Tableau"==r.Type&&"Waste"==o.Type){var a=this.GetTableauNum(r);if(e+=100+200*this._chainNumber,(65535&t.Tag)>>>0==0?this._chainNumber++:e-=200,a<3){var s=0;(0==this.GetTableau(0).Count&&0==this.GetFaceDown(0).Count||0==a)&&s++,(0==this.GetTableau(1).Count&&0==this.GetFaceDown(1).Count||1==a)&&s++,(0==this.GetTableau(2).Count&&0==this.GetFaceDown(2).Count||2==a)&&s++,this.NumPeaksCleared=3*this.NumBoardsCompleted+s,3==s&&(65535&t.Tag)>>>0==0&&(this.IsChallenge&&this.SuppressBonusAnimations?(this.NumBoardsCompleted++,this.CardSupply.OnBoardCompletedEvent.handleEvent(this.NumBoardsCompleted)):setTimeout(function(){this.NumBoardsCompleted++,this.CardSupply.OnBoardCompletedEvent.handleEvent(this.NumBoardsCompleted)}.bind(this),2250));var l=0;switch(s){case 1:l=500;break;case 2:l=1e3;break;case 3:l=5e3}e+=l,null!=this.onBonusEffectEventHanlder&&l>0&&!this.SuppressBonusAnimations&&this.onBonusEffectEventHanlder.handleEvent(this,{pile:r,bonus:l,peaks:s,isPerfect:3==s})}}else if(n.Opcode==d.Op.Move&&"Stock"==r.Type)this._chainNumber>this.CardsChained&&(this.CardsChained=this._chainNumber),this._chainNumber=0;else if(n.Opcode==d.Op.Undo)return this._chainNumber>this.CardsChained&&(this.CardsChained=this._chainNumber),this._chainNumber=0,0}return t.Tag=(t.Tag|this._chainNumber)>>>0,e},y.prototype.GetScoreForTimer=function(t,e){return 0},y.prototype.GetBonusScore=function(t){return 0},y.prototype.GetMaxScore=function(){return Number.MAX_VALUE},y.prototype.GetMinScore=function(){return 0},y.prototype.GetStartingScore=function(){return 0},y.prototype.GetStartingTime=function(){return 0},y.prototype.GetHint=function(t){return t=!!t,this.GetHintInternal(t)},y.prototype.GetHintInternal=function(t){t=!!t;for(var e,i=[],n=this.CardSupply.GetPile("Waste"),r=27;r>=0;r--)if(e=this.CardSupply.GetPile("Tableau"+r),!e.Empty&&this.WasteCanTakeCard(n,e.Top)){var o=new d(this.CardSupply),a=["MOVE",e.Name,e.Name,"1"];o.Parse(a,0),i.push(o)}if(e=this.CardSupply.GetPile("Joker"),e.GetCards().length>0&&this.WasteCanTakeCard(n,e.Top)){var o=new d(this.CardSupply),a=["MOVE",e.Name,e.Name,"1"];o.Parse(a,0),i.push(o)}if(!t&&i.length>0)return i[0];if(e=this.CardSupply.GetPile("Stock"),!e.Empty){var o=new d(this.CardSupply),a=["MOVE","Stock","Stock","1"];o.Parse(a,0),i.push(o)}if(i.length>0){if(!t)return i[0];if(t){if(null!=this._lastHint){var s;for(s=0;s<i.length&&!i[s].Equals(this._lastHint);s++);if(s>=i.length-1){var o=i[0];return this._lastHint=o,o}var o=i[s+1];return this._lastHint=o,o}var o=i[0];return this._lastHint=o,o}}return new d(this.CardSupply)},y.prototype.GetAutomaticMove=function(){return null},y.prototype.CurrentMoveState=function(){return this.CardSupply.WaitingForAnimation||this.IsGameWon()?p.CanMove:this.GetHintInternal().Opcode==d.Op.Noop?this.CurrentDeal>=this.TotalDeals?p.NoMovesLeft:p.CanDealNextDeck:p.CanMove},y.prototype.AllowDealNextDeck=function(){return this.CardSupply.GetPile("Stock").Empty},y.prototype.ResetNoMoreMovesState=function(){},y.prototype.TriggerTip=function(t){null!=this.OnTip&&this.OnTip(this,t)},y.prototype.OnRunAction=function(t,e,i){for(var n=0;n<t.Ops.length;n++){var r=t.Ops[n],o=r.GetPile(d.eMoveParams.SourcePile),a=r.GetPile(d.eMoveParams.DestPile);r.Opcode==d.Op.Move&&("Stock"!=o.Type&&(e?this.CardsClearedWerePeaks.pop():this.CardsClearedWerePeaks.push(this.IsPileAPeak(o))),"Tableau"==o.Type&&"Waste"==a.Type?this._currentCardsRemovedWithoutUsingStock=Math.max(0,e?this._currentCardsRemovedWithoutUsingStock-1:this._currentCardsRemovedWithoutUsingStock+1):"Stock"==o.Type&&(this._currentCardsRemovedWithoutUsingStock=0))}this.MaxCardsRemovedWithoutUsingStock=Math.max(this._currentCardsRemovedWithoutUsingStock,this.MaxCardsRemovedWithoutUsingStock)},y.prototype.OnRunSpecialAction=function(t,e){},y.prototype.OnGameOver=function(t,e){},y.prototype.GenerateDealData=function(){var t,e,i=0,n="",r=new Array(this.CardSupply.Count);for(e=this.ProcessDealDataForPile("Stock",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("Waste",r,n,i),r=e.deck,n=e.script,i=e.cardIndex,t=27;t>=0;t--)e=this.ProcessDealDataForPile("Tableau"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex,e=this.ProcessDealDataForPile("FaceDown"+t,r,n,i),r=e.deck,n=e.script,i=e.cardIndex;return n="BEGIN "+n+"END",new g(s.ConstructSeedFromDeck(r,this.CardSupply.Count).ToString(),n)},y.prototype.AddExtraDeals=function(t,e){void 0===e&&(e=!0),this.TotalDeals+=t,e&&this.CardSupply.LogAction(c.sParse(this.CardSupply,["TotalExtraDeal",t.toString()]))},y.prototype.AddWildCard=function(t){void 0===t&&(t=!0);for(var e=this.CardSupply.GetCardList(),i=0;i<e.length;i++){var n=e[i];if(n.Value==l.Values.Joker&&n.Suit==h.None){this.CardSupply.GetPile("Joker").AddNew(n),this.CardSupply.WildCardAdded();break}}t&&this.CardSupply.LogAction(c.sParse(this.CardSupply,["WildCardAdd"]))},y.prototype.ApplyCurrentOptInAdBonus=function(t){"extraDeal"==t?(this.AddExtraDeals(1),this.Deal()):"wildCard"==t&&this.AddWildCard()},y.prototype.ProcessDealDataForPile=function(e,i,n,r){var o=this.CardSupply.GetPile(e);return null==o||o.Empty||(t.forEach(o.GetCards(),function(t){i[r++]=t.Sequence}),n="MOVE Root "+e+" "+o.Count+" "+n),{deck:i,script:n,currentIndex:r}},y.prototype.ForceDealScript=function(t){this.DealScript=null!=t?t:y.DefaultDealScript},y.DefaultDealScript="BEGIN MOVE Root Stock 52 MOVE Stock FaceDown0 1 MOVE Stock FaceDown1 1 MOVE Stock FaceDown2 1 MOVE Stock FaceDown3 1 MOVE Stock FaceDown4 1 MOVE Stock FaceDown5 1 MOVE Stock FaceDown6 1 MOVE Stock FaceDown7 1 MOVE Stock FaceDown8 1 MOVE Stock FaceDown9 1 MOVE Stock FaceDown10 1 MOVE Stock FaceDown11 1 MOVE Stock FaceDown12 1 MOVE Stock FaceDown13 1 MOVE Stock FaceDown14 1 MOVE Stock FaceDown15 1 MOVE Stock FaceDown16 1 MOVE Stock FaceDown17 1 MOVE Stock Tableau18 1 MOVE Stock Tableau19 1 MOVE Stock Tableau20 1 MOVE Stock Tableau21 1 MOVE Stock Tableau22 1 MOVE Stock Tableau23 1 MOVE Stock Tableau24 1 MOVE Stock Tableau25 1 MOVE Stock Tableau26 1 MOVE Stock Tableau27 1 MOVE Stock Waste 1 END",y}),define("SolitaireShared/TriPeaksLogic/IDailyTripeaksAuthority",["SolitaireShared/TriPeaksLogic/TriPeaksAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/MoveState"],function(t,e,i,n){"use strict";var r=function(){this.initIDailyTriPeaksAuthority()};return r.TAG_MOVEPERFORMED=1073741824,r.constructor=r,r.prototype=Object.create(t.prototype),e.call(r.prototype),r.prototype.initIDailyTriPeaksAuthority=function(){t.call(this),this.MovesAllowed=0,this._startingTime=0,this.ChallengeType=e.ChallengeType.Unknown,this.DeckSeeds=[],this.IsChallenge=!0,this.TotalMoves=0,this.MaxDeals=t.MAX_DEALS},Object.defineProperty(r.prototype,"TimerEnabled",{get:function(){return 0!=this._startingTime}}),Object.defineProperty(r.prototype,"StartingTime",{get:function(){return this._startingTime},set:function(t){this._startingTime=t,this.CardSupply.IsTimerCountdown=0!=this._startingTime}}),r.prototype.GetScoreForAction=function(e){for(var n=0;n<e.Ops.length;n++){var o=e.Ops[n];this.MovesAllowed>0&&0==e.GetActionUndoCount()&&o.Opcode!=i.Op.Noop&&o.Opcode!=i.Op.Deal&&(e.Tag=(e.Tag|r.TAG_MOVEPERFORMED)>>>0)}return t.prototype.GetScoreForAction.call(this,e)},r.prototype.OnRunSpecialAction=function(e,i){this.MovesAllowed>0&&(this.TotalMoves+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},r.prototype.IsGameWon=function(){return this.MovesAllowed>0?t.prototype.IsGameWon.call(this)&&this.TotalMoves<=this.MovesAllowed+1:t.prototype.IsGameWon.call(this)},r.prototype.CurrentMoveState=function(){if(this.MovesAllowed>0){if(this.TotalMoves>this.MovesAllowed+1)return n.NoMovesLeft;if(this.TotalMoves==this.MovesAllowed+1)return this.IsGameWon()?n.CanMove:n.NoMovesLeft}return t.prototype.CurrentMoveState.call(this)},r.prototype.GetHint=function(e,n){return e=!!e,n?t.prototype.GetHint.call(this,e,n):new i(this.CardSupply)},r.prototype.SetDealScript=function(t){this.DealScript=t},r.prototype.SetNumBoardsCompleted=function(t){this.NumBoardsCompleted=t},r.prototype.GetIthDeckSeed=function(e){return this.CardSupply.IsGamePageLoaded?this.DeckSeeds.length>e?this.DeckSeeds[e]:null:t.prototype.GetIthDeckSeed.call(this,e)},r.prototype.Deal=function(){return this.CardSupply.IsGamePageLoaded?(this.TotalMoves=0,this.DeckSeeds.length>0&&(this.CardSupply.DeckSeed=this.DeckSeeds[0]),t.prototype.Deal.call(this)):t.prototype.Deal.call(this)},r.prototype.GetStartingTime=function(){return this.StartingTime},r}),define("SolitaireShared/TriPeaksLogic/ChallengeAuthorities/ClearBoardsDailyTripeaksAuthority",["SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/IClearBoardsAuthority","SolitaireShared/TriPeaksLogic/IDailyTripeaksAuthority"],function(t,e,i,n){"use strict";var r=function(t){this.initClearBoardsDailyTripeaksAuthority(t)};return r.constructor=r,r.prototype=Object.create(n.prototype),i.call(r.prototype),r.prototype.initClearBoardsDailyTripeaksAuthority=function(i){n.call(this,i),
this.SuppressBonusAnimations=!0;var r=!0;if(null!=i&&i[e.KeyBoardsToClear]&&(this.BoardsToClear=parseInt(i[e.KeyBoardsToClear]),r=isNaN(this.BoardsToClear)),r)throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=t.ChallengeType.ClearBoards},r.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(!this.CardSupply.IsWaitingForAds&&(!!this.CardSupply.IsGamePageLoaded&&(this.CheckWin()&&this.BoardsCompleted()<this.BoardsToClear&&this.Deal(),!this.CardSupply.WaitingForAnimation&&this.BoardsCompleted()>=this.BoardsToClear)))},r}),define("SolitaireShared/TriPeaksLogic/ChallengeAuthorities/AchieveScoreDailyTripeaksAuthority",["SolitaireShared/TriPeaksLogic/TriPeaksAuthority","SolitaireShared/TriPeaksLogic/IDailyTripeaksAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IAchieveScoreDailyAuthority","SolitaireShared/CardLogic/ChallengeConstants"],function(t,e,i,n,r){"use strict";var o=function(t){this.initAchieveScoreDailyTriPeaksAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),o.prototype.initAchieveScoreDailyTriPeaksAuthority=function(t){if(e.call(this),null==t||!t[r.KeyScoreRequired])throw"Invalid parameter passed in creating Daily Challenge";this.ScoreRequired=parseInt(t[r.KeyScoreRequired]),this.ChallengeType=i.ChallengeType.AchieveScore},o.prototype.IsGameWon=function(){return!this.CardSupply.WaitingForAnimation&&(!this.CardSupply.IsWaitingForAds&&(!!this.CardSupply.IsGamePageLoaded&&(this.CheckWin()&&this.CardSupply.Score<this.ScoreRequired&&this.Deal(),this.CardSupply.Score>=this.ScoreRequired)))},o}),define("SolitaireShared/TriPeaksLogic/ChallengeAuthorities/PlayCardDailyTripeaksAuthority",["SolitaireShared/TriPeaksLogic/TriPeaksAuthority","SolitaireShared/TriPeaksLogic/IDailyTripeaksAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/IPlayCardDailyAuthority","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayCardDailyTriPeaksAuthority(t)};return o.constructor=o,o.prototype=Object.create(e.prototype),n.call(o.prototype),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this.CardPlayed()?1:0}}),o.KeyCardToPlay="CARDTOPLAY",o.prototype.initPlayCardDailyTriPeaksAuthority=function(t){if(e.call(this),this.SuppressBonusAnimations=!0,null==t||!t[o.KeyCardToPlay])throw"Invalid parameter passed in creating Daily Challenge";this._cardToPlay=this.GetCardValue(t[o.KeyCardToPlay].toUpperCase()),this.ChallengeType=i.ChallengeType.PlayCard,this.GoalCompleted=!1},o.prototype.Deal=function(){return this._goalCompleted=!1,e.prototype.Deal.call(this)},o.prototype.GetScoreForAction=function(t){for(var i=!1,n=0;n<t.Ops.length;n++){var o=t.Ops[n],a=o.GetPile(r.eMoveParams.DestPile);if(o.Opcode==r.Op.Move&&"Waste"==a.Type&&!a.Empty){i=!0;break}}if(i)for(var s=this.CardSupply.GetPile("Waste").GetCards(),l=0;l<s.length;l++){var h=s[l];if(h.ToString()==this._cardToPlay){this._goalCompleted=!0;break}}return e.prototype.GetScoreForAction.call(this,t)},o.prototype.CardPlayed=function(){for(var t=0;t<4;t++){var e=this.CardSupply.GetPile("Foundation"+t);if(!e.Empty&&e.Top.ToString()==this._cardToPlay)return!0}return!1},o.prototype.IsGameWon=function(){return!this.CardSupply.IsWaitingForAds&&(!this.CardSupply.WaitingForAnimation&&this.GoalCompleted)},o.prototype.GetHint=function(t,i){if(i)return e.prototype.GetHint.call(this,t,i);var n,o=[];this.CardSupply.GetPile("Foundation");var a=[];a.push("CHALLENGE");for(var s=27;s>=0;s--)if(n=this.CardSupply.GetPile("Tableau"+s),!n.Empty&&n.Top.ToString().Equals(this._cardToPlay)){a.push(n.Top.Sequence.toString());break}if(a.Count>1){var l=new r(this.CardSupply);l.Parse(a,0),o.push(l)}return o.length>0?o[0]:new r(this.CardSupply)},o.prototype.GetCardValue=function(t){return t},o}),define("SolitaireShared/TriPeaksLogic/ChallengeAuthorities/PlayValuesDailyTripeaksAuthority",["SolitaireShared/TriPeaksLogic/IDailyTripeaksAuthority","SolitaireShared/CardLogic/IPlayValuesDailyAuthority","SolitaireShared/CardLogic/IDailyAuthority","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardValue"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPlayValuesDailyTripeaksAuthority(t)};o.Key_NumToPlay="NUMBERTOPLAY",o.Key_ValueToPlay="VALUETOPLAY";return o.constructor=o,o.prototype=Object.create(t.prototype),e.call(o.prototype),o.prototype.initPlayValuesDailyTripeaksAuthority=function(e){t.call(this,e),this._hasWon=!1,this.SuppressBonusAnimations=!0;var n=!0;if(null!=e&&e[o.Key_NumToPlay]&&e[o.Key_ValueToPlay]&&(n=!1,this.NumToPlay=parseInt(e[o.Key_NumToPlay]),this.ValueToPlay=r.getValue(e[o.Key_ValueToPlay]),this._numPlayed=0,!isNaN(this.NumToPlay)&&this.ValueToPlay||(n=!0),n))throw"Invalid parameter passed in creating Daily Challenge";this.ChallengeType=i.ChallengeType.PlayValues},Object.defineProperty(o.prototype,"Value",{get:function(){return this.ValueToPlay}}),Object.defineProperty(o.prototype,"NumberToPlay",{get:function(){return this.NumToPlay}}),Object.defineProperty(o.prototype,"NumberPlayed",{get:function(){return this._numPlayed}}),o.prototype.Deal=function(){return this.NumDealsLeft()==this.MaxDeals&&(this._numPlayed=0),t.prototype.Deal.call(this)},o.prototype.GetScoreForAction=function(e){for(var i=0;i<e.Ops.length;i++){var r=e.Ops[i],o=r.GetPile(n.eMoveParams.DestPile);if(r.Opcode==n.Op.Move&&"Waste"==o.Type&&"Stock"!=r.GetPile(n.eMoveParams.SourcePile).Type&&o.Count>r.GetNumber(n.eMoveParams.NumCards)&&o.NthFromTop(r.GetNumber(n.eMoveParams.NumCards)).Value==this.ValueToPlay){e.Tag=(65536|e.Tag)>>>0;break}}return t.prototype.GetScoreForAction.call(this,e)},o.prototype.OnRunSpecialAction=function(e,i){(65536&e)>>>0!=0&&(this._numPlayed+=i?-1:1),t.prototype.OnRunSpecialAction.call(this,e,i)},o.prototype.IsGameWon=function(){return!this.CardSupply.IsWaitingForAds&&(this.CheckWin()&&this._numPlayed<this.NumToPlay&&!this.CardSupply.WaitingForAnimation&&this.Deal(),this._numPlayed>=this.NumToPlay)},o.prototype.GetHint=function(e,i){if(i)return t.prototype.GetHint.call(this,e,i);e=!!e;for(var r,o=[],a=["CHALLENGE"],s=27;s>=0;s--)r=this.CardSupply.GetPile("Tableau"+s),r.Empty||r.Top.Value==this.ValueToPlay&&a.push(r.Top.Sequence.toString());if(a.length>1){var l=new n(this.CardSupply);l.Parse(a,0),o.push(l)}return o.length>0?o[0]:new n(this.CardSupply)},o}),define("Solitaire/DailyChallenges/TriPeaksChallenge",["lodash","absolute/stringmanager","absolute/textutils","CardUI/IChallengeDefinition","SolitaireShared/CardLogic/ChallengeConstants","SolitaireShared/CardLogic/Card","SolitaireShared/TriPeaksLogic/ChallengeAuthorities/ClearBoardsDailyTripeaksAuthority","SolitaireShared/TriPeaksLogic/ChallengeAuthorities/AchieveScoreDailyTripeaksAuthority","SolitaireShared/TriPeaksLogic/ChallengeAuthorities/PlayCardDailyTripeaksAuthority","SolitaireShared/TriPeaksLogic/ChallengeAuthorities/PlayValuesDailyTripeaksAuthority"],function(t,e,i,n,r,o,a,s,l,h){"use strict";var u=function(t,e,i){this.initTriPeaksChallenge(t,e,i)};return u.constructor=u,u.prototype=Object.create(n.prototype),u.GoalType={ClearBoards:0,AchieveScore:1,PlayCard:2,PlayValues:3},u.prototype.GoalType=u.GoalType,u.prototype.initTriPeaksChallenge=function(t,e,i){n.call(this,t,e,i)},u.prototype.ConstructAuthority=function(){var t=u.AuthorityTypes[this.ChallengeType](this.Parameters);this.SetupOptionsForAuthority(t);var e=parseInt(this.Parameters.MAXDEALS);return!isNaN(e)&&e>0&&(t.MaxDeals=e),t},u.prototype.GetGoalDescription=function(){try{var t=this.Parameters.MAXDEALS;switch(this.ChallengeType){case u.GoalType.ClearBoards:var n=this.Parameters[r.KeyBoardsToClear],a=parseInt(n),s=n;return!isNaN(a)&&a>0&&(s=a.toString()),e(this.CompleteGoalLocString("DailyChallengeGoal_ClearBoards"),[s,t,this.GetTimeFormat(this.AllowedTime)]);case u.GoalType.AchieveScore:return e(this.CompleteGoalLocString("DailyChallengeGoal_AchieveScore"),[i.formatInt(this.Parameters[r.KeyScoreRequired]),this.AllowedTime>0?this.GetTimeFormat(this.AllowedTime):t,t]);case u.GoalType.PlayValues:var l=o.GetLongValueName(this.Parameters[h.Key_ValueToPlay]),d=parseInt(this.Parameters[h.Key_NumToPlay]),c="Card_"+l;return!isNaN(d)&&d>1&&("SIX"==l.toUpperCase()?c+="es":c+="s"),l=e(c),e(this.CompleteGoalLocString("DailyChallengeGoal_ClearValuesFromBoard"),[d.toString(),l,t,this.GetTimeFormat(this.AllowedTime)]);default:return""}}catch(t){return""}},u.prototype.GetChallengeIconUrl=function(){return"Content/Icons/DailyChallenges/tripeaks.png"},u.prototype.GetModeName=function(){return"TriPeaks"},u.prototype.GetShortGoalDescription=function(){switch(this.ChallengeType){case u.GoalType.ClearBoards:return e(this.AllowedMoves>0?"Deals_Board_Challenge":this.AllowedTime>0?"Timed_Board_Challenge":"Board_Challenge");case u.GoalType.PlayCard:case u.GoalType.PlayValues:return e(this.AllowedMoves>0?"Moves_Card_Challenge":this.AllowedTime>0?"Timed_Card_Challenge":"DCTile_Card_Challenge");case u.GoalType.AchieveScore:return e(this.AllowedMoves>0?"Moves_Score_Challenge":this.AllowedTime>0?"Timed_Score_Challenge":"Score_Challenge");default:return""}},u.MakeClearBoardsAuthority=function(t){return new a(t)},u.MakeScoreAuthority=function(t){return new s(t)},u.MakePlayCardAuthority=function(t){return new l(t)},u.MakePlayValuesAuthority=function(t){return new h(t)},u.AuthorityTypes=[u.MakeClearBoardsAuthority,u.MakeScoreAuthority,u.MakePlayCardAuthority,u.MakePlayValuesAuthority],u.FromDictionary=function(e){var i=null,n=parseInt(e.Data.CHDEF_ChallengeType),r={};return t.forEach(e.Data,function(t,e){if(0==e.indexOf("PARAM_")){var i=e.substring(6);r[i]=t}}),i=new u(n,r,e),i.FromDictionaryInternal(e.Data),i},u.FirstParameters={ClearBoards:"BoardsToClear",AchieveScore:"ScoreRequired",PlayCard:"CardToPlay",PlayValues:"NumberToPlay"},u.SecondParameters={ClearBoards:null,AchieveScore:null,PlayCard:null,PlayValues:"ValueToPlay"},u.prototype.CompleteGoalLocString=function(t){var e=t,i=parseInt(this.Parameters.MAXDEALS);this.AllowedTime>0&&(e+="_Time"),!isNaN(i)&&i>0&&this.ChallengeType!=u.GoalType.AchieveScore&&(e+="_Moves");var n=0,r=this.Parameters[h.Key_NumToPlay];return n=parseInt(r),!isNaN(n)&&n>1&&(e+="_Multiple"),e},u}),define("Managers/ChallengeFactory",["Solitaire/DailyChallenges/KlondikeChallenge","Solitaire/DailyChallenges/FreeCellChallenge","Solitaire/DailyChallenges/PyramidChallenge","Solitaire/DailyChallenges/SpiderChallenge","Solitaire/DailyChallenges/TriPeaksChallenge"],function(t,e,i,n,r){"use strict";return{BuildChallengeObject:function(o){var a;if(o)switch(o.Data.GameMode){case"Klondike":a=new t.FromDictionary(o);break;case"FreeCell":a=new e.FromDictionary(o);break;case"Pyramid":a=new i.FromDictionary(o);break;case"Spider":a=new n.FromDictionary(o);break;case"TriPeaks":a=new r.FromDictionary(o);break;default:a=null}return a}}}),define("Solitaire/StarClub/SCChallengePack",["lodash","absolute/stringmanager","Managers/ChallengeManager","Managers/ChallengeFactory"],function(t,e,i,n){"use strict";var r=function(t,e,i){this.initSCChallengePack(t,e,i)};return r.GuidCache={},r.prototype.initSCChallengePack=function(e,n,o){this.config=e,this.icon=n,this.theme=o,this.Challenges=[],i.StoreChallengePack(e),t.forEach(e.PMChallenges,function(t){var e=t.ChallengeData,n=i.StoreChallenge(e);r.GuidCache[n]&&(e.Key+="_ALLOW_DUPE");var o=this.buildChallenge(e);o&&this.Challenges.push(o),r.GuidCache[n]=!0},this),i.Sync()},Object.defineProperty(r.prototype,"Name",{get:function(){var t=["Easy","Medium","Hard","Expert"];return this.config.Name+=t.some(function(t){return t===this.config.Name}.bind(this))?"Text":"",this.config.DigitNamePack?e(this.config.Name)+" "+this.config.DigitNamePack:this.config.Name}}),Object.defineProperty(r.prototype,"NumStars",{get:function(){for(var t=0,e=0;e<this.Challenges.length;e++)t+=this.Challenges[e].Difficulty;return t}}),Object.defineProperty(r.prototype,"NumStarsEarned",{get:function(){var e=0;return t.forEach(this.config.PMChallenges,function(t){var n=i.GetChallengeConfig(t.ChallengeData.Key);n&&n.Completed&&(e+=n.Difficulty)}),e}}),Object.defineProperty(r.prototype,"Unlocked",{get:function(){return 0==this.config.PriceOfUnlocking||i.IsChallengePackUnlocked(this.config.ID)},set:function(t){i.SetChallengePackUnlocked(this.config.ID,t)}}),Object.defineProperty(r.prototype,"PriceOfUnlocking",{get:function(){return this.config.PriceOfUnlocking}}),Object.defineProperty(r.prototype,"SentientId",{get:function(){return this.config.SentientId}}),Object.defineProperty(r.prototype,"ChallengesCompleted",{get:function(){return this.getPackStats().challengesCompleted}}),r.prototype.buildChallenge=function(t){var e=i.GetChallengeConfig(t.Key),r=n.BuildChallengeObject(e);return r&&(r.Theme=this.theme),r},r.prototype.getPackStats=function(){var e={totalStarsEarned:0,challengesCompleted:0,totalChallenges:0};return t.forEach(this.config.PMChallenges,function(t){var n=i.GetChallengeConfig(t.ChallengeData.Key);e.totalChallenges++,n&&n.Completed&&(e.challengesCompleted++,e.totalStarsEarned+=n.Difficulty)}),e},r}),define("Solitaire/StarClub/SCCollection",["lodash","Managers/ChallengeManager","Solitaire/StarClub/SCChallengePack"],function(t,e,i){"use strict";var n=function(t,e){this.initSCCollection(t,e)};return n.prototype.initSCCollection=function(t,i){this.config=t,this.icon=i,this.images={},e.StoreChallengePack(t)},n.prototype.setPackConfig=function(t){this.packConfig=t},n.prototype.buildPacks=function(){this.Packs=[],t.forEach(this.packConfig.PMPacks,function(t){var e=this.images[t.ImgPath];this.Packs.push(new i(t,e,this.Theme))},this),this.Packs.sort(function(t,e){return t.PriceOfUnlocking-e.PriceOfUnlocking})},n.prototype.addImage=function(t,e){this.images[t]=e},Object.defineProperty(n.prototype,"Name",{get:function(){return this.config.Name}}),Object.defineProperty(n.prototype,"FileName",{get:function(){return this.config.FileName}}),Object.defineProperty(n.prototype,"Key",{get:function(){return this.config.FileName.substring(0,this.config.FileName.indexOf(".js"))}}),Object.defineProperty(n.prototype,"CollectionGroupName",{get:function(){return this.config.CollectionGroup.CollectionGroupName}}),Object.defineProperty(n.prototype,"CollectionPriority",{get:function(){return this.config.CollectionGroup.CollectionPriority}}),Object.defineProperty(n.prototype,"ChallengePacks",{get:function(){return this.Packs||this.buildPacks(),this.Packs}}),Object.defineProperty(n.prototype,"Theme",{get:function(){return this.config.Theme}}),Object.defineProperty(n.prototype,"NumPacks",{get:function(){return this.Packs||this.buildPacks(),this.Packs.length}}),Object.defineProperty(n.prototype,"NumPacksCompleted",{get:function(){var e=0;return t.forEach(this.Packs,function(t){var i=t.getPackStats();e+=i.challengesCompleted==i.totalChallenges?1:0}),e}}),Object.defineProperty(n.prototype,"NumStars",{get:function(){this.Packs||this.buildPacks();for(var t=0,e=0;e<this.Packs.length;e++)t+=this.Packs[e].NumStars;return t}}),Object.defineProperty(n.prototype,"NumStarsEarned",{get:function(){for(var t=0,e=0;e<this.Packs.length;e++)t+=this.Packs[e].NumStarsEarned;return t}}),Object.defineProperty(n.prototype,"Unlocked",{get:function(){return 0==this.config.PriceOfUnlocking||e.IsChallengeCollectionUnlocked(this.config.ID)},set:function(t){e.SetChallengeCollectionUnlocked(this.config.ID,t)}}),Object.defineProperty(n.prototype,"PriceOfUnlocking",{get:function(){return this.config.PriceOfUnlocking}}),n.prototype.getCollectionStats=function(){var e={totalStarsEarned:0,challengesCompleted:0,totalChallenges:0,packsUnlocked:0,crownsEarned:0,complete:!1};return t.forEach(this.Packs,function(t){var i=t.getPackStats();e.totalStarsEarned+=i.totalStarsEarned,e.challengesCompleted+=i.challengesCompleted,e.totalChallenges+=i.totalChallenges,e.packsUnlocked+=t.PriceOfUnlocking>0&&t.Unlocked?1:0,e.crownsEarned+=i.challengesCompleted==i.totalChallenges?1:0}),e.complete=this.NumPacks==this.NumPacksCompleted,e},n}),define("Managers/StatManager",["absolute/storagemanager"],function(t){"use strict";return{_stats:null,_key:"STATS",Init:function(){this._stats||(this._stats||(this._stats=t.fetch(this._key)),this._stats||(this._stats={}))},ValueExists:function(t){return this.Init(),void 0!=this._stats[t]},GetValue:function(t){return this.Init(),this._stats[t]||0},SetStatistic:function(t,e,i){this._stats[t]=e},Save:function(){t.store(this._key,this._stats)}}}),define("Solitaire/MvvmStructure/Service/SolitaireStarClubService",["lodash","pixi","jszip","jsziputils","absolute/debug","absolute/storagemanager","absolute/asyncqueue","Solitaire/StarClub/SCCollectionGroup","Solitaire/StarClub/SCCollection","Solitaire/MvvmStructure/Service/ManifestService","Managers/StatManager"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d={_worldsCache:null,_worldsKey:"StarClubWorlds",_isValid:!0,currentPack:null,currentCollection:null,Initialize:function(t,e){this.GetStarClubCollections(t,e)},IsValid:function(){return h.IsValid()},LoadJSON:function(t,i,n){function r(t){o.removeEventListener("loaded",r),o.removeEventListener("error",n),i(o.json)}function n(t){o.removeEventListener("loaded",r),o.removeEventListener("error",n),n(o.json)}var o=new e.JsonLoader(t,!0);o.addEventListener("loaded",r),o.addEventListener("error",n),o.load()},LoadStarClubCollectionsFromCDN:function(e,r){var o=h.GetSettings("StarClub","Worlds");if(!o)return void r();var a=o.Path;n.getBinaryContent(a,function(n,o){if(n)return void r(n);try{i.loadAsync(o).then(function(i){i.file("Worlds/Worlds.js").async("string").then(function(n){var a=JSON.parse(n),l=a.PMWorldsListList.concat(a.PacksV2),h={};l.filter(function(t){return void 0!==t&&null!==t&&"classic"===t.Theme&&"Classic"!==t.Name}).forEach(function(t){}),t.forEach(a.CollectionGroupPriorityTable,function(t){h[t.CollectionGroupName]=new s(t.CollectionGroupName,t.CollectionGroupPriority)},this),this.LoadAllCollectionIcons(i,l,h,function(i){h=i,this.collectionGroups=[],t.forEach(h,function(t){t.sort(),this.collectionGroups.push(t)},this),this.collectionGroups=[],t.forEach(h,function(t){t.sort(),this.collectionGroups.push(t)},this),this.collectionGroups.sort(function(t,e){return e.Priority-t.Priority}),this.LoadCollectionPacks(function(){e(o)}.bind(this),r)}.bind(this),function(t){r(t)}.bind(this))}.bind(this))}.bind(this))}catch(t){r(t)}}.bind(this))},LoadAllCollectionIcons:function(i,n,r,o,a){var s=0;t.forEach(n,function(t){try{i.file("Worlds/"+t.ImgPath).async("base64").then(function(i){var n="data:image/png;base64,"+i,o=e.Texture.fromImage(n,!1,e.scaleModes.LINEAR),a=new l(t,o);r[a.CollectionGroupName]&&r[a.CollectionGroupName].addCollection(a)}).then(function(){++s==n.length&&o(r)}).catch(function(t){console.error("Error in catch for decoding images"),console.error(t)})}catch(e){s++,console.error("Error while decoding file: Worlds/"+t.ImgPath+" from zip, proceeding anyways and pack will not display."),console.error(e),a(e)}})},LoadCollectionPacks:function(e,i){var n=new a;t.forEach(this.collectionGroups,function(e){t.forEach(e.Collections,function(t){n.pushTask(function(e,i){this.LoadPacksToCollection(t,e,i)}.bind(this))},this)},this),n.run(function(t){r.log("Load packs progress "+Math.round(100*t))},function(){e()})},LoadPacksToCollection:function(t,e,r){var o=t.Key;if(o){var a=h.GetSettings("StarClub",o);if(!a)return void console.error("StarClub settings not found in Manifest");var s=a.Path;if(!s)return void console.error("Path not found in Star Club settings in Manifest");n.getBinaryContent(s,function(e,n){if(e)return void console.error("Error retrieving zip from URL");i.loadAsync(n).then(function(e){this.ApplyCollectionProperties(e,t,function(e){t=e,t.buildPacks(),r()}.bind(this),function(t){console.error(t)})}.bind(this)).catch(function(t){console.error("Error loading received zip as folder"),console.error(t)}.bind(this))}.bind(this))}},ApplyCollectionProperties:function(i,n,r,o){var a=t.size(i.files),s=0;t.forEach(i.files,function(t){try{-1!=t.name.indexOf(".js")?i.file(t.name).async("string").then(function(t){var e=JSON.parse(t);n.setPackConfig(e)}).then(function(){++s===a&&r(n)}):-1!=t.name.indexOf(".png")?i.file(t.name).async("base64").then(function(i){var r="data:image/png;base64,"+i,o=e.Texture.fromImage(r,!1,e.scaleModes.LINEAR);n.addImage(t.name.substring(n.Key.length+1),o)}).then(function(){++s===a&&r(n)}):-1!==t.name.indexOf("/",t.name.length-"/".length)&&s++}catch(e){console.error("Error while decoding file: "+t.name),o(e)}})},GetStarClubCollections:function(t,e){this.LoadStarClubCollectionsFromCDN(function(e){o.store(this._worldsKey,e),this._worldsCache=e,t(e)}.bind(this),function(t){this._isValid=!1,e(t)}.bind(this))},GetStarClubGlobalStats:function(){var e={totalStarsEarned:0,challengesCompleted:0,totalChallenges:0,packsUnlocked:0,collectionsUnlocked:0,crownsEarned:0,collectionsCompleted:0,collectionsTotal:0};return t.forEach(this.CollectionGroups,function(t){var i=t.getCollectionGroupStats();e.totalStarsEarned+=i.totalStarsEarned,e.challengesCompleted+=i.challengesCompleted,e.totalChallenges+=i.totalChallenges,e.packsUnlocked+=i.packsUnlocked,e.collectionsUnlocked+=i.collectionsUnlocked,e.crownsEarned+=i.crownsEarned,e.collectionsCompleted+=i.collectionsCompleted,e.collectionsTotal+=i.collectionsTotal},this),e},UpdateGlobalStarClubStats:function(){if(this._worldsCache){var t=this.GetStarClubGlobalStats();u.SetStatistic("SCGlobalStarsEarned",t.totalStarsEarned),u.SetStatistic("SCGlobalChallengesCompleted",t.challengesCompleted),u.SetStatistic("SCGlobalPacksUnlocked",t.packsUnlocked),u.SetStatistic("SCGlobalCollectionsUnlocked",t.collectionsUnlocked),u.SetStatistic("SCGlobalCrownsEarned",t.crownsEarned),u.SetStatistic("SCGlobalTotalChallenges",t.totalChallenges),u.SetStatistic("SCGlobalTotalCollections",t.collectionsTotal),u.SetStatistic("SCGlobalTotalCollectionsCompleted",t.collectionsCompleted),u.Save()}}};return Object.defineProperty(d,"CollectionGroups",{get:function(){return this.collectionGroups}}),d}),define("MenuUI/GameEndDialog",["pixi","absolute","absolute/stringmanager","absolute/assetmap","MenuUI/MsftButton","lodash","MenuUI/BoostDialog","Solitaire/SolitaireGameMode","absolute/multipagelist","MenuUI/ControlFocusManager","Solitaire/SolitaireGameMode","Managers/AdManager","Managers/TelemetryManager","Managers/ScaleManager","Solitaire/MvvmStructure/Service/SolitaireStarClubService","Arkadium/GameEngine/Core/EngineManagers"],function(t,e,i,n,r,o,a,s,l,h,s,u,d,c,p,g){var f=function(t,e,i){this.initGameEndDialog(t,e,i)};return f.prototype=Object.create(e.Dialog.prototype),f.prototype.initGameEndDialog=function(i,r,a){this.ui=i,this.game=r,this.options=a,this.options.width=e.Coords.x(1632),this.options.height=e.Coords.y(831),this.options.content=this.initContent(),this.options.displayCloseButton=!1,this.options.backgroundAlpha=.7,this.sectionSelected=!1,this.isLoss=this.options.dialog.indexOf("GameOver")>-1,this.statScroll=new e.ScrollArea(e.Coords.x(631),e.Coords.x(440),{x:!0},new t.Texture.fromFrame("game_end/scrollbar_button_idle.png"),function(){}),this.controlFocusManager=new h,this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),this.buttonLetterStyle={font:"Bold "+50*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},this.threeSliceOrange={multistate:!0,images:{left:n("buttonThreeSliceOrange.left"),center:n("buttonThreeSliceOrange.center"),right:n("buttonThreeSliceOrange.right")}},this.threeSliceBlue={multistate:!0,images:{left:n("buttonThreeSliceBlue.left"),center:n("buttonThreeSliceBlue.center"),right:n("buttonThreeSliceBlue.right")}},e.Dialog.call(this,i,this.options),this.options.tween.type="tweenIn",this.options.challenge?(this.buildChallengeButtons(),this.fireWorkLayer=new t.DisplayObjectContainer,this.fireWorkClips=[],this.addChild(this.fireWorkLayer),o.times(7,function(){var t=e.SpriteUtils.loadMovieClip("game_end/fireworks/Fireworks3_",81,1);t.scale.x=t.scale.y=4,t.anchor.x=t.anchor.y=.5,t.animationSpeed=.5,t.loop=!1,t.x=Math.max(.2*this.options.width,Math.random()*this.options.width*.8),t.y=Math.max(.2*this.options.height,Math.random()*this.options.height*.8),t.visible=!1,this.fireWorkClips.push(t),this.fireWorkLayer.addChild(t)},this)):this.buildButtons(),this.initForceScaleSprite(),c.addElement(this,{scaleChangeSource:"Full"})},f.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(70),this.forceOffsetY=e.Coords.y(70),this.forceScaleSprite.width=e.Coords.x(1720),this.forceScaleSprite.height=e.Coords.y(960),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},f.prototype.handleResize=function(){this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/c.width,a=e.Coords.y(1080)/c.height,s=c.width,l=c.height;this.width=n*o,this.height=r*a;var h=this.width/o,u=this.height/a,d=n,p=r,f=!1;if(h>s){this.width=e.Coords.x(1920);var y=s/d;if(this.height=r*a*y,this.height/a>l){this.height=e.Coords.y(1080);var y=l/p;this.width=n*o*y}f=!0}if(!f&&u>l){this.height=e.Coords.y(1080);var y=l/p;if(this.width=n*o*y,this.width/o>s){this.width=e.Coords.x(1920);var y=s/d;this.height=r*a*y}}this.x=.5*g.Display.Width-this.width/2+this.forceOffsetX,this.y=.5*g.Display.Height-this.height/2+this.forceOffsetY},f.prototype.initContent=function(){return this.contentContainer=e.UIBuilder.buildLayout(this.options.dialog,this,this,this.options.width,this.options.height),this.contentContainer},f.prototype.newGameButtonAction=function(){},f.prototype.cleanUp=function(){window.removeEventListener("click",this.clickHandler),e.SpriteUtils.destroyAllChildren(this),c.removeElement(this),this.destroy(!0)},f.prototype.open=function(){e.Dialog.prototype.open.call(this),"ChallengeWinDialog"===this.options.dialog?window.setTimeout(function(){o.each(this.fireWorkClips,function(t,i){window.setTimeout(function(){e.AudioManager.playSound("firework"+(Math.round(3*Math.random())+1).toString()),t.visible=!0,t.gotoAndPlay(0)},100*i)})}.bind(this),300):this.options.dialog.indexOf("GameOver")>-1&&e.AudioManager.playSound("gameOver");var t=-1===this.options.dialog.indexOf("GameOver"),i=this.options.challenge?this.options.challenge.GetModeName():"",n=Math.floor(this.game.solitaire.Authority.CardSupply.PreciseTimePlayed),r=t?"Win":"Fail";if(this.options.challenge){var a=this.options.challenge.config.Difficulty;if(this.options.challenge.IsStarClub){var s=p.currentCollection.Name,l=p.currentPack.Name;d.starClubComplete(r,n,i,a,s,l)}else{var h=this.options.challenge.config.Date.substring(6,19),u=new Date(parseInt(h)),c=u.getMonth()+1+"/"+u.getDate()+"/"+u.getFullYear();d.challengeComplete(r,i,n,c,a)}}else t&&d.classicGameComplete(r,this.game.solitaire.Authority.CardSupply.GameName,n,this.game.solitaire.ScoringOption,this.game.solitaire.DrawOption,this.game.solitaire.SuitsOption)},f.prototype.updateStats=function(n){this.model=n;var r={font:50*e.ScreenMetrics.getResScale()+"px Segoe UI",fill:"#000001",fontFamily:"segoe",tint:1,align:"left",wordWrap:!0,wordWrapWidth:e.Coords.x(392)};if(this.options.challenge){var a={font:50*e.ScreenMetrics.getResScale()+"px Segoe UI",fill:"#ea3517",fontFamily:"segoe",tint:15349015,align:"left"},s=new t.Text(e.StringManager("stats.goal"),a),h=new t.Text(this.options.challenge.GetGoalDescription(),r),u=new t.Text(e.StringManager("stats.yourScore"),a),d=new t.Text(this.game.solitaire.Authority.CardSupply.Score.toString()+"\n ",r),c=new t.Graphics,p=new t.Graphics,g=new t.DisplayObjectContainer;g.x=e.Coords.x(459),g.y=e.Coords.y(190),u.x=s.x=e.Coords.x(35),u.y=s.y=e.Coords.y(17),d.updateText(),d=new t.Sprite(d.generateTexture()),d.anchor.x=1,d.x=e.Coords.x(561),d.y=e.Coords.y(17),c.beginFill(16777215,1),c.drawRect(0,0,e.Coords.x(631),h.height+e.Coords.y(40)),c.endFill(),h.updateText(),h.x=c.width-h.width-e.Coords.x(72),h.y=e.Coords.y(17),c.addChild(h),c.addChild(s),p.beginFill(16777215,1),p.drawRect(0,0,e.Coords.x(631),e.Coords.y(72)),p.endFill(),p.y=c.height+e.Coords.y(8),p.addChild(u),p.addChild(d),g.addChild(c),g.addChild(p),this.addChild(g),this.addChild(this.fireWorkLayer)}else{var f=[];o.forEach(n,function(t,e){"LosingStreak"!==e&&f.push({title:i("stats.item."+e),value:t})});var y=0,m=new t.DisplayObjectContainer,C=[];this.statScroll.x=e.Coords.x(459),this.statScroll.y=e.Coords.y(190),o.each(f,function(i){var n=new t.Graphics,o=new t.Text(i.title,r),a=new t.Text(i.value,r),s=e.Coords.x(8),l=o.height+e.Coords.y(29);n.beginFill(16777215,1),n.drawRect(0,0,e.Coords.x(631),l),n.endFill(),n.x=0,n.y=0+y*(l+s),o.x=e.Coords.x(35),o.y=e.Coords.y(12),a.x=e.Coords.x(460),a.y=e.Coords.y(12),n.addChild(o),n.addChild(a),C.push(n),m.addChild(n),y++},this);var S=e.Coords.y(440),b=e.Coords.y(631),v={direction:"vertical",pageWidth:b,pageHeight:e.Coords.y(400),itemWidth:b,itemHeight:e.Coords.y(72),maskRect:{x:e.Coords.x(0),y:e.Coords.y(0),width:b,height:S},gap:e.Coords.x(6)},w=new t.Texture.fromFrame("btn_arrow_ring.png"),x=new t.Graphics;this.upArrowButton=new t.Sprite(w),this.downArrowButton=new t.Sprite(w),x.beginFill(0,.5),x.drawRect(0,0,b,S),x.endFill(),this.upArrowButton.scale.x=this.upArrowButton.scale.y=this.downArrowButton.scale.x=this.downArrowButton.scale.y=.5,this.upArrowButton.anchor.x=this.upArrowButton.anchor.y=this.downArrowButton.anchor.x=this.downArrowButton.anchor.y=.5,this.upArrowButton.rotation=1.57079633,this.downArrowButton.rotation=4.71238898,this.downArrowButton.setActive=this.upArrowButton.setActive=function(t,e){e.alpha=t?1:.2,e.interactive=t,e.buttonMode=t},e.SpriteUtils.bindInteraction(this.upArrowButton,function(){this.multiPageList.scrollDown()}.bind(this)),e.SpriteUtils.bindInteraction(this.downArrowButton,function(){this.multiPageList.scrollUp()}.bind(this)),this.multiPageList=new l(this.ui,C,this.upArrowButton,this.downArrowButton,v),this.multiPageList.setLayout(v),this.multiPageList.reset(),this.multiPageList.x=e.Coords.x(459),this.multiPageList.y=e.Coords.y(190),this.multiPageList.addChildAt(x,0),this.controlFocusManager.addControl(this.multiPageList,!0,"Statistics"),this.upArrowButton.x=this.multiPageList.x+this.multiPageList.width/2,this.upArrowButton.y=this.multiPageList.y-e.Coords.y(15),this.downArrowButton.x=this.multiPageList.x+this.multiPageList.width/2,this.downArrowButton.y=this.multiPageList.y+S+e.Coords.y(15),this.upArrowButton.visible=this.downArrowButton.visible=this.multiPageList.pages.length>1,this.addChild(this.multiPageList),this.addChild(this.upArrowButton),this.addChild(this.downArrowButton),this.addChild(this.buttonContainer),this.multiPageList.initHoverLayer()}},f.prototype.buildChallengeButtons=function(){var t;t=this.isLoss?[{text:i("buttons.tryAgain"),threeSlice:this.threeSliceOrange,width:180,height:72,maxWidth:e.Coords.x(160),position:{x:459,y:686},action:function(){var t=this.game.solitaire.ActiveMode.Name,e=this.game.solitaire.CurrentChallenge;this.game.solitaire.StopGame(!1),this.game.startGame(t,e),this.close()}.bind(this)},{text:i("buttons.homeButton"),threeSlice:this.threeSliceBlue,maxWidth:e.Coords.x(100),width:126,height:72,position:{x:658,y:686},action:function(){this.game.onNavMain(),this.close()}.bind(this)},{text:i("buttons.undoLastMove"),maxWidth:e.Coords.x(280),threeSlice:this.threeSliceOrange,width:300,height:72,position:{x:804,y:686},action:function(){this.game.solitaire.Undo(),this.ui.unBlockClicks(),this.close()}.bind(this)}]:[{text:i("buttons.collectReward"),threeSlice:this.threeSliceOrange,width:270,height:72,maxWidth:e.Coords.x(250),position:{x:640,y:686},action:function(){e.AudioManager.stopAll(),e.AudioManager.playSound("button"),this.game.navBack(),this.close()}.bind(this)}],this.addButtons(t)},f.prototype.buildButtons=function(){var t=[{text:i("buttons.newGameButton"),threeSlice:this.threeSliceOrange,width:196,
height:72,maxWidth:e.Coords.x(180),position:{x:557,y:686},action:function(){if(this.model.LosingStreak>=5&&(this.game.solitaire.ActiveMode.Name===s.Pyramid||this.game.solitaire.ActiveMode.Name===s.TriPeaks)){var t=new a(this.ui.currentScreen,"dialogs.boostHeadline","dialogs.boostContent",function(e){"no"!==e?(this.ui.blockClicks(),u.tryShowAd(function(){this.game.boostType=e,this.game.solitaire.Authority.ApplyCurrentOptInAdBonus(e),this.ui.unBlockClicks()}.bind(this),!0,!0)):(this.game.solitaire.DeleteSavedGame(),this.game.boostType="no",this.game.solitaire.DealNewGame()),t.close()}.bind(this));this.close()}else this.game.solitaire.DeleteSavedGame(),this.game.boostType="no",this.game.solitaire.DealNewGame(),this.close()}.bind(this)},{text:i("buttons.homeButton"),threeSlice:this.threeSliceBlue,width:196,height:72,maxWidth:e.Coords.x(180),position:{x:796,y:686},action:function(){this.game.solitaire.DeleteSavedGame(),this.game.navMain(),this.close()}.bind(this)}];this.game.config.singleGame.enabled&&!this.isLoss&&(t.pop(),t[0].position.x+=120),this.isLoss&&this.game.solitaire.ActiveMode.Name!==s.TriPeaks&&this.game.solitaire.ActiveMode.Name!==s.Pyramid&&(t[0].position.x=459,t[1].position.x=678,t.push({text:i("buttons.tryAgain"),threeSlice:this.threeSliceBlue,maxWidth:e.Coords.x(180),width:196,height:72,position:{x:894,y:686},action:function(){this.game.solitaire.DeleteSavedGame(),this.game.solitaire.DealNewGame(this.game.solitaire.Authority.CardSupply.DeckSeed),this.close()}.bind(this)}),this.game.config.singleGame.enabled&&t.splice(1,1)),this.game.config.singleGame.enabled&&this.isLoss&&(t[0].position.x=555,t[1].position.x=800),this.addButtons(t)},f.prototype.addButtons=function(i){this.buttonContainer=new t.DisplayObjectContainer,o.each(i,function(t){var t,i=o.extend(t,{letterStyle:this.buttonLetterStyle});i.width=e.Coords.x(i.width),i.height=e.Coords.x(i.height),t=new r(i),t.x=e.Coords.x(i.position.x),t.y=e.Coords.x(i.position.y),this.buttonContainer.addChild(t),this.controlFocusManager.addControl(t,!1,"Buttons")},this),this.addChild(this.buttonContainer)},f.prototype._createBackground=function(){var i=new t.Texture.fromFrame("game_end/gameEnd_background_symbols.png"),n=t.Sprite.fromFrame("game_end/gameEnd_background_gradient.png"),r=t.Sprite.fromFrame("game_end/gameEnd_redstrip_center.png"),o=t.Sprite.fromFrame("game_end/gameEnd_redstrip_tip.png"),a=t.Sprite.fromFrame("game_end/gameEnd_cards.png"),s=new t.Graphics,l=t.Sprite.fromFrame("game_end/gameEnd_strip.png"),h=t.Sprite.fromFrame("game_end/ads_casualgames.png");this.backgroundTile=new t.TilingSprite(i,this.options.width,this.options.height),n.width=this.options.width,n.height=this.options.height,r.y=e.Coords.y(77),o.x=r.width,r.addChild(o),a.x=-e.Coords.x(47),a.y=e.Coords.y(190),s.beginFill(0,.7),s.drawRect(0,0,e.Coords.x(426),e.Coords.y(576)),s.endFill(),s.x=e.Coords.x(1143),s.y=e.Coords.y(190),l.y=e.Coords.y(496),h.x=(s.width-h.width)/2,h.y=(l.y-h.height)/2,s.addChild(l),s.addChild(h),this.addChildAt(s,0),this.addChildAt(a,0),this.addChildAt(r,0),this.addChildAt(n,0),this.addChildAt(this.backgroundTile,0)},f.prototype.handleCommand=function(t){switch(this.selectSection(t),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":if(!this.sectionSelected)return;this.upArrowButton&&this.upArrowButton.visible&&this.multiPageList.focus?this.multiPageList.scrollDown():this.controlFocusManager.focusNextControl(-1);break;case"Down":if(!this.sectionSelected)return;this.downArrowButton&&this.downArrowButton.visible&&this.multiPageList.focus?this.multiPageList.scrollUp():this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},f.prototype.selectSection=function(t){if("Tab"===t||"ShiftTab"===t)switch(this.sectionSelected=!0,"Tab"===t?this.upArrowButton&&this.downArrowButton&&this.upArrowButton.visible&&this.downArrowButton.visible?this.handlePageChange(this.page,0!==this.page||this.page?0:1):(this.page=1,this.handlePageChange(this.page,1)):"ShiftTab"===t&&(this.upArrowButton&&this.downArrowButton&&this.upArrowButton.visible&&this.downArrowButton.visible?this.handlePageChange(this.page,this.page?0:1):(this.page=1,this.handlePageChange(this.page,1))),this.controlFocusManager.currentFocusGroup){case"Statistics":this.page=0;break;case"Buttons":this.page=1}},f.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("Statistics");break;case 1:this.controlFocusManager.setFocusGroup("Buttons")}},f.prototype.handleGameInput=function(){this.resetControlManager()},f.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl(),this.sectionSelected=!1},f}),define("MenuUI/DealWarningModal",["pixi","absolute","MenuUI/MsftModal","lodash","Arkadium/GameEngine/Core/EngineManagers","util/NineSliceButton","util/eventhandler","Managers/ScaleManager","util/CustomWordWrapper","MenuUI/ControlFocusManager"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t,e,i,n,r,o){this.initDealWarningModal(t,e,i,n,r,o)};return u.prototype=Object.create(t.DisplayObjectContainer.prototype),u.prototype.initDealWarningModal=function(i,n,r,a,l,u){t.DisplayObjectContainer.call(this),this.layoutType="large",this.parentToAdd=i,this.buildOverlay(),this.parentToAdd.addChild(this),this.popupContainer=new t.DisplayObjectContainer;var d,c,p,g,f,y=e.Coords.x(820),m=e.Coords.y(350),C=new t.Sprite.fromFrame("warning_dialogues/_cmn_backgroundTile.png");c=new t.Sprite.fromFrame("warning_dialogues/_cmn_UI2_bg_vignette.png"),c.width=y,c.height=m,c.alpha=.6,d=new t.Graphics,d.beginFill(16645887),d.lineStyle(5,16645887),d.drawRect(0,0,y,m),p=new t.Sprite.fromFrame("warning_dialogues/_cmn_popup_image_alert.png"),p.position.set(e.Coords.x(30),e.Coords.y(30)),p.width=e.Coords.x(135),p.height=e.Coords.y(160),this.icon=p,this.titleFontSize=43;var S={font:e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"};g=new t.Text(e.StringManager(n),S),g.position.set(e.Coords.x(195),e.Coords.y(20)),this.title=g,this.bodyFontSize=28;var b={font:e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",wordWrap:!0,wordWrapWidth:e.Coords.x(600)};f=new t.Text(e.StringManager(r),b),f.position.set(e.Coords.x(195),e.Coords.y(100)),this.body=f;var v={font:29*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(0),y:e.Coords.y(3)};this.playButton=new o("warning_dialogues/popup_button_Play_click.png","warning_dialogues/popup_button_Play_over.png","warning_dialogues/popup_button_Play.png",e.Coords.x(335),e.Coords.y(100),25,25,25,25,e.StringManager("buttons.ok"),v),this.playButton.onClick.add(a);var w=u?e.StringManager(u):e.StringManager("buttons.cancel");this.closeButton=new o("warning_dialogues/popup_button_Cancel_click.png","warning_dialogues/popup_button_Cancel_over.png","warning_dialogues/popup_button_Cancel.png",e.Coords.x(335),e.Coords.y(100),25,25,25,25,w,v),this.closeButton.onClick.add(l),this.popupContainer.addChild(d),this.popupContainer.addChild(C),this.popupContainer.addChild(c),this.popupContainer.addChild(p),this.popupContainer.addChild(g),this.popupContainer.addChild(f),this.popupContainer.addChild(this.playButton),this.popupContainer.addChild(this.closeButton),this.addChild(this.popupContainer),this.popupContainer.visible=!0,this.playButton.anchor.set(.5,.5),this.closeButton.anchor.set(.5,.5),this.playButton.position.set(y/2-this.playButton.width/2,e.Coords.y(280)),this.closeButton.position.set(y/2+this.closeButton.width/2,e.Coords.y(280)),this.initForceScaleSprite(),s.addElement(this,{scaleChangeSource:"Full"}),this.controlFocusManager=new h,this.controlFocusManager.addControl(this.playButton,!0,null,0),this.controlFocusManager.addControl(this.closeButton,!0,null,1),this.controlFocusManager.unfocusCurrentControl(),this.controlFocusManager.focusCurrentControl()},u.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(20),this.forceOffsetY=e.Coords.y(20),this.forceScaleSprite.width=e.Coords.x(835),this.forceScaleSprite.height=e.Coords.y(365),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},u.prototype.handleResize=function(){s.scaleFactorX<=.35?this.changeToSmallLayout("small"):this.changeToLargeLayout("large"),this.updateBodyTextCustomWrap(),this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/s.width,a=e.Coords.y(1080)/s.height,l=s.width,h=s.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>l){this.width=e.Coords.x(1920);var f=l/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>l){this.width=e.Coords.x(1920);var f=l/c;this.height=r*a*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY},u.prototype.changeToSmallLayout=function(t){this.layoutType!==t&&(this.icon.visible=!1,this.title.position.set(this.icon.x,this.icon.y),this.title.style.font=e.ScreenMetrics.getResScale()*(this.titleFontSize+7)+"px Segoe UI",this.title.updateText(),this.body.x=this.icon.x,this.body.style.font=e.ScreenMetrics.getResScale()*(this.bodyFontSize+7)+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(750),this.body.updateText(),this.layoutType=t)},u.prototype.changeToLargeLayout=function(t){this.layoutType!==t&&(this.icon.visible=!0,this.title.position.set(e.Coords.x(195),e.Coords.y(20)),this.title.style.font=e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",this.title.updateText(),this.body.position.set(e.Coords.x(195),e.Coords.y(100)),this.body.style.font=e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(600),this.body.updateText(),this.layoutType=t)},u.prototype.buildOverlay=function(){this.screenOverlay=new t.Graphics,this.screenOverlay.beginFill(0),this.screenOverlay.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.screenOverlay.alpha=.8,this.screenOverlay.interactive=!0,this.bindScreenOverlayInteractions(),this.parentToAdd.addChild(this.screenOverlay)},u.prototype.bindScreenOverlayInteractions=function(){this.screenOverlay.mouseover=function(t){},this.screenOverlay.mouseout=function(t){},this.screenOverlay.mousedown=function(t){},this.screenOverlay.mouseup=function(t){},this.screenOverlay.touchstart=function(t){},this.screenOverlay.touchend=function(t){},this.screenOverlay.touchendoutside=function(t){}},u.prototype.updateBodyTextCustomWrap=function(){var t=e.Coords.x("small"===this.layoutType?750:600);l.doTextCustomWrap(this.body,this.bodyFontSize*e.ScreenMetrics.getResScale(),"",t,e.Coords.y(100))},u.prototype.close=function(){this.parent&&this.parent.game&&this.parent.game.gameScreenUI&&(this.parent.game.gameScreenUI.warning=null),this.parentToAdd.removeChild(this.screenOverlay),this.parentToAdd.removeChild(this),s.removeElement(this)},u.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},u}),define("Solitaire/GameState",["util/eventhandler","Solitaire/ChallengeMode","Solitaire/GameResult","SolitaireShared/CardLogic/IGameAuthority","SolitaireShared/KlondikeLogic/IDailyKlondikeAuthority","Managers/TelemetryManager","MenuUI/GameEndDialog","MenuUI/DealWarningModal","absolute"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e,i,n){this.initGameState(t,e,i,n)};return h.prototype.initGameState=function(e,i,n,r){this.OnEnter=new t,this.OnUpdate=new t,this.OnLeave=new t,this._name=e,this.OnEnter.add(i),this.OnUpdate.add(n),this.OnLeave.add(r)},h.prototype.ToString=function(){return"GameState:"+this._name},h.ShowGameEndDialog=function(t,e){var i=null;h.CurrentGame.Authority.IsChallenge?(i=new a(h.CurrentGame.Parent.ui,h.CurrentGame.Parent.game,{challenge:h.CurrentGame.CurrentChallenge,dialog:t?"ChallengeWinDialog":"ChallengeGameOverDialog"}),i.updateStats()):(i=new a(h.CurrentGame.Parent.ui,h.CurrentGame.Parent.game,{challenge:h.CurrentGame.CurrentChallenge,dialog:t?"WinDialog":"GameOverDialog"}),i.updateStats(e)),i.open()},h.CurrentGame=null,h._current=null,Object.defineProperty(h,"Current",{get:function(){return this._current},set:function(t){this._current!=t&&(null!=this._current&&null!=this._current.OnLeave&&this._current.OnLeave.handleEvent(),this._current=t,null!=this._current&&null!=this._current.OnEnter&&this._current.OnEnter.handleEvent())}}),h.UpdateCurrent=function(){null!=h.Current&&null!=h.Current.OnUpdate&&h.Current.OnUpdate.handleEvent()},h.BeforeGame=new h("BeforeGame",null,function(){h.CurrentGame.Authority.CardSupply.HasMovedCards&&(h.Current=h.InProgress,h.CurrentGame.CurrentChallengeMode,e.DailyChallenge)},null),h.InProgress=new h("InProgress",function(){h.CurrentGame.Authority.IsChallenge&&(h.CurrentGame.CurrentChallenge.Played=!0)},function(){h.CurrentGame.Authority.IsChallenge&&h.CurrentGame.Authority instanceof r&&(h.CurrentGame.Authority.GetCurrentMoveState()==n.MoveState.NoMovesLeft||h.CurrentGame.Authority),h.CurrentGame.Authority.IsGameWon()?(h.CurrentGame.GameResult=i.Win,h.CurrentGame.Authority.OnGameOver(h.CurrentGame.SupplyView.CardSupply.GetActionList(),h.CurrentGame.SupplyView.CardSupply.GetCollapsedActionList()),h.Current=h.GameComplete,setTimeout(function(){h.CurrentGame.Authority.IsChallenge||h.CurrentGame.DeleteSavedGame()},0)):h.CurrentGame.Authority.CurrentMoveState()==n.MoveState.NoMovesLeft&&h.CurrentGame.Authority.CardSupply.EnforceGameRules&&(h.CurrentGame.Authority.IsChallenge||!h.CurrentGame.Authority.IsChallenge&&!h.CurrentGame.Authority.CardSupply.WaitingForAnimation)&&(h.CurrentGame.GameResult=i.NoMoreMoves,h.Current=h.GameComplete)},null),h.GameComplete=new h("GameComplete",function(){var t={};if(h.CurrentGame.Authority.IsChallenge||h.CurrentGame.ActiveMode.UpdateStatistics(t),h.CurrentGame.GameResult==i.Win)h.CurrentGame.SupplyView.ClearKeyboardHighlight(),h.CurrentGame.SupplyView.NextWinAnimation=h.CurrentGame.NextWinAnimation,h.CurrentGame.OnOfGameEndAnimations?h.CurrentGame.Authority.CardSupply.CardAnimator.TriggerWinAnimation(function(){h.Current==h.GameComplete&&(h.Current=h.AfterGame,h.WriteSolvableDeckLog()),h.CurrentGame.NextWinAnimation=h.CurrentGame.SupplyView.NextWinAnimation+1,h.CurrentGame.SaveSettings(),h.ShowGameEndDialog(!0,t)}):(h.Current==h.GameComplete&&(h.Current=h.AfterGame,h.WriteSolvableDeckLog()),h.CurrentGame.NextWinAnimation=h.CurrentGame.SupplyView.NextWinAnimation+1,h.CurrentGame.SaveSettings(),h.ShowGameEndDialog(!0,t));else if(h.CurrentGame.GameResult===i.NoMoreMoves){if(h.CurrentGame.Authority.IsChallenge)h.ShowGameEndDialog(!1,t),h.CurrentGame.SaveSettings();else var e=new s(h.CurrentGame.Parent.ui.currentScreen,"dialogs.noMoreMovesHeadline","dialogs.noMoreMovesContent",function(){o.classicGameComplete("NoMoreMoves",h.CurrentGame.Authority.CardSupply.GameName,Math.floor(h.CurrentGame.Authority.CardSupply.PreciseTimePlayed),h.CurrentGame.ScoringOption,h.CurrentGame.DrawOption,h.CurrentGame.SuitsOption),e.close(),h.ShowGameEndDialog(!1,t),h.CurrentGame.SaveSettings()}.bind(this),function(){h.CurrentGame.Parent.game.solitaire.Undo(),e.close()},"buttons.undoLastMove");h.CurrentGame.Parent.game.gameScreenUI.htp&&h.CurrentGame.Parent.game.gameScreenUI.closeFUE()}else h.ShowGameEndDialog(!1,t)},null,null),h.AfterGame=new h("AfterGame",function(){h.CurrentGame.GameResult==i.Win&&h.CurrentGame.Authority.IsChallenge&&(h.CurrentGame.CurrentChallenge.Completed=!0),setTimeout(function(){h.CurrentGame.Authority.IsChallenge||h.CurrentGame.DeleteSavedGame()},0)},null,function(){h.CurrentGame.SupplyView&&null!=h.CurrentGame.SupplyView.CardSupply.CardAnimator.WinAnimator&&h.CurrentGame.SupplyView.CardSupply.CardAnimator.WinAnimator.EndAnimation()}),h.WriteSolvableDeckLog=function(){h.CurrentGame.Authority.IsChallenge},h}),define("Solitaire/GameModes/IGameMode",[],function(){"use strict";var t=function(){this.Name=null,this.OnMoveCardButton=function(){},this.IsUpdateDealButtonsVisible=function(){return!1},this.IsUpdateDrawButtonVisible=function(){return!1},this.ConfigureSolitairePage=function(t){},this.WaitForAnimationOnHint=!1,this.CreateTemplate=function(){return null},this.GetCheatMoves=function(){return null},this.HelpDataSource=function(){return null},this.ButtonsPosition=function(t){return{}},this.GetGameEnd=function(){return null},this.SetShare=function(t){},this.UpdateLeaderBoard=function(){},this.GetStatKey=function(){}};return t.GameButtons={Deal:0,Draw:1},t.TimerSettings={Off:0,CountUp:1,CountDown:2},t}),define("Solitaire/GameModes/GameModeBase",[],function(){"use strict";var t=function(){this.initGameModeBase()};return t.prototype.initGameModeBase=function(){this.WaitForAnimationOnHint=!1},t.prototype.GetAvatarImage=function(t){throw"unsupported"},t.prototype.SetDefaults=function(t){throw"TODO - set up defauls"},t.OnUpdate=function(){},t.OnHome=function(t){throw"TODO - navigate to "+t},t.OnNewGame=function(t){throw"TODO - start new game"},t.SetDefaultShareMessage=function(t,e,i){throw"unsupported"},t}),define("CardUI/KeyboardNavigator",[],function(){var t=function(t){this.initKeyboardNavigator(t)};return t.prototype.initKeyboardNavigator=function(t){this.Host=t,this.KeypressActions=[],this.HasKeyboardFocus=!1},t.KeyAction=function(t){this.initKeyAction(t)},t.KeyAction.prototype.initKeyAction=function(t){this.DelegateToInvoke=null,this.PileToFocus=null,void 0!==t.Pile?this.PileToFocus=t:this.DelegateToInvoke=t},t.KeyPress={INVALID:0,Activate:1,Up:2,Down:3,Left:4,Right:5,Tab:6,ShiftTab:7},t.KeyPressCharMap={38:"Up",40:"Down",37:"Left",39:"Right",9:"Tab",32:"Activate",13:"Activate",13:"Activate",18:"Alt",91:"Ctrl",93:"Ctrl",224:"Ctrl",17:"Ctrl",90:"Z",72:"hintAction",112:"openHowToPlay",113:"NewGame",115:"Statistics",68:"Draw",27:"Menu",8:"Back"},t.prototype.RegisterKeypressHandler=function(e,i){null!=i&&(this.KeypressActions[e]||(this.KeypressActions[e]=[]),this.KeypressActions[e].push(new t.KeyAction(i)))},t.prototype.ResetKeypressHandlers=function(){this.KeypressActions=[]},t.prototype.ProcessKeyActions=function(t){var e=!1;if(this.KeypressActions[t])for(var i=this.KeypressActions[t],n=0;n<i.length;n++){var r=i[n];if(null!=r.PileToFocus){if(r.PileToFocus.Keyboard.GetKeyboardFocus()){this.LoseKeyboardFocus(),e=!0;break}}else if(null!=r.DelegateToInvoke&&r.DelegateToInvoke(this.Host,t)){this.LoseKeyboardFocus(),e=!0;break}}return e},t.prototype.GetKeyboardFocus=function(){return!!this.Host.OnGetKeyboardFocus()&&(this.Host.SupplyView.KeyboardFocus=this.Host,this.HasKeyboardFocus=!0,!0)},t.prototype.LoseKeyboardFocus=function(){this.Host.OnLoseKeyboardFocus(),this.HasKeyboardFocus=!1},t.prototype.HandleKeypress=function(t){this.Host.SupplyView.KeyboardEnabled&&(this.Host.TryHandleKeypress(t)||this.ProcessKeyActions(t))},t}),define("CardUI/CardHint",["absolute","pixi","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween"],function(t,e,i,n){"use strict";var r=function(t,e){this.initCardHint(t,e)};r.constructor=r,r.prototype=Object.create(i.prototype),r.TexturePath="hint_highlight",r.DCTexturePath="goal_glow";var o={ScaleFactor:.40625,HintScale:2.52};return r.prototype.initCardHint=function(e,n){n?i.call(this,n):i.call(this,e),this.ScaleUniform=o.ScaleFactor*o.HintScale,t.Platform.isMobile()&&(this.ScaleY=2.9*o.ScaleFactor),this.TextureAlphaEnabled=!0,this.InputEnabled=!1,this.Visible=!1,this._tween=null,this._pulse=new i(e),n&&(this._pulse.Visible=!0,this._pulse.ScaleUniform=1,this._pulse.Alpha=1),this.AddChild(this._pulse)},r.prototype.AnimatePulse=function(){if(null==this._tween){var t=new e.Point(1.15,1.15);this.children[0].visible=!0,this._pulse.ScaleUniform=1,this._pulse.Alpha=.8;var i=new n.TweenProperties;i.NumLoops=-1,this._tween=n.Start(this._pulse,i).ScaleTo(new e.Point(1,1),0).And().FadeTo(.8,0).Then().ScaleTo(t,.8,TWEEN.Easing.Cubic.Out).And().FadeTo(0,.8,TWEEN.Easing.Cubic.Out).Wait(0)}},r.prototype.AnimatePulseOnce=function(){if(!this.tweenIsRunning){this.children[0].visible=!1;var t=new e.Point(1.4,1.4);setTimeout(function(){this._tween&&(this.tweenIsRunning=!1,this.StopPulse())}.bind(this),480),this.tweenIsRunning=!0,this._pulse.ScaleUniform=1,this._pulse.Alpha=.8;var i=new n.TweenProperties;i.NumLoops=0,this._tween=n.Start(this._pulse,i).ScaleTo(t,2.4,TWEEN.Easing.Cubic.Out).And().FadeTo(0,.8,TWEEN.Easing.Cubic.Out)}},r.prototype.StopPulse=function(){null!=this._tween&&this._tween.Stop(!1),n.RemoveTween(this._pulse,this._tween),this._tween=null},r}),define("CardUI/CardView",["require","lodash","pixi","absolute","absolute/coords","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Tween/Tween","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","CardUI/CardHint"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e){this.initCardView(t,e)};h.constuctor=h,h.prototype=Object.create(s.prototype),h.TopLayer=5,h.BaseLayer=0,h.ScaleFactor=.40625,h.HintScale=2.52,h.RotationAngle=Math.PI,h._cardPickUp=new i.Point(-4,-8),h._shadowUp=new i.Point(35,35),h._shadowUpScale=1.25,h._shadowDownScale=1.2,h._shadowDownFront=new i.Point(7,13),h._shadowDownBack=new i.Point(4,7),h.MSecPerGesture=300,h.GestureRecognitionDelta=30,h.FullWidth=382,h.FullHeight=510;var u=function(){this.initCardBelowCache()};return u.prototype.initCardBelowCache=function(){this.Card=null,this.Pile=null},h.prototype.getShadowPosition=function(){var t=(this.IsPickedUp?h._shadowUp:this.CardFront.visible?h._shadowDownFront:h._shadowDownBack).clone();return this.shadow.scale.set(this.IsPickedUp?h._shadowUpScale:h._shadowDownScale),new i.Point(r.x(t.x),r.y(t.y)-this.shadowHeight/2)},h.prototype.initCardView=function(t,e){s.call(this),this.Card=t,this.SupplyView=e,this.IsPickedUp=!1,this.IsDraggable=!0,this._dragId=-1,this.OnMouseDownEventHandler=this.OnMouseDownEvent.bind(this),this.PointDown.add(this.OnMouseDownEventHandler),this.OnCardMouseUpEventHandler=this.OnCardMouseUpEvent.bind(this),this.PointUp.add(this.OnCardMouseUpEventHandler),this.OnMouseMoveEventHandler=this.OnMouseMoveEvent.bind(this),e.Scene.Root.PointMove.add(this.OnMouseMoveEventHandler),this.OnMouseUpEventHandler=this.OnMouseUpEvent.bind(this),e.Scene.Root.PointUp.add(this.OnMouseUpEventHandler),this.interactive=!0,this.buttonMode=!0,this.LockMouseUpReveal=!1,this.IsRevealToShow=!1,this._swipeUpRecognized=!1,this.PostionChanged=!1,this.CardBelowCache=new u,this.CardFront=null,this.CardBack=null,this._highlightTexture=null,this._keyboardHighlightTexture=null,this.shadow=null,this._hintTexture=null,this._goalTexture=null,this._isRighPressed=!1,this._holdTapValue=!1,this.LayerWhileAnimating=null,this._isDragging=!1,this._isHinted=!1,this._isGoalGlow=!1,this._keyboardHighlighted=!1,this._animating=!1,this._cardFlipAngle=1,this._localTouch=new i.Point,this._cardStartDragPos=new i.Point,this._isTweenPickUp=!1,this._scaleForCardSprites=h.ScaleFactor,this.HasInitRun=!1,this._selectOnMove=!1,this._firstDrag=!0,this._oldPosition=new i.Point,this._newPosition=new i.Point,this.AlreadyExcluded=!1,this.IsTweeningPickUp=!1,this._shadowScaleClean=!1,this._fakeRotationY=0,this._highlighted=!1,this._cardBelow=new u,this.Init(null),this.hitArea=new i.Rectangle(-this._cachedWidth/2,-this._cachedHeight/2,this._cachedWidth,this._cachedHeight),this.buttonMode=!0,this.HasJustBeenMoved=!1,this.InputIsBlocked=!1,this._mouseDownPos=null,this._mouseWasUpon=!1,this.checkStartAnimationCoords={Klondike:function(t){return t>r.y(220.2)}.bind(this),Spider:function(t){return t<r.y(961)}.bind(this),Pyramid:function(t){return t<r.y(900)}.bind(this),FreeCell:function(t){return t<r.y(961)}.bind(this),TriPeaks:function(t){return t<r.y(900)}.bind(this)}},Object.defineProperty(h.prototype,"IsDragging",{get:function(){return this._isDragging},set:function(t){this.parent.Pile.Cards.length>1&&this.SupplyView.forceShadowHide(t,this.parent.Pile.Cards,this.Card),this._isDragging!=t&&(this._isDragging=t,null!=this.parent&&this.SetIsPickedUpForCardsAbove(this._isDragging))}}),Object.defineProperty(h.prototype,"IsHinted",{get:function(){return this._isHinted},set:function(t){this._isHinted!=t&&(this._isHinted=t,this._hintTexture.visible=t,this._isHinted?this._hintTexture.AnimatePulse():this._hintTexture.StopPulse())}}),Object.defineProperty(h.prototype,"IsGoalGlow",{get:function(){return this._isGoalGlow},set:function(t){null!=this._goalTexture&&t!=this._isGoalGlow&&(this._isGoalGlow=t,setTimeout(function(){this._goalTexture.visible=t}.bind(this),0))}}),Object.defineProperty(h.prototype,"KeyboardHighlighted",{get:function(){return this._keyboardHighlighted},set:function(t){this._keyboardHighlighted!==t&&(this._keyboardHighlighted=t,t?this.addHighlightedTexture():null!=this._keyboardHighlightTexture&&this.removeHighlightedTexture())}}),h.prototype.addHighlightedTexture=function(){this._keyboardHighlightTexture=i.Sprite.fromFrame(this.SupplyView.GetThemeAssetPath("keyboard_highlight")),this._keyboardHighlightTexture.scale.set(1.22),this._keyboardHighlightTexture.anchor.x=this._keyboardHighlightTexture.anchor.y=.5,this._keyboardHighlightTexture.x+=1,this._keyboardHighlightTexture.y+=1,this._keyboardHighlightTexture.InputEnabled=!1,"Waste"===this.Card.Pile.Name||-1!==this.Card.Pile.Name.indexOf("Tableau")||-1!==this.Card.Pile.Name.indexOf("Foundation")||-1!==this.Card.Pile.Name.indexOf("Free")||this.isGame("Pyramid")&&"Stock"===this.Card.Pile.Name?(this.CardFront.addChild(this._keyboardHighlightTexture),this.CardFront.setChildIndex(this._keyboardHighlightTexture,0)):"Stock"===this.Card.Pile.Name&&(this.CardBack.addChild(this._keyboardHighlightTexture),this.CardBack.setChildIndex(this._keyboardHighlightTexture,0))},h.prototype.removeHighlightedTexture=function(){-1!=this.CardFront.children.indexOf(this._keyboardHighlightTexture)?this.CardFront.removeChild(this._keyboardHighlightTexture):-1!=this.CardBack.children.indexOf(this._keyboardHighlightTexture)&&this.CardBack.removeChild(this._keyboardHighlightTexture),this._keyboardHighlightTexture=null},Object.defineProperty(h.prototype,"Animating",{get:function(){return this._animating},set:function(t){this._animating!=t&&(t&&(null!=this.shadow&&(this.shadow.alpha=0),null!=this._highlightTexture&&(this._highlightTexture.alpha=0),null!=this._keyboardHighlightTexture&&(this._keyboardHighlightTexture.alpha=0),this.CardBack,this._shadowScaleClean=!1),this._animating=t)}}),Object.defineProperty(h.prototype,"CardFlipAngle",{get:function(){return this._cardFlipAngle},set:function(t){Math.abs(t-this._cardFlipAngle)<1e-6||(this._cardFlipAngle=t,this.OnCardFlipAngleChanged())}}),h.prototype.OnCardFlipAngleChanged=function(){this.UpdateCardFlip(),this.ApplyCardFlipRotation(this.CardFlipAngle*h.RotationAngle)},h.prototype.forceShadowHide=function(t){this._forceShadowHide=t},h.prototype.Init=function(t){this.HasRunInit||(this.HasRunInit=!0,this.SupplyView.EnableHighlight&&(this._highlightTexture=new s(this.SupplyView.GetThemeAssetPath("highlight")),this._highlightTexture.scale.x=this._highlightTexture.scale.y=2.46*h.ScaleFactor,this._highlightTexture.InputEnabled=!1,this.addChild(this._highlightTexture)),this.SupplyView.CardSupply.Authority.IsChallenge&&(this._goalTexture=new s(this.SupplyView.GetThemeAssetPath("goal_glow")),this._goalTexture.scale.x=this._goalTexture.scale.y=2.44*h.ScaleFactor,n.Platform.isMobile()&&(this._goalTexture.scale.y=2.9*h.ScaleFactor),this._goalTexture.InputEnabled=!1,this._goalTexture.visible=!1,this.addChild(this._goalTexture)),this._hintTexture=new l(this.SupplyView.GetThemeAssetPath(l.TexturePath)),this.addChild(this._hintTexture),this.CardFrontPathBase=this.SupplyView.GetThemeAssetPath(this.Card.GetThemeItem()),this.CardBackPathBase=this.SupplyView.GetThemeAssetPath("cardback"),this.CardFront=new s,this.SupplyView.EnableCardBacks&&(this.CardBack=new s),this.SetCardTextures(),null!=this.CardBack&&this.addChild(this.CardBack),this.SupplyView.EnableShadows&&(this.shadow=new s(this.SupplyView.GetThemeAssetPath("shadow")),this.shadow.InputEnabled=!1,this.shadow.visible=!0,this.shadow.alpha=.55,this.shadow.sprite.anchor.x=.5,this.shadow.scale.set(h._shadowDownScale),this.shadow.sprite.anchor.y=0,this.CardFront.addChild(this.shadow),this.CardFront.setChildIndex(this.shadow,0),this.shadowHeight=this.shadow.height),this.addChild(this.CardFront),this.UpdateCardFlip(),s.prototype.Init.call(this,t))},h.prototype.SetCardTextures=function(){var t=1;null!=this.SupplyView.parent&&(t=this.SupplyView.parent.scale.x);var e=t*h.ScaleFactor*r.x(h.FullWidth),i=t*h.ScaleFactor*r.x(h.FullHeight);Math.abs(e-this._cachedWidth)<1e-7||(this.CardFrontPath=this.CardFrontPathBase,this.CardBackPath=this.CardBackPathBase,this.CardFront.SetTexture(this.CardFrontPath),this.SupplyView.EnableCardBacks&&this.CardBack.SetTexture(this.CardBackPath),this._scaleForCardSprites=2*h.ScaleFactor,this._cachedWidth=e,this._cachedHeight=i)},h.prototype.UnregisterEvents=function(){this.mousedown=null,this.mouseup=null,this.SupplyView.Scene.Root.PointMove.remove(this.OnMouseMoveEventHandler),this.OnMouseUpEventHandler=this.OnMouseUpEvent.bind(this),this.SupplyView.Scene.Root.PointUp.remove(this.OnMouseUpEventHandler),this.PointDown=null,this.PointUp=null,this._cardBelow.Card=null,this._cardBelow.Pile=null},h.prototype.IsFaceUp=function(){return this.CardFlipAngle<.5},h.prototype.OnMouseDownEvent=function(t,e){if(!this.InputIsBlocked&&(this._mouseWasUpon=!0,this._mouseDownPos=new i.Point(e.originalEvent.x,e.originalEvent.y),!this.SupplyView.IsCardDragging))if(this._holdTapValue=Date.now(),this.SupplyView.ClearRevealCardStates(this),this.SupplyView.GameInputInterpreter.IsClickedOnCard=!0,this.LockMouseUpReveal||this.IsDraggable||this.IsFaceUp()&&this.Card.Pile.IsPileAllowToRevealCard()&&(this.IsRevealToShow=!this.IsRevealToShow),null!=this.SupplyView.KeyboardFocus&&this.SupplyView.KeyboardFocus.Keyboard.LoseKeyboardFocus(),this._shadowScaleClean=!1,this.UpdateInteractionMode(),this.IsDraggable){o.Sounds.PlaySound("pickupCard");var n=this.SupplyView.GameInputInterpreter.GetHighlightedCard();null==n||n==this?this.StartDrag(e):this._selectOnMove=!0}else this.SupplyView.TellMouseDown(this)},h.prototype.OnMouseMoveEvent=function(t,e){if(!this.InputIsBlocked){if(this.IsDraggable&&this._selectOnMove&&(this._selectOnMove=!1,this.StartDrag(e)),this._mouseWasUpon){var n=new i.Point(e.originalEvent.x,e.originalEvent.y);this.HasJustBeenMoved=Math.abs(n.x-this._mouseDownPos.x)>10||Math.abs(n.y-this._mouseDownPos.y)>10,this.HasJustBeenMoved&&(this._mouseWasUpon=!1)}this.IsDragging&&(this.IsSwipedUp(e)&&(this._swipeUpRecognized=!0),this._firstDrag&&(this.SupplyView.OnMoveCards(),this._firstDrag=!1),this.ClearPreviousSelection(e.global.x-this._localTouch.x,e.global.y-this._localTouch.y),this.Position=this.parent.toLocal({x:this._cardStartDragPos.x+e.global.x-this._localTouch.x,y:this._cardStartDragPos.y+e.global.y-this._localTouch.y}),Math.abs(this.Position.x)>0&&(this.IsRevealToShow=!1,this.LockMouseUpReveal=!0))}},h.prototype.ClearPreviousSelection=function(t,e){var i=Math.sqrt(t*t+e*e),n=this.SupplyView.GameInputInterpreter.GetHighlightedCard();null!=n&&n!==this&&i>10&&this.SupplyView.GameInputInterpreter.ClearHighlight()},h.prototype.OnMouseUpEvent=function(t,e){if(!this.InputIsBlocked){if(this.IsDraggable&&this._selectOnMove&&(this._selectOnMove=!1,this.StartDrag(e)),this._mouseWasUpon){
var n=new i.Point(e.originalEvent.x,e.originalEvent.y);this.HasJustBeenMoved=Math.abs(n.x-this._mouseDownPos.x)>10||Math.abs(n.y-this._mouseDownPos.y)>10,this._mouseWasUpon=!1}this._shadowScaleClean=!1,this.LockMouseUpReveal=!1,this.IsDragging&&(this._swipeUpRecognized&&Date.now()-this._holdTapValue<MSecPerGesture&&this.SupplyView.GameInputInterpreter.ClickCard(this),this.SupplyView.TellMouseDown(this),this.Animating||this.SupplyView.TellMouseUp(this),this.IsDragging=!1,this._swipeUpRecognized=!1,this.SupplyView.IsCardDragging=!1),this.SupplyView.GameInputInterpreter.IsClickedOnCard=!1}},h.prototype.OnCardMouseUpEvent=function(t,e){},h.prototype.StartDrag=function(t){var e=this.toGlobal(this.position),n=this.scale.x*this.parent.scale.x,r=this.GetCardPositionInPile(this.parent,!0);r.x*=n,r.y*=n,this._cardStartDragPos=new i.Point(e.x-r.x*this.SupplyView.scale.x,e.y-r.y*this.SupplyView.scale.y),this._localTouch.x=t.global.x,this._localTouch.y=t.global.y,this.IsDragging=!0,this.SupplyView.IsCardDragging=!0,this._firstDrag=!0,this.parent.parent.addChild(this.parent)},h.prototype.IsSwipedUp=function(t){return!1},h.prototype.ForceDrop=function(t){this.IsDragging&&(this.SupplyView.TellMouseUp(this,t),this.IsDragging=!1,this.SupplyView.IsCardDragging=!1,this._dragId=-1,this.SupplyView.GameInputInterpreter.IsClickedOnCard=!1)},h.prototype.UpdatePosition=function(){var t=this.GetCardPositionInPile(this.parent);if(Math.abs(this.position.x-t.x)<1e-6&&Math.abs(this.position.y-t.y)<1e-6)return void(this._positionChanged=!1);this._positionChanged=!0,this._shadowScaleClean=!1,this.position.x=t.x,this.position.y=t.y},h.prototype.UpdateInternal=function(t,e){var i=null,n=this.parent;null!=n&&(i=n),this.UpdateTextureProperties(e),this.Animating||(null!=i&&(this.UpdateInteractionMode(),this.IsDragging?(this._positionChanged=Math.abs(this._oldPosition-this._newPosition)<1e-6,this._oldPosition=this._newPosition):this.UpdatePosition(),this.SetCardFacing(i.CardFacing)),this.IsPickedUp&&(this._shadowScaleClean=!1)),this.UpdateScale(),null!=this.LayerWhileAnimating?this.Layer=this.LayerWhileAnimating:this.IsPickedUp||this.IsInAnimatingStack()?this.SetLayerForCardsAbove(h.TopLayer):this.Layer=this.BaseLayer,this._shadowScaleClean=!1,s.prototype.UpdateInternal.call(this,t)},h.prototype.UpdateCardFlip=function(){this.CardFlipAngle<.5?(null!=this.CardBack&&(this.CardBack.visible=!1,this.setInactive(this.CardBack)),this.CardFront.visible=!0,this.setActive(this.CardFront,h._shadowDownFront)):(this.CardFront.visible=!1,this.setInactive(this.CardFront),null!=this.CardBack&&(this.CardBack.visible=!0),this.setActive(this.CardBack,h._shadowDownBack))},h.prototype.setActive=function(t,e){this.shadow.position.set(e.x,e.y),t.addChild(this.shadow),this._highlightTexture&&(t.addChild(this._highlightTexture),t.setChildIndex(this._highlightTexture,0)),this._goalTexture&&(t.addChild(this._goalTexture),t.setChildIndex(this._goalTexture,0)),t.setChildIndex(this.shadow,0)},h.prototype.setInactive=function(t){-1!==t.children.indexOf(this.shadow)&&t.removeChild(this.shadow),-1!==t.children.indexOf(this._highlightTexture)&&t.removeChild(this._highlightTexture),-1!==t.children.indexOf(this._goalTexture)&&t.removeChild(this._goalTexture)},h.prototype.UpdateScale=function(){this.scale.x=this.scale.y=this.SupplyView.CardScale;var t=Math.cos(this._fakeRotationY);t<0?(t=-t,this.rotation=Math.PI):this.rotation=0,null!=this.CardFront&&(this.CardFront.scale.x=t*this._scaleForCardSprites,this.CardFront.scale.y=this._scaleForCardSprites),null!=this.CardBack&&(this.CardBack.scale.x=t*this._scaleForCardSprites,this.CardBack.scale.y=this._scaleForCardSprites)},Object.defineProperty(h.prototype,"HighliteTextureVisibility",{set:function(t){null!=this._highlightTexture&&this._highlightTexture.visible!=t&&(this._highlightTexture.visible=t)}}),h.prototype.UpdateTextureProperties=function(t){if(this.checkAndSetShadowVisibility(),null!=this._highlightTexture&&Math.abs(this._highlightTexture.alpha)<.1&&(this._highlightTexture.alpha=1),null!=this.shadow){var e=this.parent;null!=e&&0==e.PileMode&&e.Pile.Bottom!=this.Card?this.shadow.alpha=0:Math.abs(this.shadow.alpha)<.1&&(this.shadow.alpha=.55)}this.KeyboardHighlighted=this.parent.Keyboard&&this.parent.Keyboard.HasKeyboardFocus&&this.parent.FocusedCard==this,this.HighliteTextureVisibility=this.IsPickedUp||this.SupplyView.GameInputInterpreter.GetHighlightedCard()==this||this.IsInHighlightedStack();var i=this.getShadowPosition();if(null!=this.shadow){this.IsDragging?(this.shadow.alpha=1,this.shadow.visible=!0,Math.abs(this.shadow.position.x-i.x)<.1&&Math.abs(this.shadow.position.y-i.y)<.1||this.IsTweeningPickUp||a.Start(this.shadow).MoveTo(i,.15,TWEEN.Easing.Cubic.Out)):(a.Start(this.shadow).MoveTo(i,.15,TWEEN.Easing.Cubic.Out),this.shadow.alpha=.55)}this.SupplyView.CardSupply.CardAnimator.IsShuffleAnimationRunning()&&(this.shadow.x=i.x,this.shadow.y=i.y),this.shadow.visible=this.checkWithStock(t)&&(-1!==this.Card.Pile.Name.indexOf("Tableau")||-1!==this.Card.Pile.Name.indexOf("FaceDown")),this.checkAndSetShadowVisibility(),this.shadow.visible=-1!==this.Card.Pile.Name.indexOf("Tableau")&&this._forceShadowHide?!this._forceShadowHide:this.shadow.visible,this.checkForMultipleDragging()},h.prototype.checkWithStock=function(t){var e=this.SupplyView.GetPileView("Stock");if("FreeCell"===this.Card.Supply.GameName){var i=this.SupplyView.GetPileView("Tableau3"),n=i.Pile.GetCardAtPos(i.Pile.Cards.length-1);return this.Card===n||this.CardFront.visible}return this.worldTransform.ty>=e.worldTransform.ty+t||this.worldTransform.ty<=e.worldTransform.ty-t},h.prototype.checkAndSetShadowVisibility=function(){var t=this.Card.Pile.Name;if("Stock"!==t||this.GetCardBelow()||(this.shadow.Visible=!0),"Stock"===t&&this.isGame("Pyramid")&&this.GetCardBelow()&&(this.shadow.Visible=!1),"Waste"===t&&(this.isGame("Klondike")?this.shadow.visible=this.parent.Pile.Cards.indexOf(this.Card)>=this.parent.Pile.Cards.length-3:(this.isGame("Pyramid")||this.isGame("TriPeaks"))&&(this.shadow.visible=!this.GetCardBelow())),(-1!==t.indexOf("Foundation")||-1!==t.indexOf("Free"))&&this.parent.Pile){var e=this.parent.Pile.Cards.slice();this.shadow.visible=e.pop()===this.Card||e.pop()===this.Card}"Stock"!==this.Card.Pile.Name||this.isGame("Pyramid")||null!==this.GetCardBelow()||(this.shadow.Visible=!0)},h.prototype.checkForMultipleDragging=function(){if(this.IsDragging&&-1!==this.Card.Pile.Name.indexOf("Tableau")){var t=this.parent.Pile.Cards.length-this.parent.Pile.Cards.indexOf(this.Card);this.shadow.visible=!0;var e=this.GetShadowScale();this.shadow.scale.y=e.y+(t>1?.04:.08)}},h.prototype.AnimateSingleTapRejection=function(){if(!this.wiggleAnimationStarted){this.wiggleAnimationStarted=!0;for(var t=a.Start(this),e=16,n=0;n<6;n++)e+=e>0?-2:2,e*=-1,t.MoveTo(new i.Point(this.x-e,this.y),.04,TWEEN.Easing.Linear.None);setTimeout(function(){this.wiggleAnimationStarted=!1}.bind(this),360)}},h.prototype.isGame=function(t){return this.Card.Supply.GameName===t},h.prototype.AnimatePickUp=function(t,e){},h.prototype.GetShadowScale=function(){if(null==this.shadow)return new i.Point(1,1);if((this._shadowScaleClean||!this.shadow.Visible)&&(!this.shadow||!this.shadow.visible))return this.shadow.Scale;var t=new i.Point(1,1),e=this.shadow.Scale,n=this.Parent,r=null;if(null!=n){for(var o=(null==n.PileStackedOn?n:n.PileStackedOn).children,a=o.length-1;a>=0;a--)if(o[a]instanceof h&&o[a].IsPickedUp==this.IsPickedUp&&o[a].Animating==this.Animating){r=o[a];break}if(null==r&&o!=n.children)for(var a=n.children.length-1;a>=0;a--)if(n.children[a]instanceof h){r=n.children[a];break}}if(null!=r){r.IsDragging||r.UpdatePosition();var s=r.CardFront.children.slice().pop().worldTransform.a,l=r.CardFront.children.slice().pop().worldTransform.d,u=new i.Point(r._cachedWidth,r._cachedHeight),d=r.toGlobal(new i.Point(.5*u.x,.5*u.y)),c=this.toGlobal(new i.Point(-.5*u.x,-.5*u.y));if(2==n.PileMode){var p=1/s*(d.x-c.x);t.x=p/this.width}else if(1==n.PileMode){var g=1/l*(d.y-c.y);t.y=g/this._cachedHeight}}return t.x==e.x&&t.y==e.y&&(this._shadowScaleClean=!0),t},h.prototype.ApplyCardFlipRotation=function(t){t>Math.PI/2&&(t-=Math.PI),this._fakeRotationY=t},Object.defineProperty(h.prototype,"Highlighted",{get:function(){return this._highlighted},set:function(t){this._highlighted=t,this.HighlightTextureVisibility=t,this.OnHighlightedChanged()}}),h.prototype.OnHighlightedChanged=function(){},h.prototype.GetCardPositionInPile=function(t,e){e=!!e,null==t&&(t=this.parent);var n=new i.Point(0,0),r=this.GetCardBelow();if(null==r)n.x=0,n.y=0;else{var o,a=r.parent;o=r.IsDragging&&!e?new i.Point(r.x,r.y):r.GetCardPositionInPile(a,e);var s=this.Card.Pile.GetCardPosFromEnd(this.Card);if(null!=t&&(0==t.NumFanning||s<t.NumFanning)&&(t.FanFraction<=1||s%t.FanFraction==0)){if(null!=a){var l=a.BlockedPileSpacing;if(void 0===l)return n;n.x=o.x+a.x-this.parent.x+l.x*this.CardFront.sprite.texture.width*this.scale.x,n.y=o.y+a.y-this.parent.y+l.y*this.CardFront.sprite.texture.width*this.scale.y}r.IsRevealToShow&&this.Card.Pile.IsPileAllowToRevealCard()&&(1!=this.SupplyView.CurrentLayout?n.y+=30:n.x+=30)}else null!=a&&(n.x=o.x+a.x-this.parent.x)}return n},h.prototype.IsInAnimatingStack=function(){if(this.Animating)return!0;var t=this.GetCardBelow();return null!=t&&t.IsInAnimatingStack()},h.prototype.IsInAnimatingPile=function(){var i=t("CardUI/PileView");if(this.Animating)return!0;if(e.forEach(this.parent.children,function(t){if(t instanceof h&&t.Animating)return!0}),this.parent instanceof i){var n=this.parent.StackedPile;null!=n&&e.forEach(n.children,function(t){if(t instanceof h&&t.Animating)return!0})}return!1},h.prototype.IsInHighlightedStack=function(){return this.SupplyView.GameInputInterpreter.GetHighlightedCard()==this},h.prototype.SetIsPickedUpForCardsAbove=function(t){for(var e=this.parent.children.indexOf(this);e<this.parent.children.length;e++){var i=this.parent.children[e];null!=i&&(i.IsPickedUp=t)}},h.prototype.SetLayerForCardsAbove=function(t){for(var e=t,i=this.parent.children.indexOf(this);i<this.parent.children.length;i++){var n=this.parent.children[i];null!=n&&(n.Layer=e,e++)}},h.prototype.SetCardFacing=function(e){this.visible=!0;var i=t("CardUI/PileView");e==i.Facing.FaceDown?this.CardFlipAngle=1:e==i.Facing.FaceUp?this.CardFlipAngle=0:e==i.Facing.Hidden&&(this.visible=!1)},h.prototype.UpdateInteractionMode=function(){var t=this.parent;if(null!=t)switch(t.InteractionMode){case 0:this.CardFront.InputEnabled=this.InputEnabled=this.IsDraggable=!1,null!=this.CardBack&&(this.CardBack.InputEnabled=!1);break;case 1:this.InputEnabled=!0,this.CardFront.InputEnabled=!1,null!=this.CardBack&&(this.CardBack.InputEnabled=!1),this.IsDraggable=!1;break;case 2:var e=this.SupplyView.CardSupply.Authority.CanPickupCard(this.Card);this.CardFront.InputEnabled=!0,null!=this.CardBack&&(this.CardBack.InputEnabled=e),e&&(this.InputEnabled=!0),this.IsDraggable=e}},h.prototype.Highlight=function(){this.Highlighted=!0},h.prototype.ClearHighlight=function(){this.Highlighted=!1},h.prototype.GetCardFlipAngle=function(t,e){return this.CardFlipAngle},h.prototype.SetCardFlipAngle=function(t,e,i){this.CardFlipAngle=i,this._shadowScaleClean=!0},h.prototype.SetShadowFlipAngle=function(t,e,i){this.shadowFlipAngle=i,this._shadowScaleClean=!1},h.prototype.GetCardBelow=function(){var t=this,e=this.parent;if(null==e)return null;if(this._cardBelow.Pile==e)return this._cardBelow.Card;for(var i=e.children,n=-1;null!=i;){if(n<0)for(var r=0;r<i.length;r++)if(i[r]==t){n=r;break}if(n>0)for(var o=n-1;o>=0;o--)if(i[o]instanceof h){var a=i[o];return this._cardBelow.Card=a,this._cardBelow.Pile=e,a}if(!(n>=0&&null!=e.StackedPile))break;e=e.StackedPile,i=e.children,n=e.children.length}return this._cardBelow.Card=null,this._cardBelow.Pile=e,null},h}),define("CardUI/PileView",["lodash","pixi","CardUI/KeyboardNavigator","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","CardUI/CardView","CardUI/CardHint","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Maths/Vector2","absolute"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e){this.initPileView(t,e)};return h.prototype.constructor=h,h.prototype=Object.create(n.prototype),h.MinPileSpacing=.05,h.Display={Default:0,Blank:1,Circle:2,Foundation:3,X:4,Tableau:5,Stock:6,Club:7,Heart:8,Diamond:9,Spade:10},Object.defineProperty(h.prototype,"DisplayType",{set:function(t){if(t!=this._displayType)switch(this._displayType=t,t){case h.Display.Blank:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("blankpile"));break;case h.Display.Circle:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("emptypile_circle"));break;case h.Display.Tableau:case h.Display.Stock:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("emptypile"));break;case h.Display.X:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("emptypile_x"));break;case h.Display.Club:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("foundation_club"));break;case h.Display.Heart:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("foundation_heart"));break;case h.Display.Diamond:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("foundation_diamond"));break;case h.Display.Spade:this.Background.SetTexture(this.SupplyView.GetThemeAssetPath("foundation_spade"))}},get:function(){return this._displayType}}),h.Facing={FaceUp:0,FaceDown:1,Hidden:2},h.Layout={Pile:0,FanDown:1,FanRight:2},h.Interaction={None:0,Click:1,Drag:2},Object.defineProperty(h.prototype,"StackedPile",{get:function(){return this._stackedPile},set:function(t){this._stackedPile=t,t.PileStackedOn=this}}),Object.defineProperty(h.prototype,"DefaultPileSpacing",{get:function(){return this._defaultPileSpacing},set:function(t){this._defaultPileSpacing=t,this.PileSpacing=this.BlockedPileSpacing=this.AfterShufflePileSpacing=t}}),Object.defineProperty(h.prototype,"IsHinted",{get:function(){return this._isHinted},set:function(t){null!=this._hintTexture&&t!=this._isHinted&&(this._isHinted=t,this._isHinted&&this.SupplyView.EnablePileHints?(this._hintTexture.visible=!0,this._hintTexture.AnimatePulse()):(this._hintTexture.visible=!1,this._hintTexture.StopPulse()))}}),h.prototype.dealIsNotAllowed=function(){this._hintTexture.visible=!0,this._hintTexture.AnimatePulseOnce()},h.prototype.initPileView=function(t,r){n.call(this),this.Pile=t,this.SupplyView=r,this.FanFraction=1,this.Background=new n,this.OnMouseDownEventHandler=this.OnMouseDownEvent.bind(this),this.Background.PointDown.add(this.OnMouseDownEventHandler),this.Background.interactive=!0,this.PointDown.add(this.OnMouseDownEventHandler),this.interactive=!0,this.SupplyView.CardScaleChanged.add(this.SupplyViewCardScaleChanged.bind(this)),this.SupplyView.pileBackgroundContainer.addChildAt(this.Background,0),this.Keyboard=new i(this),this.KeyboardMode=h.KeyboardModes.NoKeyboard,this._displayType=h.Display.Default,this.CardFacing=h.Facing.FaceDown,this.PileMode=h.Layout.Pile,this.InteractionMode=h.Interaction.None,this.FanLimit=0,this.NumFanning=0,this._stackedPile=null,this.PileStackedOn=null,this.LogicalScreenPos=new e.Point,this.PileSpacing=new s,this.BlockedPileSpacing=new s,this._defaultPileSpacing=new s,this.AfterShufflePileSpacing=new s,this.HeightLimit=0,this.AllowClickWhenEmpty=!0,this._keyboardHighlightTexture=null,this._hintTexture=null,this._isHinted=!1,this.FullyCompressOnDeal=!1,this.KeyboardMode=h.KeyboardModes.NoKeyboard,this.FocusedCard=null,this.LogicalScreenPos=new e.Point(0,0),this.InputEnabled=!0,this.buttonMode=!0,this.Init(null)},h.prototype.SupplyViewCardScaleChanged=function(t,e){this.UpdateBackgroundScale(),this.UpdateHintScale()},h.prototype.UnregisterEvents=function(){this.Background.PointDown.remove(this.OnMouseDownEventHandler),this.SupplyView.CardScaleChanged.remove(this.SupplyViewCardScaleChanged.bind(this)),this.Keyboard.ResetKeypressHandlers(),t.forEach(this.children,function(t){t instanceof r&&t.UnregisterEvents()})},h.prototype.Init=function(t){this._keyboardHighlightTexture=new n,this._keyboardHighlightTexture.SetTexture(this.SupplyView.GetThemeAssetPath("keyboard_highlight")),this._keyboardHighlightTexture.TextureAlphaEnabled=!0,this._keyboardHighlightTexture.Init(null),this._keyboardHighlightTexture.InputEnabled=!1,this._keyboardHighlightTexture.Visible=!1,this._keyboardHighlightTexture.Layer=1,this._keyboardHighlightTexture.Position=this.Position,this._keyboardHighlightTexture.sprite.anchor.x=this._keyboardHighlightTexture.sprite.anchor.y=.5,this.AddChild(this._keyboardHighlightTexture),this._hintTexture=new o(this.SupplyView.GetThemeAssetPath(o.TexturePath)),this.AddChild(this._hintTexture),this._hintTexture.Visible=!1,this._hintTexture.ScaleX=this._hintTexture.ScaleY=this.SupplyView.CardScale*r.ScaleFactor*r.HintScale,n.prototype.Init.call(this,t)},h.prototype.OnMouseDownEvent=function(t,e){null!=this.SupplyView.KeyboardFocus&&this.SupplyView.KeyboardFocus.Keyboard.LoseKeyboardFocus(),this.SupplyView.IsCardDragging||this.Pile.Empty&&this.SupplyView.TellMouseDown(this)},h.prototype.UpdateInternal=function(t){this.SupplyView.KeyboardFocus==this&&(null!=this.FocusedCard&&this.FocusedCard.Card.Pile!=this.Pile?this.FocusedCard=this.Pile.Empty?null:this.SupplyView.GetCardView(this.Pile.Top):null!=this.FocusedCard||this.Pile.Empty||(this.FocusedCard=this.SupplyView.GetCardView(this.Pile.Top))),null!=this._keyboardHighlightTexture&&(this.SupplyView.KeyboardFocus==this&&null==this.FocusedCard&&this.SupplyView.Focused&&this.AllowClickWhenEmpty&&this.Keyboard.HasKeyboardFocus?(this._keyboardHighlightTexture.Visible||(this._keyboardHighlightTexture.Visible=!0),Math.abs(this._keyboardHighlightTexture.ScaleX-this.SupplyView.CardScale)>1e-6&&(this._keyboardHighlightTexture.ScaleX=this._keyboardHighlightTexture.ScaleY=this.SupplyView.CardScale)):this._keyboardHighlightTexture.Visible&&(this._keyboardHighlightTexture.Visible=!1)),n.prototype.UpdateInternal.call(this,t),this.FanLimit>0&&(this.NumFanning=this.FanLimit),this.CardFacing!=h.Facing.Hidden&&(this.AllowClickWhenEmpty?0==this.Pile.Count&&this.InteractionMode!=h.Interaction.None?(this.Background.InputEnabled=!0,this.Background.buttonMode=!0,this.buttonMode=!0):(this.Background.InputEnabled=!1,this.Background.buttonMode=!1,this.buttonMode=!1):(this.Background.InputEnabled=!1,this.Background.buttonMode=!1,this.interactive=!1,this.buttonMode=!1),this.Compress(),this.UpdatePosition())},h.prototype.UpdateHintScale=function(){null!=this._hintTexture&&Math.abs(this._hintTexture.ScaleX-this.SupplyView.CardScale)>0&&(this._hintTexture.ScaleX=this._hintTexture.ScaleY=this.SupplyView.CardScale*r.ScaleFactor*r.HintScale,l.Platform.isMobile()&&(this._hintTexture.ScaleY=2.9*r.ScaleFactor))},h.prototype.UpdateBackgroundScale=function(){null!=this.Background&&this.Background.IsLoaded&&(this._displayType!=h.Display.Blank?this.Background.ScaleUniform=this.SupplyView.CardScale*r.ScaleFactor*2:this.Background.ScaleUniform=this.SupplyView.CardScale)},h.prototype.UpdatePosition=function(){this.X=this.SupplyView.GetWidth()*this.LogicalScreenPos.x,this.Y=this.SupplyView.GetHeight()*this.LogicalScreenPos.y,this.Background.X=this.SupplyView.GetWidth()*this.LogicalScreenPos.x,this.Background.Y=this.SupplyView.GetHeight()*this.LogicalScreenPos.y},h.prototype.GetScreenPosition=function(){var t=this.SupplyView.GetWidth()*this.LogicalScreenPos.x,i=this.SupplyView.GetHeight()*this.LogicalScreenPos.y,n=this.Parent.toGlobal(new e.Point(t,i));return new e.Point(n.x,n.y)},h.prototype.BottomRightCornerGlobal=function(t){var i=t.toGlobal(new e.Point(t.width/2,t.height/2));return new s(i.x,i.y)},h.prototype.Compress=function(){if(!(this.SupplyView.CardSupply.WaitingForAnimation||Math.abs(this.HeightLimit)<1e-6||0==this.Pile.Count)){var t=this.SupplyView.GetCardView(this.Pile.Top);if(!t.IsPickedUp){var e="Stock"==this.Pile.Type?1.6:1.1,i="Spider"==this.SupplyView.CardSupply.GameName||"FreeCell"==this.SupplyView.CardSupply.GameName,n=this.BottomRightCornerGlobal(t),r=a.Display.Height*this.HeightLimit;if("Klondike"==this.SupplyView.CardSupply.GameName){var o=this.worldTransform.ty+.24*(this.Pile.Count-1)+t._cachedHeight/2,l=Math.abs(r-o),u=l/this.Pile.Cards.length,d=u/(t._cachedHeight*t.scale.y);if(this.PileSpacing.Y==d||d>this.DefaultPileSpacing.Y)return;return void(this.BlockedPileSpacing=this.PileSpacing=new s(this.PileSpacing.X,d))}n.Y>r?null!=this.StackedPile&&this.StackedPile.PileSpacing.Length>h.MinPileSpacing?this.StackedPile.PileSpacing=new s(this.StackedPile.PileSpacing.X,.9*this.StackedPile.PileSpacing.Y):i&&this.BlockedPileSpacing.Length>h.MinPileSpacing?this.BlockedPileSpacing=new s(this.BlockedPileSpacing.X,.9*this.BlockedPileSpacing.Y):this.PileSpacing=new s(this.PileSpacing.X,.9*this.PileSpacing.Y):this.PileSpacing.Length<.9*this.DefaultPileSpacing.Length?(this.savedPileSpacing=this.PileSpacing,this.PileSpacing=new s(this.PileSpacing.X*e,this.PileSpacing.Y*e),this.PileSpacing.LengthSquared>this.DefaultPileSpacing.LengthSquared&&(this.PileSpacing=this.DefaultPileSpacing),this.UpdateChildPositions(),n=this.BottomRightCornerGlobal(t),n.Y>r&&(this.PileSpacing=this.savedPileSpacing)):i&&this.BlockedPileSpacing.Length<.9*this.DefaultPileSpacing.Length?(this.savedPileSpacing=this.BlockedPileSpacing,this.BlockedPileSpacing=new s(this.BlockedPileSpacing.X*e,this.BlockedPileSpacing.Y*e),this.BlockedPileSpacing.LengthSquared>this.DefaultPileSpacing.LengthSquared&&(this.BlockedPileSpacing=this.DefaultPileSpacing),this.UpdateChildPositions(),n=this.BottomRightCornerGlobal(t),n.Y>r&&(this.BlockedPileSpacing=this.savedPileSpacing)):null!=this.StackedPile&&this.StackedPile.PileSpacing.Length<.9*this.StackedPile.DefaultPileSpacing.Length&&(this.savedPileSpacing=this.StackedPile.PileSpacing,this.StackedPile.PileSpacing=new s(this.StackedPile.PileSpacing.X*e,this.StackedPile.PileSpacing.Y*e),this.StackedPile.PileSpacing.LengthSquared>this.DefaultPileSpacing.LengthSquared&&(this.StackedPile.PileSpacing=this.DefaultPileSpacing),this.StackedPile.UpdateChildPositions(),this.UpdateChildPositions(),n=this.BottomRightCornerGlobal(t),n.Y>r&&(this.StackedPile.PileSpacing=this.savedPileSpacing,this.StackedPile.UpdateChildPositions()))}}},h.prototype.NotifyDealing=function(){this.FullyCompressOnDeal&&(this.PileSpacing=new s(.01*this.PileSpacing.x,.01*this.PileSpacing.y),this.BlockedPileSpacing=new s(.01*this.BlockedPileSpacing.x,.01*this.BlockedPileSpacing.y),this.UpdateChildPositions())},h.prototype.UpdateChildPositions=function(){t.forEach(this.children,function(t){t instanceof r&&t.UpdatePosition()})},h.KeyboardModes={NoKeyboard:0,TopCard:1,TopCardAndEmpty:2,TopCardIfAllowed:3,AllCards:4,AllCardsAndEmpty:5},h.prototype.OnGetKeyboardFocus=function(){if(this.KeyboardMode==h.KeyboardModes.NoKeyboard)return!1;if(0!=this.Pile.Count){if(this.KeyboardMode==h.KeyboardModes.TopCardIfAllowed&&!this.SupplyView.CardSupply.Authority.CanKeyboardFocusCard(this.Pile.Top))return!1;this.FocusedCard=this.SupplyView.GetCardView(this.Pile.Top)}else{if(this.KeyboardMode!=h.KeyboardModes.AllCardsAndEmpty&&this.KeyboardMode!=h.KeyboardModes.TopCardAndEmpty)return!1;this.FocusedCard=null}return!0},h.prototype.OnLoseKeyboardFocus=function(){this.FocusedCard=null},h.prototype.TryHandleKeypress=function(t){if(t==i.KeyPress.Activate)return null!=this.FocusedCard?this.SupplyView.TellMouseDown(this.FocusedCard,!1):this.SupplyView.TellMouseDown(this),!1;if(t==i.KeyPress.Tab||t==i.KeyPress.ShiftTab)return!1;if(t==i.KeyPress.Up||t==i.KeyPress.Down||t==i.KeyPress.Left||t==i.KeyPress.Right){if(this.KeyboardMode==h.KeyboardModes.TopCard||this.KeyboardMode==h.KeyboardModes.TopCardAndEmpty||null==this.FocusedCard)return!1;var e=!1;if(t==i.KeyPress.Up&&this.FocusedCard.Card!=this.Pile.Bottom&&this.PileMode==h.Layout.FanDown||t==i.KeyPress.Left&&this.FocusedCard.Card!=this.Pile.Bottom&&this.PileMode==h.Layout.FanRight){var n=this.Pile.GetCardPosFromEnd(this.FocusedCard.Card),r=this.Pile.NthFromTop(n+1);null!=r&&(this.FocusedCard=this.SupplyView.GetCardView(r),e=!0)}else if(t==i.KeyPress.Down&&this.FocusedCard.Card!=this.Pile.Top&&this.PileMode==h.Layout.FanDown||t==i.KeyPress.Right&&this.FocusedCard.Card!=this.Pile.Top&&this.PileMode==h.Layout.FanRight){var n=this.Pile.GetCardPosFromEnd(this.FocusedCard.Card),r=this.Pile.NthFromTop(n-1);null!=r&&(this.FocusedCard=this.SupplyView.GetCardView(r),e=!0)}return e}return!1},h}),function(t,e){function i(t,e){this.proParticleCount=i.Util.initValue(t,i.POOL_MAX),this.integrationType=i.Util.initValue(e,i.EULER),this.emitters=[],this.renderers=[],this.time=0,this.oldTime=0,i.pool=new i.ParticlePool(this.proParticleCount),i.integrator=new i.NumericalIntegration(this.integrationType)}function n(){this.initialize()}function r(t){this.type="null",this.particle=null,this.emitter=null,this.particles=[],i.Util.setPrototypeByObject(this,t)}function o(){this.mats=[],this.size=0;for(var t=0;t<20;t++)this.mats.push(i.Mat3.create([0,0,0,0,0,0,0,0,0]))}function a(t){this.id="particle_"+a.ID++,this.reset(!0),i.Util.setPrototypeByObject(this,t)}function s(t,e){this.proParticleCount=i.Util.initValue(t,0),this.releaseTime=i.Util.initValue(e,-1),this.poolList=[],this.timeoutID=0;for(var n=0;n<this.proParticleCount;n++)this.add();this.releaseTime>0&&(this.timeoutID=setTimeout(this.release,this.releaseTime/1e3))}function l(t,e,n){this.isArray=!1,i.Util.isArray(t)?(this.isArray=!0,this.a=t):(this.a=i.Util.initValue(t,1),this.b=i.Util.initValue(e,this.a),this.center=i.Util.initValue(n,!1))}function h(t){i.Util.isArray(t)?this.colorArr=t:this.colorArr=[t]}function u(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.bottom=this.y+this.height,this.right=this.x+this.width}function d(t,e){this.id="Behaviour_"+d.id++,this.life=i.Util.initValue(t,1/0),this.easing=i.ease.setEasingByName(e),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.name="Behaviour"}function c(t,e){this.numPan=i.Util.initValue(t,1),this.timePan=i.Util.initValue(e,1),this.numPan=i.Util.setSpanValue(this.numPan),this.timePan=i.Util.setSpanValue(this.timePan),this.startTime=0,this.nextTime=0,this.init()}function p(){}function g(t,e,n){g._super_.call(this),this.lifePan=i.Util.setSpanValue(t,e,n)}function f(t){f._super_.call(this),this.zone=i.Util.initValue(t,new i.PointZone)}function y(t,e,n){y._super_.call(this),this.rPan=i.Util.setSpanValue(t),this.thaPan=i.Util.setSpanValue(e),this.type=i.Util.initValue(n,"vector")}function m(t,e,n){m._super_.call(this),this.massPan=i.Util.setSpanValue(t,e,n)}function C(t,e,n){C._super_.call(this),this.radius=i.Util.setSpanValue(t,e,n)}function S(t,e,n){S._super_.call(this),this.image=this.setSpanValue(t),this.w=i.Util.initValue(e,20),this.h=i.Util.initValue(n,this.w)}function b(t,e,n,r){b._super_.call(this,n,r),this.force=this.normalizeForce(new i.Vector2D(t,e)),this.name="Force"}function v(t,e,n,r,o){v._super_.call(this,r,o),this.targetPosition=i.Util.initValue(t,new i.Vector2D),this.radius=i.Util.initValue(n,1e3),this.force=i.Util.initValue(this.normalizeValue(e),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new i.Vector2D,this.lengthSq=0,this.name="Attraction"}function w(t,e,i,n,r){w._super_.call(this,n,r),this.reset(t,e,i),this.time=0,this.name="RandomDrift"}function x(t,e,i,n,r){x._super_.call(this,t,e,i,n,r),this.force*=-1,this.name="Repulsion"}function T(t,e,i){T._super_.call(this,0,t,e,i),this.name="Gravity"}function M(t,e,i,n,r){M._super_.call(this,n,r),this.reset(t,e,i),this.name="Collision"}function _(t,e,i,n){_._super_.call(this,i,n),this.reset(t,e),this.name="CrossZone"}function P(t,e,i,n){P._super_.call(this,i,n),this.reset(t,e),this.name="Alpha"}function A(t,e,i,n){A._super_.call(this,i,n),this.reset(t,e),this.name="Scale"}function k(t,e,i,n,r){k._super_.call(this,n,r),this.reset(t,e,i),this.name="Rotate"}function D(t,e,i,n){D._super_.call(this,i,n),this.reset(t,e),this.name="Color"}function F(t,e,n,r){F._super_.call(this,n,r),this.distanceVec=new i.Vector2D,this.centerPoint=i.Util.initValue(t,new i.Vector2D),this.force=i.Util.initValue(this.normalizeValue(e),100),this.name="GravityWell"}function E(t){this.initializes=[],this.particles=[],this.behaviours=[],this.emitTime=0,this.emitTotalTimes=-1,this.damping=.006,this.bindEmitter=!0,this.rate=new i.Rate(1,.1),E._super_.call(this,t),this.id="emitter_"+E.ID++}function I(t){this.selfBehaviours=[],I._super_.call(this,t)}function G(e,n,r){this.mouseTarget=i.Util.initValue(e,t),this.ease=i.Util.initValue(n,.7),this._allowEmitting=!1,this.initEventHandler(),G._super_.call(this,r)}function O(t,e,n){this.element=n,this.type=i.Util.initValue(t,"canvas"),this.proton=e,this.renderer=this.getRenderer()}function B(t,e,i){this.proton=t,this.element=e,this.stroke=i}function L(t,e){L._super_.call(this,t,e),this.stroke=null}function R(t,e,i){R._super_.call(this,t,e),this.stroke=i}function N(t,e){N._super_.call(this,t,e),this.stroke=null,this.context=this.element.getContext("2d"),this.bufferCache={}}function U(t,e,i){U._super_.call(this,t,e),this.context=this.element.getContext("2d"),this.imageData=null,this.rectangle=null,this.rectangle=i,this.createImageData(i)}function V(t,e){V._super_.call(this,t,e),this.gl=this.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),this.gl||alert("Sorry your browser do not suppest WebGL!"),this.initVar(),this.setMaxRadius(),this.initShaders(),this.initBuffers(),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND)}function H(){this.vector=new i.Vector2D(0,0),this.random=0,this.crossType="dead",this.alert=!0}function W(t,e,n,r,o){W._super_.call(this),n-t>=0?(this.x1=t,this.y1=e,this.x2=n,this.y2=r):(this.x1=n,this.y1=r,this.x2=t,this.y2=e),this.dx=this.x2-this.x1,this.dy=this.y2-this.y1,this.minx=Math.min(this.x1,this.x2),this.miny=Math.min(this.y1,this.y2),this.maxx=Math.max(this.x1,this.x2),this.maxy=Math.max(this.y1,this.y2),this.dot=this.x2*this.y1-this.x1*this.y2,this.xxyy=this.dx*this.dx+this.dy*this.dy,this.gradient=this.getGradient(),this.length=this.getLength(),this.direction=i.Util.initValue(o,">")}function K(t,e,i){K._super_.call(this),this.x=t,this.y=e,this.radius=i,this.angle=0,this.center={x:this.x,y:this.y}}function z(t,e){z._super_.call(this),this.x=t,this.y=e}function j(t,e,i,n){j._super_.call(this),this.x=t,this.y=e,this.width=i,this.height=n}function Y(t,e,i,n){Y._super_.call(this),this.reset(t,e,i,n)}i.POOL_MAX=1e3,i.TIME_STEP=60,i.MEASURE=100,i.EULER="euler",i.RK2="runge-kutta2",i.RK4="runge-kutta4",i.VERLET="verlet",i.PARTICLE_CREATED="partilcleCreated",i.PARTICLE_UPDATE="partilcleUpdate",i.PARTICLE_SLEEP="particleSleep",i.PARTICLE_DEAD="partilcleDead",i.PROTON_UPDATE="protonUpdate",i.PROTON_UPDATE_AFTER="protonUpdateAfter",i.EMITTER_ADDED="emitterAdded",i.EMITTER_REMOVED="emitterRemoved",i.amendChangeTabsBug=!0,i.TextureBuffer={},i.TextureCanvasBuffer={},i.prototype={addRender:function(t){t.proton=this,this.renderers.push(t.proton)},addEmitter:function(t){this.emitters.push(t),t.parent=this,this.dispatchEvent(new i.Event({type:i.EMITTER_ADDED,emitter:t}))},removeEmitter:function(t){var e=this.emitters.indexOf(t);this.emitters.splice(e,1),t.parent=null,this.dispatchEvent(new i.Event({type:i.EMITTER_REMOVED,emitter:t}))},update:function(){this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE})),this.oldTime||(this.oldTime=(new Date).getTime());var t=(new Date).getTime();if(this.elapsed=(t-this.oldTime)/1e3,i.amendChangeTabsBug&&this.amendChangeTabsBug(),this.oldTime=t,this.elapsed>0)for(var e=0;e<this.emitters.length;e++)this.emitters[e].update(this.elapsed);this.dispatchEvent(new i.Event({type:i.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){this.elapsed>.5&&(this.oldTime=(new Date).getTime(),this.elapsed=0)},getParticleNumber:function(){for(var t=0,e=0;e<this.emitters.length;e++)t+=this.emitters[e].particles.length;return t},destory:function(){for(var t=0;t<this.emitters.length;t++)this.emitters[t].destory(),delete this.emitters[t]
;this.emitters=[],this.time=0,this.oldTime=0,i.pool.release()}},t.Proton=i;var X=n.prototype;n.initialize=function(t){t.addEventListener=X.addEventListener,t.removeEventListener=X.removeEventListener,t.removeAllEventListeners=X.removeAllEventListeners,t.hasEventListener=X.hasEventListener,t.dispatchEvent=X.dispatchEvent},X._listeners=null,X.initialize=function(){},X.addEventListener=function(t,e){var i=this._listeners;i?this.removeEventListener(t,e):i=this._listeners={};var n=i[t];return n||(n=i[t]=[]),n.push(e),e},X.removeEventListener=function(t,e){var i=this._listeners;if(i){var n=i[t];if(n)for(var r=0,o=n.length;r<o;r++)if(n[r]==e){1==o?delete i[t]:n.splice(r,1);break}}},X.removeAllEventListeners=function(t){t?this._listeners&&delete this._listeners[t]:this._listeners=null},X.dispatchEvent=function(t,e){var i=!1,n=this._listeners;if(t&&n){"string"==typeof t&&(t={type:t});var r=n[t.type];if(!r)return i;t.target=e||this,r=r.slice();for(var o=0,a=r.length;o<a;o++){var s=r[o];i=s.handleEvent?i||s.handleEvent(t):i||s(t)}}return!!i},X.hasEventListener=function(t){var e=this._listeners;return!(!e||!e[t])},i.EventDispatcher=n,i.EventDispatcher.initialize(i.prototype),r.PARTICLE_CREATED=i.PARTICLE_CREATED,r.PARTICLE_UPDATA=i.PARTICLE_UPDATA,r.PARTICLE_SLEEP=i.PARTICLE_SLEEP,r.PARTICLE_DEAD=i.PARTICLE_DEAD,i.Event=r;var q=q||{initValue:function(t,e){var t=null!=t&&void 0!=t?t:e;return t},isArray:function(t){return"object"==typeof t&&t.hasOwnProperty("length")},destroyArray:function(t){t.length=0},destroyObject:function(t){for(var e in t)delete t[e]},getVector2D:function(t,e){return"object"==typeof t?t:new i.Vector2D(t,e)},judgeVector2D:function(t){var e="";return(t.hasOwnProperty("x")||t.hasOwnProperty("y")||t.hasOwnProperty("p")||t.hasOwnProperty("position"))&&(e+="p"),(t.hasOwnProperty("vx")||t.hasOwnProperty("vx")||t.hasOwnProperty("v")||t.hasOwnProperty("velocity"))&&(e+="v"),(t.hasOwnProperty("ax")||t.hasOwnProperty("ax")||t.hasOwnProperty("a")||t.hasOwnProperty("accelerate"))&&(e+="a"),e},setVector2DByObject:function(t,e){e.hasOwnProperty("x")&&(t.p.x=e.x),e.hasOwnProperty("y")&&(t.p.y=e.y),e.hasOwnProperty("vx")&&(t.v.x=e.vx),e.hasOwnProperty("vy")&&(t.v.y=e.vy),e.hasOwnProperty("ax")&&(t.a.x=e.ax),e.hasOwnProperty("ay")&&(t.a.y=e.ay),e.hasOwnProperty("p")&&particle.p.copy(e.p),e.hasOwnProperty("v")&&particle.v.copy(e.v),e.hasOwnProperty("a")&&particle.a.copy(e.a),e.hasOwnProperty("position")&&particle.p.copy(e.position),e.hasOwnProperty("velocity")&&particle.v.copy(e.velocity),e.hasOwnProperty("accelerate")&&particle.a.copy(e.accelerate)},addPrototypeByObject:function(t,e,n){for(var r in e)n?n.indexOf(r)<0&&(t[r]=i.Util.getSpanValue(e[r])):t[r]=i.Util.getSpanValue(e[r]);return t},setPrototypeByObject:function(t,e,n){for(var r in e)t.hasOwnProperty(r)&&(n?n.indexOf(r)<0&&(t[r]=i.Util.getSpanValue(e[r])):t[r]=i.Util.getSpanValue(e[r]));return t},setSpanValue:function(t,e,n){return t instanceof i.Span?t:e?n?new i.Span(t,e,n):new i.Span(t,e):new i.Span(t)},getSpanValue:function(t){return t instanceof i.Span?t.getValue():t},inherits:function(t,e){if(t._super_=e,Object.create)t.prototype=Object.create(e.prototype,{constructor:{value:e}});else{var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},getImageData:function(t,e,i){t.drawImage(e,i.x,i.y);var n=t.getImageData(i.x,i.y,i.width,i.height);return t.clearRect(i.x,i.y,i.width,i.height),n},getImage:function(t,e,i,n){"string"==typeof t?this.loadAndSetImage(t,e,i,n):"object"==typeof t?this.loadAndSetImage(t.src,e,i,n):t instanceof Image&&this.loadedImage(t.src,e,i,n,t)},loadedImage:function(t,e,n,r,o){if(e.target=o,e.transform.src=t,i.TextureBuffer[t]||(i.TextureBuffer[t]=e.target),n)if(i.TextureCanvasBuffer[t])e.transform.canvas=i.TextureCanvasBuffer[t];else{var a=i.WebGLUtil.nhpot(e.target.width),s=i.WebGLUtil.nhpot(e.target.height);e.transform.canvas=i.DomUtil.createCanvas("canvas"+t,a,s);var l=e.transform.canvas.getContext("2d");l.drawImage(e.target,0,0,e.target.width,e.target.height),i.TextureCanvasBuffer[t]=e.transform.canvas}r&&r(e)},loadAndSetImage:function(t,e,n,r){if(i.TextureBuffer[t])this.loadedImage(t,e,n,r,i.TextureBuffer[t]);else{var o=this,a=new Image;a.onload=function(i){o.loadedImage(t,e,n,r,i.target)},a.src=t}},hexToRGB:function(t){var e="#"==t.charAt(0)?t.substring(1,7):t;return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}},rgbToHex:function(t){return"rgb("+t.r+", "+t.g+", "+t.b+")"}};i.Util=q;var Z=Z||{ipot:function(t){return 0==(t&t-1)},nhpot:function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},makeTranslation:function(t,e){return[1,0,0,0,1,0,t,e,1]},makeRotation:function(t){var e=Math.cos(t),i=Math.sin(t);return[e,-i,0,i,e,0,0,0,1]},makeScale:function(t,e){return[t,0,0,0,e,0,0,0,1]},matrixMultiply:function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],h=t[7],u=t[8],d=e[0],c=e[1],p=e[2],g=e[3],f=e[4],y=e[5],m=e[6],C=e[7],S=e[8];return[i*d+n*g+r*m,i*c+n*f+r*C,i*p+n*y+r*S,o*d+a*g+s*m,o*c+a*f+s*C,o*p+a*y+s*S,l*d+h*g+u*m,l*c+h*f+u*C,l*p+h*y+u*S]}};i.WebGLUtil=Z;var J=J||{createCanvas:function(t,e,i,n){var r=document.createElement("canvas"),o=n||"absolute";return r.id=t,r.width=e,r.height=i,r.style.position=o,r},transformDom:function(t,e,i,n,r){t.style.WebkitTransform="translate("+e+"px, "+i+"px) scale("+n+") rotate("+r+"deg)",t.style.MozTransform="translate("+e+"px, "+i+"px) scale("+n+") rotate("+r+"deg)",t.style.OTransform="translate("+e+"px, "+i+"px) scale("+n+") rotate("+r+"deg)",t.style.msTransform="translate("+e+"px, "+i+"px) scale("+n+") rotate("+r+"deg)",t.style.transform="translate("+e+"px, "+i+"px) scale("+n+") rotate("+r+"deg)"}};i.DomUtil=J,o.prototype.set=function(t,e){0==e?i.Mat3.set(t,this.mats[0]):i.Mat3.multiply(this.mats[e-1],t,this.mats[e]),this.size=Math.max(this.size,e+1)},o.prototype.push=function(t){0==this.size?i.Mat3.set(t,this.mats[0]):i.Mat3.multiply(this.mats[this.size-1],t,this.mats[this.size]),this.size++},o.prototype.pop=function(){this.size>0&&this.size--},o.prototype.top=function(){return this.mats[this.size-1]},i.MStack=o,a.ID=0,a.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(t){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.target=null,this.sprite=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.easing=i.ease.setEasingByName(i.easeLinear),t?(this.transform={},this.p=new i.Vector2D,this.v=new i.Vector2D,this.a=new i.Vector2D,this.old={p:new i.Vector2D,v:new i.Vector2D,a:new i.Vector2D},this.behaviours=[]):(i.Util.destroyObject(this.transform),this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.removeAllBehaviours()),this.transform.rgb={r:255,g:255,b:255},this},update:function(t,e){if(!this.sleep){this.age+=t;var i,n=this.behaviours.length;for(i=0;i<n;i++)this.behaviours[i]&&this.behaviours[i].applyBehaviour(this,t,e)}if(this.age>=this.life)this.destory();else{var r=this.easing(this.age/this.life);this.energy=Math.max(1-r,0)}},addBehaviour:function(t){this.behaviours.push(t),t.hasOwnProperty("parents")&&t.parents.push(this),t.initialize(this)},addBehaviours:function(t){var e,i=t.length;for(e=0;e<i;e++)this.addBehaviour(t[e])},removeBehaviour:function(t){var e=this.behaviours.indexOf(t);if(e>-1){var t=this.behaviours.splice(e,1);t.parents=null}},removeAllBehaviours:function(){i.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}},i.Particle=a,s.prototype={create:function(t){return t?new newTypeParticle:new i.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){return 0===this.poolList.length?this.create():this.poolList.pop().reset()},set:function(t){if(this.poolList.length<i.POOL_MAX)return this.poolList.push(t)},release:function(){for(var t=0;t<this.poolList.length;t++)this.poolList[t].destory&&this.poolList[t].destory(),delete this.poolList[t];this.poolList=[]}},i.ParticlePool=s;var Q={randomAToB:function(t,e,i){return i?Math.floor(Math.random()*(e-t))+t:t+Math.random()*(e-t)},randomFloating:function(t,e,i){return Q.randomAToB(t-e,t+e,i)},randomZone:function(t){},degreeTransform:function(t){return t*Math.PI/180},toColor16:function(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)}};i.MathUtils=Q;var $=function(t){this.type=i.Util.initValue(t,i.EULER)};$.prototype={integrate:function(t,e,i){this.eulerIntegrate(t,e,i)},eulerIntegrate:function(t,e,i){t.sleep||(t.old.p.copy(t.p),t.old.v.copy(t.v),t.a.multiplyScalar(1/t.mass),t.v.add(t.a.multiplyScalar(e)),t.p.add(t.old.v.multiplyScalar(e)),i&&t.v.multiplyScalar(i),t.a.clear())}},i.NumericalIntegration=$;var tt=function(t,e){this.x=t||0,this.y=e||0};tt.prototype={set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getGradient:function(){return 0!=this.x?Math.atan2(this.y,this.x):this.y>0?Math.PI/2:this.y<0?-Math.PI/2:void 0},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addXY:function(t,e){return this.x+=t,this.y+=e,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t):this.set(0,0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},rotate:function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)+i*Math.sin(t),this.y=-e*Math.sin(t)+i*Math.cos(t),this},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new i.Vector2D(this.x,this.y)}},i.Vector2D=tt;var et=function(t,e){this.r=Math.abs(t)||0,this.tha=e||0};et.prototype={set:function(t,e){return this.r=t,this.tha=e,this},setR:function(t){return this.r=t,this},setTha:function(t){return this.tha=t,this},copy:function(t){return this.r=t.r,this.tha=t.tha,this},toVector:function(){return new i.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){return this.r=1,this},equals:function(t){return t.r===this.r&&t.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){return this.r=0,this.tha=0,this},clone:function(){return new i.Polar2D(this.r,this.tha)}},i.Polar2D=et,l.prototype={getValue:function(t){return this.isArray?this.a[Math.floor(this.a.length*Math.random())]:this.center?i.MathUtils.randomFloating(this.a,this.b,t):i.MathUtils.randomAToB(this.a,this.b,t)}},i.Span=l,i.getSpan=function(t,e,n){return new i.Span(t,e,n)},i.Util.inherits(h,i.Span),h.prototype.getValue=function(){var t=this.colorArr[Math.floor(this.colorArr.length*Math.random())];return"random"==t||"Random"==t?i.MathUtils.randomColor():t},i.ColorSpan=h,u.prototype={contains:function(t,e){return t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y}},i.Rectangle=u;var it=it||{create:function(t){var e=new Float32Array(9);return t&&this.set(t,e),e},set:function(t,e){for(var i=0;i<9;i++)e[i]=t[i];return e},multiply:function(t,e,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[6],h=t[7],u=e[0],d=e[1],c=e[2],p=e[3],g=e[4],f=e[6],y=e[7];return i[0]=u*n+d*a,i[1]=u*r+d*s,i[2]=o*c,i[3]=p*n+g*a,i[4]=p*r+g*s,i[6]=f*n+y*a+l,i[7]=f*r+y*s+h,i},inverse:function(t,e){var i,n=t[0],r=t[1],o=t[3],a=t[4],s=t[6],l=t[7],h=a,u=-o,d=l*o-a*s,c=n*h+r*u;return i=1/c,e[0]=h*i,e[1]=-r*i,e[3]=u*i,e[4]=n*i,e[6]=d*i,e[7]=(-l*n+r*s)*i,e},multiplyVec2:function(t,e,i){var n=e[0],r=e[1];return i[0]=n*t[0]+r*t[3]+t[6],i[1]=n*t[1]+r*t[4]+t[7],i}};i.Mat3=it,d.id=0,d.prototype={reset:function(t,e){this.life=i.Util.initValue(t,1/0),this.easing=i.Util.initValue(e,i.ease.setEasingByName(i.easeLinear))},normalizeForce:function(t){return t.multiplyScalar(i.MEASURE)},normalizeValue:function(t){return t*i.MEASURE},initialize:function(t){},applyBehaviour:function(t,e,i){if(this.age+=e,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destory();else{var n=this.easing(t.age/t.life);this.energy=Math.max(1-n,0)}},destory:function(){var t,e=this.parents.length;for(t=0;t<e;t++)this.parents[t].removeBehaviour(this);this.parents=[]}},i.Behaviour=d,c.prototype={init:function(){this.startTime=0,this.nextTime=this.timePan.getValue()},getValue:function(t){return this.startTime+=t,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),1==this.numPan.b?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0}},i.Rate=c,p.prototype.reset=function(){},p.prototype.init=function(t,e){e?this.initialize(e):this.initialize(t)},p.prototype.initialize=function(t){},i.Initialize=p;var nt={initialize:function(t,e,n){var r,o=n.length;for(r=0;r<o;r++)n[r]instanceof i.Initialize?n[r].init(t,e):i.InitializeUtil.init(t,e,n[r]);i.InitializeUtil.bindEmitter(t,e)},init:function(t,e,n){i.Util.setPrototypeByObject(e,n),i.Util.setVector2DByObject(e,n)},bindEmitter:function(t,e){t.bindEmitter&&(e.p.add(t.p),e.v.add(t.v),e.a.add(t.a),e.v.rotate(i.MathUtils.degreeTransform(t.rotation)))}};i.InitializeUtil=nt,i.Util.inherits(g,i.Initialize),g.prototype.initialize=function(t){this.lifePan.a==1/0?t.life=1/0:t.life=this.lifePan.getValue()},i.Life=g,i.Util.inherits(f,i.Initialize),f.prototype.reset=function(t){this.zone=i.Util.initValue(t,new i.PointZone)},f.prototype.initialize=function(t){this.zone.getPosition(),t.p.x=this.zone.vector.x,t.p.y=this.zone.vector.y},i.Position=f,i.P=f,i.Util.inherits(y,i.Initialize),y.prototype.reset=function(t,e,n){this.rPan=i.Util.setSpanValue(t),this.thaPan=i.Util.setSpanValue(e),this.type=i.Util.initValue(n,"vector")},y.prototype.normalizeVelocity=function(t){return t*i.MEASURE},y.prototype.initialize=function(t){if("p"==this.type||"P"==this.type||"polar"==this.type){var e=new i.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);t.v.x=e.getX(),t.v.y=e.getY()}else t.v.x=this.normalizeVelocity(this.rPan.getValue()),t.v.y=this.normalizeVelocity(this.thaPan.getValue())},i.Velocity=y,i.V=y,i.Util.inherits(m,i.Initialize),m.prototype.initialize=function(t){t.mass=this.massPan.getValue()},i.Mass=m,i.Util.inherits(C,i.Initialize),C.prototype.reset=function(t,e,n){this.radius=i.Util.setSpanValue(t,e,n)},C.prototype.initialize=function(t){t.radius=this.radius.getValue(),t.transform.oldRadius=t.radius},i.Radius=C,i.Util.inherits(S,i.Initialize),S.prototype.initialize=function(t){var e=this.image.getValue();t.target="string"==typeof e?{width:this.w,height:this.h,src:e}:e},S.prototype.setSpanValue=function(t){return t instanceof i.ColorSpan?t:new i.ColorSpan(t)},i.ImageTarget=S,i.Util.inherits(b,i.Behaviour),b.prototype.reset=function(t,e,n,r){this.force=this.normalizeForce(new i.Vector2D(t,e)),n&&b._super_.prototype.reset.call(this,n,r)},b.prototype.applyBehaviour=function(t,e,i){b._super_.prototype.applyBehaviour.call(this,t,e,i),t.a.add(this.force)},i.Force=b,i.F=b,i.Util.inherits(v,i.Behaviour),v.prototype.reset=function(t,e,n,r,o){this.targetPosition=i.Util.initValue(t,new i.Vector2D),this.radius=i.Util.initValue(n,1e3),this.force=i.Util.initValue(this.normalizeValue(e),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new i.Vector2D,this.lengthSq=0,r&&v._super_.prototype.reset.call(this,r,o)},v.prototype.applyBehaviour=function(t,e,i){v._super_.prototype.applyBehaviour.call(this,t,e,i),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),t.a.add(this.attractionForce))},i.Attraction=v,i.Util.inherits(w,i.Behaviour),w.prototype.reset=function(t,e,n,r,o){this.panFoce=new i.Vector2D(t,e),this.panFoce=this.normalizeForce(this.panFoce),this.delay=n,r&&w._super_.prototype.reset.call(this,r,o)},w.prototype.applyBehaviour=function(t,e,n){w._super_.prototype.applyBehaviour.call(this,t,e,n),this.time+=e,this.time>=this.delay&&(t.a.addXY(i.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),i.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y)),this.time=0)},i.RandomDrift=w,i.Util.inherits(x,i.Attraction),x.prototype.reset=function(t,e,i,n,r){x._super_.prototype.reset.call(this,t,e,i,n,r),this.force*=-1},i.Repulsion=x,i.Util.inherits(T,i.Force),T.prototype.reset=function(t,e,i){T._super_.prototype.reset.call(this,0,t,e,i)},i.Gravity=T,i.G=T,i.Util.inherits(M,i.Behaviour),M.prototype.reset=function(t,e,n,r,o){this.emitter=i.Util.initValue(t,null),this.mass=i.Util.initValue(e,!0),this.callback=i.Util.initValue(n,null),this.collisionPool=[],this.delta=new i.Vector2D,r&&M._super_.prototype.reset.call(this,r,o)},M.prototype.applyBehaviour=function(t,e,i){for(var n,r,o,a,s,l=this.emitter?this.emitter.particles.slice(i):this.pool.slice(i),h=l.length,u=0;u<h;u++)(n=l[u])!==t&&(this.delta.copy(n.p),this.delta.sub(t.p),r=this.delta.lengthSq(),distance=t.radius+n.radius,r<=distance*distance&&(o=distance-Math.sqrt(r),o+=.5,totalMass=t.mass+n.mass,a=this.mass?n.mass/totalMass:.5,s=this.mass?t.mass/totalMass:.5,t.p.add(this.delta.clone().normalize().multiplyScalar(o*-a)),n.p.add(this.delta.normalize().multiplyScalar(o*s)),this.callback&&this.callback(t,n)))},i.Collision=M,i.Util.inherits(_,i.Behaviour),_.prototype.reset=function(t,e,n,r){this.zone=t,this.zone.crossType=i.Util.initValue(e,"dead"),n&&_._super_.prototype.reset.call(this,n,r)},_.prototype.applyBehaviour=function(t,e,i){_._super_.prototype.applyBehaviour.call(this,t,e,i),this.zone.crossing(t)},i.CrossZone=_,i.Util.inherits(P,i.Behaviour),P.prototype.reset=function(t,e,n,r){this.same=null==e||void 0==e,this.a=i.Util.setSpanValue(i.Util.initValue(t,1)),this.b=i.Util.setSpanValue(e),n&&P._super_.prototype.reset.call(this,n,r)},P.prototype.initialize=function(t){t.transform.alphaA=this.a.getValue(),this.same?t.transform.alphaB=t.transform.alphaA:t.transform.alphaB=this.b.getValue()},P.prototype.applyBehaviour=function(t,e,i){P._super_.prototype.applyBehaviour.call(this,t,e,i),t.alpha=t.transform.alphaB+(t.transform.alphaA-t.transform.alphaB)*this.energy,t.alpha<.001&&(t.alpha=0)},i.Alpha=P,i.Util.inherits(A,i.Behaviour),A.prototype.reset=function(t,e,n,r){this.same=null==e||void 0==e,this.a=i.Util.setSpanValue(i.Util.initValue(t,1)),this.b=i.Util.setSpanValue(e),n&&A._super_.prototype.reset.call(this,n,r)},A.prototype.initialize=function(t){t.transform.scaleA=this.a.getValue(),t.transform.oldRadius=t.radius,this.same?t.transform.scaleB=t.transform.scaleA:t.transform.scaleB=this.b.getValue()},A.prototype.applyBehaviour=function(t,e,i){A._super_.prototype.applyBehaviour.call(this,t,e,i),t.scale=t.transform.scaleB+(t.transform.scaleA-t.transform.scaleB)*this.energy,t.scale<1e-4&&(t.scale=0),t.radius=t.transform.oldRadius*t.scale},i.Scale=A,i.Util.inherits(k,i.Behaviour),k.prototype.reset=function(t,e,n,r,o){this.same=null==e||void 0==e,this.a=i.Util.setSpanValue(i.Util.initValue(t,"Velocity")),this.b=i.Util.setSpanValue(i.Util.initValue(e,0)),this.style=i.Util.initValue(n,"to"),r&&k._super_.prototype.reset.call(this,r,o)},k.prototype.initialize=function(t){t.rotation=this.a.getValue(),t.transform.rotationA=this.a.getValue(),this.same||(t.transform.rotationB=this.b.getValue())},k.prototype.applyBehaviour=function(t,e,i){k._super_.prototype.applyBehaviour.call(this,t,e,i),this.same?"V"!=this.a.a&&"Velocity"!=this.a.a&&"v"!=this.a.a||(t.rotation=t.getDirection()):"to"==this.style||"TO"==this.style||"_"==this.style?t.rotation+=t.transform.rotationB+(t.transform.rotationA-t.transform.rotationB)*this.energy:t.rotation+=t.transform.rotationB},i.Rotate=k,i.Util.inherits(D,i.Behaviour),D.prototype.reset=function(t,e,i,n){this.color1=this.setSpanValue(t),this.color2=this.setSpanValue(e),i&&D._super_.prototype.reset.call(this,i,n)},D.prototype.initialize=function(t){t.color=this.color1.getValue(),t.transform.beginRGB=i.Util.hexToRGB(t.color),this.color2&&(t.transform.endRGB=i.Util.hexToRGB(this.color2.getValue()))},D.prototype.applyBehaviour=function(t,e,i){this.color2?(D._super_.prototype.applyBehaviour.call(this,t,e,i),t.transform.rgb.r=t.transform.endRGB.r+(t.transform.beginRGB.r-t.transform.endRGB.r)*this.energy,t.transform.rgb.g=t.transform.endRGB.g+(t.transform.beginRGB.g-t.transform.endRGB.g)*this.energy,t.transform.rgb.b=t.transform.endRGB.b+(t.transform.beginRGB.b-t.transform.endRGB.b)*this.energy,t.transform.rgb.r=parseInt(t.transform.rgb.r,10),t.transform.rgb.g=parseInt(t.transform.rgb.g,10),t.transform.rgb.b=parseInt(t.transform.rgb.b,10)):(t.transform.rgb.r=t.transform.beginRGB.r,t.transform.rgb.g=t.transform.beginRGB.g,t.transform.rgb.b=t.transform.beginRGB.b)},D.prototype.setSpanValue=function(t){return t?t instanceof i.ColorSpan?t:new i.ColorSpan(t):null},i.Color=D,i.Util.inherits(F,i.Behaviour),F.prototype.reset=function(t,e,n,r){this.distanceVec=new i.Vector2D,this.centerPoint=i.Util.initValue(t,new i.Vector2D),this.force=i.Util.initValue(this.normalizeValue(e),100),n&&F._super_.prototype.reset.call(this,n,r)},F.prototype.initialize=function(t){},F.prototype.applyBehaviour=function(t,e,i){this.distanceVec.set(this.centerPoint.x-t.p.x,this.centerPoint.y-t.p.y);var n=this.distanceVec.lengthSq();if(0!=n){var r=this.distanceVec.length(),o=this.force*e/(n*r);t.v.x+=o*this.distanceVec.x,t.v.y+=o*this.distanceVec.y}},i.GravityWell=F,E.ID=0,i.Util.inherits(E,i.Particle),i.EventDispatcher.initialize(E.prototype),E.prototype.emit=function(t,e){this.emitTime=0,this.emitTotalTimes=i.Util.initValue(t,1/0),1==e||"life"==e||"destroy"==e?this.life="once"==t?1:this.emitTotalTimes:isNaN(e)||(this.life=e),this.rate.init()},E.prototype.stopEmit=function(){this.emitTotalTimes=-1,this.emitTime=0},E.prototype.removeAllParticles=function(){for(var t=0;t<this.particles.length;t++)this.particles[t].dead=!0},E.prototype.createParticle=function(t,e){var n=i.pool.get();return this.setupParticle(n,t,e),this.dispatchEvent(new i.Event({type:i.PARTICLE_CREATED,particle:n})),n},E.prototype.addSelfInitialize=function(t){t.init?t.init(this):this.initAll()},E.prototype.addInitialize=function(){var t,e=arguments.length;for(t=0;t<e;t++)this.initializes.push(arguments[t])},E.prototype.removeInitialize=function(t){var e=this.initializes.indexOf(t);e>-1&&this.initializes.splice(e,1)},E.prototype.removeInitializers=function(){i.Util.destroyArray(this.initializes)},E.prototype.addBehaviour=function(){var t,e=arguments.length;for(t=0;t<e;t++)this.behaviours.push(arguments[t]),arguments[t].hasOwnProperty("parents")&&arguments[t].parents.push(this)},E.prototype.removeBehaviour=function(t){var e=this.behaviours.indexOf(t);e>-1&&this.behaviours.splice(e,1)},E.prototype.removeAllBehaviours=function(){i.Util.destroyArray(this.behaviours)},E.prototype.integrate=function(t){var e=1-this.damping;i.integrator.integrate(this,t,e);var n,r=this.particles.length;for(n=0;n<r;n++){var o=this.particles[n];o.update(t,n),i.integrator.integrate(o,t,e),this.dispatchEvent(new i.Event({type:i.PARTICLE_UPDATE,particle:o}))}},E.prototype.emitting=function(t){if("once"==this.emitTotalTimes){var e,i=this.rate.getValue(99999);for(e=0;e<i;e++)this.createParticle();this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)&&(this.emitTime+=t,this.emitTime<this.emitTotalTimes)){var e,i=this.rate.getValue(t);for(e=0;e<i;e++)this.createParticle()}},E.prototype.update=function(t){this.age+=t,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(t),this.integrate(t);var e,n,r=this.particles.length;for(n=r-1;n>=0;n--)e=this.particles[n],e.dead&&(i.pool.set(e),this.particles.splice(n,1),this.dispatchEvent(new i.Event({type:i.PARTICLE_DEAD,particle:e})))},E.prototype.setupParticle=function(t,e,n){var r=this.initializes,o=this.behaviours;e&&(r=e instanceof Array?e:[e]),n&&(o=n instanceof Array?n:[n]),i.InitializeUtil.initialize(this,t,r),t.addBehaviours(o),t.parent=this,this.particles.push(t)},E.prototype.destroy=function(){this.dead=!0,this.emitTotalTimes=-1,0==this.particles.length&&(this.removeInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this))},i.Emitter=E,i.Util.inherits(I,i.Emitter),I.prototype.addSelfBehaviour=function(){var t,e=arguments.length;for(t=0;t<e;t++)this.selfBehaviours.push(arguments[t])},I.prototype.removeSelfBehaviour=function(t){var e=this.selfBehaviours.indexOf(t);e>-1&&this.selfBehaviours.splice(e,1)},I.prototype.update=function(t){if(I._super_.prototype.update.call(this,t),!this.sleep){var e,i=this.selfBehaviours.length;for(e=0;e<i;e++)this.selfBehaviours[e].applyBehaviour(this,t,e)}},i.BehaviourEmitter=I,i.Util.inherits(G,i.Emitter),G.prototype.initEventHandler=function(){var t=this;this.mousemoveHandler=function(e){t.mousemove.call(t,e)},this.mousedownHandler=function(e){t.mousedown.call(t,e)},this.mouseupHandler=function(e){t.mouseup.call(t,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},G.prototype.emit=function(){this._allowEmitting=!0},G.prototype.stopEmit=function(){this._allowEmitting=!1},G.prototype.mousemove=function(t){t.layerX||0==t.layerX?(this.p.x+=(t.layerX-this.p.x)*this.ease,this.p.y+=(t.layerY-this.p.y)*this.ease):(t.offsetX||0==t.offsetX)&&(this.p.x+=(t.offsetX-this.p.x)*this.ease,this.p.y+=(t.offsetY-this.p.y)*this.ease),this._allowEmitting&&G._super_.prototype.emit.call(this,"once")},G.prototype.destroy=function(){G._super_.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},i.FollowEmitter=G;var rt=rt||{easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return 1-Math.cos(t*(Math.PI/2))},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},setEasingByName:function(t){switch(t){case"easeLinear":return i.ease.easeLinear;case"easeInQuad":return i.ease.easeInQuad;case"easeOutQuad":return i.ease.easeOutQuad;case"easeInOutQuad":return i.ease.easeInOutQuad;case"easeInCubic":return i.ease.easeInCubic;case"easeOutCubic":return i.ease.easeOutCubic;case"easeInOutCubic":return i.ease.easeInOutCubic;case"easeInQuart":return i.ease.easeInQuart;case"easeOutQuart":return i.ease.easeOutQuart;case"easeInOutQuart":return i.ease.easeInOutQuart;case"easeInSine":return i.ease.easeInSine;case"easeOutSine":return i.ease.easeOutSine;case"easeInOutSine":return i.ease.easeInOutSine;case"easeInExpo":return i.ease.easeInExpo;case"easeOutExpo":return i.ease.easeOutExpo;case"easeInOutExpo":return i.ease.easeInOutExpo;case"easeInCirc":return i.ease.easeInCirc;case"easeOutCirc":return i.ease.easeOutCirc;case"easeInOutCirc":return i.ease.easeInOutCirc;case"easeInBack":return i.ease.easeInBack;case"easeOutBack":return i.ease.easeOutBack;case"easeInOutBack":return i.ease.easeInOutBack;default:return i.ease.easeLinear}}};i.ease=rt,i.easeLinear="easeLinear",i.easeInQuad="easeInQuad",i.easeOutQuad="easeOutQuad",i.easeInOutQuad="easeInOutQuad",i.easeInCubic="easeInCubic",i.easeOutCubic="easeOutCubic",i.easeInOutCubic="easeInOutCubic",i.easeInQuart="easeInQuart",i.easeOutQuart="easeOutQuart",i.easeInOutQuart="easeInOutQuart",i.easeInSine="easeInSine",i.easeOutSine="easeOutSine",i.easeInOutSine="easeInOutSine",i.easeInExpo="easeInExpo",i.easeOutExpo="easeOutExpo",i.easeInOutExpo="easeInOutExpo",i.easeInCirc="easeInCirc",i.easeOutCirc="easeOutCirc",i.easeInOutCirc="easeInOutCirc",i.easeInBack="easeInBack",i.easeOutBack="easeOutBack",i.easeInOutBack="easeInOutBack",O.prototype={start:function(){this.addEventHandler(),this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(t,e){this.renderer.resize(t,e)},setStroke:function(t,e){this.renderer.hasOwnProperty("stroke")?this.renderer.setStroke(t,e):alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(t){this.renderer instanceof i.PixelRender&&this.renderer.createImageData(t)},setMaxRadius:function(t){this.renderer instanceof i.WebGLRender&&this.renderer.setMaxRadius(t)},blendEquation:function(t){this.renderer instanceof i.WebGLRender&&this.renderer.blendEquation(t)},blendFunc:function(t,e){this.renderer instanceof i.WebGLRender&&this.renderer.blendFunc(t,e)},setType:function(t){this.type=t,this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new i.DomRender(this.proton,this.element);case"canvas":return new i.CanvasRender(this.proton,this.element);case"webgl":return new i.WebGLRender(this.proton,this.element);case"easel":case"easeljs":return new i.EaselRender(this.proton,this.element);case"pixel":return new i.PixelRender(this.proton,this.element);default:return new i.BaseRender(this.proton,this.element)}},render:function(t){this.renderer.render(t)},addEventHandler:function(){this.onProtonUpdate&&(this.renderer.onProtonUpdate=this.onProtonUpdate),this.onParticleCreated&&(this.renderer.onParticleCreated=this.onParticleCreated),this.onParticleUpdate&&(this.renderer.onParticleUpdate=this.onParticleUpdate),this.onParticleDead&&(this.renderer.onParticleDead=this.onParticleDead)}},
i.Renderer=O,B.prototype={start:function(){var t=this;this.proton.addEventListener(i.PROTON_UPDATE,function(e){t.onProtonUpdate.call(t)}),this.proton.addEventListener(i.PROTON_UPDATE_AFTER,function(e){t.onProtonUpdateAfter.call(t)}),this.proton.addEventListener(i.EMITTER_ADDED,function(e){t.onEmitterAdded.call(t,e.emitter)}),this.proton.addEventListener(i.EMITTER_REMOVED,function(e){t.onEmitterRemoved.call(t,e.emitter)});var e,n=this.proton.emitters.length;for(e=0;e<n;e++){var r=this.proton.emitters[e];this.addEmitterListener(r)}},resize:function(t,e){},addEmitterListener:function(t){var e=this;t.addEventListener(i.PARTICLE_CREATED,function(t){e.onParticleCreated.call(e,t.particle)}),t.addEventListener(i.PARTICLE_UPDATE,function(t){e.onParticleUpdate.call(e,t.particle)}),t.addEventListener(i.PARTICLE_DEAD,function(t){e.onParticleDead.call(e,t.particle)})},stop:function(){var t,e=this.proton.emitters.length;for(this.proton.removeAllEventListeners(),t=0;t<e;t++){this.proton.emitters[t].removeAllEventListeners()}},onEmitterAdded:function(t){this.addEmitterListener(t)},onEmitterRemoved:function(t){t.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(t){},onParticleUpdate:function(t){},onParticleDead:function(t){}},i.BaseRender=B,i.Util.inherits(L,i.BaseRender),L.prototype.start=function(){L._super_.prototype.start.call(this)},L.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000"),e=i.Util.initValue(e,1),this.stroke={color:t,thinkness:e}},L.prototype.onProtonUpdate=function(){},L.prototype.onParticleCreated=function(t){if(t.target){var e=this;i.Util.getImage(t.target,t,!1,function(t){e.setImgInDIV.call(e,t)})}else t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.radius+1,t.radius+1,"absolute"),t.transform.bakOldRadius=t.radius,this.stroke?(t.transform.canvas.width=2*t.radius+2*this.stroke.thinkness,t.transform.canvas.height=2*t.radius+2*this.stroke.thinkness):(t.transform.canvas.width=2*t.radius+1,t.transform.canvas.height=2*t.radius+1),t.transform.context=t.transform.canvas.getContext("2d"),t.transform.context.fillStyle=t.color,t.transform.context.beginPath(),t.transform.context.arc(t.radius,t.radius,t.radius,0,2*Math.PI,!0),this.stroke&&(t.transform.context.strokeStyle=this.stroke.color,t.transform.context.lineWidth=this.stroke.thinkness,t.transform.context.stroke()),t.transform.context.closePath(),t.transform.context.fill(),this.element.appendChild(t.transform.canvas)},L.prototype.onParticleUpdate=function(t){t.target?t.target instanceof Image&&(t.transform.canvas.style.opacity=t.alpha,i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.target.width/2,t.p.y-t.target.height/2,t.scale,t.rotation)):(t.transform.canvas.style.opacity=t.alpha,t.transform.oldRadius?i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.oldRadius,t.p.y-t.transform.oldRadius,t.scale,t.rotation):i.DomUtil.transformDom(t.transform.canvas,t.p.x-t.transform.bakOldRadius,t.p.y-t.transform.bakOldRadius,t.scale,t.rotation))},L.prototype.onParticleDead=function(t){t.transform.canvas&&this.element.removeChild(t.transform.canvas)},L.prototype.setImgInDIV=function(t){t.transform.canvas=i.DomUtil.createCanvas(t.id+"_canvas",t.target.width+1,t.target.height+1,"absolute",t.p.x-t.radius,t.p.y-t.radius),t.transform.context=t.transform.canvas.getContext("2d"),t.transform.context.drawImage(t.target,0,0,t.target.width,t.target.height),this.element.appendChild(t.transform.canvas)},i.DomRender=L,i.Util.inherits(R,i.BaseRender),R.prototype.resize=function(t,e){},R.prototype.start=function(){R._super_.prototype.start.call(this)},R.prototype.onProtonUpdate=function(){},R.prototype.onParticleCreated=function(t){if(t.target)t.target=t.target.clone(),t.target.parent||(t.target.image&&(t.target.regX=t.target.image.width/2,t.target.regY=t.target.image.height/2),this.element.addChild(t.target));else{var e=new createjs.Graphics;this.stroke&&(1==this.stroke?e.beginStroke("#000000"):this.stroke instanceof String&&e.beginStroke(this.stroke)),e.beginFill(t.color).drawCircle(0,0,t.radius);var i=new createjs.Shape(e);t.target=i,this.element.addChild(t.target)}},R.prototype.onParticleUpdate=function(t){t.target&&(t.target.x=t.p.x,t.target.y=t.p.y,t.target.alpha=t.alpha,t.target.scaleX=t.target.scaleY=t.scale,t.target.rotation=t.rotation)},R.prototype.onParticleDead=function(t){t.target&&t.target.parent&&t.target.parent.removeChild(t.target)},i.EaselRender=R,i.Util.inherits(N,i.BaseRender),N.prototype.resize=function(t,e){this.element.width=t,this.element.height=e},N.prototype.start=function(){N._super_.prototype.start.call(this)},N.prototype.setStroke=function(t,e){t=i.Util.initValue(t,"#000000"),e=i.Util.initValue(e,1),this.stroke={color:t,thinkness:e}},N.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},N.prototype.onParticleCreated=function(t){t.target?i.Util.getImage(t.target,t,!1):t.color=t.color?t.color:"#ff0000"},N.prototype.onParticleUpdate=function(t){if(t.target){if(t.target instanceof Image){var e=t.target.width*t.scale|0,n=t.target.height*t.scale|0,r=t.p.x-e/2,o=t.p.y-n/2;if(t.color){t.transform.buffer||(t.transform.buffer=this.getBuffer(t.target));var a=t.transform.buffer.getContext("2d");a.clearRect(0,0,t.transform.buffer.width,t.transform.buffer.height),a.globalAlpha=t.alpha,a.drawImage(t.target,0,0),a.globalCompositeOperation="source-atop",a.fillStyle=i.Util.rgbToHex(t.transform.rgb),a.fillRect(0,0,t.transform.buffer.width,t.transform.buffer.height),a.globalCompositeOperation="source-over",a.globalAlpha=1,this.context.drawImage(t.transform.buffer,0,0,t.transform.buffer.width,t.transform.buffer.height,r,o,e,n)}else this.context.save(),this.context.globalAlpha=t.alpha,this.context.translate(t.p.x,t.p.y),this.context.rotate(i.MathUtils.degreeTransform(t.rotation)),this.context.translate(-t.p.x,-t.p.y),this.context.drawImage(t.target,0,0,t.target.width,t.target.height,r,o,e,n),this.context.globalAlpha=1,this.context.restore()}}else t.transform.rgb?this.context.fillStyle="rgba("+t.transform.rgb.r+","+t.transform.rgb.g+","+t.transform.rgb.b+","+t.alpha+")":this.context.fillStyle=t.color,this.context.beginPath(),this.context.arc(t.p.x,t.p.y,t.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},N.prototype.onParticleDead=function(t){},N.prototype.getBuffer=function(t){if(t instanceof Image){var e=t.width+"_"+t.height,i=this.bufferCache[e];return i||(i=document.createElement("canvas"),i.width=t.width,i.height=t.height,this.bufferCache[e]=i),i}},i.CanvasRender=N,i.Util.inherits(U,i.BaseRender),U.prototype.resize=function(t,e){this.element.width=t,this.element.height=e},U.prototype.createImageData=function(t){this.rectangle=t||new i.Rectangle(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},U.prototype.start=function(){U._super_.prototype.start.call(this)},U.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},U.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},U.prototype.onParticleCreated=function(t){},U.prototype.onParticleUpdate=function(t){this.imageData&&this.setPixel(this.imageData,Math.floor(t.p.x-this.rectangle.x),Math.floor(t.p.y-this.rectangle.y),t)},U.prototype.setPixel=function(t,e,i,n){var r=n.transform.rgb;if(!(e<0||e>this.element.width||i<0||i>this.elementwidth)){var o=4*((i>>0)*t.width+(e>>0));t.data[o]=r.r,t.data[o+1]=r.g,t.data[o+2]=r.b,t.data[o+3]=255*n.alpha}},U.prototype.onParticleDead=function(t){},i.PixelRender=U,i.Util.inherits(V,i.BaseRender),V.prototype.resize=function(t,e){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/t,this.smat[4]=1/e,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,t,e),this.element.width=t,this.element.height=e},V.prototype.setMaxRadius=function(t){this.circleCanvasURL=this.createCircle(t)},V.prototype.getVertexShader=function(){return["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n")},V.prototype.getFragmentShader=function(){return["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n")},V.prototype.initVar=function(){this.mstack=new i.MStack,this.umat=i.Mat3.create([2,0,1,0,-2,0,-1,1,1]),this.smat=i.Mat3.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},V.prototype.start=function(){V._super_.prototype.start.call(this),this.resize(this.element.width,this.element.height)},V.prototype.blendEquation=function(t){this.gl.blendEquation(this.gl[t])},V.prototype.blendFunc=function(t,e){this.gl.blendFunc(this.gl[t],this.gl[e])},V.prototype.getShader=function(t,e,i){var n;return n=i?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER),t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert(t.getShaderInfoLog(n)),null)},V.prototype.initShaders=function(){var t=this.getShader(this.gl,this.getFragmentShader(),!0),e=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,e),this.gl.attachShader(this.sprogram,t),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},V.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var t=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.gl.STATIC_DRAW);for(var e=[],i=0;i<100;i++)e.push(i);for(idx=new Uint16Array(e),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW),e=[],i=0;i<100;i++)e.push(i,i+1,i+2);idx=new Uint16Array(e),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)},V.prototype.createCircle=function(t){this.circleCanvasRadius=i.WebGLUtil.nhpot(i.Util.initValue(t,32));var e=i.DomUtil.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),n=e.getContext("2d");return n.beginPath(),n.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),n.closePath(),n.fillStyle="#FFF",n.fill(),e.toDataURL()},V.prototype.setImgInCanvas=function(t){var e=t.target.width,n=t.target.height,r=i.WebGLUtil.nhpot(t.target.width),o=i.WebGLUtil.nhpot(t.target.height),a=t.target.width/r,s=t.target.height/o;this.texturebuffers[t.transform.src]||(this.texturebuffers[t.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),t.transform.texture=this.texturebuffers[t.transform.src][0],t.transform.vcBuffer=this.texturebuffers[t.transform.src][1],t.transform.tcBuffer=this.texturebuffers[t.transform.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,s,s,s]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,n,e,n]),this.gl.STATIC_DRAW);var l=t.transform.canvas.getContext("2d"),h=l.getImageData(0,0,r,o);this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,h),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),t.transform.textureLoaded=!0,t.transform.textureWidth=e,t.transform.textureHeight=n},V.prototype.setStroke=function(t,e){},V.prototype.onProtonUpdate=function(){},V.prototype.onParticleCreated=function(t){var e=this;t.transform.textureLoaded=!1,t.transform.tmat=i.Mat3.create(),t.transform.tmat[8]=1,t.transform.imat=i.Mat3.create(),t.transform.imat[8]=1,t.target?i.Util.getImage(t.target,t,!0,function(t){e.setImgInCanvas.call(e,t),t.transform.oldScale=1}):i.Util.getImage(this.circleCanvasURL,t,!0,function(t){e.setImgInCanvas.call(e,t),t.transform.oldScale=t.radius/e.circleCanvasRadius})},V.prototype.onParticleUpdate=function(t){t.transform.textureLoaded&&(this.updateMatrix(t),this.gl.uniform3f(this.sprogram.color,t.transform.rgb.r/255,t.transform.rgb.g/255,t.transform.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.transform.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,t.transform.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},V.prototype.onParticleDead=function(t){},V.prototype.updateMatrix=function(t){var e=i.WebGLUtil.makeTranslation(-t.transform.textureWidth/2,-t.transform.textureHeight/2),n=i.WebGLUtil.makeTranslation(t.p.x,t.p.y),r=t.rotation*(Math.PI/180),o=i.WebGLUtil.makeRotation(r),a=t.scale*t.transform.oldScale,s=i.WebGLUtil.makeScale(a,a),l=i.WebGLUtil.matrixMultiply(e,s);l=i.WebGLUtil.matrixMultiply(l,o),l=i.WebGLUtil.matrixMultiply(l,n),i.Mat3.inverse(l,t.transform.imat),l[2]=t.alpha,this.mstack.push(l)},i.WebGLRender=V,H.prototype={getPosition:function(){},crossing:function(t){}},i.Zone=H,i.Util.inherits(W,i.Zone),W.prototype.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},W.prototype.getDirection=function(t,e){var i=this.dy,n=-this.dx;return(i*t+n*e+this.dot)*(0==n?1:n)>0},W.prototype.getDistance=function(t,e){return(this.dy*t+-this.dx*e+this.dot)/Math.sqrt(this.xxyy)},W.prototype.getSymmetric=function(t){var e=t.getGradient(),i=this.getGradient(),n=2*(i-e),r=t.x,o=t.y;return t.x=r*Math.cos(n)-o*Math.sin(n),t.y=r*Math.sin(n)+o*Math.cos(n),t},W.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)},W.prototype.getRange=function(t,e){Math.abs(this.getGradient())<=Math.PI/4?t.p.x<this.maxx&&t.p.x>this.minx&&e():t.p.y<this.maxy&&t.p.y>this.miny&&e()},W.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},W.prototype.crossing=function(t){var e=this;"dead"==this.crossType?">"==this.direction||"R"==this.direction||"right"==this.direction||"down"==this.direction?this.getRange(t,function(){e.getDirection(t.p.x,t.p.y)&&(t.dead=!0)}):this.getRange(t,function(){e.getDirection(t.p.x,t.p.y)||(t.dead=!0)}):"bound"==this.crossType?this.getRange(t,function(){e.getDistance(t.p.x,t.p.y)<=t.radius&&(0==e.dx?t.v.x*=-1:0==e.dy?t.v.y*=-1:e.getSymmetric(t.v))}):"cross"==this.crossType&&this.alert&&(alert("Sorry lineZone does not support cross method"),this.alert=!1)},i.LineZone=W,i.Util.inherits(K,i.Zone),K.prototype.getPosition=function(){return this.random=Math.random(),this.angle=2*Math.PI*Math.random(),this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle),this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle),this.vector},K.prototype.setCenter=function(t,e){this.center.x=t,this.center.y=e},K.prototype.crossing=function(t){var e=t.p.distanceTo(this.center);"dead"==this.crossType?e-t.radius>this.radius&&(t.dead=!0):"bound"==this.crossType?e+t.radius>=this.radius&&this.getSymmetric(t):"cross"==this.crossType&&this.alert&&(alert("Sorry CircleZone does not support cross method"),this.alert=!1)},K.prototype.getSymmetric=function(t){var e=t.v.getGradient(),i=this.getGradient(t),n=2*(i-e),r=t.v.x,o=t.v.y;t.v.x=r*Math.cos(n)-o*Math.sin(n),t.v.y=r*Math.sin(n)+o*Math.cos(n)},K.prototype.getGradient=function(t){return-Math.PI/2+Math.atan2(t.p.y-this.center.y,t.p.x-this.center.x)},i.CircleZone=K,i.Util.inherits(z,i.Zone),z.prototype.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},z.prototype.crossing=function(t){this.alert&&(alert("Sorry PointZone does not support crossing method"),this.alert=!1)},i.PointZone=z,i.Util.inherits(j,i.Zone),j.prototype.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},j.prototype.crossing=function(t){"dead"==this.crossType?(t.p.x+t.radius<this.x?t.dead=!0:t.p.x-t.radius>this.x+this.width&&(t.dead=!0),t.p.y+t.radius<this.y?t.dead=!0:t.p.y-t.radius>this.y+this.height&&(t.dead=!0)):"bound"==this.crossType?(t.p.x-t.radius<this.x?(t.p.x=this.x+t.radius,t.v.x*=-1):t.p.x+t.radius>this.x+this.width&&(t.p.x=this.x+this.width-t.radius,t.v.x*=-1),t.p.y-t.radius<this.y?(t.p.y=this.y+t.radius,t.v.y*=-1):t.p.y+t.radius>this.y+this.height&&(t.p.y=this.y+this.height-t.radius,t.v.y*=-1)):"cross"==this.crossType&&(t.p.x+t.radius<this.x&&t.v.x<=0?t.p.x=this.x+this.width+t.radius:t.p.x-t.radius>this.x+this.width&&t.v.x>=0&&(t.p.x=this.x-t.radius),t.p.y+t.radius<this.y&&t.v.y<=0?t.p.y=this.y+this.height+t.radius:t.p.y-t.radius>this.y+this.height&&t.v.y>=0&&(t.p.y=this.y-t.radius))},i.RectZone=j,i.Util.inherits(Y,i.Zone),Y.prototype.reset=function(t,e,n,r){this.imageData=t,this.x=i.Util.initValue(e,0),this.y=i.Util.initValue(n,0),this.d=i.Util.initValue(r,2),this.vectors=[],this.setVectors()},Y.prototype.setVectors=function(){var t,e,i=this.imageData.width,n=this.imageData.height;for(t=0;t<i;t+=this.d)for(e=0;e<n;e+=this.d){var r=4*((e>>0)*i+(t>>0));this.imageData.data[r+3]>0&&this.vectors.push({x:t+this.x,y:e+this.y})}return this.vector},Y.prototype.getBound=function(t,e){var i=4*((e>>0)*this.imageData.width+(t>>0));return this.imageData.data[i+3]>0},Y.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])},Y.prototype.getColor=function(t,e){t-=this.x,e-=this.y;var i=4*((e>>0)*this.imageData.width+(t>>0));return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}},Y.prototype.crossing=function(t){"dead"==this.crossType?this.getBound(t.p.x-this.x,t.p.y-this.y)?t.dead=!0:t.dead=!1:"bound"==this.crossType&&(this.getBound(t.p.x-this.x,t.p.y-this.y)||t.v.negate())},i.ImageZone=Y;var ot=function(){if(t.console&&t.console.log){var e=arguments;if("string"==typeof arguments[0])if(0==arguments[0].indexOf("+")){var i=parseInt(arguments[0]);ot.once<i&&(delete e[0],console.log(e),ot.once++)}else console.log(e);else console.log(e)}};ot.once=0,i.log=ot;var at=at||{addEventListener:function(t,e){t.addEventListener(i.PROTON_UPDATE,function(t){e()})},setStyle:function(t){var e=t||"#ff0000",n=i.Util.hexToRGB(e);return"rgba("+n.r+","+n.g+","+n.b+",0.5)"},drawZone:function(t,e,n,r){var o=e.getContext("2d"),a=this.setStyle();this.addEventListener(t,function(){r&&o.clearRect(0,0,e.width,e.height),n instanceof i.PointZone?(o.beginPath(),o.fillStyle=a,o.arc(n.x,n.y,10,0,2*Math.PI,!0),o.fill(),o.closePath()):n instanceof i.LineZone?(o.beginPath(),o.strokeStyle=a,o.moveTo(n.x1,n.y1),o.lineTo(n.x2,n.y2),o.stroke(),o.closePath()):n instanceof i.RectZone?(o.beginPath(),o.strokeStyle=a,o.drawRect(n.x,n.y,n.width,n.height),o.stroke(),o.closePath()):n instanceof i.CircleZone&&(o.beginPath(),o.strokeStyle=a,o.arc(n.x,n.y,n.radius,0,2*Math.PI,!0),o.stroke(),o.closePath())})},drawEmitter:function(t,e,i,n){var r=e.getContext("2d"),o=this.setStyle();this.addEventListener(t,function(){n&&r.clearRect(0,0,e.width,e.height),r.beginPath(),r.fillStyle=o,r.arc(i.p.x,i.p.y,10,0,2*Math.PI,!0),r.fill(),r.closePath()})},test:{},setTest:function(t,e){this.test[t]=e},getTest:function(t){return!!this.test.hasOwnProperty(t)&&this.test[t]}};i.Debug=at}(window),function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),r=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+r)},r);return t=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),define("proton",function(t){return function(){return t.Proton}}(this)),define("absolute/particleemitter",["pixi","lodash","proton"],function(t,e,i){var n=function(t,n,r,o){var a={mass:8,gravity:1,alpha:{a:1,b:1},rate:{numpan:{a:15,b:20,center:null},timepan:{a:.2,b:.5,center:null}},velocity:{rpan:{a:3,b:9,center:null},thapan:{a:0,b:360,center:null},type:"polar"},scale:{a:.5,b:1,center:null},rotation:{a:0,b:1,style:"add",life:1/0,easing:i.easeLinear},life:{a:1,b:2,center:null},crossZone:{zone:{x:0,y:0,width:100,height:100},type:"bound",life:1/0,easing:i.easeLinear},randomDrift:{driftX:30,driftY:30,delay:.1,life:1/0,easing:i.easeLinear}};"function"==typeof r?this._initParticleEmitter(t,n,r,o):this._initParticleEmitter(t,n,e.extend(a,r),o)};return n.constructor=n,n.prototype=Object.create(t.DisplayObjectContainer.prototype),n.prototype._initParticleEmitter=function(n,r,o,a){if(t.DisplayObjectContainer.call(this),this.ui=n,this.particleParent=a||o.parent,!r){var s=new t.Graphics;s.beginFill(16711680),s.drawRect(0,0,10,10),s.endFill(),r=new t.RenderTexture(10,10),r.render(s)}if(this.emitter=new i.BehaviourEmitter,"function"==typeof o)o(this.emitter);else{if(this.options=o,this.emitter.rate=new i.Rate(new i.Span(o.rate.numpan.a,o.rate.numpan.b,o.rate.numpan.center),new i.Span(o.rate.timepan.a,o.rate.timepan.b,o.rate.timepan.center)),this.emitter.addInitialize(new i.Mass(o.mass)),this.emitter.addInitialize(new i.ImageTarget(r)),this.emitter.addInitialize(new i.Life(o.life.a,o.life.b,o.life.center)),void 0!==o.radius&&this.emitter.addInitialize(new i.Radius(o.radius)),e.isArray(o.velocity)||e.isNumber(o.velocity)){var l=o.velocityAngleRange?new i.Span(o.velocityAngleRange[0],o.velocityAngleRange[1],null):new i.Span(0,360,null);this.emitter.addInitialize(new i.Velocity(o.velocity,l,"polar"))}else void 0!==o.velocity&&this.emitter.addInitialize(new i.Velocity(new i.Span(o.velocity.rpan.a,o.velocity.rpan.b,o.velocity.rpan.center),new i.Span(o.velocity.thapan.a,o.velocity.thapan.b,o.velocity.thapan.center),o.velocity.type));this.emitter.addBehaviour(new i.Gravity(o.gravity)),this.emitter.addBehaviour(new i.Scale(new i.Span(o.scale.a,o.scale.b,o.scale.center))),this.emitter.addBehaviour(new i.Alpha(o.alpha.a,o.alpha.b)),this.emitter.addBehaviour(new i.Rotate(o.rotation.a,o.rotation.b,o.rotation.style,o.rotation.life,o.rotation.easing)),void 0!==o.color&&this.emitter.addBehaviour(new i.Color(o.color.color1,o.color.color2)),void 0!==o.randomDrift&&null!==o.randomDrift&&this.emitter.addSelfBehaviour(new i.RandomDrift(o.randomDrift.driftX,o.randomDrift.driftY,o.randomDrift.delay,o.randomDrift.life,o.randomDrift.easing)),void 0!==o.crossZone&&null!==o.crossZone&&this.emitter.addSelfBehaviour(new i.CrossZone(new i.RectZone(o.crossZone.zone.x,o.crossZone.zone.y,o.crossZone.zone.width,o.crossZone.zone.height),o.crossZone.type,o.crossZone.life,o.crossZone.easing)),this.emitter.p.x=0,this.emitter.p.y=0}this.ui.addEmitter(this.emitter),this.initEvents()},n.prototype.initEvents=function(){this.emitter.addEventListener(i.PARTICLE_CREATED,function(e){var i=e.particle;i&&(i.sprite=new t.Sprite(i.target),this.particleParent?(i.p.x=this.x,i.p.y=this.y,this.particleParent.addChild(i.sprite)):this.addChild(i.sprite))}.bind(this)),this.emitter.addEventListener(i.PARTICLE_UPDATE,function(t){var e=t.particle;if(e&&e.sprite){var i=e.sprite;i.position.x=e.p.x,i.position.y=e.p.y,i.scale.x=e.scale,i.scale.y=e.scale,i.anchor.x=.5,i.anchor.y=.5,i.alpha=e.alpha,i.rotation=e.rotation*Math.PI/180}}.bind(this)),this.emitter.addEventListener(i.PARTICLE_DEAD,function(t){var e=t.particle;e&&e.sprite&&e.sprite.parent&&(e.sprite.parent.removeChild(e.sprite),e.sprite=null)}.bind(this))},n.prototype.emitOnce=function(){this.emitter.emit("once")},n.prototype.start=function(){this.emitter.emit()},n.prototype.stop=function(){this.emitter.stopEmit()},n.prototype.destroy=function(){this.emitter.destroy()},n}),define("CardUI/WinAnimators/BaseWinAnimator",["Arkadium/GameEngine/Scenes/Nodes/SpriteNode"],function(t){"use strict";var e=function(t){this.initBaseWinAnimator(t)};return e.prototype.initBaseWinAnimator=function(t){this._supplyView=t,this._animationSide="spider"==this.SupplyView.CardSupply.GameName.toLowerCase()?1:-1,this._endAnimationCallback=null,this._hasUserClicked=!1,this._hasAnimationStarted=!1,this._animationContainer=null,this._background=null},Object.defineProperties(e.prototype,{SupplyView:{get:function(){return this._supplyView}},AnimationContainer:{get:function(){return this._animationContainer}},AnimationSide:{get:function(){return this._animationSide},set:function(t){this._animationSide=t}}}),e.prototype.BeginAnimation=function(e,i,n,r){this._endAnimationCallback=e,this._hasUserClicked=!1,this._hasAnimationStarted=!0,this.SupplyView.GameInputInterpreter.ClearHighlight(),this.UpdateEndingAnimationHandler=this.UpdateEndingAnimation.bind(this),this.SupplyView.Updated.add(this.UpdateEndingAnimationHandler),null==this._background&&(this._background=new t),null==this._animationContainer&&(this._animationContainer=new t),this.SupplyView.Parent.setEndGameAnimator(this._animationContainer,this._background,this.FinishEndingAnimation.bind(this))},e.prototype.UpdateEndingAnimation=function(t,e){},e.prototype.PauseEndingAnimation=function(){},e.prototype.FinishEndingAnimation=function(){this.SupplyView.Updated.remove(this.UpdateEndingAnimationHandler),null!=this._animationContainer&&null!=this._animationContainer.Parent&&(this._animationContainer.Parent.removeEndGameAnimator(),this._animationContainer=null,this._background=null),this._hasUserClicked=!1,this._hasAnimationStarted=!1,null!=this._endAnimationCallback&&this._endAnimationCallback()},e.prototype.EndAnimation=function(){this.FinishEndingAnimation()},e}),define("Arkadium/GameEngine/Scenes/Nodes/SceneNode",["pixi"],function(t){}),define("Arkadium/GameEngine/Maths/Bezier2D",["Arkadium/GameEngine/Maths/Vector2"],function(t){"use strict";var e=function(t,e){this.initBezier2D(t,e)};return e.BezierPointType={Control:0,Through:1},e.prototype.initBezier2D=function(t,i){this.Points=t?t.slice(0):null,this.PointType=i||e.BezierPointType.Control,this.Distance=0,this.Curve=[],this.UpdatePath()},e.prototype.PositionAt=function(e,i){if(i=i||new t(0,0),null==this.Curve||0==this.Curve.length)return void(i=new t(0,0));var n,r=e*this.Distance,o=0,a=0,s=this.Curve.length-3;for(n=0;n<=s&&(a=this.ArcLength(this.Curve[n],this.Curve[n+1],this.Curve[n+2]),!(o+a>r));n+=2)o+=a;n=n>s?s:n;var l=r==this.Distance?1:(r-o)/a,h=this.Curve[n+0],u=this.Curve[n+1],d=this.Curve[n+2];return i=new t(this.Quadratic(l,h.X,u.X,d.X),this.Quadratic(l,h.Y,u.Y,d.Y))},e.prototype.UpdatePath=function(){if(!(this.Points.length<=2)){if(this.Curve=null,this.PointType==e.BezierPointType.Through){var t=0,i=this.Points.length-1;this.Curve=new Array(2*i+1);var n=this.Points[0];this.Curve[t++]=n;var r=this.Points[2].clone();r.X-=n.X,r.Y-=n.Y,r.X=r.X/4,r.Y=r.Y/4,r=this.Points[1]-r,n=this.Points[1],this.Curve[t++]=r,this.Curve[t++]=n;for(var o=1;o<i;++o)r=this.Points[o]+(this.Points[o]-r),n=this.Points[o+1],this.Curve[t++]=r,this.Curve[t++]=n}else{var i=3+(this.Points.length-3)/2*2;this.Curve=new Array(i);for(var o=0;o<i;++o)this.Curve[o]=this.Points[o]}this.UpdateDistance()}},e.prototype.UpdateDistance=function(){this.Distance=0;for(var t=0;t<=this.Curve.length-3;t+=2)this.Distance+=this.ArcLength(this.Curve[t],this.Curve[t+1],this.Curve[t+2])},e.prototype.ArcLength=function(t,e,i){var n=this.AngleBetween(t,e),r=this.AngleBetween(e,i);if(n==r||r==n+Math.PI)return this.DistanceBetween(t,i);var o=e.Y-.5*i.Y-.5*t.Y,a=0;0!=o&&(a=-(e.X-.5*i.X-.5*t.X)/o);var s=a*(t.X-2*e.X+i.X)-(t.Y-2*e.Y+i.Y),l=0;0!=s&&(l=(-a*(e.X-t.X)+(e.Y-t.Y))/s);var h=this.Angle(l,t,e,i),u=this.ProjectDistance(t,e),d=this.ProjectDistance(e,i),c=h-this.RadAngle(t,e),p=this.RadAngle(e,i)-h,g=u*Math.cos(c),f=u*Math.sin(c),y=d*Math.cos(p),m=d*Math.sin(p),C=.5*this.ParabolaArcLength(f,2*Math.abs(g)),S=.5*this.ParabolaArcLength(m,2*Math.abs(y));return g<0||y<0?Math.abs(S-C):C+S},e.prototype.Quadratic=function(t,e,i,n){return e+t*(2*(1-t)*(i-e)+t*(n-e))},e.prototype.ParabolaArcLength=function(t,e){return 0==t?0:.5*Math.sqrt(e*e+16*t*t)+e*e/(8*t)*Math.log((4*t+Math.sqrt(e*e+16*t*t))/e)},e.prototype.RadAngle=function(t,e){return Math.atan2(e.Y-t.Y,e.X-t.X)},e.prototype.ProjectDistance=function(t,e){return Math.sqrt(e.X*e.X+t.X*t.X-2*t.X*e.X+e.Y*e.Y+t.Y*t.Y-2*t.Y*e.Y)},e.prototype.Angle=function(t,e,i,n){return Math.atan2(this.Derivative(t,e.Y,i.Y,n.Y),this.Derivative(t,e.X,i.X,n.X))},e.prototype.Derivative=function(t,e,i,n){return 2*e*(t-1)+2*i*(1-2*t)+2*n*t},e.prototype.DistanceBetween=function(t,e){var i=e.X-t.X,n=e.Y-t.Y;return Math.sqrt(i*i+n*n)},e.prototype.AngleBetween=function(t,e){var i=e.X-t.X,n=e.Y-t.Y;return Math.atan2(n,i)},e.prototype.IndexOf=function(t){return this.Points.indexOf(t)},e.prototype.Insert=function(t,e){this.Points.splice(t,0,e),this.UpdatePath()},e.prototype.RemoveAt=function(t){this.Points.splice(t,1),this.UpdatePath()},e.prototype.Add=function(t){this.Points.push(t),this.UpdatePath()},e.prototype.Clear=function(){this.Points=[],this.UpdatePath()},e.prototype.Contains=function(t){return-1!=this.Points.indexOf(t)},Object.defineProperty(e.prototype,"Count",{get:function(){return this.Points.length}}),Object.defineProperty(e.prototype,"IsReadOnly",{get:function(){return!1}}),e.prototype.Remove=function(t){var e=null,i=this.Points.indexOf(t);return-1!=i&&(e=this.Points.splice(i,1)),this.UpdatePath(),e},e}),
define("CardUI/WinAnimators/KaleidoscopeWinAnimator",["pixi","proton","absolute/particleemitter","absolute/coords","CardUI/WinAnimators/BaseWinAnimator","Arkadium/GameEngine/Scenes/Nodes/SceneNode","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Maths/Bezier2D","Arkadium/GameEngine/Tween/Tween","Arkadium/GameEngine/Core/EngineManagers","absolute/audiomanager"],function(t,e,i,n,r,o,a,s,l,h,u,d){"use strict";var c={None:0,SpawnCards:1,Done:2},p=function(t){this.initKaleidoscopeWinAnimator(t)};p.prototype=Object.create(r.prototype),p.prototype.constructor=p,p.prototype.initKaleidoscopeWinAnimator=function(t){r.call(this,t),this._foggingBackground=null,this._pileView=null,this._glow=null,this._animationState=c.None,this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=0,this._cardSpawnDelay=0,this._glowStarted=!1,this._pilesCount=0},p.prototype.ShouldStartDuringCardMovement=function(){return!1},p.prototype.BeginAnimation=function(t,e,i,n){this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=this.SupplyView.CardSupply.GetCardList().length,this._cardSpawnDelay=.4,this._animationState=c.SpawnCards,d.playSound("winKaleidoscope"),r.prototype.BeginAnimation.call(this,t,e,i,n),this.carousel9=this.addCarousel(9,1,10066431,1.5),this.carousel18=this.addCarousel(26,1,16751001,1.4),this.carousel1=this.addCarousel(1,-1,16777215,.4),this.carousel8=this.addCarousel(8,1,16777215,1),this.carousel32=this.addCarousel(32,1,16777215,.6),this.carousel30=this.addCarousel(28,1,16777215,1.4)},p.prototype.addCarousel=function(t,e,i,n){e=e||1,i=i||16777215,n=n||1;var r=new g(t,e,i);return this.AnimationContainer.AddChild(r),r.position.set(u.Display.Width/2,u.Display.Height/2),r.scale.set(n,n),r.spin(),r},p.prototype.OnSizeChanged=function(t,e){this.FinishEndingAnimation()},p.prototype.UpdateEndingAnimation=function(e,i){if(this._hasUserClicked)return void this.FinishEndingAnimation();if(this._numberOfCardsFinished>=this._totalNumberOfCards&&(this._animationState=c.Done),this._animationState==c.SpawnCards){this._animationState=c.None;var n;if(this.SupplyView.CardSupply.GetCardList().length>52){var r=this.SupplyView.CardSupply.GetPile("Foundation"+this._numberOfCardsFallen%8);n=this.SupplyView.GetCardView(r.NthFromTop(Math.floor(1+this._numberOfCardsFallen/8)))}else{var r=this.SupplyView.CardSupply.GetPile("Foundation"+this._numberOfCardsFallen%4);n=this.SupplyView.GetCardView(r.NthFromTop(Math.floor(1+this._numberOfCardsFallen/4)))}var o=function(t){var e="";switch(t%3){case 0:e=this.SupplyView.GetThemeAssetPath("kh");break;case 1:e=this.SupplyView.GetThemeAssetPath("qh");break;case 2:e=this.SupplyView.GetThemeAssetPath("jh")}return e}.bind(this);switch(this._numberOfCardsFallen){case 10:case 25:this._cardSpawnDelay-=.1}if(this.carousel8.full)if(this.carousel32.full)this._animationState=c.Done;else{if(!this.carousel1.full){var a=this.SupplyView.GetCardView(r.Bottom);this.carousel1.addCard(a.CardFront.sprite.texture,a.toGlobal(a.position),!0)}this.carousel9.full||this.carousel9.addCard(t.Texture.fromFrame(o(this.carousel9.numCards)),new t.Point(u.Display.Width/2,-u.Display.Height/2)),this.carousel18.full||this.carousel18.addCard(t.Texture.fromFrame(o(this.carousel18.numCards)),new t.Point(u.Display.Width/2,-u.Display.Height/2)),this.carousel30.full||this.carousel30.addCard(t.Texture.fromFrame(o(this.carousel30.numCards)),new t.Point(u.Display.Width/2,-u.Display.Height/2)),this.carousel32.addCard(n.CardFront.sprite.texture,n.toGlobal(n.position)),n.parent.removeChild(n),this._numberOfCardsFallen++}else this.carousel8.addCard(n.CardFront.sprite.texture,n.toGlobal(n.position)),n.parent.removeChild(n),this._numberOfCardsFallen++;this._numberOfCardsFallen<this._totalNumberOfCards&&h.Start(this.SupplyView).Wait(this._cardSpawnDelay).Then().Call(function(){this._animationState=c.SpawnCards}.bind(this))}this._animationState==c.Done&&(this._animationState=c.None,h.Start(this.SupplyView.GameContainer).Wait(2).Then().Call(this.FinishEndingAnimation.bind(this)))},p.prototype.FinishEndingAnimation=function(){if(this._hasAnimationStarted){d.stopSound("winKaleidoscope");for(var t=0;t<this._pilesCount;t++)this._pileView=this.SupplyView.GetPileView("Foundation"+t),this._pileView.removeChildAt(0);this.carousel9.destroy(),this.carousel18.destroy(),this.carousel1.destroy(),this.carousel8.destroy(),this.carousel32.destroy(),this.carousel30.destroy(),this.AnimationContainer.removeChild(this.carousel9),this.AnimationContainer.removeChild(this.carousel18),this.AnimationContainer.removeChild(this.carousel1),this.AnimationContainer.removeChild(this.carousel8),this.AnimationContainer.removeChild(this.carousel32),this.AnimationContainer.removeChild(this.carousel30),r.prototype.FinishEndingAnimation.call(this)}},p.prototype.IsAnimationRunning=function(){return this._hasAnimationStarted&&!this._hasUserClicked&&this._numberOfCardsFinished<this._totalNumberOfCards},p.prototype.DidStartAnimation=function(){return this._hasAnimationStarted},p.prototype.ShouldShowEndingPopup=function(){return this._hasAnimationStarted&&(this._hasUserClicked||this._numberOfCardsFinished>=this._totalNumberOfCards)},p.prototype.StopAnimationPointEvent=function(t){this.DoClickEnding()},p.prototype.StopAnimationKeyEvent=function(t){},p.prototype.DoClickEnding=function(){this._animationState==c.None&&(this._hasUserClicked=!0)},p.prototype.IncrementNumberCardsFinished=function(){this._numberOfCardsFinished++};var g=function(t,e,i){this.initCarousel(t,e,i)};return g.prototype=Object.create(t.DisplayObjectContainer.prototype),g.prototype.constructor=g,g.prototype.initCarousel=function(e,i,n){t.DisplayObjectContainer.call(this),this.maxCards=e,this.direction=i||1,this.tint=n||16777215,this.cardSprites=[],this.container=new t.Sprite,this.addChild(this.container),this.container.anchor.set(.5,.5);var r=this;this.spinTween=new TWEEN.Tween({rotation:r.container.rotation}).easing(TWEEN.Easing.Linear.None).to({rotation:this.rotation+2*Math.PI},4e3).onUpdate(function(){r.container.rotation=r.direction*this.rotation}).onComplete(function(){}).repeat(100)},g.prototype.destroy=function(){TWEEN.remove(this.startTween),TWEEN.remove(this.spinTween),this.removeChild(this.container),this.container=null},g.prototype.spin=function(){this.spinTween.start()},g.prototype.addCard=function(e,i,n){var r=new t.Sprite(e);r.scale.x=r.scale.y=.9/this.scale.x,r.anchor.set(.5,.5),r.tint=this.tint,this.cardSprites.push(r);var o=this.scale.x*(this.maxCards*r.width)/(2*Math.PI),a=2*Math.PI-(this.cardSprites.length-1)*(2*Math.PI)/this.maxCards,s=Math.cos(a-Math.PI/2)*(o+r.height/4),l=Math.sin(a-Math.PI/2)*(o+r.height/4);1==this.maxCards&&(s=0,l=0);var h=this.container.toLocal(i);r.position.set(h.x,h.y),this.container.addChild(r),n?(r.position.set(s,l),r.scale.set(.9,.9),r.alpha=0,r.rotation=a,this.startTween=new TWEEN.Tween({alpha:0}).easing(TWEEN.Easing.Cubic.InOut).to({alpha:1},1e3).onUpdate(function(){r.alpha=this.alpha}).onComplete(function(){}).start()):this.startTween=new TWEEN.Tween({x:r.x,y:r.y,rotation:r.rotation,scale:r.scale.x}).easing(TWEEN.Easing.Cubic.InOut).to({x:s,y:l,rotation:a,scale:.9},1e3).onUpdate(function(){r.x=this.x,r.y=this.y,r.rotation=this.rotation,r.scale.set(this.scale,this.scale)}).onComplete(function(){}).start()},Object.defineProperty(g.prototype,"full",{get:function(){return this.maxCards==this.cardSprites.length}}),Object.defineProperty(g.prototype,"numCards",{get:function(){return this.cardSprites.length}}),p}),define("util/Random",[],function(){"use strict";var t=function(t){this.initRandom(t)};return t.prototype.initRandom=function(t){this._seed=t},t.prototype.Next=function(t,e){return e||(e=t,t=0),t+Math.floor(Math.random()*(e-t))},t}),define("CardUI/WinAnimators/ButterflyWinAnimator",["pixi","proton","absolute","absolute/particleemitter","util/Random","CardUI/WinAnimators/BaseWinAnimator","Arkadium/GameEngine/Scenes/Nodes/SceneNode","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Maths/Bezier2D","Arkadium/GameEngine/Tween/Tween","Arkadium/GameEngine/Core/EngineManagers","absolute/audiomanager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c){"use strict";var p={None:0,Fogging:1,PilesGlow:2,SpawnCards:3,Done:4},g=function(t){this.initButterflyWinAnimator(t)};g.prototype=Object.create(o.prototype),g.prototype.constructor=g,g.prototype.initButterflyWinAnimator=function(t){o.call(this,t),this._foggingBackground=null,this._pileView=null,this._glow=null,this._animationState=p.None,this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=0,this._cardSpawnDelay=0,this._glowStarted=!1,this._pilesCount=0,this.CardSpawnNum=0},g.prototype.ShouldStartDuringCardMovement=function(){return!1},g.prototype.BeginAnimation=function(e,n,r,a){this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=this.SupplyView.CardSupply.GetCardList().length,this._cardSpawnDelay=.21,this.assetLoader=new t.AssetLoader([i.Platform.artPathPrefix+"/"+i.ScreenMetrics.getResClass()+"/butterfly.png"],!1),this.assetLoader.addEventListener("onComplete",function(){(new i.Loader).loadArt(["butterfly"],function(){},function(){this._animationState=p.Fogging}.bind(this))}.bind(this)),this.assetLoader.load(),c.playSound("winButterfly"),o.prototype.BeginAnimation.call(this,e,n,r,a)},g.prototype.OnSizeChanged=function(t,e){this.FinishEndingAnimation()},g.prototype.UpdateEndingAnimation=function(t,e){if(this._hasUserClicked)return void this.FinishEndingAnimation();if(this._numberOfCardsFinished>=this._totalNumberOfCards&&(this._animationState=p.Done),this._animationState==p.Fogging&&(this.SetFoggingBackground(),this._foggingBackground.alpha<.6?this._foggingBackground.alpha+=.01:this._animationState=p.PilesGlow),this._animationState==p.PilesGlow&&(this._glowStarted||this.StartGlow()),this._animationState==p.SpawnCards){this._animationState=p.None;var i,n,r=this.CardSpawnNum;if(this.SupplyView.CardSupply.GetCardList().length>52?r%4==0?(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation0").NthFromTop(Math.floor(1+r/4))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation1").NthFromTop(Math.floor(1+r/4)))):r%4==1?(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation2").NthFromTop(Math.floor(1+r/4))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation3").NthFromTop(Math.floor(1+r/4)))):r%4==2?(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation4").NthFromTop(Math.floor(1+r/4))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation5").NthFromTop(Math.floor(1+r/4)))):(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation6").NthFromTop(Math.floor(1+r/4))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation7").NthFromTop(Math.floor(1+r/4)))):r%2==0?(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation0").NthFromTop(Math.floor(1+r/2))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation1").NthFromTop(Math.floor(1+r/2)))):(i=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation2").NthFromTop(Math.floor(1+r/2))),n=this.SupplyView.GetCardView(this.SupplyView.CardSupply.GetPile("Foundation3").NthFromTop(Math.floor(1+r/2)))),this.CardSpawnNum++,i&&n){var o=new f(this,i,n);this.AnimationContainer.AddChild(o),o.TriggerSpawn(),i.Animating=!0,n.Animating=!0,this._numberOfCardsFallen+=2}switch(this._numberOfCardsFallen){case 10:case 25:this._cardSpawnDelay-=.01}this._numberOfCardsFallen<this._totalNumberOfCards&&u.Start(this.SupplyView).Wait(this._cardSpawnDelay).Then().Call(function(){this._animationState=p.SpawnCards}.bind(this))}this._animationState==p.Done&&(this._animationState=p.None,u.Start(this.SupplyView.GameContainer).Wait(.5).Then().Call(this.FinishEndingAnimation.bind(this)))},g.prototype.SetFoggingBackground=function(){null==this._foggingBackground&&(this._foggingBackground=new t.Graphics,this._foggingBackground.beginFill(0,1),this._foggingBackground.drawRect(-1e4,-1e4,2e4,2e4),this._foggingBackground.endFill(),this._foggingBackground.alpha=0,this._background.addChild(this._foggingBackground))},g.prototype.StartGlow=function(){this._pilesCount=this.SupplyView.CardSupply.GetCardList().length>52?8:4;for(var t=0;t<this._pilesCount;t++){this._pileView=this.SupplyView.GetPileView("Foundation0");var e=.8*this.SupplyView.GetCardView(this._pileView.Pile.NthFromTop(1)).ScaleX;this._glow=new s("fireworks-card-glow.png"),this._glow.TextureAlphaEnabled=!0,this._glow.Scale=new l(e,e),this._glow.Visible=!0,this._glow.Layer=6,this._glow.Alpha=0;var i=new u.TweenProperties;i.NumLoops=u.InfiniteLoops,this._pileView=this.SupplyView.GetPileView("Foundation"+t),u.Start(this._glow,i).FadeTo(.5,1.2).Then().FadeTo(.1,1.2),this._pileView.AddChildAt(this._glow,0)}u.Start(this._pileView).Wait(1).Then().Call(function(){this._animationState=p.SpawnCards}.bind(this)),this._glowStarted=!0},g.prototype.FinishEndingAnimation=function(){if(this._hasAnimationStarted){c.stopSound("winButterfly");for(var t=0;t<this._pilesCount;t++)this._pileView=this.SupplyView.GetPileView("Foundation"+t),this._pileView.removeChildAt(0);o.prototype.FinishEndingAnimation.call(this)}},g.prototype.IsAnimationRunning=function(){return this._hasAnimationStarted&&!this._hasUserClicked&&this._numberOfCardsFinished<this._totalNumberOfCards},g.prototype.DidStartAnimation=function(){return this._hasAnimationStarted},g.prototype.ShouldShowEndingPopup=function(){return this._hasAnimationStarted&&(this._hasUserClicked||this._numberOfCardsFinished>=this._totalNumberOfCards)},g.prototype.StopAnimationPointEvent=function(t){this.DoClickEnding()},g.prototype.StopAnimationKeyEvent=function(t){},g.prototype.DoClickEnding=function(){this._animationState==p.None&&(this._hasUserClicked=!0)},g.prototype.IncrementNumberCardsFinished=function(){this._numberOfCardsFinished+=2};var f=function(t,e,i){this.initFlyingCardNode(t,e,i)};return f.contstuctor=f,f.prototype=Object.create(s.prototype),f.prototype.initFlyingCardNode=function(e,r,o){function a(t,e){t.rendererObject.x=e.frame.x,t.rendererObject.y=e.frame.y,t.rendererObject.width=e.frame.width,t.rendererObject.height=e.frame.height,t.rendererObject.rotate=!1,t.rendererObject.page.rendererObject=e.baseTexture}s.call(this),this._cardAnimator=e,this._leftCardView=r,this._rightCardView=o,this._cardView=new t.DisplayObjectContainer,this.addChild(this._cardView),this.paused=!1,this._cardNode=null;var l={rate:{numpan:{a:5,b:8,center:!0},timepan:{a:.01,b:.02,center:null}},mass:1,rotation:{a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},velocity:.65,alpha:{a:[0,1],b:0},scale:{a:[.2,.02],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,crossZone:null,randomDrift:null},h=[t.Texture.fromFrame("Star.png"),t.Texture.fromFrame("Star_orng_dot.png"),t.Texture.fromFrame("Star_yellow_dot.png")];this.emitter=new n(d.UI,h,l,this._cardAnimator.AnimationContainer),d.UI.stage[0].addChild(this.emitter),this.animation=new t.Spine(i.Platform.artPathPrefix+"/"+i.ScreenMetrics.getResClass()+"/butterfly.json"),this.animation.scale.set(.9,.9),this.animation.state.setAnimationByName(0,"fly_open_face_loop",!0);var u=this.animation.skeleton.data.defaultSkin.attachments;a(u["0:card1"],this._leftCardView.CardFront.sprite.texture),a(u["1:card1"],this._leftCardView.CardFront.sprite.texture),a(u["2:card2"],this._rightCardView.CardFront.sprite.texture),a(u["2:cardback"],this._leftCardView.CardBack.sprite.texture),this.animation.skeleton.slots[0].currentSprite=void 0,this.animation.skeleton.slots[0].currentSpriteName=void 0,this.animation.skeleton.slots[0].sprites={},this.animation.skeleton.slots[1].currentSprite=void 0,this.animation.skeleton.slots[1].currentSpriteName=void 0,this.animation.skeleton.slots[1].sprites={},this.animation.skeleton.slots[2].currentSprite=void 0,this.animation.skeleton.slots[2].currentSpriteName=void 0,this.animation.skeleton.slots[2].sprites={},this._cardView.addChild(this.animation)},f.prototype.PauseAnimation=function(){this._paused=!0},f.prototype.UpdateInternal=function(t){this._paused,null!=this._cardNode&&this.Visible,s.prototype.UpdateInternal.call(this,t)},f.prototype.TriggerSpawn=function(){this.position=this.toLocal(this._leftCardView.toGlobal(this._leftCardView.position)),this.addChild(this._cardView),this._leftCardView.parent.removeChild(this._leftCardView),this._rightCardView.parent.removeChild(this._rightCardView),this.rand=new r(0),this.numMoves=this.rand.Next(1,4),this.emitter.start(),this.flyTween()},f.prototype.flyTween=function(){if(this.numMoves--,this.numMoves>0&&(this.nextX=this.rand.Next(0,d.Display.Width),this.nextY=this.rand.Next(0,d.Display.Height)),0==this.numMoves&&(this.nextX,d.Display.Width,this.nextX-=d.Display.Width,this.nextY,d.Display.Height,this.nextY-=d.Display.Height),this.numMoves<0&&(this.visible=!1,d.UI.stage[0].removeChild(this.emitter),this.emitter.destroy(),this._cardAnimator.IncrementNumberCardsFinished()),this.numMoves>=0){var t=this;new TWEEN.Tween({x:this.position.x,y:this.position.y,scale:this.scale.x}).easing(TWEEN.Easing.Cubic.Out).to({x:this.nextX,y:this.nextY,scale:.5},800).delay(500).onStart(function(){t.animation.state.setAnimationByName(0,"fly_angle_loop",!0)}).onUpdate(function(){t.position.x=this.x,t.position.y=this.y,t.emitter.x=t.x-.25*t.width,t.emitter.y=t.y+.25*t.height,t.scale.set(this.scale,this.scale)}).onComplete(function(){t.flyTween()}).start()}},g}),define("CardUI/WinAnimators/FireworksWinAnimator",["pixi","proton","absolute/particleemitter","CardUI/WinAnimators/BaseWinAnimator","Arkadium/GameEngine/Scenes/Nodes/SceneNode","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Maths/Bezier2D","Arkadium/GameEngine/Tween/Tween","Arkadium/GameEngine/Core/EngineManagers","absolute/audiomanager"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d={None:0,Fogging:1,PilesGlow:2,SpawnCards:3,Done:4},c=function(t){this.initFireworksWinAnimator(t)};c.prototype=Object.create(n.prototype),c.prototype.constructor=c,c.prototype.initFireworksWinAnimator=function(t){n.call(this,t),this._foggingBackground=null,this._pileView=null,this._glow=null,this._animationState=d.None,this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=0,this._cardSpawnDelay=0,this._glowStarted=!1,this._pilesCount=0},c.prototype.ShouldStartDuringCardMovement=function(){return!1},c.prototype.BeginAnimation=function(t,e,i,r){this._numberOfCardsFallen=0,this._numberOfCardsFinished=0,this._totalNumberOfCards=this.SupplyView.CardSupply.GetCardList().length,this._cardSpawnDelay=.5,this._animationState=d.Fogging,u.playSound("winFireworks"),n.prototype.BeginAnimation.call(this,t,e,i,r)},c.prototype.OnSizeChanged=function(t,e){this.FinishEndingAnimation()},c.prototype.UpdateEndingAnimation=function(t,e){if(this._hasUserClicked)return void this.FinishEndingAnimation();if(this._numberOfCardsFinished>=this._totalNumberOfCards&&(this._animationState=d.Done),this._animationState==d.Fogging&&(this.SetFoggingBackground(),this._foggingBackground.alpha<.6?this._foggingBackground.alpha+=.01:this._animationState=d.PilesGlow),this._animationState==d.PilesGlow&&(this._glowStarted||this.StartGlow()),this._animationState==d.SpawnCards){this._animationState=d.None;var i;if(this.SupplyView.CardSupply.GetCardList().length>52){var n=this.SupplyView.CardSupply.GetPile("Foundation"+this._numberOfCardsFallen%8);i=this.SupplyView.GetCardView(n.NthFromTop(Math.floor(1+this._numberOfCardsFallen/8)))}else{var n=this.SupplyView.CardSupply.GetPile("Foundation"+this._numberOfCardsFallen%4);i=this.SupplyView.GetCardView(n.NthFromTop(Math.floor(1+this._numberOfCardsFallen/4)))}var r=new p(this,i);switch(this.AnimationContainer.AddChild(r),r.TriggerSpawn(),i.Animating=!0,++this._numberOfCardsFallen){case 10:case 25:this._cardSpawnDelay-=.1}this._numberOfCardsFallen<this._totalNumberOfCards&&l.Start(this.SupplyView).Wait(this._cardSpawnDelay).Then().Call(function(){this._animationState=d.SpawnCards}.bind(this))}this._animationState==d.Done&&(this._animationState=d.None,l.Start(this.SupplyView.GameContainer).Wait(.5).Then().Call(this.FinishEndingAnimation.bind(this)))},c.prototype.SetFoggingBackground=function(){null==this._foggingBackground&&(this._foggingBackground=new t.Graphics,this._foggingBackground.beginFill(0,1),this._foggingBackground.drawRect(-1e4,-1e4,2e4,2e4),this._foggingBackground.endFill(),this._foggingBackground.alpha=0,this._background.addChild(this._foggingBackground))},c.prototype.StartGlow=function(){this._pilesCount=this.SupplyView.CardSupply.GetCardList().length>52?8:4;for(var t=0;t<this._pilesCount;t++){this._pileView=this.SupplyView.GetPileView("Foundation0");var e=.8*this.SupplyView.GetCardView(this._pileView.Pile.NthFromTop(1)).ScaleX;this._glow=new o("fireworks-card-glow.png"),this._glow.TextureAlphaEnabled=!0,this._glow.Scale=new a(e,e),this._glow.Visible=!0,this._glow.Layer=6,this._glow.Alpha=0;var i=new l.TweenProperties;i.NumLoops=l.InfiniteLoops,this._pileView=this.SupplyView.GetPileView("Foundation"+t),l.Start(this._glow,i).FadeTo(.5,1.2).Then().FadeTo(.1,1.2),this._pileView.AddChildAt(this._glow,0)}l.Start(this._pileView).Wait(1).Then().Call(function(){this._animationState=d.SpawnCards}.bind(this)),this._glowStarted=!0},c.prototype.FinishEndingAnimation=function(){if(this._hasAnimationStarted){u.stopSound("winFireworks");for(var t=0;t<this._pilesCount;t++)this._pileView=this.SupplyView.GetPileView("Foundation"+t),this._pileView.removeChildAt(0);n.prototype.FinishEndingAnimation.call(this)}},c.prototype.IsAnimationRunning=function(){return this._hasAnimationStarted&&!this._hasUserClicked&&this._numberOfCardsFinished<this._totalNumberOfCards},c.prototype.DidStartAnimation=function(){return this._hasAnimationStarted},c.prototype.ShouldShowEndingPopup=function(){return this._hasAnimationStarted&&(this._hasUserClicked||this._numberOfCardsFinished>=this._totalNumberOfCards)},c.prototype.StopAnimationPointEvent=function(t){this.DoClickEnding()},c.prototype.StopAnimationKeyEvent=function(t){},c.prototype.DoClickEnding=function(){this._animationState==d.None&&(this._hasUserClicked=!0)},c.prototype.IncrementNumberCardsFinished=function(){this._numberOfCardsFinished++};var p=function(t,e){this.initSpinCardNode(t,e)};return p.contstuctor=p,p.prototype=Object.create(o.prototype),p.prototype.initSpinCardNode=function(e,i){o.call(this),this._cardAnimator=e,this._cardView=i,this.paused=!1,this._cardNode=null,this._glowNode=null,this.fwtextures=[t.Texture.fromFrame("particle_glow_blue.png"),t.Texture.fromFrame("particle_glow_green.png"),t.Texture.fromFrame("particle_glow_orange.png"),t.Texture.fromFrame("particle_glow_pink.png"),t.Texture.fromFrame("particle_glow_purple.png"),t.Texture.fromFrame("particle_glow_yellow.png")]},p.prototype.PauseAnimation=function(){this._paused=!0},p.prototype.UpdateInternal=function(t){this._paused,null!=this._cardNode&&this.Visible,o.prototype.UpdateInternal.call(this,t)},p.prototype.TriggerSpawn=function(){this.position=this.toLocal(this._cardView.toGlobal(this._cardView.position)),this.glow=new o("fireworks-card-glow.png"),this.glow.scale.x=this.glow.scale.y=this._cardView.width/(.7*this.glow.width),this.glow.alpha=0,this.addChild(this._cardView),this.addChild(this.glow);var t=this.position.x+h.Display.Width/8*this._cardAnimator.AnimationSide+Math.floor(Math.random()*h.Display.Width/4*this._cardAnimator.AnimationSide),n=this.position.y+h.Display.Height/4*-this._cardAnimator.AnimationSide+Math.floor(Math.random()*h.Display.Height/2*-this._cardAnimator.AnimationSide),r=[this.position.x-t/4,t],a=[n/4,n],s=this;new TWEEN.Tween({x:this.position.x,y:this.position.y,rotation:this.rotation,alpha:0}).easing(TWEEN.Easing.Linear.None).interpolation(TWEEN.Interpolation.Bezier).to({x:r,y:a,rotation:-2*Math.PI,alpha:1},1e3).onStart(function(){}).onUpdate(function(){s.position.x=this.x,s.position.y=this.y,s.rotation=this.rotation,s.glow.alpha=this.alpha}).onComplete(function(){s._cardView.visible=!1,s.glow.visible=!1;var t=[s.fwtextures[Math.floor(Math.random()*s.fwtextures.length)]],n=new i(h.UI,t,function(i){var n=new e;i.rate=new e.Rate(new e.Span(150,200),1),i.addInitialize(new e.Mass(1)),i.addInitialize(new e.Radius(4,8)),i.addInitialize(new e.Life(1,1.5)),i.addInitialize(new e.V([.1,.2,.3,.4,.5,.6,.7,.8,.9,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3.1,3.2,3.3,3.4,3.5,3.6,3.7,3.8,3.9],new e.Span(0,360),"polar")),i.addInitialize(new e.ImageTarget(t,32)),i.addBehaviour(new e.Alpha(1,[.5,0])),i.addBehaviour(new e.Scale([1,2],.1)),i.addBehaviour(new e.Gravity(1));var r=e.MathUtils.randomColor();i.addBehaviour(new e.Color(r)),i.p.x=0,i.p.y=0,i.emit("once",!0),n.addEmitter(i)});u.playSound("firework"+(Math.round(3*Math.random())+1).toString()),s.addChild(n),s._cardAnimator.IncrementNumberCardsFinished()}).start()},c}),define("CardUI/WinAnimators/CardBounceWinAnimator",["pixi","CardUI/WinAnimators/BaseWinAnimator","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Tween/Tween","util/Random","absolute/audiomanager"],function(t,e,i,n,r,o,a,s){"use strict";var l={None:0,SpawnCards:1,Done:2},h=function(t){return t/(1/60)+.5*i.UI.width},u=function(t){return t/(-1/60)+.5*i.UI.height},d=function(t){return(t-.5*i.UI.width)*(1/60)},c=function(t){return(t-.5*i.UI.height)*(-1/60)},p=function(t){this.initCardBounceWinAnimator(t)};p.prototype=Object.create(e.prototype),p.prototype.constructor=p,p.prototype.initCardBounceWinAnimator=function(t){e.call(this,t),this.numberOfCardFallen=0,this.numberOfCardsFinished=0,this.totalNumberOfCards=0,this.cardSpawnDelay=0,this.cardLayer=0,this.animationState=l.None},p.prototype.ShouldStartDuringCardMovement=function(){return!1},p.prototype.BeginAnimation=function(n,r,o,a){this.numberOfCardsFallen=0,this.numberOfCardsFinished=0,this.totalNumberOfCards=this.SupplyView.CardSupply.GetCardList().length,this.cardSpawnDelay=1.2,e.prototype.BeginAnimation.call(this,n,r,o,a),this.animationTexture=new t.RenderTexture(i.UI.width,i.UI.height),this.animationSprite=new t.Sprite(this.animationTexture),this._animationContainer.addChild(this.animationSprite),this.cardContainer=new t.DisplayObjectContainer,this._animationContainer.UpdateInternal=function(t){for(var e=0;e<this.cardContainer.children.length;e++)this.cardContainer.children[e]instanceof g&&this.cardContainer.children[e].Update(t);this.animationTexture.render(this.cardContainer,null,!1),this._animationContainer.children[0].texture.baseTexture.dirty()}.bind(this),s.playSound("winBounce"),this.animationState=l.SpawnCards},p.prototype.UpdateEndingAnimation=function(t,e){if(this._hasUserClicked)return void this.PauseEndingAnimation();if(this.numberOfCardsFinished>=this.totalNumberOfCards&&(this.animationState=l.Done),this.animationState==l.SpawnCards){this.animationState=l.None;var i;if(this.SupplyView.CardSupply.GetCardList().length>52){var n=this.SupplyView.CardSupply.GetPile("Foundation"+this.numberOfCardsFallen%8);i=this.SupplyView.GetCardView(n.NthFromTop(Math.floor(1+this.numberOfCardsFallen/8)))}else{var n=this.SupplyView.CardSupply.GetPile("Foundation"+this.numberOfCardsFallen%4);i=this.SupplyView.GetCardView(n.NthFromTop(Math.floor(1+this.numberOfCardsFallen/4)))}var r=new g(this,i);switch(this.cardContainer.addChild(r),r.Layer=this.cardLayer,r.TriggerSpawn(),this.cardLayer++,i.Animating=!0,++this.numberOfCardsFallen){case 2:this.cardSpawnDelay-=.3;break;case 5:case 10:this.cardSpawnDelay-=.4}this.numberOfCardsFallen<this.totalNumberOfCards&&o.Start(this.SupplyView).Wait(this.cardSpawnDelay).Then().Call(function(){this.animationState=l.SpawnCards}.bind(this))}this.animationState==l.Done&&(this.animationState=l.None,o.Start(this.SupplyView.GameContainer).Wait(.5).Then().Call(this.PauseEndingAnimation.bind(this)))},p.prototype.PauseEndingAnimation=function(){this.FinishEndingAnimation()},p.prototype.FinishEndingAnimation=function(){this._hasAnimationStarted&&(s.stopSound("winBounce"),e.prototype.FinishEndingAnimation.call(this))},p.prototype.EndAnimation=function(){this.FinishEndingAnimation()},p.prototype.IsAnimationRunning=function(){return this._hasAnimationStarted&&!this._hasUserClicked&&this.numberOfCardsFinished<this.totalNumberOfCards},p.prototype.DidStartAnimation=function(){return this._hasAnimationStarted},p.prototype.ShouldShowEndingPopup=function(){return this._hasAnimationStarted&&(this._hasUserClicked||this.numberOfCardsFinished>=this.totalNumberOfCards)},p.prototype.StopAnimationPointEvent=function(t){this.DoClickEnding()},p.prototype.StopAnimationKeyEvent=function(t){},p.prototype.DoClickEnding=function(){this.animationState==l.None&&(this._hasUserClicked=!0)},p.prototype.IncrementNumberCardsFinished=function(){this.numberOfCardsFinished>=51?setTimeout(function(){this.numberOfCardsFinished++}.bind(this),4e3):this.numberOfCardsFinished++};var g=function(t,e){this.initBouncingCardNode(t,e)};return g.prototype.contstructor=g,g.prototype=Object.create(n.prototype),g.prototype.initBouncingCardNode=function(t,e){n.call(this),this.cardAnimator=t,this.cardView=e,this.PRNG=new a(18),this.paused=!1,this.cardNode=null,this.xDest=0,this.bounceFloor=0,this.cardScale=0,this.bounceHeight=0},g.prototype.PauseAnimation=function(){this.paused=!0},g.prototype.UpdateInternal=function(t){this.paused||this.UpdatePosition(),null!=this.cardNode&&this.Visible,n.prototype.UpdateInternal.call(t)},g.prototype.UpdatePosition=function(){var t=d(this.x),e=c(this.y);if(t>20||t<-40||e>20||e<-20)return void this.parent.removeChild(this);t+=(this.xDest-10)/10*.2,e>=this.bounceFloor?(e-=.3*this.bounceHeight,this.bounceHeight+=.05,this.cardScale+=.001,this.scale.x=this.scale.y=this.cardScale):(this.bounceFloor-=.5,this.bounceHeight=-1-this.xDest/20),this.x=h(t),this.y=u(e)},g.prototype.TriggerSpawn=function(){this.cardNode=this.cardView;var t=this.cardNode.parent.toGlobal(this.cardNode.position);this.x=t.x,this.y=t.y,this.cardNode.x=0,this.cardNode.y=0,this.addChild(this.cardNode),this.SetStartingValues(),s.playSound("pickupCard"),this.cardAnimator.IncrementNumberCardsFinished()},g.prototype.SetStartingValues=function(){var t=this.PRNG.Next(2);this.xDest=0==t?this.PRNG.Next(8):this.PRNG.Next(8,12),this.bounceFloor=-6.5,this.bounceHeight=-.5,this.cardScale=1},p}),define("util/ThemeManager",[],function(){"use strict";return{CurrentTheme:"classic"}}),define("CardUI/SupplyView",["lodash","pixi","absolute/audiomanager","Arkadium/GameEngine/Tween/Tween","absolute/debug","absolute/spriteutils","absolute/storagemanager","util/eventhandler","util/dictionary","util/list","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","SolitaireShared/CardLogic/Pile","SolitaireShared/CardLogic/Card","SolitaireShared/CardLogic/CardOp","CardUI/PileView","CardUI/CardView","CardUI/KeyboardNavigator","CardUI/WinAnimators/KaleidoscopeWinAnimator","CardUI/WinAnimators/ButterflyWinAnimator","CardUI/WinAnimators/FireworksWinAnimator","CardUI/WinAnimators/CardBounceWinAnimator","Solitaire/GameState","util/SettingsManager","util/ThemeManager","Managers/ScaleManager","Managers/AdManager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_,P){var A=function(t,e,i,n){this.initSupplyView(t,e,i,n)};return A.constructor=A,A.prototype=Object.create(d.prototype),A.LayoutState={HorizontalView:0,VerticalView:1},A.AutoMoveInterval=250,A.prototype.doClassicScaling=function(t,e){if(this.game.ui.gameScreen.visible=!1,t)setTimeout(function(){for(var t=0;t<200;t++)n.UpdateAll();this.handleResize(),setTimeout(function(){this.dealSoundIsAllowed=!0,window.GD_OPTIONS?(this.dealSoundIsAllowed=!1,
_.gameStarted()):(this.game.solitaire.DealNewGame(),this.game.ui.hideLoadingScreen(),this.game.ui.loadingScreen.resetLoadingProgress(),this.game.ui.gameScreen.visible=!0)}.bind(this),400)}.bind(this),100);else{var i=setInterval(function(){this.handleResize()}.bind(this),100);setTimeout(function(){_.gameStarted(),this.dealSoundIsAllowed=!0,clearInterval(i),this.handleResize(),window.GD_OPTIONS||(this.game.ui.hideLoadingScreen(),this.game.ui.loadingScreen.resetLoadingProgress(),this.game.ui.gameScreen.visible=!0)}.bind(this),500)}},A.prototype.doChallengeScaling=function(){setTimeout(function(){this.alpha=0,this.revealIsRestricted=!0;for(var t=0;t<200;t++)n.UpdateAll();this.handleResize(),setTimeout(function(){this.revealIsRestricted=!1,this.dealSoundIsAllowed=!0,this.game.ui.hideLoadingScreen()}.bind(this),400)}.bind(this),100)},A.prototype.initSupplyView=function(t,i,n,r){d.call(this),this.InternalWidth=i,this.InternalHeight=n,this.game=r,this._pileFromView=new l(f,c),this._viewFromPile=new l(c,f),this._pileViewList=new h,this._viewFromCard=new l(Number,y),this._cardFromView=new l(y,p),this._cardViewList=new h,this._uiKeyboardNavs=null,this.CardSupply=t,this.OnMoveCardsEvent=new s,this.CardScaleChanged=new s,this.CardsStartDrag=new s,this.CardsStopDrag=new s,this.GameInputInterpreter=null,this.AllowInitKeyboardOnLoad=!1,this.GameContainer=null,this._cardScale=1,this._isCardDragging=!1,this.CurrentLayout=A.LayoutState.HorizontalView,this._getThemeAssetFunc=null,this.IsUserTheme=!1,this.NextWinAnimation=0,this.LocalizedAssetPath=null,this._shiftDown=!1,this.Name="SupplyView",this.KeyboardEnabled=!0,this.EnableHighlight=!0,this.EnableShadows=!0,this.EnablePileHints=!0,this.EnableCardBacks=!0,this.Layer=-2,this.KeyboardFocus=null,this.DefaultKeyboardFocus=null,this.AutomaticMovesStart=null,this.AutomaticMovesStop=null,this._isAutomaticMovesStarted=!1,this._timeSinceLastAutoMove=0,this.EndAnimationList=["KaleidoscopeWinAnimator","ButterflyWinAnimator","FireworksWinAnimator","CardBounceWinAnimator"],this._navigatable=!1,this._focused=!1,this.NavigationIndex=0,this.ClearHintsCallback=null,this.pileBackgroundContainer=new e.DisplayObjectContainer,this.addChild(this.pileBackgroundContainer),this.Updated=new s,$(window).mouseout(this.handleWindowMouseOut.bind(this)),this.windowFocusHandler=this.handleWindowFocus.bind(this),window.addEventListener("focus",this.windowFocusHandler),M.addElement(this,{scaleChangeSource:"Full"})},A.prototype.initForceSprite=function(){var t=this.getModeSpecificDimensions(),i=t.width,n=t.height,r=new e.Graphics;r.beginFill(16711680,.2),r.drawRect(0,0,i,n),r.endFill(),r.beginFill(255,.3),r.drawRect(0,0,i,3),r.drawRect(0,0,3,n),r.drawRect(i-3,0,3,n),r.drawRect(0,n-3,i,3),r.endFill(),this.forceSprite=new e.Sprite(r.generateTexture()),this.forceSprite.alpha=0,this.parent.addChild(this.forceSprite)},A.prototype.handleForceResize=function(){var t=this.forceSprite.scale.x,e=this.forceSprite.scale.y;this.forceSprite.scale.set(1,1);var i=this.forceSprite.width,n=this.forceSprite.height;this.scale.set(t,e);var r=P.Coords.x(1920)/M.width,o=P.Coords.y(1080)/M.height,a=M.width,s=M.height-this.getHeaderHeight()/o;this.forceSprite.width=i*r,this.forceSprite.height=n*o;var l=this.forceSprite.width/r,h=this.forceSprite.height/o,u=i,d=n,c=!1;if(l>a){this.forceSprite.width=P.Coords.x(1920);var p=a/u;if(this.forceSprite.height=n*o*p,this.forceSprite.height/o>s){this.forceSprite.height=P.Coords.y(1080)-this.getHeaderHeight();var p=s/d;this.forceSprite.width=i*r*p}c=!0}if(!c&&h>s){this.forceSprite.height=P.Coords.y(1080)-this.getHeaderHeight();var p=s/d;if(this.forceSprite.width=i*r*p,this.forceSprite.width/r>a){this.forceSprite.width=P.Coords.x(1920);var p=a/u;this.forceSprite.height=n*o*p}}this.forceSprite.x=P.Coords.x(960)-this.forceSprite.width/2,this.forceSprite.y=this.getHeaderHeight()},A.prototype.handleResize=function(){if(this.forceSprite){this.handleForceResize(),this.scale.set(this.forceSprite.scale.x,this.forceSprite.scale.y),this.position.set(this.forceSprite.position.x,this.forceSprite.position.y),this.x+=this.forceSprite.width/2,this.y+=this.forceSprite.height/2;var t=this.getModeSpecificOffset();this.x+=t.x*this.scale.x,this.y+=t.y*this.scale.y}},A.prototype.getHeaderHeight=function(){var t=Math.max(Math.min(M.height/1080+.3,1),.7),e=Math.max(Math.min(M.width/1920+.3,1),.7);return Math.min(t,e)*(P.Coords.y(66)/M.scaleFactorY)},A.prototype.handleWindowMouseOut=function(){this.children.filter(function(t){return t instanceof f}.bind(this)).reduce(function(t,e){return e.children.forEach(function(e){e instanceof y&&t.push(e)}),t},[]).forEach(function(t){t._isDragging&&t.ForceDrop(t.Card.Pile)})},A.prototype.Register=function(e){d.prototype.Register.call(this,e),t.each(this.Scene.game.menuBar.gameOptionsSlideouts,function(t){"GameOptionsChallenge"!==t.config.contentLayout[0]&&t.onSubMenuToggle.add(this.handleSubMenuToggle.bind(this))}.bind(this))},A.prototype.handleSubMenuToggle=function(t,e){this.CardSupply.shouldPauseTime=e},A.prototype.OnCardScaleChanged=function(){var t=this.CardScaleChanged;null!=t&&t.handleEvent(this)},A.prototype.OnCardsStartDrag=function(){var t=this.CardsStartDrag;null!=t&&t.handleEvent(this)},A.prototype.OnCardsStopDrag=function(){var t=this.CardsStopDrag;null!=t&&t.handleEvent(this)},A.prototype.GetWidth=function(){return this.InternalWidth},A.prototype.GetHeight=function(){return this.InternalHeight},Object.defineProperty(A.prototype,"CardScale",{get:function(){return this._cardScale},set:function(t){this._cardScale=t,this.OnCardScaleChanged()}}),Object.defineProperty(A.prototype,"IsCardDragging",{get:function(){return this._isCardDragging},set:function(t){t!=this._isCardDragging&&(this._isCardDragging=t,t?this.OnCardsStartDrag():this.OnCardsStopDrag())}}),Object.defineProperty(A,"GetThemeAssetFunc",{set:function(t){this._getThemeAssetFunc=t}}),A.prototype.GetThemeAssetPath=function(t){var e="",i=T.CurrentTheme;if("cardback"==t||t.length<=3)e=i+"/cards/";else switch(t){case"shadow":case"higlight":case"goal_glow":case"foundation_effect":case"blankpile":case"ending_card_glow":case"hint_highlight":e="";break;default:e=i+"/"}return"jo"==t&&(t="0n"),e+t+".png"},A.prototype.GetPileView=function(t){return"string"==typeof t&&(t=this.CardSupply.GetPile(t)),t&&this._viewFromPile.ContainsKey(t)?this._viewFromPile.Get(t):null},A.prototype.GetCardView=function(t){return null==t?null:this._viewFromCard.ContainsKey(t.Sequence)?this._viewFromCard.Get(t.Sequence):null},A.prototype.forceShadowHide=function(e,i,n){var r=i.indexOf(n);t.forEach(i,function(t,i){if(i>=r){this.GetCardView(t).forceShadowHide(e)}},this)},A.prototype.destroy=function(){clearInterval(this.pileUpdateInterval),clearTimeout(this.pileUpdateTimeout),M.removeElement(this),window.removeEventListener("focus",this.windowFocusHandler),this.hasBeenDestroyed=!0},A.prototype.Destroy=function(){this.OnMoveCardsEvent.remove(this.SupplyView_OnMoveCards),this.CardSupply.OnShuffleEvent.remove(this.CardSupply_OnPreDealEvent),this.CardSupply.OnDealEvent.remove(this.CardSupply_OnDealEvent),this.CardSupply.OnWildCardAddedEvent.remove(this.CardSupply_OnWildCardAdded),t.forEach(this.children,function(t){t instanceof f&&t.UnregisterEvents()})},A.prototype.SetAllCardsFace=function(){t.forEach(this._cardViewList,function(t){var e=t.Parent;null!=e&&(e.CardFacing=f.Facing.FaceUp)})},A.prototype.CardSupply_OnWildCardAdded=function(t){this.UpdatePileChildren(!1)},A.prototype.OnChangedFocus=function(){null==this.KeyboardFocus&&(this.KeyboardFocus=this.DefaultKeyboardFocus),this.Focused?this.KeyboardFocus.Keyboard.GetKeyboardFocus():this.KeyboardFocus.Keyboard.LoseKeyboardFocus()},A.prototype.Init=function(t){this.HasRunInit||(this.CardSupply.OnShuffleEvent.add(this.CardSupply_OnPreDealEvent.bind(this)),this.CardSupply.OnWildCardAddedEvent.add(this.CardSupply_OnWildCardAdded.bind(this)),this.CardSupply.OnDealEvent.add(this.CardSupply_OnDealEvent.bind(this)),this.OnMoveCardsEvent.add(this.SupplyView_OnMoveCards),d.prototype.Init.call(this,t))},A.prototype.CardSupply_OnPreDealEvent=function(t){this.IsCardDragging=!1,this.SetupCardViews();for(var e=0;e<this.CardSupply.PileCount;e++){var i=this.CardSupply.GetPile(e);null!=i&&(this.GetPileView(i).NotifyDealing(),this.GetPileView(i).UpdatePosition())}},A.prototype.CardSupply_OnDealEvent=function(t){if(this.UpdatePileChildren(!0),this.GameInputInterpreter.ClearHighlight(),this.playDealSound(),this.revealIsRestricted||(this.alpha=1),this.setUpPileUpdate(),this.CardSupply.Authority.IsChallenge){var e=this.CardSupply.Authority.GetHint(!0);this.ClearHints(),this.DisplayHint(e)}},A.prototype.SetupPileViews=function(){this.ClearPileLookups(),this.ClearPileViewChildren();for(var t=0;t<this.CardSupply.PileCount;t++){var e=this.CardSupply.GetPile(t);if(null!=e){var i=new f(e,this);this.AddChild(i),this.AddPileToLookups(i)}}for(var t=0;t<this.CardSupply.PileCount;t++){var e=this.CardSupply.GetPile(t);if(null!=e){var i=this._viewFromPile.Get(e);"Foundation"==e.Type&&this.AddChild(i)}}},A.prototype.reversePiles=function(){var e=t.clone(this._pileViewList.items);e.reverse(),t.each(e,function(t){this.AddChild(t)}.bind(this))},A.prototype.undoReversePiles=function(){t.each(this._pileViewList.items,function(t){this.AddChild(t)}.bind(this))},A.prototype.bringPileAndCardToTop=function(t,e){this.AddChild(t),t.AddChild(e)},A.prototype.pileViewToIndex=function(t){this.AddChild(t)},A.prototype.AddKeyboardUIElement=function(t,e,i){var n=new KeyboardNavForUIElement(this,e,i);_uiKeyboardNavs.ContainsKey(t)?(_uiKeyboardNavs[t].TargetElement=e,_uiKeyboardNavs[t].OnActivate=i):_uiKeyboardNavs.Add(t,n)},A.prototype.RemoveKeyboardUIElement=function(t,e){},A.prototype.ClearKeyboardUIElements=function(){},A.prototype.GetKeyboardUI=function(t){return null},A.prototype.AddPileToLookups=function(t){this._pileFromView.Add(t,t.Pile),this._viewFromPile.Add(t.Pile,t),this._pileViewList.add(t)},A.prototype.ClearPileLookups=function(){this._pileFromView.Clear(),this._viewFromPile.Clear(),this._pileViewList.clear()},A.prototype.ClearPileViewChildren=function(){t.forEach(this.children,function(t){t instanceof f&&(t.UnregisterEvents(),this.RemoveChild(t))},this)},A.prototype.handleCommand=function(t){var e=m.KeyPress[t];if(void 0!==e)return null==this.KeyboardFocus?(this.Focused=!0,null!=this.KeyboardFocus&&(this.KeyboardFocus.OnGetKeyboardFocus()||this.KeyboardFocus.Keyboard.HandleKeypress(m.KeyPress.Tab))):this.KeyboardFocus.Keyboard.HandleKeypress(e),event.preventDefault(),!1},A.prototype.ReleaseKey=function(t){},A.prototype.SetupCardViews=function(){this.ClearCardViewGrandchildren(),this.ClearCardLookups(),t.forEach(this.CardSupply.GetCardList(),function(t){var e=new y(t,this);e.ScaleX=e.ScaleY=this.CardScale,this.AddCardToLookups(t,e)},this),this.Focused&&(this.Focused=!1),this.UpdatePileChildren(!0)},A.prototype.ClearCardViewGrandchildren=function(){t.forEach(this.CardSupply.GetCardList(),function(t){if(this._viewFromCard.ContainsKey(t.Sequence)){var e=this._viewFromCard.Get(t.Sequence);null!=e.Parent&&(e.UnregisterEvents(),e.Parent.RemoveChild(e))}},this)},A.prototype.AddCardToLookups=function(t,e){this._cardFromView.Add(e,t),this._viewFromCard.Add(t.Sequence,e),this._cardViewList.add(e)},A.prototype.ClearCardLookups=function(){this._cardFromView.Clear(),this._viewFromCard.Clear(),this._cardViewList.clear()},A.prototype.OnMoveCards=function(){null!=this.OnMoveCardsEvent&&this.OnMoveCardsEvent.handleEvent(this)},A.prototype.SupplyView_OnMoveCards=function(t){t.UpdatePileChildren(!1)},A.prototype.OnAutomaticMovesStart=function(){if(!this._isAutomaticMovesStarted){this._isAutomaticMovesStarted=!0;var t=this.AutomaticMovesStart;null!=t&&t()}},A.prototype.OnAutomaticMovesStop=function(){if(this._isAutomaticMovesStarted){this._isAutomaticMovesStarted=!1;var t=this.AutomaticMovesStop;null!=t&&t()}},A.prototype.RunAutomaticMoves=function(){this.AutomaticMovedUpdatedHandler||(this.AutomaticMovedUpdatedHandler=this.AutomaticMovesUpdated.bind(this),this.Updated.add(this.AutomaticMovedUpdatedHandler))},A.prototype.AutomaticMovesUpdated=function(t,e){if(this._timeSinceLastAutoMove+=u.Time.ElapsedGameTime.Milliseconds,this._timeSinceLastAutoMove>A.AutoMoveInterval){this._timeSinceLastAutoMove=0;var i=this.CardSupply.Authority.GetAutomaticMove();null!=i?(this.OnAutomaticMovesStart(),i.Run(),u.Sounds.PlaySound("foundation"),this.OnMoveCards(),null===this.CardSupply.Authority.GetAutomaticMove()&&(this.Updated.remove(this.AutomaticMovedUpdatedHandler),this.AutomaticMovedUpdatedHandler=null,this.OnAutomaticMovesStop())):(this.Updated.remove(this.AutomaticMovedUpdatedHandler),this.AutomaticMovedUpdatedHandler=null,this.OnAutomaticMovesStop())}},A.prototype.TellMouseDown=function(t,e,i){t instanceof f?this.TellMouseDownPileView(t):t instanceof y&&this.TellMouseDownCardView(t,e,i)},A.prototype.TellMouseDownPileView=function(t){var e=this.GameInputInterpreter.GetHighlightedCard(),i=null;null!=e&&(i=e.Card.Pile.Type),this.CardSupply.Authority.IsChallenge||this.ClearHints();var n=this.GameInputInterpreter.ClickEmptyPile(t);n.IsError()||n.Run()&&!n.IsNoop()&&this.RunAutomaticMoves(),this.OnMoveCards(),null!=e&&"Foundation"!=i&&"Foundation"==e.Card.Pile.Type&&u.Sounds.PlaySound("foundation")},A.prototype.TellMouseDownCardView=function(e,i,n){this.CardSupply.Authority.SuppressClearHintsOnMouseDown||this.ClearHints();var r=e.Card.Pile;if("Stock"===r.Name&&"Spider"===this.CardSupply.GameName){var o=r.Cards,a=[];t.each(o,function(t){a.push(this._viewFromCard.Get(t.Sequence))}.bind(this)),t.each(a,function(t){t.InputIsBlocked=!0}),setTimeout(function(){t.each(a,function(t){t.InputIsBlocked=!1})}.bind(this),1e3)}var s=this.GameInputInterpreter.ClickCard(e,i,n);if(!s.IsError()){if(this.KeyboardFocus=this.GetPileView(e.Card.Pile),s.IsMove()&&(e.LockMosueUpReveal=!0),s.Run()){if(null!=this.KeyboardFocus&&this.KeyboardFocus.Keyboard.Host instanceof f){var l=this.KeyboardFocus.Keyboard.Host;null!=l&&null!=l.FocusedCard&&this.GameInputInterpreter.ShouldMoveKeyboard(s,l.FocusedCard.Card)&&this.KeyboardFocus.Keyboard.HandleKeypress(m.KeyPress.Left)}"Stock"==r.Name&&"Stock"!=e.Card.Pile.Type&&(Math.abs(s.Ops[0].GetNumber(g.eMoveParams.NumCards))>1||s.Ops.length>2?"Spider"==this.CardSupply.GameName?(u.Sounds.StopSound("Deal_Spider_Draw"),u.Sounds.PlaySound("Deal_Spider_Draw")):u.Sounds.PlaySound("threeCards"):u.Sounds.PlaySound("singleCard")),e.Card.Pile!=r&&(e.IsDragging=!1,this.IsCardDragging=!1),s.IsNoop()||this.RunAutomaticMoves()}s.isAllowed||this.dealIsNotAllowed()}this.OnMoveCards()},A.prototype.TellMouseUp=function(i,n){var r=null;if(null==n){var a=this.toGlobal(new e.Point(i.X,i.Y)),s=i.CardFront.children.slice().pop().getBounds();t.forEach(this._cardViewList.items,function(t){if(t!=i&&t.Card.Pile!=i.Card.Pile&&o.rectsIntersect(t.CardFront.children.slice().pop().getBounds(),s)&&this.CardSupply.Authority.CanAcceptCards(t.Card.Pile)&&this._viewFromPile.ContainsKey(t.Card.Pile)){null==r&&(r=new l(f,Number));var e=this._viewFromPile.Get(t.Card.Pile),n=this.toGlobal(e.x,e.y),h=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2);r.ContainsKey(e)?h<r.Get(e)&&r.Add(e,h):r.Add(e,h)}},this),t.forEach(this._pileViewList.items,function(t){if(t.Pile.Empty&&t.Pile!=i.Card.Pile&&o.rectsIntersect(t.Background.getBounds(),s)&&this.CardSupply.Authority.CanAcceptCards(t.Pile)){null==r&&(r=new l(f,Number));var e=t,n=this.toGlobal(e.x,e.y),h=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2);r.ContainsKey(e)?h<r.Get(e)&&r.Add(e,h):r.Add(e,h)}},this)}else r=new l(f,Number),r.Add(n,0);if(null!=r){var h=r.GetKeys().map(function(t){return{key:t,value:r.Get(t)}});h.sort(function(t,e){return t.value.length-e.value.length});var d=h.map(function(t){return t.key}),c=this.GameInputInterpreter.Drop(i,d);c.IsError()||c.Run()&&this.RunAutomaticMoves()}else x.getSetting("general","singleTapToMove")&&("Klondike"!==this.CardSupply.GameName&&"Spider"!==this.CardSupply.GameName&&"FreeCell"!==this.CardSupply.GameName||i.HasJustBeenMoved||this.doSingleTap(i)),u.Sounds.PlaySound("illegalMove");this.OnMoveCards()},A.prototype.UpdatePileChildren=function(e){t.forEach(this.CardSupply.GetCardList(),function(t){if(this._viewFromCard.ContainsKey(t.Sequence)){var e=this._viewFromCard.Get(t.Sequence);null!=e.Parent&&e.Parent.RemoveChild(e)}},this),t.forEach(this.CardSupply.GetPileList(),function(e){if(null!=e){var i=this._viewFromPile.Get(e);t.forEach(e.GetCards(),function(t){try{var e=this._viewFromCard.Get(t.Sequence);i.AddChild(e)}catch(t){r.log(t)}},this)}},this)},A.prototype.doSingleTap=function(e){var i=this.CardSupply.Authority.GetCardHint(e.Card);if(i){if(i.Opcode===g.Op.Move){var n=e.Card.Pile.Cards,r=[];t.each(n,function(t){r.push(this._viewFromCard.Get(t.Sequence))}.bind(this));var o=i.GetPile(g.eMoveParams.DestPile),a=this.GetPileView(o);o.Empty?this.TellMouseDown(a,!1,!0):this.TellMouseDown(this.GetCardView(o.Top),!1,!0),this.GameInputInterpreter.ClickOutside(),t.each(r,function(t){t.InputIsBlocked=!0}),setTimeout(function(){t.each(r,function(t){t.InputIsBlocked=!1})},300)}}else{for(var s=e.Card.Pile,l=s.GetCardPosFromEnd(e.Card),h=[],u=l;u>0;u--)h.push(this._viewFromCard.Get(s.NthFromTop(u).Sequence));t.each(h,function(t){t.InputIsBlocked=!0}),this.GameInputInterpreter.ClickOutside(),setTimeout(function(){t.each(h,function(t){t.AnimateSingleTapRejection()}),setTimeout(function(){t.each(h,function(t){t.InputIsBlocked=!1})},200)},100)}},A.prototype.DisplayHint=function(t){if(null!=t&&t.Opcode!=g.Op.Noop)if(t.Opcode!=g.Op.Challenge){var e=t.GetPile(g.eMoveParams.SourcePile),i=t.GetPile(g.eMoveParams.DestPile),n=t.GetNumber(g.eMoveParams.NumCards);if(e.Empty)this._viewFromPile.Get(e).IsHinted=!0;else for(var r=0;r<n;r++)this._viewFromCard.Get(e.GetCardAtPos(e.Count-r-1).Sequence).IsHinted=!0;i.Empty?this._viewFromPile.Get(i).IsHinted=!0:this._viewFromCard.Get(i.Top.Sequence).IsHinted=!0}else{this.ClearHints();for(var r=0;r<t.GetNumParams();++r){var o=t.GetCard(r);this._viewFromCard.Get(o).IsGoalGlow=!0}}},A.prototype.dealIsNotAllowed=function(){this.CardSupply.Authority.GetEmptyColumns().forEach(function(t){this.GetPileView(t).dealIsNotAllowed()}.bind(this))},A.prototype.ClearKeyboardHighlight=function(){t.forEach(this._viewFromPile.GetValues(),function(t){t.Keyboard.HasKeyboardFocus=!1})},A.prototype.ClearHints=function(){t.forEach(this._viewFromCard.GetValues(),function(t){t.IsHinted=!1,t.IsGoalGlow=!1}),t.forEach(this._viewFromPile.GetValues(),function(t){t.IsHinted=!1}),null!=this.ClearHintsCallback&&this.ClearHintsCallback()},A.prototype.ClearRevealCardStates=function(e){t.forEach(this._viewFromCard.GetValues(),function(t){t!=e&&(t.IsRevealToShow=!1)})},A.prototype.LockMousUpRevealCard=function(e){t.forEach(this._viewFromCard,function(t){t.LockMouseUpReveal=e})},A.prototype.GetNextEndGameAnimation=function(){var t=a.fetch("EndGameAnimationState");if(t){var e=t.animationIndex+1;if(e>t.animationList.length-1){e=0;do{t.animationList.sort(function(){Math.random()})}while(t.animationList[e]==t.animationList[t.animationIndex])}t.animationIndex=e}else t={animationIndex:0,animationList:this.EndAnimationList};return a.store("EndGameAnimationState",t),t.animationList[t.animationIndex]},A.prototype.CreateGameEndAnimator=function(){var t;do{t=this.GetNextEndGameAnimation()}while("spider"==this.CardSupply.GameName.toLowerCase()&&"CardBounceWinAnimator"==t);var e;switch(t){case"KaleidoscopeWinAnimator":e=new C(this);break;case"ButterflyWinAnimator":e=new S(this);break;case"FireworksWinAnimator":e=new b(this);break;case"CardBounceWinAnimator":e=new v(this)}return e},A.prototype.Dispose=function(){},Object.defineProperty(A.prototype,"NavigatableName",{get:function(){return this.Name}}),Object.defineProperty(A.prototype,"Navigatable",{get:function(){return this._navigatable},set:function(t){this._navigatable=t}}),Object.defineProperty(A.prototype,"NavigatableVisibility",{get:function(){return this.Visible},set:function(t){this.Visible=t}}),Object.defineProperty(A.prototype,"Focused",{get:function(){return this._focused},set:function(t){this._focused!=t&&(this._focused=t,this.OnChangedFocus())}}),A.prototype.FocusedStateAction=function(t){},A.prototype.DeactivateInputAndNavigation=function(){this.InputEnabled=!1,this.GameInputInterpreter.InputEnabled=!1,this.Navigatable=!1},A.prototype.ActivateInputAndNavigation=function(){this.DeactivateInputAndNavigation(),this.InputEnabled=!0,this.GameInputInterpreter.InputEnabled=!0,this.Navigatable=!0},A.prototype.setActiveLastCard=function(t){var e=this.GetPileView("Waste");this.KeyboardFocus&&(e.Pile.Cards.length?(this.GameInputInterpreter.removeHighlightedCard(),this.ClearHints(),e.FanLimit=t,this.KeyboardFocus.Keyboard.GetKeyboardFocus()):(this.KeyboardFocus.Keyboard.LoseKeyboardFocus(),this.KeyboardFocus=this.GetPileView("Stock"),this.KeyboardFocus.Keyboard.GetKeyboardFocus()))},A.prototype.playDealSound=function(){if(this.game.ui,this.dealSoundIsAllowed){var t=0,e="Deal_Klondike";switch(this.CardSupply.GameName){case"Klondike":e="Deal_Klondike",t=600;break;case"Spider":e="Deal_Spider_Draw",t=400;break;case"FreeCell":e="Deal_FreeCell",t=400;break;case"Pyramid":e="Deal_Pyramid",t=700;break;case"TriPeaks":e="Deal_TriPeaks",t=50}setTimeout(function(){u.Sounds.PlaySound(e)}.bind(this),t)}},A.prototype.getModeSpecificDimensions=function(){var t=200,e=200;switch(this.CardSupply.GameName){case"Klondike":t=1300,e=1e3;break;case"Spider":t=1640,e=1010;break;case"FreeCell":t=1620,e=1070;break;case"Pyramid":t=1450,e=1050;break;case"TriPeaks":t=1650,e=1050}return{width:P.Coords.x(t),height:P.Coords.y(e)}},A.prototype.getModeSpecificOffset=function(){var t=200,e=200;switch(this.CardSupply.GameName){case"Klondike":case"Spider":t=0,e=-30;break;case"FreeCell":t=0,e=-60;break;case"Pyramid":t=0,e=-40;break;case"TriPeaks":t=0,e=-40}return{x:P.Coords.x(t),y:P.Coords.y(e)}},A.prototype.setUpPileUpdate=function(t){this.hasBeenDestroyed||(clearTimeout(this.pileUpdateInterval),clearTimeout(this.pileUpdateTimeout),"FreeCell"===this.CardSupply.GameName&&(this.pileUpdateInterval=setInterval(function(){this.OnMoveCards()}.bind(this),100),this.pileUpdateTimeout=setTimeout(function(){clearInterval(this.pileUpdateInterval)}.bind(this),t?500:4e3)))},A.prototype.handleWindowFocus=function(){this.hasBeenDestroyed||this.CardSupply&&"FreeCell"===this.CardSupply.GameName&&this.setUpPileUpdate(!0)},A}),define("SolitaireShared/KlondikeTemplate/KlondikeInputInterpreter",["absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","CardUI/PileView","util/SettingsManager","SolitaireShared/CardLogic/Pile"],function(t,e,i,n,r,o,a,s){var l=function(t){this.initKlondikeInputInterpreter(t)};return l.DoubleClickThreshold=700,l.prototype.initKlondikeInputInterpreter=function(t){this.Authority=t,this.IsClickedOnCard=!1,this.InputEnabled=!0,this.HighlightedCard=null,this.HighlightTime=-1},l.prototype.Grab=function(t){var e=[],i=t.SupplyView,n=t.Card.Pile;if("Stock"==n.Name)return e;if(i.GetPileView(n).CardFacing!=o.Facing.FaceUp)return e;var r=n.GetCardPosFromEnd(t.Card);if(r>0)for(var a=n.Count-r;a<n.Count;a++){var s=n.GetCardAtPos(a);if(null!=s){var l=i.GetCardView(s);null!=l&&e.Add(l)}}return e},l.prototype.Drag=function(t,e){return!0},l.prototype.NotifyCardsMoved=function(){this.ClearHighlight()},l.prototype.DoMoveCard=function(t,e,i,n){null!=this.CardMove&&this.CardMove.Invoke(t,e,i,n);var r=e.GetCardPosFromEnd(t);if("Tableau"==e.Type){var o=this.Authority.FaceDownForTableau(e);null!=o&&o.Count>0&&e.Count==r?(n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",o.Name,e.Name,"1","end"]),n.IsAllowed()&&this.Authority.CardSupply.OnFlipCard()):n.Parse(["move",e.Name,i.Name,r.toString()])}else if("Waste"==e.Type)n.Parse(["move",e.Name,i.Name,r.toString()]);else{if("Foundation"!=e.Type)return!1;n.Parse(["move",e.Name,i.Name,r.toString()])}return!0},l.prototype.Drop=function(t,n){var r=!1,o=t.Card.Supply,a=new i(o);a.Parse(["noop"]);for(var l=0;l<n.length;l++){var h=n[l],u=t.Card,d=u.Pile,c=h instanceof s?h:h.Pile;if(d!=c&&(this.ClearHighlight(),this.DoMoveCard(u,d,c,a),a.IsAllowed())){if("Foundation"==c.Type?(e.Sounds.PlaySound("foundation"),r=!0):(e.Sounds.PlaySound("legalMove"),r=!0),"Waste"==d.Type){var p=t.Parent;p.FanLimit=Math.max(p.FanLimit-1,1)}break}}return r||e.Sounds.PlaySound("illegalMove"),a},l.TryFoundationPiles=["Foundation0","Foundation1","Foundation2","Foundation3"],l.prototype.ClickCard=function(t,r){var o=t.Card.Supply,s=new i(o);if(s.Parse(["noop"]),!this.InputEnabled)return s;if(r)return this.OrganizeDoubleClick(t,s,!1),s;if(this.IsCardHighlighted()&&"Stock"!=t.Card.Pile.Type)if(this.HighlightedCard==t&&"Foundation"!=t.Card.Pile.Type){var h=e.Time.TotalGameTime.TotalMilliseconds;if(!a.getSetting("default","singleTapToMove")&&h-this.HighlightTime<l.DoubleClickThreshold){var u=null;if(t.Card.Value==n.Values.Ace&&this.Authority.CardSupply.EnforceGameRules)for(var d=0;d<l.TryFoundationPiles.length;d++){var c=l.TryFoundationPiles[d];if(u=this.Authority.CardSupply.GetPile(c),u.Empty)break;u=null}else for(var d=0;d<l.TryFoundationPiles.length;d++){var c=l.TryFoundationPiles[d];if(u=this.Authority.CardSupply.GetPile(c),!this.Authority.CardSupply.EnforceGameRules&&u.Count<13||!u.Empty&&t.Card.Suit==u.Top.Suit&&t.Card.ValueNum==u.Top.ValueNum+1){this.ClearHighlight();break}u=null}if(null!=u&&t.Card==t.Card.Pile.Top){if(this.DoMoveCard(t.Card,t.Card.Pile,u,s),e.Sounds.PlaySound("foundation"),"Waste"==t.Card.Pile.Type){var p=t.Parent;p.FanLimit=Math.max(p.FanLimit-1,1)}this.ClearHighlight()}}else this.HighlightTime=e.Time.TotalGameTime.TotalMilliseconds}else{var g=this.HighlightedCard.Card,p=this.HighlightedCard.Parent,f=g.Pile,y=t.Card.Pile;f!=y?(this.DoMoveCard(g,f,y,s),s.IsAllowed()?(this.ClearHighlight(),t.IsDragging=t.SupplyView.IsCardDragging=!1):this.HighlightCard(t)):this.Authority.CanPickupCard(t.Card)&&this.HighlightCard(t),s.IsAllowed()&&("Foundation"==t.Card.Pile.Type?e.Sounds.PlaySound("foundation"):e.Sounds.PlaySound("legalMove"),"Waste"==f.Type&&"Waste"!=y.Type&&(p.FanLimit=Math.max(p.FanLimit-1,1)))}else{var m=t.Card.Pile;if("Stock"!=m.Name||m.Supply.WaitingForAnimation)this.Authority.CanPickupCard(t.Card)&&this.HighlightCard(t);else{var C=parseInt(this.Authority.CardSupply.GetOption("Draw")),S=m.Count;S>C&&(S=C),s.Parse(["move","Stock","Waste",(-S).toString()]);var b=t.SupplyView.GetPileView("Waste");"3"==m.Supply.GetOption("Draw")&&(b.FanLimit=3),this.Authority.CardSupply.OnFlipCard(),this.ClearHighlight()}}return s},l.prototype.OrganizeDoubleClick=function(t,i,r){var s=e.Time.TotalGameTime.TotalMilliseconds;if(a.getSetting("default","singleTapToMove")||!(s-this.HighlightTime<l.DoubleClickThreshold)&&r)this.HighlightTime=e.Time.TotalGameTime.TotalMilliseconds;else{var h=null;if(t.Card.Value==n.Values.Ace&&this.Authority.CardSupply.EnforceGameRules&&"Foundation"!=t.Card.Pile.Type){for(var u=0;u<l.TryFoundationPiles.length;u++){var d=l.TryFoundationPiles[u];if(h=this.Authority.CardSupply.GetPile(d),h.Empty)break;h=null}this.ClearHighlight()}else for(var u=0;u<l.TryFoundationPiles.length;u++){var d=l.TryFoundationPiles[u];if(h=this.Authority.CardSupply.GetPile(d),!this.Authority.CardSupply.EnforceGameRules&&h.Count<13||!h.Empty&&t.Card.Suit==h.Top.Suit&&t.Card.ValueNum==h.Top.ValueNum+1){this.ClearHighlight();break}h=null}if(null!=h&&t.Card.Equals(t.Card.Pile.Top)&&t.Parent.CardFacing==o.Facing.FaceUp){if(this.DoMoveCard(t.Card,t.Card.Pile,h,i),e.Sounds.PlaySound("foundation"),"Waste"==t.Card.Pile.Type){var c=t.Parent;c.FanLimit=Math.max(c.FanLimit-1,1)}this.ClearHighlight()}}},l.prototype.ClickEmptyPile=function(t){var n=t.Pile.Supply,r=new i(n);if(r.Parse(["noop"]),!this.InputEnabled)return r;if(this.IsCardHighlighted()){var o=this.HighlightedCard.Card,a=o.Pile,s=t.Pile;this.DoMoveCard(o,a,s,r),this.ClearHighlight(),e.Sounds.PlaySound("legalMove")}else{if("Stock"==t.Pile.Name&&!t.SupplyView.CardSupply.WaitingForAnimation){var l=n.GetPile("Waste");r.Parse(["move","Waste","Stock",(-l.Count).toString()]),r.IsAllowed()&&e.Sounds.PlaySound("drawReset")}}return r},l.prototype.ClickOutside=function(){this.ClearHighlight()},l.prototype.IsCardHighlighted=function(){return null!=this.HighlightedCard},l.prototype.GetHighlightedCard=function(){return this.HighlightedCard},l.prototype.removeHighlightedCard=function(){this.HighlightedCard=null},l.prototype.HighlightCard=function(i){i!=this.HighlightedCard&&(this.ClearHighlight(),this.HighlightedCard=i,this.HighlightTime=e.Time.TotalGameTime.TotalMilliseconds),t.log("HighlightCard("+i.Card+")")},l.prototype.ClearHighlight=function(){null!=this.HighlightedCard&&(this.HighlightedCard=null,this.HighlightTime=-1),t.log("ClearHighlight()")},l.prototype.TryAutoSolve=function(t){if(null!=this.Authority){for(var e={},i=new[r.Hearts,r.Diamonds,r.Clubs,r.Spades],n=0;n<4;n++){var o=this.Authority.CardSupply.GetPile("Foundation"+n);if(!o.Empty){var a=o.Top.Suit;e[a]=o,i.splice(i.indexOf(a),1)}}if(i.length>0)for(var n=0;n<4;n++){var o=this.Authority.CardSupply.GetPile("Foundation"+n);if(o.Empty){var a=i[0];e[a]=o,i.splice(0,1)}}}},l.prototype.AutoSolve_DoNextMove=function(t){var n,o;if(t[r.Hearts].Count<13||t[r.Clubs].Count<13||t[r.Diamonds].Count<13||t[r.Spades].Count<13){var a=new i(this.Authority.CardSupply);if(n=Authority.CardSupply.GetPile("Waste"),!n.Empty&&(o=t[n.Top.Suit],this.DoMoveCard(n.Top,n,o,a),a.Run(!1)))return e.Sounds.PlaySound("foundation"),!0;for(var s=0;s<7;s++)if(n=this.Authority.CardSupply.GetPile("Tableau"+s),!n.Empty&&(o=t[n.Top.Suit],this.DoMoveCard(n.Top,n,o,a),a.Run(!1)))return e.Sounds.PlaySound("foundation"),!0}return!1},l.prototype.ShouldMoveKeyboard=function(t,e){return!1},l.prototype.DealNextFromStock=function(t){var n=this.Authority.CardSupply,r=new i(n),o=n.GetPile("Stock").Count,a=n.GetPile("Waste").Count,s=parseInt(n.GetOption("Draw"));n.GetPile("Stock").Empty?(r.Parse(["begin","move","Waste","Stock","-"+a,"end"]),r.IsAllowed()&&e.Sounds.PlaySound("drawReset")):o<=s?r.Parse(["begin","move","Stock","Waste","-"+o,"end"]):r.Parse(["begin","move","Stock","Waste","-"+s,"end"]),r.IsAllowed()&&(3==s&&o>=3?e.Sounds.PlaySound("threeCards"):e.Sounds.PlaySound("singleCard")),r.Run()&&(3==s?t.setActiveLastCard(s):1==s&&t.setActiveLastCard(s))},l}),define("SolitaireShared/KlondikeTemplate/KlondikeCardAnimator",["lodash","pixi","util/dictionary","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween","SolitaireShared/CardLogic/CardOp","CardUI/PileView","CardUI/CardView","CardUI/SupplyView"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t){this.initKlondikeCardAnimator(t)};return u.AnimationEntry=function(){this.initAnimationEntry()},u.AnimationEntry.prototype.initAnimationEntry=function(){this.WorldPos=new e.Point,this.WorldRot=0,this.WorldScale=new e.Point(1,1),this.CardFlip=0,this.Wait=0,this.Speed=0,this.ForceLayer=0,this.ForceLayer2=0,this.SoundToPlayAtFinish=null},u.prototype.initKlondikeCardAnimator=function(t){this.SupplyView=t,this._animationList=new i(r,Array),this._tweenCache={},this.WinAnimator=null,this.AnimationLength=.2,this.AnimationDelay=.1,this.CardDelay=.05,this.AnimLengthDraw=.2,this.CardDelayDraw=.1,this._animationDelayTimer=0,this._isInAnimationSet=!1,this._isInAnimationSet=!1,this._animationDelayTimer=0,this._dealCardNum=0,this._isDeal=!1,this._isUndoing=!1,this._animatingAction=null,this._animationLock={},this.OnShuffleFinished=null,this._isShuffling=!1,this._showButterfly=!1,this._nextAnimationDelay=0,this._nextAnimationAction=null,this._tweensToFinish=0},u.prototype.BeginAnimationSet=function(t){this._isInAnimationSet=!0,this._animationDelayTimer=0,this._animationList=new i(r,Array),this._dealCardNum=0,this._isDeal=!1},u.prototype.EndAnimationSet=function(){this._isInAnimationSet=!1},u.prototype.BeginAnimation=function(e,i){
this._isInAnimationSet||(this._animationDelayTimer=0,this._animationList.Clear(),this._dealCardNum=0,this._isDeal=!1),this._animatingAction=e,this._isUndoing=i,t.forEach(this.SupplyView.CardSupply.GetCardList(),function(t){var e=this.SupplyView.GetCardView(t);if(!this._animationList.ContainsKey(e)){var i=new u.AnimationEntry;i.Wait=this._animationDelayTimer,i.Speed=0,i.WorldPos=e.parent.toGlobal(e.position),this._animationList.Add(e,[i])}},this)},u.prototype.ContinueAnimation=function(t,i){this.SupplyView.UpdatePileChildren(!1);var n=this.AnimationLength,h=this.AnimationDelay,d=this.CardDelay;this.SupplyView.CardSupply.EnforceGameRules||(n=.2,h=.06,d=0);var c=t.Ops[i];if(c.Opcode===a.Op.Move){var p=c.GetPile(a.eMoveParams.SourcePile),g=c.GetPile(a.eMoveParams.DestPile),f=c.GetNumber(a.eMoveParams.NumCards);if("Stock"===p.Type&&(n=this.AnimLengthDraw,d=this.CardDelayDraw),this._isUndoing){var y=p;if(p=g,g=y,"Waste"===g.Type&&"3"===this.SupplyView.CardSupply.GetOption("Draw")){var m=this.SupplyView.GetPileView(g);m.FanLimit=Math.min(m.FanLimit+1,3)}d*=.25,h*=.25,n*=.25}var C=this.SupplyView.GetPileView(p),S=this.SupplyView.GetPileView(g),b=!1;f<0&&(f=-f,b=!0),f>24?(d*=.1,this._isDeal=!0):f>6&&(d*=.25),C.CardFacing===s.Facing.Hidden||S.CardFacing===s.Facing.Hidden?(n=0,h=0,d=0):this._nextAnimationDelay>0&&(this._animationDelayTimer+=this._nextAnimationDelay,this._nextAnimationDelay=0);for(var v=0;v<f;v++){var w=v+1;b&&(w=f-v);var x=g.NthFromTop(w),T=this.SupplyView.GetCardView(x);T instanceof l&&(T.Animating=!0);var M=new u.AnimationEntry;M.Wait=this._animationDelayTimer,M.Speed=n,"FaceDown"!==p.Type&&S.parent.setChildIndex(S,S.parent.children.length-1);var _=T.GetCardPositionInPile(null,!0);if(M.WorldPos=T.Parent.toGlobal(_),M.CardFlip=S.CardFacing===s.Facing.FaceDown?1:0,"Stock"===p.Type&&"Waste"===g.Type?M.ForceLayer2=l.TopLayer+v+1:(this._isDeal&&f<52&&(M.ForceLayer=l.TopLayer+1+x.Supply.Count-this._dealCardNum,M.ForceLayer2=l.TopLayer+1+x.Supply.Count+this._dealCardNum,this._dealCardNum++),C.CardFacing===s.Facing.FaceDown&&S.CardFacing===s.Facing.FaceUp&&(M.SoundToPlayAtFinish="flipCard")),"Foundation"===g.Type&&!this._isUndoing){var P=new r("foundation_effect.png");P.Position=S.Position,P.TextureAlphaEnabled=!0,P.InputEnabled=!1,P.ScaleUniform=l.ScaleFactor,P.Alpha=1,this.SupplyView.AddChildAt(P,0);o.Start(P).Wait(.15).Then().ScaleTo(new e.Point(1.5*l.ScaleFactor,1.5*l.ScaleFactor),.8,TWEEN.Easing.Cubic.Out).And().FadeTo(0,.8,TWEEN.Easing.Cubic.Out).Then().Call(function(t){t.Parent.RemoveChild(t)})}this._animationList.Get(T).push(M),f>1&&(this._animationDelayTimer+=d)}}this._animationDelayTimer+=h},u.prototype.EndAnimation=function(i,r){var a={};this._tweensToFinish=0,t.forEach(this._animationList.GetKeys(),function(t){var s=this._animationList.Get(t);if(!(s.length<2)){this._tweensToFinish++;var h;if(a[t.Id.toString()])h=a[t.Id.toString()].Then();else{var u=o.GetTweens(t);h=null!=u&&u.length>0?u[0].Then():o.Start(t),h.Completed=function(t,e){delete a[e.Id.toString()]},a[t.Id.toString()]=h}for(var d=0;d<s.length;d++){var c=s[d],p=t.parent.toLocal(c.WorldPos),g=new e.Point(1/t.scale.x,1/t.scale.y);if(null!=c.ForceLayer&&t instanceof l&&(t.LayerWhileAnimating=c.ForceLayer.Value),"FaceDown"!==t.parent.Pile.Type&&t.parent.parent.setChildIndex(t.parent,t.parent.parent.children.length-1),0===d)t.SetPosition(p),t.SetScale(g);else{if(h=h.Wait(c.Wait).Then(),c.Wait>0&&null!=this._nextAnimationAction){var f=this._nextAnimationAction;h=h.Call(f).And(),this._nextAnimationAction=null}null!=c.ForceLayer2&&t instanceof l&&(h=h.Call(function(t){t.LayerWhileAnimating=c.ForceLayer2.Value}).And()),h=h.MoveTo(p,c.Speed,TWEEN.Easing.Cubic.Out).And().ScaleTo(g,c.Speed,TWEEN.Easing.Cubic.Out),t instanceof l&&(h=h.And().CustomTo(t.SetCardFlipAngle.bind(t),t.GetCardFlipAngle.bind(t),c.CardFlip,c.Speed,TWEEN.Easing.Quintic.Out))}h=h.Then(),(null!=c.ForceLayer||null!=c.ForceLayer2)&&t instanceof l&&(h=h.Call(function(t){t instanceof l&&(t.LayerWhileAnimating=null)})),null!=c.SoundToPlayAtFinish&&h.Call(function(){i&&i.Ops&&i.Ops.length&&i.Ops.length>20||n.Sounds.PlaySound(c.SoundToPlayAtFinish)})}h=h.Call(function(t){this.StopAnimating(t)}.bind(this)),h.Call(function(t){this.EndAnimTrigger(r)}.bind(this))}},this),this._tweenCache={},this._tweensToFinish<=0&&r(i),this._nextAnimationDelay=0},u.prototype.StopAnimating=function(t){t instanceof l&&(t.Animating=!1)},u.prototype.EndAnimTrigger=function(t){this._animationList.Clear(),--this._tweensToFinish<=0&&(this._isShuffling&&(this._isShuffling=!1,null!=this.OnShuffleFinished&&this.OnShuffleFinished()),null!=t&&t(this._animatingAction))},u.prototype.BeginShuffleAnimation=function(){null!=this.WinAnimator&&this.WinAnimator.EndAnimation(),this._isShuffling=!0},u.prototype.IsShuffleAnimationRunning=function(){return this._isShuffling},u.prototype.ShouldShowEndingPopup=function(){return null==this.WinAnimator||this.WinAnimator.ShouldShowEndingPopup()},u.prototype.TriggerWinAnimation=function(t){if(this.SupplyView.CardSupply.Authority.IsChallenge)this.WinAnimator=null,null!=t&&t();else{if(this.SupplyView.CurrentLayout===h.LayoutState.VerticalView)return void(null!=t&&t());this.WinAnimator=this.SupplyView.CreateGameEndAnimator(),this._showButterfly=!this._showButterfly,this.WinAnimator.BeginAnimation(t,null,null,!1)}},u.prototype.DoesAnimationBlockInput=function(t){return!1},u.prototype.DelayNextAnimation=function(t){this._nextAnimationDelay=t},u.prototype.OnNextAnimationStart=function(t){this._nextAnimationAction=t},u}),define("SolitaireShared/KlondikeTemplate/KlondikeWindowsTemplate",["lodash","pixi","util/eventhandler","Arkadium/GameEngine/Core/EngineManagers","CardUI/SupplyView","CardUI/PileView","CardUI/KeyboardNavigator","SolitaireShared/CardLogic/Supply","SolitaireShared/KlondikeLogic/KlondikeAuthority","SolitaireShared/KlondikeTemplate/KlondikeInputInterpreter","SolitaireShared/KlondikeTemplate/KlondikeCardAnimator","SolitaireShared/CardLogic/CardSuit","SolitaireShared/CardLogic/CardAction","util/SettingsManager","Arkadium/GameEngine/Maths/Vector2","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){var y=function(){this.initKlondikeWindowsTemplate()};return y.prototype.initKlondikeWindowsTemplate=function(){this._authorityReference=null,this._supplyViewReference=null,this._curAutoSolveView=null,this._curAutoSolveViewOnUpdated=new i,this.settingsManager=p,this.mobilePileSpacingOffset=.3,this.defaultPileSpacingOffset=.2},y.prototype.CreateAuthority=function(t){var e=null!=t?t.ConstructAuthority():new l;return e.Setup(),e.CardSupply.DeckSeed=null,this._authorityReference=e,e},y.prototype.Cleanup=function(){this._supplyViewReference.OnMoveCardsEvent.remove(this.OnMoveCardsHandler),this._authorityReference=null,this._supplyViewReference=null},y.prototype.CreateInputInterpreter=function(t){return new h(t)},y.prototype.CreateCardAnimator=function(t){return new u(t)},y.prototype.InputManager_OnMouseDown=function(t){null!=this._supplyViewReference&&this.TryAutoSolve(this._supplyViewReference)},y.SuitMap=["none","clubs","diamonds","hearts","spades"],y.prototype.TryAutoSolve=function(e){if(null!=this._authorityReference){var i={},n=[d.Hearts,d.Diamonds,d.Clubs,d.Spades];t.times(4,function(r){var o=e.CardSupply.GetPile("Foundation"+r);if(!o.Empty){var a=o.Top.Suit;i[y.SuitMap[a]]=o,t.pull(n,a)}},this),n.length>0&&t.times(4,function(r){var o=e.CardSupply.GetPile("Foundation"+r);if(o.Empty){var a=n[0],s=y.SuitMap[a];i[s]=o,t.pull(n,a)}},this);var r=0;this._curAutoSolveView=e,this._curAutoSolveViewOnUpdated=function(t,e){if(null==this._curAutoSolveView)return!1;(r+=e.ElapsedGameTime.Milliseconds)>100&&(r=0,this.AutoSolveDoNextMove(i)?this._curAutoSolveView.OnMoveCards():this.StopAutoSolving())}.bind(this),this._curAutoSolveView.Updated.add(this._curAutoSolveViewOnUpdated)}},y.prototype.StopAutoSolving=function(){null!=this._curAutoSolveView&&(this._curAutoSolveView.Updated.remove(this._curAutoSolveViewOnUpdated),this._curAutoSolveView=null,this._curAutoSolveViewOnUpdated=null)},y.prototype.AutoSolveDoNextMove=function(t){if(t.hearts.Count<13||t.clubs.Count<13||t.diamonds.Count<13||t.spades.Count<13){var e,i=new c(this._authorityReference.CardSupply),r=this._authorityReference.CardSupply.GetPile("Waste");if(!r.Empty&&(e=t[y.SuitMap[r.Top.Suit]])&&(this._supplyViewReference.GameInputInterpreter.DoMoveCard(r.Top,r,e,i),i.Run(!1)))return n.Sounds.PlaySound("foundation"),!0;for(var o=0;o<7;o++)if(r=this._authorityReference.CardSupply.GetPile("Tableau"+o),!r.Empty&&(e=t[y.SuitMap[r.Top.Suit]])&&(this._supplyViewReference.GameInputInterpreter.DoMoveCard(r.Top,r,e,i),i.Run(!1)))return n.Sounds.PlaySound("foundation"),!0}return!1},y.prototype.switchLayoutDirection=function(e){this._supplyViewReference=supplyView;n.Display.Width,n.Display.Height;t.forEach(supplyView.CardSupply.GetPileList(),function(t){if(null!=t){var e=supplyView.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}},this);var i,r=[-.28125,-.1875,-.09375,0,.09375,.1875,.28125];i=supplyView.GetPileView("Root"),i.LogicalScreenPos=new g(r[0]-99,-99.31),i.DefaultPileSpacing=new g(0,0),i.CardFacing=o.Facing.FaceDown,i=supplyView.GetPileView("Stock"),i.LogicalScreenPos=new g("1"===e?r[0]:r[6],-.31),i.DefaultPileSpacing=new g(0,0),i.DisplayType=o.Display.Circle,i.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,i.Keyboard.ResetKeypressHandlers(),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,supplyView.GetPileView("Foundation0")),i=supplyView.GetPileView("Waste"),i.LogicalScreenPos=new g("1"===e?r[1]:r[4]+.045,-.31),i.PileMode=o.Layout.FanRight,f.Platform.isMobile()?i.DefaultPileSpacing=new g(this.mobilePileSpacingOffset,0):i.DefaultPileSpacing=new g(this.defaultPileSpacingOffset,0),i.DisplayType=o.Display.Blank,i.KeyboardMode=o.KeyboardModes.TopCard,i.Keyboard.ResetKeypressHandlers(),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Tableau1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,supplyView.GetPileView("Stock"));for(var s=0;s<7;s++)i=supplyView.GetPileView("FaceDown"+s),i.PileMode=o.Layout.FanDown,i.LogicalScreenPos=new g(r[s],.42-.5),i.DefaultPileSpacing=new g(0,.1);for(var s=0;s<7;s++)i=supplyView.GetPileView("Tableau"+s),i.PileMode=o.Layout.FanDown,i.LogicalScreenPos=new g(r[s],.42-.5),i.DefaultPileSpacing=new g(0,.24),i.DisplayType=o.Display.Blank,i.HeightLimit=.97,i.KeyboardMode=o.KeyboardModes.AllCardsAndEmpty,i.Keyboard.ResetKeypressHandlers(),0==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau1"))):1==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau2"))):2==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau3"))):3==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau2")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau4"))):4==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Foundation1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Foundation1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau3")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau5"))):5==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Foundation2")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Foundation2")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau4")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Tableau6"))):6==s&&(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Foundation3")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Tableau5"))),i.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,supplyView.GetPileView("Foundation0"));for(var s=0;s<4;s++)i=supplyView.GetPileView("Foundation"+s),i.LogicalScreenPos=new g(r[s+3],-.31),i.DefaultPileSpacing=new g(0,0),i.DisplayType=o.Display.Tableau,i.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,i.Keyboard.ResetKeypressHandlers(),0==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Tableau3")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau3")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Foundation1"))):1==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Tableau4")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau4")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Foundation0")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Foundation2"))):2==s?(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,supplyView.GetPileView("Tableau5")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau5")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Foundation1")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,supplyView.GetPileView("Foundation3"))):3==s&&(i.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,supplyView.GetPileView("Tableau6")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,supplyView.GetPileView("Foundation2"))),i.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,supplyView.GetPileView("Waste")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,supplyView.GetPileView("Stock")),i.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,supplyView.GetPileView("Tableau0"));supplyView.DefaultKeyboardFocus=supplyView.GetPileView("Stock"),supplyView.CardScale=1,i=supplyView.GetPileView("Root"),i.CardFacing=o.Facing.Hidden,i.PileMode=o.Layout.Pile,i.InteractionMode=o.Interaction.None,i.ScaleX=1,i.ScaleY=1,i=supplyView.GetPileView("Stock"),i.CardFacing=o.Facing.FaceDown,i.PileMode=o.Layout.Pile,i.InteractionMode=o.Interaction.Click,i.ScaleX=1,i.ScaleY=1,i=supplyView.GetPileView("Waste"),i.CardFacing=o.Facing.FaceUp,i.InteractionMode=o.Interaction.Drag,i.ScaleX=1,i.ScaleY=1,i.FanLimit="3"==supplyView.CardSupply.GetOption("Draw")?3:1;for(var s=0;s<7;s++)i=supplyView.GetPileView("Tableau"+s),i.CardFacing=o.Facing.FaceUp,i.InteractionMode=o.Interaction.Drag,i.StackedPile=supplyView.GetPileView("FaceDown"+s),i.ScaleX=1,i.ScaleY=1;for(var s=0;s<7;s++)i=supplyView.GetPileView("FaceDown"+s),i.CardFacing=o.Facing.FaceDown,i.ScaleX=1,i.ScaleY=1;for(var s=0;s<4;s++)i=supplyView.GetPileView("Foundation"+s),i.CardFacing=o.Facing.FaceUp,i.PileMode=o.Layout.Pile,i.InteractionMode=o.Interaction.Drag,i.ScaleX=1,i.ScaleY=1;this.OnMoveCardsHandler=this.SupplyView_OnMoveCards.bind(this),supplyView.OnMoveCardsEvent.add(this.OnMoveCardsHandler);var h=supplyView.GetPileView("Stock"),u=this._authorityReference.CardSupply.GetOption("Scoring");this._authorityReference.PassesThroughDeck>1&&(u==l.LAS_VEGAS||u==l.LAS_VEGAS_CUMULATIVE)&&h.DisplayType!=o.Display.X&&(h.DisplayType=o.Display.X)},y.prototype.DoLayoutPiles=function(e,i){var r="1"===p.getSetting("klondike","layoutDirection");this._supplyViewReference=i;n.Display.Width,n.Display.Height;t.forEach(i.CardSupply.GetPileList(),function(t){if(null!=t){var e=i.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}},this);var s,h=[-.28125,-.1875,-.09375,0,.09375,.1875,.28125];s=i.GetPileView("Root"),s.LogicalScreenPos=new g(h[0]-99,-99.31),s.DefaultPileSpacing=new g(0,0),s.CardFacing=o.Facing.FaceDown,s=i.GetPileView("Stock"),s.LogicalScreenPos=new g(r?h[0]:h[6],-.31),s.DefaultPileSpacing=new g(0,0),s.DisplayType=o.Display.Circle,s.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,s.Keyboard.ResetKeypressHandlers(),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Foundation0")),s=i.GetPileView("Waste"),s.LogicalScreenPos=new g(r?h[1]:h[4]+.045,-.31),s.PileMode=o.Layout.FanRight,f.Platform.isMobile()?s.DefaultPileSpacing=new g(this.mobilePileSpacingOffset,0):s.DefaultPileSpacing=new g(this.defaultPileSpacingOffset,0),s.DisplayType=o.Display.Blank,s.KeyboardMode=o.KeyboardModes.TopCard,s.Keyboard.ResetKeypressHandlers(),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Stock"));for(var u=0;u<7;u++)s=i.GetPileView("FaceDown"+u),s.PileMode=o.Layout.FanDown,s.LogicalScreenPos=new g(h[u],.42-.5),f.Platform.isMobile()?s.DefaultPileSpacing=new g(0,.15):s.DefaultPileSpacing=new g(0,.1);for(var u=0;u<7;u++)s=i.GetPileView("Tableau"+u),s.PileMode=o.Layout.FanDown,s.LogicalScreenPos=new g(h[u],.42-.5),s.DefaultPileSpacing=new g(0,.24),s.DisplayType=o.Display.Blank,s.HeightLimit=.97,f.Platform.isMobile()&&!f.ScreenMetrics.isPortrait()&&(s.DefaultPileSpacing=new g(0,.35),this._authorityReference.IsChallenge?s.HeightLimit=.77:s.HeightLimit=.8),s.KeyboardMode=o.KeyboardModes.AllCardsAndEmpty,s.Keyboard.ResetKeypressHandlers(),0==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau1"))):1==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau2"))):2==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau3"))):3==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau2")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau4"))):4==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Foundation1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Foundation1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau3")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau5"))):5==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Foundation2")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Foundation2")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau4")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau6"))):6==u&&(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Foundation3")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau5"))),s.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Foundation0"));for(var u=0;u<4;u++)s=i.GetPileView("Foundation"+u),s.LogicalScreenPos=new g(r?h[u+3]:h[u],-.31),s.DefaultPileSpacing=new g(0,0),s.DisplayType=o.Display.Tableau,s.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,s.Keyboard.ResetKeypressHandlers(),0==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau3")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau3")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation1"))):1==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau4")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau4")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Foundation0")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation2"))):2==u?(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau5")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau5")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Foundation1")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation3"))):3==u&&(s.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau6")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Foundation2"))),s.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Waste")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Stock")),s.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Tableau0"));i.DefaultKeyboardFocus=i.GetPileView("Stock"),i.CardScale=1,s=i.GetPileView("Root"),s.CardFacing=o.Facing.Hidden,s.PileMode=o.Layout.Pile,s.InteractionMode=o.Interaction.None,s.ScaleX=1,s.ScaleY=1,s=i.GetPileView("Stock"),s.CardFacing=o.Facing.FaceDown,s.PileMode=o.Layout.Pile,s.InteractionMode=o.Interaction.Click,s.ScaleX=1,s.ScaleY=1,s=i.GetPileView("Waste"),s.CardFacing=o.Facing.FaceUp,s.InteractionMode=o.Interaction.Drag,s.ScaleX=1,s.ScaleY=1,s.FanLimit="3"==i.CardSupply.GetOption("Draw")?3:1;for(var u=0;u<7;u++)s=i.GetPileView("Tableau"+u),s.CardFacing=o.Facing.FaceUp,s.InteractionMode=o.Interaction.Drag,s.StackedPile=i.GetPileView("FaceDown"+u),s.ScaleX=1,s.ScaleY=1;for(var u=0;u<7;u++)s=i.GetPileView("FaceDown"+u),s.CardFacing=o.Facing.FaceDown,s.ScaleX=1,s.ScaleY=1;for(var u=0;u<4;u++)s=i.GetPileView("Foundation"+u),s.CardFacing=o.Facing.FaceUp,s.PileMode=o.Layout.Pile,s.InteractionMode=o.Interaction.Drag,s.ScaleX=1,s.ScaleY=1;this.OnMoveCardsHandler=this.SupplyView_OnMoveCards.bind(this),i.OnMoveCardsEvent.add(this.OnMoveCardsHandler);var d=i.GetPileView("Stock"),c=this._authorityReference.CardSupply.GetOption("Scoring");this._authorityReference.PassesThroughDeck>1&&(c==l.LAS_VEGAS||c==l.LAS_VEGAS_CUMULATIVE)&&d.DisplayType!=o.Display.X&&(d.DisplayType=o.Display.X)},y.prototype.SupplyView_OnMoveCards=function(t){var e=t.GetPileView("Stock"),i=this._authorityReference.CardSupply.GetOption("Scoring");this._authorityReference.PassesThroughDeck>1&&(i==l.LAS_VEGAS||i==l.LAS_VEGAS_CUMULATIVE)?e.Pile.Empty&&e.DisplayType!=o.Display.X&&setTimeout(function(){e.DisplayType=o.Display.X}.bind(this),250):e.DisplayType=o.Display.Circle},y.prototype.LoadGameOptions=function(e,i){this._checkAndImportOldCumulativeScore(),e.SetOption("Draw",this.settingsManager.getSetting("klondike","cardsPerDraw"));var n=this.settingsManager.getSetting("klondike","scoringType");e.UseCumulativeScoring="LASVEGASCUMULATIVE"==n,e.SetOption("Scoring",n),e.SetOption("KlondikeTimer",this.settingsManager.getSetting("klondike","timer")?"true":"false"),void 0===this.settingsManager.getSetting("klondike","difficulty")&&this.settingsManager.setSetting("klondike","difficulty","RANDOM"),e.SetOption("Difficulty",this.settingsManager.getSetting("klondike","difficulty")),void 0===this.settingsManager.getSetting("klondike","layoutDirection")&&this.settingsManager.setSetting("klondike","layoutDirection","1");var r=this.settingsManager.getSetting("klondike","cumulativeScoreForDraw"+e.GetOption("Draw"));t.isNumber(r)&&!i&&(e.CumulativeScore=parseInt(r),e.SetOption("CumulativeScore",r)),i&&this.SaveGameOptions(e)},y.prototype.SaveGameOptions=function(t){t.UseCumulativeScoring&&this.settingsManager.setSetting("klondike","cumulativeScoreForDraw"+t.GetOption("Draw"),t.CumulativeScore)},Object.defineProperty(y.prototype,"EndGameStatStrings",{get:function(){var t="true"==this._authorityReference.CardSupply.GetOption("KlondikeTimer").toLowerCase(),e=["Time"];return t&&e.push("Time Bonus"),e.push("Score"),e}}),y.prototype.GetEndGameStats=function(){var t=this._authorityReference.GetScoreForTimer(this._authorityReference.CardSupply.CurrentTime,0),e="true"==this._authorityReference.CardSupply.GetOption("KlondikeTimer").toLowerCase(),i=[this._authorityReference.CardSupply.CurrentTime.toString()];return e&&i.push(t),i.push(this._authorityReference.CardSupply.Score+t),i},Object.defineProperty(y.prototype,"SaveFilename",{get:function(){return"KLONDIKE_SAVE_FILE"}}),Object.defineProperty(y.prototype,"GameName",{get:function(){return"Klondike"}}),Object.defineProperty(y.prototype,"DrawOptionKey",{get:function(){return"APPDATA_KLONDIKE_DRAW"}}),Object.defineProperty(y.prototype,"ScoringOptionKey",{get:function(){return"APPDATA_KLONDIKE_SCORING"}}),Object.defineProperty(y.prototype,"CumulativeScoreOptionKey",{get:function(){return"APPDATA_KLONDIKE_CUMULATIVESCORE"}}),Object.defineProperty(y.prototype,"TimerOptionKey",{get:function(){return"APPDATA_KLONDIKE_TIMER"}}),y.prototype._checkAndImportOldCumulativeScore=function(){var e=this.settingsManager.getSetting("klondike","cumulativeScore");if(t.isNumber(e)){var i=this.settingsManager.getSetting("klondike","cumulativeScoreForDraw1"),n=this.settingsManager.getSetting("klondike","cumulativeScoreForDraw3");t.isNumber(i)&&t.isNumber(n)||(this.settingsManager.setSetting("klondike","cumulativeScoreForDraw1",e),this.settingsManager.setSetting("klondike","cumulativeScoreForDraw3",e),this.settingsManager.save())}},y}),define("util/StringComparison",[],function(){"use strict";var t={OrdinalIgnoreCase:"OrdinalIgnoreCase",StartsWith:function(e,i,n){return n==t.OrdinalIgnoreCase?0==e.toLowerCase().indexOf(i.toLowerCase()):0==e.indexOf(i)}};return t}),define("Solitaire/SolitaireStatistics",["lodash","absolute/textutils","util/StringComparison","Managers/StatManager","Solitaire/SolitaireGameMode","Solitaire/GameState","SolitaireShared/CardLogic/IDailyAuthority"],function(t,e,i,n,r,o,a){"use strict";var s=function(){this.initSolitaireStatistics()};s.prototype.initSolitaireStatistics=function(){this.InitStatKeys(),this.InitGameStats()},s.StatKey=function(t,e){this.initStatKey(t,e)},s.StatKey.prototype.initStatKey=function(t,e){this.GameMode=t,this.Key=e},s.GAMESPLAYEDTOTAL="TotalGamesPlayed",s.GAMESPLAYEDSUFFIX="GamesPlayed",s.GAMESWONTOTAL="TotalGamesWon",s.GAMESWONSUFFIX="GamesWon",s.GAMESLOSTSUFFIX="GamesLost",s.BOARDSCLEARED="BoardsCleared",s.HIGHESTBOARDSCLEARED="HighestBoardsCleared",s.STACKSMADE="StacksMade",s.MATCHES="Matches",s.HIGHESTMATCHES="HighestMatches",s.WINNINGSTREAK="Streak",s.LONGESTLOSINGSTREAK="LongestLosingStreak",s.LONGESTWINNINGSTREAK="LongestWinningStreak",s.LOSINGSTREAK="LosingStreak",s.WINPERCENTAGE="WinPercentage",s.HIGHSCORE="HighScore",s.ROWSCLEARED="RowsCleared",s.HIGHESTROWSCLEARED="HighestRowsCleared",s.CARDSCHAINED="CardsChained",s.HIGHESTCARDSCHAINED="HighestCardsChained",s.GAMEBESTTIME="BestTime",s.GAMETIME="TotalTime",s.TOTALSCORE="TotalScore",s.CARDSFLIPPED="TotalCardsFlipped",s.BOARDWONWITHKING="BoardWonWithKing",s.GAMESWONINAROW="GamesWonInARow",s.PEAKSCLEARED="PeaksCleared",s.HIGHESTPEAKSCLEARED="HighestPeaksCleared",s.TOTALWON_AWARD="TotalWon_Award",s.TOTALBOARDSCLEAR_AWARD="TotalBoardsClear_Award",s.GAMESPLAYEDSINCELASTADSHOWING="GamesPlayedSinceLastAdShowing",s.NEXTADSHOWINGPERIOD="NextAdShowingPeriod",s.LASTSAVEDATE="LastSaveDate",s.GlobalStreak="GlobalStreak";var l=null;return Object.defineProperty(s,"Current",{get:function(){return l||(l=new s),l}}),s.prototype.InitStatKeys=function(){this._statKeys={};var t=[new s.StatKey(r.Klondike,"1STANDARDKLONDIKE"),new s.StatKey(r.Klondike,"1LASVEGASKLONDIKE"),new s.StatKey(r.Klondike,"1LASVEGASCUMULATIVEKLONDIKE"),new s.StatKey(r.Klondike,"3STANDARDKLONDIKE"),new s.StatKey(r.Klondike,"3LASVEGASKLONDIKE"),new s.StatKey(r.Klondike,"3LASVEGASCUMULATIVEKLONDIKE")],e=[new s.StatKey(r.Spider,"1SPIDER"),new s.StatKey(r.Spider,"2SPIDER"),new s.StatKey(r.Spider,"4SPIDER")],i=[new s.StatKey(r.FreeCell,"FREECELL")],n=[new s.StatKey(r.Pyramid,"PYRAMID"),new s.StatKey(r.Pyramid,"TIMEDPYRAMID")],o=[new s.StatKey(r.TriPeaks,"TRIPEAKS")];this._statKeys[r.getModeById(r.Klondike)]=t,this._statKeys[r.getModeById(r.Spider)]=e,this._statKeys[r.getModeById(r.FreeCell)]=i,this._statKeys[r.getModeById(r.Pyramid)]=n,this._statKeys[r.getModeById(r.TriPeaks)]=o},s.prototype.InitGameStats=function(){
var e=[this.GetGamesPlayedFormatString.bind(this),this.GetGamesWonFormatString.bind(this),this.GetGamesLostFormatString.bind(this),this.GetPercentWon.bind(this),this.GetWinningStreakFormatString.bind(this),this.GetLongestWinningStreakFormatString.bind(this),this.GetLongestLosingStreakFormatString.bind(this),this.GetHighScoreFormatString.bind(this),this.GetAverageScoreFormatString.bind(this),this.GetBestTimeFormatString.bind(this),this.GetAverageTimeFormatString.bind(this)],i=[this.GetGamesPlayedFormatString.bind(this),this.GetGamesWonFormatString.bind(this),this.GetGamesLostFormatString.bind(this),this.GetPercentWon.bind(this),this.GetHighScoreFormatString.bind(this),this.GetAverageScoreFormatString.bind(this),this.GetBestTimeFormatString.bind(this),this.GetAverageTimeFormatString.bind(this),this.GetStacksFormatString.bind(this),this.GetAverageStacksFormatString.bind(this)],n=[this.GetGamesPlayedFormatString.bind(this),this.GetGamesWonFormatString.bind(this),this.GetGamesLostFormatString.bind(this),this.GetPercentWon.bind(this),this.GetBestTimeFormatString.bind(this),this.GetAverageTimeFormatString.bind(this)],o=[this.GetGamesPlayedFormatString.bind(this),this.GetHighScoreFormatString.bind(this),this.GetHighestBoardsFormatString.bind(this),this.GetBoardsFormatString.bind(this),this.GetAverageBoardsFormatString.bind(this),this.GetHighestRowsClearedFormatString.bind(this),this.GetRowsClearedFormatString.bind(this),this.GetAverageRowsClearedFormatString.bind(this),this.GetHighestMatchesFormatString.bind(this),this.GetMatchesFormatString.bind(this),this.GetAverageMatchesFormatString.bind(this)],a=[this.GetGamesPlayedFormatString.bind(this),this.GetHighScoreFormatString.bind(this),this.GetHighestBoardsFormatString.bind(this),this.GetBoardsFormatString.bind(this),this.GetAverageBoardsFormatString.bind(this),this.GetHighestPeaksClearedFormatString.bind(this),this.GetPeaksClearedFormatString.bind(this),this.GetAveragePeaksClearedFormatString.bind(this),this.GetLongestCardsChainedFormatString.bind(this)];this._gameStats={},t.forEach(this.GetKeys(r.Klondike),function(t){this._gameStats[t.Key]=e},this),t.forEach(this.GetKeys(r.Spider),function(t){this._gameStats[t.Key]=i},this),t.forEach(this.GetKeys(r.FreeCell),function(t){this._gameStats[t.Key]=n},this),t.forEach(this.GetKeys(r.Pyramid),function(t){this._gameStats[t.Key]=o},this),t.forEach(this.GetKeys(r.TriPeaks),function(t){this._gameStats[t.Key]=a},this)},s.prototype.GetKeys=function(t){return this._statKeys[r.getModeById(t)]},s.prototype.GetAllStats=function(e){var i=[];try{var n=this._gameStats[e.Key];t.forEach(n,function(t){i.push(t(e))},this)}catch(t){}return i},s.prototype.GetLongestWinningStreakFormatString=function(t){var e=this.GetLongestWinningStreak(t);return this.GetStringFormat(e)},s.prototype.GetLongestWinningStreak=function(t){var e=t.Key+s.LONGESTWINNINGSTREAK,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.BestStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetLongestLosingStreakFormatString=function(t){var e=this.GetLongestLosingStreak(t);return this.GetStringFormat(e)},s.prototype.GetLongestLosingStreak=function(t){var e=t.Key+s.LONGESTLOSINGSTREAK,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.BestStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetLosingStreak=function(t){var e=t.Key+s.LOSINGSTREAK,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.BestStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetWinningStreakFormatString=function(t){var e=this.GetWinningStreak(t);return this.GetStringFormat(e)},s.prototype.GetWinningStreak=function(t){var e=t.Key+s.WINNINGSTREAK,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.BestStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetStringFormat=function(t){t=Math.round(t);var i=1e3*t,n=Math.floor(Math.round(i)/1e3),r=i%1e3,o=e.formatInt(n)+(r?"."+Math.abs(Math.round(r)):"");return""==o?"0":o},s.prototype.UpdateLongestWinningStreak=function(t,e){var i=t.Key+s.LONGESTWINNINGSTREAK;s.SetStatistic(i,e,!0)},s.prototype.UpdateLongestLosingStreak=function(t,e){var i=t.Key+s.LONGESTLOSINGSTREAK;s.SetStatistic(i,e,!0)},s.prototype.IncrementWinningStreak=function(t){var e=t.Key+s.WINNINGSTREAK;return s.IncrementStatistic(e,1,!0),n.GetValue(e)>n.GetValue(t.Key+s.LONGESTWINNINGSTREAK)&&this.UpdateLongestWinningStreak(t,n.GetValue(e)),n.GetValue(e)},s.prototype.IncrementLosingStreak=function(t){var e=t.Key+s.LOSINGSTREAK;return s.IncrementStatistic(e,1,!0),n.GetValue(e)>n.GetValue(t.Key+s.LONGESTLOSINGSTREAK)&&this.UpdateLongestLosingStreak(t,n.GetValue(e)),n.GetValue(e)},s.prototype.ResetWinningStreak=function(t){var e=t.Key+s.WINNINGSTREAK;s.SetStatistic(e,0,!0)},s.prototype.ResetLosingStreak=function(t){var e=t.Key+s.LOSINGSTREAK;s.SetStatistic(e,0,!0)},s.prototype.GetGlobalWinningStreak=function(){return n.GetValue(s.GlobalStreak)},s.prototype.IncrementGlobalWinningStreak=function(){s.IncrementStatistic(s.GlobalStreak,1,!0)},s.prototype.ResetGlobalWinningStreak=function(){s.SetStatistic(s.GlobalStreak,0,!0)},s.prototype.GetTotalGamesPlayed=function(){return n.GetValue(s.GAMESPLAYEDTOTAL)},s.prototype.GetGamesPlayedFormatString=function(t){var e=this.GetGamesPlayed(t);return this.GetStringFormat(e)},s.prototype.GetGamesPlayed=function(t){var e=t.Key+s.GAMESPLAYEDSUFFIX,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.SetGamesPlayed=function(t,e){var i=t.Key+s.GAMESPLAYEDSUFFIX;s.SetStatistic(i,e,!0)},s.prototype.UpdateGamesPlayed=function(t){s.IncrementStatistic(s.GAMESPLAYEDTOTAL,1),s.IncrementStatistic(t.Key+s.GAMESPLAYEDSUFFIX,1)},s.prototype.GetNextAdShowPeriod=function(t){var e=t.Key+s.NEXTADSHOWINGPERIOD;return n.GetValue(e)},s.prototype.SetNextAdShowPeriod=function(t,e){t.GameMode!=r.TriPeaks&&t.GameMode!=r.Pyramid||s.SetStatistic(t.GameMode.ToString()+s.NEXTADSHOWINGPERIOD,e,!0)},s.prototype.GetGamesPlayedSinceLastAdShowing=function(t){var e=t.Key+s.GAMESPLAYEDSINCELASTADSHOWING;return n.GetValue(e)},s.prototype.SetGamesPlayedSinceLastAdShowing=function(t,e){t.GameMode!=r.TriPeaks&&t.GameMode!=r.Pyramid||s.SetStatistic(t.GameMode.ToString()+s.GAMESPLAYEDSINCELASTADSHOWING,e,!0)},s.prototype.AddGamesWon=function(t,e){return s.IncrementStatistic(s.GAMESWONTOTAL,1),s.IncrementStatistic(t.Key+s.GAMESWONTOTAL,1),n.GetValue(t.Key+s.GAMESWONTOTAL)},s.prototype.GetGamesWonFormatString=function(t){var e=this.GetGamesWonTotal(t);return this.GetStringFormat(e)},s.prototype.GetGamesWonTotal=function(e){if(e){if("array"==typeof e){var r=0;return t.forEach(e,function(t){r+=this.GetGamesWonTotal(t)},this),r}if(e instanceof s.StatKey){var o=e.Key+s.GAMESWONTOTAL,a=0;return i.StartsWith(o,"+TOTAL",i.OrdinalIgnoreCase)?(o=o.substring(6),a=this.TotalStat(o,e.GameMode)):a=n.GetValue(o),a}return 0}return n.GetValue(s.GAMESWONTOTAL)},s.prototype.GetGamesLostTotal=function(t){var e=this.GetGamesWonTotal(t);return this.GetGamesPlayed(t)-e},s.prototype.GetGamesLostFormatString=function(t){var e=this.GetGamesLostTotal(t);return this.GetStringFormat(e)},s.prototype.GetPercentWon=function(t){var e=0;if(t)e=this.GetWinPercentage(t);else{var i=this.GetTotalGamesPlayed(),n=this.GetGamesWonTotal();e=this.GetPercentage(n,i)}return Math.round(100*e)+"%"},s.prototype.GetWinPercentage=function(t){var e=this.GetGamesPlayed(t),i=this.GetGamesWonTotal(t);return this.GetPercentage(i,e)},s.prototype.GetPercentage=function(t,e){return e>0?t/e:0},s.prototype.UpdateGameAction=function(t){},s.prototype.UpdateGameRedeal=function(t){this.UpdateGamesPlayed(t),this.ResetWinningStreak(t),this.IncrementLosingStreak(t),this.UpdateBoards(t),this.UpdateHighestBoards(t),this.UpdateStacks(t),this.UpdateRowsCleared(t),this.UpdateHighestRowsCleared(t),this.UpdateMatches(t),this.UpdateHighestMatches(t),this.UpdatePeaksCleared(t),this.UpdateHighestPeaksCleared(t),this.UpdateLongestCardsChained(t),this.UpdateTotalTime(t),this.UpdateBoardWonWithKing(t),s.UpdateWriteCurDate(),this.ResetGlobalWinningStreak(),this.UpdateCumulativeKlondikeScore(t),n.Save()},s.prototype.UpdateGameWon=function(t){this.UpdateGamesPlayed(t),this.AddGamesWon(t,1),this.ResetLosingStreak(t),this.IncrementWinningStreak(t),this.UpdateBoards(t),this.UpdateHighestBoards(t),this.UpdateStacks(t),this.UpdateRowsCleared(t),this.UpdateHighestRowsCleared(t),this.UpdateMatches(t),this.UpdateHighestMatches(t),this.UpdatePeaksCleared(t),this.UpdateHighestPeaksCleared(t),this.SaveHighScore(t),this.UpdateLongestCardsChained(t),this.UpdateBestTime(t),this.UpdateTotalTime(t),this.UpdateBoardWonWithKing(t),this.UpdateGamesWonInARowWin(t),s.UpdateWriteCurDate(),this.IncrementGlobalWinningStreak(),n.Save()},s.prototype.UpdateGameLost=function(t){this.UpdateGamesPlayed(t),this.ResetWinningStreak(t),this.IncrementLosingStreak(t),this.UpdateBoards(t),this.UpdateHighestBoards(t),this.UpdateStacks(t),this.UpdateRowsCleared(t),this.UpdateHighestRowsCleared(t),this.UpdatePeaksCleared(t),this.UpdateHighestPeaksCleared(t),this.UpdateMatches(t),this.UpdateHighestMatches(t),this.SaveHighScore(t),this.UpdateLongestCardsChained(t),this.UpdateTotalTime(t),this.UpdateGamesWonInARowLose(t),s.UpdateWriteCurDate(),this.ResetGlobalWinningStreak(),n.Save()},s.prototype.GetScoreFormatString=function(t){var e=this.GetScore(t);return this.GetStringFormat(e)},s.prototype.GetScore=function(t){return t.GameMode==r.FreeCell?0:null!=o.CurrentGame.Authority&&null!=o.CurrentGame.Authority.CardSupply?o.CurrentGame.Authority.CardSupply.Score:0},s.prototype.GetHighScoreFormatString=function(t){var e=this.GetHighScore(t);return this.GetStringFormat(e)},s.prototype.UpdateCumulativeKlondikeScore=function(t){if(t.GameMode==r.Klondike&&-1!=t.Key.toLowerCase().indexOf("cumulative")){var e=this.GetScore(t),i=t.Key+s.TOTALSCORE;s.SetStatistic(i,e)}},s.prototype.GetHighScore=function(t){var e=t.Key+s.HIGHSCORE,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.BestStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.TotalStat=function(e,i){e=e.substring(r.getModeById(i).length);var o=0;return t.forEach(this._statKeys[r.getModeById(i)],function(t){var i=t.Key+e;o+=n.GetValue(i)},this),o},s.prototype.BestStat=function(e,i){e=e.substring(r.getModeById(i).length);var o=0;return t.forEach(this._statKeys[r.getModeById(i)],function(t){var i=t.Key+e,r=n.GetValue(i);r>o&&(o=r)},this),o},s.prototype.SaveHighScore=function(t){if(t.GameMode!=r.FreeCell){var e=t.Key+s.HIGHSCORE,i=this.GetScore(t);(!n.ValueExists(e)||i>this.GetHighScore(t))&&s.SetStatistic(e,i);var o=0;-1==t.Key.toLowerCase().indexOf("cumulative")&&(o=this.GetTotalScore(t));var a=t.Key+s.TOTALSCORE;s.SetStatistic(a,i+o)}},s.prototype.GetTotalScore=function(t){var e,r=t.Key+s.TOTALSCORE;return i.StartsWith(r,"+TOTAL",i.OrdinalIgnoreCase)?(r=r.substring(6),e=this.BestStat(r,t.GameMode)):e=n.GetValue(r),e},s.prototype.GetAverageScore=function(t){var e=this.GetTotalScore(t),i=this.GetGamesPlayed(t);return i<=0?0:e/i},s.prototype.GetAverageScoreFormatString=function(t){var e=this.GetAverageScore(t);return this.GetStringFormat(e)},s.prototype.GetMatchesFormatString=function(t){var e=this.GetMatches(t);return this.GetStringFormat(e)},s.prototype.GetMatches=function(t){var e=t.Key+s.MATCHES,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.UpdateMatches=function(t){if(t.GameMode==r.Pyramid){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.MATCHES,a=this.GetMatches(t);null!=o.CurrentGame.Authority&&(i=e.Matches),s.SetStatistic(n,a+i)}},s.prototype.GetHighestMatchesFormatString=function(t){var e=this.GetHighestMatches(t);return this.GetStringFormat(e)},s.prototype.GetHighestMatches=function(t){var e=t.Key+s.HIGHESTMATCHES;return n.GetValue(e)},s.prototype.UpdateHighestMatches=function(t){if(t.GameMode==r.Pyramid){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.HIGHESTMATCHES,a=this.GetHighestMatches(t);null!=o.CurrentGame.Authority&&(i=e.Matches),i>a&&s.SetStatistic(n,i)}},s.prototype.GetAverageMatchesFormatString=function(t){var e=this.GetAverageMatches(t);return this.GetStringFormat(e)},s.prototype.GetAverageMatches=function(t){var e=this.GetMatches(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.GetStacksFormatString=function(t){var e=this.GetStacks(t);return this.GetStringFormat(e)},s.prototype.GetAverageStacksFormatString=function(t){var e=this.GetAverageStacks(t);return this.GetStringFormat(e)},s.prototype.GetStacks=function(t){if(t.GameMode!=r.Spider)return 0;var e=t.Key+s.STACKSMADE,o=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),o=this.TotalStat(e,t.GameMode)):o=n.GetValue(e),o},s.prototype.GetAverageStacks=function(t){var e=this.GetStacks(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.UpdateStacks=function(t){if(t.GameMode==r.Spider){var e=0,i=t.Key+s.STACKSMADE,n=this.GetStacks(t);null!=o.CurrentGame.Authority&&null!=o.CurrentGame.Authority.CardSupply&&(e=o.CurrentGame.Authority.GetCompletedStacks()),s.SetStatistic(i,n+e)}},s.prototype.GetBoardsFormatString=function(t){var e=this.GetBoards(t);return this.GetStringFormat(e)},s.prototype.GetBoards=function(e){if(e){if("array"==typeof e){var r=0;return t.forEach(e,function(t){r+=this.GetBoards(t)},this),r}if(e instanceof s.StatKey){var o=0,a=e.Key+s.BOARDSCLEARED;return i.StartsWith(a,"+TOTAL",i.OrdinalIgnoreCase)?(a=a.substring(6),o=this.TotalStat(a,e.GameMode)):o=n.GetValue(a),o}return 0}return n.GetValue(s.BOARDSCLEARED)},s.prototype.UpdateBoards=function(t){if(t.GameMode==r.TriPeaks||t.GameMode==r.Pyramid){var e=0,i=t.Key+s.BOARDSCLEARED,n=this.GetBoards(t);null!=o.CurrentGame.Authority&&null!=o.CurrentGame.Authority.CardSupply&&(e=o.CurrentGame.Authority.BoardsCompleted()),s.SetStatistic(i,n+e)}},s.prototype.GetHighestBoardsFormatString=function(t){var e=this.GetHighestBoards(t);return this.GetStringFormat(e)},s.prototype.GetHighestBoards=function(t){var e=t.Key+s.HIGHESTBOARDSCLEARED;return n.GetValue(e)},s.prototype.UpdateHighestBoards=function(t){if(t.GameMode==r.TriPeaks||t.GameMode==r.Pyramid){var e=0,i=t.Key+s.HIGHESTBOARDSCLEARED,n=this.GetHighestBoards(t);null!=o.CurrentGame.Authority&&null!=o.CurrentGame.Authority.CardSupply&&(e=o.CurrentGame.Authority.BoardsCompleted()),e>n&&s.SetStatistic(i,e)}},s.prototype.GetAverageBoardsFormatString=function(t){var e=this.GetAverageBoards(t);return this.GetStringFormat(e)},s.prototype.GetAverageBoards=function(t){var e=this.GetBoards(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.GetRowsClearedFormatString=function(t){var e=this.GetRowsCleared(t);return this.GetStringFormat(e)},s.prototype.GetRowsCleared=function(t){var e=t.Key+s.ROWSCLEARED,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.UpdateRowsCleared=function(t){if(t.GameMode==r.Pyramid){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.ROWSCLEARED,a=this.GetRowsCleared(t);null!=o.CurrentGame.Authority&&null!=e&&(i=e.RowsCleared),s.SetStatistic(n,a+i)}},s.prototype.GetHighestRowsClearedFormatString=function(t){var e=this.GetHighestRowsCleared(t);return this.GetStringFormat(e)},s.prototype.GetHighestRowsCleared=function(t){var e=t.Key+s.HIGHESTROWSCLEARED;return n.GetValue(e)},s.prototype.UpdateHighestRowsCleared=function(t){if(t.GameMode==r.Pyramid){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.HIGHESTROWSCLEARED,a=this.GetHighestRowsCleared(t);null!=o.CurrentGame.Authority&&null!=e&&(i=e.RowsCleared),i>a&&s.SetStatistic(n,i)}},s.prototype.GetAverageRowsClearedFormatString=function(t){var e=this.GetAverageRowsCleared(t);return this.GetStringFormat(e)},s.prototype.GetAverageRowsCleared=function(t){var e=this.GetRowsCleared(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.GetCardsChainedFormatString=function(t){var e=this.GetCardsChained(t);return this.GetStringFormat(e)},s.prototype.GetCardsChained=function(t){if(t.GameMode!=r.TriPeaks)return 0;var e;try{e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null}catch(t){e=null}var i=0;return null!=e&&(i=e.CardsChained),i},s.prototype.GetLongestCardsChainedFormatString=function(t){var e=this.GetLongestCardsChained(t);return this.GetStringFormat(e)},s.prototype.GetLongestCardsChained=function(t){var e=t.Key+s.CARDSCHAINED;return n.GetValue(e)},s.prototype.UpdateLongestCardsChained=function(t){if(t.GameMode==r.TriPeaks){var e=t.Key+s.CARDSCHAINED,i=this.GetLongestCardsChained(t),n=this.GetCardsChained(t);n>i&&s.SetStatistic(e,n)}},s.prototype.GetTimeFormat=function(t){var e=new Date(1e3*t),i=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds();return(i>0?i+":":"")+n+":"+(r<10?"0"+r:r)},s.prototype.GetTimeFormatString=function(t){var e=this.GetTime();return this.GetTimeFormat(e)},s.prototype.GetBestTimeFormatString=function(t){var e=this.GetBestTime(t);return this.GetTimeFormat(e)},s.prototype.GetAverageTimeFormatString=function(t){var e=this.GetAverageTime(t);return this.GetTimeFormat(e)},s.prototype.GetTime=function(){var t=0;return null!=o.CurrentGame.Authority&&(t=o.CurrentGame.Authority.CardSupply.CurrentTime),t},s.prototype.GetBestTime=function(t){var e=t.Key+s.GAMEBESTTIME,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetTotalTime=function(t){var e=t.Key+s.GAMETIME,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.GetAverageTime=function(t){var e=this.GetTotalTime(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.UpdateTotalTime=function(t){var e=t.Key+s.GAMETIME,i=this.GetTime(),n=this.GetTotalTime(t);s.SetStatistic(e,i+n)},s.prototype.UpdateBestTime=function(t){var e=t.Key+s.GAMEBESTTIME,i=this.GetBestTime(t),n=this.GetTime();(n<i||i<=0)&&s.SetStatistic(e,n)},s.UpdateWriteCurDate=function(){var t=(new Date).toString();n.SetStatistic(s.LASTSAVEDATE,t)},s.prototype.GetCardsFlipped=function(){var t=s.CARDSFLIPPED;return n.GetValue(t)},s.prototype.IncrementCardsFlipped=function(){s.SetStatistic(s.CARDSFLIPPED,this.GetCardsFlipped()+1)},s.prototype.GetBoardWonWithKing=function(t){var e=t.Key+s.BOARDWONWITHKING;return n.GetValue(e)},s.prototype.UpdateBoardWonWithKing=function(t){var e=t.Key+s.BOARDWONWITHKING;if(t.GameMode==r.Pyramid){var i=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null;null!=i&&i.WonWithKing&&s.SetStatistic(e,1)}else if(t.GameMode==r.TriPeaks){var i=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null;null!=i&&i.WonWithKing&&s.SetStatistic(e,1)}},s.prototype.GetGamesWonInARow=function(t){var e=t.Key+s.GAMESWONINAROW;return n.GetValue(e)},s.prototype.ClearGamesWonInARow=function(t){var e=t.Key+s.GAMESWONINAROW;s.SetStatistic(e,0)},s.prototype.IncrementGamesWonInARow=function(t){var e=t.Key+s.GAMESWONINAROW;s.SetStatistic(e,this.GetGamesWonInARow(t)+1)},s.prototype.UpdateGamesWonInARowWin=function(t){t.GameMode!=r.Pyramid&&t.GameMode!=r.TriPeaks&&this.IncrementGamesWonInARow(t)},s.prototype.UpdateGamesWonInARowLose=function(e){e.GameMode!=r.Pyramid&&e.GameMode!=r.TriPeaks&&(t.forEach(this.GetKeys(r.FreeCell),function(t){this.ClearGamesWonInARow(t)},this),t.forEach(this.GetKeys(r.Klondike),function(t){this.ClearGamesWonInARow(t)},this),t.forEach(this.GetKeys(r.Spider),function(t){this.ClearGamesWonInARow(t)},this))},s.prototype.GetPeaksClearedFormatString=function(t){var e=this.GetPeaksCleared(t);return this.GetStringFormat(e)},s.prototype.GetPeaksCleared=function(t){var e=t.Key+s.PEAKSCLEARED,r=0;return i.StartsWith(e,"+TOTAL",i.OrdinalIgnoreCase)?(e=e.substring(6),r=this.TotalStat(e,t.GameMode)):r=n.GetValue(e),r},s.prototype.UpdatePeaksCleared=function(t){if(t.GameMode==r.TriPeaks){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.PEAKSCLEARED,a=this.GetPeaksCleared(t);null!=o.CurrentGame.Authority&&null!=e&&(i=e.NumPeaksCleared),s.SetStatistic(n,a+i)}},s.prototype.GetHighestPeaksClearedFormatString=function(t){var e=this.GetHighestPeaksCleared(t);return this.GetStringFormat(e)},s.prototype.GetHighestPeaksCleared=function(t){var e=t.Key+s.HIGHESTPEAKSCLEARED;return n.GetValue(e)},s.prototype.UpdateHighestPeaksCleared=function(t){if(t.GameMode==r.TriPeaks){var e=null!=o.CurrentGame.Authority?o.CurrentGame.Authority:null,i=0,n=t.Key+s.HIGHESTPEAKSCLEARED,a=this.GetHighestPeaksCleared(t);null!=o.CurrentGame.Authority&&null!=e&&(i=e.NumPeaksCleared),i>a&&s.SetStatistic(n,i)}},s.SetStatistic=function(t,e,i){i=!!i,o.CurrentGame.Authority instanceof a||n.SetStatistic(t,e,i)},s.IncrementStatistic=function(t,e,i){if(!(o.CurrentGame.Authority instanceof a)){i=!!i;var r=n.GetValue(t);n.SetStatistic(t,r+e,i)}},s.prototype.GetAveragePeaksClearedFormatString=function(t){var e=this.GetAveragePeaksCleared(t);return this.GetStringFormat(e)},s.prototype.GetAveragePeaksCleared=function(t){var e=this.GetPeaksCleared(t),i=this.GetGamesPlayed(t);return i>0?e/i:0},s.prototype.GetDCChallengesWonFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalCompletedChallenges"))},s.prototype.GetDCChallengesPlayedFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalPlayedChallenges"))},s.prototype.GetDCDaysCompletedFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalDaysCompleted"))},s.prototype.GetDCBronzeBadgesWonFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalBronzeBadgesWon"))},s.prototype.GetDCSilverBadgesWonFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalSilverBadgesWon"))},s.prototype.GetDCGoldBadgesWonFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalGoldBadgesWon"))},s.prototype.GetDCDiamondBadgesWonFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalDiamondBadgesWon"))},s.prototype.GetDCPerfectCompletionsFormatString=function(){return this.GetStringFormat(n.GetValue("DCGlobalPerfectCompletions"))},s.prototype.GetSCTotalStarsEarnedFormatString=function(){return this.GetStringFormat(n.GetValue("SCGlobalStarsEarned"))},s.prototype.GetSCChallengesCompletedFormatString=function(){return this.GetStringFormat(n.GetValue("SCGlobalChallengesCompleted"))},s.prototype.GetSCPacksUnlockedFormatString=function(){return this.GetStringFormat(n.GetValue("SCGlobalPacksUnlocked"))},s.prototype.GetSCCollectionsUnlockedFormatString=function(){return this.GetStringFormat(n.GetValue("SCGlobalCollectionsUnlocked"))},s.prototype.GetSCCrownsEarnedFormatString=function(){return this.GetStringFormat(n.GetValue("SCGlobalCrownsEarned"))},s.prototype.GetSCCompletionPercentageFormatString=function(){var t=this.GetPercentage(n.GetValue("SCGlobalChallengesCompleted"),n.GetValue("SCGlobalTotalChallenges"));return Math.floor(100*t)+"%"},s}),define("Solitaire/GameModes/KlondikeGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/SolitaireGameMode","SolitaireShared/KlondikeTemplate/KlondikeWindowsTemplate","Solitaire/GameResult","Solitaire/GameState","Solitaire/SolitaireStatistics"],function(t,e,i,n,r,o,a){"use strict";var s=function(){this.initKlondikeGameMode()};return s.constructor=s,s.prototype=Object.create(t.prototype),e.call(s.prototype),s.prototype.initKlondikeGameMode=function(){this.Name=i.Klondike},Object.defineProperty(s.prototype,"TimerOption",{get:function(){return o.CurrentGame.Authority.IsChallenge?o.CurrentGame.Authority.TimerEnabled?e.TimerSettings.CountDown:e.TimerSettings.Off:"true"===o.CurrentGame.Authority.CardSupply.GetOption("KlondikeTimer")?e.TimerSettings.CountUp:e.TimerSettings.Off}}),s.prototype.ConfigureSolitairePage=function(t){},s.prototype.CreateTemplate=function(){return new n},s.prototype.GetCheatMoves=function(){return"G KLONDIKE O DRAW 1 O SCORING STANDARD D 55712977639165545899751645785150140100232475048673821137333482906379 [3801] B M 11 4 1 M 10 11 1 E [4360] M 2 3 -1 [6245] B M 17 11 1 M 16 17 1 E [9675] M 2 3 -1 [11488] B M 19 21 1 M 18 19 1 E [12573] B M 19 5 1 M 18 19 1 E [14053] U 1 [14345] U 1 [14754] U 1 [15757] B M 19 21 1 M 18 19 1 E [16683] B M 19 5 1 M 18 19 1 E [17865] M 3 5 1 [19475] M 2 3 -1 [21009] M 2 3 -1 [23076] M 2 3 -1 [25472] M 2 3 -1 [27776] M 2 3 -1 [29225] M 2 3 -1 [30511] M 3 5 1 [30856] M 2 3 -1 [32629] M 2 3 -1 [34755] M 2 3 -1 [36376] M 3 13 1 [37263] M 11 13 2 [39950] B M 17 11 1 M 16 17 1 E [42528] B M 21 17 2 M 20 21 1 E [44201] B M 21 11 1 M 20 21 1 E [47437] M 9 21 1 [48420] B M 21 13 2 M 20 21 1 E [50281] B M 21 9 1 M 20 21 1 E [54489] M 2 3 -1 [56414] M 3 11 1 [57035] M 2 3 -1 [58200] U 1 [58447] U 1 [59348] B M 13 11 6 M 12 13 1 E [60843] B M 13 19 1 M 12 13 1 E [65379] M 2 3 -1 [66665] M 2 3 -1 [68301] M 3 19 1 [69010] M 2 3 -1 [70724] M 3 4 1 [71894] M 2 3 -1 [73742] M 3 4 1 [74451] M 2 3 -1 [76318] M 2 3 -1 [77314] M 3 6 1 [77839] M 2 3 -1 [79137] M 2 3 -1 [80952] M 2 3 -1 [82489] M 3 15 1 [83253] M 2 3 -1 [85227] M 3 21 1 [86132] M 2 3 -1 [88657] M 2 3 -1 [91368] M 2 3 -1 [92743] M 3 2 -15 [93064] M 2 3 -1 [95566] M 2 3 -1 [96878] M 2 3 -1 [98800] M 3 19 1 [102689] M 2 3 -1 [103934] M 3 6 1 [105511] M 2 3 -1 [107201] M 3 15 1 [108036] M 2 3 -1 [109709] M 3 9 1 [110974] B M 15 9 3 M 14 15 1 E [115739] B M 17 15 3 M 16 17 1 E [122097] B M 15 11 4 M 14 15 1 E [128129] M 2 3 -1 [130292] M 2 3 -1 [132616] M 2 3 -1 [133670] M 2 3 -1 [137966] B M 19 9 4 M 18 19 1 E [142381] M 2 3 -1 [143671] M 2 3 -1 [145745] M 2 3 -1 [149851] M 3 19 1 [151031] M 13 19 1 [151653] M 2 3 -1 [153732] M 2 3 -1 [155208] M 3 15 1 [156464] B M 21 15 2 M 20 21 1 E [157746] B M 21 13 1 M 20 21 1 E [159084] B M 17 13 1 M 16 17 1 E [166999] M 3 2 -9 [167425] M 2 3 -1 [169254] M 3 5 1 [169630] M 2 3 -1 [176748] M 3 17 1 [177692] M 2 3 -1 [179622] M 3 21 1 [181415] M 2 3 -1 [183282] M 2 3 -1 [184492] M 2 3 -1 [192484] M 2 3 -1 [194157] M 2 3 -1 [196085] M 3 21 1 [196870] M 2 3 -1 [198294] M 3 21 1 [200222] M 3 2 -4 [200592] M 2 3 -1 [201108] M 2 3 -1 [201868] M 2 3 -1 [203126] M 3 21 1 [203977] B M 19 21 3 M 18 19 1 E [206195] B M 19 13 1 M 18 19 1 E [211269] M 17 19 2 [215803] M 3 17 1 [216392] M 2 3 -1 [217420] M 3 17 1 [218731] M 3 17 1 [219484] B M 15 17 4 M 14 15 1 E [220526] M 15 7 1 [231639] M 11 7 1 [235499] M 11 6 1 [236756] M 11 4 1 [238518] M 21 7 1 [241093] M 19 7 1 [244045] M 21 6 1 [244636] M 19 6 1 [245291] M 21 4 1 [246584] M 11 5 1 [247156] M 9 7 1 [247636] M 9 5 1 [248087] M 11 4 1 [249057] M 19 7 1 [249596] M 21 6 1 [251178] M 21 13 4 [252332] M 17 15 7 [253053] M 15 5 1 [253479] M 13 4 1 [253971] M 11 6 1 [254465] M 9 7 1 [254843] M 9 5 1 [255326] M 11 4 1 [255753] M 13 6 1 [256172] M 15 7 1 [256564] M 15 5 1 [257012] M 13 7 1 [257473] M 11 6 1 [257920] M 9 4 1 [258302] M 9 5 1 [258755] M 11 7 1 [259185] M 13 6 1 [259615] M 15 4 1 [260031] M 15 5 1 [260452] M 13 4 1 [260933] M 11 6 1 [261412] M 9 7 1 [261831] M 9 5 1 [262283] M 11 4 1 [262742] M 13 6 1 [263223] M 15 7 1 [264022] N"},s.prototype.HelpDataSource=function(){throw"TODO"},s.prototype.GetGameEnd=function(){throw"TODO"},s.prototype.SetShare=function(t){},s.GetStatKeyStatic=function(){return new a.StatKey(o.CurrentGame.ActiveMode.Name,(o.CurrentGame.GetOption("DRAW")+o.CurrentGame.GetOption("SCORING")+i.getModeById(o.CurrentGame.ActiveMode.Name)).toUpperCase())},s.prototype.GetStatKey=function(){return s.GetStatKeyStatic()},s.prototype.UpdateStatistics=function(t){var e=s.GetStatKeyStatic(),i=a.Current.GetScore(e),n=o.CurrentGame.Authority.GetBonusScore(o.CurrentGame.Authority.CardSupply.TimePlayed),l=0;o.CurrentGame.GameResult==r.Win?(a.Current.UpdateGameWon(e),l=i-n):o.Current==o.GameComplete&&(a.Current.UpdateGameLost(e),l=i,n=0),t.ScoreText=a.Current.GetStringFormat(l),t.TimeBonus=a.Current.GetStringFormat(n),t.TotalScore=a.Current.GetScoreFormatString(e),t.Time=a.Current.GetTimeFormatString(e),t.HighScore=a.Current.GetHighScoreFormatString(e),t.BestTime=a.Current.GetBestTimeFormatString(e),t.GamesPlayed=a.Current.GetGamesPlayedFormatString(e),t.GamesWon=a.Current.GetGamesWonFormatString(e),t.WinPercentage=a.Current.GetPercentWon(e)},s.prototype.UpdateLeaderBoard=function(){},s}),define("SolitaireShared/SpiderTemplate/SpiderInputInterpreter",["lodash","absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","CardUI/CardView","SolitaireShared/CardLogic/Pile"],function(t,e,i,n,r,o,a,s){"use strict";var l=function(t){this.initSpiderInputInterpreter(t)};l.prototype.initSpiderInputInterpreter=function(t){this.Authority=t,this.InputEnabled=!0,this.IsClickedOnCard=!1,this.tableauWasCompletedHack=!1,this.HighlightedCard=null,this.HighlightTime=-1},l.prototype.NotifyCardsMoved=function(){this.ClearHighlight()},l.prototype.Drag=function(t,e){return this.IsCardHighlighted()&&e>50&&this.ClearHighlight(),!0};var h=["move","Stock","Tableau0","1","move","Stock","Tableau1","1","move","Stock","Tableau2","1","move","Stock","Tableau3","1","move","Stock","Tableau4","1","move","Stock","Tableau5","1","move","Stock","Tableau6","1","move","Stock","Tableau7","1","move","Stock","Tableau8","1","move","Stock","Tableau9","1"];l.prototype.DoDeal=function(e,i,n,r){var o=0;null!=e&&(o+=e.length),null!=i&&(o+=i.length);var a=[];a[0]="begin";for(var s=0;s<h.length;s++)a[s+1]=h[s];var l=0,u=h.length+1;return null!=e&&t.forEach(e,function(t){var e=this.GetEmptyFoundation(n,l++);a[u++]="move",a[u++]=t.Name,a[u++]=e.Name,a[u++]="-13"},this),null!=i&&t.forEach(i,function(t){var e=this.Authority.FaceDownForTableau(t);a[u++]="move",a[u++]=e.Name,a[u++]=t.Name,a[u++]="1"},this),a[u]="end",r.Parse(a)>=0&&(this.Authority.CardSupply.OnFlipCard(),!0)},l.prototype.GetEmptyFoundation=function(t,e){e=e||0;var i=e+1;return t.GetPile("Foundation0").Empty&&i--,0==i?t.GetPile("Foundation0"):(t.GetPile("Foundation1").Empty&&i--,0==i?t.GetPile("Foundation1"):(t.GetPile("Foundation2").Empty&&i--,0==i?t.GetPile("Foundation2"):(t.GetPile("Foundation3").Empty&&i--,0==i?t.GetPile("Foundation3"):(t.GetPile("Foundation4").Empty&&i--,0==i?t.GetPile("Foundation4"):(t.GetPile("Foundation5").Empty&&i--,0==i?t.GetPile("Foundation5"):(t.GetPile("Foundation6").Empty&&i--,0==i?t.GetPile("Foundation6"):(t.GetPile("Foundation7").Empty&&i--,0==i?t.GetPile("Foundation7"):null)))))))},l.prototype.DoMoveCard=function(t,e,i,n){var r=e.GetCardPosFromEnd(t);if("Tableau"!=e.Type)return!1;var o=this.Authority.FaceDownForTableau(e);if(null!=o&&o.Count>0&&e.Count==r)if(this.Authority.WouldCompleteRun(e,i,r)){var a=this.GetEmptyFoundation(e.Supply);if(null==a)return!1;var s=this.Authority.FaceDownForTableau(i);if(null==s)return!1;s.Count>0&&i.Count+r==13?(n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",o.Name,e.Name,"1","move",i.Name,a.Name,"-13","move",s.Name,i.Name,"1","end"]),this.Authority.CardSupply.OnFlipCard()):(n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",o.Name,e.Name,"1","move",i.Name,a.Name,"-13","end"]),this.Authority.CardSupply.OnFlipCard()),this.tableauWasCompletedHack=!0}else n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",o.Name,e.Name,"1","end"]),this.Authority.CardSupply.OnFlipCard();else if(this.Authority.WouldCompleteRun(e,i,r)){var a=this.GetEmptyFoundation(e.Supply);if(null==a)return!1;var s=this.Authority.FaceDownForTableau(i);if(null==s)return!1;s.Count>0&&i.Count+r==13?(n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",i.Name,a.Name,"-13","move",s.Name,i.Name,"1","end"]),this.Authority.CardSupply.OnFlipCard()):n.Parse(["begin","move",e.Name,i.Name,r.toString(),"move",i.Name,a.Name,"-13","end"]),this.tableauWasCompletedHack=!0}else n.Parse(["move",e.Name,i.Name,r.toString()]);return!0},l.prototype.Drop=function(e,r){var o=!1,l=e.Card.Supply,h=new n(l)
;if(h.Parse(["noop"]),!this.InputEnabled)return h;for(var u=0;u<r.length;u++){var d=r[u],c=e.Card,p=c.Pile,g=d instanceof s?d:d.Pile;if(p==g)break;if(this.ClearHighlight(),this.DoMoveCard(c,p,g,h),h.IsAllowed()){this.tableauWasCompletedHack?(null!=e.Parent&&t.forEach(e.Parent.children,function(t){t instanceof a&&(t.IsPickedUp=!1)}),i.Sounds.PlaySound("completeStack"),o=!0,this.tableauWasCompletedHack=!1):(i.Sounds.PlaySound("legalMove"),o=!0);break}}return o||i.Sounds.PlaySound("illegalMove"),h};var u=["Tableau0","Tableau1","Tableau2","Tableau3","Tableau4","Tableau5","Tableau6","Tableau7","Tableau8","Tableau9"];return l.prototype.ClickCard=function(e,o){var a=e.Card.Supply,s=new n(a);if(s.Parse(["noop"]),o)return s;if(!this.InputEnabled||!e.IsDraggable&&"Stock"!=e.Card.Pile.Type)return s;if("Stock"==e.Card.Pile.Type&&this.ClearHighlight(),this.IsCardHighlighted()){var l=this.HighlightedCard.Card,h=l.Pile,d=e.Card.Pile;h!=d?(this.DoMoveCard(l,h,d,s),s.IsAllowed()?(this.ClearHighlight(),e.IsDragging=e.SupplyView.IsCardDragging=!1):this.Authority.CanPickupCard(e.Card)&&this.HighlightCard(e)):this.Authority.CanPickupCard(e.Card)?this.HighlightCard(e):this.Authority.TriggerTip(),s.IsAllowed()&&i.Sounds.PlaySound("legalMove")}else{var c=e.Card.Pile;if("Stock"==c.Name){var p=null,g=null;if(c.Count>=10){for(var f=0;f<10;f++){var y=c.NthFromTop(f+1);if(y.Value==r.Values.Ace){var m=a.GetPile(u[f]);null==m||m.Empty||m.Top.Value!=r.Values.Two||m.Top.Suit!=y.Suit||12!=this.Authority.SuitedRunLength(m)||(null==p&&(p=[]),p.push(m))}}null!=p&&t.forEach(p,function(t){var e=this.Authority.FaceDownForTableau(t);null==e||12!=t.Count||e.Empty||(null==g&&(g=[]),g.push(t))},this)}if(this.DoDeal(p,g,a,s),!s.IsAllowed()){if(!this.Authority.IsDealAllowed()){e.SupplyView.GetCardView(e.Card.Pile.Top).AnimateSingleTapRejection(),i.Sounds.PlaySound("illegalMove")}return s.isAllowed=!1,s}e.Parent.FanLimit--,this.ClearHighlight()}else this.Authority.CanPickupCard(e.Card)?this.HighlightCard(e):this.Authority.TriggerTip()}return s.IsAllowed()&&this.tableauWasCompletedHack&&(i.Sounds.PlaySound("foundation"),this.tableauWasCompletedHack=!1),s},l.prototype.ClickEmptyPile=function(t){var e=t.Pile.Supply,i=new n(e);if(i.Parse(["noop"]),!this.InputEnabled)return i;if(this.IsCardHighlighted()){var r=this.HighlightedCard.Card,o=r.Pile,a=t.Pile;this.DoMoveCard(r,o,a,i),this.ClearHighlight()}return i},l.prototype.ClickOutside=function(){this.ClearHighlight()},l.prototype.IsCardHighlighted=function(){return null!=this.HighlightedCard},l.prototype.GetHighlightedCard=function(){return this.HighlightedCard},l.prototype.HighlightCard=function(t){this.HighlightedCard=t,this.HighlightedCard.Highlight(),this.HighlightTime=i.Time.TotalGameTime.TotalMilliseconds,e.log("HighlightCard "+t.Card.ToString())},l.prototype.ClearHighlight=function(){null!=this.HighlightedCard&&(this.HighlightedCard.ClearHighlight(),this.HighlightedCard=null,this.HighlightTime=-1),e.log("ClearHighlight()")},l.prototype.ShouldMoveKeyboard=function(t,e){return!1},l.prototype.DealNextFromStock=function(t){var e=this.Authority.CardSupply,r=["begin","move","Stock","Tableau0","1","move","Stock","Tableau1","1","move","Stock","Tableau2","1","move","Stock","Tableau3","1","move","Stock","Tableau4","1","move","Stock","Tableau5","1","move","Stock","Tableau6","1","move","Stock","Tableau7","1","move","Stock","Tableau8","1","move","Stock","Tableau9","1","end"],o=new n(e);if(!e.GetPile("Stock").Empty){for(var a=0;a<10;a++)if(e.GetPile("Tableau"+a).Empty){t.dealIsNotAllowed();var s=t.GetCardView(e.GetPile("Stock").Top);s.AnimateSingleTapRejection()}o.Parse(r)}o.Run()&&i.Sounds.PlaySound("Deal_Spider_Draw")},l}),define("SolitaireShared/SpiderTemplate/SpiderCardAnimator",["lodash","pixi","util/dictionary","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween","SolitaireShared/CardLogic/CardOp","CardUI/PileView","CardUI/CardView","CardUI/SupplyView","absolute/particleemitter"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(t){this.initSpiderCardAnimator(t)};return d.prototype.trailParticles=function(t,i,r){null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null),this.particleLayer||(this.particleLayer=new e.DisplayObjectContainer);var o={rate:{numpan:{a:5,b:8,center:!0},timepan:{a:.01,b:.02,center:null}},mass:1,rotation:{a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},velocity:.65,alpha:{a:[0,1],b:0},scale:{a:[.2,.02],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,parent:this.particleLayer,crossZone:null,randomDrift:null},a={rate:{numpan:{a:50,b:100,center:null},timepan:{a:.1,b:.2,center:null}},mass:1,rotation:{a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},velocity:[1.5,1.2,.8,.2],alpha:{a:[.5,1],b:0},scale:{a:[.2,.02],b:0,center:null},gravity:1,life:{a:0,b:2,center:null},radius:1,crossZone:null,randomDrift:null},s=[e.Texture.fromFrame("Star.png"),e.Texture.fromFrame("Star_orng_dot.png"),e.Texture.fromFrame("Star_yellow_dot.png")],l=new u(n.UI,s,o),h=new u(n.UI,s,a),d=this;this.emitters.push(l),this.emitters.push(h),n.UI.stage[0].addChild(l),n.UI.stage[0].addChild(h),n.UI.stage[0].addChild(this.particleLayer),l.x=i.x,l.y=i.y,h.x=r.x,h.y=r.y;new TWEEN.Tween({x:i.x,y:i.y}).easing(TWEEN.Easing.Linear.None).delay(300).onStart(function(){l.start(),n.Sounds.PlaySound("completeStack_chime")}).to({x:r.x,y:r.y},800).onUpdate(function(){l.x=this.x,l.y=this.y}).onComplete(function(){l.stop(),h.emitOnce(),d.cleanUpTimeout=window.setTimeout(function(){d.cleanUpParticles()},5e3)}).start()},d.prototype.initSpiderCardAnimator=function(t){this.SupplyView=t,this.AnimationDelayTimer=0,this.AnimationList=new i(r,Array),this.FlippedPileList=new i(s,s),this.TweenCache=new i(r,o),this.IsInAnimationSet=!1,this.IsUndoing=!1,this.IsDeal=!1,this.DealCardNum=0,this.NextAnimationDelay=0,this.AnimatingAction=null,this.IsShuffling=!1,this.showButterfly=!1,this.nextAnimationAction=null,this.emitters=[],this.cleanUpTimeout=null,this.movingRunToFoundation=!1},d.ROTATION_ANGLE=Math.PI,d.ANIMATION_LENGTH=.2,d.ANIMATION_DELAY=.3,d.CARD_DELAY=.05,d.ANIM_LENGTH_DRAW=.6,d.CARD_DELAY_DRAW=.1,d.AnimationEntry=function(t,e,i,n,r,o,a){this.initAnimationEntry(t,e,i,n,r,o,a)},d.AnimationEntry.prototype.initAnimationEntry=function(t,i,n,r,o,a,s){this.WorldPos=t?t.clone():new e.Point(0,0),this.WorldRot=i||0,this.WorldScale=n?n.clone():new e.Point(1,1),this.CardFlip=r||0,this.Wait=o||0,this.Speed=a||0,this.SoundToPlayAtFinish=s,this.ReversePileLayering=!1,this.ForceLayer=null,this.ForceLayer2=null},d.prototype.BeginAnimationSet=function(t){this.IsInAnimationSet=!0,this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1},d.prototype.EndAnimationSet=function(){this.IsInAnimationSet=!1},d.prototype.BeginAnimation=function(e,i){this.IsInAnimationSet||(this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.FlippedPileList.Clear(),this.DealCardNum=0,this.IsDeal=!1),this.AnimatingAction=e,this.IsUndoing=i,t.forEach(this.SupplyView.CardSupply.GetCardList(),function(t){var e=this.SupplyView.GetCardView(t);if(!this.AnimationList.ContainsKey(e)){var i=new d.AnimationEntry;i.Wait=this.AnimationDelayTimer,i.Speed=0,i.WorldPos=e.parent.toGlobal(e.position),this.AnimationList.Add(e,[i])}},this)},d.prototype.ContinueAnimation=function(i,n){this.SupplyView.UpdatePileChildren(!1);var r=d.ANIMATION_LENGTH,h=d.ANIMATION_DELAY,u=d.CARD_DELAY;this.SupplyView.CardSupply.EnforceGameRules||(r=.2,h=.05,u=0);var c=i.Ops[n];if(c.Opcode==a.Op.Move){var p=c.GetPile(a.eMoveParams.SourcePile),g=c.GetPile(a.eMoveParams.DestPile),f=c.GetNumber(a.eMoveParams.NumCards);if("Stock"==p.Type&&(r=d.ANIM_LENGTH_DRAW,u=d.CARD_DELAY_DRAW,h=.1),this.IsUndoing){var y=p;p=g,g=y,u*=.75,h*=.75,r*=.75}var m=this.SupplyView.GetPileView(p),C=this.SupplyView.GetPileView(g),S=!1;f<0&&(f=-f,S=!0,this.FlippedPileList.ContainsKey(C)||this.FlippedPileList.Add(C,C)),"Tableau"==p.Type&&"Foundation"==g.Type&&(S=!1,u=.3,r=.4,h=0),i.Ops.length>24&&(h*=.2),f>13&&(this.IsDeal=!0),f>12?u*=.1:f>6&&(u*=.25),m.CardFacing==s.Facing.Hidden||C.CardFacing==s.Facing.Hidden?(r=0,h=0,u=0):this.NextAnimationDelay>0&&(this.AnimationDelayTimer+=this.NextAnimationDelay,this.NextAnimationDelay=0);var b=t.clone(g.GetCards()),v=b.length,w=!1;this.movingRunToFoundation&&(w=!0);for(var x=0;x<f;x++){var T=x+1;S&&(T=f-x);var M=function(t){return v<t?null:t<=0?null:b[v-t]}(T),_=this.SupplyView.GetCardView(M),P=new d.AnimationEntry;P.Wait=this.AnimationDelayTimer,P.Speed=r,P.ReversePileLayering=S,w&&(P.Wait=1.2);var A=_.GetCardPositionInPile(null,!0);if(P.WorldPos=_.parent.toGlobal(A),"FaceDown"!==p.Type&&C.parent.setChildIndex(C,C.parent.children.length-1),P.WorldPos=_.parent.toGlobal(new e.Point(A.x,A.y)),C.CardFacing==s.Facing.FaceDown?P.CardFlip=1:P.CardFlip=0,this.IsDeal&&f<104&&(P.ForceLayer=l.TopLayer+1+M.Supply.Count-this.DealCardNum,P.ForceLayer2=l.TopLayer+1+M.Supply.Count+this.DealCardNum,this.DealCardNum++),"Tableau"==p.Type&&"Foundation"==g.Type){this.SupplyView.AddChild(C),this.movingRunToFoundation=!0,_.LayerWhileAnimating=l.TopLayer+f-x,P.ForceLayer=_.LayerWhileAnimating;!function(t,e,i,n){window.setTimeout(function(){g.moveCardInPile(f-1,t-1),i.SupplyView.UpdatePileChildren(!1)}.bind(i),1e3*(0+P.Wait)),o.Start(_).Wait(0).Call(function(){if(0==e){var t,r={x:C.worldTransform.tx,y:C.worldTransform.ty};t=m.StackedPile.Pile.Count>0?i.SupplyView.GetCardView(m.StackedPile.Pile.Top):m.StackedPile,t={x:t.worldTransform.tx,y:t.worldTransform.ty},i.trailParticles(n,t,r)}}.bind(i))}(T,x,this,_)}else this.movingRunToFoundation=!1;"Stock"!=p.Type&&("Foundation"==g.Type&&0==x||this.SupplyView.GetPileView(p).CardFacing==s.Facing.FaceDown&&this.SupplyView.GetPileView(g).CardFacing==s.Facing.FaceUp&&(P.SoundToPlayAtFinish="flipCard")),this.AnimationList.Get(_).push(P),f>1&&(this.AnimationDelayTimer+=u)}this.AnimationDelayTimer+=h}},d.prototype.EndAnimation=function(e,i){var r=0;this.TweenCache.Clear(),t.forEach(this.AnimationList.GetKeys(),function(t){var e=this.AnimationList.Get(t);if(!(e.length<2)){t instanceof l&&(t.Animating=!0),r++;var a;if(this.TweenCache.ContainsKey(t))a=this.TweenCache.Get(t).Then();else{var s=o.GetTweens(t);a=null!=s&&s.length>0?s[0].Then():o.Start(t),this.TweenCache.Add(t,a)}for(var h=0,u=0;u<e.length;u++){var d=e[u],c=t.parent.toLocal(d.WorldPos),p=t.scale.clone();if(0==u)t.SetPosition(c),t.SetScale(p);else{if(a=a.Wait(d.Wait-h).Then(),d.Wait>0&&null!=this.nextAnimationAction){var g=this.nextAnimationAction;a=a.Call(g).And(),this.nextAnimationAction=null}null!=d.ForceLayer2&&t instanceof l&&(a=a.Call(function(){t.LayerWhileAnimating=d.ForceLayer2.Value}).And()),h=d.Wait+d.Speed,a=a.MoveTo(c,d.Speed,TWEEN.Easing.Cubic.Out).And().ScaleTo(p,d.Speed,TWEEN.Easing.Cubic.Out),t instanceof l&&(a=a.And().CustomTo(t.SetCardFlipAngle.bind(t),t.GetCardFlipAngle.bind(t),d.CardFlip,d.Speed,TWEEN.Easing.Exponential.Out))}a=a.Then(),null!=d.ForceLayer&&(a=a.Then().Call(function(t){t instanceof l&&(t.LayerWhileAnimating=null)})),null!=d.SoundToPlayAtFinish&&a.Call(function(){n.Sounds.PlaySound(d.SoundToPlayAtFinish)})}a=a.Call(this.StopAnimating.bind(this)),a=a.Call(function(){r=this.EndAnimTrigger(r,i)}.bind(this))}},this),this.AnimationList.Clear(),this.TweenCache.Clear(),0==r&&i(e)},d.prototype.GetTweenedTimeScale=function(t,e,i){return n.TimeScale},d.prototype.SetTweenedTimeScale=function(t,e,i){n.TimeScale=i},d.prototype.StopAnimating=function(t){t instanceof l&&(t.Animating=!1),this.FlippedPileList.Clear()},d.prototype.EndAnimTrigger=function(t,e){return t--,0==t&&(this.movingRunToFoundation=!1,this.IsShuffling&&(this.IsShuffling=!1,null!=this.OnShuffleFinished&&this.OnShuffleFinished()),null!=e&&e(this.AnimatingAction)),t},d.prototype.BeginShuffleAnimation=function(){null!=this.WinAnimator&&this.WinAnimator.EndAnimation(),this.IsShuffling=!0},d.prototype.IsShuffleAnimationRunning=function(){return this.IsShuffling},d.prototype.TriggerWinAnimation=function(t){if(this.SupplyView.CardSupply.Authority.IsChallenge)this.WinAnimator=null,null!=t&&t();else{if(this.SupplyView.CurrentLayout==h.LayoutState.VerticalView)return void(null!=t&&t());this.WinAnimator=this.SupplyView.CreateGameEndAnimator(),this.WinAnimator.BeginAnimation(t,null,null,!1)}},d.prototype.ShouldShowEndingPopup=function(){return null==this.WinAnimator||this.WinAnimator.ShouldShowEndingPopup()},d.prototype.DoesAnimationBlockInput=function(t){for(var e=0;e<t.Ops.length;e++){var i=t.Ops[e];if(i.Opcode==a.Op.Move&&"Foundation"==i.GetPile(a.eMoveParams.DestPile).Type)return!0}return!1},d.prototype.DelayNextAnimation=function(t){this.NextAnimationDelay=t},d.prototype.OnNextAnimationStart=function(t){this.nextAnimationAction=t},d.prototype.onHide=function(){this.cleanUpParticles()},d.prototype.cleanUpParticles=function(){t.each(this.emitters,function(t){t.destroy(),n.UI.stage[0].removeChild(t)}),this.emitters.length=0,this.particleLayer&&(n.UI.stage[0].removeChild(this.particleLayer),this.particleLayer=null),null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null)},d}),define("SolitaireShared/SpiderTemplate/SpiderWindowsTemplate",["lodash","pixi","util/eventhandler","Arkadium/GameEngine/Core/EngineManagers","CardUI/SupplyView","CardUI/PileView","CardUI/KeyboardNavigator","SolitaireShared/CardLogic/Supply","SolitaireShared/SpiderLogic/SpiderAuthority","SolitaireShared/SpiderTemplate/SpiderInputInterpreter","SolitaireShared/SpiderTemplate/SpiderCardAnimator","util/SettingsManager","Arkadium/GameEngine/Maths/Vector2","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){"use strict";var g=function(){this.initSpiderWindowsTemplate()};return g.prototype.initSpiderWindowsTemplate=function(){this._authorityReference=null,this._supplyViewReference=null,this._curAutoSolveView=null,this._curAutoSolveViewOnUpdated=new i,this.mobilePileSpacingOffset=80,this.defaultPileSpacingOffset=40},g.prototype.CreateAuthority=function(t){var e=null!=t?t.ConstructAuthority():new l;return e.Setup(),e.CardSupply.DeckSeed=null,this._authorityReference=e,e},g.prototype.Cleanup=function(){},g.prototype.CreateInputInterpreter=function(t){return new h(t)},g.prototype.CreateCardAnimator=function(t){return new u(t)},g.prototype.TryAutoSolve=function(t){},g.prototype.StopAutoSolving=function(){},g.prototype.DoLayoutPiles=function(e,i){var r="1"!==d.getSetting("spider","layoutDirection"),s=n.Display.Width,l=n.Display.Height;t.forEach(i.CardSupply.GetPileList(),function(t){if(null!=t){var e=i.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}},this);var h,u=.9,g=.76;s/l<1.5&&(u*=.82,g*=.85);var f=.39;this._authorityReference.IsChallenge&&(f=.84-.5);var y=0,m=[-.5*g,(1/9-.5)*g,(2/9-.5)*g,(3/9-.5)*g,(4/9-.5)*g,(5/9-.5)*g,(6/9-.5)*g,(7/9-.5)*g,(8/9-.5)*g,.5*g];h=i.GetPileView("Stock"),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.FanRight,h.DefaultPileSpacing=new c(20/209*u,0),h.FullyCompressOnDeal=!0,h.HeightLimit=1;var C=(m[3]-m[2])/3;p.Platform.isMobile()&&p.ScreenMetrics.screenWidth<1e3?p.ScreenMetrics.isPortrait()?h.LogicalScreenPos=new c(r?m[7]+C:m[1]+C,2*f):(f=.24,y=r?-.08:.08,h.LogicalScreenPos=new c(r?m[9]+2*C:m[0]-2.5*C,.165-.5)):h.LogicalScreenPos=new c(r?m[7]+C:m[1]+C,f),h.InteractionMode=o.Interaction.Click,h.FanFraction=10,h.FanLimit=50,h.DisplayType=o.Display.Tableau,h.ScaleX=1,h.ScaleY=1,h.KeyboardMode=o.KeyboardModes.TopCard,h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau8")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Tableau0"));for(var S=0;S<10;S++)h=i.GetPileView("FaceDown"+S),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.FanDown,p.Platform.isMobile()?h.DefaultPileSpacing=new c(0,40/209*u):h.DefaultPileSpacing=new c(0,24/209*u),h.LogicalScreenPos=new c(m[S]+y,.165-.5),h.ScaleX=1,h.ScaleY=1;var b=i.GetPileView("Stock");b.UpdatePosition(),b.parent.updateTransform(),b.updateTransform();for(var S=(new c(b.worldTransform.tx,b.worldTransform.ty),0);S<10;S++)h=i.GetPileView("Tableau"+S),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.FanDown,p.Platform.isMobile()?h.DefaultPileSpacing=new c(0,this.mobilePileSpacingOffset/209*u):h.DefaultPileSpacing=new c(0,this.defaultPileSpacingOffset/209*u),h.LogicalScreenPos=new c(m[S]+y,.165-.5),h.InteractionMode=o.Interaction.Drag,h.DisplayType=o.Display.Tableau,h.StackedPile=i.GetPileView("FaceDown"+S),p.Platform.isMobile()?p.ScreenMetrics.isPortrait()?h.HeightLimit=.48:this._authorityReference.IsChallenge?h.HeightLimit=.75:h.HeightLimit=.85:h.HeightLimit=0==S||1==S||8==S?.81:.9,h.ScaleX=1,h.ScaleY=1,h.KeyboardMode=o.KeyboardModes.AllCardsAndEmpty,9!=S&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+(S+1))),0!=S&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+(S-1))),S<=4?h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")):(h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Stock")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock"))),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Stock")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Stock"));i.DefaultKeyboardFocus=i.GetPileView("Tableau0");for(var S=0;S<8;S++){h=i.GetPileView("Foundation"+S),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile;var v=r?m[0]:m[7];p.Platform.isMobile()&&p.ScreenMetrics.screenWidth<1e3?p.ScreenMetrics.isPortrait()?h.LogicalScreenPos=new c(v+S/40*u,2*f):h.LogicalScreenPos=new c(r?m[9]+2*C:m[0]-2.5*C,.028056249999999994*S):h.LogicalScreenPos=new c(v+S/40*u,f),h.ScaleX=1,h.ScaleY=1}h=i.GetPileView("Root"),h.LogicalScreenPos=new c(i.GetPileView("Tableau9").LogicalScreenPos.x-99,i.GetPileView("Stock").LogicalScreenPos.y-99),h.DefaultPileSpacing=new c(0,0),h.CardFacing=o.Facing.Hidden,h.PileMode=o.Layout.Pile,h.InteractionMode=o.Interaction.None,i.CardScale=u},g.prototype.LoadGameOptions=function(t){t.SetOption("Suits",d.getSetting("spider","suits")),void 0===d.getSetting("spider","difficulty")&&d.setSetting("spider","difficulty","RANDOM"),t.SetOption("Difficulty",d.getSetting("spider","difficulty")),void 0===d.getSetting("spider","layoutDirection")&&d.setSetting("spider","layoutDirection","2")},g.prototype.SaveGameOptions=function(t){},Object.defineProperty(g.prototype,"EndGameStatStrings",{get:function(){return["Time","Score"]}}),g.prototype.GetEndGameStats=function(){return[this._authorityReference.CardSupply.CurrentTime.ToString(),this._authorityReference.CardSupply.Score.toString()]},Object.defineProperty(g.prototype,"SaveFilename",{get:function(){return"SPIDER_SAVE_FILE"}}),Object.defineProperty(g.prototype,"GameName",{get:function(){return"Spider"}}),Object.defineProperty(g,"SuitsOptionKey",{get:function(){return"APPDATA_KLONDIKE_SUITS"}}),g}),define("Solitaire/GameModes/SpiderGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/Solitaire","Solitaire/SolitaireGameMode","SolitaireShared/SpiderTemplate/SpiderWindowsTemplate","SolitaireShared/CardLogic/Supply","Solitaire/GameResult","Solitaire/GameState","Solitaire/SolitaireStatistics"],function(t,e,i,n,r,o,a,s,l){"use strict";var h=function(){this.initSpiderGameMode()};return h.constructor=h,h.prototype=Object.create(t.prototype),e.call(h.prototype),h.prototype.initSpiderGameMode=function(){this.Name=n.Spider},Object.defineProperty(h.prototype,"TimerOption",{get:function(){return s.CurrentGame.Authority.IsChallenge&&s.CurrentGame.Authority.TimerEnabled?e.TimerSettings.CountDown:e.TimerSettings.CountUp}}),h.prototype.OnMoveCardButton=function(){},h.prototype.IsUpdateDealButtonsVisible=function(){return!1},h.prototype.IsUpdateDrawButtonVisible=function(){return!1},h.prototype.ConfigureSolitairePage=function(t){o.UseCumulativeScoring=!1},h.prototype.CreateTemplate=function(){return new r},h.prototype.GetCheatMoves=function(){return"G SPIDER O SUITS 1 D 1204270129394494717836683660838923034543815746289121040560454131772628145613822745923526435696642396914842557418960399254184196261880840500047432460549037 B M 20 26 1 M 19 20 1 E [2] B M 14 24 1 M 13 14 1 E [3] B M 22 24 1 M 21 22 1 E [4] B M 24 18 3 M 23 24 1 E [5] B M 14 18 1 M 13 14 1 E [6] B M 30 22 1 M 29 30 1 E [9] B M 14 22 1 M 13 14 1 E [12] B M 12 26 1 M 11 12 1 E [14] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [16] M 16 12 1 [18] M 18 22 1 [18] B M 18 22 5 M 17 18 1 E [20] M 22 14 7 [25] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [27] U 1 [28] U 1 [30] M 12 14 2 [32] M 14 12 3 [34] M 22 12 5 [39] B M 14 24 1 M 13 14 1 E [42] M 26 14 1 [43] B M 14 28 2 M 13 14 1 E [44] M 28 26 2 [46] M 22 26 1 [49] U 1 [51] U 1 [53] M 28 26 2 [55] M 22 26 1 [60] M 14 30 1 [62] M 22 14 1 [64] M 30 22 2 [66] B M 22 26 5 M 21 22 1 E [69] M 14 22 1 [71] B M 26 14 11 M 25 26 1 E [73] M 28 26 1 [74] B M 22 26 2 M 21 22 1 E [110] B M 26 18 4 M 25 26 1 E [117] M 12 18 6 [147] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [149] M 28 24 1 [151] M 26 28 1 [152] M 20 24 1 [154] M 22 20 1 [158] M 14 16 1 [159] B M 14 20 11 M 20 3 -13 E [161] M 16 20 2 [164] B M 20 24 3 M 19 20 1 E [167] M 18 14 1 [168] B M 12 14 4 M 11 12 1 E [169] B M 12 14 1 M 11 12 1 E [171] M 30 24 1 [173] B M 26 20 1 M 25 26 1 E [174] B M 12 16 1 M 11 12 1 E [175] B M 18 16 11 M 17 18 1 M 16 4 -13 M 15 16 1 E [177] B M 18 12 1 M 17 18 1 E [179] B M 18 28 1 M 17 18 1 E [181] B M 22 12 1 M 21 22 1 E [182] B M 18 14 1 M 17 18 1 E [184] M 18 14 1 [185] B M 20 14 2 M 19 20 1 E [188] B M 20 24 1 M 19 20 1 E [189] B M 26 24 1 M 25 26 1 E [190] M 22 24 1 [191] B M 24 28 10 M 28 5 -13 M 27 28 1 E [193] M 20 16 1 [194] B M 16 18 2 M 15 16 1 E [195] B M 30 20 1 M 29 30 1 E [198] B M 16 30 1 M 15 16 1 E [199] B M 28 30 1 M 27 28 1 E [201] B M 16 12 1 M 15 16 1 E [206] B M 12 18 4 M 11 12 1 E [207] B M 14 18 7 M 18 6 -13 E [212] B M 16 18 1 M 15 16 1 E [214] M 24 30 1 [215] M 24 22 1 [216] B M 24 22 1 M 23 24 1 E [217] M 22 12 2 [218] B M 24 22 1 M 23 24 1 E [225] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [228] M 26 22 1 [228] M 22 20 2 [230] M 20 14 3 [231] M 14 18 4 [232] M 18 14 5 [235] M 24 12 1 [239] M 30 18 1 [240] B M 30 18 4 M 29 30 1 E [242] B M 30 14 1 M 29 30 1 E [253] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [254] M 28 18 1 [255] M 18 22 2 [257] M 26 28 1 [258] M 26 28 1 [260] M 20 28 1 [261] M 24 28 1 [264] M 12 20 1 [270] M 12 26 2 [271] M 12 22 3 [288] B M 28 12 6 M 27 28 1 E [289] B M 28 30 1 M 27 28 1 E [292] B M 24 30 1 M 23 24 1 E [296] M 30 24 3 [303] M 16 30 1 [321] B M 2 12 1 M 2 14 1 M 2 16 1 M 2 18 1 M 2 20 1 M 2 22 1 M 2 24 1 M 2 26 1 M 2 28 1 M 2 30 1 E [323] M 28 26 1 [324] M 24 26 2 [325] M 28 26 1 [326] M 30 26 1 [327] M 30 26 2 [331] M 26 24 6 [334] M 22 14 1 [335] M 14 24 2 [335] B M 22 24 2 M 24 7 -13 E [338] M 14 16 1 [340] M 14 12 5 [343] M 16 24 2 [344] M 16 28 1 [345] M 26 28 2 [346] B M 26 12 1 M 12 8 -13 E [348] M 16 26 1 [348] M 26 22 2 [351] M 22 20 6 [352] M 20 24 7 [353] M 24 22 9 [354] B M 22 28 10 M 28 9 -13 E [355] M 18 20 1 [359] M 14 20 4 [362] M 18 16 1 [362] M 18 20 5 [364] M 16 18 1 [364] N"},h.prototype.HelpDataSource=function(){return null},h.prototype.ButtonsPostion=function(t){return null},h.prototype.GetGameEnd=function(){throw"TODO"},h.prototype.SetShare=function(t){},h.GetStatKeyStatic=function(){return new l.StatKey(s.CurrentGame.ActiveMode.Name,(s.CurrentGame.GetOption("SUITS")+n.getModeById(s.CurrentGame.ActiveMode.Name)).toUpperCase())},h.prototype.GetStatKey=function(){return h.GetStatKeyStatic()},h.prototype.UpdateStatistics=function(t){var e=h.GetStatKeyStatic();s.CurrentGame.GameResult==a.Win?l.Current.UpdateGameWon(e):s.Current==s.GameComplete&&l.Current.UpdateGameLost(e),t.ScoreText=l.Current.GetScoreFormatString(e),t.Time=l.Current.GetTimeFormatString(e),t.HighScore=l.Current.GetHighScoreFormatString(e),t.BestTime=l.Current.GetBestTimeFormatString(e),t.GamesPlayed=l.Current.GetGamesPlayedFormatString(e),t.GamesWon=l.Current.GetGamesWonFormatString(e),t.WinPercentage=l.Current.GetPercentWon(e),t.Stacks=l.Current.GetStacksFormatString(e)},h.prototype.UpdateLeaderBoard=function(){},h}),define("SolitaireShared/FreeCellTemplate/FreeCellInputInterpreter",["absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardSuit","CardUI/PileView","util/SettingsManager","SolitaireShared/CardLogic/Pile"],function(t,e,i,n,r,o,a,s){"use strict";var l=function(t){this.initFreeCellInputInterpreter(t)};return l.DoubleClickThreshold=700,l.prototype.initFreeCellInputInterpreter=function(t){this.Authority=t,this.InputEnabled=!0,this.HighlightedCard=null,this.HighlightTime=-1},l.prototype.Drag=function(t,e){return this.IsCardHighlighted()&&e>50&&this.ClearHighlight(),!0},l.prototype.NotifyCardsMoved=function(){this.ClearHighlight()},l.prototype.DoMoveCard=function(t,e,i,n){var r=e.GetCardPosFromEnd(t);n.Parse(["move",e.Name,i.Name,r.toString()])},l.prototype.Drop=function(t,n){var r=!1,o=t.Card.Supply,a=new i(o);if(a.Parse(["noop"]),!this.InputEnabled)return a;for(var l=0;l<n.length;l++){var h=n[l],u=t.Card,d=u.Pile,c=h instanceof s?h:h.Pile;if(d==c)break;if(this.ClearHighlight(),this.DoMoveCard(u,d,c,a),a.IsAllowed()){"Foundation"==c.Type?(e.Sounds.PlaySound("foundation"),r=!0):(e.Sounds.PlaySound("legalMove"),r=!0);break}}return r||e.Sounds.PlaySound("illegalMove"),a},l.TryFoundationPiles=["Foundation0","Foundation1","Foundation2","Foundation3"],l.TryFreePiles=["Free0","Free1","Free2","Free3"],l.prototype.ClickCard=function(t,o,s){var h=t.Card.Supply,u=new i(h);if(u.Parse(["noop"]),!this.InputEnabled||!t.IsDraggable&&!s)return u;if(this.IsCardHighlighted()||o)if(this._highlightedCard!=t&&!o||"Foundation"==t.Card.Pile.Type){if(null!=this._highlightedCard){var d=this._highlightedCard.Card,c=d.Pile,p=t.Card.Pile;c!=p?(this.DoMoveCard(d,c,p,u),u.IsAllowed()?(this.ClearHighlight(),t.IsDragging=t.SupplyView.IsCardDragging=!1):this.Authority.CanPickupCard(t.Card)&&this.HighlightCard(t)):this.Authority.CanPickupCard(t.Card)?this.HighlightCard(t):this.Authority.TriggerTip(),u.IsAllowed()&&e.Sounds.PlaySound("legalMove")}}else{var g=e.Time.TotalGameTime.TotalMilliseconds;if(!a.getSetting("default","singleTapToMove")&&(o||g-this._highlightTime<l.DoubleClickThreshold)){var f=null;if(t.Card.Value==n.Values.Ace)switch(t.Card.Suit){case r.Hearts:f=this.Authority.CardSupply.GetPile("Foundation0");break;case r.Clubs:f=this.Authority.CardSupply.GetPile("Foundation1");break;case r.Diamonds:f=this.Authority.CardSupply.GetPile("Foundation2");break;case r.Spades:f=this.Authority.CardSupply.GetPile("Foundation3")}else for(var y=0;y<l.TryFoundationPiles.length;y++){var m=l.TryFoundationPiles[y];if(f=this.Authority.CardSupply.GetPile(m),!f.Empty&&t.Card.Suit==f.Top.Suit&&t.Card.ValueNum==f.Top.ValueNum+1)break;f=null}if(null!=f)this.DoMoveCard(t.Card,t.Card.Pile,f,u),e.Sounds.PlaySound("foundation");else{for(var C=null,y=0;y<l.TryFreePiles.length;y++){var S=l.TryFreePiles[y],b=this.Authority.CardSupply.GetPile(S);if(b.Empty){C=b;break}}null!=C&&(this.DoMoveCard(t.Card,t.Card.Pile,C,u),u.IsAllowed()&&(e.Sounds.PlaySound("legalMove"),this.ClearHighlight()))}}else this._highlightTime=e.Time.TotalGameTime.TotalMilliseconds}else this.Authority.CanPickupCard(t.Card)?this.HighlightCard(t):this.Authority.TriggerTip();return u},l.prototype.ClickEmptyPile=function(t){var e=t.Pile.Supply,n=new i(e);if(n.Parse(["noop"]),!this.InputEnabled)return n;if(this.IsCardHighlighted()){var r=this._highlightedCard.Card,o=r.Pile,a=t.Pile;this.DoMoveCard(r,o,a,n),this.ClearHighlight()}return n},l.prototype.ClickOutside=function(){this.ClearHighlight()},l.prototype.IsCardHighlighted=function(){return null!=this._highlightedCard},l.prototype.GetHighlightedCard=function(){return this._highlightedCard},l.prototype.HighlightCard=function(i){this._highlightedCard=i,this._highlightedCard.Highlight(),this._highlightTime=e.Time.TotalGameTime.TotalMilliseconds,t.log("HighlightCard "+i.Card.toString())},l.prototype.ClearHighlight=function(){null!=this._highlightedCard&&(this._highlightedCard.ClearHighlight(),this._highlightedCard=null,this._highlightTime=-1),t.log("ClearHighlight()")},l.prototype.ShouldMoveKeyboard=function(t,e){return!1},l.prototype.DealNextFromStock=function(t){},l}),define("SolitaireShared/FreeCellTemplate/FreeCellCardAnimator",["lodash","pixi","util/dictionary","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween","SolitaireShared/CardLogic/CardOp","CardUI/PileView","CardUI/CardView","CardUI/SupplyView"],function(t,e,i,n,r,o,a,s,l,h){"use strict";var u=function(t){this.initFreeCellCardAnimator(t)};u.prototype.initFreeCellCardAnimator=function(t){this.SupplyView=t,this.AnimationList=new i(r,Array),this.TweenCache=new i(r,o),this.WinAnimator=null,this.IsInAnimationSet=!1,this.DealCardNum=0,this.IsDeal=!1,this.IsUndoing=!1,this.AnimatingAction=null,this.IsShuffling=!1,this.NextAnimationDelay=0,this.nextAnimationAction=null};Math.PI;return u.AnimationEntry=function(t,e,i,n,r,o,a){this.initAnimationEntry(t,e,i,n,r,o,a)},u.AnimationEntry.prototype.initAnimationEntry=function(t,i,n,r,o,a,s){this.WorldPos=t?t.clone():new e.Point(0,0),this.WorldRot=i||0,this.WorldScale=n?n.clone():new e.Point(1,1),this.CardFlip=r||0,this.Wait=o||0,this.Speed=a||0,this.ForceLayer=null,this.ForceLayer2=null,this.BeforeStart=s},u.prototype.BeginAnimationSet=function(t){this.IsInAnimationSet=!0,this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1},u.prototype.EndAnimationSet=function(){this.IsInAnimationSet=!1},u.prototype.BeginAnimation=function(e,i){this.IsInAnimationSet||(this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1),this.AnimatingAction=e,this.IsUndoing=i,t.forEach(this.SupplyView.CardSupply.GetCardList(),function(t){var e=this.SupplyView.GetCardView(t);if(!this.AnimationList.ContainsKey(e)){var i=new u.AnimationEntry;i.Wait=this.AnimationDelayTimer,i.Speed=0,i.WorldPos=e.parent.toGlobal(e.position),this.AnimationList.Add(e,[i])}},this)},u.prototype.ContinueAnimation=function(t,i){this.SupplyView.UpdatePileChildren(!1);var n=.3,h=.2,d=.05;this.SupplyView.CardSupply.EnforceGameRules||(n=.2,h=.05,d=0);var c=t.Ops[i];if(c.Opcode==a.Op.Move){var p=c.GetPile(a.eMoveParams.SourcePile),g=c.GetPile(a.eMoveParams.DestPile),f=c.GetNumber(a.eMoveParams.NumCards);if("Stock"==p.Type&&(n=.2,d=.1),this.IsUndoing){var y=p;p=g,g=y,d*=.75,h*=.75,n*=.75}var m=this.SupplyView.GetPileView(p),C=this.SupplyView.GetPileView(g),S=!1;f<0&&(f=-f,S=!0),t.Ops.length>24&&(h*=.7,d*=1),f>13?(d*=.1,this.IsDeal=!0):f>6&&(d*=.25),m.CardFacing==s.Facing.Hidden||C.CardFacing==s.Facing.Hidden?(n=0,h=0,d=0):this.NextAnimationDelay>0&&(this.AnimationDelayTimer+=this.NextAnimationDelay,this.NextAnimationDelay=0);for(var b=0;b<f;b++){var v=b+1;S&&(v=f-b);var w=g.NthFromTop(v),x=this.SupplyView.GetCardView(w),T=new u.AnimationEntry;T.Wait=this.AnimationDelayTimer,T.Speed=n;var M=x.GetCardPositionInPile(null,!0);if(T.WorldPos=x.Parent.toGlobal(M),this.IsDeal&&f<52&&(T.BeforeStart=function(){this.SupplyView.bringPileAndCardToTop(C,x)}.bind(this)),C.CardFacing==s.Facing.FaceDown?T.CardFlip=1:T.CardFlip=0,this.IsDeal&&f<52&&(T.ForceLayer=l.TopLayer+1+w.Supply.Count-this.DealCardNum,T.ForceLayer2=l.TopLayer+1+w.Supply.Count+this.DealCardNum,this.DealCardNum++),"Foundation"==g.Type&&!this._isUndoing){var _=new r("foundation_effect.png");_.Position=C.Position,_.TextureAlphaEnabled=!0,_.InputEnabled=!1,_.ScaleUniform=l.ScaleFactor,_.Alpha=1,this.SupplyView.AddChildAt(_,0)
;o.Start(_).Wait(.15).Then().ScaleTo(new e.Point(1.5*l.ScaleFactor,1.5*l.ScaleFactor),.8,TWEEN.Easing.Cubic.Out).And().FadeTo(0,.8,TWEEN.Easing.Cubic.Out).Then().Call(function(t){t.Parent.RemoveChild(t)})}this.AnimationList.Get(x).push(T),f>1&&(this.AnimationDelayTimer+=d)}this.AnimationDelayTimer+=h}},u.prototype.EndAnimation=function(e,i){var n=0;this.TweenCache.Clear(),t.forEach(this.AnimationList.GetKeys(),function(t){var e=this.AnimationList.Get(t);if(!(e.length<2)){t instanceof l&&(t.Animating=!0),n++;var r;if(this.TweenCache.ContainsKey(t))r=this.TweenCache.Get(t).Then();else{var a=o.GetTweens(t);r=null!=a&&a.length>0?a[0].Then():o.Start(t),this.TweenCache.Add(t,r)}for(var s=0;s<e.length;s++){var h=e[s],u=t.parent.toLocal(h.WorldPos),d=h.WorldScale;if(null!=h.ForceLayer&&t instanceof l&&(t.LayerWhileAnimating=h.ForceLayer.Value),0==s)t.SetPosition(u),t.SetScale(d);else{if(r=r.Wait(h.Wait).Then(),null!=h.BeforeStart&&(r=r.Call(function(){h.BeforeStart()}).Then()),h.Wait>0&&null!=this.nextAnimationAction){var c=this.nextAnimationAction;r=r.Call(c).And(),this.nextAnimationAction=null}r=r.MoveTo(u,h.Speed,TWEEN.Easing.Quintic.Out).And().ScaleTo(d,h.Speed,TWEEN.Easing.Quintic.Out),t instanceof l&&(r=r.And().CustomTo(t.SetCardFlipAngle.bind(t),t.GetCardFlipAngle.bind(t),h.CardFlip,h.Speed,TWEEN.Easing.Circular.Out))}r=r.Then(),null!=h.ForceLayer&&(r=r.Then().Call(function(t){t instanceof l&&(t.LayerWhileAnimating=null)}))}r=r.Call(this.StopAnimating.bind(this)),r=r.Call(function(){n=this.EndAnimTrigger(n,i)}.bind(this))}},this),this.AnimationList.Clear(),this.TweenCache.Clear(),0==n&&i(e)},u.prototype.GetTweenedTimeScale=function(t,e,i){return n.TimeScale},u.prototype.SetTweenedTimeScale=function(t,e,i){n.TimeScale=i},u.prototype.StopAnimating=function(t){t instanceof l&&(t.Animating=!1)},u.prototype.EndAnimTrigger=function(t,e){if(0==--t){if(this.IsShuffling&&(this.IsShuffling=!1,null!=this.OnShuffleFinished)){var i=this.OnShuffleFinished;setTimeout(function(){i()},50),this.OnShuffleFinished=null}null!=e&&e(this.AnimatingAction)}return t},u.prototype.BeginShuffleAnimation=function(){null!=this.WinAnimator&&this.WinAnimator.EndAnimation(),this.IsShuffling=!0},u.prototype.IsShuffleAnimationRunning=function(){return this.IsShuffling},u.prototype.TriggerWinAnimation=function(t){if(this.SupplyView.CardSupply.Authority.IsChallenge)this.WinAnimator=null,null!=t&&t();else{if(this.SupplyView.CurrentLayout==h.LayoutState.VerticalView)return void(null!=t&&t());this.WinAnimator=this.SupplyView.CreateGameEndAnimator(),this.WinAnimator.BeginAnimation(t,null,null,!1)}},u.prototype.ShouldShowEndingPopup=function(){return null==this.WinAnimator||this.WinAnimator.ShouldShowEndingPopup()},u.prototype.DoesAnimationBlockInput=function(t){return!1},u.prototype.DelayNextAnimation=function(t){this.NextAnimationDelay=t},u.prototype.OnNextAnimationStart=function(t){this.nextAnimationAction=t},u}),define("SolitaireShared/FreeCellTemplate/FreeCellWindowsTemplate",["lodash","pixi","util/eventhandler","Arkadium/GameEngine/Core/EngineManagers","CardUI/SupplyView","CardUI/PileView","CardUI/KeyboardNavigator","SolitaireShared/CardLogic/Supply","SolitaireShared/FreeCellLogic/FreeCellAuthority","SolitaireShared/FreeCellTemplate/FreeCellInputInterpreter","SolitaireShared/FreeCellTemplate/FreeCellCardAnimator","Arkadium/GameEngine/Maths/Vector2","util/SettingsManager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){"use strict";var g=function(){this.initFreeCellWindowsTemplate()};return g.prototype.initFreeCellWindowsTemplate=function(){this._authorityReference=null},g.prototype.CreateAuthority=function(t){var e=null!=t?t.ConstructAuthority():new l;return e.Setup(),e.CardSupply.DeckSeed=null,this._authorityReference=e,e},g.prototype.Cleanup=function(){},g.prototype.CreateInputInterpreter=function(t){return new h(t)},g.prototype.CreateCardAnimator=function(t){return new u(t)},g.prototype.TryAutoSolve=function(t){},g.prototype.StopAutoSolving=function(){},g.prototype.DoLayoutPiles=function(e,i){var r="1"===c.getSetting("freecell","layoutDirection"),s=n.Display.Width,l=n.Display.Height;t.forEach(i.CardSupply.GetPileList(),function(t){if(null!=t){var e=i.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}});var h,u=[o.Display.Heart,o.Display.Club,o.Display.Diamond,o.Display.Spade],g=.98,f=.75,y=.75/18;s/l<1.5&&(g*=.85,f*=.85,y*=.85);for(var m=[-.4375*f,-.3125*f,-.1875*f,-.0625*f,.0625*f,.1875*f,.3125*f,.4375*f],C=0;C<8;C++)h=i.GetPileView("Tableau"+C),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.FanDown,p.Platform.isMobile()?h.DefaultPileSpacing=new d(0,60/209*g):h.DefaultPileSpacing=new d(0,48/209*g),h.LogicalScreenPos=new d(m[C],.41-.5),h.InteractionMode=o.Interaction.Drag,h.DisplayType=o.Display.Blank,h.HeightLimit=.97,p.Platform.isMobile()&&(p.ScreenMetrics.isPortrait()||(this._authorityReference.IsChallenge?h.HeightLimit=.75:h.HeightLimit=.85)),h.ScaleX=1,h.ScaleY=1,h.KeyboardMode=o.KeyboardModes.AllCardsAndEmpty,h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Foundation0")),C>0&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+(C-1))),C<7&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+(C+1))),C<4?(h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Free"+C)),0!=C&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Free"+C))):(h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Foundation"+(C-4))),7!=C&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Foundation"+(C-4))));i.DefaultKeyboardFocus=i.GetPileView("Tableau0");for(var C=0;C<4;C++){h=i.GetPileView("Free"+C),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile;var S=r?m[C]-y:m[C+4]+y;h.LogicalScreenPos=new d(S,-.325),h.InteractionMode=o.Interaction.Drag,h.ScaleX=1,h.ScaleY=1,h.DisplayType=o.Display.Tableau,h.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,h.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Foundation0")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Tableau0")),C>0&&(h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Free"+(C-1))),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+C))),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,C<3?i.GetPileView("Free"+(C+1)):i.GetPileView("Foundation0")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau"+C))}for(var C=0;C<4;C++){h=i.GetPileView("Foundation"+C),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile;var S=r?m[C+4]+y:m[C]-y;h.LogicalScreenPos=new d(S,-.325),h.InteractionMode=o.Interaction.Drag,h.ScaleX=1,h.ScaleY=1,h.DisplayType=u[C],h.KeyboardMode=o.KeyboardModes.TopCardAndEmpty,h.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Tableau0")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Free0")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,C>0?i.GetPileView("Foundation"+(C-1)):i.GetPileView("Free3")),C<3&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Foundation"+(C+1))),3!=C&&h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+(C+4))),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Tableau"+(C+4)))}h=i.GetPileView("Stock"),h.LogicalScreenPos=new d(0,.39),h.DisplayType=o.Display.Blank,h.CardFacing=o.Facing.FaceDown,h=i.GetPileView("Root"),h.LogicalScreenPos=new d(-99,-99),h.DefaultPileSpacing=new d(0,0),h.CardFacing=o.Facing.Hidden,h.PileMode=o.Layout.Pile,h.InteractionMode=o.Interaction.None,i.DefaultKeyboardFocus=i.GetPileView("Tableau0"),i.CardScale=g},g.prototype.LoadGameOptions=function(t){void 0===c.getSetting("freecell","difficulty")&&c.setSetting("freecell","difficulty","RANDOM"),t.SetOption("Difficulty",c.getSetting("freecell","difficulty")),void 0===c.getSetting("freecell","layoutDirection")&&c.setSetting("freecell","layoutDirection","1")},g.prototype.SaveGameOptions=function(t){},Object.defineProperty(g.prototype,"EndGameStatStrings",{get:function(){return["Time"]}}),g.prototype.GetEndGameStats=function(){return[this._authorityReference.CardSupply.CurrentTime.ToString()]},Object.defineProperty(g.prototype,"GameName",{get:function(){return"FreeCell"}}),Object.defineProperty(g.prototype,"SaveFilename",{get:function(){return"FREECELL_SAVE_FILE"}}),g}),define("Solitaire/GameModes/FreeCellGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/Solitaire","Solitaire/SolitaireGameMode","SolitaireShared/FreeCellTemplate/FreeCellWindowsTemplate","SolitaireShared/CardLogic/Supply","Solitaire/GameResult","Solitaire/GameState","Solitaire/SolitaireStatistics"],function(t,e,i,n,r,o,a,s,l){"use strict";var h=function(){this.initFreeCellGameMode()};return h.constructor=h,h.prototype=Object.create(t.prototype),e.call(h.prototype),h.prototype.initFreeCellGameMode=function(){this.Name=n.FreeCell},Object.defineProperty(h.prototype,"TimerOption",{get:function(){return s.CurrentGame.Authority.IsChallenge&&s.CurrentGame.Authority.TimerEnabled?e.TimerSettings.CountDown:e.TimerSettings.CountUp}}),h.prototype.OnMoveCardButton=function(){},h.prototype.IsUpdateDealButtonsVisible=function(){return!1},h.prototype.IsUpdateDrawButtonVisible=function(){return!1},h.prototype.ConfigureSolitairePage=function(t){o.UseCumulativeScoring=!1},h.prototype.CreateTemplate=function(){return new r},h.prototype.GetCheatMoves=function(){return"G FREECELL D 49897363627438679165818481216805914107022257796838332724511239606694 M 12 5 1 M 12 5 1 [7] M 12 13 1 [9] M 13 12 2 [15] M 13 14 2 [17] M 15 9 1 [17] M 15 3 1 [39] M 11 8 1 [39] M 14 11 3 [45] M 14 13 1 [45] M 14 6 1 [52] M 17 14 1 [56] M 14 12 1 [56] M 12 14 1 [59] U 1 [60] U 1 [61] U 1 [68] M 12 10 1 [73] M 14 12 1 [74] M 18 14 1 [74] M 18 4 1 [75] M 12 14 2 [79] M 17 14 1 [88] M 11 16 2 [236] M 15 17 1 [237] M 15 7 1 [237] M 15 6 1 [239] M 15 6 1 [239] M 7 6 1 [242] M 17 15 2 [246] M 11 15 2 [252] M 17 14 1 [257] M 17 7 1 [257] M 17 3 1 [257] M 17 5 1 [286] M 12 17 1 [287] M 12 3 1 [287] M 9 3 1 [289] M 11 3 1 [289] M 11 4 1 [292] M 17 11 1 [294] M 11 17 2 [296] M 11 12 1 [298] M 11 5 1 [299] M 7 5 1 [305] M 18 7 1 [307] M 7 11 1 [307] M 12 11 2 [307] M 12 6 1 [318] M 14 17 4 [319] M 13 17 1 [321] M 18 16 1 [323] M 16 11 4 [327] M 18 7 1 [338] M 8 12 1 [339] M 7 12 1 [340] M 16 9 1 [341] M 16 17 1 [342] M 16 14 1 [342] M 16 4 1 [342] M 18 4 1 [343] M 9 4 1 [343] M 17 4 1 [370] M 14 18 3 [381] M 12 14 2 [386] M 16 13 1 [389] M 13 16 2 [389] M 13 3 1 [390] M 13 5 1 [390] M 14 4 1 [396] M 10 18 1 [397] M 13 18 1 [398] M 16 18 2 [399] M 15 16 4 [401] M 11 15 7 [404] M 15 13 7 [404] M 16 15 4 [407] M 13 16 7 [408] M 15 11 4 [410] M 11 13 4 [410] N "},h.prototype.HelpDataSource=function(){return null},h.prototype.ButtonsPostion=function(t){return null},h.prototype.GetGameEnd=function(){throw"TODO"},h.prototype.SetShare=function(t){},h.GetStatKeyStatic=function(){return new l.StatKey(s.CurrentGame.ActiveMode.Name,n.getModeById(s.CurrentGame.ActiveMode.Name).toUpperCase())},h.prototype.GetStatKey=function(){return h.GetStatKeyStatic()},h.prototype.UpdateStatistics=function(t){var e=h.GetStatKeyStatic();s.CurrentGame.GameResult==a.Win?l.Current.UpdateGameWon(e):s.Current==s.GameComplete&&l.Current.UpdateGameLost(e),t.Time=l.Current.GetTimeFormatString(e),t.BestTime=l.Current.GetBestTimeFormatString(e),t.GamesPlayed=l.Current.GetGamesPlayedFormatString(e),t.GamesWon=l.Current.GetGamesWonFormatString(e),t.WinPercentage=l.Current.GetPercentWon(e)},h.prototype.UpdateLeaderBoard=function(){},h}),define("SolitaireShared/TriPeaksTemplate/TriPeaksInputInterpreter",["absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n){"use strict";var r=function(t){this.initTriPeaksInputInterpreter(t)};return r.prototype.initTriPeaksInputInterpreter=function(t){this.Authority=t,this.IsClickedOnCard=!1,this.InputEnabled=!0,this.HighlightedCard=null,this.HighlightTime=-1},r.prototype.NotifyCardsMoved=function(){this.ClearHighlight()},r.prototype.Drag=function(t,e){return!0},r.prototype.Drop=function(t,e){var n=t.Card.Supply,r=new i(n);return r.Parse(["noop"]),r},r.prototype.ClickCard=function(t,n){var r=t.Card.Supply,o=new i(r);if(o.Parse(["noop"]),n)return o;if(!this.InputEnabled)return o;if("Stock"==t.Card.Pile.Type)o.Parse(["move",t.Card.Pile.Name,"Waste","1"]),this.Authority.CardSupply.OnFlipCard();else if("Tableau"==t.Card.Pile.Type){if(!t.Card.Pile.Empty){var a=this.Authority.GetTableausRevealedByRemoving(t.Card.Pile);if(0==a.length)o.Parse(["move",t.Card.Pile.Name,"Waste","1"]);else if(1==a.length){var s=this.Authority.GetFaceDownForTableau(a[0]);o.Parse(["begin","move",t.Card.Pile.Name,"Waste","1","move",s.Name,a[0].Name,"1","end"]),this.Authority.CardSupply.OnFlipCard()}else if(2==a.length){var s=this.Authority.GetFaceDownForTableau(a[0]),l=this.Authority.GetFaceDownForTableau(a[1]);o.Parse(["begin","move",t.Card.Pile.Name,"Waste","1","move",s.Name,a[0].Name,"1","move",l.Name,a[1].Name,"1","end"]),this.Authority.CardSupply.OnFlipCard()}o.IsAllowed()&&e.Sounds.PlaySound("flipCardOffScreen")}}else"Joker"==t.Card.Pile.Type&&(e.Sounds.PlaySound("wildCard"),o.Parse(["move",t.Card.Pile.Name,"Waste","1"]),this.Authority.CardSupply.OnFlipCard());return o},r.prototype.ClickEmptyPile=function(t){var e=t.Pile.Supply,n=new i(e);return n.Parse(["noop"]),this.InputEnabled?(t.Pile.Type,n):n},r.prototype.ClickOutside=function(){},r.prototype.IsCardHighlighted=function(){return null!=this.HighlightedCard},r.prototype.GetHighlightedCard=function(){return this.HighlightedCard},r.prototype.HighlightCard=function(i){this.HighlightedCard=i,this.HighlightedCard.Highlight(),this.HighlightTime=e.Time.TotalGameTime.TotalMilliseconds,t.log("HighlightCard "+i.Card)},r.prototype.ClearHighlight=function(){null!=this.HighlightedCard&&(this.HighlightedCard.ClearHighlight(),this.HighlightedCard=null,this.HighlightTime=-1),t.log("ClearHighlight()")},r.prototype.ShouldMoveKeyboard=function(t,e){if(!this.InputEnabled)return!1;for(var i=0;i<t.Ops.length;i++){var r=t.Ops[i];if(r.Opcode==n.Op.Move){var o=r.GetPile(n.eMoveParams.SourcePile),a=r.GetPile(n.eMoveParams.DestPile);if("Stock"!=o.Name&&(o.Top==e||a.Top==e))return!0}}return!1},r.prototype.DealNextFromStock=function(t){var n=this.Authority.CardSupply,r=new i(n);n.GetPile("Stock").Empty||r.Parse(["begin","move","Stock","Waste","1","end"]),r.Run()&&e.Sounds.PlaySound("singleCard")},r}),define("SolitaireShared/TriPeaksTemplate/TriPeaksCardAnimator",["lodash","pixi","absolute/debug","util/dictionary","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Maths/Bezier2D","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween","SolitaireShared/CardLogic/CardOp","SolitaireShared/CardLogic/CardValue","CardUI/PileView","CardUI/CardView","absolute/particleemitter","absolute/coords","absolute/stringmanager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y){"use strict";var m=function(t){this.initTriPeaksCardAnimator(t)};m.prototype.initTriPeaksCardAnimator=function(t){this.SupplyView=t,this.AnimationList=new n(s,Array),this.TweenCache=new n(s,l),this.IsInAnimationSet=!1,this.DealCardNum=0,this.IsDeal=!1,this.IsUndoing=!1,this.AnimatingAction=null,this.IsShuffling=!1,this.NextAnimationDelay=0,this.nextAnimationAction=null,this.AnimationDelayTimer=0,this.SupplyView.CardSupply.Authority.onBonusEffectEventHanlder.add(this.bonusEffect.bind(this)),this.emitters=[],this.cleanUpTimeout=null,this.WinAnimator=null};var C=Math.PI;return m.AnimationEntry=function(t,e,i,n,r,o,a,s){this.initAnimationEntry(t,e,i,n,r,o,a,s)},m.AnimationEntry.prototype.initAnimationEntry=function(t,i,n,r,o,a,s,l){this.WorldPos=t?t.clone():new e.Point(0,0),this.WorldRot=i,this.WorldScale=n?n.clone():new e.Point(1,1),this.CardFlip=r||0,this.Wait=o||0,this.Speed=a||0,this.ForceLayer=null,this.ForceLayer2=null,this.SoundToPlayAtFinish=s,this.OnComplete=l},m.prototype.bonusEffect=function(t,i){null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null),this.particleLayer||(this.particleLayer=new e.DisplayObjectContainer),this.SupplyView.CardSupply.IncrementActiveAnimations();var n,r,o=e.Sprite.fromFrame(i.bonus.toString()+".png"),s=e.Sprite.fromFrame("tripeaks_cardburst.png"),l=e.Sprite.fromFrame("tripeaks_cardburst_godrays.png"),h={rate:{numpan:{a:.3*i.bonus,b:.6*i.bonus,center:null},timepan:{a:.1,b:.2,center:null}},mass:1,rotation:{a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},velocity:{rpan:{a:0,b:4,center:null},thapan:{a:0,b:360,center:null},type:"polar"},alpha:{a:1,b:0},scale:{a:[.25,.02],b:0,center:null},gravity:0,life:{a:.5,b:1,center:null},radius:1,crossZone:null,randomDrift:null},u=[e.Texture.fromFrame("Star.png"),e.Texture.fromFrame("Star_orng_dot.png"),e.Texture.fromFrame("Star_yellow_dot.png")],d=new p(a.UI,u,h),c=this.SupplyView.GetPileView(i.pile),f={x:c.worldTransform.tx,y:c.worldTransform.ty},y="peak"+i.peaks,m=this;if(this.emitters.push(d),d.x=f.x,d.y=f.y,o.x=l.x=s.x=f.x,o.y=l.y=s.y=f.y,o.anchor.x=o.anchor.y=l.anchor.x=l.anchor.y=s.anchor.x=s.anchor.y=.5,o.scale.x=o.scale.y=0,this.particleLayer.addChild(d),this.particleLayer.addChild(l),this.particleLayer.addChild(s),this.particleLayer.addChild(o),a.UI.stage[0].addChild(this.particleLayer),a.Sounds.PlaySound(y),new TWEEN.Tween({scale:2,alpha:1}).easing(TWEEN.Easing.Exponential.Out).to({scale:0,alpha:0},1400).onUpdate(function(){s.scale.x=s.scale.y=this.scale,s.alpha=this.alpha}).start(),new TWEEN.Tween({scale:.5*i.peaks,alpha:1,rotation:l.rotation}).easing(TWEEN.Easing.Linear.None).to({scale:0,alpha:0,rotation:3},1e3).onUpdate(function(){l.scale.x=l.scale.y=this.scale,l.alpha=this.alpha,l.rotation=this.rotation}).start(),n=new TWEEN.Tween({scale:0,alpha:0}).easing(TWEEN.Easing.Exponential.Out).delay(300).onStart(function(){d.emitOnce()}).to({scale:1,alpha:1},400).onUpdate(function(){o.scale.x=o.scale.y=this.scale,o.alpha=this.alpha}).start(),r=new TWEEN.Tween({alpha:1}).easing(TWEEN.Easing.Cubic.Out).delay(1e3).to({alpha:0},500).onUpdate(function(){o.alpha=this.alpha}).onComplete(function(){i.isPerfect||m.SupplyView.CardSupply.DecrementActiveAnimations(),m.cleanUpTimeout=window.setTimeout(function(){i.isPerfect||m.cleanUpParticles()},5e3)}),n.chain(r),i.isPerfect){var C,S,b=this.createTextureForPerfectText();b.anchor.x=.5,b.anchor.y=.5,b.alpha=0,b.x=a.UI.width/2,b.y=a.UI.height/2,this.particleLayer.addChild(b),new TWEEN.Tween({scale:2,alpha:1,rotation:l.rotation}).easing(TWEEN.Easing.Linear.None).delay(600).to({scale:0,alpha:0,rotation:3},1e3).onStart(function(){l.x=b.x,l.y=b.y,l.rotation=0}).onUpdate(function(){l.scale.x=l.scale.y=this.scale,l.alpha=this.alpha,l.rotation=this.rotation}).start(),C=new TWEEN.Tween({scale:0,alpha:0}).easing(TWEEN.Easing.Exponential.Out).delay(600).to({scale:1,alpha:1},400).onStart(function(){a.Sounds.PlaySound("perfect")}).onUpdate(function(){b.scale.x=b.scale.y=this.scale,b.alpha=this.alpha}).start(),S=new TWEEN.Tween({alpha:1,y:b.y}).easing(TWEEN.Easing.Cubic.Out).delay(1e3).to({alpha:0,y:g.y(100)},2500).onUpdate(function(){b.alpha=this.alpha,b.y=this.y}).onComplete(function(){m.SupplyView.CardSupply.DecrementActiveAnimations(),m.cleanUpTimeout=window.setTimeout(function(){m.cleanUpParticles()},5e3)}),C.chain(S)}},m.prototype.trimCanvas=function(t,e){var i=document.createElement("canvas").getContext("2d"),n=e.getImageData(0,0,t.width,t.height),r={top:null,left:null,right:null,bottom:null};return this.findTransparentPixels(r,n,t),this.getTrimmedCanvas(r,i,e)},m.prototype.findTransparentPixels=function(t,e,i){for(var n,r,o=e.data.length,a=0;a<o;a+=4)0!==e.data[a+3]&&(n=a/4%i.width,r=~~(a/4/i.width),this.checkBounds(t,n,r))},m.prototype.getTrimmedCanvas=function(t,e,i){var n=t.bottom-t.top,r=t.right-t.left,o=i.getImageData(t.left,t.top,r,n);return e.canvas.width=r,e.canvas.height=n,e.putImageData(o,0,0),e.canvas},m.prototype.checkBounds=function(t,e,i){t.top||(t.top=i),t.left?e<t.left&&(t.left=e):t.left=e,t.right?t.right<e&&(t.right=e):t.right=e,t.bottom?t.bottom<i&&(t.bottom=i):t.bottom=i},m.prototype.BeginAnimationSet=function(t){this.IsInAnimationSet=!0,this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1},m.prototype.EndAnimationSet=function(){this.IsInAnimationSet=!1},m.prototype.BeginAnimation=function(e,i){this.IsInAnimationSet||(this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1),this.AnimatingAction=e,this.IsUndoing=i,t.forEach(this.SupplyView.CardSupply.GetCardList(),function(t){var e=this.SupplyView.GetCardView(t);if(!this.AnimationList.ContainsKey(e)){var i=new m.AnimationEntry;i.Wait=this.AnimationDelayTimer,i.Speed=0,e.parent&&(i.WorldPos=e.parent.toGlobal(e.position)),this.AnimationList.Add(e,[i])}},this)},m.prototype.ContinueAnimation=function(t,i){this.SupplyView.UpdatePileChildren(!1);var n=.1,s=.1,l=.05,p=t.Ops[i];if(this.SupplyView.CardSupply.EnforceGameRules||(n=.2,s=.1,l=0),t.Ops.length>24&&(s*=.4,l*=.4),p.Opcode==h.Op.Move){var g=p.GetPile(h.eMoveParams.SourcePile),f=p.GetPile(h.eMoveParams.DestPile),y=p.GetNumber(h.eMoveParams.NumCards),C=!1;if("Stock"==g.Type&&(n=.2,l=.1),"Stock"!=g.Type||"Tableau"!=f.Type&&"FaceDown"!=f.Type||(C=!0),this.IsUndoing){var S=g;g=f,f=S,l*=.75,s*=.75,n*=.75}var b=this.SupplyView.GetPileView(g),v=this.SupplyView.GetPileView(f),w=!1;y<0&&(y=-y,w=!0),y>12?(this.IsDeal=!0,l*=.1,this.SupplyView.reversePiles()):y>6&&(l*=.25),b.CardFacing==d.Facing.Hidden||v.CardFacing==d.Facing.Hidden?(n=0,s=0,l=0):this.NextAnimationDelay>0&&(this.AnimationDelayTimer+=this.NextAnimationDelay,this.NextAnimationDelay=0);for(var x=0;x<y;x++){var T=x+1;w&&(T=y-x);var M=f.NthFromTop(T),_=this.SupplyView.GetCardView(M),P=new m.AnimationEntry;P.Wait=this.AnimationDelayTimer,P.Speed=n,C&&(P.OnComplete=function(){this.SupplyView.pileViewToIndex(v)}.bind(this));var A=_.GetCardPositionInPile(null,!0);if(P.WorldPos=_.Parent.toGlobal(A),v.CardFacing==d.Facing.FaceDown?P.CardFlip=1:P.CardFlip=0,this.IsDeal&&1==y?(P.ForceLayer=c.TopLayer+1+M.Supply.Count-this.DealCardNum,P.ForceLayer2=c.TopLayer+1+M.Supply.Count+this.DealCardNum,this.DealCardNum++):this.SupplyView.GetPileView(g).CardFacing==d.Facing.FaceDown&&this.SupplyView.GetPileView(f).CardFacing==d.Facing.FaceUp&&(P.SoundToPlayAtFinish="flipCard"),"Tableau"==g.Type&&"Waste"==f.Type){var k=b.toLocal(v.toGlobal(new e.Point(0,0))),D=.03*_.Height,F=r.Zero,E=new r(k.x,-.4*a.Display.Height),I=new r(E.x,k.y+D),G=new o([F,E,I],o.BezierPointType.Control);P.Bezier=G;parseInt(g.Name.substring("Tableau".length))<=2&&(P.WaitAfter=1),P.ForceLayer=c.TopLayer+1;var O=(t.Tag|this.SupplyView.CardSupply.Authority._chainNumber)>>>0,B=Math.min((65535&O)>>>0,15);f.NthFromTop(2).Value==u.Values.Joker?P.SoundToPlayAtFinish="cardOnWildCard":P.SoundToPlayAtFinish=B>15?"matchCard16":"matchCard"+(B+1)}this.AnimationList.Get(_).push(P),y>1&&(this.AnimationDelayTimer+=l)}this.AnimationDelayTimer+=s}},m.prototype.EndAnimation=function(e,i){var n=0;this.TweenCache.Clear(),t.forEach(this.AnimationList.GetKeys(),function(t){var e=this.AnimationList.Get(t);if(!(e.length<2)){t instanceof c&&(t.Animating=!0),n++;var r;if(this.TweenCache.ContainsKey(t))r=TweenCache.Get(t).Then();else{var o=l.GetTweens(t);r=null!=o&&o.length>0?o[0].Then():l.Start(t),this.TweenCache.Add(t,r)}for(var s=0;s<e.length;s++){var h=e[s],u=t.parent.toLocal(h.WorldPos),d=t.scale.clone();if(null!=h.ForceLayer&&t instanceof c&&(t.LayerWhileAnimating=h.ForceLayer.Value),0==s)t.SetPosition(u),t.SetScale(d);else{if(r=r.Wait(h.Wait).Then(),h.Wait>0&&null!=this.nextAnimationAction){var p=this.nextAnimationAction;r=r.Call(p).And(),this.nextAnimationAction=null}null!=h.OnComplete&&r.Call(function(){window.setTimeout(function(){h.OnComplete()},100)}),r=null==h.Bezier?r.MoveTo(u,h.Speed,h.Easing):r.MoveByBezier(h.Bezier,.6).And().RotateBy(4*C,.5).Then().MoveTo(u,.1),r=r.And().ScaleTo(d,h.Speed,h.Easing),t instanceof c&&(r=r.And().CustomTo(t.SetCardFlipAngle.bind(t),t.GetCardFlipAngle.bind(t),h.CardFlip,h.Speed,TWEEN.Easing.Exponential.Out))}r=r.Then(),(null!=h.ForceLayer||null!=h.ForceLayer2)&&t instanceof c&&(r=r.Call(function(t){t instanceof c&&(t.LayerWhileAnimating=null)})),null!=h.SoundToPlayAtFinish&&r.Call(function(){a.Sounds.PlaySound(h.SoundToPlayAtFinish)})}r=r.Call(this.StopAnimating.bind(this)),r=r.Call(function(){n=this.EndAnimTrigger(n,i)}.bind(this))}},this),this.AnimationList.Clear(),this.TweenCache.Clear(),0==n&&null!=i&&i(e)},m.prototype.GetTweenedTimeScale=function(t,e,i){return a.TimeScale},m.prototype.SetTweenedTimeScale=function(t,e,i){a.TimeScale=i},m.prototype.StopAnimating=function(t){t instanceof c&&(t.Animating=!1)},m.prototype.EndAnimTrigger=function(t,e){return t--,0==t&&(this.IsShuffling&&(this.IsShuffling=!1,null!=this.OnShuffleFinished&&this.OnShuffleFinished(),this.SupplyView.undoReversePiles()),null!=e&&(e(this.AnimatingAction),e=null)),t},m.prototype.createTextureForPerfectText=function(){var t=document.createElement("canvas");t.width=700,t.height=300;var i=t.getContext("2d");i.lineJoin="round";var n=f("dialogs.perfectEarnedHeadline");i.moveTo(0,100);var r=i.createLinearGradient(0,50,0,170);r.addColorStop(0,"#fffcf3"),r.addColorStop(.33,"#ffefb0"),r.addColorStop(.66,"#ffdb4a"),r.addColorStop(1,"#f3c307");var o=i.createLinearGradient(0,0,0,170);o.addColorStop(0,"#ffeb52"),o.addColorStop(.5,"#ffe478"),o.addColorStop(.8,"#fea704"),o.addColorStop(1,"#c76c01");return i.font="bold "+65*y.ScreenMetrics.getResScale()+"px Segoe UI",i.shadowColor="#ffd429",i.shadowBlur=100,i.shadowOffsetX=0,i.shadowOffsetY=-6,i.strokeStyle=o,i.lineWidth=10,i.strokeText(n,70,170),i.shadowColor="rgba(153,119,58, 0.8)",i.shadowBlur=3,i.shadowOffsetX=-1,i.shadowOffsetY=-1,i.strokeStyle=o,i.lineWidth=10,i.strokeText(n,70,170),i.shadowColor="rgba(243, 68, 0 , 0.9)",i.shadowBlur=3,i.shadowOffsetX=1,i.shadowOffsetY=1,i.fillStyle=r,i.fillText(n,70,170),i.stroke(),new e.Sprite(e.Texture.fromCanvas(this.trimCanvas(t,i)))},m.prototype.BeginShuffleAnimation=function(){null!=this.WinAnimator&&this.WinAnimator.EndAnimation(),this.IsShuffling=!0},m.prototype.IsShuffleAnimationRunning=function(){return this.IsShuffling},m.prototype.TriggerWinAnimation=function(t){this.WinAnimator=null,null!=t&&t()},m.prototype.ShouldShowEndingPopup=function(){return null==this.WinAnimator||this.WinAnimator.ShouldShowEndingPopup()},m.prototype.DoesAnimationBlockInput=function(t){return!1},m.prototype.DelayNextAnimation=function(t){this.NextAnimationDelay=t},m.prototype.OnNextAnimationStart=function(t){this.nextAnimationAction=t},m.prototype.onHide=function(){this.cleanUpParticles()},m.prototype.cleanUpParticles=function(){t.each(this.emitters,function(t){t.destroy()}),this.emitters.length=0,this.particleLayer&&(a.UI.stage[0].removeChild(this.particleLayer),this.particleLayer=null),null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null)},m}),define("SolitaireShared/TriPeaksTemplate/TriPeaksWindowsTemplate",["lodash","pixi","util/eventhandler","Arkadium/GameEngine/Core/EngineManagers","CardUI/SupplyView","CardUI/PileView","CardUI/KeyboardNavigator","SolitaireShared/CardLogic/Supply","SolitaireShared/TriPeaksLogic/TriPeaksAuthority","SolitaireShared/TriPeaksTemplate/TriPeaksInputInterpreter","SolitaireShared/TriPeaksTemplate/TriPeaksCardAnimator","Arkadium/GameEngine/Maths/Vector2","util/SettingsManager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){"use strict";var g=function(){this.initTriPeaksWindowsTemplate()};return g.prototype.initTriPeaksWindowsTemplate=function(){this._authorityReference=null,this._supplyViewReference=null,this._curAutoSolveView=null,this._curAutoSolveViewOnUpdated=new i},g.prototype.CreateAuthority=function(t){var e=null!=t?t.ConstructAuthority():new l;return e.Setup(),e.CardSupply.DeckSeed=null,this._authorityReference=e,e},g.prototype.Cleanup=function(){},g.prototype.CreateInputInterpreter=function(t){return new h(t)},g.prototype.CreateCardAnimator=function(t){return new u(t)},g.prototype.TryAutoSolve=function(t){},g.prototype.StopAutoSolving=function(){},g.prototype.DoLayoutPiles=function(e,i){var r="1"===c.getSetting("tripeaks","layoutDirection"),s=n.Display.Width,l=n.Display.Height;t.forEach(i.CardSupply.GetPileList(),function(t){if(null!=t){var e=i.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}},this);var h,u=.92,g=.76;s/l<1.5&&(u*=.85,g*=.855);var f=[-.3,.33-.5,.46-.5,.59-.5],y=.83-.5;this._authorityReference.IsChallenge&&(f=[.16-.5,.29-.5,-.06,.55-.5],y=.785-.5);var m=[-.5*g,(1/18-.5)*g,(2/18-.5)*g,(3/18-.5)*g,(4/18-.5)*g,(5/18-.5)*g,(6/18-.5)*g,(7/18-.5)*g,(8/18-.5)*g,0*g,(10/18-.5)*g,(11/18-.5)*g,(12/18-.5)*g,(13/18-.5)*g,(14/18-.5)*g,(15/18-.5)*g,(16/18-.5)*g,(17/18-.5)*g,.5*g],C=[3,9,15,2,4,8,10,14,16,1,3,5,7,9,11,13,15,17,0,2,4,6,8,10,12,14,16,18],S=[0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3],b=[18,19,9,20,10,3,21,11,4,0,22,12,23,13,5,24,14,6,1,25,15,26,16,7,27,17,8,2],v=[27,26,17,25,16,8,24,15,7,2,23,14,22,13,6,21,12,5,1,20,11,19,10,4,18,9,3,0],w=[22,23,21,24,20,15,19,26,18,27,13,12,14,11,15,10,16,9,17,5,6,4,7,3,8,1,0,2];h=i.GetPileView("Stock"),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.FanRight,h.FanLimit=999,h.ScaleX=1,h.ScaleY=1;var x=r?6/14-.5-1/56:8/14-.5+1/56;p.Platform.isMobile()&&(x=r?6/14-.5-1/12:8/14-.5+1/12),h.LogicalScreenPos=new d(x*g,y+.02),h.InteractionMode=o.Interaction.Click,h.DisplayType=o.Display.Stock,h.KeyboardMode=o.KeyboardModes.TopCardAndEmpty;var T=r?1:-1;h.DefaultPileSpacing=new d(6*T/300*u,0),h.FullyCompressOnDeal=!1,h.HeightLimit=1,h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Stock"));for(var M=0;M<w.length;M++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+w[M]));h.Keyboard.RegisterKeypressHandler(a.KeyPress.Activate,function(t,e){if(t instanceof o&&t.Pile.Empty){var i=t.SupplyView.GetKeyboardUI("dealnextdeck");null!=i&&i.Keyboard.HandleKeypress(a.KeyPress.Activate)}return!1}),i.DefaultKeyboardFocus=i.GetPileView("Stock"),h=i.GetPileView("Waste"),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.ScaleX=1,h.ScaleY=1,x=r?8/14-.5+1/56:6/14-.5-1/56,p.Platform.isMobile()&&(x=8/14-.57),h.LogicalScreenPos=new d(x*g,y+.02),h.InteractionMode=o.Interaction.None,h=i.GetPileView("Root"),h.LogicalScreenPos.set(i.GetPileView("Waste").LogicalScreenPos.x+99,i.GetPileView("Waste").LogicalScreenPos.y+99),h.DefaultPileSpacing=new d(0,0),h.CardFacing=o.Facing.Hidden,h.PileMode=o.Layout.Pile,h.InteractionMode=o.Interaction.None,h=i.GetPileView("Joker"),h.LogicalScreenPos=new d(m[0],y),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.ScaleX=1,h.ScaleY=1,h.InteractionMode=o.Interaction.Click,h.KeyboardMode=o.KeyboardModes.TopCard,h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Stock"));for(var M=0;M<b.length;M++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+b[M]));for(var M=0;M<28;M++){h=i.GetPileView("Tableau"+M),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.LogicalScreenPos=new d(m[C[M]],f[S[M]]),h.InteractionMode=o.Interaction.Click,h.DisplayType=o.Display.Blank,h.ScaleX=1,h.ScaleY=1,h.AllowClickWhenEmpty=!1,h.KeyboardMode=o.KeyboardModes.TopCard;for(var _=0;_<b.length;_++)if(b[_]==M){for(var P=_+1;P<b.length;P++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+b[P]));for(var P=0;P<_;P++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+b[P]));break}for(var _=0;_<v.length;_++)if(v[_]==M){for(var P=_+1;P<v.length;P++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+v[P]));for(var P=0;P<_;P++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+v[P]));break}h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")),
h.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Stock"))}for(var M=0;M<18;M++)h=i.GetPileView("FaceDown"+M),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.Pile,h.LogicalScreenPos=new d(m[C[M]],f[S[M]]),h.InteractionMode=o.Interaction.None,h.ScaleX=1,h.ScaleY=1,h.AllowClickWhenEmpty=!1;i.CardScale=u},g.prototype.LoadGameOptions=function(t){},g.prototype.SaveGameOptions=function(t){},Object.defineProperty(g.prototype,"EndGameStatStrings",{get:function(){return["Boards Played","Score"]}}),g.prototype.GetEndGameStats=function(){return[this._authorityReference.CurrentDeal.ToString(),""+this._authorityReference.CardSupply.Score]},Object.defineProperty(g.prototype,"GameName",{get:function(){return"TriPeaks"}}),Object.defineProperty(g,"SuitsOptionKey",{get:function(){return"TRIPEAKS_SAVE_FILE"}}),g}),define("Solitaire/GameModes/TriPeaksGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/Solitaire","Solitaire/SolitaireGameMode","SolitaireShared/TriPeaksTemplate/TriPeaksWindowsTemplate","SolitaireShared/CardLogic/Supply","Solitaire/GameResult","Solitaire/GameState","Solitaire/SolitaireStatistics"],function(t,e,i,n,r,o,a,s,l){"use strict";var h=function(){this.initTriPeaksGameMode()};return h.constructor=h,h.prototype=Object.create(t.prototype),e.call(h.prototype),h.prototype.initTriPeaksGameMode=function(){this.Name=n.TriPeaks,this.WaitForAnimationOnHint=!1},Object.defineProperty(h.prototype,"TimerOption",{get:function(){return s.CurrentGame.Authority.IsChallenge&&s.CurrentGame.Authority.TimerEnabled?e.TimerSettings.CountDown:e.TimerSettings.Off}}),h.prototype.OnMoveCardButton=function(){},h.prototype.IsUpdateDealButtonsVisible=function(){var t=s.CurrentGame.Authority.CardSupply.IsWaitingForAds||!s.CurrentGame.Authority.CardSupply.IsGamePageLoaded,e=0==s.CurrentGame.Authority.CardSupply.GetPile("Stock").Count;return!t&&e},h.prototype.IsUpdateDrawButtonVisible=function(){return!1},h.prototype.ConfigureSolitairePage=function(t){o.UseCumulativeScoring=!1},h.prototype.CreateTemplate=function(){return new r},h.prototype.GetCheatMoves=function(){return"G TRIPEAKS O SHUFFLE_0 23300404821998148255264241710013489742524053918641307983027393488047237440914352187968148924726293127043466634092752002595262028194245227115087614301864275366 O SHUFFLE_1 770114002330040482199814825526424171001348974252405391864130798302739348804723744091435218796814892472629312704346663409275200259526202819424522711508761430 O SHUFFLE_2 285370938377011400233004048219981482552642417100134897425240539186413079830273934880472374409143521879681489247262931270434666340927520025952620281942452271 O NUM_SHUFFLES_STORED 3 O SHUFFLE_3 2642417100134897425240539186413079830273934880472374409143521879681489247262931270434666340927520025952620281942452271150876143018642753663396205882181990241 D 63882222104584319680929264235058511924883227801076008702301864275366 M 45 3 1 [1] M 2 3 1 [2] M 41 3 1 [2] B M 43 3 1 M 22 23 1 M 24 25 1 E [3] M 55 3 1 [3] B M 53 3 1 M 34 35 1 E [3] M 59 3 1 [5] M 23 3 1 [5] B M 57 3 1 M 36 37 1 M 38 39 1 E [6] B M 25 3 1 M 10 11 1 E [7] M 2 3 1 [8] B M 51 3 1 M 32 33 1 E [9] M 37 3 1 [9] B M 49 3 1 M 30 31 1 E [9] M 33 3 1 [11] M 11 3 1 [11] B M 31 3 1 M 16 17 1 E [12] M 17 3 1 [13] M 2 3 1 [14] M 2 3 1 [14] B M 35 3 1 M 18 19 1 E [15] B M 47 3 1 M 26 27 1 M 28 29 1 E [15] B M 39 3 1 M 20 21 1 E [16] B M 29 3 1 M 14 15 1 E [16] M 21 3 1 [17] M 2 3 1 [18] M 2 3 1 [19] B M 15 3 1 M 6 7 1 E [20] B M 19 3 1 M 8 9 1 E [21] M 7 3 1 [21] M 2 3 1 [22] M 9 3 1 [23] M 2 3 1 [24] B M 27 3 1 M 12 13 1 E [25] M 2 3 1 [26] B M 13 3 1 M 4 5 1 E [29] M 2 3 1 [30] M 2 3 1 [31] M 2 3 1 [31] M 2 3 1 [32] M 2 3 1 [32] M 2 3 1 [33] M 2 3 1 [34] M 2 3 1 [34] M 2 3 1 [35] M 2 3 1 [35] N "},h.prototype.HelpDataSource=function(){return null},h.prototype.ButtonsPostion=function(t){throw t=!!t,"TODO"},h.prototype.GetGameEnd=function(){throw"TODO"},h.prototype.SetShare=function(t){},h.GetStatKeyStatic=function(){return new l.StatKey(s.CurrentGame.ActiveMode.Name,n.getModeById(s.CurrentGame.ActiveMode.Name).toUpperCase())},h.prototype.GetStatKey=function(){return h.GetStatKeyStatic()},h.prototype.UpdateStatistics=function(t){var e=h.GetStatKeyStatic();s.CurrentGame.Authority.BoardsCompleted()>0?l.Current.UpdateGameWon(e):s.Current==s.GameComplete&&l.Current.UpdateGameLost(e),t.ScoreText=l.Current.GetScoreFormatString(e),t.HighScore=l.Current.GetHighScoreFormatString(e),t.GamesPlayed=l.Current.GetGamesPlayedFormatString(e),t.BoardsCleared=l.Current.GetStringFormat(s.CurrentGame.Authority.BoardsCompleted()),t.PeaksCleared=l.Current.GetStringFormat(s.CurrentGame.Authority.NumPeaksCleared),t.LongestCardsChained=l.Current.GetStringFormat(s.CurrentGame.Authority.CardsChained),t.LosingStreak=l.Current.GetLosingStreak(e)},h.prototype.UpdateLeaderBoard=function(){},h}),define("SolitaireShared/PyramidTemplate/PyramidInputInterpreter",["absolute/debug","Arkadium/GameEngine/Core/EngineManagers","SolitaireShared/CardLogic/CardAction","SolitaireShared/CardLogic/CardValue","SolitaireShared/CardLogic/CardOp"],function(t,e,i,n,r){"use strict";var o=function(t){this.initPyramidInputInterpreter(t)};return o.DoubleClickThreshold=700,o.prototype.initPyramidInputInterpreter=function(t){this.Authority=t,this.IsClickedOnCard=!1,this.InputEnabled=!0,this.HighlightedCard=null,this.HighlightTime=-1},o.prototype.NotifyCardsMoved=function(){this.ClearHighlight()},o.prototype.Drag=function(t,e){return!0},o.prototype.Drop=function(t,e){var n=t.Card.Supply,r=new i(n);return r.Parse(["noop"]),r},o.prototype.ClickCard=function(t,r){var a=t.Card.Supply,s=new i(a);if(s.Parse(["noop"]),t.Animating)return s;if(r)return s;if(!this.InputEnabled)return s;if(!("Tableau"!=t.Card.Pile.Type&&"Waste"!=t.Card.Pile.Type&&"Stock"!=t.Card.Pile.Type&&"Joker"!=t.Card.Pile.Type||"Tableau"==t.Card.Pile.Type&&this.Authority.IsTableauBlocked(t.Card.Pile)))if(this.IsCardHighlighted()){if(this.HighlightedCard==t)if("Stock"==t.Card.Pile.Type){var l=e.Time.TotalGameTime.TotalMilliseconds;l-this.HighlightTime<o.DoubleClickThreshold?(s.Parse(["begin","move","Stock","Waste","1","end"]),s.IsAllowed()&&(e.Sounds.PlaySound("singleCard"),this.ClearHighlight())):(this.ClearHighlight(),e.Sounds.PlaySound("deselectCard"))}else this.ClearHighlight(),e.Sounds.PlaySound("deselectCard");else if(t.Card.Value==n.Values.King)s.Parse(["move",t.Card.Pile.Name,"Foundation","1"]),this.ClearHighlight(),s.IsAllowed()&&(e.Sounds.PlaySound("flipCardOffScreen"),e.Sounds.PlaySound("matchCard1"));else if(this.GetHighlightedCard()!=t){var h=this.GetHighlightedCard();s.Parse(["begin","move",h.Card.Pile.Name,"Foundation","1","move",t.Card.Pile.Name,"Foundation","1","end"]),this.HighlightCard(t),s.IsAllowed()&&(this.PlayMatchSound("Joker"==t.Card.Pile.Type||"Joker"==h.Card.Pile.Name),e.Sounds.PlaySound("flipCardOffScreen"))}}else t.Card.Value==n.Values.King?(s.Parse(["move",t.Card.Pile.Name,"Foundation","1"]),this.ClearHighlight(),s.IsAllowed()&&(e.Sounds.PlaySound("flipCardOffScreen"),e.Sounds.PlaySound("matchCard1"))):this.HighlightCard(t);return s},o.prototype.PlayMatchSound=function(t){e.Sounds.PlaySound(t?"cardOnWildCard":"matchCard1")},o.prototype.ClickEmptyPile=function(t){var n=t.Pile.Supply,r=new i(n);if(r.Parse(["noop"]),!this.InputEnabled)return r;if("Stock"==t.Pile.Name){var o=n.GetPile("Waste");r.Parse(["move","Waste","Stock",(-o.Count).toString()]),r.IsAllowed()&&e.Sounds.PlaySound("drawReset")}return r},o.prototype.ClickOutside=function(){this.ClearHighlight()},o.prototype.IsCardHighlighted=function(){return null!=this.HighlightedCard},o.prototype.GetHighlightedCard=function(){return this.HighlightedCard},o.prototype.HighlightCard=function(i){this.ClearHighlight(),this.HighlightedCard=i,this.HighlightedCard.Highlight(),this.HighlightTime=e.Time.TotalGameTime.TotalMilliseconds,t.log("HighlightCard "+i.Card),e.Sounds.PlaySound("pickupCard")},o.prototype.ClearHighlight=function(){null!=this.HighlightedCard&&(this.HighlightedCard.ClearHighlight(),this.HighlightedCard=null,this.HighlightTime=-1)},o.prototype.ShouldMoveKeyboard=function(t,e){if(!this.InputEnabled)return!1;for(var i=0;i<t.Ops.length;i++){var n=t.Ops[i];if(n.Opcode==r.Op.Move){var o=n.GetPile(r.eMoveParams.SourcePile),a=n.GetPile(r.eMoveParams.DestPile);if("Stock"!=o.Name&&"Waste"!=o.Name&&(o.Top==e||a.Top==e||a.NthFromTop(2)==e))return!0}}return!1},o.prototype.DealNextFromStock=function(t){var n=this.Authority.CardSupply,r=new i(n),o=n.GetPile("Waste").Count;n.GetPile("Stock").Empty?(r.Parse(["begin","move","Waste","Stock","-"+o,"end"]),r.IsAllowed()&&e.Sounds.PlaySound("drawReset")):(r.Parse(["begin","move","Stock","Waste","1","end"]),r.IsAllowed()&&e.Sounds.PlaySound("singleCard")),r.Run(),!this.GetHighlightedCard()||"Stock"!=this.GetHighlightedCard().Card.Pile.Type&&"Waste"!=this.GetHighlightedCard().Card.Pile.Type||this.ClearHighlight()},o}),define("SolitaireShared/PyramidTemplate/PyramidCardAnimator",["lodash","pixi","absolute/debug","util/dictionary","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Tween/Tween","Arkadium/GameEngine/Maths/Vector2","Arkadium/GameEngine/Maths/Bezier2D","SolitaireShared/CardLogic/CardOp","CardUI/PileView","CardUI/CardView","CardUI/SupplyView","absolute/particleemitter","absolute/coords","absolute/stringmanager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y){"use strict";var m=function(t){this.initPyramidCardAnimator(t)};m.prototype.initPyramidCardAnimator=function(t){this.SupplyView=t,this.AnimationList=new n(o,Array),this.TweenCache=new n(o,a),this.IsInAnimationSet=!1,this.DealCardNum=0,this.IsDeal=!1,this.IsUndoing=!1,this.AnimatingAction=null,this.IsShuffling=!1,this.NextAnimationDelay=0,this.nextAnimationAction=null,this.AnimationDelayTimer=0,this.tweensToFinish=0,this.tweens=[],this.emitters=[],this.cleanUpTimeout=null,this.SupplyView.CardSupply.Authority.onBonusEffectEventHanlder.add(this.bonusEffect.bind(this)),this.WinAnimator=null};var C=(Math.PI,{None:0,Left:1,Right:2});return m.AnimationEntry=function(t,e,i,n,r,o){this.initAnimationEntry(t,e,i,n,r,o)},m.AnimationEntry.prototype.initAnimationEntry=function(t,i,n,r,o,a){this.WorldPos=t?t.clone():new e.Point(0,0),this.WorldRot=i,this.WorldScale=n?n.clone():new e.Point(1,1),this.CardFlip=r||0,this.Wait=o,this.Speed=a,this.Bezier=null,this.Dir=C.None,this.Rotation=0,this.WaitAfer=0,this.ForceLayer=null,this.ForceLayer2=null},m.prototype.bonusEffect=function(i,n){function o(t,i){var n,r=e.Sprite.fromFrame("fireworks-card-glow.png"),o=this.SupplyView.GetPileView("Tableau"+t.toString());h.push(r),r.anchor.x=r.anchor.y=.5,r.x=o.worldTransform.tx,r.y=o.worldTransform.ty,r.alpha=0,this.particleLayer.addChild(r),n=new TWEEN.Tween({scale:0,alpha:0}).easing(TWEEN.Easing.Linear.None).delay(50*i).to({scale:[1.5,0],alpha:[1,.2]},400).onUpdate(function(){r.scale.x=r.scale.y=this.scale,r.alpha=this.alpha}).interpolation(TWEEN.Interpolation.Bezier).start(),this.tweens.push(n)}null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null),this.particleLayer||(this.particleLayer=new e.DisplayObjectContainer),this.SupplyView.CardSupply.IncrementActiveAnimations();var a,s,l=e.Sprite.fromFrame(n.bonus.toString()+".png"),h=[],u={rate:{numpan:{a:Math.max(.3*n.bonus,50),b:Math.max(.6*n.bonus,100),center:null},timepan:{a:.1,b:.2,center:null}},mass:1,rotation:{a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},velocity:{rpan:{a:0,b:4,center:null},thapan:{a:0,b:360,center:null},type:"polar"},alpha:{a:1,b:0},scale:{a:[.25,.02],b:0,center:null},gravity:0,life:{a:.5,b:1,center:null},radius:1,crossZone:null,randomDrift:null},d=[e.Texture.fromFrame("Star.png"),e.Texture.fromFrame("Star_orng_dot.png"),e.Texture.fromFrame("Star_yellow_dot.png")],c=new p(r.UI,d,u),f=this.SupplyView.GetPileView(n.pile),y={x:f.worldTransform.tx,y:f.worldTransform.ty},m="row"+n.row,C=this;if(this.emitters.push(c),t.each(n.tableausToLeft,function(t,e){o.call(this,t,e)}.bind(this)),t.each(n.tableausToRight,function(t,e){o.call(this,t,e)}.bind(this)),c.x=y.x,c.y=y.y,l.x=y.x,l.y=y.y,l.anchor.x=l.anchor.y=.5,l.scale.x=l.scale.y=0,this.particleLayer.addChild(c),this.particleLayer.addChild(l),r.UI.stage[0].addChild(this.particleLayer),a=new TWEEN.Tween({scale:0,alpha:0}).easing(TWEEN.Easing.Exponential.Out).delay(200).onStart(function(){c.emitOnce(),r.Sounds.PlaySound(m)}).to({scale:1,alpha:1},400).onUpdate(function(){l.scale.x=l.scale.y=this.scale,l.alpha=this.alpha}).start(),s=new TWEEN.Tween({alpha:1}).easing(TWEEN.Easing.Cubic.Out).delay(1e3).to({alpha:0},500).onUpdate(function(){l.alpha=this.alpha}).onComplete(function(){n.isPerfect||C.SupplyView.CardSupply.DecrementActiveAnimations(),C.cleanUpTimeout=window.setTimeout(function(){n.isPerfect||C.cleanUpParticles()}.bind(this),1e3)}),a.chain(s),this.tweens.push(s),this.tweens.push(a),n.isPerfect){var S,b,v=this.createTextureForPerfectText();v.anchor.x=.5,v.anchor.y=.5,v.alpha=0,v.x=r.UI.width/2,v.y=r.UI.height/2,this.particleLayer.addChild(v),S=new TWEEN.Tween({scale:0,alpha:0}).easing(TWEEN.Easing.Exponential.Out).delay(400).to({scale:1,alpha:1},400).onStart(function(){r.Sounds.PlaySound("perfect")}).onUpdate(function(){v.scale.x=v.scale.y=this.scale,v.alpha=this.alpha}).start(),b=new TWEEN.Tween({alpha:1,y:v.y}).easing(TWEEN.Easing.Cubic.Out).delay(1e3).to({alpha:0,y:g.y(100)},1e3).onUpdate(function(){v.alpha=this.alpha,v.y=this.y}).onComplete(function(){C.SupplyView.CardSupply.DecrementActiveAnimations(),C.cleanUpTimeout=window.setTimeout(function(){C.cleanUpParticles()},2e3)}),S.chain(b),this.tweens.push(S),this.tweens.push(b)}},m.prototype.BeginAnimationSet=function(t){this.IsInAnimationSet,this.IsInAnimationSet=!0,this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1},m.prototype.EndAnimationSet=function(){this.IsInAnimationSet=!1},m.prototype.BeginAnimation=function(e,i){if(this.IsInAnimationSet||(this.AnimationDelayTimer=0,this.AnimationList.Clear(),this.DealCardNum=0,this.IsDeal=!1),this.AnimatingAction=e,this.IsUndoing=i,t.forEach(this.SupplyView.CardSupply.GetCardList(),function(t){var e=this.SupplyView.GetCardView(t);if(!this.AnimationList.ContainsKey(e)){var i=new m.AnimationEntry;i.Wait=this.AnimationDelayTimer,i.Speed=0,e.parent&&(i.WorldPos=e.parent.toGlobal(e.position)),this.AnimationList.Add(e,[i])}},this),2==e.Ops.length){var n=e.Ops[0].GetPile(h.eMoveParams.SourcePile),r=e.Ops[1].GetPile(h.eMoveParams.SourcePile),o=this.SupplyView.GetCardView(i?n.Supply.GetPile("Foundation").NthFromTop(2):n.Top),a=this.SupplyView.GetCardView(i?n.Supply.GetPile("Foundation").NthFromTop(1):r.Top);if(!this.AnimationList.Get(o)||!this.AnimationList.Get(a))return;var s=this.AnimationList.Get(o)[0],l=this.AnimationList.Get(a)[0];this.SupplyView.GetPileView(n).X<this.SupplyView.GetPileView(r).X?(s.Dir=i?C.Right:C.Left,l.Dir=i?C.Left:C.Right):(s.Dir=i?C.Left:C.Right,l.Dir=i?C.Right:C.Left),this.AnimationList.Get(o)[0]=s,this.AnimationList.Get(a)[0]=l}},m.prototype.ContinueAnimation=function(t,i){this.SupplyView.UpdatePileChildren(!1);var n=.3,o=.2,a=.05;this.SupplyView.CardSupply.EnforceGameRules||(n=.2,o=.1,a=0),t.Ops.length>24&&(o*=.4,a*=.4);var p=t.Ops[i];if(p.Opcode==h.Op.Move){var g=p.GetPile(h.eMoveParams.SourcePile),f=p.GetPile(h.eMoveParams.DestPile),y=p.GetNumber(h.eMoveParams.NumCards);if("Stock"==g.Type&&(n=.2,a=.1),"Stock"==f.Name&&"DealStock"==g.Name&&(n=.2,a=0),this.IsUndoing){var S=g;g=f,f=S,a*=.75,o*=.75,n*=.75}var b=this.SupplyView.GetPileView(g),v=this.SupplyView.GetPileView(f),w=!1;y<0&&(y=-y,w=!0),y>25?(a*=.1,this.IsDeal=!0):y>6&&(a*=.25),"Root"==g.Type||b.CardFacing==u.Facing.Hidden||v.CardFacing==u.Facing.Hidden?(n=0,o=0,a=0):this.NextAnimationDelay>0&&(this.AnimationDelayTimer+=this.NextAnimationDelay,this.NextAnimationDelay=0);for(var x=0;x<y;x++){var T=x+1;w&&(T=y-x);var M=f.NthFromTop(T),_=this.SupplyView.GetCardView(M),P=this.AnimationList.Get(_)[0],A=new m.AnimationEntry;A.Wait=this.AnimationDelayTimer,A.Speed=n;var k=_.GetCardPositionInPile(null,!0);if(A.WorldPos=_.Parent.toGlobal(k),v.CardFacing==u.Facing.FaceDown?A.CardFlip=1:A.CardFlip=0,this.IsDeal&&1==y&&(A.ForceLayer=d.TopLayer+1+M.Supply.Count-this.DealCardNum,A.ForceLayer2=d.TopLayer+1+M.Supply.Count+this.DealCardNum,this.DealCardNum++),"Root"!=g.Type&&"Foundation"==f.Type){var D=new e.Point(r.Display.Width,r.Display.Height),F=.3,E=.6;this.SupplyView.CurrentLayout==c.LayoutState.VerticalView&&(F*=3,E*=3);var I=new s(0,0),G=I.clone();P.Dir==C.Left?G.x-=D.x*F:P.Dir==C.Right&&(G.x+=D.x*F),G.y-=D.y*F;var O=I.clone();P.Dir==C.Left?O.x-=D.x*E:P.Dir==C.Right&&(O.x+=D.x*E),O.y+=1.5*D.y,A.Bezier=new l([I,G,O],l.BezierPointType.Control),A.Speed=1,A.Rotation=3.14*5,"Tableau0"==g.Name&&(A.WaitAfter=1)}if(this.IsUndoing&&b.CardFacing==u.Facing.Hidden){var D=new e.Point(r.Display.Width,r.Display.Height),B=new m.AnimationEntry;B.WorldPos=v.ToGlobal(new e.Point(0,0)),B.WorldPos.y=D.y+20,this.AnimationList.Get(_)[0].WorldPos.x=B.WorldPos.x,this.AnimationList.Get(_)[0].WorldPos.y=B.WorldPos.y,A.WorldPos=v.toGlobal(new e.Point(0,0)),A.Speed=1,A.Rotation=0,_.Visible=!0}this.AnimationList.Get(_).push(A),y>1&&(this.AnimationDelayTimer+=a)}this.AnimationDelayTimer+=o}},m.prototype.createTextureForPerfectText=function(){var t=document.createElement("canvas");t.width=700,t.height=300;var i=t.getContext("2d");i.lineJoin="round";var n=f("dialogs.perfectEarnedHeadline");i.moveTo(0,100);var r=i.createLinearGradient(0,50,0,170);r.addColorStop(0,"#fffcf3"),r.addColorStop(.33,"#ffefb0"),r.addColorStop(.66,"#ffdb4a"),r.addColorStop(1,"#f3c307");var o=i.createLinearGradient(0,0,0,170);o.addColorStop(0,"#ffeb52"),o.addColorStop(.5,"#ffe478"),o.addColorStop(.8,"#fea704"),o.addColorStop(1,"#c76c01");return i.font="bold "+65*y.ScreenMetrics.getResScale()+"px Segoe UI",i.shadowColor="#ffd429",i.shadowBlur=100,i.shadowOffsetX=0,i.shadowOffsetY=-6,i.strokeStyle=o,i.lineWidth=10,i.strokeText(n,70,170),i.shadowColor="rgba(153,119,58, 0.8)",i.shadowBlur=3,i.shadowOffsetX=-1,i.shadowOffsetY=-1,i.strokeStyle=o,i.lineWidth=10,i.strokeText(n,70,170),i.shadowColor="rgba(243, 68, 0 , 0.9)",i.shadowBlur=3,i.shadowOffsetX=1,i.shadowOffsetY=1,i.fillStyle=r,i.fillText(n,70,170),i.stroke(),new e.Sprite(e.Texture.fromCanvas(this.trimCanvas(t,i)))},m.prototype.trimCanvas=function(t,e){var i=document.createElement("canvas").getContext("2d"),n=e.getImageData(0,0,t.width,t.height),r={top:null,left:null,right:null,bottom:null};return this.findTransparentPixels(r,n,t),this.getTrimmedCanvas(r,i,e)},m.prototype.findTransparentPixels=function(t,e,i){for(var n,r,o=e.data.length,a=0;a<o;a+=4)0!==e.data[a+3]&&(n=a/4%i.width,r=~~(a/4/i.width),this.checkBounds(t,n,r))},m.prototype.getTrimmedCanvas=function(t,e,i){var n=t.bottom-t.top,r=t.right-t.left,o=i.getImageData(t.left,t.top,r,n);return e.canvas.width=r,e.canvas.height=n,e.putImageData(o,0,0),e.canvas},m.prototype.checkBounds=function(t,e,i){t.top||(t.top=i),t.left?e<t.left&&(t.left=e):t.left=e,t.right?t.right<e&&(t.right=e):t.right=e,t.bottom?t.bottom<i&&(t.bottom=i):t.bottom=i},m.prototype.EndAnimation=function(e,n){this.tweensToFinish=0,this.TweenCache.Clear(),t.forEach(this.AnimationList.GetKeys(),function(t){var e=this.AnimationList.Get(t);if(!(e.length<2)){t instanceof d&&(t.Animating=!0),this.tweensToFinish++;var r;if(this.TweenCache.ContainsKey(t))r=this.TweenCache.Get(t).Then();else{var o=a.GetTweens(t);r=null!=o&&o.length>0?o[0].Then():a.Start(t),this.TweenCache.Add(t,r)}for(var s=0;s<e.length;s++){var l=e[s],h=t.parent.toLocal(l.WorldPos),u=t.scale.clone();if(0==s)t.SetPosition(h),t.SetScale(u),null!=l.ForceLayer&&t instanceof d&&(t.LayerWhileAnimating=l.ForceLayer.Value);else{if(l.Wait>0&&i.log("x"),r=r.Wait(l.Wait).Then(),l.Wait>0&&null!=this.nextAnimationAction){var c=this.nextAnimationAction;r=r.Call(c).And(),this.nextAnimationAction=null}null!=l.ForceLayer2&&t instanceof d&&(r=r.Call(function(){t.LayerWhileAnimating=l.ForceLayer2.Value}).And()),r=null==l.Bezier?this.IsUndoing?r.MoveTo(h,l.Speed,TWEEN.Easing.Quintic.Out).And().RotateTo(0,0):r.MoveTo(h,l.Speed,TWEEN.Easing.Quintic.Out).And().RotateTo(0,.5):r.MoveByBezier(l.Bezier,l.Speed).And().RotateBy(l.Rotation,l.Speed),r=r.And().ScaleTo(u,l.Speed,TWEEN.Easing.Quintic.Out),t instanceof d&&(r=r.And().CustomTo(t.SetCardFlipAngle.bind(t),t.GetCardFlipAngle.bind(t),l.CardFlip,l.Speed,TWEEN.Easing.Cubic.Out))}(null!=l.ForceLayer||null!=l.ForceLayer2)&&t instanceof d&&(r=r.Call(function(t){t instanceof d&&(t.LayerWhileAnimating=null)}.bind(this)))}r=r.Call(this.StopAnimating.bind(this)),r=r.Call(function(){this.EndAnimTrigger(n)}.bind(this))}},this),this.AnimationList.Clear(),this.TweenCache.Clear(),0==this.tweensToFinish&&n(e)},m.prototype.GetTweenedTimeScale=function(t,e,i){return r.TimeScale},m.prototype.SetTweenedTimeScale=function(t,e,i){r.TimeScale=i},m.prototype.StopAnimating=function(t){t instanceof d&&(t.Animating=!1)},m.prototype.EndAnimTrigger=function(t){this.tweensToFinish--,0==this.tweensToFinish&&this.IsShuffling&&(this.IsShuffling=!1,null!=this.OnShuffleFinished&&this.OnShuffleFinished()),null==t||t.called||(t(this.AnimatingAction),t.called=!0)},m.prototype.BeginShuffleAnimation=function(){null!=this.WinAnimator&&this.WinAnimator.EndAnimation(),this.IsShuffling=!0},m.prototype.IsShuffleAnimationRunning=function(){return this.IsShuffling},m.prototype.TriggerWinAnimation=function(t){this.WinAnimator=null,null!=t&&t()},m.prototype.ShouldShowEndingPopup=function(){return null==this.WinAnimator||this.WinAnimator.ShouldShowEndingPopup()},m.prototype.DoesAnimationBlockInput=function(t){return!1},m.prototype.DelayNextAnimation=function(t){},m.prototype.OnNextAnimationStart=function(t){this.nextAnimationAction=t},m.prototype.onHide=function(){this.cleanUpParticles()},m.prototype.cleanUpParticles=function(){t.each(this.emitters,function(t){t.destroy()}),this.emitters.length=0,this.particleLayer&&(r.UI.stage[0].removeChild(this.particleLayer),this.particleLayer=null),null!==this.cleanUpTimeout&&(window.clearTimeout(this.cleanUpTimeout),this.cleanUpTimeout=null)},m}),define("SolitaireShared/PyramidTemplate/PyramidWindowsTemplate",["lodash","pixi","util/eventhandler","Arkadium/GameEngine/Core/EngineManagers","CardUI/SupplyView","CardUI/PileView","CardUI/KeyboardNavigator","SolitaireShared/CardLogic/Supply","SolitaireShared/PyramidLogic/PyramidAuthority","SolitaireShared/PyramidTemplate/PyramidInputInterpreter","SolitaireShared/PyramidTemplate/PyramidCardAnimator","Arkadium/GameEngine/Maths/Vector2","util/SettingsManager","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){"use strict";var g=function(){this.initPyramidWindowsTemplate()};return g.prototype.initPyramidWindowsTemplate=function(){this._authorityReference=null,this._supplyViewReference=null,this._curAutoSolveView=null,this._curAutoSolveViewOnUpdated=new i,this.settingsManager=c},g.prototype.CreateAuthority=function(t){var e=null!=t?t.ConstructAuthority():new l;return e.Setup(),e.CardSupply.DeckSeed=null,this._authorityReference=e,e},g.prototype.Cleanup=function(){this.supplyView.OnMoveCardsEvent.remove(this.OnMoveCardsHandler),this.supplyView.CardSupply.OnDealEvent.remove(this.OnDealHandlerRef)},g.prototype.CreateInputInterpreter=function(t){return new h(t)},g.prototype.CreateCardAnimator=function(t){return new u(t)},g.prototype.TryAutoSolve=function(t){},g.prototype.StopAutoSolving=function(){},g.prototype.DoLayoutPiles=function(e,i){var r="1"===c.getSetting("pyramid","layoutDirection"),s=n.Display.Width,l=n.Display.Height;t.forEach(i.CardSupply.GetPileList(),function(t){if(null!=t){var e=i.GetPileView(t);null!=e&&e.Keyboard.ResetKeypressHandlers()}});var h,u=.915,g=.75;s/l<1.5&&(u*=.85,g*=.85);var f=.35,y=[-.3,.27-.5,.34-.5,.41-.5,.48-.5,.54-.5,.61-.5];this._authorityReference.IsChallenge&&(f=.805-.5,y=[.16-.5,-.27,-.2,-.13,-.06,0,.57-.5]);for(var m=[-.5*g,(1/14-.5)*g,(2/14-.5)*g,(3/14-.5)*g,(4/14-.5)*g,(5/14-.5)*g,(6/14-.5)*g,0*g,(8/14-.5)*g,(9/14-.5)*g,(10/14-.5)*g,(11/14-.5)*g,(12/14-.5)*g,(13/14-.5)*g,.5*g],C=[7,6,8,5,7,9,4,6,8,10,3,5,7,9,11,2,4,6,8,10,12,1,3,5,7,9,11,13],S=[0,1,1,2,2,2,3,3,3,3,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6],b=[21,22,15,23,16,10,24,17,11,6,25,18,12,7,3,26,19,13,8,4,1,27,20,14,9,5,2,0],v=[27,26,20,25,19,14,24,18,13,9,23,17,12,8,5,22,16,11,7,4,2,21,15,10,6,3,1,0],w=0;w<28;w++){h=i.GetPileView("Tableau"+w),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.DisplayType=o.Display.Blank,h.ScaleX=1,h.ScaleY=1,h.LogicalScreenPos=new d(m[C[w]],y[S[w]]),h.InteractionMode=o.Interaction.Click,h.AllowClickWhenEmpty=!1,h.KeyboardMode=o.KeyboardModes.TopCardIfAllowed;for(var x=0;x<b.length;x++)if(b[x]==w){for(var T=x+1;T<b.length;T++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+b[T]));for(var T=0;T<x;T++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Tableau"+b[T]));break}for(var x=0;x<v.length;x++)if(v[x]==w){for(var T=x+1;T<v.length;T++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+v[T]));for(var T=0;T<x;T++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Tableau"+v[T]));break}C[w]<6?h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")):C[w]>8?h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Waste")):h.Keyboard.RegisterKeypressHandler(a.KeyPress.Down,i.GetPileView("Stock")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Tab,i.GetPileView("Stock"))}var M=m[6]-1/56*g,_=m[8]+1/56*g;p.Platform.isMobile()&&(M=m[6]-.0625,_=m[8]+.0625),h=i.GetPileView("DealStock"),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.FanRight,h.FanLimit=1,h.ScaleX=1,h.ScaleY=1,h.LogicalScreenPos=new d(r?M:_,f),h.InteractionMode=o.Interaction.None,h.DisplayType=o.Display.Stock,h=i.GetPileView("Stock"),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.FanRight,h.FanLimit=1,h.ScaleX=1,h.ScaleY=1,h.LogicalScreenPos=new d(r?M:_,f),h.InteractionMode=o.Interaction.Click,h.DisplayType=o.Display.Tableau,h.KeyboardMode=o.KeyboardModes.TopCardAndEmpty;for(var w=0;w<b.length;w++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+b[w])),h.Keyboard.RegisterKeypressHandler(a.KeyPress.ShiftTab,i.GetPileView("Tableau"+b[w]));h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Waste")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Joker")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Activate,function(t,e){return t instanceof o&&t.Pile.Empty&&t.SupplyView.GetKeyboardUI("dealnextdeck")&&t.SupplyView.GetKeyboardUI("dealnextdeck").Keyboard.HandleKeypress(a.KeyPress.Activate),!1}),i.DefaultKeyboardFocus=i.GetPileView("Stock"),h=i.GetPileView("Joker"),h.LogicalScreenPos=new d(m[0],f),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.ScaleX=1,h.ScaleY=1,h.InteractionMode=o.Interaction.Click,h.KeyboardMode=o.KeyboardModes.TopCard;for(var w=0;w<b.length;w++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+b[w]));h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Stock")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Waste")),h=i.GetPileView("Waste"),h.CardFacing=o.Facing.FaceUp,h.PileMode=o.Layout.Pile,h.ScaleX=1,h.ScaleY=1,h.LogicalScreenPos=new d(r?_:M,f),h.InteractionMode=o.Interaction.Click,h.DisplayType=o.Display.Tableau,h.KeyboardMode=o.KeyboardModes.TopCardAndEmpty;for(var w=0;w<v.length;w++)h.Keyboard.RegisterKeypressHandler(a.KeyPress.Up,i.GetPileView("Tableau"+v[w]));h.Keyboard.RegisterKeypressHandler(a.KeyPress.Left,i.GetPileView("Stock")),h.Keyboard.RegisterKeypressHandler(a.KeyPress.Right,i.GetPileView("Joker")),h=i.GetPileView("Root"),h.LogicalScreenPos=new d(i.GetPileView("Stock").LogicalScreenPos.x-99,i.GetPileView("Stock").LogicalScreenPos.y+.5-99),h.DefaultPileSpacing=new d(0,0),h.CardFacing=o.Facing.FaceDown,h.PileMode=o.Layout.Pile,h.InteractionMode=o.Interaction.None,h=i.GetPileView("Foundation"),h.ScaleX=1,h.ScaleY=1,h.CardFacing=o.Facing.Hidden,i.CardScale=u,this.OnMoveCardsHandler=this.UpdateStockAppearance.bind(this),this.OnDealHandler=function(){this.UpdateStockAppearance.call(this,this.supplyView)}.bind(this),this.OnDealHandlerRef=this.OnDealHandler,this.supplyView=i,i.OnMoveCardsEvent.add(this.OnMoveCardsHandler),i.CardSupply.OnDealEvent.add(this.OnDealHandlerRef),this.UpdateStockAppearance(i)},g.prototype.UpdateStockAppearance=function(t){var e=t.GetPileView("Stock");this._authorityReference.IsDeckPassesAvailable()?(e.DisplayType=o.Display.Circle,t.GetPileView("DealStock").DisplayType=o.Display.Circle):e.Pile.Empty&&e.DisplayType==o.Display.X||setTimeout(function(){e.DisplayType=o.Display.X,t.GetPileView("DealStock").DisplayType=o.Display.X}.bind(this),250)},g.prototype.LoadGameOptions=function(t){t.SetOption("PyramidTimer",this.settingsManager.getSetting("pyramid","timer")?"true":"false")},g.prototype.SaveGameOptions=function(t){},Object.defineProperty(g.prototype,"EndGameStatStrings",{get:function(){return["Time","Score"]}}),g.prototype.GetEndGameStats=function(){return[this._authorityReference.CardSupply.CurrentTime.ToString(),this._authorityReference.CardSupply.Score]},Object.defineProperty(g.prototype,"GameName",{get:function(){return"Pyramid"}}),Object.defineProperty(g.prototype,"SaveFilename",{get:function(){return"PYRAMID_SAVE_FILE"}}),Object.defineProperty(g,"TimerOptionKey",{get:function(){return"APPDATA_PYRAMID_TIMER"}}),g}),define("Solitaire/GameModes/PyramidGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/Solitaire","Solitaire/SolitaireGameMode","SolitaireShared/PyramidLogic/PyramidAuthority","SolitaireShared/PyramidTemplate/PyramidWindowsTemplate","SolitaireShared/CardLogic/CardAction","Solitaire/GameResult","Solitaire/GameState","Solitaire/SolitaireStatistics","util/SettingsManager"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(){this.initPyramidGameMode()};return d.constructor=d,d.prototype=Object.create(t.prototype),e.call(d.prototype),d.prototype.initPyramidGameMode=function(){this.Name=n.Pyramid,this.WaitForAnimationOnHint=!1,this._cacheDealButtonVisible=!1},Object.defineProperty(d.prototype,"TimerOption",{get:function(){return l.CurrentGame.Authority.IsChallenge?l.CurrentGame.Authority.TimerEnabled?e.TimerSettings.CountDown:e.TimerSettings.Off:u.getSetting("pyramid","timer")?e.TimerSettings.CountDown:e.TimerSettings.Off}}),d.prototype.OnMoveCardButton=function(){var t=new a(l.CurrentGame.Authority.CardSupply);if(l.CurrentGame.Authority.CardSupply.GetPile("Stock").Empty)l.CurrentGame.SupplyView.GameInputInterpreter.ClickEmptyPile(l.CurrentGame.SupplyView.GetPileView("Stock")).Run();else if(t.Parse(["begin","move","Stock","Waste","1","end"]),t.Run()){var e=l.CurrentGame.SupplyView.GameInputInterpreter.GetHighlightedCard();null!=e&&"Waste"==e.Card.Pile.Name&&l.CurrentGame.SupplyView.GameInputInterpreter.ClearHighlight(),EngineManagers.Sounds.PlaySound("singleCard")}l.CurrentGame.SupplyView.OnMoveCards()},d.prototype.IsUpdateDealButtonsVisible=function(){l.CurrentGame.Authority.GetHint();var t=l.CurrentGame.Authority.AllowDealNextDeck();return!l.CurrentGame.Authority.CardSupply.IsWaitingForAds&&l.CurrentGame.Authority.CardSupply.IsGamePageLoaded||(t=!1),this._cacheDealButtonVisible=t,this._cacheDealButtonVisible},d.prototype.IsUpdateDrawButtonVisible=function(){var t=l.CurrentGame.Authority;return!(t.PassesThroughDeck>=r.MaxPassesThroughDeck-1&&t.CardSupply.GetPile("Stock").Empty)},d.prototype.ConfigureSolitairePage=function(t){this.Supply.UseCumulativeScoring=!1,setTimeout(function(){}.bind(this),0)},d.prototype.CreateTemplate=function(){return new o},d.prototype.GetCheatMoves=function(){
return"G PYRAMID O SECOND 7367031771939848454399196599821169360961682497766870103912390403630112620263346420733351502646325357313737828420552371059029617358314078327925818402349143768 O THIRD 2636350119736703177193984845439919659982116936096168249776687010391239040363011262026334642073335150264632535731373782842055237105902961735831407832792581840 D 61734074451050260284516061045373508919125199387879139242712814305933 B M 33 5 1 M 28 5 1 E B M 32 5 1 M 30 5 1 E B M 31 5 1 M 26 5 1 E B M 34 5 1 M 25 5 1 E B M 29 5 1 M 24 5 1 E M 23 5 1 [1] B M 22 5 1 M 19 5 1 E [4] M 2 3 1 [5] B M 2 5 1 M 17 5 1 E [6] M 2 3 1 [6] B M 2 5 1 M 20 5 1 E [7] B M 3 5 1 M 15 5 1 E [8] M 2 3 1 [9] M 2 3 1 [9] M 2 5 1 [11] M 2 3 1 [13] M 2 3 1 [13] M 2 5 1 [14] M 2 3 1 [15] M 2 3 1 [17] M 2 3 1 [17] B M 2 5 1 M 27 5 1 E [18] M 2 3 1 [19] B M 2 5 1 M 18 5 1 E [19] B M 2 5 1 M 3 5 1 E [20] M 2 3 1 [22] M 2 3 1 [22] B M 2 5 1 M 14 5 1 E [22] B M 2 5 1 M 21 5 1 E [22] B M 3 5 1 M 11 5 1 E [24] M 2 3 1 [25] M 2 3 1 [27] M 2 3 1 [27] M 3 2 -12 [29] M 2 3 1 [29] B M 2 5 1 M 16 5 1 E [29] B M 2 5 1 M 12 5 1 E [29] B M 2 5 1 M 9 5 1 E [31] M 2 3 1 [32] B M 2 5 1 M 13 5 1 E [32] M 10 5 1 [32] B M 3 5 1 M 8 5 1 E [32] N "},d.prototype.HelpDataSource=function(){return null},d.prototype.ButtonsPostion=function(t){throw t=!!t,"TODO"},d.prototype.GetGameEnd=function(){throw"TODO"},d.GetStatKeyStatic=function(){var t="";return"TRUE"==l.CurrentGame.GetOption("PYRAMIDTIMER")&&(t="TIMED"),new h.StatKey(l.CurrentGame.ActiveMode.Name,(t+n.getModeById(l.CurrentGame.ActiveMode.Name)).toUpperCase())},d.prototype.GetStatKey=function(){return d.GetStatKeyStatic()},d.prototype.UpdateStatistics=function(t){var e=d.GetStatKeyStatic();l.CurrentGame.Authority.BoardsCompleted()>0?h.Current.UpdateGameWon(e):l.Current==l.GameComplete&&h.Current.UpdateGameLost(e),t.ScoreText=h.Current.GetScoreFormatString(e),t.HighScore=h.Current.GetHighScoreFormatString(e),t.BoardsCleared=h.Current.GetStringFormat(l.CurrentGame.Authority.BoardsCompleted()),t.GamesPlayed=h.Current.GetGamesPlayedFormatString(e),t.LosingStreak=h.Current.GetLosingStreak(e),null!=l.CurrentGame.Authority&&(t.Matches=h.Current.GetStringFormat(l.CurrentGame.Authority.Matches),t.RowsCleared=h.Current.GetStringFormat(l.CurrentGame.Authority.RowsCleared))},d.prototype.SetShare=function(t){},d.prototype.UpdateLeaderBoard=function(){},d}),define("Solitaire/GameModes/UnknownGameMode",["Solitaire/GameModes/GameModeBase","Solitaire/GameModes/IGameMode","Solitaire/SolitaireGameMode"],function(t,e,i){"use strict";var n=function(){this.initUnknownGameMode()};return n.constructor=n,n.prototype=Object.create(t.prototype),e.call(n.prototype),n.prototype.initUnknownGameMode=function(){this.TimerOption=e.TimerSettings.Off,this.Name=i.Unknown},n.prototype.GetGameEnd=function(){return null},n.prototype.SetShare=function(t){},n.prototype.GetStatKey=function(){return"Unknown"},n.UpdateStatistics=function(t){},n}),define("Solitaire/GameModes/GameModeFactory",["Solitaire/SolitaireGameMode","Solitaire/GameModes/KlondikeGameMode","Solitaire/GameModes/SpiderGameMode","Solitaire/GameModes/FreeCellGameMode","Solitaire/GameModes/TriPeaksGameMode","Solitaire/GameModes/PyramidGameMode","Solitaire/GameModes/UnknownGameMode"],function(t,e,i,n,r,o,a){"use strict";return{InitGameMode:function(s){var l=null;switch(s){case t.Klondike:l=new e;break;case t.Spider:l=new i;break;case t.FreeCell:l=new n;break;case t.TriPeaks:l=new r;break;case t.Pyramid:l=new o;break;default:l=new a}return l}}}),define("Managers/KeyboardManager",["CardUI/KeyboardNavigator"],function(t){"use strict";return{_ctrlDown:!1,_ui:null,_anyKeyHandler:null,initialize:function(t){this._ui=t,window.addEventListener("keydown",this.handleKeyDown.bind(this),!0),window.addEventListener("keypress",this.handleKeyPress.bind(this),!0),window.addEventListener("mousewheel",this.handleMouseWheel.bind(this),!0)},handleKeyDown:function(t){var e=!0;if("function"==typeof this._anyKeyHandler)e=this._anyKeyHandler(t);else{var i=this.getCommandFromKeyboardEvent(t);if("Tab"==i&&t.shiftKey&&(i="ShiftTab"),"Activate"===i&&(t.altKey||this._altDown))i="FullScreen",this._altDown=!1;else{if("Alt"===i)return void(this._altDown=!0);if("Z"===i&&(t.ctrlKey||this._ctrlDown))i="Undo";else{if("Ctrl"===i)return void(this._ctrlDown=!0);if(void 0===i)return}}this._ui.handleCommand(i)}e&&t.preventDefault()},handleKeyPress:function(t){if("function"==typeof this._anyKeyPressHandler){this._anyKeyPressHandler(t)&&t.preventDefault()}},handleMouseWheel:function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),i="Tab";e<0&&(i="ShiftTab"),this._ui.handleCommand(i,!0)},getCommandFromKeyboardEvent:function(e){var i=0;return null==e.which?i=e.keyCode:0!=e.which&&(i=e.which),t.KeyPressCharMap[i.toString()]},setAnyKeyHandler:function(t){this._anyKeyHandler=t},removeAnyKeyHandler:function(){this._anyKeyHandler=null},setAnyKeyPressHandler:function(t){this._anyKeyPressHandler=t},removeAnyKeyPressHandler:function(){this._anyKeyPressHandler=null}}}),define("Solitaire/GameContainer",["pixi","absolute/spriteutils","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Managers/KeyboardManager"],function(t,e,i,n,r){"use strict";var o=function(t){this.initGameContainer(t)};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.initGameContainer=function(t){n.call(this),this.game=t,this.background=null,this.supplyView=null,this.endGameAnimator=null,this.endGameBackground=null,this.inputInterceptOverlay=null},o.prototype.setBackground=function(t){this.background=t,this.addChildAt(this.background,0)},o.prototype.removeBackground=function(){this.removeChild(this.background),this.background=null},o.prototype.setSupplyView=function(t){this.supplyView=t,this.addChildAt(this.supplyView,this.children.indexOf(this.background)+1),this.supplyView.initForceSprite()},o.prototype.removeSupplyView=function(){this.removeChild(this.supplyView),this.supplyView=null},o.prototype.setEndGameAnimator=function(n,o,a){this.endGameAnimator=n,this.endGameBackground=o,o.x=-i.Display.Width/2,o.y=-i.Display.Height/2,this.supplyView.addChildAt(this.endGameBackground,this.supplyView.children.indexOf(this.supplyView.pileBackgroundContainer)+1),this.addChildAt(this.endGameAnimator,this.children.indexOf(this.supplyView)+1),this.inputInterceptOverlay=new t.Graphics,this.inputInterceptOverlay.beginFill(1,0),this.inputInterceptOverlay.drawRect(0,0,i.Display.Width,i.Display.Width),this.inputInterceptOverlay.endFill(),this.inputInterceptOverlay.interactive=!0,this.inputInterceptOverlay.hitArea=new t.Rectangle(0,0,i.Display.Width,i.Display.Width),e.bindInteraction(this.inputInterceptOverlay,function(){a()}.bind(this)),this.addChild(this.inputInterceptOverlay),this.game.menuBar.setBackHandler(function(){a()}),this.game.gameScreenUI.hideButtons(),r.setAnyKeyHandler(function(){a()}.bind(this))},o.prototype.removeEndGameAnimator=function(){this.removeChild(this.inputInterceptOverlay),this.supplyView.removeChild(this.endGameBackground),this.removeChild(this.endGameAnimator),this.inputInterceptOverlay=null,this.endGameBackground=null,this.endGameAnimator=null,this.game.menuBar.removeBackHandler(),r.removeAnyKeyHandler()},o}),define("MenuUI/TimesUpDialog",["pixi","absolute","absolute/stringmanager","util/NineSliceButton","util/eventhandler","Managers/ScaleManager","Arkadium/GameEngine/Core/EngineManagers","util/CustomWordWrapper"],function(t,e,i,n,r,o,a,s){var l=function(t){this.onClose=new r,this.initTimesUpDialog(t)};return l.prototype=Object.create(t.DisplayObjectContainer.prototype),l.prototype.initTimesUpDialog=function(r){t.DisplayObjectContainer.call(this),this.layoutType="large",this.parentToAdd=r,this.buildOverlay(),this.parentToAdd.addChild(this),this.popupContainer=new t.DisplayObjectContainer;var a,s,l,h,u,d=e.Coords.x(820),c=e.Coords.y(350),p=new t.Sprite.fromFrame("warning_dialogues/_cmn_backgroundTile.png");s=new t.Sprite.fromFrame("warning_dialogues/_cmn_UI2_bg_vignette.png"),s.width=d,s.height=c,s.alpha=.6,a=new t.Graphics,a.beginFill(16645887),a.lineStyle(5,16645887),a.drawRect(0,0,d,c),l=new t.Sprite.fromFrame("warning_dialogues/_cmn_popup_image_info.png"),l.position.set(e.Coords.x(30),e.Coords.y(30)),l.width=e.Coords.x(135),l.height=e.Coords.y(160),this.icon=l,this.titleFontSize=43;var g={font:e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"};h=new t.Text(i("GameLoss_OutOfTime_Popup_Title"),g),h.position.set(e.Coords.x(195),e.Coords.y(20)),this.title=h,this.bodyFontSize=28;var f={font:e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"};u=new t.Text(i("GameLoss_OutOfTime_Popup_Text"),f),u.position.set(e.Coords.x(195),e.Coords.y(100)),this.body=u;var y={font:29*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(0),y:e.Coords.y(3)};this.closeButton=new n("warning_dialogues/popup_button_Play_click.png","warning_dialogues/popup_button_Play_over.png","warning_dialogues/popup_button_Play.png",e.Coords.x(335),e.Coords.y(100),25,25,25,25,i("buttons.ok").toUpperCase(),y);var m=this;this.closeButton.onClick.add(function(){m.onClose.handleEvent(),o.removeElement(m),this.parentToAdd.removeChild(this),this.parentToAdd.removeChild(this.screenOverlay)}.bind(this),this),this.popupContainer.addChild(a),this.popupContainer.addChild(p),this.popupContainer.addChild(s),this.popupContainer.addChild(l),this.popupContainer.addChild(h),this.popupContainer.addChild(u),this.popupContainer.addChild(this.closeButton),this.addChild(this.popupContainer),this.popupContainer.visible=!0,this.closeButton.anchor.set(.5,.5),this.closeButton.position.set(d/2,e.Coords.y(280)),this.initForceScaleSprite(),o.addElement(this,{scaleChangeSource:"Full"})},l.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(20),this.forceOffsetY=e.Coords.y(20),this.forceScaleSprite.width=e.Coords.x(835),this.forceScaleSprite.height=e.Coords.y(365),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},l.prototype.handleResize=function(){o.scaleFactorX<=.35?this.changeToSmallLayout("small"):this.changeToLargeLayout("large"),this.updateBodyTextCustomWrap(),this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var s=e.Coords.x(1920)/o.width,l=e.Coords.y(1080)/o.height,h=o.width,u=o.height;this.width=n*s,this.height=r*l;var d=this.width/s,c=this.height/l,p=n,g=r,f=!1;if(d>h){this.width=e.Coords.x(1920);var y=h/p;if(this.height=r*l*y,this.height/l>u){this.height=e.Coords.y(1080);var y=u/g;this.width=n*s*y}f=!0}if(!f&&c>u){this.height=e.Coords.y(1080);var y=u/g;if(this.width=n*s*y,this.width/s>h){this.width=e.Coords.x(1920);var y=h/p;this.height=r*l*y}}this.x=.5*a.Display.Width-this.width/2+this.forceOffsetX,this.y=.5*a.Display.Height-this.height/2+this.forceOffsetY},l.prototype.changeToSmallLayout=function(t){this.layoutType!==t&&(this.icon.visible=!1,this.title.position.set(this.icon.x,this.icon.y),this.title.style.font=e.ScreenMetrics.getResScale()*(this.titleFontSize+7)+"px Segoe UI",this.title.updateText(),this.body.x=this.icon.x,this.body.style.font=e.ScreenMetrics.getResScale()*(this.bodyFontSize+7)+"px Segoe UI",this.body.updateText(),this.layoutType=t)},l.prototype.changeToLargeLayout=function(t){this.layoutType!==t&&(this.icon.visible=!0,this.title.position.set(e.Coords.x(195),e.Coords.y(20)),this.title.style.font=e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",this.title.updateText(),this.body.position.set(e.Coords.x(195),e.Coords.y(100)),this.body.style.font=e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",this.body.updateText(),this.layoutType=t)},l.prototype.buildOverlay=function(){this.screenOverlay=new t.Graphics,this.screenOverlay.beginFill(0),this.screenOverlay.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.screenOverlay.alpha=.8,this.screenOverlay.interactive=!0,this.bindScreenOverlayInteractions(),this.parentToAdd.addChild(this.screenOverlay)},l.prototype.bindScreenOverlayInteractions=function(){this.screenOverlay.mouseover=function(t){},this.screenOverlay.mouseout=function(t){},this.screenOverlay.mousedown=function(t){},this.screenOverlay.mouseup=function(t){},this.screenOverlay.touchstart=function(t){},this.screenOverlay.touchend=function(t){},this.screenOverlay.touchendoutside=function(t){}},l.prototype.updateBodyTextCustomWrap=function(){var t=e.Coords.x("small"===this.layoutType?750:600);s.doTextCustomWrap(this.body,this.bodyFontSize*e.ScreenMetrics.getResScale(),"",t,e.Coords.y(100))},l}),define("Solitaire/Solitaire",["lodash","absolute/debug","absolute/storagemanager","util/eventhandler","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Tween/Tween","Solitaire/SolitaireGameMode","Solitaire/HintsOption","Solitaire/TipsOption","Solitaire/ScoringOption","Solitaire/GameState","Solitaire/GameResult","Solitaire/GameModes/IGameMode","Solitaire/GameModes/GameModeFactory","Solitaire/GameModes/UnknownGameMode","CardUI/SupplyView","SolitaireShared/CardLogic/Supply","SolitaireShared/CardLogic/CardAction","absolute/eventbus","util/SettingsManager","util/ThemeManager","Solitaire/SolitaireStatistics","absolute/spriteutils","Solitaire/GameContainer","Managers/AdManager","Managers/TelemetryManager","absolute/musicmanager","absolute/audiomanager","MenuUI/TimesUpDialog","absolute"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_,P,A,k,D){"use strict";var F=function(t,e){this.initSolitaireGame(t,e)};return F.prototype=Object.create(r.prototype),F.prototype.constructor=F,F.HINT_TIME_DELAY_MS=3e4,F.HINT_TIME_DELAY_MS_DC=1,F.ReadyForNavigation=!0,F.prototype.initSolitaireGame=function(t,e){r.call(this),this.game=e,this.ui=t,this._previousHint=null,this._hintTimeElapsed=0,this._gameContainer=null,this._gameBackground=null,this._coveringSprite=null,this._isBackgroundRightPressed=!1,this.settingsManager=b,this.AnimationsEnabled=new n,this.NeedUpdateNews=!1,this.KeyboardStatus=new F.KeyboardEnabled,this.IsTipShowing=!1,this._activeMode=s.Unknown,this.CurrentChallenge=null,this._activeHelpMode=null,this.TimerStatus=null,this.OutOfTime=!1,this.LockFue=!1,this.SentientManager=null,this.Authority=null,this.SupplyView=null,this.Template=null,this._soundOption=this.settingsManager.getSetting("general","soundFx"),this._musicOption=this.settingsManager.getSetting("general","music"),this._hintsOption=this.settingsManager.getSetting("general","hints"),this._onOfGameEndAnimations=this.settingsManager.getSetting("general","gameEndAnimation"),this.NextWinAnimation=0,this.TipsOption=F.DefaultTipsOption,this.GameResult=null,this._gameSetupComplete=!1,this.SetupComplete=new n,this.ForceStartFUE=!1,this.IsFueOpened=!1,this.ExternalSettings=null,this.OnMoveCards=new n,this.NextWinAnimation=0,this.ExternalSettings=null,this.OptInManager=null,this.TimerStatus=new F.TimerEnabled,this.GameStarted=!1,this._gameStartLock={},this._gameStarting=!1,this.CorruptLoad=!1,this.PointMove=new n,this.PointUp=new n,this.mouseup=function(t){D.Platform._isMac()&&D.Platform._isIOS()||this.PointUp.handleEvent(this,t)}.bind(this),this.mousemove=function(t){D.Platform._isMac()&&D.Platform._isIOS()||this.PointMove.handleEvent(this,t)}.bind(this),this.touchend=function(t){this.PointUp.handleEvent(this,t)}.bind(this),this.touchmove=function(t){this.PointMove.handleEvent(this,t)}.bind(this),this.interactive=!0,this.Register(this),o.Init(this.game,this.ui),o.Sounds.UpdateSoundState(this._soundOption,this._musicOption),d.CurrentGame=this,this.AutoSave()},Object.defineProperty(F.prototype,"Root",{get:function(){return this}}),F.prototype.OnAnimationsEnabled=function(t){this.AnimationsEnabled&&this.AnimationsEnabled.handleEvent(this,t)},F.KeyboardEnabled=function(){this.initKeyboardEnabled()},F.KeyboardEnabled.prototype.initKeyboardEnabled=function(){this.Enabled=!0},F.Current=null,Object.defineProperty(F.prototype,"ActiveMode",{get:function(){return null==this._activeMode?new f:this._activeMode},set:function(t){null==this._activeMode&&(this._activeMode=g.InitGameMode(s.Unknown)),this._activeMode=t}}),Object.defineProperty(F.prototype,"ActiveHelpMode",{get:function(){return null!=this._activeMode&&this._activeMode.Name!=s.Unknown?this._activeMode:null==this._activeHelpMode?new f:this._activeHelpMode},set:function(t){null==this._activeHelpMode&&(this._activeHelpMode=g.InitGameMode(s.Unknown)),this._activeHelpMode=t}}),F.TimerEnabled=function(){this.initTimerEnabled()},F.TimerEnabled.prototype.initTimerEnabled=function(){this.DisabledForWindowVisibility=!1,this.DisabledForShowingDialog=!1,this.DisabledForSolving=!1,this.DisabledForPortrait=!1},F.prototype.updateSetting=function(t,e){switch(t){case"soundFx":o.Sounds.UpdateSoundState(e,-1);break;case"music":o.Sounds.UpdateSoundState(-1,e);break;case"layoutDirection":this.Template.DoLayoutPiles(this.RenderManager,this.SupplyView),"Pyramid"===this.Authority.CardSupply.GameName&&this.game.gameScreenUI.drawButton.rotateIcon(),"TriPeaks"===this.Authority.CardSupply.GameName&&this.game.gameScreenUI.updateLayout()}},Object.defineProperty(F.TimerEnabled.prototype,"Enabled",{get:function(){return!(this.DisabledForWindowVisibility||this.DisabledForShowingDialog||this.DisabledForSolving||this.DisabledForPortrait)}}),Object.defineProperty(F.prototype,"SoundOption",{get:function(){return this._soundOption},set:function(t){this._soundOption!=t&&(this._soundOption=t)}}),Object.defineProperty(F.prototype,"MusicOption",{get:function(){return this._musicOption},set:function(t){this._musicOption!=t&&(this._musicOption=t)}}),Object.defineProperty(F.prototype,"HintsOption",{get:function(){return this.settingsManager.getSetting("general","hints")},set:function(t){this._hintsOption=t,null==F.Current.SupplyView||this._hintsOption!=l.Disable||null==F.Current.Authority||F.Current.Authority.IsChallenge||F.Current.SupplyView.ClearHints()}}),Object.defineProperty(F.prototype,"OnOfGameEndAnimations",{get:function(){return this.settingsManager.getSetting("general","gameEndAnimation")},set:function(t){this._onOfGameEndAnimations=t}}),Object.defineProperty(F.prototype,"DrawOption",{get:function(){return parseInt(this.Authority.CardSupply.GetOption("Draw"))}}),Object.defineProperty(F.prototype,"ScoringOption",{get:function(){try{return this.Authority.CardSupply.GetOption("Scoring")}catch(t){return u.Standard}}}),Object.defineProperty(F.prototype,"SuitsOption",{get:function(){return parseInt(this.Authority.CardSupply.GetOption("Suits"))}}),Object.defineProperty(F.prototype,"GameSetupComplete",{get:function(){return this._gameSetupComplete},set:function(t){this._gameSetupComplete!=t&&(this._gameSetupComplete=t,t&&this.SetupComplete.handleEvent(this))}}),F.prototype.GetUserAvatar=function(){return""},F.prototype.OnCardsMoved=function(){var t=this.OnMoveCards;null!=t&&t.handleEvent(),this.Authority&&!this.Authority.IsChallenge&&(this._previousHint=null)},F.prototype.ClearHintsCallback=function(){this._hintTimeElapsed=0},F.prototype.CurrentAppSuspending=function(t,e){},F.prototype.PerformSaveGame=function(t,e){setTimeout(function(){this.SaveGame()}.bind(this),0)},F.prototype.InitGame=function(){},F.prototype.EngineFrame=function(t,e){this.Update(o.Time)},F.prototype.StartGame=function(t,e,i,n,r){if(e=!!e,i=!!i,!this._gameStarting&&(this._gameStarting=!0,null==this.ActiveMode||this.ActiveMode.Name!=t)){null!=this.ActiveMode&&this.ActiveMode.Name!=s.Unknown&&this.StopGame(!0),this.GameResult=c.None,this.ActiveMode=g.InitGameMode(t),this.Template=this.ActiveMode.CreateTemplate(),this.Authority,this.Authority=this.Template.CreateAuthority(this.CurrentChallenge),this.Authority.IsChallenge||this.Template.LoadGameOptions(this.Authority.CardSupply,i),this.Authority.CardSupply.IsTimerCountdown=this.ActiveMode.TimerOption==p.TimerSettings.CountDown,this.Authority.CardSupply.IsWaitingForAds=!0,this.game.gameScreenUI.isSavedGame=!e;var o=this.LoadGame(e);this.CorruptLoad&&null!=this.OnLoadCorruptFile&&(this.OnLoadCorruptFile(),this.CorruptLoad=!1),d.Current=this.Authority.CardSupply.HasMovedCards?d.InProgress:d.BeforeGame,this.CreateViewRepresentation(),this.Authority.CardSupply.OnTimeRanOutEvent.add(this.CardSupply_OnTimeRanOut.bind(this)),this.SupplyView.OnMoveCardsEvent.add(this.SupplyView_OnMoveCards.bind(this)),!this.Authority.IsChallenge&&o&&_.classicGameStart(this.game.solitaire.Authority.CardSupply.GameName,"Saved",this.ScoringOption,this.DrawOption,this.SuitsOption),this.Authority.IsChallenge?this.SupplyView.doChallengeScaling():this.SupplyView.doClassicScaling(!o,r),this._gameLoaded,this.GameStarted=!0,null!=this._coveringSprite&&(this._coveringSprite.Alpha=1),this._gameStarting=!1,this.GameStarted=!0}},F.prototype.Default_ThemeEnablingChanged=function(t,e){},F.prototype.DealCardsAccordingToAds=function(){this.Authority.IsChallenge,this.AdsCompleted()},F.prototype.OnChallengeStarted=function(){this.AdsCompleted(),this.TimerStatus.DisabledForShowingDialog=!1},F.prototype.AdsCompleted=function(){this.Authority.CardSupply.IsWaitingForAds=!1,this.DealCards(),this.SupplyView.HasRunInit?this.SupplyView.ActivateInputAndNavigation():this.SupplyView.AllowInitKeyboardOnLoad=!0},F.prototype.DealCards=function(){this._gameLoaded||!this.Authority.CardSupply.IsGamePageLoaded||this.Authority.CardSupply.CardsDealt||(this.Authority.Reset(),this.Authority.CardSupply.CleanTemporaryOptions(),this.Authority.CardSupply.DeckSeed=null,this.Authority.CardSupply.GenerateGameKey(),this.Authority.Deal()),e.log("Solitaire: cards dealt"),this.ReadyForNavigation=!0},F.prototype.GameLoadingCompleted=function(){null!=this.Authority&&(this.Authority.CardSupply.IsGamePageLoaded=!0,this.Authority.CardSupply.IsWaitingForAds||this.DealCards())},F.prototype.GameBackgroundOnOnMouseUp=function(t,e){this.mouseDown&&!this.SupplyView.IsCardDragging&&this.SupplyView.GameInputInterpreter.ClearHighlight(),this.mouseDown=!1,this._isBackgroundRightPressed&&(this._isBackgroundRightPressed=!1)},F.prototype.GameBackgroundOnOnMouseDown=function(t,e){this.mouseDown=!0},F.prototype.CardSupply_OnDealEvent=function(t){null!=this.SupplyView&&(this.SupplyView.IsCardDragging=!1)},F.prototype.FadeOutAndInGame=function(t){null!=this._coveringSprite&&0==this._coveringSprite.Alpha?a.Start(this._coveringSprite).Wait(.1).Then().FadeTo(1,.2).Call(function(){this.ReloadGame(t)}.bind(this)).Call(function(){this.FadeInGame(function(t,e){},function(){})}):this.ReloadGame(t)},F.prototype.FadeInGame=function(t,e){if(null!=this._coveringSprite){a.Start(this._coveringSprite).Wait(.1).Then().FadeTo(0,.2).Call(e).Updated.add(t)}},F.prototype.PresentGame=function(){this.Scene.Root.Visible=!0,null!=this.SupplyView&&this.SupplyView.OnMoveCards()},F.prototype.CardSupply_OnTimeRanOut=function(t){if("Pyramid"===this.Authority.CardSupply.GameName){new k(this.ui.currentScreen).onClose.add(function(){this.GameResult=c.OutOfTime,d.Current=d.GameComplete}.bind(this))}else d.Current==d.InProgress&&(this.GameResult=c.OutOfTime,d.Current=d.GameComplete)},F.CardSupply_OnActionRun=function(t,e){w.Current.UpdateGameAction(F.Current.ActiveMode.GetStatKey())},F.prototype.StopGame=function(t){if(t=!!t,null!==this.Authority&&this.ActiveMode.Name===s.Klondike&&this.Authority.CardSupply.UseCumulativeScoring&&d.Current!==d.BeforeGame&&(this.Authority.CardSupply.CumulativeScore-=52,null!==this.Template&&this.Template.SaveGameOptions(this.Authority.CardSupply)),!t){if(this._gameStarting)return;this._gameStopping=!0,this.GameStopped=!1,S.removeEventListener("LogActionComplete",this.saveGameHandlerRef),this.Authority&&"function"==typeof this.Authority.CardSupply.CardAnimator.onHide&&this.Authority.CardSupply.CardAnimator.onHide()}this.GameResult==c.None&&null!=this.Authority&&this.Authority.IsChallenge;try{null!=this.Authority&&this.Authority.IsChallenge,this.ActiveMode.Name!=s.Unknown&&(this.GameStarted=!1,null!=this.SupplyView&&(this.SupplyView.OnMoveCardsEvent.remove(this.SupplyView_OnMoveCards.bind(this)),this.SaveGame()),d.Current=null,this.DestroySupplyView(),null!=this.Template&&this.Template.Cleanup(),this.Template=null,this.Authority=null,this.ActiveMode=g.InitGameMode(s.Unknown))}finally{this._gameStopping=!1,this.GameStopped=!0}},F.prototype.AutoSolve=function(){this.Template.TryAutoSolve(this.SupplyView)},F.prototype.SaveSettings=function(){try{null!=this.Template&&this.Template.SaveGameOptions(this.Authority.CardSupply)}catch(t){}},F.prototype.SaveGame=function(){if(this.GameIsValid()&&!this.Authority.IsChallenge&&d.Current&&(d.Current._name==d.InProgress._name||d.Current._name==d.BeforeGame._name)){var t=this.Authority.CardSupply.GetActionLog();i.store(this.ActiveMode.Name.toString(),t)}},F.prototype.DeleteSavedGame=function(){i.store(this.ActiveMode.Name.toString(),"")},F.prototype.GetOption=function(t){return this.Authority.CardSupply.GetOption(t)},F.prototype.DealNewGame=function(e,i,n){n||M.gameStarted(),this.PointMove.clear(),this.PointUp.clear(),this.PointUp.add(this.GameBackgroundOnOnMouseUpHandler),null!=this.Authority&&(this.Authority.IsChallenge||(_.classicGameStart(this.game.solitaire.Authority.CardSupply.GameName,"New",this.ScoringOption,this.DrawOption,this.SuitsOption),this.Authority.ForceDealScript(null)),d.Current==d.InProgress&&this.IncrementGameCount(),this.Authority.Reset(),d.Current=d.BeforeGame,this.UpdateAuthorityTimer(),this.Template.DoLayoutPiles(this.RenderManager,this.SupplyView),this.Authority.CardSupply.UseCumulativeScoring&&d.Current!=d.BeforeGame&&(this.Authority.CardSupply.CumulativeScore=this.Authority.CardSupply.CumulativeScore-52),this.Template.SaveGameOptions(this.Authority.CardSupply),this.game.solitaire.CurrentChallenge&&this.Authority.IsChallenge?this.game.solitaire.CurrentChallenge.SetupOptionsForAuthority(this.Authority):this.Template.LoadGameOptions(this.Authority.CardSupply),this.Authority.CardSupply.CleanTemporaryOptions(),this.Authority.CardSupply.DeckSeed=e||null,null!=this.Authority.CardSupply.CardAnimator&&this.Authority.CardSupply.CardAnimator.DelayNextAnimation(.25),this.Authority.CardSupply.GenerateGameKey(),this.Authority.Deal(e),"FreeCell"===this.Authority.CardSupply.GameName&&this.settingsManager.setSetting("freecell","gameNumber",this.Authority.CardSupply.DeckSeed),this.OnCardsMoved(),t.forEach(this.SupplyView.children,function(t){t.IsHinted=!1}),this.SupplyView.GameInputInterpreter.ClearHighlight(),this.Authority.CardSupply.IsTimerCountdown=this.ActiveMode.TimerOption==p.TimerSettings.CountDown,d.Current=d.BeforeGame,this.game.gameScreenUI.isSavedGame=!1,this.game.gameScreenUI.onShow(this.game.solitaire.Authority.CardSupply.Score,this.game.solitaire.Authority.CardSupply.CurrentTime,this.game.solitaire.Authority.BoardsCompleted(),i))},F.prototype.Reset=function(){this.Authority.Reset(),this.Authority.Deal(),this.Authority.CardSupply.StartGame(),d.Current=d.BeforeGame},F.prototype.Undo=function(t){if(!this.Authority.CardSupply.WaitingForAnimation&&!this.SupplyView.IsCardDragging&&d.Current!=d.AfterGame){this.Authority.IsChallenge||this.SupplyView.ClearHints(),this.SupplyView.ClearRevealCardStates();C.sParse(this.Authority.CardSupply,["undo",t?"-1":"1"]).Run()&&(d.Current==d.GameComplete&&(d.Current=d.InProgress),this.SupplyView.GameInputInterpreter.ClearHighlight(),o.Sounds.PlaySound("undo"),this.SupplyView.OnMoveCards())}},F.prototype.Hint=function(t){if(!(null==this.Authority||this.ActiveMode.WaitForAnimationOnHint&&this.Authority.CardSupply.WaitingForAnimation||d.Current!=d.BeforeGame&&d.Current!=d.InProgress)){t||this.Authority.IsChallenge||A.playSound("hint");var e=this.Authority.GetHint(!0);e.Equals(this._previousHint)||(this.SupplyView.ClearHints(),this.SupplyView.DisplayHint(e),this._previousHint=e)}},F.prototype.Update=function(t){if(this.updateUndoButtons(!this.Authority.CardSupply.CanUndoActions()),this.GameIsValid()){if(d.UpdateCurrent(),d.Current==d.BeforeGame||d.Current==d.InProgress?null!=this.SupplyView&&(this.SupplyView.KeyboardEnabled=this.KeyboardStatus.Enabled):null!=this.SupplyView&&(this.SupplyView.KeyboardEnabled=!1),this.TimerStatus.Enabled&&d.Current==d.InProgress&&this.UpdateAuthorityTimer(t),this._hintTimeElapsed+=t.ElapsedGameTime.Milliseconds,this.HintsOption==l.Enable&&!this.IsFueOpened){var e=this.Authority.IsChallenge?F.HINT_TIME_DELAY_MS_DC:F.HINT_TIME_DELAY_MS;this._hintTimeElapsed>=e&&(this.Hint(!0),this._hintTimeElapsed=0)}this.game&&this.game.gameScreenUI&&this.game.gameScreenUI.update(d,this.Authority),r.prototype.Update.call(this,t,this.SupplyView.GetPileView("Stock").height/2)}},F.prototype.GameIsValid=function(){return null!=this.ActiveMode&&this.ActiveMode.Name!=s.Unknown},F.prototype.updateUndoButtons=function(t){this.game.gameScreenUI.updateUndoButtonsState(t)},F.prototype.DestroySupplyView=function(){if(this.PointMove.clear(),this.PointUp.clear(),null!=this.SupplyView&&(window.removeEventListener("keydown",this.SupplyView.pressKeyReference,!0),x.destroyAllChildren(this.SupplyView),this._gameContainer&&this._gameContainer.removeSupplyView(),this.SupplyView=null),null!=this._gameBackground){this.PointUp.remove(this.GameBackgroundOnOnMouseUpHandler),this._gameBackground.MouseDown.remove(this.GameBackgroundOnOnMouseDownHandler);for(var t=this._gameBackground.children,e=0;e<t.length;e++)this._gameBackground.RemoveChild(t[e]);this.Scene.Root.RemoveChild(this._gameBackground),this._gameBackground=null}null!=this._coveringSprite&&(null!=this._coveringSprite.Parent&&this._coveringSprite.Parent.RemoveChild(this._coveringSprite),this._coveringSprite=null),this.DestroySceneNode(this._gameContainer),this._gameContainer=null},F.prototype.DestroySceneNode=function(t){null!=t&&null!=t.Parent&&t.Parent.children.length>0&&t.Parent.RemoveChild(t)},F.prototype.IncrementGameCount=function(){w.Current.UpdateGameRedeal(this.ActiveMode.GetStatKey())},F.prototype.CheckForBeKingAchievement=function(){w.Current.UpdateBoardWonWithKing(this.ActiveMode.GetStatKey())},F.prototype.LoadGame=function(t){if(this._gameLoaded=!1,this.Authority.CardSupply.IsGamePageLoaded=!1,this.Authority.IsChallenge||t)return this.GameLoadingCompleted(),!1;e.log("..............................STARTING GAME -- LOADING GAME");var n=i.fetch(this.ActiveMode.Name.toString())||"foo";e.log("..............................STARTING GAME -- GAME LOADED");var r=!1;return n?r=this._gameLoaded||this.LoadSavedGame(n):alert("Corrupted Saved Game"),r},F.prototype.LoadSavedGame=function(t){try{if(this.Authority.CardSupply.CleanTemporaryOptions(),this.Authority.CardSupply.DeckSeed=null,this.Authority.CardSupply.SuppressAnimations=!0,"foo"!=t&&C.RunActions(this.Authority.CardSupply,t),this.Authority.CardSupply.SuppressAnimations=!1,this.Authority.CardSupply.EnforceGameRules)return this.OnCardsMoved(),this._gameLoaded=!0,!0;this.GameLoadingCompleted()}catch(t){this.CorruptLoad=!0}return!1},F.prototype.CreateViewRepresentation=function(){this.CreateSupplyView(this.Authority),this.Template.DoLayoutPiles(this.RenderManager,this.SupplyView)},F.prototype.CreateSupplyView=function(t){this._gameContainer=new T(this.game),this.Scene.Root.AddChild(this._gameContainer),this._gameBackground=new r(v.CurrentTheme+"_bg/background.jpg"),this._gameBackground.interactive=!0,this._gameBackground.AnimationsEnabled=this.OnOffBackgroundAnimations,this._gameBackground.Layer=-5,this.GameBackgroundOnOnMouseUpHandler=this.GameBackgroundOnOnMouseUp.bind(this),this.PointUp.add(this.GameBackgroundOnOnMouseUpHandler),this.GameBackgroundOnOnMouseDownHandler=this.GameBackgroundOnOnMouseDown.bind(this),this._gameBackground.MouseDown.add(this.GameBackgroundOnOnMouseDownHandler),this._gameBackground.X=.5*o.Display.Width,this._gameBackground.Y=.5*o.Display.Height,
this._gameContainer.setBackground(this._gameBackground),this.SupplyView=new y(t.CardSupply,o.ui.width,o.ui.height,this.game),this.Authority.IsChallenge||(this.SupplyView.AllowInitKeyboardOnLoad=!0),this.ActiveMode.Name==s.TriPeaks&&(this.SupplyView.EnableHighlight=!1),y.EnableShadows=!1,this.SupplyView.ClearHintsCallback=this.ClearHintsCallback.bind(this),this.SupplyView.GetThemeAssetFunc=null,this.SupplyView.IsUserTheme=!1,this.SupplyView.GameInputInterpreter=this.Template.CreateInputInterpreter(this.Authority),this.SupplyView.Init(null),this.SupplyView.Register(this),this.SupplyView.X=.5*o.Display.Width,this.SupplyView.Y=.5*o.Display.Height,this.Authority.CardSupply.CardAnimator=this.Template.CreateCardAnimator(this.SupplyView),this.SupplyView.GameContainer=this._gameContainer,this._gameContainer.setSupplyView(this.SupplyView),this.SupplyView.SetupPileViews(),this.SupplyView.SetupCardViews(),null==this._coveringSprite&&(this._coveringSprite=new r,this._gameContainer.AddChild(this._coveringSprite)),this._coveringSprite.InputEnabled=!1,this._coveringSprite.Layer=10},F.prototype.SupplyView_OnMoveCards=function(t){this._hintTimeElapsed=0,this.OnCardsMoved()},F.prototype.AutoSave=function(){this.saveGameHandler=function(){this.SaveGame()}.bind(this),this.saveGameHandlerRef=this.saveGameHandler,S.removeEventListener("LogActionComplete",this.saveGameHandlerRef),S.addEventListener("LogActionComplete",this.saveGameHandlerRef)},F.prototype.UpdateAuthorityTimer=function(t){d.Current==d.InProgress&&this.TimerStatus.Enabled&&null!=this._coveringSprite&&this.Authority.CardSupply.AccumulateTime(t.ElapsedGameTime.TotalMilliseconds/1e3)},F}),define("MenuUI/DropShadow",["pixi","absolute","lodash"],function(t,e,i){var n=function(t){var n={beginningShade:.07,finalShade:.001,easeOut:function(t){return Math.pow(.8,t)},baseWidth:e.Coords.x(100),baseHeight:e.Coords.x(100),xOffset:e.Coords.x(15),yOffset:e.Coords.x(15)};this.initDropShadow(i.extend(n,t))};return n.prototype=Object.create(t.DisplayObjectContainer.prototype),n.prototype.initDropShadow=function(e){t.DisplayObjectContainer.call(this),this.config=e;for(var i=this.config.beginningShade,n=0;i>this.config.finalShade;){var r=new t.Graphics;i=this.config.beginningShade*this.config.easeOut(n),r.beginFill(1,i),r.drawRect(this.config.xOffset*this.config.easeOut(n),this.config.yOffset*this.config.easeOut(n),this.config.baseWidth,this.config.baseHeight),r.endFill(),this.addChildAt(r,0),n++}},n}),define("MenuUI/MenuTile",["pixi","absolute","lodash","MenuUI/DropShadow"],function(t,e,i,n,r){var o=function(t){var n={userData:null,imageScale:1,image:"",icon:"",label:"",action:null,letterStyle:{font:32*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",align:"left"},iconPosition:{x:0,y:0},labelPosition:{x:e.Coords.x(80),y:0},labelPadding:e.Coords.y(15),labelOffset:e.Coords.y(14),dropShadow:!0,hoverBox:!0,disableOnClick:!0};this.initMenuTile(i.extend(n,t))};return o.constructor=o,o.prototype=Object.create(t.DisplayObjectContainer.prototype),o.prototype.initMenuTile=function(i){function r(){a.image=t.Sprite.fromFrame(a.config.image),a.image.width=a.config.width*this.config.imageScale,a.image.height=a.config.height*this.config.imageScale,a.addChild(a.image),o.removeEventListener("loaded",r)}if(t.DisplayObjectContainer.call(this),this.config=i,this.startPos=new t.Point,this.moveThreshold=e.Coords.x(15),this.down=!1,this.config.image instanceof t.Texture?(this.image=new t.Sprite(this.config.image),this.image.scale.x=this.image.scale.y=e.ScreenMetrics.getResScale()):"string"!=typeof this.config.image||this.config.imageExternalUrl?this.config.image instanceof t.DisplayObject&&(this.image=this.config.image):this.image=t.Sprite.fromFrame(this.config.image),this.image)this.addChild(this.image);else if(this.config.imageExternalUrl){var o=new t.ImageLoader(this.config.image,!0),a=this;o.addEventListener("loaded",r),o.load()}this._hasFocus=!1,this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(e.Coords.x(3),16777215);var s=e.Coords.x(-4);this.focusIndicator.drawRect(s,s,this.width-2*s,this.height-2*s);var l=0;if(""!==this.config.icon&&(this.icon=t.Sprite.fromFrame(this.config.icon),this.icon.x=this.config.iconPosition.x,this.icon.y=this.config.iconPosition.y||this.height-this.icon.height,l=this.config.labelPosition.y||this.icon.y+this.config.labelOffset,this.config.labelPosition.x=this.icon.x+this.icon.width),this.config.label&&""!==this.config.label){var h="tiles."+this.config.label,u=e.StringManager(h);u===h&&(u=this.config.label),this.config.isMainMenu&&(this.config.letterStyle.dropShadow=!0,this.config.letterStyle.dropShadowColor="#000000",this.config.letterStyle.dropSahdowAngle=0,this.config.letterStyle.dropShadowDistance=.8);var d=new t.Text(u,this.config.letterStyle),c=e.StringManager.extractNumbersFromString(this.config.letterStyle.font),p=-1!==this.config.letterStyle.font.toLowerCase().indexOf("bold"),g=0,f=0;this.config.isMainMenu||this.config.isDailyChallenge?(g=this.config.isMainMenu?this.width-e.Coords.x(100):this.width-e.Coords.x(40),f=.5,this.config.labelOffset=e.Coords.y(35),l=this.config.labelPosition.y||this.icon.y+this.config.labelOffset):g=this.config.maxWidth||this.width-e.Coords.x(105),e.StringManager.shrinkToFit(d,c,p?"Bold ":"",g),this.label=new t.Sprite(d.generateTexture()),this.label.anchor.set(0,f),this.label.x=this.config.labelPosition.x,this.label.y=this.config.labelPosition.y||l}if(this.config.hoverBox){var y=new t.Graphics,m=e.Coords.x(4);y.beginFill(16777215,0),y.lineStyle(m,16777215,1),y.drawRect(0,0,this.width,this.height),y.endFill(),this.hover=y,this.hover.alpha=.01}if(this.mouseover=function(){this.hover&&(this.hover.visible=!0,this.hover.alpha=1)},this.mouseout=function(){this.hover&&(this.hover.visible=!1)},this.config.dropShadow){var C=new n({baseWidth:this.width,baseHeight:this.height});this.dropShadow=C,this.addChildAt(C,0)}this.label&&this.addChild(this.label),""!==this.config.icon&&this.addChild(this.icon),this.hover&&this.addChild(this.hover),this.bindInteraction(this,this.handleClick)},o.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,t.mousedown=function(t){e.Platform._isMac()&&e.Platform._isIOS()||(this.clickCanceled=!1,this.startPos=t.global.clone(),this.down=!0)}.bind(this),t.mouseup=function(t){e.Platform._isMac()&&e.Platform._isIOS()||(!this.clickCanceled&&this.down&&this.handleAction(i),this.clickCanceled=!1,this.down=!1)}.bind(this),t.mousemove=function(t){e.Platform._isMac()&&e.Platform._isIOS()||this.down&&(Math.abs(this.startPos.x-t.global.x)>this.moveThreshold||Math.abs(this.startPos.y-t.global.y)>this.moveThreshold)&&(this.clickCanceled=!0)}.bind(this),t.touchstart=function(t){this.clickCanceled=!1,this.startPos=t.global.clone(),this.down=!0}.bind(this),t.touchend=function(t){!this.clickCanceled&&this.down&&this.handleAction(i),this.clickCanceled=!1,this.down=!1}.bind(this),t.touchmove=function(t){this.down&&(Math.abs(this.startPos.x-t.global.x)>this.moveThreshold||Math.abs(this.startPos.y-t.global.y)>this.moveThreshold)&&(this.clickCanceled=!0)}.bind(this)},o.prototype.handleAction=function(t){this.interactive&&(this.config.disableOnClick&&(this.interactive=!1),e.AudioManager.playSound("button"),t.call(this))},o.prototype.handleClick=function(){"function"==typeof this.config.action&&this.config.action(this.config.userData)},o.prototype.handleActivate=function(){this.handleClick()},o.prototype.onShow=function(){this.interactive=!0},Object.defineProperty(o.prototype,"width",{get:function(){var t=0;return this.image?t=this.image.width:this.config.width&&(t=this.config.width),t}}),Object.defineProperty(o.prototype,"height",{get:function(){var t=0;return this.image?t=this.image.height:this.config.height&&(t=this.config.height),t}}),o.prototype._focusChanged=function(){this._hasFocus?this.addChild(this.focusIndicator):-1!=this.children.indexOf(this.focusIndicator)&&this.removeChild(this.focusIndicator)},Object.defineProperty(o.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),o}),define("MenuUI/ClassicGameTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile"],function(t,e,i,n,r){var o=function(t,e,n){var r={fontSize:35};this.callback=n,this.initClassicGameTile(i.extend(r,t),e)};return o.prototype=Object.create(r.prototype),o.prototype.initClassicGameTile=function(t,i){this.mainMenu=i,e.Platform.isMobile()&&(t.fontSize=45),t.letterStyle={font:"bold "+e.ScreenMetrics.getResScale()*t.fontSize+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",align:"left",strokeThickness:1},r.call(this,t),this.mainMenu=i,this.interactive=!1},o.prototype.handleClick=function(){this.callback&&this.callback.call(),this.mainMenu.game.startGame(n[this.config.mode])},o}),define("MenuUI/Menu",["pixi","absolute","lodash","Managers/ScaleManager"],function(t,e,i,n){var r=function(t){this._currentLayoutType="xl";var n={tiles:[],label:"",letterStyle:{font:45*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},tilePaddingX:e.Coords.x(24),tilePaddingY:e.Coords.x(50)};this.initMenu(i.extend(n,t))};return r.prototype=Object.create(t.DisplayObjectContainer.prototype),r.prototype.initMenu=function(r,o){t.DisplayObjectContainer.call(this),this.container=new t.DisplayObjectContainer,this.config=r;this.getLayoutConfig();if(this.pageGenerator=new e.MultiPageGenerator({width:this.config.width?this.config.width:e.Coords.x(1920),height:e.Coords.y(1080),cardScale:this.config.scale||1,padding:{x:this.config.tilePaddingX,y:this.config.tilePaddingY},itemWidth:this.config.tiles[0].width,itemHeight:this.config.tiles[0].height,align:this.config.align||"none",maxWidth:this.config.maxWidth,keepOneLine:this.config.keepOneLine,startY:this.config.startY||0}),this.configTiles=this.config.tiles.slice(),this.checkAndAddTransparentElements(),this.pages=this.pageGenerator.getPages(this.configTiles),i.each(this.pages,function(t){this.container.addChild(t)},this),""!==this.config.label){var a="menu."+this.config.label,s=e.StringManager(a);s===a&&(s=this.config.label),this.label=new t.Text(s,this.config.letterStyle),this.config.labelPosition?(this.label.x=this.config.labelPosition.x,this.label.y=this.config.labelPosition.y):(this.label.x=-e.Coords.x(27),this.label.y=-e.Coords.y(70)),this.label.scale.set(this.pageGenerator.cardScale),this.container.addChildAt(this.label,0)}n.addElement(this,{scaleChangeSource:"Full"}),this.addChild(this.container),this.currentHeight=this.height,this.handleResize()},r.prototype.checkAndAddTransparentElements=function(){if(this.config.keepOneLine){var e=(this.config.tilesInOneLine||(this.config.maxColNum?this.config.maxColNum:5))-this.config.tiles.length;if(e>0)for(var i=this.config.tiles[0],n=0;n<e;n++){var r=new t.Graphics;r.beginFill(16753920,0),r.drawRect(0,0,i.width,i.height),r.endFill(),this.configTiles.push(r)}}},r.prototype.onShow=function(){i.each(this.config.tiles,function(t){"function"==typeof t.onShow&&t.onShow()}),this.handleResize()},r.prototype.onHide=function(){i.each(this.config.tiles,function(t){"function"==typeof t.onHide&&t.onHide()})},r.prototype.handleResize=function(){if(this.currentHeight){var t=this.getLayoutConfig();this.updateLayout(t),this.currentHeight=this.height}},r.prototype.updateLayout=function(t){if(t.type!==this._currentLayoutType){var n=i.extend({},this.pageGenerator.settings);n.align=t.align,n.maxWidth=e.Coords.x(t.maxWidth),n.maxHeight=e.Coords.y(t.maxHeight),this.pages.forEach(function(t){-1!==this.container.children.indexOf(t)&&this.container.removeChild(t)}.bind(this)),this.pageGenerator.updateSettings(n),this.pages=this.pageGenerator.getPages(this.configTiles),this.pages.forEach(function(t){this.container.addChild(t)}.bind(this)),this._currentLayoutType=t.type}},r.prototype.getLayoutConfig=function(){for(var t,e=0;e<this.config.layoutConfigs.length;e++)(this.config.layoutConfigs[e].screenHeight&&n.height<this.config.layoutConfigs[e].screenHeight||this.config.layoutConfigs[e].screenWidth&&n.width<this.config.layoutConfigs[e].screenWidth)&&(t=this.config.layoutConfigs[e]);return t},r.prototype.addTooltip=function(t){this.addChild(t)},r.prototype.removeTooltip=function(t){this.removeChild(t)},r}),define("MenuUI/MultiPageMenu",["pixi","absolute/button","absolute/screenmetrics","lodash","absolute/pageindicator","absolute/coords","absolute/platform","absolute/stringmanager","absolute/audiomanager"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e){var r={pages:[],pagePadding:{x:o.x(90),y:o.y(180)},borderThickness:{left:o.x(0),right:o.x(0)},interfacePadding:{arrows:{x:o.x(10),y:o.y(25)},pips:o.y(25)},buttonScale:1,pageButtonImage:"btn_arrow_ring.png",pageChangedCallback:function(){},startPage:0,width:o.x(1920),height:o.x(1080),letterStyle:{font:34*i.getResScale()+"px segoe2",tint:16777215,align:"left"}};this.initMultiPageMenu(t,n.extend(r,e))};return h.prototype=Object.create(t.DisplayObjectContainer.prototype),h.prototype.initMultiPageMenu=function(e,i){t.DisplayObjectContainer.call(this),this.ui=e,this.options=i,this.nextPage=0,this.pageChangedHandler=null,this.container=new t.DisplayObjectContainer,this.buttonContainer=new t.DisplayObjectContainer,this.addChild(this.container),this.pages=this.options.pages;var n=this.options.startPage<this.pages.length?this.options.startPage:0;this.reset(!1,n)},h.prototype.reset=function(t,e,i){if(t)try{this.removeChild(this.pageTray),this.removeChild(this.pips),this.removeChild(this.nextpageButton),this.removeChild(this.prevpageButton)}catch(t){}i&&(this.options.pages=i,this.pages=i),this.initContent(),this.initNonTouchInterface(),a._isOldAndroid()||this.initTouchInterface(),this.initPagePips(),this.scrollToPage(e,!1),this.addChild(this.buttonContainer)},h.prototype.initContent=function(){var e=0;this.pagePositions=[],this.pageTray=new t.DisplayObjectContainer;for(var i=0,n=this.pages.length;i<n;i+=1){var r=this.pages[i];r.x=i*this.options.width+this.options.pagePadding.x,r.y=this.options.pagePadding.y,this.pageTray.addChild(r),e+=r.width,this.pagePositions.push(r.x)}this.kPanThreshold=this.options.width/5,this.centerOffset=(this.options.width-this.pages[0].width)/2,this.pageTray.position.x=this.centerOffset;var o=new t.Graphics;o.beginFill(16777215,1),o.drawRect(this.position.x+this.options.borderThickness.left,this.position.y,this.options.width-this.options.borderThickness.right,this.options.height),o.endFill(),this.pageTray.mask=o,this.container.addChild(this.pageTray)},h.prototype.initTouchInterface=function(){this.lastDeltaX=0,this.startX=0;var e=new t.Rectangle(this.options.pagePadding.x,0,this.options.width-2*this.options.pagePadding.x,this.options.height-o.y(75));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=e,this.touchContainer.addChild(this.pageTray),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},h.prototype.initNonTouchInterface=function(){this.labelPadding=o.x(14),this.nextpageButton=new e(t.Texture.fromFrame(this.options.pageButtonImage),t.Texture.fromFrame(this.options.pageButtonImage),this.scrollNextPage.bind(this),!1);var i=this.ui.height/2-this.nextpageButton.height/2;this.nextpageButton.scale.x=-1*this.options.buttonScale,this.nextpageButton.scale.y=this.options.buttonScale,this.nextpageButton.position.x=this.options.width-this.options.interfacePadding.arrows.x,this.nextpageButton.position.y=i,this.nextpageButton.setActive(!1),this.buttonContainer.addChild(this.nextpageButton),this.prevpageButton=new e(t.Texture.fromFrame(this.options.pageButtonImage),t.Texture.fromFrame(this.options.pageButtonImage),this.scrollPrevPage.bind(this),!1),this.prevpageButton.position.y=i,this.prevpageButton.scale.x=this.prevpageButton.scale.y=this.options.buttonScale,this.prevpageButton.position.x=this.options.interfacePadding.arrows.x,this.prevpageButton.setActive(!1),this.buttonContainer.addChild(this.prevpageButton)},h.prototype.scrollNextPage=function(t){return this.currentPage<this.pages.length-1&&(this.scrollToPage(this.currentPage+1,!0,t),!0)},h.prototype.scrollPrevPage=function(t){return this.currentPage>0&&(this.scrollToPage(this.currentPage-1,!0,t),!0)},h.prototype.initPagePips=function(){this.pages.length>1&&(this.pips=new r(this.pages.length,0,n.extend(this.options,{clickCallback:function(t){this.scrollToPage(t,!0,!0)}.bind(this)})),this.pips.position.x=(this.options.width-this.pips.totalWidth)/2,this.pips.position.y=this.options.height-this.pips.totalHeight-this.options.interfacePadding.pips,this.pips.scale.x=this.pips.scale.y=1,this.container.addChild(this.pips))},h.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaX=0,this.startX=t.getLocalPosition(this.parent).x,this.enableButtons(!1)},h.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),n=e.x-this.startX;this.pageTray.x+=(n-this.lastDeltaX)*i.devicePixelRatio*.7,this.lastDeltaX=n}},h.prototype.handleDragEnd=function(t){if(this.dragging=!1,this.lastDeltaX=0,void 0!==this.parent){var e=this.currentPage,i=t.getLocalPosition(this.parent),r=i.x-this.startX;r<=-this.kPanThreshold?e+=1:r>=this.kPanThreshold&&(e-=1),e<0?e=0:e>this.pages.length-1&&(e=this.pages.length-1),window.setTimeout(function(){n.isNumber(e)&&this.scrollToPage(e)}.bind(this),0)}},h.prototype.setPageChangedHandler=function(t){this.pageChangedHandler=t},h.prototype.scrollToPage=function(t,e,i){i=!!i,void 0===e&&(e=!0),this.pips&&this.pips.setPageIndex(t);var n,r=(this.pages[t].width,this);this.centerOffset=this.options.pagePadding.x,n=-this.pagePositions[t]+this.centerOffset;var o=this.currentPage;i&&l.playSound("button"),e?new TWEEN.Tween({x:this.pageTray.position.x}).to({x:n},200).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){r.pageTray.position.x=this.x}).onComplete(function(){r.enableButtons(!0),r.setCurrentPage(t),"function"==typeof r.pageChangedHandler&&r.pageChangedHandler(o,r.currentPage)}).start():(this.pageTray.position.x=n,this.enableButtons(!0),this.setCurrentPage(t),"function"==typeof r.pageChangedHandler&&this.pageChangedHandler(o,this.currentPage))},h.prototype.setCurrentPage=function(t){var e=t!==this.pages.length-1,i=0!==t;this.currentPage=t,this.nextpageButton.setActive(e),this.prevpageButton.setActive(i),this.nextpageButton.alpha=e?1:.3,this.prevpageButton.alpha=i?1:.3,this.options.pageChangedCallback(t)},h.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.pages.length;e<i;e++)this.pages[e].interactive=t},h}),define("MenuUI/ThemeTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","util/SettingsManager"],function(t,e,i,n,r,o){var a=function(t){var n={labelPosition:{x:e.Coords.x(15),y:e.Coords.y(217)}};this.initThemeTile(i.extend(n,t))};return a.prototype=Object.create(r.prototype),a.prototype.initThemeTile=function(i){r.call(this,i),this.themeId=this.config.themeId,this.selectedHighlight=t.Sprite.fromFrame("mainmenu/frame_theme_highlight.png"),this.selectedHighlight.x=this.selectedHighlight.y=-e.Coords.x(7),this.addChild(this.selectedHighlight),this.updateState(this.themeId==o.getSetting("theme","selected")),this.initOutline()},a.prototype.initOutline=function(){var i=new t.Graphics,n=e.Coords.x(1);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.drawRect(0,0,this.width,this.height),i.endFill(),this.addChild(i),this.imageOutline=i},a.prototype.handleClick=function(){o.setSetting("theme","selected",this.themeId),this.config.themeChangeCallback(this.themeId)},a.prototype.updateState=function(t){this.selected=t,this.selectedHighlight.visible=t},a.prototype.onShow=function(){},a}),define("MenuUI/StatsItemModel",["Solitaire/SolitaireStatistics"],function(t){"use strict";var e=function(t){this.initStatsItemModel(t)};return e.constructor=e,e.prototype.initStatsItemModel=function(t){this.gameMode=t,this._stats=[],this._updateAllFunc=null,this._statKey=null,this.isDetailedStats=!1},e.prototype.addStat=function(e,i,n){var r=i.call(t.Current,n);this._stats.push({stringKey:e,updateFunc:i,statKey:n,value:r})},e.prototype.updateStats=function(){if(this._updateAllFunc)for(var e=this._updateAllFunc.call(t.Current,this._statKey),i=0;i<this._stats.length;i++)this._stats[i].value=e[i];else for(var i=0;i<this._stats.length;i++)this._stats[i].value=this._stats[i].updateFunc.call(t.Current,this._stats[i].statKey)},e.prototype.addStats=function(t,e,i){this._updateAllFunc=e,this._statKey=i;for(var n=0;n<t.length;n++)this._stats.push({stringKey:t[n]})},e.prototype.getStats=function(){return this._stats},Object.defineProperty(e.prototype,"StatKey",{get:function(){return this._statKey}}),e}),define("MenuUI/DetailStatsItemModel",["MenuUI/StatsItemModel","Solitaire/SolitaireStatistics","Solitaire/SolitaireGameMode"],function(t,e,i){"use strict";var n={klondike:["GamesPlayed","GamesWon","GamesLost","PercentWon","WinningStreak","LongestWinningStreak","LongestLosingStreak","HighScore","AverageScore","BestTime","AverageTime"],spider:["GamesPlayed","GamesWon","GamesLost","PercentWon","HighScore","AverageScore","BestTime","AverageTime","Stacks","AverageStacks"],freecell:["GamesPlayed","GamesWon","GamesLost","PercentWon","BestTime","AverageTime"],pyramid:["GamesPlayed","HighScore","HighestBoards","Boards","AverageBoards","HighestRowsCleared","RowsCleared","AverageRowsCleared","HighestMatches","Matches","AverageMatches"],tripeaks:["GamesPlayed","HighScore","HighestBoards","Boards","AverageBoards","HighestPeaksCleared","PeaksCleared","AveragePeaksCleared","LongestCardsChained"]},r=function(t){this.initDetailStatsItemModel(t)};return r.prototype.initDetailStatsItemModel=function(t){this._gameMode=t,this._statsItemModels=[],this.buildStatsItemModels()},Object.defineProperty(r.prototype,"StatsItemModels",{get:function(){return this._statsItemModels}}),r.prototype.buildStatsItemModels=function(){for(var r=e.Current.GetKeys(this._gameMode),o=0;o<r.length;o++){var a=n[i.getModeById(this._gameMode).toLowerCase()],s=new t(this._gameMode);s.addStats(a,e.Current.GetAllStats,r[o]),s.updateStats(),this._statsItemModels.push(s)}},r}),define("MenuUI/Label",["pixi","absolute","lodash","absolute/stringmanager"],function(t,e,i,n){var r=function(t){var n={icon:null,iconScale:1,text:"",letterStyle:{font:40*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"}};this.initLabel(i.extend(n,t))};return r.prototype=Object.create(t.DisplayObjectContainer.prototype),r.prototype.initLabel=function(e){t.DisplayObjectContainer.call(this),this.config=e,this.icon=this.config.icon?t.Sprite.fromFrame(this.config.icon):null,this.icon&&(this.icon.scale.x=this.icon.scale.y=this.config.iconScale,this.addChild(this.icon)),this.setText(this.config.text)},r.prototype.setText=function(r){this.labelText&&this.removeChild(this.labelText),this.labelText=new t.Text(r,i.extend({},this.config.letterStyle));var o=n.extractNumbersFromString(this.config.letterStyle.font),a=-1!==this.config.letterStyle.font.toLowerCase().indexOf("base");this.config.maxWidth&&e.StringManager.shrinkToFit(this.labelText,o,a?"Bold":"",this.config.maxWidth),this.icon?this.labelText.x=this.icon.width+e.Coords.x(15):this.labelText.y=-e.Coords.y(10),this.addChild(this.labelText)},r.prototype.onShow=function(){},r}),define("MenuUI/ColorConstants",[],function(){"use strict";return{Klondike:2079208,Spider:10771944,FreeCell:13385021,Pyramid:16485121,TriPeaks:7517444,DailyChallenge:159167,StarClub:265302}}),define("MenuUI/MsftIconButton",["pixi","absolute","lodash","MenuUI/MsftButton","absolute/stringmanager","util/SettingsManager"],function(t,e,i,n,r,o){var a=function(t){this._initMsftIconButton(t)};return a.constructor=a,a.prototype=Object.create(n.prototype),a.prototype._initMsftIconButton=function(r){this.fontSize=17*e.ScreenMetrics.getResScale(),r&&r.fontSize&&(this.fontSize=r.fontSize);var o={letterStyle:{font:this.fontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},upStroke:!0};n.call(this,i.extend(o,r)),this.options.label&&(this.label=new t.Text(this.options.label.text.toString(),this.options.label.letterStyle),this.label.x=(this.width-this.label.width)/2,this.label.y=-e.Coords.y(3),this.addChild(this.label))},a.prototype.coolDown=function(t){this.interactive=!1,clearTimeout(this.coolDownTimeout),this.coolDownTimeout=setTimeout(function(){this&&(this.interactive=!0)}.bind(this),t)},a.prototype._createTexture=function(n,o,a,s){"down"===o?this.options.letterStyle.fill="#000001":"active"!==o&&"up"!==o&&"over"!==o||(this.options.letterStyle.fill="#ffffff");var l=new t.DisplayObjectContainer,h=new t.Graphics,u=new t.Graphics,d=Math.ceil(e.Coords.x(1)),c="up"===o?.5:1,p=new t.Text(this.options.text,i.cloneDeep(this.options.letterStyle));if(!a&&this.options.buttonOptions){var g=this.options.buttonOptions;h.beginFill("over"===o?16777215:"down"===o?g.isDownBkgColor:g.isUpBkgColor,"down"===o?.7:"active"===o?0:.3),h.drawRect(0,0,this.options.width,this.options.height),h.endFill(),u.lineStyle(d,"down"===o?g.isDownStrokeColor:g.isUpStrokeColor,"down"===o?1:c),u.beginFill("down"===o?16777215:"over"===o?g.isOverStrokeFill:g.isUpStrokeFill),u.drawRect(0,0,this.options.width-4*d,this.options.height-4*d),u.endFill()}else h.beginFill("down"===o?16777215:1,"down"===o||"active"===o?1:"over"===o?.3:this.options.backgroundOpacity||.2),h.drawRect(0,0,this.options.width,this.options.height),h.endFill(),u.lineStyle(d,"down"===o||"active"===o?1:s?7370886:16777215,"down"===o||s?.08:"down"===o||"active"===o?1:c),u.beginFill("over"===o&&s?5275053:"up"===o?1:16777215,"over"===o&&s||"down"===o?1:"up"===o||"active"===o?.2:.1),u.drawRect(0,0,this.options.width-4*d,this.options.height-4*d),u.endFill();return u.x=2*d,u.y=2*d,this.options.maxWidth&&r.shrinkToFit(p,this.fontSize,"",this.options.maxWidth),p.x=(this.options.width-p.width)/2,p.y=this.options.textY||e.Coords.y(35),l.addChild(h),l.addChild(u),this.options.icon&&(this.icon=t.Sprite.fromFrame("down"===o?this.options.iconDown:this.options.icon),this.options.iconSize&&(this.icon.width=this.options.iconSize.width,this.icon.height=this.options.iconSize.height),this.icon.x=(this.options.width-this.icon.width)/2,this.options.iconY?this.icon.y=e.Coords.y(12+this.options.iconY):this.icon.y=e.Coords.y(12),l.addChild(this.icon)),l.addChild(p),l.generateTexture()},a.prototype.rotateIcon=function(){var t="1"===o.getSetting("pyramid","layoutDirection")?"left":"right";this.lastPosition={x:this.x,y:this.y},this.options.letterStyle.fill="#ffffff";var e=this.parent;e.removeChild(this),this.options.icon="btn_pyramid_draw_"+t+".png",this.options.iconDown="btn_pyramid_draw_inv_"+t+".png",this._initMsftIconButton(this.options),e.addChild(this),this.position.set(this.lastPosition.x,this.lastPosition.y)},a.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.overTexture)},this.mouseout=function(t){this.setTexture(this.upTexture)},this.mousedown=function(t){this.setTexture(this.downTexture)},this.mouseup=function(t){this.setTexture(this.upTexture),this.handleAction(),this.mouseover()}},a.prototype.updateTexture=function(t){this.upTexture=this._createTexture(this.options,"up",t,!0),this.downTexture=this._createTexture(this.options,"down",t,!0),this.overTexture=this._createTexture(this.options,"over",t,!0),this.setTexture(this.upTexture)},a}),define("MenuUI/StatsOverviewTile",["pixi","absolute","absolute/stringmanager","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","MenuUI/Label","MenuUI/ColorConstants","MenuUI/MsftIconButton"],function(t,e,i,n,r,o,a,s,l){var h=function(t,i,r){var o={letterStyle:{font:37*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},borderSize:0,borderColor:16777215,backgroundColor:0,width:400,height:380,padding:15,lineWidth:3,titleFontSize:30,titleHorizontalPadding:0,generalFontSize:26,generalFontMargin:5,buttonWidth:160,buttonPadding:10};this.initStatsOverviewTile(n.extend(o,t),i,r)};return h.prototype=Object.create(o.prototype),h.prototype.initStatsOverviewTile=function(n,a,l){this.config=n,this.menu=l,this.statsModel=a,this.hasMoreInfo=this.statsModel.gameMode!=r.DailyChallenge&&this.statsModel.gameMode!=r.StarClub&&!this.statsModel.isDetailedStats&&this.statsModel.gameMode!=r.FreeCell;var h=new t.Graphics;h.beginFill(s[r.getModeById(a.gameMode)]),h.drawRect(0,0,e.Coords.x(this.config.width),e.Coords.y(this.config.height)),h.endFill(),n.image=h,n.icon=this.getIcon(r.getModeById(a.gameMode)),n.label=r.getModeById(a.gameMode),o.call(this,n),e.Platform.isMobile()&&(this.config.generalFontSize+=2,this.config.generalFontMargin*=1),this.gameModeFontStyle={font:"Bold "+e.ScreenMetrics.getResScale()*this.config.generalFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},this.icon.anchor.set(0,.5),this.label.anchor.set(0,.4),this.icon.x=e.Coords.x(this.config.padding+this.config.titleHorizontalPadding),this.label.x=this.icon.x+this.icon.width+e.Coords.x(this.config.titleHorizontalPadding),this.icon.y=this.label.y=e.Coords.y(this.config.padding+this.icon.height/2);var u=new t.Graphics,d=e.Coords.x(this.config.width-2*this.config.padding);if(u.moveTo(0,0),u.lineStyle(e.Coords.x(this.config.lineWidth),16777215,1),u.lineTo(d,0),u.x=(this.width-d)/2,u.y=e.Coords.y(this.config.padding+this.icon.height+this.config.padding),this.addChild(u),a.StatKey){var c=new t.Text(i("stats.mode."+a.StatKey.Key),this.gameModeFontStyle);c.position.set(e.Coords.x(this.config.width-this.config.padding),this.icon.y),c.anchor.set(1,.4),e.StringManager.shrinkToFit(c,this.config.generalFontSize,"",e.Coords.x(.4*this.config.width)),this.addChild(c)}if(this.statsList=new t.DisplayObjectContainer,this.statsList.x=0,this.statsList.y=u.y+e.Coords.y(this.config.padding),this.hasMoreInfo){var p=e.Coords.x(this.config.buttonWidth+2*this.config.buttonPadding),g=e.Coords.y(this.config.generalFontSize+2*this.config.buttonPadding),f={font:e.ScreenMetrics.getResScale()*this.config.generalFontSize+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",tint:16777215,align:"left"},y=new t.DisplayObjectContainer;y.position.set(e.Coords.x(this.config.width-this.config.padding)-p,e.Coords.y(this.config.height-this.config.padding)-g);var m=new t.Text(i("buttons.seeMore"),f);m.position.set(p/2,g/2),m.anchor.set(.5,.4),e.StringManager.shrinkToFit(m,this.config.generalFontSize,"",p-e.Coords.x(2*this.config.padding)),y.addChild(m);var C=new t.Graphics;C.beginFill(16777215,0),C.lineStyle(e.Coords.x(this.config.lineWidth),16777215),C.drawRect(0,0,p,g),y.addChild(C),this.addChild(y)}},h.prototype.getIcon=function(t){return"mainmenu/icon_stats_"+t.toLowerCase()+".png"},h.prototype.showStats=function(){for(;this.statsList.children.length>0;)this.statsList.removeChildAt(0);var r=0,o=e.Coords.x(this.config.padding),a=e.Coords.x(this.config.width-this.config.padding);n.forEach(this.statsModel.getStats(),function(n){var s={font:e.ScreenMetrics.getResScale()*this.config.generalFontSize+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",tint:16777215,align:"left"},l={font:e.ScreenMetrics.getResScale()*this.config.generalFontSize+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",tint:16777215,align:"left"},h=new t.Text(i("stats.item."+n.stringKey),s);h.position.set(o,e.Coords.y(r)),e.StringManager.shrinkToFit(h,this.config.generalFontSize,"",e.Coords.x(this.config.width-2*this.config.padding*.7));var u=new t.Text(n.value,l);u.anchor.set(1,0),u.position.set(a,e.Coords.y(r)),e.StringManager.shrinkToFit(u,this.config.generalFontSize,"",e.Coords.x(this.config.width-2*this.config.padding*.3)),
this.statsList.addChild(h),this.statsList.addChild(u),r+=e.Coords.y(this.config.generalFontSize+this.config.generalFontMargin)},this),this.addChild(this.statsList)},h.prototype.handleClick=function(){this.menu.handleStatsTileClick(this.statsModel.gameMode)},h.prototype.onShow=function(){this.statsModel.updateStats(),this.showStats(),this.interactive=this.hasMoreInfo},h}),define("Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService",["lodash","pixi","absolute/storagemanager","Managers/ChallengeManager","Managers/ChallengeFactory","Solitaire/MvvmStructure/Service/ManifestService","Managers/StatManager"],function(t,e,i,n,r,o,a){"use strict";return{_storageKey:"DailyChallenges",_challengeCache:null,_dayCache:null,_isValid:!0,_defaultStats:{playedChallenges:0,completedChallenges:0,totalChallenges:0,coinsEarned:0,bonusEarned:0,totalCoins:0,daysCompleted:0,bronzeBadgesWon:0,silverBadgesWon:0,goldBadgesWon:0,diamondBadgesWon:0,perfectCompletions:0,klondikeChallenges:0,spiderChallenges:0,freecellChallenges:0,pyramidChallenges:0,tripeaksChallenges:0,easyChallenges:0,mediumChallenges:0,hardChallenges:0,expertChallenges:0},Initialize:function(t,e){this.GetChallengesForCurrentMonth(t,e)},IsValid:function(){return o.IsValid()},HasCache:function(){return null!=this._challengeCache||null!=i.fetch(this._storageKey)},BuildMonthYearString:function(t){var e=t.getMonth()+1;return(e<10?"0"+e:""+e)+t.getFullYear().toString().substring(2)},LoadJsonFromCDN:function(t,i,n){function r(){a.removeEventListener("loaded",r),a.removeEventListener("error",n),i(a.json)}function o(t){a.removeEventListener("loaded",r),a.removeEventListener("error",n),n()}var a=new e.JsonLoader(t,!0);a.addEventListener("loaded",r),a.addEventListener("error",o),a.load()},LoadDataFromCDN:function(t,e,i){var n=o.GetSettings("DailyChallenge",t);n&&n.Path?this.LoadJsonFromCDN(n.Path,e,i):i()},GetDataForMonth:function(t,e,n){var r=null;this._challengeCache&&this._challengeCache[t]?r=this._challengeCache[t]:(this._challengeCache=i.fetch(this._storageKey),this._challengeCache&&(r=this._challengeCache[t])),r?setTimeout(function(){e(r)},0):this.LoadDataFromCDN(t,function(n){this._challengeCache||(this.dataNotExists=!0,this._challengeCache={}),this._challengeCache[t]=n,i.store(this._storageKey,this._challengeCache),e(n)}.bind(this),function(){this._isValid=!1,n()}.bind(this))},GetChallengesData:function(){var e={};if(this._challengeCache){for(var i in this._challengeCache)if(this._challengeCache.hasOwnProperty(i)&&-1===i.indexOf("Settings")){var n=i.split("MonthChallenges")[1],r=n.substr(0,2),o=n.substr(2,2);e[o]=e[o]||{},e[o][r]=this.GetChallengeStatsForMonth(r.toString()+o.toString())}}else{var a=new Date,r=a.getMonth()+1,s=r<10?"0"+r:""+r,o=a.getFullYear(),l=o.toString().substring(2);e[l]={},e[l][s]=t.extend({},this._defaultStats)}return e},GetChallengesForCurrentMonth:function(t,e){this.GetDataForMonth("MonthChallengeSettings"+this.BuildMonthYearString(new Date),function(){this.GetDataForMonth("MonthChallenges"+this.BuildMonthYearString(new Date),function(e){this._dayCache={},this.AddToDayCache(e),t(e)}.bind(this),e)}.bind(this),e)},SaveCurrentChallenges:function(){i.store(this._storageKey,this._challengeCache)},AddToDayCache:function(e){t.forEach(e.DailyChallenges,function(e){var i=e.Date;if(i){var r=i.substring(6,19),o=new Date(parseInt(r)),a=o.getUTCDate(),s=o.getUTCMonth()+1,l=o.getUTCFullYear(),h=(a<10?"0"+a:a)+(s<10?"0"+s:s)+l;this._dayCache[h]=e,t.forEach(e.Challenges,function(t){n.StoreChallenge(t)})}},this),n.Sync()},GetChallengeSettingsForCurrentMonth:function(t,e){this.GetChallengeSettingsForMonth(this.BuildMonthYearString(new Date),t,e)},GetChallengeSettingsForMonth:function(t,e,i){var n="MonthChallengeSettings"+t;this._challengeCache&&this._challengeCache[n]?e(this._challengeCache[n]):this.GetChallengesForCurrentMonth(function(){e(this._challengeCache[n])}.bind(this),function(){i()})},GetChallengeStatsForCurrentMonth:function(){return this.GetChallengeStatsForMonth(this.BuildMonthYearString(new Date))},GetChallengeStatsForMonth:function(e){var i=t.extend({},this._defaultStats),r=this.BuildMonthYearString(new Date),o=this._challengeCache["MonthChallenges"+e],a=this._challengeCache["MonthChallengeSettings"+e];return o&&a&&(t.forEach(o.DailyChallenges,function(o){var a=!0;t.forEach(o.Challenges,function(t){var o=n.GetChallengeConfig(t.Key);if(i.totalChallenges++,i.totalCoins+=o.Coins,o)if(o.Played&&i.playedChallenges++,o.Completed)if(i.completedChallenges++,i.coinsEarned+=o.Coins,e===r){switch(o.Data.GameMode){case"Klondike":i.klondikeChallenges++;break;case"Spider":i.spiderChallenges++;break;case"FreeCell":i.freecellChallenges++;break;case"Pyramid":i.pyramidChallenges++;break;case"TriPeaks":i.tripeaksChallenges++}switch(o.Difficulty){case 1:i.easyChallenges++;break;case 2:i.mediumChallenges++;break;case 3:i.hardChallenges++;break;case 4:i.expertChallenges++}}else i.klondikeChallenges=0,i.spiderChallenges=0,i.freecellChallenges=0,i.pyramidChallenges=0,i.tripeaksChallenges=0,i.easyChallenges=0,i.mediumChallenges=0,i.hardChallenges=0,i.expertChallenges=0;else a=!1}),a&&(i.daysCompleted++,i.coinsEarned+=o.DayBonusCoins),i.totalCoins+=o.DayBonusCoins}),i.coinsEarned>=a.Badges[0].CoinsNeeded&&(i.bronzeBadgesWon++,i.coinsEarned>=a.Badges[1].CoinsNeeded&&(i.silverBadgesWon++,i.coinsEarned>=a.Badges[2].CoinsNeeded&&(i.goldBadgesWon++,i.coinsEarned>=a.DiamondBadge.CoinsNeeded&&i.diamondBadgesWon++)))),i},UpdateGlobalChallengeStats:function(){if(this._challengeCache){var t=this.GetGlobalChallengeStats();a.SetStatistic("DCGlobalPlayedChallenges",t.playedChallenges),a.SetStatistic("DCGlobalCompletedChallenges",t.completedChallenges),a.SetStatistic("DCGlobalDaysCompleted",t.daysCompleted),a.SetStatistic("DCGlobalBronzeBadgesWon",t.bronzeBadgesWon),a.SetStatistic("DCGlobalSilverBadgesWon",t.silverBadgesWon),a.SetStatistic("DCGlobalGoldBadgesWon",t.goldBadgesWon),a.SetStatistic("DCGlobalDiamondBadgesWon",t.diamondBadgesWon),a.SetStatistic("DCGlobalPerfectCompletions",t.perfectCompletions),a.Save()}},GetGlobalChallengeStats:function(){var e=t.extend({},this._defaultStats),i=t.extend({},this._defaultStats);return this._challengeCache&&t.forEach(this._challengeCache,function(t,n){0==n.indexOf("MonthChallenges")&&(i=this.GetChallengeStatsForMonth(n.substring("MonthsChallenges".length-1)),e.playedChallenges+=i.playedChallenges,e.completedChallenges+=i.completedChallenges,e.totalChallenges+=i.totalChallenges,e.coinsEarned+=i.coinsEarned,e.totalCoins+=i.totalCoins,e.daysCompleted+=i.daysCompleted,e.bronzeBadgesWon+=i.bronzeBadgesWon,e.silverBadgesWon+=i.silverBadgesWon,e.goldBadgesWon+=i.goldBadgesWon,e.diamondBadgesWon+=i.diamondBadgesWon,e.klondikeChallenges+=i.klondikeChallenges,e.spiderChallenges+=i.spiderChallenges,e.freecellChallenges+=i.freecellChallenges,e.pyramidChallenges+=i.pyramidChallenges,e.tripeaksChallenges+=i.tripeaksChallenges,e.easyChallenges+=i.easyChallenges,e.mediumChallenges+=i.mediumChallenges,e.hardChallenges+=i.hardChallenges,e.expertChallenges+=i.expertChallenges,e.perfectCompletions+=i.coinsEarned===i.totalCoins?1:0)},this),e},GetDateIndex:function(t){var e=t.getDate(),i=t.getMonth()+1,n=t.getFullYear();return(e<10?"0"+e:e)+(i<10?"0"+i:i)+n},GetCompletedChallengeCountForDate:function(e){var i=this.GetDateIndex(e),r=this._dayCache[i],o=0;return r&&t.forEach(r.Challenges,function(t){var e=n.GetChallengeConfig(t.Key);e&&e.Completed&&o++}),o},CreateDailyChallenges:function(e){var i=e.getDate(),o=e.getMonth()+1,a=e.getFullYear(),s=(i<10?"0"+i:i)+(o<10?"0"+o:o)+a,l=this._dayCache[s],h=null,u=[];return l&&t.forEach(l.Challenges,function(t){h=r.BuildChallengeObject(n.GetChallengeConfig(t.Key)),h.dailyBonus=l.DayBonusCoins,h&&u.push(h)},this),u}}}),define("MenuUI/BadgeEarnedDialog",["pixi","absolute","absolute/stringmanager","absolute/assetmap","MenuUI/MsftButton","lodash","MenuUI/ControlFocusManager","util/CustomWordWrapper","Managers/ScaleManager","Arkadium/GameEngine/Core/EngineManagers"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t,e,i){this.initBadgeEarnedDialog(t,e,i)};return u.isFirst=!0,u.prototype=Object.create(e.Dialog.prototype),u.prototype.initBadgeEarnedDialog=function(t,i,r){this.ui=t,this.game=i,this.options=r,this.options.width=r.width||e.Coords.x(1265),this.options.height=r.height||e.Coords.y(757),this.options.content=this.initContent(),this.options.displayCloseButton=!1,this.options.backgroundAlpha=.7,this.buttonLetterStyle={font:33*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},this.buttonThreeSlice={multistate:!0,images:{left:n("buttonThreeSliceBlack.left"),center:n("buttonThreeSliceBlack.center"),right:n("buttonThreeSliceBlack.right")}},e.Dialog.call(this,t,this.options),this.options.tween.type="tweenIn",this.controlFocusManager=new a,this.buildButtons(),this.handleResize()},u.prototype.initContent=function(){var t;return this.options.isDCFirstCompleteDialog&&(t="dailychallenge/coin-flip-solitiare_05.png"),this.contentContainer=e.UIBuilder.buildLayout(this.options.dialog,this,this,this.options.width,this.options.height,t),"function"==typeof this.options.contentInitialized&&this.options.contentInitialized.call(this),this.contentContainer},u.prototype.cleanUp=function(){e.SpriteUtils.destroyAllChildren(this),this.destroy(!0)},u.prototype.buildButtons=function(){var t=[{text:this.options.buttonText||i("buttons.close"),threeSlice:this.buttonThreeSlice,width:180,height:36,position:{x:this.options.buttonX||1050,y:this.options.buttonY||650},action:function(){this.close(),this.options.closeHandler()}.bind(this)}];this.addButtons(t)},u.prototype.close=function(){e.Dialog.prototype.close.call(this),l.removeElement(this)},u.prototype.tweenIn=function(){this.handleResize(),e.Dialog.prototype.tweenIn.call(this)},u.prototype.addButtons=function(i){this.buttonContainer=new t.DisplayObjectContainer,o.each(i,function(t){var t,i=o.extend(t,{letterStyle:this.buttonLetterStyle});i.width=e.Coords.x(i.width),i.height=e.Coords.x(i.height),t=new r(i),t.x=e.Coords.x(i.position.x),t.y=e.Coords.x(i.position.y),this.buttonContainer.addChild(t),this.controlFocusManager.addControl(t,!0)},this),this.addChild(this.buttonContainer)},u.prototype._createBackground=function(){var e=new t.Graphics;e.beginFill(0,1),e.drawRect(0,0,this.options.width,this.options.height),e.endFill(),this.addChildAt(e,0)},u.prototype.setText=function(t,n){var r=e.UIBuilder.findWidget(t,this.contentContainer);r.setText(n),r.style.wordWrap&&s.doTextCustomWrap(r,i.extractNumbersFromString(r.style.font),"",r.style.wordWrapWidth,e.Coords.y(110))},u.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},u.prototype.onShow=function(){e.Dialog.prototype.onShow.call(this),this.controlFocusManager.focusNextControl(1),this.initForceScaleSprite(),l.addElement(this,{scaleChangeSource:"Full"}),this.handleResize()},u.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(10),this.forceOffsetY=e.Coords.y(10),this.forceScaleSprite.width=this.options.width+e.Coords.x(15),this.forceScaleSprite.height=this.options.height+e.Coords.y(15),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},u.prototype.handleResize=function(){this.parent&&this.updateTransform(),this.initForceScaleSprite();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/l.width,a=e.Coords.y(1080)/l.height,s=l.width,h=l.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>s){this.width=e.Coords.x(1920);var f=s/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>s){this.width=e.Coords.x(1920);var f=s/c;this.height=r*a*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY},u}),define("MenuUI/DailyChallengeProgressMeter",["pixi","absolute","absolute/storagemanager","lodash","tween","MenuUI/DropShadow","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","absolute/particleemitter","MenuUI/BadgeEarnedDialog","util/SettingsManager","MenuUI/MsftButton","absolute/stringmanager","Managers/TelemetryManager","util/NineSliceButton"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){var g=function(t,i,r){const o=t.scale||1;var a={scale:1,width:1823,height:300,padding:20,spacing:20,textSpacing:10,badgeSize:60,progressBarHeight:40,primaryFontSize:34,secondaryFontSize:24,possibleCoins:1e4,month:"",letterStyle1:{font:24*e.ScreenMetrics.getResScale()*o+"px Segoe UI",fontFamily:"segoe",fill:"#749dd2",tint:7642578,align:"left"},letterStyle2:{font:34*e.ScreenMetrics.getResScale()*o+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},letterStyle3:{font:24*e.ScreenMetrics.getResScale()*o+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"}};this.initDailyChallengeProgressMeter(n.extend(a,t),i,r)};return g.prototype=Object.create(t.DisplayObjectContainer.prototype),g.prototype.initDailyChallengeProgressMeter=function(i,n,r){t.DisplayObjectContainer.call(this),this.controls=[],this.config=i,this.config.height*=this.config.scale,this.config.textSpacing*=this.config.scale,this.config.progressBarHeight*=this.config.scale,this.dailyChallengeMenu=n,this.ui=r,this.medalsData=[{id:"Bronze",texture:"DC_goal_meter_bronze.png"},{id:"Silver",texture:"DC_goal_meter_silver.png"},{id:"Gold",texture:"DC_goal_meter_gold.png"},{id:"Diamond",texture:"DC_goal_meter_diamond.png"}];var a=new o({baseWidth:e.Coords.x(this.config.width),baseHeight:e.Coords.y(this.config.height)}),s=new t.Graphics;s.beginFill(1063277),s.drawRect(0,0,e.Coords.x(this.config.width),e.Coords.y(this.config.height)),s.endFill(),this.movieClips=[],this.tweens=[],this.particleLayer=new t.DisplayObjectContainer,this.movieClipLayer=new t.DisplayObjectContainer,this.addChild(a),this.addChild(s),this.updateStats(),this.buildProgressBar(),this.buildMedals(),this.buildLabels()},g.prototype.getControls=function(){return this.controls.sort(function(t,e){return t.x-e.x})},g.prototype.buildProgressBar=function(){this.progressBar=new t.DisplayObjectContainer;const i=t.Sprite.fromFrame("dailychallenge/DC_goal_meter_empty.png");i.y=e.Coords.y(this.config.padding+this.config.badgeSize),this.progressBar.addChild(i),this.barFillWidth=i.width-e.Coords.x(8);const n=new t.Texture.fromFrame("dailychallenge/DC_goal_meter_fill.png"),r=new t.DisplayObjectContainer,o=t.Sprite.fromFrame("dailychallenge/DC_goal_meter_fill_endcap.png");r.addChild(o);const a=t.Sprite.fromFrame("dailychallenge/DC_goal_meter_fill_endcap.png");a.scale.x=-1,r.addChild(a);const s=new t.TilingSprite(n,this.barFillWidth-o.width-a.width,n.height);s.x=o.width,a.x=o.width+s.width-a.width,r.addChild(s),this.barFill=new t.Sprite(r.generateTexture()),this.barFill.x=e.Coords.x(4),this.barFill.y=i.y+e.Coords.x(4);const l=new t.Graphics;this.barFillMaskOffset=-this.barFill.width,l.beginFill(0,.5),l.drawRect(0,0,this.barFill.width,s.height),l.endFill(),l.x=this.barFillMaskOffset,this.barFill.mask=l,this.barFill.addChild(l),this.progressBar.addChild(this.barFill),this.barPip=t.Sprite.fromFrame("dailychallenge/DC_goal_meter_playerpip.png"),this.barPip.y=i.y-e.Coords.x(15),this.barPip.scale.x=this.config.scale,this.barPip.anchor.x=.5,this.focusSetter(this.barPip),this.barPip.infoBox=this.getInfoBox(),this.barPip.addChild(this.barPip.infoBox),this.bindInteraction(this.barPip,function(){this.barPip.infoBox.openBox(this.config)}.bind(this)),this.progressBar.addChild(this.barPip),this.progressBar.x=e.Coords.x(47),this.progressBar.y=e.Coords.y(this.config.padding),this.progressBar.scale.y=this.config.scale,this.addChild(this.progressBar),this.controls.push(this.barPip)},g.prototype.getInfoBox=function(i,o,a){var s,l=new t.DisplayObjectContainer,h=new t.Graphics,u=e.Coords.x(30),c=t.Sprite.fromFrame("DC_kickoff_coin.png"),p=new t.Text("x",this.config.letterStyle1);return c.scale.set(.6,.6),p.anchor.set(.5,.5),i&&o?(s=new t.Text(i+" "+e.StringManager("DailyChallenge.needed"),n.cloneDeep(a)),d.shrinkToFit(s,d.extractNumbersFromString(a.font),"",200*e.ScreenMetrics.getResScale())):s=i?new t.Text(this.stats.coinsEarned.toString()+" / "+i,n.cloneDeep(this.config.letterStyle1)):new t.Text(this.stats.coinsEarned.toString(),n.cloneDeep(this.config.letterStyle1)),h.beginFill(0),h.lineStyle(1,16777215,1),h.drawRect(0,0,e.Coords.x(300+(this.config.scale-1)/3*300),e.Coords.x(80)),h.endFill(),c.x=u,c.y=(h.height-c.height)/2,p.x=c.x+c.width+p.width/2+e.Coords.x(10),p.y=c.y+c.height/2+e.Coords.y(2),s.x=p.x+p.width/2+e.Coords.x(10),s.y=p.y-s.height/2+e.Coords.y(2),o||l.addChild(h),l.addChild(c),l.addChild(p),l.addChild(s),l.visible=!1,l.y=-l.height,l.icon=c,l.coinCount=s,l.multiply=p,l.background=h,l.openBox=function(t){if(l.visible=!l.visible,l.visible){l.x=50,l.updateTransform();var i=0;l.worldTransform.tx>t.width/2&&(i=-t.width/20,l.worldTransform.tx>3*t.width/4&&(i=-t.width/15));var n=e.Coords.x(50)+i;new r.Tween({x:n}).easing(r.Easing.Cubic.InOut).to({x:i},500).onUpdate(function(){l.x=this.x,l.updateTransform()}).start(),window.setTimeout(function(){l.visible=!1},3e3)}},l},g.prototype.buildMedals=function(){this.medalReferences={},n.each(this.medalsData,function(i){var n=t.Sprite.fromFrame(i.texture),r=t.Sprite.fromFrame("dailychallenge/DC_goal_meter_medalnest.png"),o=new t.DisplayObjectContainer;n.x=(r.width-n.width)/2,n.y=e.Coords.y(6),o.addChild(r),o.addChild(n),i.sprite=new t.Sprite(o.generateTexture()),i.sprite.anchor.x=.5,i.sprite.x=i.coinsNeeded/this.totalPossibleCoins*this.barFillWidth,i.sprite.alpha=.6,i.infoBox=this.getInfoBox(i.coinsNeeded.toString()),i.sprite.addChild(i.infoBox),this.bindInteraction(i.sprite,function(){g.lastInfoBox&&(g.lastInfoBox.visible=!1),g.lastInfoBox=i.infoBox,e.AudioManager.playSound("button");var t=!1;i.infoBox.openBox(this.config),i.infoBox.visible&&(.6===i.sprite.alpha&&(i.sprite.alpha=1,t=!0),i.sprite.interactive=!1,window.setTimeout(function(){i.sprite.interactive=!0,t&&(i.sprite.alpha=.6)},3e3))}),i.sprite.scale.x=this.config.scale,this.progressBar.addChild(i.sprite),this.controls.push(i.sprite),this.focusSetter(i.sprite),this.medalReferences[i.id]=i},this),this.progressBar.addChild(this.barPip)},g.prototype.focusSetter=function(t){Object.defineProperty(t,"focus",{get:function(){return t._hasFocus}.bind(this),set:function(e){return t._hasFocus=e,this._focusChanged(t),e}.bind(this)})},g.prototype.updateProgress=function(i){var n=this.stats.coinsEarned/this.totalPossibleCoins*this.barFillWidth,o=this.barFillMaskOffset+n,a=this.barFill.x+n,u=this;if(this.stats.coinsEarned_dirty&&i){var c=[t.Texture.fromFrame("Star.png"),t.Texture.fromFrame("Star_orng_dot.png"),t.Texture.fromFrame("Star_pink_dot.png"),t.Texture.fromFrame("Star_teal_dot.png"),t.Texture.fromFrame("Star_yellow_dot.png")],p={rate:{numpan:{a:2,b:4,center:!0},timepan:{a:.01,b:.002,center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.1,.2,.5],alpha:{a:.5,b:0},scale:{a:[.15,.15,.05],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,crossZone:null,randomDrift:null},f=new s(this.ui,c,p),y=t.Sprite.fromFrame("ball.png");y.anchor.x=1,y.anchor.y=.5,y.y=f.y=this.barPip.y+e.Coords.x(15)*this.config.scale,y.x=this.barPip.x,f.x=this.barPip.x,f.alpha=y.alpha=0,this.particleLayer.addChild(f),this.particleLayer.addChild(y),this.showDCFirstCompleteDialog(),this.animateCoins(i,function(){var t=new r.Tween({x:this.barFill.mask.x,pipX:this.barPip.x,coins:this.stats.coinsEarned_old}).delay(100).easing(r.Easing.Cubic.In).to({x:o,pipX:a,coins:this.stats.coinsEarned},500).onStart(function(){e.AudioManager.playSound("CoinProgress_A")}).onUpdate(function(){u.barFill.mask.x=this.x,u.barPip.x=this.pipX,u.coinsValue.setText(Math.round(this.coins).toString())}).onComplete(function(){u.checkForMedalsEarned(!0,function(){if(u.triggerBonus&&h.getSetting("general","showDayBonusFUE")){var t=new l(u.ui,u.parent.game,{dialog:"MoreCoinsDialog",offsetX:e.Coords.x(10),offsetY:e.Coords.y(10),closeHandler:function(){u.stats.coinsEarned_dirty=!0,u.stats.coinsEarned_old=u.stats.coinsEarned,u.stats.coinsEarned+=u.stats[u.currentDate+"_bonus"],u.stats[u.currentDate+"_challengesComplete_dirty"]=!1,window.setTimeout(function(){u.updateProgress(u.dailyChallengeMenu.challengeTiles)},100)}.bind(u)});t.addButtons([{text:d("DailyChallenge.calendar"),threeSlice:t.buttonThreeSlice,width:180,height:36,position:{x:850,y:650},action:function(){t.close(),u.dailyChallengeMenu.tabSelected(u.dailyChallengeMenu.tabs[1])}.bind(this)}]);new l(u.ui,u.parent.game,{offsetX:e.Coords.x(10),offsetY:e.Coords.y(10),dialog:"BonusEarnedDialog",closeHandler:function(){setTimeout(function(){t.open()},0)}.bind(u)}).open(),h.setSetting("general","showDayBonusFUE",!1),u.triggerBonus=!1}else if(u.triggerBonus)u.triggerBonus=!1,u.stats.coinsEarned_dirty=!0,u.stats.coinsEarned_old=u.stats.coinsEarned,u.stats.coinsEarned+=u.stats[u.currentDate+"_bonus"],u.stats[u.currentDate+"_challengesComplete_dirty"]=!1,e.AudioManager.playSound("dc_coinsToBar"),u.updateProgress(u.dailyChallengeMenu.challengeTiles);else if(u.stats.perfectMonth){var i=new l(u.ui,u.parent.game,{offsetX:e.Coords.x(10),offsetY:e.Coords.y(10),dialog:"PerfectEarnedDialog",closeHandler:function(){}});i.open()}})}),i=new r.Tween({alpha:0,x:f.x+e.Coords.x(50)}).delay(100).easing(r.Easing.Circular.Out).to({alpha:[0,0,0,1,1,1,0],x:f.x-e.Coords.x(110)},5500).onStart(function(){f.start(),t.start(),window.setTimeout(function(){f.stop()},600)}).onUpdate(function(){f.alpha=this.alpha,f.x=this.x}).onComplete(function(){try{u.progressBar.removeChild(f),u.progressBar.removeChild(y)}catch(t){}f.destroy(),f=null}).start(),n=new r.Tween({alpha:0,scaleX:0,scaleY:0,x:y.x}).delay(400).easing(r.Easing.Cubic.Out).to({alpha:[.1,0,.2,0],scaleX:[1.3,.75],scaleY:[.75,.5],x:y.x+e.Coords.x(70)},1800).onStart(function(){}).onUpdate(function(){y.scale.x=this.scaleX,y.scale.y=this.scaleY,y.alpha=this.alpha}).start();this.tweens.push(t),this.tweens.push(i),this.tweens.push(n)}.bind(this)),this.stats.coinsEarned_dirty=!1}else this.coinsValue.setText(this.stats.coinsEarned.toString()),this.barFill.mask.x=o,this.barPip.x=a,this.checkForMedalsEarned(!1);this.daysRemainingValue.setText(g.getDaysRemaining().toString()),this.challengesCompleteValue.setText(this.stats.completedChallenges.toString()+" / "+this.stats.totalChallenges.toString()),this.barPip.infoBox.coinCount.setText(this.stats.coinsEarned.toString())},g.prototype.showDCFirstCompleteDialog=function(){i.fetch("dCFirstCompleteFUESeen")||new l(this.ui,this.dailyChallengeMenu.game,{offsetX:e.Coords.x(10),offsetY:e.Coords.y(10),dialog:"DCFirstCompleteDialog",closeHandler:function(){i.store("dCFirstCompleteFUESeen",!0)}.bind(this),isDCFirstCompleteDialog:!0}).open()},g.prototype.sendBadgeAwardedTelemetry=function(t){a.UpdateGlobalChallengeStats();var e=a.GetGlobalChallengeStats(),i=new Date;c.badgeAwarded(t.id,i.getMonth()+1,i.getFullYear(),e.bronzeBadgesWon,e.silverBadgesWon,e.goldBadgesWon,e.diamondBadgesWon,e.perfectCompletions,e.klondikeChallenges,e.spiderChallenges,e.freecellChallenges,e.pyramidChallenges,e.tripeaksChallenges,e.easyChallenges,e.mediumChallenges,e.hardChallenges,e.expertChallenges)},g.prototype.checkForMedalsEarned=function(i,o){var a=!1;n.each(this.medalsData,function(n){if(this.stats.coinsEarned>=n.coinsNeeded)if(n.infoBox.coinCount.setText(e.StringManager("DailyChallenge."+n.id+"Earned")),n.infoBox.coinCount.updateText(),d.shrinkToFit(n.infoBox.coinCount,d.extractNumbersFromString(this.config.letterStyle1.font),"",270*e.ScreenMetrics.getResScale()),n.infoBox.coinCount.x=(n.infoBox.background.width-n.infoBox.coinCount.width)/2,n.infoBox.icon.visible=!1,n.infoBox.multiply.visible=!1,n.earned||this.sendBadgeAwardedTelemetry(n),!n.earned&&i){a=!0,n.earned=!0;var h=[t.Texture.fromFrame("Star.png"),t.Texture.fromFrame("Star_orng_dot.png"),t.Texture.fromFrame("Star_pink_dot.png"),t.Texture.fromFrame("Star_teal_dot.png"),t.Texture.fromFrame("Star_yellow_dot.png")],u={numpan:{a:5,b:8,center:!0},timepan:{a:.008,b:.015,center:null}},c={a:[.5,.2,.2,.2],b:0,center:null},p={numpan:{a:50,b:100,center:null},timepan:{a:.1,b:.2,center:null}},g=[4,3,2,1],f={a:.5,b:0},y={a:[5,10,15,20,25,30,35,40,45],b:[0,3],style:"add"},m={a:0,b:1,center:null},C=new s(this.ui,h,{rate:u,mass:1,rotation:y,velocity:.65,alpha:f,scale:c,gravity:0,life:m,radius:1,parent:this.particleLayer,crossZone:null,randomDrift:null}),S=new s(this.ui,h,{rate:p,mass:1,rotation:y,velocity:g,alpha:f,scale:c,gravity:2,life:m,radius:1,parent:this.particleLayer,crossZone:null,randomDrift:null}),b=this,v=n.sprite.x,w=n.sprite.y+e.Coords.y(40),x=e.Coords.x(120),T=v+1*x,M=v-0*x,_=v-3.5*x,P=v,A=v+3*x,k=v,D=v-1.75*x,F=v-x/2,E=w-0*x,I=w-3.3*x,G=w,O=w+3.5*x,B=w,L=w-3*x,R=w,N=w+x/2,U=t.Sprite.fromFrame("ball.png");this.progressBar.addChild(C),this.progressBar.addChild(S),this.progressBar.addChild(U),U.alpha=0,C.start(),C.x=T,C.y=E,S.x=v,S.y=w,U.anchor.x=U.anchor.y=.5,U.x=v,U.y=w;var V=new r.Tween({x:T,y:E}).easing(r.Easing.Cubic.In).to({x:[M,_,P,A,k,D,F,v],y:[I,G,O,B,L,R,N,w]},1700).onUpdate(function(){C.x=this.x,C.y=this.y}).onComplete(function(){window.setTimeout(function(){S.emitOnce()},500),C.stop()}).interpolation(r.Interpolation.Bezier).start(),H=new r.Tween({alpha:1,scale:0}).delay(50).easing(r.Easing.Exponential.Out).to({alpha:[1,1,0],scale:1.5},800).onStart(function(){window.setTimeout(function(){n.sprite.alpha=1},400)}).onUpdate(function(){U.scale.x=U.scale.y=this.scale,U.alpha=this.alpha}).onComplete(function(){new l(b.ui,b.parent.game,{offsetX:e.Coords.x(10),offsetY:e.Coords.y(10),dialog:n.id+"EarnedDialog",closeHandler:function(){"function"==typeof o&&o()}}).open(),window.setTimeout(function(){try{b.parent.removeChild(C)}catch(t){}C.destroy(),C=null}.bind(this),1500)});V.chain(H),this.tweens.push(V),this.tweens.push(H)}else n.sprite.alpha=1,n.earned=!0;else n.infoBox.coinCount.setText(this.stats.coinsEarned.toString()+" / "+n.coinsNeeded.toString())},this),!a&&"function"==typeof o&&i&&o()},g.prototype.animateCoins=function(i,o){function a(t,e,i,n){new r.Tween({alpha:t.alpha}).delay(e||0).easing(r.Easing.Cubic.Out).to({alpha:0},1e3).onUpdate(function(){t.alpha=this.alpha}).onComplete(function(){"function"==typeof i&&i()}).start()}if(!this.coinGlow){this.coinGlow=new t.DisplayObjectContainer;var s=t.Sprite.fromFrame("glow.png"),l=t.Sprite.fromFrame("glow.png");l.anchor.y=1,l.scale.y=-1,l.y=e.Coords.y(165),this.coinGlow.addChild(s),this.coinGlow.addChild(l),this.coinGlow.scale.x=this.coinGlow.scale.y=.5,this.coinGlow.alpha=.1,this.progressBar.addChild(this.coinGlow),this.starBurstEndClip=e.SpriteUtils.loadMovieClip("coin_particles/coin_particles_",20,1),this.starBurstEndClip.anchor.x=this.starBurstEndClip.anchor.y=.5,this.starBurstEndClip.animationSpeed=.5,this.dailyChallengeMenu.menuContainer.addChild(this.starBurstEndClip)}var h=0,u=this.progressBar.x+this.barPip.x,d=this.dailyChallengeMenu.progressMeter.y+this.barPip.y+this.barPip.height,c=this,p=new r.Tween({alpha:0}).easing(r.Easing.Sinusoidal.InOut).to({alpha:.2},10).onUpdate(function(){c.coinGlow.alpha=this.alpha}).repeat(1/0).yoyo(!0);this.starBurstEndClip.visible=!1,this.starBurstEndClip.loop=!0,this.starBurstEndClip.x=u,this.starBurstEndClip.y=d,this.coinGlow.x=this.barPip.x-e.Coords.y(53),this.coinGlow.y=this.barPip.y-e.Coords.y(82),this.coinGlow.visible=!1,n.each(i,function(t){var s=t.x+t.width/2+this.dailyChallengeMenu.lobbyMenu.x,l=t.y+t.height/2+this.dailyChallengeMenu.lobbyMenu.y,g=0,f=[],y=e.SpriteUtils.loadMovieClip("coin_particles/coin_particles_",20,1);this.triggerBonus&&i.length>1&&t.addRibbon(function(){}),n.times(15,function(){var t=e.SpriteUtils.loadMovieClip("dailychallenge/coin-flip-solitiare_",5,1);t.anchor.x=t.anchor.y=.5,t.animationSpeed=.25,t.gotoAndStop(0),f.push(t),this.movieClipLayer.addChild(t)},this),y.play(),y.anchor.x=y.anchor.y=.5,y.x=s,y.y=l,y.animationSpeed=.5,this.movieClipLayer.addChild(y),n.each(f,function(t,e){t.x=s,t.y=l,t.alpha=0;var n=new r.Tween({scale:.25,x:s,y:l}).delay(200*e).easing(r.Easing.Quadratic.InOut).to({x:u,y:d,scale:[1.5,.25]},1800).onStart(function(){t.gotoAndPlay(Math.round(4*Math.random())),t.alpha=1,e===f.length-1&&(y.visible=!1,y.gotoAndStop(0))}).onUpdate(function(){t.x=this.x,t.y=this.y,t.scale.x=t.scale.y=this.scale}).onComplete(function(){t.alpha=0,g++,1===g?(c.starBurstEndClip.visible=!0,c.starBurstEndClip.play(),c.coinGlow.visible=!0,p.start()):g>=f.length&&o&&++h>=i.length&&(p.stop(),a(c.starBurstEndClip,200,function(){c.starBurstEndClip.visible=!1,c.starBurstEndClip.gotoAndStop(0),c.starBurstEndClip.alpha=1},"star"),a(c.coinGlow,0,function(){c.coinGlow.visible=!1,o()},"coin"))}).interpolation(r.Interpolation.Bezier).start();this.tweens.push(n)},this)},this)},g.getDaysRemaining=function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,0).getDate()-t.getDate()},g.prototype.buildLabels=function(){const i=(e.Coords.x(15),new t.Text(e.StringManager("DailyChallenge.daysRemaining"),this.config.letterStyle1)),n=new t.Text(e.StringManager("DailyChallenge.coins"),this.config.letterStyle3),r=new t.Text(e.StringManager("DailyChallenge.challengesCompleted"),this.config.letterStyle3);"fr-CA"===e.StringManager.getUserLanguage()||"fr-FR"===e.StringManager.getUserLanguage()?(this.progressLabel=new t.Text(e.StringManager("DailyChallenge.progress")+" "+this.config.month.toLowerCase(),this.config.letterStyle2),this.daysRemainingValue=new t.Text(g.getDaysRemaining().toString(),this.config.letterStyle1)):(this.progressLabel=new t.Text(this.config.month+" "+e.StringManager("DailyChallenge.progress"),this.config.letterStyle2),this.daysRemainingValue=new t.Text(g.getDaysRemaining().toString(),this.config.letterStyle1)),this.coinsValue=new t.Text("0",this.config.letterStyle3),this.challengesCompleteValue=new t.Text("0",this.config.letterStyle3),i.x=this.progressLabel.x=r.x=e.Coords.x(2*this.config.padding),this.daysRemainingValue.x=i.x+i.width+e.Coords.x(this.config.textSpacing),this.daysRemainingValue.y=i.y=e.Coords.y(this.config.padding+this.config.spacing)+this.progressBar.height,this.progressLabel.y=e.Coords.y(this.config.height-this.config.padding-this.config.spacing)-this.challengesCompleteValue.height,this.progressLabel.anchor.y=1,this.challengesCompleteValue.y=r.y=e.Coords.y(this.config.height-this.config.padding),this.coinsValue.y=n.y=e.Coords.y(this.config.height-this.config.padding),this.challengesCompleteValue.anchor.y=r.anchor.y=this.coinsValue.anchor.y=n.anchor.y=1,this.challengesCompleteValue.x=r.x+r.width+e.Coords.x(this.config.textSpacing);var o={font:25*e.ScreenMetrics.getResScale()+"px Segoe UI",maxWidth:150*e.ScreenMetrics.getResScale(),fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(90),y:e.Coords.y(40)};this.awardsButton=new p("warning_dialogues/popup_button_Cancel_click.png","warning_dialogues/popup_button_Cancel_over.png","warning_dialogues/popup_button_Cancel.png",e.Coords.x(180),e.Coords.y(80),25,25,25,25,d("Awards"),o),this.awardsButton.position.x=e.Coords.x(this.config.width-this.config.padding)-this.awardsButton.width*this.config.scale,this.awardsButton.position.y=e.Coords.y(this.config.height-this.config.padding)-this.awardsButton.height*this.config.scale,this.awardsButton.onClick.add(function(){e.AudioManager.playSound("button"),this.dailyChallengeMenu.game.navAwards()}.bind(this)),this.awardsButton.scale.x=this.awardsButton.scale.y=this.config.scale,n.x=this.awardsButton.x-n.width-8*this.config.spacing,this.coinsValue.x=n.x+n.width+this.config.textSpacing,this.addChild(i),
this.addChild(this.daysRemainingValue),this.addChild(this.progressLabel),this.addChild(n),this.addChild(this.coinsValue),this.addChild(r),this.addChild(this.challengesCompleteValue),this.addChild(this.awardsButton),this.controls.push(this.awardsButton),this.focusSetter(this.awardsButton),this.bindInteraction(this.awardsButton,function(){e.AudioManager.playSound("button"),this.dailyChallengeMenu.game.navAwards()}.bind(this))},g.prototype.updateStats=function(t){a.GetChallengeSettingsForCurrentMonth(function(t){function e(e){return n.result(n.find(t.Badges,function(t){return t.Key===e}),"CoinsNeeded")}this.currentDate=a.GetDateIndex(this.dailyChallengeMenu.date),t.DiamondBadge&&t.Badges.push(t.DiamondBadge),this.totalPossibleCoins=t.MaximumCoins||34700,n.each(this.medalsData,function(t){t.coinsNeeded=e(t.id)},this);var i=a.GetChallengeStatsForCurrentMonth();if(i[this.currentDate+"_challengesComplete"]=a.GetCompletedChallengeCountForDate(this.dailyChallengeMenu.date)>=5,i.perfectMonth=i.coinsEarned===i.totalCoins,this.stats?n.each(i,function(t,e){this.stats[e+"_old"]=this.stats[e],this.stats[e+"_dirty"]=this.stats[e]!==t,this.stats[e]=t},this):this.stats=n.clone(i),this.triggerBonus=this.stats[this.currentDate+"_challengesComplete_dirty"]&&this.stats[this.currentDate+"_challengesComplete"]&&this.stats.coinsEarned_dirty,this.triggerBonus){var r=this.dailyChallengeMenu.challengeTiles[0].challenge.dailyBonus;this.stats[this.currentDate+"_bonus"]=r,this.stats.coinsEarned-=r}}.bind(this),function(){e.Debug.log("Error: GetChallengeSettingsForCurrentMonth()")})},g.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,e.Platform.supportsTouch()?(t.touchstart=i.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(t.mousedown=i.bind(this))):t.mousedown=i.bind(this),t.handleActivate=i.bind(this)},g.prototype.onShow=function(e){this.updateStats(e),this.particleLayer||(this.particleLayer=new t.DisplayObjectContainer,this.progressBar.addChild(this.particleLayer)),this.movieClipLayer||(this.movieClipLayer=new t.DisplayObjectContainer,this.dailyChallengeMenu.menuContainer.addChildAt(this.movieClipLayer,this.dailyChallengeMenu.menuContainer.children.length-1),this.dailyChallengeMenu.menuContainer.setChildIndex(this.movieClipLayer,this.dailyChallengeMenu.menuContainer.children.length-1)),this.dailyChallengeMenu.handleResize(),e&&this.updateProgress()},g.prototype.onHide=function(){var t=!1;this.particleLayer&&this.progressBar&&(this.progressBar.removeChild(this.particleLayer),this.particleLayer=null),this.movieClipLayer&&(this.dailyChallengeMenu.menuContainer.removeChild(this.movieClipLayer),this.movieClipLayer=null),this.starBurstEndClip&&(this.starBurstEndClip.visible=!1,this.starBurstEndClip.stop()),this.coinGlow&&(this.coinGlow.visible=!1),n.each(this.tweens,function(e){e.stop(),t=!0}),this.updateStats(),this.updateProgress(),this.tweens.length=0,r.removeAll(),setTimeout(function(){e.AudioManager.stopAll()},300)},g.prototype._focusChanged=function(i){if(i._hasFocus){i.focusIndicator=new t.Graphics,i.focusIndicator.lineStyle(e.Coords.x(3),16777215);var n=-i.width*i.anchor.x;i.focusIndicator.drawRect(n,0,i.width,i.height),i.addChild(i.focusIndicator)}else-1!==i.children.indexOf(i.focusIndicator)&&i.removeChild(i.focusIndicator)},g.prototype.onDateChange=function(i){this.daysRemainingValue.setText(g.getDaysRemaining().toString()),"fr-CA"===e.StringManager.getUserLanguage()||"fr-FR"===e.StringManager.getUserLanguage()?this.progressLabel=new t.Text(e.StringManager("DailyChallenge.progress")+" "+this.config.month.toLowerCase(),this.config.letterStyle2):this.progressLabel=new t.Text(this.config.month+" "+e.StringManager("DailyChallenge.progress"),this.config.letterStyle2)},g}),define("MenuUI/DailyChallengeMainMenuTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","MenuUI/DailyChallengeProgressMeter","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","util/NineSliceWrapper","MenuUI/DropShadow"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e){var n={};this.initDailyChallengeMainMenuTile(i.extend(n,t),e)};return h.prototype=Object.create(r.prototype),h.prototype.initDailyChallengeMainMenuTile=function(i,n){this.game=n,r.call(this,i);var o=new Date,a=e.Coords.x(120),s={font:"Bold "+28*e.ScreenMetrics.getResScale()+"px Segoe UI",tint:1,fill:"#000001",fontWeight:"400",fontFamily:"segoe",align:"left"},l=e.StringManager("months",null,!0),h=new t.Text(l[o.getMonth()].toUpperCase(),s),u=e.Coords.x(115),d={font:130*e.ScreenMetrics.getResScale()+"px Segoe UI",tint:1,fill:"#000001",fontFamily:"segoe",align:"left"},c=new t.Text(o.getDate().toString(),d),p=t.Sprite.fromFrame(i.sticker);p.position.set(e.Coords.x(20),e.Coords.y(7)),p.scale.set(.9,.9),h.x=a-h.width/2,h.y=e.Coords.y(53),c.x=u-c.width/2+e.Coords.x(10),c.y=e.Coords.y(65),h.rotation=-Math.PI/20,c.rotation=-Math.PI/20,this.sticker=p,this.dayLabel=c,this.monthLabel=h,this.buildHeader(),this.addChild(p),this.addChild(h),this.addChild(c),this.buildHoverGraphic(),this.initImageOutline(),this.positionTile(),this.buildDropShadow()},h.prototype.buildHeader=function(){this.initHeaderBackground(),this.initHeaderOutline(),this.initHeaderShadow(),this.initHeaderText(),this.initImageShadow()},h.prototype.initHeaderBackground=function(){var i=new t.Graphics;i.beginFill(2116239,1),i.drawRect(0,0,this.image.width,e.Coords.y(70)),i.endFill(),this.addChild(i),this.header=i},h.prototype.initHeaderOutline=function(){var i=new t.Graphics,n=e.Coords.x(1);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.moveTo(0,this.header.height),i.lineTo(this.header.width,this.header.height),i.endFill(),this.addChild(i)},h.prototype.initHeaderShadow=function(){var t=this.buildShadow(0,0,this.header.width/2,this.header.height,0),e=this.buildShadow(this.header.width,this.header.height,this.header.width/2,this.header.height,Math.PI);this.addChild(t),this.addChild(e)},h.prototype.initHeaderText=function(){var i={font:"bold "+40*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",align:"left",strokeThickness:2},n=new t.Text(e.StringManager("tiles.dailyChallenge").toUpperCase(),i);n.anchor.set(.5,.5),n.x=this.header.width/2,n.y=this.header.height/2+e.Coords.y(5),this.addChild(n)},h.prototype.initImageShadow=function(){var t=this.image.width/8,e=this.image.height+this.header.height,i=this.buildShadow(0,0,t,e,0),n=this.buildShadow(this.image.width,e,t,e,Math.PI);this.addChild(i),this.addChild(n)},h.prototype.buildShadow=function(t,e,i,n,r){var o=new s("mainmenu/shadow_stretch.png",i,n,5,2,5,5);return o.position.set(t,e),o.alpha=1,o.rotation=r,o},h.prototype.buildHoverGraphic=function(){var i=new t.Graphics,n=e.Coords.x(4);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.drawRect(0,0,this.header.width,this.header.height+this.image.height),i.endFill(),this.hover=i,this.hover.alpha=.01,this.addChild(this.hover)},h.prototype.initImageOutline=function(){var i=new t.Graphics,n=e.Coords.x(1);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.drawRect(0,0,this.image.width,this.image.height+this.header.height),i.endFill(),this.addChild(i),this.imageOutline=i},h.prototype.positionTile=function(){this.image.y=this.header.y+this.header.height,this.sticker.y=this.image.y+e.Coords.y(10),this.monthLabel.y=this.sticker.y+e.Coords.y(45),this.dayLabel.y=this.monthLabel.y+e.Coords.y(20)},h.prototype.buildDropShadow=function(){this.dropShadow&&this.removeChild(this.dropShadow),this.dropShadow=new l({baseWidth:this.image.width,baseHeight:this.image.height+this.header.height}),this.addChildAt(this.dropShadow,0)},h.prototype.updateStats=function(){a.GetChallengeSettingsForCurrentMonth(function(t){}.bind(this),function(){e.Debug.log("Error: GetChallengeSettingsForCurrentMonth()")})},h.prototype.onShow=function(){this.interactive=!0,a.HasCache()&&a.IsValid()&&this.updateStats()},h}),define("MenuUI/StarCountDisplay",["pixi","absolute","lodash"],function(t,e,i){var n=function(t,e,i){this.game=i,this._initStarCountDisplay(t,e)};return n.constructor=n,n.prototype=Object.create(t.DisplayObjectContainer.prototype),n.prototype._initStarCountDisplay=function(n,r){t.DisplayObjectContainer.call(this);var o={letterStyle:{font:32*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#fff12f",tint:16773423,align:"left"},width:e.Coords.x(150),height:e.Coords.x(66)},a=this.game.config.singleGame.enabled?"freecell/tile.png":"star_club/star_topbar_balance.png";this.starIcon=t.Sprite.fromFrame(a),this.options=i.extend(o,n),this.parent=r,this.options.hideBackground||this.addBackground(),this.starIcon.x=e.Coords.x(20),this.starIcon.y=e.Coords.y(15),this.addChild(this.starIcon),this.starCount=new t.Text("...",this.options.letterStyle),this.starCount.x=e.Coords.y(62),this.starCount.y=e.Coords.y(15),this.addChild(this.starCount),this.starClips=[],this.tweens=[],this.oldStars=this.stars=0,this.hoverGraphic=new t.Graphics;var s=e.Coords.x(2);this.hoverGraphic.beginFill(16777215,0),this.hoverGraphic.lineStyle(s,16777215,1),this.hoverGraphic.drawRect(0,0,this.width,this.height),this.hoverGraphic.endFill(),this.hover=this.hoverGraphic,this.hover.alpha=1,this.hover.visible=!1,this.addChild(this.hover)},n.prototype.addBackground=function(){var i=new t.Graphics,n=new t.Graphics,r=Math.ceil(e.Coords.x(1));i.beginFill(1,.3),i.drawRect(0,0,this.options.width,this.options.height),i.endFill(),n.lineStyle(r,16777215,.5),n.beginFill(16777215,0),n.drawRect(0,0,this.options.width-4*r,this.options.height-4*r),n.endFill(),n.x=2*r,n.y=2*r,i.hoverBox=this.options.hoverBox,this.addChild(i),this.addChild(n)},n.prototype.onShow=function(t,e){this.oldStars=this.stars,this.stars=t,e&&this.starCount.setText(t.toString())},n.prototype.onHide=function(){i.each(this.tweens,function(t){t.stop()}),this.tweens.length=0,TWEEN.removeAll(),i.each(this.starClips,function(t){t.visible=!1},this),this.starBurstClip&&(this.starBurstClip.stop(),this.starBurstClip.visible=!1),this.onShow(this.stars,!0)},n.prototype.triggerStarAnimation=function(t,n,r){n=!!n,0===this.starClips.length&&(i.times(8,function(){var t=e.SpriteUtils.loadMovieClip("star_club/stars-rotating/star-rotating_",9,1);t.anchor.x=t.anchor.y=.5,t.animationSpeed=.5,this.starClips.push(t),this.parent.addChild(t)},this),this.starBurstClip=e.SpriteUtils.loadMovieClip("star_club/stars-bursting/star-bursting-187x170_",30,1),this.starBurstClip.anchor.x=this.starBurstClip.anchor.y=.5,this.starBurstClip.x=this.x+e.Coords.x(50),this.starBurstClip.y=this.y+e.Coords.y(50),this.starBurstClip.loop=!1,this.starBurstClip.animationSpeed=.5,this.parent.addChild(this.starBurstClip));var o=0,a=this,s=new TWEEN.Tween({s:this.oldStars}).easing(TWEEN.Easing.Cubic.Out).to({s:this.stars},1500).onStart(function(){e.AudioManager.playSound("sc_starLand")}).onUpdate(function(){a.starCount.setText(Math.round(this.s).toString())});this.tweens.push(s),i.each(this.starClips,function(i,l){var h=t.worldTransform.tx+t.width/2,u=t.worldTransform.ty+t.height/2,d=this.x+e.Coords.x(50),c=this.y+e.Coords.y(50),p=1.2*c;if(n){var g=h,f=u;h=d,u=c,d=g,c=f}i.scale.x=i.scale.y=0,i.x=h,i.y=u,i.visible=!0;var y=new TWEEN.Tween({scale:0,x:h,y:u}).delay(100*l).easing(TWEEN.Easing.Quadratic.Out).to({scale:[1.5,.2],x:d,y:[p,c]},1800).onStart(function(){i.gotoAndPlay(0)}).onUpdate(function(){i.scale.x=i.scale.y=this.scale,i.x=this.x,i.y=this.y}).onComplete(function(){o++,i.scale.x=i.scale.y=0,1!==o||n||(a.starBurstClip.visible=!0,a.starBurstClip.gotoAndPlay(0),s.start()),1===o&&r&&r()}).interpolation(TWEEN.Interpolation.Bezier).start();this.tweens.push(y)},this)},n.prototype.handleActivate=function(){},n.prototype._focusChanged=function(){this.hover.visible=this._hasFocus},Object.defineProperty(n.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),n}),define("MenuUI/CustomButton",["pixi","absolute","lodash"],function(t,e,i){var n=function(t){this.initialize(t)};return n.constructor=n,n.prototype=Object.create(t.Sprite.prototype),n.prototype.initialize=function(i){this.options=i,this.container=new t.DisplayObjectContainer,this.upTexture=t.Texture.fromFrame(this.options.up),this.overTexture=t.Texture.fromFrame(this.options.over),this.downTexture=t.Texture.fromFrame(this.options.down),t.Sprite.call(this,this.upTexture),this.interactive=!0,this.buttonMode=!0,this._hasFocus=!1,this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(1,16777215);var n=e.Coords.x(2);this.focusIndicator.drawRect(n,n,this.width-2*n,this.height-2*n),e.Platform.supportsTouch()?(this.touchstart=function(t){this.setTexture(this.downTexture),this.options.action.down()},this.touchend=function(t){this.setTexture(this.upTexture),this.options.action.up(),this.handleAction()},this.touchendoutside=function(t){this.setTexture(this.upTexture),this.options.action.up()},(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},n.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.setTexture(this.overTexture)},this.mouseout=function(t){this.setTexture(this.upTexture),this.options.action.up()},this.mousedown=function(t){this.setTexture(this.downTexture),this.options.action.down()}.bind(this),this.mouseup=function(t){this.setTexture(this.upTexture),this.options.action.up(),this.handleAction()}.bind(this)},n.prototype.handleAction=function(){e.AudioManager.playSound("button")},n}),define("MenuUI/SideBar",["pixi","absolute","lodash","MenuUI/CustomButton","Managers/ScaleManager"],function(t,e,i,n,r){var o=function(t){this.handleGraphics=null,this.handleHeldGraphics=null,this.arrowHoldInterval=null,this.handleHoldInterval=null,this.arrowIsHeldDown=!1,this.handleIsHeldDown=!1,this.currentScrollPercent=0,this.arrowSize=e.Coords.y(20),this.handleHeight=null,this.partialHeight=t.partialHeight-2*this.arrowSize||100,this.availableHeight=t.availableHeight-2*this.arrowSize||200,this.visualHeight=t.visualHeight-2*this.arrowSize||300,this.initialize(t)};return o.constructor=o,o.prototype=Object.create(t.DisplayObjectContainer.prototype),o.prototype.initialize=function(e){t.DisplayObjectContainer.call(this),this.options=e,this.initBackground(),this.initButtons(),this.initSlider()},o.prototype.resetDimensions=function(t,e,i,n){this.partialHeight=t-2*this.arrowSize,this.availableHeight=e-2*this.arrowSize,this.visualHeight=n-2*this.arrowSize,this.resetBackground(),this.resetButtons(),this.resetSlider(),this.options.onScrollUpdate=i},o.prototype.setListenersForHandleInteraction=function(t,e){this.onHandleDown=t,this.onHandleUp=e},o.prototype.initButtons=function(){this.upButton=new n({up:"sidebar/arrow-up.png",over:"sidebar/arrow-over.png",down:"sidebar/arrow-down.png",action:{down:this.handleArrowTopDown.bind(this),up:this.handleArrowTopUp.bind(this)}}),this.downButton=new n({up:"sidebar/arrow-up.png",over:"sidebar/arrow-over.png",down:"sidebar/arrow-down.png",action:{down:this.handleArrowBottomDown.bind(this),up:this.handleArrowBottomUp.bind(this)}}),this.downButton.rotation=Math.PI,this.upButton.position.set(0,0),this.downButton.position.set(this.arrowSize,this.visualHeight+2*this.arrowSize),this.addChild(this.upButton),this.addChild(this.downButton)},o.prototype.resetBackground=function(){this.background.clear(),this.drawBackground()},o.prototype.resetButtons=function(){this.downButton.position.set(this.arrowSize,this.visualHeight+2*this.arrowSize)},o.prototype.resetSlider=function(){this.handleGraphics.clear(),this.handleHeldGraphics.clear(),this.drawHandleGraphics(),this.updateHandleByPercent(this.currentScrollPercent)},o.prototype.initBackground=function(){this.background=new t.Graphics,this.addChild(this.background),this.drawBackground()},o.prototype.initSlider=function(){this.handleGraphics=new t.Graphics,this.handleHeldGraphics=new t.Graphics,this.addChild(this.handleGraphics),this.handleGraphics.addChild(this.handleHeldGraphics),this.drawHandleGraphics(),this.updateHandleByPercent(this.currentScrollPercent)},o.prototype.drawBackground=function(){this.background.beginFill(0,1),this.background.drawRect(0,this.arrowSize,this.arrowSize,this.visualHeight),this.background.endFill(),this.background.interactive=!0,this.background.mousedown=function(t){var e=t.global.y<r.height*this.parent.scale.y/2;this.updateScrollPercent(e?0:100),this.updateHandleByPercent(e?0:100)}.bind(this),this.background.touchstart=function(t){var e=t.global.y<r.height*this.parent.scale.y/2;this.updateScrollPercent(e?0:100),this.updateHandleByPercent(e?0:100)}.bind(this)},o.prototype.drawHandleGraphics=function(){var t=100*this.availableHeight/this.partialHeight,i=this.visualHeight*t/100;this.handleHeight=i,this.handleGraphics.y=this.arrowSize,this.handleGraphics.beginFill(4671303),this.handleGraphics.drawRect(0,0,this.arrowSize,i),this.handleHeldGraphics.beginFill(9539728),this.handleHeldGraphics.drawRect(0,0,this.arrowSize,i),this.handleHeldGraphics.visible=!1,this.handleGraphics.interactive=!0,this.handleGraphics.mouseover=function(t){}.bind(this),this.prevPos=null;var n=0;e.Platform.supportsTouch()&&(this.handleGraphics.touchstart=function(t){this.dragEnabled=!0,this.handleHandleInputDown()}.bind(this),this.handleGraphics.touchmove=function(t){this.dragEnabled&&(n=this.prevPos?this.prevPos-t.global.y:0,this.prevPos=t.global.y,this.handleGraphics.y-=n/this.parent.scale.y,this.handleGraphics.y+i>this.arrowSize+this.visualHeight&&(this.handleGraphics.y=this.arrowSize+this.visualHeight-i),this.handleGraphics.y<=this.arrowSize&&(this.handleGraphics.y=this.arrowSize))}.bind(this),this.handleGraphics.touchend=function(t){this.dragEnabled=!1,this.handleHandleInputUp()}.bind(this),this.handleGraphics.touchendoutside=function(t){this.dragEnabled=!1,this.handleHandleInputUp()}.bind(this)),this.handleGraphics.mousemove=function(t){this.dragEnabled&&(n=this.prevPos?this.prevPos-t.originalEvent.y:0,this.prevPos=t.originalEvent.y,this.handleGraphics.y-=n,this.handleGraphics.y+i>this.arrowSize+this.visualHeight&&(this.handleGraphics.y=this.arrowSize+this.visualHeight-i),this.handleGraphics.y<=this.arrowSize&&(this.handleGraphics.y=this.arrowSize))}.bind(this),this.handleGraphics.mouseout=function(t){}.bind(this),this.handleGraphics.mousedown=function(t){this.dragEnabled=!0,this.handleHandleInputDown()}.bind(this),this.handleGraphics.mouseup=function(t){this.dragEnabled=!1,this.handleHandleInputUp()}.bind(this),this.handleGraphics.mouseupoutside=function(t){this.dragEnabled=!1,this.handleHandleInputUp()}.bind(this)},o.prototype.checkAndClearHandleHoldInterval=function(){this.handleIsHeldDown&&(clearInterval(this.handleHoldInterval),this.handleIsHeldDown=!1)},o.prototype.handleHandleInputUp=function(){this.prevPos=null,this.handleHeldGraphics.visible=!1,this.checkAndClearHandleHoldInterval(),this.onHandleUp&&this.onHandleUp()},o.prototype.updateScrollPercent=function(t){t>100&&(t=100),t<0&&(t=0),this.currentScrollPercent=t,this.options.onScrollUpdate(this.currentScrollPercent)},o.prototype.updateHandleByPercent=function(t){var e=this.visualHeight-this.handleHeight;this.handleGraphics.y=e*t/100+this.arrowSize,this.currentScrollPercent=(this.handleGraphics.y-this.arrowSize)/e*100},o.prototype.updateByHandle=function(){this.handleGraphics.updateTransform();var t=this.handleGraphics.y,e=this.visualHeight-this.handleHeight;this.updateScrollPercent((t-this.arrowSize)/e*100)},o.prototype.setUpHandleUpdateInterval=function(){this.handleIsHeldDown=!0,this.updateByHandle(),this.handleHoldInterval=setInterval(function(){this.updateByHandle()}.bind(this),5)},o.prototype.handleHandleInputDown=function(){this.handleHeldGraphics.visible=!0,this.setUpHandleUpdateInterval(),this.onHandleDown&&this.onHandleDown()},o.prototype.handleArrowTopDown=function(){this.setUpArrowUpdateInterval(-1)},o.prototype.handleArrowBottomDown=function(){this.setUpArrowUpdateInterval(1)},o.prototype.handleArrowTopUp=function(){this.checkAndClearArrowHoldInterval()},o.prototype.handleArrowBottomUp=function(){this.checkAndClearArrowHoldInterval()},o.prototype.checkAndClearArrowHoldInterval=function(){this.arrowIsHeldDown&&(clearInterval(this.arrowHoldInterval),this.arrowIsHeldDown=!1)},o.prototype.setUpArrowUpdateInterval=function(t){this.arrowIsHeldDown=!0,this.updateByArrow(t),this.arrowHoldInterval=setInterval(function(){this.updateByArrow(t)}.bind(this),10)},o.prototype.updateByArrow=function(t){this.updateScrollPercent(this.currentScrollPercent+t),this.updateHandleByPercent(this.currentScrollPercent)},o}),define("MenuUI/StarClubMainMenuTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","MenuUI/DailyChallengeProgressMeter","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","util/NineSliceWrapper","MenuUI/DropShadow"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e){var n={};this.initStarClubMainMenuTile(i.extend(n,t),e)};return h.prototype=Object.create(r.prototype),h.prototype.initStarClubMainMenuTile=function(t,e){this.game=e,r.call(this,t),this.buildHeader(),this.buildHoverGraphic(),this.initImageOutline(),this.positionTile(),this.buildDropShadow()},h.prototype.buildHeader=function(){this.initHeaderBackground(),this.initHeaderOutline(),this.initHeaderShadow(),this.initHeaderText(),this.initImageShadow()},h.prototype.initHeaderBackground=function(){var i=new t.Graphics;i.beginFill(2116239,1),i.drawRect(0,0,this.image.width,e.Coords.y(70)),i.endFill(),this.addChild(i),this.header=i},h.prototype.initHeaderOutline=function(){var i=new t.Graphics,n=e.Coords.x(1);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.moveTo(0,this.header.height),i.lineTo(this.header.width,this.header.height),i.endFill(),this.addChild(i)},h.prototype.initHeaderShadow=function(){var t=this.buildShadow(0,0,this.header.width/2,this.header.height,0),e=this.buildShadow(this.header.width,this.header.height,this.header.width/2,this.header.height,Math.PI);this.addChild(t),this.addChild(e)},h.prototype.initHeaderText=function(){var i={font:"bold "+40*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",align:"left",strokeThickness:2},n=new t.Text(e.StringManager("tiles.starClub").toUpperCase(),i);n.anchor.set(.5,.5),n.x=this.header.width/2,n.y=this.header.height/2+e.Coords.y(5),this.addChild(n)},h.prototype.initImageShadow=function(){var t=this.image.width/8,e=this.image.height+this.header.height,i=this.buildShadow(0,0,t,e,0),n=this.buildShadow(this.image.width,e,t,e,Math.PI);this.addChild(i),this.addChild(n)},h.prototype.buildShadow=function(t,e,i,n,r){var o=new s("mainmenu/shadow_stretch.png",i,n,5,2,5,5);return o.position.set(t,e),o.alpha=1,o.rotation=r,o},h.prototype.buildHoverGraphic=function(){var i=new t.Graphics,n=e.Coords.x(4);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.drawRect(0,0,this.header.width,this.header.height+this.image.height),i.endFill(),this.hover=i,this.hover.alpha=.01,this.addChild(this.hover)},h.prototype.initImageOutline=function(){var i=new t.Graphics,n=e.Coords.x(1);i.beginFill(16777215,0),i.lineStyle(n,16777215,1),i.drawRect(0,0,this.image.width,this.image.height+this.header.height),i.endFill(),this.addChild(i),this.imageOutline=i},h.prototype.positionTile=function(){this.image.y=this.header.y+this.header.height},h.prototype.buildDropShadow=function(){this.dropShadow&&this.removeChild(this.dropShadow),this.dropShadow=new l({baseWidth:this.image.width,baseHeight:this.image.height+this.header.height}),this.addChildAt(this.dropShadow,0)},h.prototype.updateStats=function(){a.GetChallengeSettingsForCurrentMonth(function(t){}.bind(this),function(){e.Debug.log("Error: GetChallengeSettingsForCurrentMonth()")})},h.prototype.onShow=function(){this.interactive=!0,a.HasCache()&&a.IsValid()&&this.updateStats()},h}),define("MenuUI/ThemesMenu",["MenuUI/Menu","util/NineSliceWrapper","absolute"],function(t,e,i){var n=function(t,e){this.game=e,this.initThemesMenu(t)};return n.prototype=Object.create(t.prototype),n.prototype.initThemesMenu=function(e){e.width=i.Coords.x(1890),e.height=i.Coords.y(740),e.tilePaddingX=i.Coords.x(120),e.startY=i.Coords.y(70),t.call(this,e),this.initBackground("xl"),this.container.x=i.Coords.x(70),this.container.y=i.Coords.y(20),this.previousLayoutType="xl"},n.prototype.initBackground=function(t){this.background&&this.removeChild(this.background);var n="xl"===t?this.config.width:i.Coords.x(1080),r="xl"===t?this.config.height:i.Coords.y(1050),o=new e("mainmenu/themes_menu_background.png",n,r,30,30,20,20);this.background=o,this.addChildAt(o,0)},n.prototype.handleResize=function(){t.prototype.handleResize.call(this);var e=this.getLayoutConfig();this.previousLayoutType!==e.type&&(this.initBackground(e.type),this.previousLayoutType=e.type)},n}),define("Managers/ScrollManager",["pixi"],function(t){var e=function(){};return e.initialize=function(){e.callbacks=[],e.scrollEnabled=!0;var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.attachEvent?document.attachEvent("on"+t,this.handleMouseWheel.bind(this),{passive:!0,capture:!0}):document.addEventListener&&document.addEventListener(t,this.handleMouseWheel.bind(this),{passive:!0,capture:!0})},e.add=function(t,i,n){e.callbacks.push({element:t,callback:i,context:n})},e.remove=function(t){var i;e.callbacks.forEach(function(e,n){e.element===t&&(i=n)}),null!=i&&e.callbacks.splice(i,1)},e.disableScroll=function(){e.scrollEnabled=!1},e.enableScroll=function(){e.scrollEnabled=!0},e.handleMouseWheel=function(t){if(e.scrollEnabled){t||(t=window.event),t.returnValue=!1;var i=e.callbacks[e.callbacks.length-1];i&&i.callback.call(i.context,t)}},e}),define("mainmenu",["pixi","absolute","util/RegularButton","util/CustomWordWrapper","absolute/stringmanager","absolute/storagemanager","absolute/screenmetrics","Solitaire/DailyChallenges/KlondikeChallenge","Solitaire/SolitaireGameMode","Solitaire/Solitaire","MenuUI/MenuTile","MenuUI/ClassicGameTile","gameconfig","MenuUI/Menu","lodash","MenuUI/MultiPageMenu","MenuUI/ThemeTile","Solitaire/SolitaireStatistics","MenuUI/StatsItemModel","MenuUI/DetailStatsItemModel","MenuUI/StatsOverviewTile","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","Solitaire/MvvmStructure/Service/SolitaireStarClubService","Solitaire/MvvmStructure/Service/BakedInSolvablesService","MenuUI/DailyChallengeMainMenuTile","MenuUI/StarCountDisplay","Managers/StatManager","MenuUI/DealWarningModal","Solitaire/MvvmStructure/Service/ManifestService","MenuUI/ControlFocusManager","MenuUI/SideBar","Managers/TelemetryManager","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","Managers/ScaleManager","util/NineSliceWrapper","MenuUI/StarClubMainMenuTile","MenuUI/ThemesMenu","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_,P,A,k,D,F,E,I,G,O,B,L){var R=function(t,e,i){this.initMainMenu(t,e,i)};return R.prototype=Object.create(e.Screen.prototype),R.prototype.firstRun||(R.prototype.firstRun=!0),R.prototype.initMainMenu=function(t,i,n){e.Screen.call(this),this.ui=t,this.ui.mainScreen=this,this.game=i,this._inited=!1,this.mode=n,this.sectionSelected=!1,this.layoutType="xl",this.paginatedMenu=null,this.controlFocusManager=new k,this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler)},R.prototype.handleResize=function(){this.isShown&&this.scrollable&&(this.scrollTo(this.scrollable.y),this.handleMenuResize(),this.scrollableFakeHeight=this.scrollable.height+e.Coords.x(100),this.tutorialContainer&&(this.updateTutorialContainer(),this.tutorialContainer&&this.updateTutorialPositioning(),this.addChild(this.touchContainer),this.addChild(this.sidebar)),this.handleSidebarResize())},R.prototype.handleSidebarResize=function(){this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<e.Coords.y(1080)&&(this.scrollable.y=e.Coords.y(1080)-this.scrollableFakeHeight,this.tutorialContainer&&this.updateTutorialPositioning()),this.updateSidebar()},R.prototype.handleMenuResize=function(){this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width*(this.container.children[0].pageGenerator.cardScale+.2)/I.width)*(I.height/e.Coords.y(985)),this.updatePagesPositions(),this.scrollable.height=this.currentWidth/this.container.width*(e.Coords.y(985)/I.height)*(I.width/e.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.background.scale.set(1/Math.min(I.scaleFactorX,1),1/Math.min(1,I.scaleFactorY)),this.menuShadows.forEach(function(t){t.scale.set(I.scaleFactorX,1)})},R.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var i=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},R.prototype.getLayoutType=function(){for(var t,e=I.scaleParams.MenuConfigs.MainMenuConfigs.layoutConfigs,i=0;i<e.length;i++)(e[i].screenWidth&&I.width<e[i].screenWidth||e[i].screenHeight&&I.height<e[i].screenHeight)&&(t=e[i].type);return t},R.prototype.handleDragStart=function(t){this.parent&&(this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1))},R.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)),this.lastDeltaY=i}},R.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},R.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},R.prototype.init=function(){var e=t.Sprite.fromFrame("win10_MS_bg.png");this.background=e,this.addChild(e),this.initShadows(),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!0,"MenuButton"),this.game.menuBar.newsDialog.newsAvailable()&&this.controlFocusManager.addControl(this.game.menuBar.newsButton,!0,"RightButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!0,"RightButtons"),this.buildStatsModels(),this.buildMenu(),this.initTouchInterface(),I.addElement(this,{scaleChangeSource:"Full"}),this.handleResize()},R.prototype.initShadows=function(){this.menuShadows=[];var t=e.Coords.x(960),i=e.Coords.y(1080),n=this.buildShadow(0,0,t,i,0),r=this.buildShadow(e.Coords.x(1920),e.Coords.y(1080),t,i,Math.PI);this.addChild(n),this.addChild(r),this.menuShadows.push(n,r)},R.prototype.buildShadow=function(t,e,i,n,r){var o=new G("mainmenu/shadow_stretch.png",i,n,10,2,5,5);return o.position.set(t,e),o.alpha=.5,o.rotation=r,o},R.prototype.onShow=function(t){if(this.game.config.singleGame.enabled)return void console.info("EMERGENCY!!! TRIED TO SHOW MAIN MENU");this.isShown=!0,this.scrollable&&(this.scrollable.y=0),this.tutorialContainer&&(this.tutorialContainer.y=0),this.ui.blockClicks(),this.ui.showLoadingScreen(),v.UpdateGlobalChallengeStats(),e.Screen.prototype.onShow.call(this),this._inited||(this.init(),this._inited=!0),this.ui.hideLoadingScreen(),this.ui.unBlockClicks(),this.gameMenu&&this.gameMenu.onShow(),this.challengeMenu&&this.challengeMenu.onShow(),this.statsMenu&&this.statsMenu.onShow(),this.themeMenu&&this.themeMenu.onShow(),this.touchContainer&&this.addChild(this.touchContainer),this.addChild(this.game.menuBar),this.game.menuBar.onShow(!0,!1,!1,e.StringManager("titles.MicrosoftSolitaireCollection")),this.game.menuBar.y=0,this.ui.refreshBackground=!0
;var i=_.GetValue("SCGlobalTotalCollectionsCompleted"),n=_.GetValue("SCGlobalTotalCollections"),r=_.GetValue("SCGlobalStarsEarned");if(this.collectionsCompletedText&&(this.collectionsCompletedText.setText(i+(n>0?"/"+n:"")+" "+e.StringManager("tiles.collectionsComplete")),this.starCountDisplay.onShow(r,!0)),this.sidebar||this.initSidebar(),this.scrollTo(0),this.mode&&l.hasOwnProperty(this.mode)&&("DailyChallenge"===this.mode?this.handleChallengeClick():"StarClub"===this.mode?this.handleStarClubClick():(this.alpha=.01,setTimeout(function(){this.alpha=1,this.game.startGame(l[this.mode],null,!1),this.mode=null}.bind(this)))),this.firstRun&&(F.mainMenuLoad(),this.firstRun=!1),this.handleResize(),setTimeout(function(){this.game.menuBar.handleResize()}.bind(this),20),L.add(this,this.doScroll,this),!o.fetch("InstallId")){var a=e.Utils.makeGUID();o.store("InstallId",a)}x.Initialize(function(){}.bind(this))},R.prototype.initSidebar=function(){this.sidebar=new D({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(1900),e.Coords.y(67)),this.updateSidebar()},R.prototype.onHide=function(){this.isShown=!1,this.sidebar&&(this.removeChild(this.sidebar),this.sidebar=null),this.resetControlManager(),e.Screen.prototype.onHide.call(this),L.remove(this)},R.prototype.handlePause=function(){},R.prototype.handleResume=function(){},R.prototype.handleOrientationChange=function(t){e.Screen.prototype.handleOrientationChange.call(this,t)},R.prototype.buildStatsModels=function(){this._statsModels={};var t=this.makeStatsModel(l.Klondike);t.model.addStat("HighScore",m.Current.GetHighScoreFormatString,t.key);var e=this.makeStatsModel(l.Spider);e.model.addStat("Stacks",m.Current.GetStacksFormatString,e.key),e.model.addStat("HighScore",m.Current.GetHighScoreFormatString,e.key);var i=this.makeStatsModel(l.FreeCell);i.model.addStat("BestTime",m.Current.GetBestTimeFormatString,i.key),i.model.addStat("AverageTime",m.Current.GetAverageTimeFormatString,i.key);var n=this.makeStatsModel(l.Pyramid);n.model.addStat("Matches",m.Current.GetMatchesFormatString,n.key),n.model.addStat("HighScore",m.Current.GetHighScoreFormatString,n.key),n.model.addStat("RowsCleared",m.Current.GetRowsClearedFormatString,n.key);var r=this.makeStatsModel(l.TriPeaks);r.model.addStat("TotalPeaksCleared",m.Current.GetPeaksClearedFormatString,r.key),r.model.addStat("BoardsCleared",m.Current.GetBoardsFormatString,r.key),r.model.addStat("HighScore",m.Current.GetHighScoreFormatString,r.key);var o=new C(l.DailyChallenge);o.addStat("ChallengesWon",m.Current.GetDCChallengesWonFormatString),o.addStat("ChallengesPlayed",m.Current.GetDCChallengesPlayedFormatString),o.addStat("DaysCompleted",m.Current.GetDCDaysCompletedFormatString),o.addStat("BronzeBadgesWon",m.Current.GetDCBronzeBadgesWonFormatString),o.addStat("SilverBadgesWon",m.Current.GetDCSilverBadgesWonFormatString),o.addStat("GoldBadgesWon",m.Current.GetDCGoldBadgesWonFormatString),o.addStat("DiamondBadgesWon",m.Current.GetDCDiamondBadgesWonFormatString),o.addStat("PerfectCompletions",m.Current.GetDCPerfectCompletionsFormatString),this._statsModels[l.getModeById(l.DailyChallenge)]=o;var a=new C(l.StarClub);a.addStat("TotalStarsEarned",m.Current.GetSCTotalStarsEarnedFormatString),a.addStat("ChallengesCompleted",m.Current.GetSCChallengesCompletedFormatString),a.addStat("PacksUnlocked",m.Current.GetSCPacksUnlockedFormatString),a.addStat("CollectionsUnlocked",m.Current.GetSCCollectionsUnlockedFormatString),a.addStat("CrownsEarned",m.Current.GetSCCrownsEarnedFormatString),a.addStat("CompletionPercent",m.Current.GetSCCompletionPercentageFormatString),this._statsModels[l.getModeById(l.StarClub)]=a},R.prototype.makeStatsModel=function(t){var e=new m.StatKey(t,"+TOTAL"+l.getModeById(t).toUpperCase()),i=new C(t);return i.addStat("GamesPlayed",m.Current.GetGamesPlayedFormatString,e),t!=l.TriPeaks&&t!=l.Pyramid&&(i.addStat("GamesWon",m.Current.GetGamesWonFormatString,e),i.addStat("GamesLost",m.Current.GetGamesLostFormatString,e),i.addStat("WinPercentage",m.Current.GetPercentWon,e)),this._statsModels[l.getModeById(t)]=i,{key:e,model:i}},R.prototype.buildMenu=function(){this.gameTiles=[],g.each(c.UI.mainMenuGames,function(t){t.isMainMenu=!0,this.game.config.singleGame.enabled&&(t.mode=this.game.config.singleGame.mode);var e=new d(t,this,this.setTutorialAsSeen.bind(this));this.gameTiles.push(e),this.controlFocusManager.addControl(e,!1,"ClassicGames")},this);var i={tiles:this.gameTiles,label:""};this.gameMenu=new p(g.extend(i,I.scaleParams.MenuConfigs.MainMenuConfigs));var n,r,o=c.UI.mainMenuChallenges.dailyChallenge,a=c.UI.mainMenuChallenges.starClub;e.ScreenMetrics.getResScale();o.action=this.handleChallengeClick.bind(this),o.labelPosition.x=e.Coords.x(o.labelPosition.x),o.labelPosition.y=e.Coords.x(o.labelPosition.y-5),n=new T(o,this.game),this.controlFocusManager.addControl(n,!1,"Challenges"),a.action=this.handleStarClubClick.bind(this),a.labelPosition.x=e.Coords.x(a.labelPosition.x),a.labelPosition.y=e.Coords.x(a.labelPosition.y-5),r=new O(a,this.game),this.controlFocusManager.addControl(r,!1,"Challenges");var s={tiles:[n,r],label:"",tilePaddingY:e.Coords.y(120)};this.challengeMenu=new p(g.extend(s,I.scaleParams.MenuConfigs.MainMenuConfigs)),this.challengeMenu.y=e.Coords.y(414),this.themeTiles=[];var h=function(t){g.each(this.themeTiles,function(e){e.updateState(t===e.themeId)})}.bind(this);g.each(c.UI.mainMenuThemes,function(t){t.disableOnClick=!1,t.themeChangeCallback=h,t.maxWidth=e.Coords.x(240);var i=new y(t,this,this.game);this.themeTiles.push(i),this.controlFocusManager.addControl(i,!1,"Themes")},this),this.themeMenu=new B(g.extend({tiles:this.themeTiles,label:"themes",labelPosition:{y:-e.Coords.y(1),x:e.Coords.x(1)}},I.scaleParams.MenuConfigs.MainMenuConfigs),this.game);var u=[],f={};g.each(this._statsModels,function(t){var e=new b(f,t,this);u.push(e),t.gameMode!==l.DailyChallenge&&t.gameMode!==l.StarClub&&this.controlFocusManager.addControl(e,!1,"Statistics")},this),this.statsMenu=new p(g.extend({tiles:u,label:""},I.scaleParams.MenuConfigs.MainMenuConfigs)),this.scrollable=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer,this.container.addChild(this.gameMenu),this.container.addChild(this.challengeMenu),e.Platform.isMobile()||this.container.addChild(this.themeMenu),this.container.addChild(this.statsMenu),this.currentWidth=e.Coords.x(1840),this.entirePile=new t.Graphics,this.updatePagesPositions(),this.addChild(this.scrollable),this.scrollable.addChild(this.container),this.scrollable.addChild(this.entirePile)},R.prototype.updatePagesPositions=function(){var t,i=this.container.width/this.currentWidth,n=e.Coords.x(98)*i,r=e.Coords.y(60)*i,o=e.Coords.y(20)*i;this.currentHeight=e.Coords.y(140),this.container.children.forEach(function(e){e.x=n,e.y=t?t.y+t.height+r:o,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},R.prototype.handleChallengeClick=function(){v.IsValid()?(this.setTutorialAsSeen(),this.game.navDaily()):this.showManifestWarning()},R.prototype.handleAwardsClick=function(){this.game.navAwardsAchievements()},R.prototype.handleStarClubClick=function(){w.IsValid()?(this.setTutorialAsSeen(),this.game.navStarClub()):this.showManifestWarning()},R.prototype.handleStatsTileClick=function(t){if(t!==l.DailyChallenge&&t!==l.StarClub){var e=new S(t);this.game.navStatsDetail(e)}},R.prototype.showManifestWarning=function(){this.ui.showWarning(r("dialogs.manifestWarningHeadline"),r("dialogs.manifestWarningContent"),function(){this.ui.hideLoadingScreen(),this.game.navBack()}.bind(this))},R.prototype.setTutorialAsSeen=function(){this.tutorialContainer&&(this.touchContainer.removeChild(this.tutorialContainer),this.addChild(this.touchContainer),this.addChild(this.sidebar),this.addChild(this.game.menuBar),this.game.menuBar.y=0,this.tutorialContainer=null,o.store("TutorialSeen",!0),this.handleResize())},R.prototype.initTutorial=function(){if(!o.fetch("TutorialSeen")){F.newInstall(),this.tutorialContainer=new t.DisplayObjectContainer,this.touchContainer.addChild(this.tutorialContainer),this.modalTutorial=new t.Graphics,this.tutorialContainer.addChild(this.modalTutorial),this.tutorialArrows=[],g.times(5,function(){var e=t.Sprite.fromFrame("fue/arrow.png");e.anchor.set(.5,.5),this.tutorialArrows.push(e),this.tutorialContainer.addChild(e)}.bind(this)),this.tutorialPopup=t.Sprite.fromFrame("fue/shortPopup.png");var r=new i("fue/closeBtn/down.png","fue/closeBtn/over.png","fue/closeBtn/up.png");r.x=this.tutorialPopup.width/2-e.Coords.y(40),r.y=e.Coords.y(35),r.anchor.set(.5,.5),r.interactive=!0,r.buttonMode=!0,r.onClick.add(function(){this.setTutorialAsSeen()}.bind(this)),this.tutorialPopup.anchor.set(.5,0);var a=e.StringManager("fue.first");a=a.replace("\n\n\n","{yyy}"),a=a.replace("\n"," "),a=a.replace("{yyy}","\n\n");var s={font:"bold "+25*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center",wordWrap:!0,wordWrapWidth:e.Coords.x(700)},l=new t.Text(a,s);n.doTextCustomWrap(l,25*e.ScreenMetrics.getResScale(),"bold",e.Coords.x(700),e.Coords.y(260)),l.anchor.set(.5,0),l.x=0,l.y=e.Coords.y(65),this.tutorialPopup.addChild(l),this.tutorialPopup.addChild(r),this.tutorialContainer.addChild(this.tutorialPopup),this.updateTutorialContainer(),this.handleResize()}},R.prototype.updateTutorialContainer=function(){var t=(this.container.x+this.gameMenu.x)*this.scrollable.scale.x,i=(this.container.y+this.gameMenu.y)*this.scrollable.scale.y,n=this.gameMenu.width*this.scrollable.scale.x,r=this.gameMenu.height*this.scrollable.scale.y,o=e.Coords.x(35)*this.scrollable.scale.x,a=e.Coords.y(20)*this.scrollable.scale.y;t-=o,i-=a,n+=o,r+=1.2*a,this.modalTutorial.clear(),this.modalTutorial.beginFill(0,.9),this.modalTutorial.drawRect(t,-44444,n,44444+i),this.modalTutorial.drawRect(0,-44444,t,88888),this.modalTutorial.drawRect(t+n,-44444,44444,88888),this.modalTutorial.drawRect(t,i+r,n,44444),this.modalTutorial.endFill(),this.modalTutorial.interactive=!0,this.modalTutorial.mousedown=this.modalTutorial.touchstart=function(){},this.modalTutorial.mousemove=this.modalTutorial.touchmove=function(){},this.modalTutorial.mouseupoutside=this.modalTutorial.mouseup=this.modalTutorial.touchend=this.modalTutorial.touchendoutside=function(){};var s=e.Coords.x(1920)/I.width,l=e.Coords.y(1080)/I.height,h=e.Coords.x(99)*s,u=e.Coords.y(95)*l,d=I.width/e.Coords.x(1920);d>1&&(d=1),h*=d,u*=d,g.each(this.tutorialArrows,function(r,o){r.width=h,r.height=u,r.x=e.Coords.x(180)+t+n/5*o,r.y=i});var c="xl"===this.getLayoutType();this.tutorialPopup.position.set(t+n/2,i+r+e.Coords.y(20));var p=e.Coords.x(837)*s,f=e.Coords.y(254)*l;p*=d*(c?1.3:1.7),f*=d*(c?1.3:1.7),this.tutorialPopup.width=p,this.tutorialPopup.height=f,g.each(this.tutorialArrows,function(t){t.visible=c})},R.prototype.doScroll=function(t){if(this.scrollable){var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/35:t.detail&&(e=-t.detail/3),this.scrollTo(this.scrollable.y+100*e)}},R.prototype.scrollTo=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=e.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var i=this.scrollableFakeHeight-e.Coords.y(1080);Math.abs(this.scrollable.y)>i&&(this.scrollable.y=-i),this.tutorialContainer&&this.updateTutorialPositioning(),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(i))}},R.prototype.handleCommand=function(t,e){if(!e){if(this.game.menuBar.gameOptionsPopup)return void this.game.menuBar.gameOptionsPopup.handleCommand(t);switch(this.selectSection(t,e),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(-1)&&this.startScrolling(-2):this.startScrolling(-2);break;case"Down":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(1)&&this.startScrolling(2):this.startScrolling(2);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}}},R.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("MenuButton",!0);break;case 1:this.controlFocusManager.setFocusGroup("RightButtons",!0);break;case 2:this.controlFocusManager.setFocusGroup("ClassicGames",!0);break;case 3:this.controlFocusManager.setFocusGroup("Challenges",!0);break;case 4:this.controlFocusManager.setFocusGroup("Themes",!0);break;case 5:this.controlFocusManager.setFocusGroup("Statistics",!0)}},R.prototype.handleVisibilityChange=function(t){t||this.ui.resize()},R.prototype.selectSection=function(t,e){if("Tab"===t||"ShiftTab"===t){switch(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?5===this.page?(this.handlePageChange(this.page,0),this.page=0):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,5),this.page=5):this.controlFocusManager.prevFocusGroup()),this.controlFocusManager.currentFocusGroup){case"MenuButton":this.page=0;break;case"RightButtons":this.page=1;break;case"ClassicGames":this.page=2;break;case"Challenges":this.page=3;break;case"Themes":this.page=4;break;case"Statistics":this.page=5}var i=this.controlFocusManager.getCurrentControl();e||this.scrollTo(-i._bounds.y+2*i.height)}},R.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},R.prototype.updateSidebar=function(){if(this.sidebar){var t=this.game.menuBar.menuBarHeight,i=1;e.Platform.isMobile()&&(t*=.7,e.ScreenMetrics.isPortrait()&&(i=.5));var n=I.width/e.Coords.x(1920),r=I.height/e.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/n*i,this.sidebar.height=this.sidebar.height/r,this.sidebar.y=this.tutorialContainer?0:t/r,this.sidebar.x=e.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*n);var o,a,s;o=this.scrollableFakeHeight,a=e.Coords.y(1080),s=o-e.Coords.y(1080),this.sidebar.resetDimensions(o,a,function(t){var e=-Math.abs(s)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>s&&(this.scrollable.y=-s),this.tutorialContainer&&this.updateTutorialPositioning()}.bind(this),this.tutorialContainer?I.height:I.height-t),this.sidebar.visible=o>=e.Coords.y(1080),this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(s))}},R.prototype.updateTutorialPositioning=function(){this.tutorialContainer.y=this.scrollable.y,this.game.menuBar&&(this.game.menuBar.y=this.scrollable.y)},R.prototype.handleGameInput=function(){this.resetControlManager()},R.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl(),this.sectionSelected=!1},R}),define("gamescreen",["pixi","absolute","absolute/storagemanager","Solitaire/Solitaire","Solitaire/SolitaireGameMode","Arkadium/GameEngine/Core/EngineManagers","Arkadium/GameEngine/Tween/Tween","SolitaireShared/CardLogic/CardOp","util/ThemeManager","Solitaire/ChallengeMode","Solitaire/GameResult","Solitaire/GameState","CardUI/SupplyView","audiosprites","lodash","Managers/AdManager","Managers/TelemetryManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y){var m=function(t,e){this.initGameScreen(t,e)};return m.prototype=Object.create(e.Screen.prototype),m.prototype.initGameScreen=function(t,i){e.Screen.call(this),this.ui=t,this.game=i},m.prototype.loadAudio=function(t){var i=new e.Loader,n="music_theme_"+l.CurrentTheme,o=["game",n];switch(this.game.mode){case r.Klondike:o.push("klondike");break;case r.Spider:o.push("spider");break;case r.TriPeaks:o.push("tripeaks");break;case r.Pyramid:o.push("pyramid");break;case r.FreeCell:o.push("freecell")}for(var a=[],s=0;s<o.length;s++)g.forEach(p,function(t){t.loadgroup==o[s]&&(e.AudioManager.soundLoaded(t.id)||(t.lazyload=!1,a.push(t)))});a.length>0?i.loadSound(a,function(t){this.ui.loadingScreen.updateLoadingProgress(.5*t)}.bind(this),function(){t();var n=[];g.forEach(p,function(t){"endgameanimation"==t.loadgroup&&(e.AudioManager.soundLoaded(t.id)||(t.lazyload=!1,n.push(t)))}),i.loadSound(n,function(){},function(){})}):t()},m.prototype.loadAtlases=function(t,i){var n=new e.Loader,r=[{name:l.CurrentTheme},{name:l.CurrentTheme+"_bg"}];n.loadAtlases(r,function(t){e.Debug.log("loading theme "+t),this.ui.loadingScreen.updateLoadingProgress(.5+.5*t)}.bind(this),function(){this.ui.loadingScreen.finishLoadingProgress(),t()}.bind(this),function(){i()})},m.prototype.onShow=function(t,i){void 0===i&&(i=!0),this.ui.showLoadingScreen(),e.Screen.prototype.onShow.call(this),this.ui.refreshBackground=!0,this.ui.particleSystem.cleanUp(),this.loadAudio(function(){this.loadAtlases(function(){this.ui.blockClicks();var t=void 0!==this.game.solitaire.CurrentChallenge&&null!==this.game.solitaire.CurrentChallenge,n=function(){this.checkTutorialSeen&&this.checkTutorialSeen(),this.ui.unBlockClicks(),this.addChild(this.game.solitaire),this.game.solitaire.StartGame(this.game.mode,this.game.newDeal,this.game.resetScoring,this.game.statLossRedeal,i);var t=function(t){this.game.gameScreenUI.handleScoreChange(t)}.bind(this),n=t,r=function(t){this.game.gameScreenUI.handleTimeChange(t)}.bind(this),o=r,a=function(t){this.game.gameScreenUI.handleBoardCompleteChange(t)}.bind(this),s=a;this.game.solitaire.Authority.CardSupply.OnScoreEvent.remove(n),this.game.solitaire.Authority.CardSupply.OnScoreEvent.add(n),this.game.solitaire.Authority.CardSupply.OnTimeChangeEvent.remove(o),this.game.solitaire.Authority.CardSupply.OnTimeChangeEvent.add(o),this.game.solitaire.Authority.CardSupply.OnBoardCompletedEvent.remove(s),this.game.solitaire.Authority.CardSupply.OnBoardCompletedEvent.add(s),this.addChild(this.game.gameScreenUI),this.addChild(this.game.menuBar),this.game.gameScreenUI.onShow(this.game.solitaire.Authority.CardSupply.Score,this.game.solitaire.Authority.CardSupply.CurrentTime,this.game.solitaire.Authority.BoardsCompleted()),this.game.menuBar.onShow(!1,!this.game.config.singleGame.enabled),setTimeout(function(){e.MusicManager.playMusic("music_theme_"+l.CurrentTheme)},400)}.bind(this);i?f.tryShowAd(n,t,!1,t&&!this.game.solitaire.CurrentChallenge.IsStarClub):n()}.bind(this),function(){this.game.ui.hideLoadingScreen(),this.game.gameScreenUI.showNetworkErrorDialog()}.bind(this))}.bind(this))},m.prototype.onHide=function(){this.removeChild(this.game.solitaire),this.game.gameScreenUI.onHide(),this.game.boostType=null,a.RemoveAll(),e.MusicManager.stopMusic(),e.Screen.prototype.onHide.call(this)},m.prototype.handlePause=function(){},m.prototype.handleResume=function(){},m.prototype.handleOrientationChange=function(t){e.Screen.prototype.handleOrientationChange.call(this,t)},m.prototype.handleResize=function(t){this.game.menuBar.handleResize(t)},m.prototype.handleVisibilityChange=function(t){e.MusicManager.isMuted()||t||e.MusicManager.playMusic("music_theme_"+l.CurrentTheme)},m.prototype.beforeRender=function(){var t=Date.now();o.Time.Update(t-this.lastRenderTime),this.lastRenderTime=t,this.game.solitaire.Authority&&this.game.solitaire.Update(o.Time),a.UpdateAll(),e.Screen.prototype.beforeRender.call()},m.prototype.handleCommand=function(t){this.game.gameScreenUI.handleCommand(t)},m}),define("MenuUI/MenuTab",["pixi","absolute","lodash","MenuUI/Label","MenuUI/DropShadow","Managers/ScaleManager"],function(t,e,i,n,r,o){var a=function(t){var n={color:8791591,borderColor:12481138,tabWidth:e.Coords.x(575),tabPosition:e.Coords.x(36),selected:!1,letterStyle:{font:"bold "+40*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},width:e.Coords.x(1821),height:e.Coords.y(551),selectedCallback:""};this.initMenuTab(i.extend(n,t))};return a.prototype=Object.create(t.DisplayObjectContainer.prototype),a.prototype.initMenuTab=function(i){t.DisplayObjectContainer.call(this),this.config=i,this.config.disabled&&(this.config.letterStyle.tint=10724259),this.lineWeight=e.Coords.x(3),this.tabHeightSelected=this.config.tabHeightSelected,this.tabHeight=this.config.tabHeight,this.coverBaseStrokeOffset=e.Coords.y(10),this.drawBaseRect(),this.tabSelected=new t.Graphics,this.tab=new t.Graphics,this.tabStrokeSelected=new t.Graphics,this.tabStroke=new t.Graphics,this.dropShadow=new r({beginningShade:.03,baseWidth:this.baseRect.width,baseHeight:this.baseRect.height}),this.dropShadow.y=this.tabHeightSelected,this.addChildAt(this.dropShadow,0),this.contentContainer=new t.DisplayObjectContainer,this.setContent(this.config.content),this.tabSelected.beginFill(this.config.color),this.tabSelected.drawRect(this.config.tabPosition,0,this.config.tabWidth,this.tabHeightSelected+this.coverBaseStrokeOffset),this.tabSelected.endFill(),this.tab.beginFill(this.config.color),this.tab.drawRect(this.config.tabPosition,this.tabHeightSelected-this.tabHeight,this.config.tabWidth,this.tabHeight+this.coverBaseStrokeOffset),this.tab.endFill(),this.tab.interactive=!0,this.tab.buttonMode=!this.config.disabled,this.addChild(this.tabSelected),this.addChild(this.tab),e.Platform.supportsTouch()?(this.tab.touchstart=this.tabSelectedAction.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(this.tab.mousedown=this.tabSelectedAction.bind(this))):(this.tab.mousedown=this.tabSelectedAction.bind(this),this.tab.mouseover=this.handleMouseOverAction.bind(this),this.tab.mouseout=this.handleMouseOutAction.bind(this),this.tabSelected.mouseover=this.handleMouseOverAction.bind(this),this.tabSelected.mouseout=this.handleMouseOutAction.bind(this)),this.initTabStrokeSelected(this.config.borderColor),this.initTabStroke(this.config.borderColor),this.label=new n({text:this.config.label,icon:this.config.labelIcon,iconScale:this.config.labelIconScale,letterStyle:this.config.letterStyle}),this.label.x=this.config.tabPosition+e.Coords.x(15),this.config.disabled&&(this.label.icon.alpha=.5),this.addChild(this.contentContainer),this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(e.Coords.x(3),16777215),this.addChild(this.focusIndicator),this.focusIndicator.visible=!1,this.updateState(this.config.selected),this.baseRect.visible=this.config.selected,this.dropShadow.visible=this.config.selected,this.content.visible=this.config.selected},a.prototype.drawBaseRect=function(){-1!==this.children.indexOf(this.baseRect)&&this.removeChild(this.baseRect),this.baseRect=new t.Graphics,this.baseRect.beginFill(this.config.color),this.baseRect.lineStyle(this.lineWeight,this.config.borderColor),this.baseRect.drawRect(0,this.tabHeightSelected,this.config.width,this.config.height),this.baseRect.endFill(),this.addChildAt(this.baseRect,0)},a.prototype.setSelected=function(){this.tabSelectedAction()},a.prototype.tabSelectedAction=function(){this.config.disabled||("function"==typeof this.config.selectedCallback&&this.config.selectedCallback(this),this.updateState(!0))},a.prototype.updateState=function(t){this.tabStrokeSelected.visible=this.tabSelected.visible=t,this.tabStroke.visible=this.tab.visible=!t,this.selected=t,t?(this.label.y=e.Coords.y(20*this.config.labelIconScale),this.tabSelected.addChild(this.label),this.drawFocusRect(0,this.tabSelected.width,this.tabSelected.height-10)):(this.label.y=e.Coords.y(30*this.config.labelIconScale),this.tab.addChild(this.label),this.drawFocusRect(20,this.tab.width,this.tab.height))},a.prototype.drawFocusRect=function(t,i,n){this.focusIndicator.clear(),this.focusIndicator.lineStyle(e.Coords.x(3),16777215),this.focusIndicator.drawRect(this.label.x-15,t,i,n)},a.prototype.setContent=function(t){for(;this.contentContainer.children.length>0;)this.contentContainer.removeChildAt(0);t&&this.contentContainer.addChild(t),this.content=t},a.prototype.setLabel=function(t){this.tabSelected.visible?this.tabSelected.removeChild(this.label):this.tab.removeChild(this.label),this.label=new n({text:t,icon:this.config.labelIcon,iconScale:this.config.labelIconScale,letterStyle:this.config.letterStyle}),this.label.x=this.config.tabPosition+e.Coords.x(15),this.updateState(!0)},a.prototype.onHide=function(){this.baseRect.visible=!1,this.dropShadow.visible=!1,this.content.visible=!1,this.content.onHide()},a.prototype.onShow=function(){this.baseRect.visible=!0,this.dropShadow.visible=!0,this.content.visible=!0,this.content.onShow()},a.prototype._focusChanged=function(){this.focusIndicator.visible=!!this.tab._hasFocus},a.prototype.handleActivate=function(){this.tabSelectedAction()},Object.defineProperty(a.prototype,"focus",{get:function(){return this.tab._hasFocus},set:function(t){return this.tab._hasFocus=t,this._focusChanged(),t}}),a.prototype.handleMouseOverAction=function(){this.updateTabState(),this.label.labelText.style.fill="#ffffff",this.updateTabState(),this.label.labelText.updateText()},a.prototype.handleMouseOutAction=function(){this.updateTabState(!0),this.label.labelText.style.fill=this.config.letterStyle.fill,this.label.labelText.updateText()},a.prototype.updateTabState=function(t){this.tabStrokeSelected&&this.removeChild(this.tabStrokeSelected),this.tabStroke&&this.removeChild(this.tabStroke),this.initTabStrokeSelected(t?this.config.borderColor:this.config.hoverBorderColor?this.config.hoverBorderColor:this.config.borderColor),this.initTabStroke(t?this.config.borderColor:this.config.hoverBorderColor?this.config.hoverBorderColor:this.config.borderColor)},a.prototype.initTabStrokeSelected=function(t){this.tabStrokeSelected.moveTo(this.config.tabPosition,this.tabHeightSelected),this.tabStrokeSelected.lineStyle(this.lineWeight,t),this.tabStrokeSelected.lineTo(this.config.tabPosition,0),this.tabStrokeSelected.lineTo(this.config.tabPosition+this.config.tabWidth,0),this.tabStrokeSelected.lineTo(this.config.tabPosition+this.config.tabWidth,this.tabHeightSelected),this.addChild(this.tabStrokeSelected)},a.prototype.initTabStroke=function(t){this.tabStroke.moveTo(this.config.tabPosition,this.tabHeightSelected),this.tabStroke.lineStyle(this.lineWeight,t),this.tabStroke.lineTo(this.config.tabPosition,this.tabHeightSelected-this.tabHeight),this.tabStroke.lineTo(this.config.tabPosition+this.config.tabWidth,this.tabHeightSelected-this.tabHeight),this.tabStroke.lineTo(this.config.tabPosition+this.config.tabWidth,this.tabHeightSelected),this.addChild(this.tabStroke)},a}),define("MenuUI/ChallengeTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","Managers/TelemetryManager"],function(t,e,i,n,r,o){var a=function(t,e,n,r){var o={imageScale:2,letterStyle:{font:32*t.scaleText+"px Segoe UI",fontFamily:"Segoe UI Light",fill:"#ffffff",align:"left"}};this.initChallengeTile(i.extend(o,t),e,n,r)};return a.prototype=Object.create(r.prototype),a.prototype.initChallengeTile=function(n,o,a,s){this.challengeMenu=s,this.challenge=o,this.date=a,r.call(this,n),this.label.x=(this.width-this.label.width)/2;var l=new t.Graphics,h=e.Coords.x(2*n.width/3),u=e.Coords.x(n.width/84),d={font:30*(n.scaleText-n.scaleText/5)+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"center"},c=new t.Text(this.challenge.ShortGoalDescription,d),p=new t.Graphics,g={font:32*(n.scaleText-n.scaleText/5)+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"center"},f=e.StringManager("difficulty",null,!0),y=new t.Text(f[this.challenge.Difficulty-1],g);if(y.position.set(e.Coords.x(10),e.Coords.y(42*n.scaleText/2)+4),y.anchor.set(0,.5),l.moveTo(0,0),l.lineStyle(u,16777215,1),l.lineTo(h,0),l.x=(this.width-h)/2,l.y=e.Coords.y(360),this.addChild(l),e.StringManager.shrinkToFit(c,25,"",this.width-e.Coords.x(20)),c.x=(this.width-c.width)/2,c.y=e.Coords.y(375),this.addChild(c),this.challenge.Completed){this.complete=!0;var m=t.Sprite.fromFrame("dailychallenge/ribbon_DC.png");m.x=(this.width-m.width)/2,m.y=e.Coords.y(107),this.addChild(m)}p.beginFill(0,.7),p.drawRect(0,0,this.width,e.Coords.y(46*n.scaleText)),p.endFill(),this.addChild(p),this.addChild(y);var C=[];i.times(this.challenge.Difficulty,function(i){var r=t.Sprite.fromFrame("dailychallenge/challenge_diff_star.png");r.scale.x=r.scale.y=n.scaleText,r.position.set(this.width-r.width-e.Coords.x(10)-i*(r.width+e.Coords.x(5)),e.Coords.y(42*n.scaleText/2)),r.anchor.set(0,.5),this.addChild(r),C.push(r)},this),e.StringManager.shrinkToFit(y,28*e.ScreenMetrics.getResScale(),"",this.width-C.length*C[0].width-e.Coords.x(30)),this.interactive=!0},a.prototype.handleClick=function(){this.date.getMonth(),this.date.getDate(),this.date.getFullYear();this.challengeMenu.game.startGame(n[this.config.mode],this.challenge)},a.prototype.onShow=function(){this.complete!==this.challenge.Completed&&this.challenge.Completed?(this.complete=this.challenge.Completed,this.addRibbon(function(){this.challengeMenu.onChallengeCompleted(this),this.interactive=!0}.bind(this))):this.interactive=!0},a.prototype.onHide=function(){this.completeRibbon&&(this.completeRibbon.alpha=1,this.completeRibbon.scale.x=this.completeRibbon.scale.y=1),this.ribbonTween&&this.ribbonTween.stop(),this.interactive=!1,this.hover.visible=!1},a.prototype.addRibbon=function(i){var n=this;this.completeRibbon||(this.completeRibbon=t.Sprite.fromFrame("dailychallenge/ribbon_DC.png"),this.completeRibbon.anchor.x=this.completeRibbon.anchor.y=.5,this.completeRibbon.x=this.width/2,this.completeRibbon.y=e.Coords.y(200),this.addChildAt(this.completeRibbon,this.children.length-1)),window.setTimeout(function(){e.AudioManager.playSound("dc_ribbonHit"),e.AudioManager.playSound("dc_coinsToBar")},800),this.ribbonTween=new TWEEN.Tween({scale:3,alpha:0}).easing(TWEEN.Easing.Cubic.In).to({scale:1,alpha:1},1e3).onStart(function(){n.completeRibbon.scale.x=n.completeRibbon.scale.y=3,n.completeRibbon.alpha=0}).onUpdate(function(){n.completeRibbon.scale.x=n.completeRibbon.scale.y=this.scale,n.completeRibbon.alpha=this.alpha}).onComplete(function(){window.setTimeout(function(){i()},200)}).start()},a}),define("MenuUI/DailyChallengeCalendar",["pixi","absolute","absolute/stringmanager","absolute/screenmetrics","absolute/coords","MenuUI/Label","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","lodash","absolute/platform","MenuUI/ControlFocusManager","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(t,e,i,n,r){this.initDCDateTile(t,e,i,n,r)};d.font={size:30},d.size={width:218,height:76},d.bgColors={notavailable:932461,notstarted:16730628,started:229628,completed:1819648,futuredate:935045},d.constructor=d,d.prototype=Object.create(t.DisplayObjectContainer.prototype),d.prototype.initDCDateTile=function(i,n,o,a){if(t.DisplayObjectContainer.call(this),this.date=n,this.completed=o,this.onSelected=a,this.available=!1,this.onShow(),this.date){if(this.dayStyle={font:d.font.size+"px Segoe UI",fill:"#ffffff",fontFamily:"segoe",tint:16777215,align:"left"},this.completedStyle={font:d.font.size/1.25+"px Segoe UI",fill:"#ffffff",fontFamily:"segoe",tint:16777215,align:"right"},this.date<new Date?this.available=!0:(this.dayStyle.fill="#0f3a6d",this.completedStyle.fill="#113766"),i>0){var s=new t.Text(i.toString(),this.dayStyle);s.position.set(e.Coords.x(8),e.Coords.y(3)),s.anchor.set(0,0),this.addChild(s)}this.completedLabel=new t.Text(this.completed.toString()+"/5",this.completedStyle),this.completedLabel.position.set(this.width-8,this.height),this.completedLabel.anchor.set(1,1),this.completedLabel.visible=this.date<new Date,this.addChild(this.completedLabel),this.ribbon=t.Sprite.fromFrame("dailychallenge/challenge-perfect-complete.png"),this.ribbon.visible=!1,this.ribbon.x=this.width-this.completedLabel.width-r.x(2),this.ribbon.y=this.height-this.completedLabel.height-r.y(11),this.addChild(this.ribbon)}this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(2.5,16777215),this.focusIndicator.drawRect(0,0,this.width,this.height)},d.prototype.onClick=function(t,i){"function"==typeof this.onSelected&&this.onSelected(this.date,t,i.target),this.selected=t,t||(e.AudioManager.playSound("button"),
this.onHide()),this.onShow()},d.prototype.buildBackground=function(){var e=d.bgColors.notavailable;this.date&&(e=this.completed>0?5===this.completed?d.bgColors.completed:d.bgColors.started:this.date<new Date?d.bgColors.notstarted:d.bgColors.futuredate);var i=new t.Graphics,n=new t.DisplayObjectContainer;return i.beginFill(e),i.drawRect(0,0,r.x(d.size.width),r.y(d.size.height)),i.endFill(),n.addChild(i),this.addChildAt(n,0),n},d.prototype.selectTile=function(){this.selectedOverlay=new t.Graphics,this.selectedOverlay.beginFill(16777215,.3),this.selectedOverlay.lineStyle(r.x(2.5),16777215,1);var i=e.Coords.x(d.size.width),n=e.Coords.y(d.size.height);this.selectedOverlay.drawRect(0,0,i,n),this.selectedOverlay.endFill(),this.addChild(this.selectedOverlay)},Object.defineProperty(d.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,t?this.selectTile():this.removeChild(this.selectedOverlay),this.addHoverGraphic()}}),d.prototype.onHide=function(){this.interactive=!1,this.buttonMode=!1},d.prototype.onShow=function(e){s.isNumber(e)&&(this.completed=e),this.currentBackground&&this.removeChild(this.currentBackground),this.currentBackground=this.buildBackground(),e&&this.completedLabel.setText(e.toString()+"/5"),s.isNumber(e)&&this.date?(this.hitArea=new t.Rectangle(0,0,this.width,this.height),this.mouseup=this.touchstart=this.onClick.bind(this,this.date<new Date),this.interactive=!0,this.buttonMode=!0):(this.mouseup=this.touchstart=function(){},this.interactive=!1,this.buttonMode=!1),!l.supportsTouch()&&this.date&&this.date<=Date.now()&&!this.hoverGraphic&&(this.addHoverGraphic(),this.mouseover=function(t){setTimeout(function(){this.addChild(this.hoverGraphic)}.bind(this),0)},this.mouseout=function(t){this.removeChild(this.hoverGraphic)}),s.isNumber(e)&&e>0&&5===e&&(this.ribbon.visible=!0,this.completedLabel.visible=!1)},d.prototype.addHoverGraphic=function(){this.hoverGraphic&&this.removeChild(this.hoverGraphic),this.hoverGraphic=new t.Graphics,this.hoverGraphic.beginFill(16777215,0),this.hoverGraphic.lineStyle(this._selected?r.x(3.5):r.x(2.5),16777215,1),this.hoverGraphic.drawRect(0,0,e.Coords.x(d.size.width),e.Coords.y(d.size.height)),this.hoverGraphic.endFill()},d.prototype.handleActivate=function(){this.available&&(e.AudioManager.playSound("button"),this.onClick(this.date<new Date,{target:this}))},d.prototype._focusChanged=function(){this._hasFocus?this.addChild(this.focusIndicator):-1!==this.children.indexOf(this.focusIndicator)&&this.removeChild(this.focusIndicator)},Object.defineProperty(d.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}});var c=function(t){this.initDailyChallengeCalendar(t)};return c.constructor=c,c.prototype=Object.create(t.DisplayObjectContainer.prototype),c.prototype.initDailyChallengeCalendar=function(e){t.DisplayObjectContainer.call(this),this.dailyChallengeMenu=e,this.startingHeight=this.dailyChallengeMenu.config.challengesMenuTabHeight-80,this.calendarMenuHeight=this.dailyChallengeMenu.config.calendarMenuHeight-this.dailyChallengeMenu.config.menusShadowSize,this.calendarScaleAdjustment=this.dailyChallengeMenu.config.calendarMenuHeight/580,this.calendarPadding=20,this.calendarMenuTilePadding=10,this.calendarMenuDayOfWeekFontSize=25*this.calendarScaleAdjustment,this.calendarMenuTileHeight=(this.calendarMenuHeight-2*this.calendarPadding-this.calendarMenuDayOfWeekFontSize)/6-this.calendarMenuTilePadding,d.size.height=this.calendarMenuTileHeight,d.font.size=30*this.calendarScaleAdjustment,this.colSpace=r.x(this.calendarMenuTilePadding),this.rowSpace=r.y(this.calendarMenuTilePadding),this.buildColumnHeadings(),this.buildCalendarGrid(),this.hitArea=new t.Rectangle(0,0,this.width,this.height),this.interactive=!0,this.buttonMode=!1,this.initInfoBox(),this.mouseup=this.touchstart=function(t){}},c.prototype.buildColumnHeadings=function(){for(var n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],r=new t.DisplayObjectContainer,o=0;o<n.length;o++){var a=i("daysOfWeekAbbrv."+n[o]),s=new t.Text(a,{fill:"#7fb5f8",font:this.calendarMenuDayOfWeekFontSize+"px Segoe UI",fontFamily:"segoe",align:"left",dropShadow:!0,dropShadowBlur:8,dropShadowColor:"#21456e",dropShadowAngle:0,dropShadowDistance:2});s.position.set(e.Coords.x(this.colSpace+o*(d.size.width+this.colSpace)+(d.size.width-s.width)/2),e.Coords.y(this.startingHeight+this.calendarPadding+this.calendarMenuDayOfWeekFontSize/2)),s.anchor.set(0,.5),r.addChild(s)}this.addChild(r)},c.prototype.initInfoBox=function(){this.infoBox=new t.Graphics,this.infoBox.beginFill(0),this.infoBox.lineStyle(2,16777215,1),this.infoBox.drawRect(0,0,r.x(300),r.x(80)),this.infoBox.endFill(),this.infoBox.x=10,this.infoBox.y=100;var n=new t.Text(i("DailyChallenge.notAvailable"),{font:"Bold 24px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"});i.shrinkToFit(n,24,"",e.Coords.x(290)),n.anchor.y=.5,n.x=r.x(10),n.y=this.infoBox.height/2,this.infoBox.addChild(n),this.infoBox.visible=!1,this.addChild(this.infoBox)},c.prototype.buildCalendarGrid=function(){var e=new Date,i=new Date(e.getFullYear(),e.getMonth(),1),n=i.getDay(),o=null,s=1;this.gridContainer=new t.DisplayObjectContainer,this.dateTiles=[];for(var l,h=0;h<6;h++)for(var u=0;u<7;u++){0===h&&u===n&&(o=i,s=1),l=o?a.GetCompletedChallengeCountForDate(o):0;var c=new d(s,o,l,this.onSelectDay.bind(this));c.x=this.colSpace+u*(c.width+this.colSpace),c.y=this.rowSpace+h*(c.height+this.rowSpace),c.selected=o&&o.getDate()===e.getDate(),this.gridContainer.addChild(c),this.dateTiles.push(c),o&&(o=function(t){return new Date(t.getTime()+864e5)}(o),!function(t,e){return t.getMonth()===e.getMonth()}(i,o)?(o=null,s=1):s++)}this.gridContainer.y=r.y(this.startingHeight+this.calendarPadding+this.calendarMenuDayOfWeekFontSize),this.addChild(this.gridContainer)},c.prototype.onSelectDay=function(t,e,i){e?(s.each(this.dateTiles,function(t){t.selected&&(t.selected=!1,t.onShow())}),this.dailyChallengeMenu.showLobbyForDate(t)):(this.infoBox.visible=!0,this.infoBox.x=i.x+i.width/2,this.infoBox.y=i.y,clearTimeout(this.infoBoxTimeout),this.infoBoxTimeout=setTimeout(function(){this.infoBox.visible=!1}.bind(this),3e3))},c.prototype.onShow=function(t){t||s.each(this.dateTiles,function(t){if(t.date){t.onShow(a.GetCompletedChallengeCountForDate(t.date));try{t.removeChild(this.hoverGraphic)}catch(t){}}})},c.prototype.onHide=function(t){s.each(this.dateTiles,function(t){t.onHide()})},c}),define("MenuUI/DailyChallengeMenu",["pixi","absolute","absolute/stringmanager","lodash","MenuUI/MenuTab","gameconfig","MenuUI/Menu","MenuUI/ChallengeTile","Solitaire/SolitaireGameMode","Solitaire/Solitaire","MenuUI/GameEndDialog","MenuUI/MsftButton","MenuUI/DailyChallengeCalendar","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","MenuUI/ColorConstants","MenuUI/DailyChallengeProgressMeter","MenuUI/DealWarningModal","MenuUI/BadgeEarnedDialog","util/SettingsManager","MenuUI/ControlFocusManager","audiosprites","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v){var w=function(t,e){this.initDailyChallengeMenu(t,e)};return w.prototype=Object.create(e.Screen.prototype),w.prototype.constructor=w,w.prototype.initDailyChallengeMenu=function(n,r){e.Screen.call(this),this.ui=n,this.game=r,this.manualConfig={navigationBarHeight:this.game.menuBar.y+this.game.menuBar.menuButton.height,page:"The page that all content resides within.",pageWidth:1920,pagePadding:70,pageMenuSpacing:40,menusShadowSize:20,challengesMenu:"The menu that has each challenge tile within.",challengesMenuPadding:20,challengesMenuTabHeight:80,challengesMenuTabWidth:600,challengeTile:"The tile that when selected takes you to the game challenge for that day.",challengeTileHeight:475,challengeTileWidth:0,challengeTileTilesCount:5,challengeTileTilesPerRow:1,challengeTileSpacingBetween:20,calendarMenu:"The menu that has the calendar showing selectable days to view challenges for that day.",calendarMenuMinimumHeight:580,progressMenu:"The menu that displays current progress of badge completion.",progressMenuHeight:300,progressMenuScale:1,heightOffset:0,widthOffset:0},this.menuContainer=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer,this.firstRun=!0,this.calculateConfigValues(),this.dataInitialized=!1,this.artInitialized=!1;var o=t.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(o),this.date=new Date,this.originalDate=new Date,this.months=i("months",null,!0),this.settingsManager=C,this.controlsGroupMap={},this.controlFocusManager=new S,this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),v.addElement(this,{scaleChangeSource:"Full"})},w.prototype.updateMenuTextures=function(){this.completeInit()},w.prototype.calculateConfigValues=function(){this.resizeUpdateTextures=!1,e.Platform.isMobile()?e.ScreenMetrics.isPortrait()?3!==this.manualConfig.challengeTileTilesPerRow&&(this.manualConfig.challengeTileTilesPerRow=3,this.manualConfig.challengesMenuTabHeight=120,this.manualConfig.challengesMenuTabWidth=600,this.manualConfig.progressMenuScale=1.75,this.manualConfig.heightOffset=-320,this.resizeUpdateTextures=!0):5!==this.manualConfig.challengeTileTilesPerRow&&(this.manualConfig.challengeTileTilesPerRow=5,this.manualConfig.challengesMenuTabHeight=80,this.manualConfig.challengesMenuTabWidth=400,this.manualConfig.progressMenuScale=1.25,this.manualConfig.heightOffset=-160,this.resizeUpdateTextures=!0):v.width<1e3?3!==this.manualConfig.challengeTileTilesPerRow&&(this.manualConfig.challengeTileTilesPerRow=3,this.manualConfig.challengesMenuTabHeight=120,this.manualConfig.challengesMenuTabWidth=500,this.manualConfig.progressMenuScale=1.75,this.manualConfig.heightOffset=-320,this.resizeUpdateTextures=!0):5!==this.manualConfig.challengeTileTilesPerRow&&(this.manualConfig.challengeTileTilesPerRow=5,this.manualConfig.challengesMenuTabHeight=80,this.manualConfig.challengesMenuTabWidth=400,this.manualConfig.progressMenuScale=1,this.manualConfig.heightOffset=-200,this.resizeUpdateTextures=!0);const t=Math.ceil(this.manualConfig.challengeTileTilesCount/this.manualConfig.challengeTileTilesPerRow),i=2*this.manualConfig.challengesMenuPadding+t*(this.manualConfig.challengeTileSpacingBetween+this.manualConfig.challengeTileHeight)-this.manualConfig.challengeTileSpacingBetween+5*t,r=i>this.manualConfig.calendarMenuMinimumHeight?i:this.manualConfig.calendarMenuMinimumHeight,o=this.manualConfig.pageWidth+2*this.manualConfig.menusShadowSize-2*this.manualConfig.pagePadding+this.manualConfig.widthOffset,a=this.manualConfig.progressMenuHeight+this.manualConfig.navigationBarHeight+this.manualConfig.challengesMenuTabHeight+(i>r?i:r)+this.manualConfig.pageMenuSpacing+2*this.manualConfig.menusShadowSize+this.manualConfig.heightOffset;this.calculatedConfig={challengesMenuHeight:i,challengeTileWidth:(o-this.manualConfig.menusShadowSize-2*this.manualConfig.challengesMenuPadding-(this.manualConfig.challengeTileTilesPerRow-1)*this.manualConfig.challengeTileSpacingBetween)/this.manualConfig.challengeTileTilesPerRow,calendarMenuHeight:r,menusWidth:o,menusHeight:a,pageWidth:this.manualConfig.pageWidth,pageHeight:a+2*this.manualConfig.pagePadding},this.config={},n.extend(this.config,this.manualConfig),n.extend(this.config,this.calculatedConfig),!0===this.resizeUpdateTextures&&!1===this.firstRun&&this.updateMenuTextures()},w.prototype.handleResize=function(){this.calculateConfigValues(),this.container&&(this.menuContainer.width=this.config.menusWidth*(v.height/this.config.pageHeight)*(this.config.pageWidth/v.width)*((this.game.ui.height-this.game.menuBar.menuButton.height-this.game.menuBar.y-100)/this.config.menusHeight),this.menuContainer.height=this.config.menusHeight/this.config.pageHeight*(this.config.menusWidth/this.config.pageWidth)*(this.game.ui.height-this.game.menuBar.menuButton.height-this.game.menuBar.y+0),this.setMenuContainerPosition(),this.menuContainer.x<=this.config.pagePadding&&(this.menuContainer.height=this.config.menusHeight*(v.width/this.config.pageWidth)*(this.config.pageHeight/v.height)*((this.game.ui.width-this.game.menuBar.menuButton.width-0)/this.config.menusWidth),this.menuContainer.width=this.config.menusWidth/this.config.pageWidth*(this.config.menusHeight/this.config.pageHeight)*(this.game.ui.width-this.game.menuBar.menuButton.width+300)),this.setMenuContainerPosition(),this.calendar&&(this.calendar.y=e.Coords.y(95),this.calendar.x=e.Coords.x(901)-this.calendar.width/2))},w.prototype.buildTileTextures=function(){function i(i,n,r,o){var a=t.Sprite.fromFrame(n),s=new t.Graphics,l=new t.DisplayObjectContainer;s.beginFill(i),s.drawRect(0,0,e.Coords.x(o.challengeTileWidth),e.Coords.y(o.challengeTileHeight)),s.endFill(),l.addChild(s),a.x=(l.width-a.width)/2,a.y=(l.height-a.height)/2,l.addChild(a),t.Texture.addTextureToCache(l.generateTexture(),r)}i(g.Klondike,"game_mode_tile_icons/icon_tile_klondike.png","dailychallenge/DC_tile_klondike.png",this.config),i(g.Spider,"game_mode_tile_icons/icon_tile_spider.png","dailychallenge/DC_tile_spider.png",this.config),i(g.FreeCell,"game_mode_tile_icons/icon_tile_freecell.png","dailychallenge/DC_tile_freecell.png",this.config),i(g.Pyramid,"game_mode_tile_icons/icon_tile_pyramid.png","dailychallenge/DC_tile_pyramid.png",this.config),i(g.TriPeaks,"game_mode_tile_icons/icon_tile_tripeaks.png","dailychallenge/DC_tile_tripeaks.png",this.config)},w.prototype.loadArtAssets=function(t,i){var r=new e.Loader,o=[{name:"dc_menu"}],a=[];n.forEach(b,function(t){"challenge"===t.loadgroup&&(e.AudioManager.soundLoaded(t.id)||(t.lazyload=!1,a.push(t)))}),r.loadSound(a,function(t){},function(){}),r.loadAtlases(o,function(t){e.Debug.log("loading dc menu assets ",t)}.bind(this),t,i)},w.prototype.onShow=function(){this.ui.showLoadingScreen();var t=new Date;this.originalDate.getMonth()!==t.getMonth()&&(this.originalDate=t,this.date=t,this.dataInitialized=!1,this.firstRun=!0),this.dataInitialized?this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),this.showError.bind(this)):p.Initialize(function(){this.dataInitialized=!0,this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),this.showError.bind(this))}.bind(this),this.showLoadError.bind(this)),this.handleResize()},w.prototype.onHide=function(){this.progressMeter&&this.progressMeter.onHide(),this.lobbyMenu&&this.lobbyMenu.onHide(),this.resetControlManager(),this.controlFocusManager.removeAllControls()},w.prototype.completeInit=function(){var i=new Date;(this.firstRun||this.resizeUpdateTextures)&&(this.menuContainer&&this.menuContainer.children.length>1&&this.menuContainer.removeChildren(0,this.menuContainer.children.length-1),this.container&&this.container.children.length>1&&this.container.removeChildren(0,this.container.children.length-1),this.menuContainer||(this.menuContainer=new t.DisplayObjectContainer),this.container||(this.container=new t.DisplayObjectContainer),this.buildTileTextures(),this.buildTabs(),this.buildProgressMeter(),this.container.addChild(this.tabsContainer),this.container.addChild(this.progressMeter),this.menuContainer.addChild(this.container),p.dataNotExists&&this.settingsManager.getSetting("general","showDCFUE")&&(p.dataNotExists=!1,this.buildFUE(),this.settingsManager.setSetting("general","showDCFUE",!1)),!p.dataNotExists&&this.settingsManager.getSetting("general","showDCFUE")&&this.settingsManager.setSetting("general","showDCFUE",!1)),this.originalDate.getDate()<i.getDate()&&this.progressMeter.onDateChange(this.months[i.getMonth()]),this.lobbyMenu&&this.lobbyMenu.onShow(),this.resizeUpdateTextures||(this.addChild(this.game.menuBar),this.addChild(this.menuContainer),this.game.menuBar.onShow(!0,!0,!1,e.StringManager("titles.dailyChallenges"))),this.progressMeter&&this.progressMeter.onShow(this.firstRun||this.resizeUpdateTextures),this.firstRun&&(this.firstRun=!1),this.initControls(),this.ui.hideLoadingScreen(),this.updateTheme(),this.menuContainer.height=this.game.ui.height-this.game.menuBar.menuButton.height-this.game.menuBar.y,this.menuContainer.width=this.config.menusWidth,this.setMenuContainerPosition(),this.resizeUpdateTextures||this.handleResize(),this.resizeUpdateTextures=!1},w.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons"),this.controlsGroupMap.ProgressMeter=this.progressMeter.getControls(),this.controlsGroupMap.BottomButtons=[this.progressMeter.awardsButton];for(var t=["LeftButtons","RightButtons","Tabs","Calendar","ChallengeTiles","ProgressMeter","BottomButtons"],e=0;e<t.length;e++)if(this.controlsGroupMap.hasOwnProperty(t[e]))for(var i=0;i<this.controlsGroupMap[t[e]].length;i++)this.controlFocusManager.addControl(this.controlsGroupMap[t[e]][i],!1,t[e])},w.prototype.updateTheme=function(){var t,e;t=e=C.getSetting("theme","selected"),"classic"===e&&(t="dailychallenge"),this.challengeTiles.forEach(function(e){e.challenge.theme=t})},w.prototype.buildTabs=function(){var o=this.months[this.date.getMonth()]+" "+this.date.getDate();"fr-CA"!==e.StringManager.getUserLanguage()&&"fr-FR"!==e.StringManager.getUserLanguage()||(o=this.date.getDate()+" "+this.months[this.date.getMonth()].toLowerCase());var a=[{id:"lobby",label:o,labelIcon:"dailychallenge/tabicon_day.png",labelIconScale:this.config.challengesMenuTabHeight/80,content:this.buildLobby(this.date),color:1931123,borderColor:5021338,tabWidth:e.Coords.x(this.config.challengesMenuTabWidth),tabPosition:e.Coords.x(this.config.challengesMenuPadding),tabHeight:e.Coords.y(this.config.challengesMenuTabHeight-this.config.challengesMenuTabHeight/5),tabHeightSelected:e.Coords.y(this.config.challengesMenuTabHeight),height:e.Coords.y(this.config.challengesMenuHeight),width:e.Coords.x(this.config.menusWidth),selected:!0,hoverBorderColor:7843244,letterStyle:{font:e.ScreenMetrics.getResScale()*this.config.challengesMenuTabHeight/2+"px Segoe UI",fontFamily:"segoe",fill:"#a1d3c1",tint:10605505,align:"left"}},{id:"calendar",label:i("DailyChallenge.calendar"),labelIcon:"dailychallenge/tabicon_calendar.png",labelIconScale:this.config.challengesMenuTabHeight/80,content:this.buildCalendar(),color:2840975,borderColor:4759502,tabWidth:e.Coords.x(this.config.challengesMenuTabWidth),tabPosition:e.Coords.x(this.config.challengesMenuPadding+this.config.challengesMenuTabWidth),tabHeight:e.Coords.y(this.config.challengesMenuTabHeight-this.config.challengesMenuTabHeight/5),tabHeightSelected:e.Coords.y(this.config.challengesMenuTabHeight),height:e.Coords.y(this.config.calendarMenuHeight),width:e.Coords.x(this.config.menusWidth),selected:!1,letterStyle:{font:e.ScreenMetrics.getResScale()*this.config.challengesMenuTabHeight/2+"px Segoe UI",fontFamily:"segoe",fill:"#75bbe1",tint:7715809,align:"left"}}];this.tabsContainer&&this.container.removeChild(this.tabsContainer),this.tabs=[],this.tabsContainer=new t.DisplayObjectContainer,this.controlsGroupMap.Tabs=[],n.each(a,function(t){t.tabWidth=e.Coords.x(t.tabWidth),t.tabPosition=e.Coords.x(t.tabPosition),t.selectedCallback=this.tabSelected.bind(this);var i=new r(t);t.selected&&(this.selectedTab=i),this.tabs.push(i),this.tabsContainer.addChildAt(i,0),this.controlsGroupMap.Tabs.push(i)},this)},w.prototype.setMenuContainerPosition=function(){this.menuContainer.x=this.game.ui.width/2-this.menuContainer.width/2,this.menuContainer.y=this.game.menuBar.y+this.game.menuBar.menuButton.height+e.Coords.y(this.config.pagePadding)},w.prototype.tabSelected=function(t){e.AudioManager.playSound("button"),this.selectedTab.onHide(),this.progressMeter&&this.progressMeter.onHide(),this.selectedTab.updateState(!1),this.tabsContainer.addChild(t),this.selectedTab=t,this.selectedTab.onShow()},w.prototype.buildLobby=function(t){this.challengeTiles=[];var i=p.CreateDailyChallenges(t);this.config.challengeTileTilesCount=i.length,this.controlFocusManager.removeControls("ChallengeTiles"),this.controlsGroupMap.ChallengeTiles=[],n.each(i,function(i){var r=n.cloneDeep(this.getTileConfig(i.config.Data.GameMode));r.height=e.Coords.y(this.config.challengeTileHeight),r.width=e.Coords.x(this.config.challengeTileWidth),r.scaleText=.5+2.5/this.config.challengeTileTilesPerRow,r.labelPosition.y=e.Coords.y(r.labelPosition.y),r.isDailyChallenge=!0;var o=new s(r,i,t,this);this.challengeTiles.push(o),this.controlsGroupMap.ChallengeTiles.push(o)},this);var r=n.cloneDeep(v.scaleParams.MenuConfigs.DCMenuConfigs);return r.tiles=this.challengeTiles,r.width=e.Coords.x(this.config.menusWidth-this.config.menusShadowSize),r.tilePaddingX=e.Coords.x(this.config.challengeTileSpacingBetween),r.tilePaddingY=e.Coords.y(this.config.challengeTileSpacingBetween),this.lobbyMenu=new a(r),this.lobbyMenu.x=e.Coords.x(this.config.challengesMenuPadding),this.lobbyMenu.y=e.Coords.y(this.config.challengesMenuTabHeight+this.config.challengesMenuPadding),this.updateTheme(),this.lobbyMenu},w.prototype.buildCalendar=function(){return this.calendar=new c(this),this.controlsGroupMap.Calendar=this.calendar.dateTiles,this.calendar},w.prototype.showLobbyForDate=function(t){this.date=t,this.tabs[0].setLabel(this.months[t.getMonth()]+" "+t.getDate()),this.tabs[0].setContent(this.buildLobby(t)),this.tabs[0].setSelected(),this.controlFocusManager.removeAllControls(),this.initControls()},w.prototype.getTileConfig=function(t){return o.UI.dailyChallenges.lobby[t]},w.prototype.buildProgressMeter=function(){this.progressMeter&&this.container.removeChild(this.progressMeter);var t={scale:this.config.progressMenuScale,height:this.config.progressMenuHeight,month:this.months[this.date.getMonth()]};this.progressMeter=new f(t,this,this.ui),this.progressMeter.y=e.Coords.y(this.tabsContainer.y+this.config.challengesMenuTabHeight+(this.config.challengesMenuHeight>this.config.calendarMenuHeight?this.config.challengesMenuHeight:this.config.calendarMenuHeight)+this.config.pageMenuSpacing)},w.prototype.onChallengeCompleted=function(t){this.handleResize(),this.progressMeter.updateProgress([t])},w.prototype.buildFUE=function(){var t=this,n=new m(this.ui,this.game,{dialog:"DC-FUE-1",width:e.Coords.x(1300),buttonText:i("buttons.next"),closeHandler:function(){r.open()}.bind(this)}),r=new m(this.ui,this.game,{dialog:"DC-FUE-2",width:e.Coords.x(1400),height:e.Coords.x(900),buttonY:800,buttonText:i("buttons.next"),contentInitialized:function(){"fr-CA"===e.StringManager.getUserLanguage()||"fr-FR"===e.StringManager.getUserLanguage()?(this.setText("title",i("dc_fue.fue2.headline",[t.months[t.date.getMonth()].toLowerCase()])),this.setText("bodyCopy",i("dc_fue.fue2.description",[t.months[t.date.getMonth()].toLowerCase()]))):(this.setText("title",i("dc_fue.fue2.headline",[t.months[t.date.getMonth()]])),this.setText("bodyCopy",i("dc_fue.fue2.description",[t.months[t.date.getMonth()]])));var n={font:"Bold "+30*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ebeabc",align:"left"},r=t.progressMeter.getInfoBox(t.progressMeter.medalReferences.Bronze.coinsNeeded.toString(),!0,n),o=t.progressMeter.getInfoBox(t.progressMeter.medalReferences.Silver.coinsNeeded.toString(),!0,n),a=t.progressMeter.getInfoBox(t.progressMeter.medalReferences.Gold.coinsNeeded.toString(),!0,n),s=t.progressMeter.getInfoBox(t.progressMeter.medalReferences.Diamond.coinsNeeded.toString(),!0,n);r.x=e.Coords.x(30),o.x=e.Coords.x(365),a.x=e.Coords.x(695),s.x=e.Coords.x(1030),r.y=o.y=a.y=s.y=e.Coords.y(590),r.visible=o.visible=a.visible=s.visible=!0,this.contentContainer.addChild(r),this.contentContainer.addChild(o),this.contentContainer.addChild(a),this.contentContainer.addChild(s)},closeHandler:function(){o.open()}.bind(this)}),o=new m(this.ui,this.game,{dialog:"DC-FUE-3",width:e.Coords.x(1300),closeHandler:function(){}.bind(this)});n.open()},w.prototype.showLoadError=function(){this.ui.showWarning(i("dialogs.manifestWarningHeadline"),i("dialogs.manifestWarningContent"),function(){this.ui.hideLoadingScreen(),this.game.navBack()}.bind(this))},w.prototype.handleCommand=function(t){switch(this.selectSection(t),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},w.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("LeftButtons");break;case 1:this.controlFocusManager.setFocusGroup("RightButtons");break;case 2:this.controlFocusManager.setFocusGroup("Tabs");break;case 3:this.controlFocusManager.setFocusGroup("ChallengeTiles");break;case 4:this.controlFocusManager.setFocusGroup("ProgressMeter");break;case 5:this.controlFocusManager.setFocusGroup("BottomButtons")}},w.prototype.selectSection=function(t){var e=this.tabs.indexOf(this.selectedTab);if("Tab"===t||"ShiftTab"===t)switch(this.sectionSelected=!0,"Tab"===t?5===this.page?(this.handlePageChange(this.page,0),this.page=0):((0===e&&"Tabs"===this.controlFocusManager.currentFocusGroup||1===e&&"Calendar"===this.controlFocusManager.currentFocusGroup)&&this.controlFocusManager.nextFocusGroup(),this.controlFocusManager.nextFocusGroup()):"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,5),this.page=5):((0===e&&"ChallengeTiles"===this.controlFocusManager.currentFocusGroup||1===e&&"ProgressMeter"===this.controlFocusManager.currentFocusGroup)&&this.controlFocusManager.prevFocusGroup(),this.controlFocusManager.prevFocusGroup())),this.controlFocusManager.currentFocusGroup){case"LeftButtons":this.page=0;break;case"RightButtons":this.page=1;break;case"Tabs":this.page=2;break;case"ChallengeTiles":this.page=3;break;case"ProgressMeter":this.page=4;break;case"BottomButtons":this.page=5}},w.prototype.handleGameInput=function(){this.resetControlManager()},w.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},w}),define("MenuUI/StarClubCollectionTile",["lodash","pixi","absolute/stringmanager","absolute/screenmetrics","absolute/coords","absolute/spriteutils","absolute/audiomanager","absolute/particleemitter","Managers/StatManager","MenuUI/MenuTile","MenuUI/Label"],function(t,e,i,n,r,o,a,s,l,h,u){"use strict";var d=function(e,i,n){var r={};this.initStarClubCollectionTile(t.extend(r,e),i,n)};return d.constructor=d,d.prototype=Object.create(h.prototype),d.prototype.initStarClubCollectionTile=function(t,o,a){h.call(this,t),this.collection=o,this.menu=a,this.progressOverlay=e.Sprite.fromFrame("star_club/sc_tile_info_rect.png"),this.progressOverlay.y=this.height-this.progressOverlay.height;var s={icon:null,text:"",maxWidth:r.x(260),letterStyle:{font:26*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"}};s.text=this.collection.NumPacksCompleted+"/"+this.collection.NumPacks+" "+i("starClub.packsCompleted"),this.packProgressLabel=new u(s),this.packProgressLabel.pivot.set(this.progressOverlay.width/2,this.packProgressLabel.height/2),this.packProgressLabel.x=this.progressOverlay.width/2+r.x(30),this.packProgressLabel.y=this.progressOverlay.height-r.y(10),this.progressOverlay.addChild(this.packProgressLabel);var l={icon:"star_club/sc_tile_info_star.png",text:"",letterStyle:{font:22*n.getResScale()+"px Segoe UI",fill:"#FDEF39",fontFamily:"segoe",tint:16641849,align:"left"}};if(l.text=this.collection.NumStarsEarned+"/"+this.collection.NumStars,this.starProgressLabel=new u(l),this.starProgressLabel.x=this.progressOverlay.width-this.starProgressLabel.width-r.x(10),this.starProgressLabel.y=r.y(10),this.progressOverlay.addChild(this.starProgressLabel),o.PriceOfUnlocking>0&&!o.Unlocked){this.lockedOverlay=new e.Graphics,this.lockedOverlay.beginFill(0,.5),this.lockedOverlay.drawRect(0,0,this.width-r.x(20),this.height-r.y(20)),this.lockedOverlay.position.set(0,r.y(20)),this.lockGroup=new e.DisplayObjectContainer;var c=new u({icon:"star_club/sc_tile_info_star.png",text:o.PriceOfUnlocking.toString(),letterStyle:{font:30*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center"}});c.x=(this.lockedOverlay.width-c.width)/2,this.lockGroup.addChild(c);var p=new u({icon:null,text:i("starClub.toUnlock"),maxWidth:r.x(280),letterStyle:{font:30*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center"}});p.x=(this.lockedOverlay.width-p.width)/2,p.y=c.y+c.height+r.y(5),this.lockGroup.addChild(p),this.lockIcon=e.Sprite.fromFrame("star_club/SC_challenge_lock.png"),this.lockIcon.x=(this.lockedOverlay.width-this.lockIcon.width)/2,this.lockIcon.y=p.y+p.height+r.y(15),this.lockGroup.addChild(this.lockIcon),this.lockGroup.x=0,this.lockGroup.y=(this.lockedOverlay.height-this.lockGroup.height)/2,this.lockedOverlay.addChild(this.lockGroup),this.addChild(this.lockedOverlay)}else this.addChild(this.progressOverlay);this.initTooltip(),this.updateCrown(!1),window.addEventListener("mousedown",function(t){d.lastInfoBox&&(d.lastInfoBox.visible=!1)})},d.prototype.updatePackProgress=function(){this.packProgressLabel.setText(this.collection.NumPacksCompleted+"/"+this.collection.NumPacks+" "+i("starClub.packsCompleted"))},d.prototype.updateStarProgress=function(){this.starProgressLabel.setText(this.collection.NumStarsEarned+"/"+this.collection.NumStars),this.starProgressLabel.x=this.progressOverlay.width-this.starProgressLabel.width-r.x(10)},d.prototype.onShow=function(){this.updatePackProgress(),this.updateStarProgress(),this.updateCrown(!0),this.collection.Unlocked&&!this.animateUnlockComplete&&l.GetValue("SCGlobalStarsEarned")>=this.collection.PriceOfUnlocking&&(this.removeChild(this.lockedOverlay),this.addChild(this.progressOverlay)),this.interactive=!0},d.prototype.handleClick=function(){this.collection.Unlocked?h.prototype.handleClick.call(this):l.GetValue("SCGlobalStarsEarned")>=this.collection.PriceOfUnlocking?this.animateUnlock():(d.lastInfoBox&&(d.lastInfoBox.visible=!1),d.lastInfoBox=this.infoBoxContainer,this.infoBoxContainer.openBox(),this.interactive=!0)},d.prototype.animateUnlock=function(){this.collection.Unlocked=!0,this.unlockAnimation=o.loadMovieClip("unlock_animation/unlocking-animation_",30,1),this.unlockAnimation.animationSpeed=.5,this.unlockAnimation.loop=!1,this.unlockAnimation.scale.x=this.unlockAnimation.scale.y=1.45,this.unlockAnimation.x=r.y(3)+(this.lockedOverlay.width-this.unlockAnimation.width)/2,this.unlockAnimation.y=r.y(65)+(this.lockedOverlay.width-this.unlockAnimation.height)/2,this.lockGroup.removeChild(this.lockIcon),this.lockedOverlay.addChild(this.unlockAnimation),this.unlockAnimation.onComplete=function(){this.removeChild(this.lockedOverlay),this.addChild(this.progressOverlay),this.interactive=!0,this.animateUnlockComplete=!0}.bind(this),a.playSound("sc_starFlying_isolated"),this.menu.game.menuBar.starCountDisplay.triggerStarAnimation(this,!0,function(){a.playSound("sc_starUnlock"),this.unlockAnimation.gotoAndPlay(0),this.menu.game.menuBar.starCountDisplay.triggerStarAnimation(this,!1)}.bind(this))},d.prototype.updateCrown=function(t){if(this.collection.NumStarsEarned===this.collection.NumStars&&!this.crown){var i=this;if(this.crown=e.Sprite.fromFrame("star_club/crown.png"),this.crown.anchor.x=this.crown.anchor.y=.5,this.crown.x=this.width/2,this.crown.y=this.height/2,this.addChild(this.crown),t){a.playSound("CrownAppearance");var n=[e.Texture.fromFrame("particle_glow_yellow.png")],r=[e.Texture.fromFrame("Star_orng_dot.png"),e.Texture.fromFrame("Star_yellow_dot.png"),e.Texture.fromFrame("Star_yel.png")],o={rate:{numpan:{a:8,b:12,center:!0},timepan:{a:.01,b:.002,
center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.2,.5,1],alpha:{a:1,b:0},scale:{a:[.5,1],b:0,center:null},gravity:0,life:{a:1,b:1.5,center:null},radius:1,crossZone:null,randomDrift:null},l={rate:{numpan:{a:2,b:4,center:!0},timepan:{a:.01,b:.002,center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.5,1],alpha:{a:.5,b:0},scale:{a:[.3,.3,.5],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,crossZone:null,randomDrift:null},h=new s(this.menu.ui,n,o),u=new s(this.menu.ui,r,l),i=this;this.addChild(h),this.addChild(u),h.x=u.x=this.crown.x,h.y=u.y=this.crown.y,this.crown.alpha=0,h.start();new TWEEN.Tween({alpha:0}).easing(TWEEN.Easing.Exponential.In).to({alpha:1},1200).onStart(function(){window.setTimeout(function(){h.stop()},600)}).onUpdate(function(){i.crown.alpha=this.alpha}).start(),new TWEEN.Tween({scale:1}).delay(500).easing(TWEEN.Easing.Elastic.Out).to({scale:[1.5,1]},1500).onStart(function(){window.setTimeout(function(){u.start()},700)}).onUpdate(function(){i.crown.scale.x=i.crown.scale.y=this.scale}).onComplete(function(){u.stop(),window.setTimeout(function(){i.removeChild(h),i.removeChild(u),h.destroy(),u.destroy()},2e3)}).start()}}},d.prototype.initTooltip=function(){this.infoBoxContainer=new e.DisplayObjectContainer;var t=new e.Graphics,o={font:19*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",wordWrap:!0,wordWrapWidth:this.width},a=new e.Text(i("starClub.tooltip"),o);t.beginFill(0),t.lineStyle(3,16777215,1),t.drawRect(0,0,this.width+r.x(10),a.height+r.y(10)),t.endFill(),a.x=r.x(7),a.y=r.y(10),this.infoBoxContainer.addChild(t),this.infoBoxContainer.addChild(a),this.infoBoxContainer.visible=!1,this.infoBoxContainer.x=this.width/2-this.infoBoxContainer.width/2,this.onOpenBox(this.infoBoxContainer,a)},d.prototype.onOpenBox=function(t,e){this.infoBoxContainer.openBox=function(){var i=l.GetValue("SCGlobalStarsEarned");t.visible=!0,t.x=this.width/2-t.width/2,t.y=-r.y(75),e.text=e.text.replace("$$$",this.collection.PriceOfUnlocking-i),e.updateText(),t.visible&&(this.addChild(t),new TWEEN.Tween({alpha:0}).easing(TWEEN.Easing.Cubic.InOut).to({alpha:1},350).onUpdate(function(e){t.alpha=this.alpha}).start(),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(function(){var e=new TWEEN.Tween({alpha:1}).easing(TWEEN.Easing.Cubic.InOut).to({alpha:0},350);e.start(),e.onUpdate(function(){t.alpha=this.alpha}),e.onComplete(function(){t.visible=!1})},3e3))}.bind(this)},d}),define("MenuUI/StarClubMenu",["lodash","pixi","absolute","absolute/stringmanager","absolute/screenmetrics","Solitaire/MvvmStructure/Service/SolitaireStarClubService","MenuUI/Menu","MenuUI/StarClubCollectionTile","MenuUI/MultiPageMenu","MenuUI/ColorConstants","MenuUI/DealWarningModal","Managers/StatManager","MenuUI/BadgeEarnedDialog","util/SettingsManager","MenuUI/ControlFocusManager","MenuUI/SideBar","audiosprites","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C){"use strict";var S=function(t,e){this.initStarClubMenu(t,e)};return S.prototype=Object.create(i.Screen.prototype),S.prototype.constructor=S,S.prototype.initStarClubMenu=function(t,n){i.Screen.call(this),this.ui=t,this.game=n,this.dataInitialized=!1,this.artInitialized=!1,this.firstRun=!0,this.settingsManager=p,this.paginatedMenu=null,this.currentPageIndex=0,this.sectionSelected=!1;var r=e.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(r),this.collectionGroupContainer=new e.DisplayObjectContainer,this.addChild(this.collectionGroupContainer),this.controlFocusManager=new g,this.scrollEventHandler=this.doScroll.bind(this),this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),m.addElement(this,{scaleChangeSource:"Full"})},S.prototype.handleResize=function(){this.scrollable&&(this.scrollTo(this.scrollable.y),this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width*this.container.children[0].pageGenerator.cardScale/m.width)*(m.height/i.Coords.y(985)),this.updatePagesPositions(),this.scrollable.height=this.currentWidth/this.container.width*(i.Coords.y(985)/m.height)*(m.width/i.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.scrollableFakeHeight=this.scrollable.height+i.Coords.x(150),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<i.Coords.y(1080)&&(this.scrollable.y=i.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar())},S.prototype.updatePagesPositions=function(){var t,e=this.container.width/this.currentWidth,n=i.Coords.x(50),r=i.Coords.y(70)*e,o=i.Coords.y(90)*e;this.currentHeight=i.Coords.y(140),this.container.children.forEach(function(e){e.x=n,e.y=t?t.y+t.height+r:o,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},S.prototype.buildTileTextures=function(){function t(t,n,r){var o=e.Sprite.fromFrame(n),a=new e.Graphics,s=new e.DisplayObjectContainer;a.beginFill(t),a.drawRect(0,0,i.Coords.x(328),i.Coords.y(352)),a.endFill(),s.addChild(a),o.x=(s.width-o.width)/2,o.y=(s.height-o.height)/2,s.addChild(o),e.Texture.addTextureToCache(s.generateTexture(),r)}t(h.Klondike,"game_mode_tile_icons/icon_tile_klondike.png","dailychallenge/SC_tile_klondike.png"),t(h.Spider,"game_mode_tile_icons/icon_tile_spider.png","dailychallenge/SC_tile_spider.png"),t(h.FreeCell,"game_mode_tile_icons/icon_tile_freecell.png","dailychallenge/SC_tile_freecell.png"),t(h.Pyramid,"game_mode_tile_icons/icon_tile_pyramid.png","dailychallenge/SC_tile_pyramid.png"),t(h.TriPeaks,"game_mode_tile_icons/icon_tile_tripeaks.png","dailychallenge/SC_tile_tripeaks.png")},S.prototype.onCollectionsLoaded=function(){for(o.UpdateGlobalStarClubStats();this.collectionGroupContainer.children.length>0;)this.collectionGroupContainer.removeChildAt(0);this.collectionGroupMenus=[],this.controlsGroupMap={};var n=[];o.CollectionGroups.reverse(),t.forEach(o.CollectionGroups,function(e){var r=[];t.forEach(e.Collections,function(t){var n={userData:t,image:t.icon,icon:"",label:"",action:null,letterStyle:{font:33*i.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},iconPosition:{x:0,y:0},labelPosition:{x:i.Coords.x(88),y:0},labelPadding:i.Coords.y(15),labelOffset:i.Coords.y(22),dropShadow:!0,hoverBox:!0};n.action=this.onCollectionSelected.bind(this);var o=new s(n,t,this);r.push(o),this.controlsGroupMap[e.Name]=this.controlsGroupMap[e.Name]||[],this.controlsGroupMap[e.Name].push(o)},this);var o=t.extend({tiles:r},m.scaleParams["SC-CollectionGroupsMenuConfigs"][e.Name]),l=new a(t.extend(o,m.scaleParams.MenuConfigs.SCMenuConfigs));this.collectionGroupMenus.push(l),l.onShow(),n.push(l)},this),this.currentWidth=i.Coords.x(1840),this.scrollable=new e.DisplayObjectContainer,this.container=new e.DisplayObjectContainer,n.forEach(function(t){this.container.addChild(t)}.bind(this)),this.updatePagesPositions(),this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth,this.handleResize()},S.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var t=new e.Rectangle(0,0,i.Coords.x(1920),i.Coords.y(1080));this.touchContainer=new e.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=t,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},S.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},S.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)),this.lastDeltaY=i}},S.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},S.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},S.prototype.loadArtAssets=function(e,n){var r=new i.Loader,o=[{name:"dc_menu"}],a=[];t.forEach(y,function(t){"challenge"==t.loadgroup&&(i.AudioManager.soundLoaded(t.id)||(t.lazyload=!1,a.push(t)))}),r.loadSound(a,function(t){},function(){}),r.loadAtlases(o,function(t){i.Debug.log("loading dc menu assets ",t)}.bind(this),e,n)},S.prototype.onShow=function(t){i.Screen.prototype.onShow.call(this),this.scrollable&&(this.scrollable.y=0),this.ui.showLoadingScreen(),this.dataInitialized?this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),this.showError.bind(this)):o.Initialize(function(){this.dataInitialized=!0,this.onCollectionsLoaded(),this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),this.showError.bind(this))}.bind(this),this.showLoadError.bind(this)),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0),this.handleResize(),C.add(this,this.doScroll,this)},S.prototype.completeInit=function(){this.initControls(),this.initTouchInterface(),this.updateTheme();var t=i.StringManager("titles.starClub");if(this.game.menuBar.onShow(!0,!0,this.collectionGroupMenus&&this.collectionGroupMenus.length>0,t),this.ui.refreshBackground=!0,this.firstRun?(this.buildTileTextures(),this.settingsManager.getSetting("general","showSCFUE")&&(this.buildFUE(),this.settingsManager.setSetting("general","showSCFUE",!1)),this.firstRun=!1):this.checkForUnlockableCollections(this.currentPageIndex),this.collectionGroupMenus)for(var e=0;e<this.collectionGroupMenus.length;e++)this.collectionGroupMenus[e].onShow();this.addChild(this.game.menuBar),this.game.menuBar.onShow(!0,!0,!1,t),this.game.menuBar.starCountDisplay.onShow(o.GetStarClubGlobalStats().totalStarsEarned,!0),this.game.menuBar.starCountDisplay.visible=!0,this.ui.hideLoadingScreen(),this.handleResize(),this.addChild(this.sidebar)},S.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[2],!1,"RightButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t in this.controlsGroupMap)if(this.controlsGroupMap.hasOwnProperty(t))for(var e=0;e<this.controlsGroupMap[t].length;e++)this.controlFocusManager.addControl(this.controlsGroupMap[t][e],!1,t)},S.prototype.initSidebar=function(){this.sidebar=new f({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(i.Coords.x(1900),i.Coords.y(67)),this.updateSidebar()},S.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=this.game.menuBar.menuBarHeight,e=1;i.Platform.isMobile()&&(t*=.7,i.ScreenMetrics.isPortrait()&&(e=.5));var n=m.width/i.Coords.x(1920),r=m.height/i.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/n*e,this.sidebar.height=this.sidebar.height/r,this.sidebar.y=t/r,this.sidebar.x=i.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*n);var o,a,s;o=this.scrollableFakeHeight,a=i.Coords.x(1080),s=o-i.Coords.y(1080),this.sidebar.resetDimensions(o,a,function(t){var e=-Math.abs(s)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>s&&(this.scrollable.y=-s)}.bind(this),m.height-t),this.sidebar.visible=a<o,this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(s))}},S.prototype.updateTheme=function(){var t=o.CollectionGroups[0],e=o.CollectionGroups[1],i=p.getSetting("theme","selected"),n=this;t.Collections.forEach(function(t){n.setChallengesThemes(t,i)}),e.Collections.filter(function(t){return"Classic"!==t.Name&&"classic"===t.Theme}).forEach(function(t){n.setChallengesThemes(t,i)})},S.prototype.setChallengesThemes=function(t,e){t.Packs.forEach(function(t){t.Challenges.forEach(function(t){t.theme=e})})},S.prototype.onHide=function(){i.Screen.prototype.onHide.call(this),C.remove(this),o.UpdateGlobalStarClubStats(),this.controlFocusManager.removeAllControls(),this.sectionSelected=!1,this.currentPageIndex=0},S.prototype.onCollectionSelected=function(t){o.currentCollection=t,this.game.navStarClubCollection(t)},S.prototype.showLockedWarning=function(t,e){this.ui.showWarning(n("dialogs.needMoreStarsTitle"),n("dialogs.needMoreStarsContent",[t,e]))},S.prototype.showLoadError=function(){this.ui.showWarning(n("dialogs.manifestWarningHeadline"),n("dialogs.manifestWarningContent"),function(){this.ui.hideLoadingScreen(),this.game.navBack()}.bind(this))},S.prototype.buildFUE=function(){C.disableScroll(),new c(this.ui,this.game,{offsetX:i.Coords.x(10),offsetY:i.Coords.x(10),dialog:"SC-FUE-1",width:i.Coords.x(1300),closeHandler:function(){C.enableScroll()}}).open()},S.prototype.handleCommand=function(t,e){if(!e){this.selectSection(t,e);var i;switch(t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1),e||(i=this.controlFocusManager.getCurrentControl(),this.scrollTo(-i._bounds.y+2*i.height));break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1),e||(i=this.controlFocusManager.getCurrentControl(),this.scrollTo(-i._bounds.y+2*i.height));break;case"Up":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(-1)&&this.startScrolling(-2):this.startScrolling(-2);break;case"Down":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(1)&&this.startScrolling(2):this.startScrolling(2);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}}},S.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("LeftButtons");break;case 1:this.controlFocusManager.setFocusGroup("RightButtons");break;case 2:this.controlFocusManager.setFocusGroup("GamesCollection"),this.currentPageIndex=e,this.checkForUnlockableCollections(0);break;case 3:this.controlFocusManager.setFocusGroup("MixedCollection"),this.currentPageIndex=e,this.checkForUnlockableCollections(1)}},S.prototype.doScroll=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/35:t.detail&&(e=-t.detail/3),this.scrollTo(this.scrollable.y+100*e)}},S.prototype.scrollTo=function(t,e){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var n=this.scrollableFakeHeight-i.Coords.y(1080);Math.abs(this.scrollable.y)>n&&(this.scrollable.y=-n),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(n))}},S.prototype.checkForUnlockableCollections=function(e){if(this.settingsManager.getSetting("general","showSCFUE2")){var n=!1;t.each(this.collectionGroupMenus[e].config.tiles,function(t){if(!n&&!t.collection.Unlocked&&d.GetValue("SCGlobalStarsEarned")>=t.collection.PriceOfUnlocking){C.disableScroll();var e=new c(this.ui,this.game,{offsetX:i.Coords.x(10),offsetY:i.Coords.x(10),dialog:"SC-FUE-2",width:i.Coords.x(1300),closeHandler:function(){C.enableScroll()}});return this.settingsManager.setSetting("general","showSCFUE2",!1),e.open(),void(n=!0)}},this)}},S.prototype.selectSection=function(t,e){if("Tab"===t||"ShiftTab"===t){switch(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?3===this.page?(this.handlePageChange(this.page,0),this.page=0):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,3),this.page=3):this.controlFocusManager.prevFocusGroup()),this.controlFocusManager.currentFocusGroup){case"LeftButtons":this.page=0;break;case"RightButtons":this.page=1;break;case"GamesCollection":this.page=2;break;case"MixedCollection":this.page=3}var i=this.controlFocusManager.getCurrentControl();e||this.scrollTo(-i._bounds.y+2*i.height)}},S.prototype.handleGameInput=function(){this.resetControlManager()},S.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},S.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},S}),define("MenuUI/StarClubChallengePackTile",["lodash","pixi","absolute/stringmanager","absolute/screenmetrics","absolute/coords","absolute/spriteutils","MenuUI/MenuTile","MenuUI/Label","Managers/StatManager","absolute/particleemitter","absolute/audiomanager","absolute","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c){"use strict";var p=function(e,i,n){var r={};this.initStarClubChallengePackTile(t.extend(r,e),i,n)};return p.constructor=p,p.prototype=Object.create(a.prototype),p.prototype.initStarClubChallengePackTile=function(t,o,l){a.call(this,t),this.challengePack=o,this.menu=l,"EasyText"==this.label.text||"MediumText"==this.label.text||"HardText"==this.label.text||this.label.text,this.titleOverlay=e.Sprite.fromFrame("star_club/rect_SC_title.png"),this.titleOverlay.y=this.height-this.titleOverlay.height,this.addChild(this.titleOverlay);var h={icon:"star_club/sc_tile_info_star.png",text:"",letterStyle:{font:22*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#FDEF39",tint:16641849,align:"left"}};if(h.text=this.challengePack.NumStarsEarned+"/"+this.challengePack.NumStars,this.starProgressLabel=new s(h),this.starProgressLabel.x=this.titleOverlay.width-this.starProgressLabel.width-r.x(10),this.starProgressLabel.y=this.titleOverlay.height-this.starProgressLabel.height-r.y(5),this.titleOverlay.addChild(this.starProgressLabel),this.label.x=r.x(10),this.label.y=r.y(12),this.titleOverlay.addChild(this.label),o.PriceOfUnlocking>0&&!o.Unlocked){this.lockedOverlay=e.Sprite.fromFrame("star_club/rect_SC_locked.png"),this.lockGroup=new e.DisplayObjectContainer;var u=new s({icon:"star_club/sc_tile_info_star.png",text:o.PriceOfUnlocking.toString(),letterStyle:{font:30*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#FFFFFF",tint:16777215,align:"center"}});u.x=(this.lockedOverlay.width-u.width)/2,this.lockGroup.addChild(u);var c=new s({icon:null,text:i("starClub.toUnlock"),letterStyle:{font:30*n.getResScale()+"px Segoe UI",fill:"#FFFFFF",fontFamily:"segoe",tint:16777215,align:"center"},maxWidth:d.Coords.x(300)});c.x=(this.lockedOverlay.width-c.width)/2,c.y=u.y+u.height+r.y(5),this.lockGroup.addChild(c),this.lockIcon=e.Sprite.fromFrame("star_club/SC_challenge_lock.png"),this.lockIcon.x=(this.lockedOverlay.width-this.lockIcon.width)/2,this.lockIcon.y=c.y+c.height+r.y(15),this.lockGroup.addChild(this.lockIcon),this.lockGroup.x=0,this.lockGroup.y=(this.lockedOverlay.height-this.lockGroup.height)/2,this.lockedOverlay.addChild(this.lockGroup),this.addChild(this.lockedOverlay)}this.updateCrown(),this.initTooltip(),window.addEventListener("mousedown",function(t){p.lastInfoBox&&(p.lastInfoBox.visible=!1,-1!==this.menu.challengePackMenu.children.indexOf(p.lastInfoBox)&&this.menu.challengePackMenu.removeTooltip(p.lastInfoBox))}.bind(this))},p.prototype.updateStarProgress=function(){this.starProgressLabel.setText(this.challengePack.NumStarsEarned+"/"+this.challengePack.NumStars),this.starProgressLabel.x=this.titleOverlay.width-this.starProgressLabel.width-r.x(10),this.starProgressLabel.y=this.titleOverlay.height-this.starProgressLabel.height-r.y(10)},p.prototype.handleClick=function(){this.challengePack.Unlocked?a.prototype.handleClick.call(this):l.GetValue("SCGlobalStarsEarned")>=this.challengePack.PriceOfUnlocking?this.animateUnlock():(p.lastInfoBox&&(p.lastInfoBox.visible=!1),p.lastInfoBox=this.infoBoxContainer,this.infoBoxContainer.openBox(),this.interactive=!0)},p.prototype.animateUnlock=function(){this.challengePack.Unlocked=!0,this.unlockAnimation=o.loadMovieClip("unlock_animation/unlocking-animation_",30,1),this.unlockAnimation.animationSpeed=.5,this.unlockAnimation.loop=!1,this.unlockAnimation.scale.x=this.unlockAnimation.scale.y=1.45,this.unlockAnimation.x=r.y(3)+(this.lockedOverlay.width-this.unlockAnimation.width)/2,this.unlockAnimation.y=r.y(65)+(this.lockedOverlay.width-this.unlockAnimation.height)/2,this.lockGroup.removeChild(this.lockIcon),this.lockedOverlay.addChild(this.unlockAnimation),this.unlockAnimation.onComplete=function(){window.setTimeout(function(){this.removeChild(this.lockedOverlay),this.animateUnlockComplete=!0}.bind(this),1e3),this.interactive=!0}.bind(this),u.playSound("sc_starFlying_isolated"),this.menu.game.menuBar.starCountDisplay.triggerStarAnimation(this,!0,function(){u.playSound("sc_starUnlock"),this.unlockAnimation.gotoAndPlay(0),this.menu.game.menuBar.starCountDisplay.triggerStarAnimation(this,!1)}.bind(this))},p.prototype.updateCrown=function(t){if(this.challengePack.NumStarsEarned==this.challengePack.NumStars&&!this.crown){var i=this;if(this.crown||(this.crown=e.Sprite.fromFrame("star_club/crown.png"),this.addChild(this.crown)),this.crown.anchor.x=this.crown.anchor.y=.5,this.crown.x=this.width/2,this.crown.y=this.height/2,this.crown.alpha=1,this.crown.scale.x=this.crown.scale.y=1,t){u.playSound("CrownAppearance");var n=[e.Texture.fromFrame("particle_glow_yellow.png")],r=[e.Texture.fromFrame("Star_orng_dot.png"),e.Texture.fromFrame("Star_yellow_dot.png"),e.Texture.fromFrame("Star_yel.png")],o={rate:{numpan:{a:8,b:12,center:!0},timepan:{a:.01,b:.002,center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.2,.5,1],alpha:{a:1,b:0},scale:{a:[.5,1],b:0,center:null},gravity:0,life:{a:1,b:1.5,center:null},radius:1,crossZone:null,randomDrift:null},a={rate:{numpan:{a:2,b:4,center:!0},timepan:{a:.01,b:.002,center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.5,1],alpha:{a:.5,b:0},scale:{a:[.3,.3,.5],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,crossZone:null,randomDrift:null},s=new h(this.menu.ui,n,o),l=new h(this.menu.ui,r,a),i=this;this.particleLayer.addChild(s),this.particleLayer.addChild(l),s.x=l.x=this.crown.x,s.y=l.y=this.crown.y,this.crown.alpha=0,s.start();new TWEEN.Tween({alpha:0}).easing(TWEEN.Easing.Exponential.In).to({alpha:1},1200).onStart(function(){window.setTimeout(function(){s.stop()},600)}).onUpdate(function(){i.crown.alpha=this.alpha}).start(),new TWEEN.Tween({scale:1}).delay(500).easing(TWEEN.Easing.Elastic.Out).to({scale:[1.5,1]},1500).onStart(function(){window.setTimeout(function(){l.start()},700)}).onUpdate(function(){i.crown.scale.x=i.crown.scale.y=this.scale}).onComplete(function(){l.stop()}).start()}}},p.prototype.onShow=function(){this.particleLayer||(this.particleLayer=new e.DisplayObjectContainer,this.addChild(this.particleLayer)),this.crown&&(this.crown.alpha=1,this.crown.scale.x=this.crown.scale.y=1,this.addChild(this.crown)),this.updateStarProgress(),this.updateCrown(!0),this.challengePack.Unlocked&&!this.animateUnlockComplete&&l.GetValue("SCGlobalStarsEarned")>=this.challengePack.PriceOfUnlocking&&this.removeChild(this.lockedOverlay),this.interactive=!0},p.prototype.onHide=function(){this.particleLayer&&(this.removeChild(this.particleLayer),this.particleLayer=null),this.interactive=!1},p.prototype.initTooltip=function(){this.infoBoxContainer=new e.DisplayObjectContainer;var t=new e.Graphics,o={font:19*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",wordWrap:!0,wordWrapWidth:this.width},a=new e.Text(i("starClub.tooltip"),o);t.beginFill(0),t.lineStyle(3,16777215,1),t.drawRect(0,0,this.width+r.x(14),a.height+r.y(10)),t.endFill(),a.x=r.x(7),a.y=r.y(10),this.infoBoxContainer.addChild(t),this.infoBoxContainer.addChild(a),this.infoBoxContainer.visible=!1,this.infoBoxContainer.x=this.width/2-this.infoBoxContainer.width/2,this.currentWidth=this.infoBoxContainer.width,this.currentHeight=this.infoBoxContainer.height,this.onOpenBox(this.infoBoxContainer,a)},p.prototype.onOpenBox=function(t,e){var i=this;this.infoBoxContainer.openBox=function(){var n=l.GetValue("SCGlobalStarsEarned");t.visible=!0,e.text=e.text.replace("$$$",this.challengePack.PriceOfUnlocking-n),e.updateText(),this.setTooltipPosition(),-1===this.menu.challengePackMenu.children.indexOf(t)&&this.menu.challengePackMenu.addTooltip(t),t.visible&&(new TWEEN.Tween({alpha:0}).easing(TWEEN.Easing.Cubic.InOut).to({alpha:1},350).onUpdate(function(e){t.alpha=this.alpha}).start(),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(function(){i.hideTooltip(t,i)}.bind(this),3e3))}.bind(this)},p.prototype.hideTooltip=function(t,e){new TWEEN.Tween({alpha:1}).easing(TWEEN.Easing.Cubic.InOut).to({alpha:0},350).onUpdate(function(){t.alpha=this.alpha}).onComplete(function(){t.visible=!1,-1!==e.menu.challengePackMenu.children.indexOf(this.infoBoxContainer)&&e.menu.challengePackMenu.removeTooltip(t)}).start()},p.prototype.resizeInfoBoxContainer=function(){this.setTooltipPosition(),this.infoBoxContainer.width=this.currentWidth*this.menu.challengePackMenu.pageGenerator.cardScale,this.infoBoxContainer.height=this.currentHeight*this.menu.challengePackMenu.pageGenerator.cardScale},p.prototype.setTooltipPosition=function(){var t=0;t=this.y-this.infoBoxContainer.height,this.menu.container.y+this.menu.challengePackMenu.y+t+this.menu.scrollable.y<this.menu.game.menuBar.y+this.menu.game.menuBar.height+d.Coords.y(100)&&(t=this.y+this.height*this.menu.challengePackMenu.pageGenerator.cardScale+d.Coords.y(15)),this.infoBoxContainer.x=this.x+this.width*this.menu.challengePackMenu.pageGenerator.cardScale/2-this.infoBoxContainer.width/2,this.infoBoxContainer.y=t},p}),define("MenuUI/StarClubCollectionMenu",["lodash","pixi","absolute","absolute/stringmanager","absolute/screenmetrics","MenuUI/Menu","MenuUI/StarClubChallengePackTile","Solitaire/MvvmStructure/Service/SolitaireStarClubService","MenuUI/ControlFocusManager","MenuUI/BadgeEarnedDialog","MenuUI/SideBar","Managers/StatManager","util/SettingsManager","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g){"use strict";var f=function(t,e){this.initStarClubCollectionMenu(t,e)};return f.constructor=f,f.prototype=Object.create(i.Screen.prototype),f.prototype.initStarClubCollectionMenu=function(t,n){i.Screen.call(this),this.ui=t,this.game=n;var r=e.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(r),this.controlFocusManager=new l,this.clickHandler=this.handleGameInput.bind(this),this.container=new e.DisplayObjectContainer,window.addEventListener("click",this.clickHandler),p.addElement(this,{scaleChangeSource:"Full"})},f.prototype.initSidebar=function(){this.sidebar=new u({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(i.Coords.x(1900),i.Coords.y(67)),this.updateSidebar()},f.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var t=new e.Rectangle(0,0,i.Coords.x(1920),i.Coords.y(1080));this.touchContainer=new e.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=t,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},f.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},f.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)),this.lastDeltaY=i}},f.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},f.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},f.prototype.doScroll=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/35:t.detail&&(e=-t.detail/3),this.scrollTo(this.scrollable.y+100*e)}},f.prototype.scrollTo=function(t,e){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var n=this.scrollableFakeHeight-i.Coords.y(1080);Math.abs(this.scrollable.y)>n&&(this.scrollable.y=-n),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(n)),this.challengePackTiles.forEach(function(t){t.hideTooltip(t.infoBoxContainer,t)})}},f.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},f.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=this.game.menuBar.menuBarHeight,e=1;i.Platform.isMobile()&&(t*=.7,i.ScreenMetrics.isPortrait()&&(e=.5));var n=p.width/i.Coords.x(1920),r=p.height/i.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/n*e,this.sidebar.height=this.sidebar.height/r,this.sidebar.y=t/r,this.sidebar.x=i.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*n);var o,a,s;o=this.scrollableFakeHeight,a=i.Coords.x(1080),s=o-i.Coords.y(1080),this.sidebar.resetDimensions(o,a,function(t){var e=-Math.abs(s)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>s&&(this.scrollable.y=-s)}.bind(this),p.height-t),this.sidebar.visible=a<o,this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(s))}},f.prototype.initTouchContainer=function(){},f.prototype.afterRender=function(t){},f.prototype.loadCollection=function(r){for(;this.container.children.length>0;)this.container.removeChildAt(0);this.challengePackTiles=[],this.controlsGroupMap={StarClubPacks:[]},t.forEach(r.ChallengePacks,function(t){var e={userData:t,image:t.icon,icon:"",label:n(t.Name),action:null,letterStyle:{font:23*i.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},iconPosition:{x:0,y:0},labelPosition:{x:i.Coords.x(88),y:i.Coords.y(50)},labelPadding:i.Coords.y(50),labelOffset:i.Coords.y(22),dropShadow:!0,hoverBox:!0};e.action=this.onChallengePackSelected.bind(this);var r=new a(e,t,this);this.challengePackTiles.push(r),this.controlsGroupMap.StarClubPacks.push(r)},this),this.collectionName=r.CollectionGroupName,this.label=i.StringManager(r.Name);var s=t.extend({tiles:this.challengePackTiles,keepOneLine:!0},p.scaleParams.MenuConfigs.SCCollectionMenuConfigs);this.currentWidth=i.Coords.x(1820),this.scrollable=new e.DisplayObjectContainer,this.challengePackMenu=new o(t.extend(s,p.scaleParams.SCChallengePacks[this.collectionName])),this.container.addChild(this.challengePackMenu),this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth,this.updatePagesPositions(),this.initTouchInterface(),this.handleResize()},f.prototype.handleResize=function(){this.scrollable&&(this.scrollTo(this.scrollable.y),this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width*this.container.children[0].pageGenerator.cardScale/p.width)*(p.height/i.Coords.y(985)),this.updatePagesPositions(),this.challengePackTiles.forEach(function(t){t.resizeInfoBoxContainer()}.bind(this)),this.scrollable.height=this.currentWidth/this.container.width*(i.Coords.y(985)/p.height)*(p.width/i.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,
this.scrollableFakeHeight=this.scrollable.height+i.Coords.x(110),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<i.Coords.y(1080)&&(this.scrollable.y=i.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar())},f.prototype.updatePagesPositions=function(){var t,e=Math.max(this.container.width/this.currentWidth,.7),n=i.Coords.x(100)*e,r=i.Coords.y(70)*e,o=i.Coords.y(60)*e;this.currentHeight=i.Coords.y(185),this.container.children.forEach(function(e){e.x=n,e.y=t?t.y+t.height+r:o,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},f.prototype.onShow=function(t){i.Screen.prototype.onShow.call(this),g.add(this,this.doScroll,this),s.UpdateGlobalStarClubStats(),this.addChild(this.game.menuBar),this.game.menuBar.onShow(!0,!0,!0,this.label),this.ui.refreshBackground=!0,this.challengePackMenu.onShow(),this.checkForUnlockableChallengePack(),this.initControls(),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0),this.handleResize()},f.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[2],!1,"RightButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t in this.controlsGroupMap)if(this.controlsGroupMap.hasOwnProperty(t))for(var e=0;e<this.controlsGroupMap[t].length;e++)this.controlFocusManager.addControl(this.controlsGroupMap[t][e],!1,t)},f.prototype.onHide=function(){this.controlFocusManager.removeAllControls(),this.sectionSelected=!1,this.currentPageIndex=0,this.challengePackMenu.onHide(),i.Screen.prototype.onHide.call(this),g.remove(this)},f.prototype.onChallengePackSelected=function(t){t.Unlocked&&(s.currentPack=t,this.game.navStarClubChallenge(t))},f.prototype.showLockedWarning=function(t,e){this.ui.showWarning(n("dialogs.needMoreStarsTitle"),n("dialogs.needMoreStarsContent",[t,e]))},f.prototype.handleCommand=function(t,e){if(!e)switch(this.selectSection(t,e),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},f.prototype.selectSection=function(t,e){if("Tab"===t||"ShiftTab"===t)switch(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?2===this.page?(this.handlePageChange(this.page,0),this.page=0):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,2),this.page=2):this.controlFocusManager.prevFocusGroup()),this.controlFocusManager.currentFocusGroup){case"LeftButtons":this.page=0;break;case"RightButtons":this.page=1;break;case"StarClubPacks":this.page=2}},f.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("LeftButtons");break;case 1:this.controlFocusManager.setFocusGroup("RightButtons");break;case 2:this.controlFocusManager.setFocusGroup("StarClubPacks")}},f.prototype.checkForUnlockableChallengePack=function(){if(c.getSetting("general","showSCFUE3")){var e=!1;t.each(this.challengePackTiles,function(t){if(!e&&t.challengePack&&!t.challengePack.Unlocked&&d.GetValue("SCGlobalStarsEarned")>=t.challengePack.PriceOfUnlocking){g.disableScroll();var n=new h(this.ui,this.game,{offsetX:i.Coords.x(10),offsetY:i.Coords.x(10),dialog:"SC-FUE-3",width:i.Coords.x(1300),closeHandler:function(){g.enableScroll()}});return c.setSetting("general","showSCFUE3",!1),n.open(),void(e=!0)}},this)}},f.prototype.handleGameInput=function(){this.resetControlManager()},f.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl(),this.sectionSelected=!1},f}),define("MenuUI/StarClubChallengeTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","Managers/TelemetryManager"],function(t,e,i,n,r,o){var a=function(t,e,n){var r={};this.initStarClubChallengeTile(i.extend(r,t),e,n)};return a.prototype=Object.create(r.prototype),a.prototype.initStarClubChallengeTile=function(n,o,a){this.challengeMenu=a,this.challenge=o,r.call(this,n),this.label.x=(this.width-this.label.width)/2,this.label.y=e.Coords.y(216);var s=new t.Graphics,l=e.Coords.x(200),h=e.Coords.x(4),u={font:25*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"center"},d=new t.Text(this.challenge.ShortGoalDescription,u),c=new t.Graphics,p={font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"center"},g=e.StringManager("difficulty",null,!0),f=new t.Text(g[this.challenge.Difficulty-1],p);if(s.moveTo(0,0),s.lineStyle(h,16777215,1),s.lineTo(l,0),s.x=(this.width-l)/2,s.y=e.Coords.y(262),this.addChild(s),d.x=(this.width-d.width)/2,d.y=e.Coords.y(270),this.addChild(d),c.beginFill(0,.7),c.drawRect(0,0,this.width,e.Coords.y(40)),c.endFill(),this.addChild(c),f.x=e.Coords.x(10),f.y=e.Coords.y(3),this.addChild(f),i.times(this.challenge.Difficulty,function(i){var n=t.Sprite.fromFrame("dailychallenge/challenge_diff_star.png");n.x=this.width-n.width-e.Coords.x(10)-i*(n.width+e.Coords.x(5)),n.y=e.Coords.y(5),this.addChild(n)},this),this.challenge.Completed){this.complete=!0;var y=t.Sprite.fromFrame("dailychallenge/ribbon_DC.png");y.x=(this.width-y.width)/2,y.y=e.Coords.y(107),this.addChild(y)}},a.prototype.handleClick=function(){this.challengeMenu.game.startGame(n[this.config.mode],this.challenge)},a.prototype.onShow=function(){this.complete!==this.challenge.Completed&&this.challenge.Completed?(this.completeRibbon=t.Sprite.fromFrame("dailychallenge/ribbon_DC.png"),startingScale=3,self=this,this.parent.addChild(this),this.completeRibbon.anchor.x=this.completeRibbon.anchor.y=.5,this.completeRibbon.x=this.width/2,this.completeRibbon.y=e.Coords.y(190),this.completeRibbon.scale.x=this.completeRibbon.scale.y=startingScale,this.completeRibbon.alpha=0,this.addChild(this.completeRibbon),this.complete=this.challenge.Completed,e.AudioManager.playSound("sc_starFlying"),window.setTimeout(function(){e.AudioManager.playSound("dc_ribbonHit")},800),this.ribbonTween=new TWEEN.Tween({scale:startingScale,alpha:0}).easing(TWEEN.Easing.Cubic.In).to({scale:1,alpha:1},1e3).onUpdate(function(){self.completeRibbon.scale.x=self.completeRibbon.scale.y=this.scale,self.completeRibbon.alpha=this.alpha}).onComplete(function(){self.challengeMenu.onChallengeCompleted(self),self.interactive=!0}).start()):this.interactive=!0},a.prototype.onHide=function(){this.completeRibbon&&(this.completeRibbon.scale.x=this.completeRibbon.scale.y=1,this.completeRibbon.alpha=1),this.ribbonTween&&this.ribbonTween.stop(),TWEEN.removeAll(),this.interactive=!1,this.hover.visible=!1},a}),define("MenuUI/StarClubChallengeMenu",["lodash","pixi","absolute","absolute/screenmetrics","gameconfig","MenuUI/Menu","MenuUI/SideBar","MenuUI/StarClubChallengeTile","Solitaire/MvvmStructure/Service/SolitaireStarClubService","MenuUI/ControlFocusManager","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d){"use strict";var c=function(t,e){this.initStarClubChallengeMenu(t,e)};return c.constructor=c,c.prototype=Object.create(i.Screen.prototype),c.prototype.initStarClubChallengeMenu=function(t,n){i.Screen.call(this),this.ui=t,this.game=n;var r=e.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(r),this.currentWidth=i.Coords.x(1791),this.container=new e.DisplayObjectContainer,this.controlFocusManager=new h,u.addElement(this,{scaleChangeSource:"Full"})},c.prototype.initSidebar=function(){this.sidebar=new a({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(i.Coords.x(1900),i.Coords.y(67)),this.updateSidebar()},c.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var t=new e.Rectangle(0,0,i.Coords.x(1920),i.Coords.y(1080));this.touchContainer=new e.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=t,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},c.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},c.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)),this.lastDeltaY=i}},c.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},c.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},c.prototype.doScroll=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/35:t.detail&&(e=-t.detail/3),this.scrollTo(this.scrollable.y+100*e)}},c.prototype.scrollTo=function(t,e){if(this.scrollable){if(this.scrollableFakeHeight<=i.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var n=this.scrollableFakeHeight-i.Coords.y(1080);Math.abs(this.scrollable.y)>n&&(this.scrollable.y=-n),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(n))}},c.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},c.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=this.game.menuBar.menuBarHeight,e=u.width/i.Coords.x(1920),n=u.height/i.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/e,this.sidebar.height=this.sidebar.height/n,this.sidebar.y=t/n,this.sidebar.x=i.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*e);var r,o,a;r=this.scrollableFakeHeight,o=i.Coords.x(1080),a=r-i.Coords.y(1080),this.sidebar.resetDimensions(r,o,function(t){var e=-Math.abs(a)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>a&&(this.scrollable.y=-a)}.bind(this),u.height-t),this.sidebar.visible=o<r,this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(a))}},c.prototype.initTouchContainer=function(){},c.prototype.loadChallenges=function(n){var r=[];for(this.controlsGroupMap={};this.container.children.length>0;)this.container.removeChildAt(0);this.controlsGroupMap[n.Name]=this.controlsGroupMap[n.Name]||[],t.forEach(n.Challenges,function(t){var e=this.getTileConfig(t.config.Data.GameMode);e.dropShadow=!0,e.action=this.onChallengeSelected.bind(this);var i=new s(e,t,this);r.push(i),this.controlsGroupMap[n.Name].push(i)},this),this.label=i.StringManager(n.Name);var a=t.extend({tiles:r,keepOneLine:!0},u.scaleParams.MenuConfigs.SCChallengeMenu);this.challengePackMenu=new o(t.extend(a,u.scaleParams.SCGamePacks)),this.container.addChild(this.challengePackMenu),this.scrollable=new e.DisplayObjectContainer,this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth,this.initTouchInterface(),this.handleResize()},c.prototype.handleResize=function(){this.scrollable&&(this.scrollTo(this.scrollable.y),this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width*this.container.children[0].pageGenerator.cardScale/u.width)*(u.height/i.Coords.y(985)),this.updatePagesPositions(),this.scrollable.height=this.currentWidth/this.container.width*(i.Coords.y(985)/u.height)*(u.width/i.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.scrollableFakeHeight=this.scrollable.height+i.Coords.y(200),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<i.Coords.y(1080)&&(this.scrollable.y=i.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar())},c.prototype.updatePagesPositions=function(){var t,e=Math.max(this.container.width/this.currentWidth,.7),n=i.Coords.x(80)*e,r=i.Coords.y(70)*e,o=i.Coords.y(60)*e;this.currentHeight=i.Coords.y(50),this.container.children.forEach(function(e){e.x=n,e.y=t?t.y+t.height+r:o,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},c.prototype.onShow=function(t){i.Screen.prototype.onShow.call(this),l.UpdateGlobalStarClubStats(),this.addChild(this.game.menuBar),this.game.menuBar.onShow(!0,!0,!0,this.label),this.ui.refreshBackground=!0,this.challengePackMenu.onShow(),this.initControls(),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0),this.handleResize(),d.add(this,this.doScroll,this)},c.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[2],!1,"RightButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t in this.controlsGroupMap)if(this.controlsGroupMap.hasOwnProperty(t))for(var e=0;e<this.controlsGroupMap[t].length;e++)this.controlFocusManager.addControl(this.controlsGroupMap[t][e],!1,"StarClubPacks")},c.prototype.onHide=function(){this.controlFocusManager.removeAllControls(),this.sectionSelected=!1,i.Screen.prototype.onHide.call(this),this.game.menuBar.onHide(!0),this.challengePackMenu.onHide(),d.remove(this)},c.prototype.onChallengeSelected=function(t){},c.prototype.onChallengeCompleted=function(t){this.game.menuBar.starCountDisplay.triggerStarAnimation(t)},c.prototype.getTileConfig=function(t){return r.UI.starClub.challengeTiles[t]},c.prototype.handleCommand=function(t,e){if(!e)switch(this.selectSection(t,e),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},c.prototype.selectSection=function(t,e){if("Tab"===t||"ShiftTab"===t)switch(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?2===this.page?(this.handlePageChange(this.page,0),this.page=0):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,2),this.page=2):this.controlFocusManager.prevFocusGroup()),this.controlFocusManager.currentFocusGroup){case"LeftButtons":this.page=0;break;case"RightButtons":this.page=1;break;case"StarClubPacks":this.page=2}},c.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("LeftButtons");break;case 1:this.controlFocusManager.setFocusGroup("RightButtons");break;case 2:this.controlFocusManager.setFocusGroup("StarClubPacks")}},c}),define("MenuUI/MonthlyAwardsTile",["pixi","absolute","tween","absolute/stringmanager","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","MenuUI/Label","MenuUI/ColorConstants","MenuUI/MsftIconButton"],function(t,e,i,n,r,o,a,s,l,h){var u=function(t,i,n,o,a){var s={letterStyle:{font:30*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"}};this.initBackground(),this.initMonthlyAwardsTile(r.extend(s,t),i,a),this.initDateInfo(n,o),this.initBadges(),this.initInfoBox(),window.addEventListener("mousedown",function(t){u.lastInfoBox&&(u.lastInfoBox.visible=!1)})};return u.prototype=Object.create(a.prototype),u.prototype.initBackground=function(){this.background=t.Sprite.fromFrame("awards/Awards-bkg.png")},u.prototype.initDateInfo=function(i,r){this.year=i,this.month=r;var o,a=n("months",null,!0),s=new t.Text("20"+i,this.config.letterStyle);o="fr-CA"===e.StringManager.getUserLanguage()||"fr-FR"===e.StringManager.getUserLanguage()?new t.Text(e.StringManager("DailyChallenge.badgesOf")+" "+a[parseInt(r)-1].toLowerCase(),this.config.letterStyle):new t.Text(a[parseInt(r)-1]+" "+e.StringManager("DailyChallenge.badges"),this.config.letterStyle),this.monthLabel=new t.Sprite(o.generateTexture()),this.monthLabel.position.x=e.Coords.x(20),this.monthLabel.position.y=e.Coords.y(15),this.yearLabel=new t.Sprite(s.generateTexture()),this.yearLabel.alpha=.7,this.yearLabel.position.x=this.background.width-this.yearLabel.width-e.Coords.x(20),this.yearLabel.position.y=e.Coords.y(15),this.background.addChild(this.monthLabel),this.background.addChild(this.yearLabel)},u.prototype.initBadges=function(){this.badgesSprite=t.Sprite.fromFrame("awards/"+this.getBadgesFrame()+".png"),this.badgesSprite.position.y=e.Coords.y(70),this.badgesSprite.x=this.background.width/2-this.badgesSprite.width/2,this.background.addChild(this.badgesSprite)},u.prototype.getKey=function(){return this.year+this.month},u.prototype.initMonthlyAwardsTile=function(t,e,i){this.config=t,this.menu=i,this.monthData=e,t.image=this.background,a.call(this,t)},u.prototype.handleClick=function(){this.infoBoxContainer.openBox(),this.down=!1,this.interactive=!0},u.prototype.initInfoBox=function(){this.infoBoxContainer=new t.DisplayObjectContainer;var n,r=new t.Graphics,o=e.Coords.x(5),a={font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:7642578,align:"left"},s=t.Sprite.fromFrame("DC_kickoff_coin.png"),l=new t.Text("X",a);n=new t.Text(this.monthData.coinsEarned.toString(),a),r.beginFill(0),r.lineStyle(3,16777215,1),r.drawRect(0,0,n.width+e.Coords.x(62),e.Coords.x(44)),r.endFill(),s.scale.set(.45,.45),s.x=o,s.y=(r.height-s.height)/2-e.Coords.y(1),l.x=s.x+s.width+e.Coords.x(4),l.y=(r.height-l.height)/2+e.Coords.y(2),n.x=l.x+l.width+e.Coords.x(4),n.y=(r.height-n.height)/2+e.Coords.y(1),this.infoBoxContainer.addChild(r),r.addChild(s),r.addChild(l),r.addChild(n),this.infoBoxContainer.visible=!1,this.infoBoxContainer.icon=s,this.infoBoxContainer.coinCount=n,this.infoBoxContainer.multiply=l,this.currentWidth=this.infoBoxContainer.width,this.currentHeight=this.infoBoxContainer.height;var h=this.infoBoxContainer,d=this;this.infoBoxContainer.openBox=function(){u.lastInfoBox&&(u.lastInfoBox.visible=!1),u.lastInfoBox=this.infoBoxContainer,h.visible=!h.visible,h.x=this.width/2-this.infoBoxContainer.width/2,h.y=-h.height,h.visible&&(-1===this.children.indexOf(this.infoBoxContainer)&&this.addChild(this.infoBoxContainer),this.menu.handleResize(),new i.Tween({alpha:0}).easing(i.Easing.Cubic.InOut).to({alpha:1},350).onUpdate(function(t){h.alpha=this.alpha}).start(),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(function(){d.hideInfoBoxContainer(h)}.bind(this),3e3))}.bind(this)},u.prototype.hideInfoBoxContainer=function(t){new i.Tween({alpha:1}).easing(i.Easing.Cubic.InOut).to({alpha:0},350).start().onUpdate(function(e){t.alpha=this.alpha}).onComplete(function(){t.visible=!1}).start()},u.prototype.resizeInfoBoxContainer=function(){this.infoBoxContainer.width=this.currentWidth*this.menu.container.children[0].pageGenerator.cardScale,this.infoBoxContainer.height=this.currentHeight*this.menu.container.children[0].pageGenerator.cardScale,this.updateInfoBoxContainerPosition()},u.prototype.updateInfoBoxContainerPosition=function(){this.infoBoxContainer.x=this.width/2-this.infoBoxContainer.width/2,this.infoBoxContainer.y=-this.infoBoxContainer.height},u.prototype.onShow=function(){this.statsModel.updateStats(),this.showStats(),this.interactive=this.hasMoreInfo},u.prototype.getBadgesFrame=function(){switch(this.monthData.bronzeBadgesWon+this.monthData.silverBadgesWon+this.monthData.goldBadgesWon+this.monthData.diamondBadgesWon){case 4:return"badges_diamond";case 3:return"badges_gold";case 2:return"badges_silver";case 1:return"badges_bronze";case 0:return"badges_none"}},u}),define("MenuUI/AwardsMenu",["pixi","absolute","lodash","MenuUI/MenuTab","gameconfig","MenuUI/Menu","absolute/screenmetrics","MenuUI/ChallengeTile","Solitaire/SolitaireGameMode","MenuUI/MonthlyAwardsTile","MenuUI/SideBar","MenuUI/ControlFocusManager","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g){var f=function(t,e,i){this.scrollable&&this.removeChild(this.scrollable)};return f.prototype=Object.create(e.Screen.prototype),f.prototype.loadArtAssets=function(t,i){var n=new e.Loader,r=[{name:"aw_menu"}];n.loadAtlases(r,function(t){e.Debug.log("loading awards menu assets ",t)}.bind(this),t,i)},f.prototype.initialize=function(i,n,r){e.Screen.call(this),this.ui=i,this.game=r,this.year=n,this.controlFocusManager=new d;var o=t.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(o),this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),p.addElement(this,{scaleChangeSource:"Full"})},f.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var i=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},f.prototype.initSidebar=function(){this.sidebar=new u({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(1900),e.Coords.y(67)),this.updateSidebar()},f.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=e.Coords.y(66),i=t/p.scaleFactorY,n=p.width/e.Coords.x(1920),r=p.height/e.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/n,this.sidebar.height=this.sidebar.height/r,this.sidebar.y=i,this.sidebar.x=e.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*n);var o,a,s;o=this.scrollableFakeHeight,a=e.Coords.x(1080),s=o-e.Coords.y(1080),this.sidebar.resetDimensions(o,a,function(t){var e=-Math.abs(s)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>s&&(this.scrollable.y=-s)}.bind(this),p.height-65),this.sidebar.visible=a<o,this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(s))}},f.prototype.onShow=function(){this.ui.showLoadingScreen(),g.add(this,this.doScroll,this),this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),function(){})},f.prototype.handleResize=function(){this.scrollable&&(this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width*this.container.children[0].pageGenerator.cardScale/p.width)*(p.height/e.Coords.y(985)),this.updatePagesPositions(),this.updateSidebar(),this.tiles.forEach(function(t){t.resizeInfoBoxContainer()}.bind(this)),this.scrollable.height=this.currentWidth/this.container.width*(e.Coords.y(985)/p.height)*(p.width/e.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.scrollableFakeHeight=this.scrollable.height+e.Coords.x(150)+this.tiles[0].infoBoxContainer.height,this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<e.Coords.y(1080)&&(this.scrollable.y=e.Coords.y(1080)-this.scrollableFakeHeight))},f.prototype.updatePagesPositions=function(){var t,i=this.container.width/this.currentWidth,n=e.Coords.x(50),r=e.Coords.y(70)*i,o=e.Coords.y(90)*i;this.currentHeight=e.Coords.y(21),this.container.children.forEach(function(e){e.x=n,e.y=t?t.y+t.height+r:o,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},f.prototype.onHide=function(){this.resetControlManager(),this.controlFocusManager.removeAllControls(),g.remove(this),this.removeChild(this.sidebar)},f.prototype.completeInit=function(){this.menu&&this.menu.onShow(),this.initData(),this.addChild(this.game.menuBar),this.ui.hideLoadingScreen(),this.game.menuBar.onShow(!0,!0,!1,e.StringManager("titles.dailyChallengeBadges")),this.handleResize(),this.initControls(),this.handleResize()},f.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t=0;t<this.badges.length;t++)this.controlFocusManager.addControl(this.badges[t],!1,this.badges[t].getKey())},f.prototype.initData=function(){this.menu&&this.removeChild(this.menu),this.badges=[],this.tiles=[];var n=c.GetChallengesData(),r={background:{width:e.Coords.x(565),height:e.Coords.y(385)}},a=[];this.currentWidth=e.Coords.x(1850),this.scrollable=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer;for(var s in n)if(!this.year||this.year===s){var l=!a[a.length-1],u=[];for(var d in n[s]){var g=new h(r,n[s][d],s,d,this);u.push(g),this.tiles.push(g)}this.badges=this.badges.concat(u);var f=new o(i.extend({tiles:u,label:"20"+s+" "+e.StringManager("DailyChallenge.badges"),tilePaddingX:e.Coords.x(30),keepOneLine:!0,maxColNum:4},p.scaleParams.MenuConfigs.AwardsMenuConfigs));f.x=e.Coords.x(90),f.y=l?e.Coords.y(170):a[a.length-1].height+e.Coords.y(200),a.push(f),this.container.addChild(f)}this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth,this.initTouchInterface(),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0)},f.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},f.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)*a.devicePixelRatio),this.lastDeltaY=i}},f.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},f.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},f.prototype.doScroll=function(t){if(!(this.scrollableFakeHeight<e.Coords.y(1080))){var i=0;t||(t=window.event),t.wheelDelta?i=t.wheelDelta/15:t.detail&&(i=-t.detail/3),this.scrollTo(this.scrollable.y+100*i),t.preventDefault()}},f.prototype.handleCommand=function(t,e){if(!e)switch(this.selectSection(t,e),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1);break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1);break;case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},f.prototype.scrollTo=function(t,i){if(this.scrollable){if(this.scrollableFakeHeight<=e.Coords.y(1080))return void(this.scrollable.y=0);this.tiles.forEach(function(t){t.hideInfoBoxContainer(t.infoBoxContainer)}),this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var n=this.scrollableFakeHeight-e.Coords.y(1080);Math.abs(this.scrollable.y)>n&&(this.scrollable.y=-n),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(n))}},f.prototype.selectSection=function(t,e){"Tab"!==t&&"ShiftTab"!==t||(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getLastControl().focusGroup?this.controlFocusManager.setFocusGroup("LeftButtons"):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getFirstControl().focusGroup?this.controlFocusManager.setFocusGroup(this.badges[this.badges.length-1].getKey()):this.controlFocusManager.prevFocusGroup()))},f.prototype.handleGameInput=function(){this.resetControlManager()},f.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},f}),define("MenuUI/YearAwardsTile",["pixi","absolute","absolute/stringmanager","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","MenuUI/Label","MenuUI/ColorConstants","MenuUI/MsftIconButton"],function(t,e,i,n,r,o,a,s,l){var h=function(t,i,r,o){var a={letterStyle:{font:90*e.ScreenMetrics.getResScale()+"px segoe1",tint:16777215,align:"left"},disableOnClick:!1};this.year=r,this.initBackground(),this.initYearAwardsTile(n.extend(a,t),i,o),this.initDateInfo(r),this.initBadgesInfo()};return h.prototype=Object.create(o.prototype),h.prototype.initBackground=function(){this.background=t.Sprite.fromFrame("awards/Awards-year-bkg.png")},h.prototype.initDateInfo=function(i){var n=new t.BitmapText("20"+i,this.config.letterStyle);this.yearLabel=new t.Sprite(n.generateTexture()),this.yearLabel.position.x=this.background.width/2-this.yearLabel.width/2,this.yearLabel.position.y=e.Coords.y(40),this.background.addChild(this.yearLabel)},h.prototype.initBadgesInfo=function(){var i=this._getMYearBadgesInfo(),n={font:20*e.ScreenMetrics.getResScale()+"px segoe1",tint:16777215,align:"center"},r=new t.BitmapText(i.bronzeBadgesWon.toString(),n),o=new t.Sprite(r.generateTexture());o.position.x=e.Coords.x(44)-o.width/2,o.position.y=e.Coords.y(197);var a=new t.BitmapText(i.silverBadgesWon.toString(),n),s=new t.Sprite(a.generateTexture());s.position.x=e.Coords.x(105)-s.width/2,s.position.y=e.Coords.y(197);var l=new t.BitmapText(i.goldBadgesWon.toString(),n),h=new t.Sprite(l.generateTexture());h.position.x=e.Coords.x(166)-h.width/2,h.position.y=e.Coords.y(197);var u=new t.BitmapText(i.diamondBadgesWon.toString(),n),d=new t.Sprite(u.generateTexture());d.position.x=e.Coords.x(227)-d.width/2,d.position.y=e.Coords.y(197),this.background.addChild(o),this.background.addChild(s),this.background.addChild(h),this.background.addChild(d)},h.prototype.initYearAwardsTile=function(t,e,i){this.config=t,this.menu=i,this.yearData=e,t.image=this.background,o.call(this,t)},h.prototype.handleClick=function(){this.menu.handleYearSelect(this.year),this.down=!1},h.prototype.onShow=function(){this.statsModel.updateStats(),this.showStats(),this.interactive=this.hasMoreData},h.prototype._getMYearBadgesInfo=function(){var t={bronzeBadgesWon:0,silverBadgesWon:0,goldBadgesWon:0,diamondBadgesWon:0};for(var e in this.yearData)this.yearData.hasOwnProperty(e)&&(t.bronzeBadgesWon+=this.yearData[e].bronzeBadgesWon,t.silverBadgesWon+=this.yearData[e].silverBadgesWon,t.goldBadgesWon+=this.yearData[e].goldBadgesWon,t.diamondBadgesWon+=this.yearData[e].diamondBadgesWon);return t},h}),define("MenuUI/AwardsAchievementsMenu",["pixi","absolute","lodash","MenuUI/MenuTab","gameconfig","MenuUI/Menu","MenuUI/ChallengeTile","Solitaire/SolitaireGameMode","MenuUI/YearAwardsTile","MenuUI/ControlFocusManager","Solitaire/MvvmStructure/Service/SolitaireDailyChallengeService"],function(t,e,i,n,r,o,a,s,l,h,u){var d=function(t,e){window.addEventListener?(window.addEventListener("mousewheel",this.doScroll.bind(this),!1),
window.addEventListener("DOMMouseScroll",this.doScroll.bind(this),!1)):window.attachEvent("onmousewheel",this.doScroll.bind(this)),this.scrollable&&this.removeChild(this.scrollable),this.initialize(t,e)};return d.prototype=Object.create(e.Screen.prototype),d.prototype.loadArtAssets=function(t,i){var n=new e.Loader,r=[{name:"aw_menu"}];n.loadAtlases(r,function(t){e.Debug.log("loading awards menu assets ",t)}.bind(this),t,i)},d.prototype.initialize=function(i,n){e.Screen.call(this),this.ui=i,this.game=n,this.controlFocusManager=new h;var r=t.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(r)},d.prototype.onShow=function(){this.ui.showLoadingScreen(),this.artInitialized?this.completeInit():this.loadArtAssets(function(){this.artInitialized=!0,this.completeInit()}.bind(this),function(){})},d.prototype.completeInit=function(){this.menu&&this.menu.onShow(),this.addChild(this.game.menuBar),this.initData(),this.ui.hideLoadingScreen(),this.game.menuBar.onShow(!0,!0)},d.prototype.initData=function(){this.menu&&this.removeChild(this.menu),this.scrollable&&this.removeChild(this.scrollable);var i=u.GetChallengesData();this.scrollable=new t.DisplayObjectContainer;var n=[];for(var r in i)n.push(new l({},i[r],r,this));var a=new o({tiles:n,label:e.StringManager("DailyChallenge.dc"),tilePaddingX:e.Coords.x(30)});a.x=e.Coords.x(90),a.y=e.Coords.y(170),this.scrollable.addChild(a),this.addChild(this.scrollable)},d.prototype.doScroll=function(t){if(this.scrollable&&!(this.scrollable.height<e.Coords.y(900))){var i=0;t||(t=window.event),t.wheelDelta?i=t.wheelDelta/15:t.detail&&(i=-t.detail/3),this.scrollable.y=this.scrollable.y+100*i,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>this.scrollable.height-e.Coords.y(900)&&(this.scrollable.y=-(this.scrollable.height-e.Coords.y(900))),t.preventDefault()}},d.prototype.handleYearSelect=function(t){this.game.navAwards(t)},d.prototype.handleCommand=function(t){switch(t){case"Right":this.controlFocusManager.focusNextControl(1);break;case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},d}),define("MenuUI/StatsDetailMenu",["pixi","absolute","lodash","MenuUI/MenuTab","gameconfig","MenuUI/Menu","absolute/screenmetrics","MenuUI/ChallengeTile","Solitaire/SolitaireGameMode","Solitaire/SolitaireStatistics","MenuUI/StatsItemModel","MenuUI/StatsOverviewTile","MenuUI/ControlFocusManager","MenuUI/SideBar","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){var y=function(t,e){this.initStatsDetailMenu(t,e)};return y.prototype=Object.create(e.Screen.prototype),y.prototype.initStatsDetailMenu=function(i,n){e.Screen.call(this),this.ui=i,this.game=n,this.controlFocusManager=new c;var r=t.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(r),this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),g.addElement(this,{scaleChangeSource:"Full"})},y.prototype.onShow=function(){this.menu&&this.menu.onShow(),this.game.menuBar.onShow(!0,!0,!1,l.getModeById(this.statsDetailModel._gameMode)),this.initControls(),this.touchContainer||this.initTouchInterface(),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0),this.addChild(this.game.menuBar),this.handleResize(),f.add(this,this.doScroll,this)},y.prototype.onHide=function(){this.container.children=[],this.resetControlManager(),this.controlFocusManager.removeAllControls(),f.remove(this)},y.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t=0;t<this.controlFocusItems.length;t++)this.controlFocusManager.addControl(this.controlFocusItems[t],!1,"StatsTiles")},y.prototype.loadStats=function(n){this.controlFocusItems=[],this.menu&&this.removeChild(this.menu);var r=[],a={width:565,height:512,titleFontSize:22};this.statsDetailModel=n,i.each(n.StatsItemModels,function(t){t.isDetailedStats=!0;var e=new d(a,t,this);r.push(e),this.controlFocusItems.push(e)},this),this.menu=new o(i.extend({tiles:r,tilePaddingX:e.Coords.x(25),tilePaddingY:e.Coords.y(25),keepOneLine:!0,tilesInOneLine:3},g.scaleParams.MenuConfigs.MainMenuConfigs)),this.menu.x=e.Coords.x(90),this.currentWidth=e.Coords.x(1840),this.scrollable=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer,this.container.addChild(this.menu),this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth},y.prototype.handleResize=function(){this.scrollable&&(this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width/g.width)*(g.height/e.Coords.y(800)),this.updatePagesPositions(),this.scrollable.height=this.currentWidth/this.container.width*(e.Coords.y(985)/g.height)*(g.width/e.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.scrollableFakeHeight=this.scrollable.height+e.Coords.x(210),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<e.Coords.y(1080)&&(this.scrollable.y=e.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar(),this.container.x=e.Coords.x(this.sidebar.visible?-30:0))},y.prototype.updatePagesPositions=function(){var t,i=Math.max(this.container.width/this.currentWidth,.7),n=e.Coords.x(50),r=e.Coords.y(70)*i;this.currentHeight=e.Coords.y(50),this.container.children.forEach(function(e){e.x=n,e.y=0,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},y.prototype.handleStatsTileClick=function(t){},y.prototype.handleCommand=function(t){switch(this.selectSection(t),t){case"Right":this.controlFocusManager.focusNextControl(1);break;case"Left":case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},y.prototype.selectSection=function(t){"Tab"!==t&&"ShiftTab"!==t||(this.controlFocusManager.focusCurrentControl(),"Tab"===t?this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getLastControl().focusGroup?this.controlFocusManager.setFocusGroup("LeftButtons"):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getFirstControl().focusGroup?this.controlFocusManager.setFocusGroup(this.controlFocusManager.getLastControl().focusGroup):this.controlFocusManager.prevFocusGroup()))},y.prototype.handleGameInput=function(){this.resetControlManager()},y.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},y.prototype.initSidebar=function(){this.sidebar=new p({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(1900),e.Coords.y(67))},y.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=this.game.menuBar.menuBarHeight,i=g.width/e.Coords.x(1920),n=g.height/e.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/i,this.sidebar.height=this.sidebar.height/n,this.sidebar.y=t/n,this.sidebar.x=e.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*i);var r,o,a;r=this.scrollableFakeHeight,o=e.Coords.x(1080),a=r-e.Coords.y(1080),this.sidebar.resetDimensions(r,o,function(t){var e=-Math.abs(a)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>a&&(this.scrollable.y=-a)}.bind(this),g.height-t),this.sidebar.visible=!1,this.sidebar.visible=o<r,this.sidebar.visible?this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(a)):this.scrollable.y=0}},y.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var i=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},y.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},y.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)*a.devicePixelRatio),this.lastDeltaY=i}},y.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},y.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},y.prototype.scrollTo=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=e.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var i=this.scrollableFakeHeight-e.Coords.y(1080);Math.abs(this.scrollable.y)>i&&(this.scrollable.y=-i),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(i))}},y.prototype.doScroll=function(t){if(!(this.scrollableFakeHeight<e.Coords.y(1080))){var i=0;t||(t=window.event),t.wheelDelta?i=t.wheelDelta/15:t.detail&&(i=-t.detail/3),this.scrollTo(this.scrollable.y+100*i)}},y}),define("MenuUI/ThemesScreen",["pixi","absolute","lodash","gameconfig","MenuUI/Menu","absolute/screenmetrics","MenuUI/ControlFocusManager","Solitaire/SolitaireGameMode","MenuUI/SideBar","MenuUI/ThemeTile","MenuUI/ThemesMenu","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c){var p=function(t,e){this.initThemesScreen(t,e)};return p.prototype=Object.create(e.Screen.prototype),p.prototype.initThemesScreen=function(r,o){e.Screen.call(this),this.ui=r,this.game=o;var s=t.Sprite.fromFrame("win10_MS_bg.png");this.background.addChild(s),this.controlFocusManager=new a,this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),this.controlFocusItems=[],this.themeTiles=[];var l=function(t){i.each(this.themeTiles,function(e){e.updateState(t===e.themeId)})}.bind(this);i.each(n.UI.mainMenuThemes,function(t){t.disableOnClick=!1,t.themeChangeCallback=l,t.maxWidth=e.Coords.x(240);var i=new h(t,this,this.game);this.themeTiles.push(i),this.controlFocusItems.push(i)},this),this.themeMenu=new u(i.extend({tiles:this.themeTiles,label:"themes",labelPosition:{y:-e.Coords.y(1),x:e.Coords.x(1)}},d.scaleParams.MenuConfigs.MainMenuConfigs),this.game),this.themeMenu.x=e.Coords.x(0),this.currentWidth=e.Coords.x(1840),this.scrollable=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer,this.container.addChild(this.themeMenu),this.scrollable.addChild(this.container),this.addChild(this.scrollable),this.scrollable.width=this.currentWidth},p.prototype.onShow=function(){this.themeMenu&&this.themeMenu.onShow(),this.game.menuBar.onShow(!0,!0,!1,e.StringManager("headings."+this.game.config.singleGame.mode)),this.initControls(),this.touchContainer||this.initTouchInterface(),this.sidebar||this.initSidebar(),this.addChild(this.sidebar),this.scrollTo(0),this.addChild(this.game.menuBar),this.handleResize(),d.addElement(this,{scaleChangeSource:"Full"}),c.add(this,this.doScroll,this)},p.prototype.onHide=function(){this.resetControlManager(),this.controlFocusManager.removeAllControls(),d.removeElement(this),c.remove(this)},p.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons");for(var t=0;t<this.controlFocusItems.length;t++)this.controlFocusManager.addControl(this.controlFocusItems[t],!0,"ThemeTiles")},p.prototype.handleResize=function(){this.scrollable&&(this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(this.container.width/d.width)*(d.height/e.Coords.y(800)),this.updatePagesPositions(),this.scrollable.height=this.currentWidth/this.container.width*(e.Coords.y(985)/d.height)*(d.width/e.Coords.x(1840))*this.currentHeight,this.scrollable.width=this.currentWidth,this.scrollableFakeHeight=this.scrollable.height+e.Coords.x(210),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<e.Coords.y(1080)&&(this.scrollable.y=e.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar(),this.container.x=e.Coords.x(this.sidebar.visible?-30:0))},p.prototype.updatePagesPositions=function(){var t,i=Math.max(this.container.width/this.currentWidth,.7),n=e.Coords.x(50),r=e.Coords.y(70)*i;this.currentHeight=e.Coords.y(50),this.container.children.forEach(function(e){e.x=n,e.y=0,this.currentHeight+=e.height+(t?r:0),t=e}.bind(this))},p.prototype.handleStatsTileClick=function(t){},p.prototype.handleCommand=function(t){if("Back"!==t||this.game.menuBar.menuOpen||this.game.navBack(),this.selectSection(t),this.controlFocusManager.currentFocusGroup)switch(t){case"Right":this.controlFocusManager.focusNextControl(1);break;case"Left":case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Down":this.controlFocusManager.focusNextControl(1);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},p.prototype.selectSection=function(t){"Tab"!==t&&"ShiftTab"!==t||(this.controlFocusManager.focusCurrentControl(),"Tab"===t?this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getLastControl().focusGroup?this.controlFocusManager.setFocusGroup("LeftButtons"):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(this.controlFocusManager.currentFocusGroup===this.controlFocusManager.getFirstControl().focusGroup?this.controlFocusManager.setFocusGroup(this.controlFocusManager.getLastControl().focusGroup):this.controlFocusManager.prevFocusGroup()))},p.prototype.handleGameInput=function(){this.resetControlManager()},p.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},p.prototype.initSidebar=function(){this.sidebar=new l({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(1900),e.Coords.y(67))},p.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=e.Coords.y(66),i=t/d.scaleFactorY,n=d.width/e.Coords.x(1920),r=d.height/e.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/n,this.sidebar.height=this.sidebar.height/r,this.sidebar.y=i,this.sidebar.x=e.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*n);var o,a,s;o=this.scrollableFakeHeight,a=e.Coords.x(1080),s=o-e.Coords.y(1080),this.sidebar.resetDimensions(o,a,function(t){var e=-Math.abs(s)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>s&&(this.scrollable.y=-s)}.bind(this),d.height-65),this.sidebar.visible=!1,this.sidebar.visible=a<o,this.sidebar.visible?this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(s)):this.scrollable.y=0}},p.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var i=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},p.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},p.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),i=e.y-this.startY;this.scrollTo(this.scrollable.y+(i-this.lastDeltaY)*o.devicePixelRatio),this.lastDeltaY=i}},p.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},p.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},p.prototype.scrollTo=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=e.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var i=this.scrollableFakeHeight-e.Coords.y(1080);Math.abs(this.scrollable.y)>i&&(this.scrollable.y=-i),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(i))}},p.prototype.doScroll=function(t){if(!(this.scrollableFakeHeight<e.Coords.y(1080))){var i=0;t||(t=window.event),t.wheelDelta?i=t.wheelDelta/15:t.detail&&(i=-t.detail/3),this.scrollTo(this.scrollable.y+100*i)}},p}),define("text!ui/assetmap.json",[],function(){return'{\r\n\r\n  "buttonThreeSliceBlue" : {\r\n    "left":"game_end/MS_3slice_btn_blue_01.png",\r\n    "center":"game_end/MS_3slice_btn_blue_02.png",\r\n    "right":"game_end/MS_3slice_btn_blue_03.png"\r\n  },\r\n  "buttonThreeSliceOrange" : {\r\n    "left":"game_end/MS_3slice_btn_orng_01.png",\r\n    "center":"game_end/MS_3slice_btn_orng_02.png",\r\n    "right":"game_end/MS_3slice_btn_orng_03.png"\r\n  },\r\n  "buttonThreeSliceBlack": {\r\n    "left":"MS_3slice_btn_black_01.png",\r\n    "center":"MS_3slice_btn_black_02.png",\r\n    "right":"MS_3slice_btn_black_03.png"\r\n  },\r\n  "buttonThreeSliceGrey": {\r\n    "left":"MS_3slice_btn_greymodal_01.png",\r\n    "center":"MS_3slice_btn_greymodal_02.png",\r\n    "right":"MS_3slice_btn_greymodal_03.png"\r\n  }\r\n\r\n}\r\n'}),define("text!ui/layout.json",[],function(){
return'{\r\n\t"GameOverDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1632,\r\n\t\t\t"height": 831\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.gameOverHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": " Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#ffffff"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 90\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"WinDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1632,\r\n\t\t\t"height": 831\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.winHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": " Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#ffffff"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 90\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"ChallengeWinDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1632,\r\n\t\t\t"height": 831\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.challengeWinHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#ffffff"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 90\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"ChallengeGameOverDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1632,\r\n\t\t\t"height": 831\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.challengeGameOverHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#ffffff"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 90\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"WarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t}\r\n\t},\r\n\t"NewDealConfirmationModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.newDealHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": " Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.newDealContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"ChallengeExitWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.challengeExitWarning",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"BoardUndoWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.boardUndoWarningHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.boardUndoWarning",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"NoMoreMovesModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.noMoreMovesHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.noMoreMovesContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"SingleGameSlideOut": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"backgroundColor": "0x000001",\r\n\t\t"position": {\r\n\t\t\t"x": 0,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "hint",\r\n\t\t\t\t\t\t"text": "buttons.hint",\r\n\t\t\t\t\t\t"icon": "icon_hint.png",\r\n\t\t\t\t\t\t"action": "hintAction",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.options",\r\n\t\t\t\t\t\t"icon": "icon_settings.png",\r\n\t\t\t\t\t\t"action": "openOptions",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "Statistics",\r\n\t\t\t\t\t\t"icon": "about.png",\r\n\t\t\t\t\t\t"action": "openStatistics",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "Themes",\r\n\t\t\t\t\t\t"icon": "icon_howtoplay.png",\r\n\t\t\t\t\t\t"action": "openThemes",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.howToPlay",\r\n\t\t\t\t\t\t"icon": "icon_howtoplay.png",\r\n\t\t\t\t\t\t"action": "openHtpMenu",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "exitFullScreen",\r\n\t\t\t\t\t\t"text": "buttons.exitFullScreen",\r\n\t\t\t\t\t\t"icon": "icon_fullscreen.png",\r\n\t\t\t\t\t\t"action": "toggleFullscreen",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hide": true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "fullScreen",\r\n\t\t\t\t\t\t"text": "buttons.fullscreen",\r\n\t\t\t\t\t\t"icon": "icon_fullscreen.png",\r\n\t\t\t\t\t\t"action": "toggleFullscreen",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.about",\r\n\t\t\t\t\t\t"icon": "about.png",\r\n\t\t\t\t\t\t"action": "openAbout",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"MainSlideOut": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"backgroundColor": "0x000001",\r\n\t\t"position": {\r\n\t\t\t"x": 0,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "hint",\r\n\t\t\t\t\t\t"text": "buttons.hint",\r\n\t\t\t\t\t\t"icon": "icon_hint.png",\r\n\t\t\t\t\t\t"action": "hintAction",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t"hideOnMainMenu": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.games",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.klondike",\r\n\t\t\t\t\t\t"textColor": "#00bffe",\r\n\t\t\t\t\t\t"icon": "klondike_menu_icon.png",\r\n\t\t\t\t\t\t"action": "switchGame",\r\n\t\t\t\t\t\t"data": "Klondike"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.spider",\r\n\t\t\t\t\t\t"textColor": "#ad62e1",\r\n\t\t\t\t\t\t"icon": "spider_menu_icon.png",\r\n\t\t\t\t\t\t"action": "switchGame",\r\n\t\t\t\t\t\t"data": "Spider"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.freecell",\r\n\t\t\t\t\t\t"textColor": "#f10032",\r\n\t\t\t\t\t\t"icon": "freecell_menu_icon.png",\r\n\t\t\t\t\t\t"action": "switchGame",\r\n\t\t\t\t\t\t"data": "FreeCell"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.pyramid",\r\n\t\t\t\t\t\t"textColor": "#fe7d00",\r\n\t\t\t\t\t\t"icon": "pyramid_menu_icon.png",\r\n\t\t\t\t\t\t"action": "switchGame",\r\n\t\t\t\t\t\t"data": "Pyramid"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.tripeaks",\r\n\t\t\t\t\t\t"textColor": "#3aa404",\r\n\t\t\t\t\t\t"icon": "tripeaks_menu_icon.png",\r\n\t\t\t\t\t\t"action": "switchGame",\r\n\t\t\t\t\t\t"data": "TriPeaks"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.challenges",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.dailyChallenge",\r\n\t\t\t\t\t\t"textColor": "#efbe0a",\r\n\t\t\t\t\t\t"icon": "DC_Icon.png",\r\n\t\t\t\t\t\t"action": "navDaily",\r\n\t\t\t\t\t\t"data": "DailyChallenge"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.starClub",\r\n\t\t\t\t\t\t"textColor": "#efbe0a",\r\n\t\t\t\t\t\t"icon": "Star-Club_icon.png",\r\n\t\t\t\t\t\t"action": "navStarClub",\r\n\t\t\t\t\t\t"data": "StarClub"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.options",\r\n\t\t\t\t\t\t"icon": "icon_settings.png",\r\n\t\t\t\t\t\t"action": "openOptions",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.howToPlay",\r\n\t\t\t\t\t\t"icon": "icon_howtoplay.png",\r\n\t\t\t\t\t\t"action": "openHtpMenu",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hideOnMainMenu": false\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "exitFullScreen",\r\n\t\t\t\t\t\t"text": "buttons.exitFullScreen",\r\n\t\t\t\t\t\t"icon": "icon_fullscreen.png",\r\n\t\t\t\t\t\t"action": "toggleFullscreen",\r\n\t\t\t\t\t\t"data": "",\r\n\t\t\t\t\t\t"hide": true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "fullScreen",\r\n\t\t\t\t\t\t"text": "buttons.fullscreen",\r\n\t\t\t\t\t\t"icon": "icon_fullscreen.png",\r\n\t\t\t\t\t\t"action": "toggleFullscreen",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.about",\r\n\t\t\t\t\t\t"icon": "about.png",\r\n\t\t\t\t\t\t"action": "openAbout",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsShared": {\r\n\t\t"note": "This is merged with options from specific modes. Does not work in uibuilder.",\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "",\r\n\t\t\t\t"titlePadding": 0,\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.soundFx",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "soundFx",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.music",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "music",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.hints",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "hints",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.alerts",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "showAlerts",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.singleTapToMove",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "singleTapToMove",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.gameEndAnimation",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "gameEndAnimation",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.undoBoardAlert",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "showUndoBoardAlert",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsGeneric": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": []\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsKlondikeChallenge": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "klondike",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.klondikeLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsSpiderChallenge": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "spider",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.spiderLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsFreeCellChallenge": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "freecell",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.freeCellLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsPyramidChallenge": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "pyramid",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.pyramidLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsTriPeaksChallenge": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "tripeaks",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.triPeaksLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsKlondike": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 15,\r\n\t\t\t\t"settingsPrefix": "klondike",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n        "buttons": [\r\n          {\r\n            "text": "buttons.cardsPerDraw",\r\n            "type": "radio",\r\n            "settingsKey": "cardsPerDraw",\r\n            "options": [\r\n              {\r\n                "label": "buttons.draw1",\r\n                "value": "1",\r\n                "selected": false\r\n              },\r\n              {\r\n                "label": "buttons.draw3",\r\n                "value": "3",\r\n                "selected": true\r\n              }\r\n            ],\r\n            "action": "changeSetting"\r\n          },\r\n          {\r\n            "text": "buttons.scoringType",\r\n            "type": "radio",\r\n            "settingsKey": "scoringType",\r\n            "options": [\r\n              {\r\n                "label": "buttons.standard",\r\n                "value": "STANDARD",\r\n                "selected": true\r\n              },\r\n              {\r\n                "label": "buttons.lasVegas",\r\n                "value": "LASVEGAS",\r\n                "selected": false\r\n              },\r\n              {\r\n                "label": "buttons.cumulativeVegas",\r\n                "value": "LASVEGASCUMULATIVE",\r\n                "selected": false\r\n              }\r\n            ],\r\n            "action": "changeSetting"\r\n          },\r\n          {\r\n            "id": "resetCumulativeScore",\r\n            "type": "button",\r\n            "text": "buttons.resetCumulativeScore",\r\n            "textColor": "0xefbe0a",\r\n            "backgroundColor": "0x0bb3b9",\r\n            "action": "resetCumulativeScore",\r\n            "updateState": "updateResetCumulativeScoreState"\r\n          },\r\n          {\r\n            "text": "buttons.timer",\r\n            "type": "toggle",\r\n            "settingsKey": "timer",\r\n            "on": true,\r\n            "action": "changeSetting"\r\n          },\r\n          {\r\n            "text": "buttons.klondikeLayoutDirection",\r\n            "type": "radio",\r\n            "settingsKey": "layoutDirection",\r\n            "options": [\r\n              {\r\n                "label": "buttons.left",\r\n                "value": "1",\r\n                "selected": false\r\n              },\r\n              {\r\n                "label": "buttons.right",\r\n                "value": "2",\r\n                "selected": true\r\n              }\r\n            ],\r\n            "hideOnMainMenu": true,\r\n            "action": "changeSetting"\r\n          }\r\n        ]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsSpider": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 40,\r\n\t\t\t\t"settingsPrefix": "spider",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n        "buttons": [\r\n          {\r\n            "text": "buttons.suits",\r\n            "type": "radio",\r\n            "settingsKey": "suits",\r\n            "options": [\r\n              {\r\n                "label": "buttons.suits1",\r\n                "value": "1",\r\n                "selected": false\r\n              },\r\n              {\r\n                "label": "buttons.suits2",\r\n                "value": "2",\r\n                "selected": true\r\n              },\r\n              {\r\n                "label": "buttons.suits4",\r\n                "value": "4",\r\n                "selected": true\r\n              }\r\n            ],\r\n            "action": "changeSetting"\r\n          },\r\n          {\r\n            "text": "buttons.spiderLayoutDirection",\r\n            "type": "radio",\r\n            "settingsKey": "layoutDirection",\r\n            "options": [\r\n              {\r\n                "label": "buttons.left",\r\n                "value": "1",\r\n                "selected": false\r\n              },\r\n              {\r\n                "label": "buttons.right",\r\n                "value": "2",\r\n                "selected": true\r\n              }\r\n            ],\r\n            "hideOnMainMenu": true,\r\n            "action": "changeSetting"\r\n          }\r\n        ]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsFreeCell": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 10,\r\n\t\t\t\t"settingsPrefix": "freecell",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"id": "seedInput",\r\n\t\t\t\t\t\t"text": "buttons.gameNumber",\r\n\t\t\t\t\t\t"buttonOptions": {\r\n\t\t\t\t\t\t\t"text": "buttons.play",\r\n\t\t\t\t\t\t\t"threeSlice": {\r\n\t\t\t\t\t\t\t\t"multistate": true,\r\n\t\t\t\t\t\t\t\t"images": {\r\n\t\t\t\t\t\t\t\t\t"left": "MS_3slice_btn_greymodal_01.png",\r\n\t\t\t\t\t\t\t\t\t"center": "MS_3slice_btn_greymodal_02.png",\r\n\t\t\t\t\t\t\t\t\t"right": "MS_3slice_btn_greymodal_03.png"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t"width": 65,\r\n\t\t\t\t\t\t\t"height": 60\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t"type": "input",\r\n\t\t\t\t\t\t"settingsKey": "gameNumber",\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.freeCellLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsPyramid": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 40,\r\n\t\t\t\t"settingsPrefix": "pyramid",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.timer",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "timer",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.pyramidLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsTriPeaks": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x00275e",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.gameOptions",\r\n\t\t\t\t"titlePadding": 40,\r\n\t\t\t\t"settingsPrefix": "tripeaks",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.triPeaksLayoutDirection",\r\n\t\t\t\t\t\t"type": "radio",\r\n\t\t\t\t\t\t"settingsKey": "layoutDirection",\r\n\t\t\t\t\t\t"options": [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.left",\r\n\t\t\t\t\t\t\t\t"value": "1",\r\n\t\t\t\t\t\t\t\t"selected": false\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t"label": "buttons.right",\r\n\t\t\t\t\t\t\t\t"value": "2",\r\n\t\t\t\t\t\t\t\t"selected": true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t"hideOnMainMenu": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsTutorials": {\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "buttons.showTutorial",\r\n\t\t\t\t"titlePadding": 40,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "showTutorial",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"GameOptionsShowDifficulty": {\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "buttons.showDifficulty",\r\n\t\t\t\t"titlePadding": 40,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "",\r\n\t\t\t\t\t\t"type": "toggle",\r\n\t\t\t\t\t\t"settingsKey": "showDifficulty",\r\n\t\t\t\t\t\t"on": true,\r\n\t\t\t\t\t\t"action": "changeSetting"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"BronzeEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.bronzeEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/BronzeBadgeEarned.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.bronzeEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"SilverEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.silverEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/SilverBadgeEarned.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.silverEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"GoldEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.goldEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/GoldBadgeEarned.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.goldEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"DiamondEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.diamondEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/DiamondBadgeEarned.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.diamondEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"PerfectEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.perfectEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/PerfectEarned.jpg",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.perfectEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"BonusEarnedDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.bonusEarnedHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/CompletedAllChallenges_1_Solitaire.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.bonusEarnedContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"DCFirstCompleteDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.dcFirstCompleteHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc",\r\n\t\t\t\t\t"header": true\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/CompletedAllChallenges_1_Solitaire.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.dcFirstCompleteContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"MoreCoinsDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1265,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.moreCoinsHeadline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/CompletedAllChallenges_2.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.moreCoinsContent",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"HowToPlaySlideOut": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x133866",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.howToPlay",\r\n\t\t\t\t"titlePadding": 0,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.klondike",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "klondike_menu_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "Klondike"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.spider",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "spider_menu_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "Spider"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.freecell",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "freecell_menu_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "FreeCell"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.pyramid",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "pyramid_menu_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "Pyramid"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "tiles.tripeaks",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "tripeaks_menu_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "TriPeaks"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.dailyChallenge",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "DC_Icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "DailyChallenge"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.starClub",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "Star-Club_icon.png",\r\n\t\t\t\t\t\t"action": "openHtp",\r\n\t\t\t\t\t\t"data": "StarClub"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"AboutSlideOut": {\r\n\t\t"note": "This will not work in uibuilder.",\r\n\t\t"submenu": true,\r\n\t\t"backgroundColor": "0x133866",\r\n\t\t"position": {\r\n\t\t\t"x": 360,\r\n\t\t\t"y": 66\r\n\t\t},\r\n\t\t"buttonSections": [\r\n\t\t\t{\r\n\t\t\t\t"title": "titles.about",\r\n\t\t\t\t"description": "aboutDescription",\r\n\t\t\t\t"titlePadding": 0,\r\n\t\t\t\t"settingsPrefix": "general",\r\n\t\t\t\t"hideHorizontalRule": true,\r\n\t\t\t\t"buttons": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.credits",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "credits.png",\r\n\t\t\t\t\t\t"action": "openCredits",\r\n\t\t\t\t\t\t"data": ""\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.support",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "support.png",\r\n\t\t\t\t\t\t"action": "openLink",\r\n\t\t\t\t\t\t"data": "https://www.facebook.com/microsoftsolitaire"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.privacy",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "privacy_policy.png",\r\n\t\t\t\t\t\t"action": "openLink",\r\n\t\t\t\t\t\t"data": "https://privacy.microsoft.com/en-us/privacystatement"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.terms",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "terms_of_use.png",\r\n\t\t\t\t\t\t"action": "openLink",\r\n\t\t\t\t\t\t"data": "http://www.xbox.com/en-US/legal/LiveTOU"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t"text": "buttons.licenses",\r\n\t\t\t\t\t\t"textColor": "#ffffff",\r\n\t\t\t\t\t\t"icon": "terms_of_use.png",\r\n\t\t\t\t\t\t"action": "openLink",\r\n\t\t\t\t\t\t"data": "static/licenses.html"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t"LocalStorageWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.localStorageWarningHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.localStorageWarningContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"PrivateBrowsingWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.privateBrowsingWarningHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.privateBrowsingWarningContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"BrowserWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.browserWarningHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.browserWarningContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"ManifestWarningModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.manifestWarningHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.manifestWarningContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"NetworkErrorModal": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 294\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.networkErrorHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 37\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.networkErrorContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#000000"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 350,\r\n\t\t\t\t\t"y": 126\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"BoostDialog": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1920,\r\n\t\t\t"height": 433\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.boostHeadline",\r\n\t\t\t\t\t"fontSize": 30,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#fcfcfc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 867,\r\n\t\t\t\t\t"y": 90\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"body": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dialogs.boostContent",\r\n\t\t\t\t\t"fontSize": 20,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#fcfcfc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 867,\r\n\t\t\t\t\t"y": 177\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "opt-in-popup-icon.png"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 562,\r\n\t\t\t\t\t"y": 65\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"DC-FUE-1": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1300,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue1.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/fue1.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue1.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"DC-FUE-2": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1400,\r\n\t\t\t"height": 1000\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue2.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/fue2.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bronzeLabel": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "DailyChallenge.bronze",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#f77622"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 129,\r\n\t\t\t\t\t"y": 560\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"silverLabel": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "DailyChallenge.silver",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#c0c0c0"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 480,\r\n\t\t\t\t\t"y": 560\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"goldLabel": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "DailyChallenge.gold",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#fdd530"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 820,\r\n\t\t\t\t\t"y": 560\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"diamondLabel": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "DailyChallenge.diamond",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#2dfefd"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 1115,\r\n\t\t\t\t\t"y": 560\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue2.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 710\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"DC-FUE-3": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1300,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue3.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "dailychallenge/fue3.jpg",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "dc_fue.fue3.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"SC-FUE-1": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1300,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue1.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "star_club/fue1.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 124\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue1.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 440\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"SC-FUE-2": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1300,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue2.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "star_club/fue2.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 134\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue2.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 430\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"SC-FUE-3": {\r\n\t\t"type": "Container",\r\n\t\t"params": {\r\n\t\t\t"width": 1300,\r\n\t\t\t"height": 757\r\n\t\t},\r\n\t\t"children": {\r\n\t\t\t"title": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue3.headline",\r\n\t\t\t\t\t"fontSize": 55,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "center",\r\n\t\t\t\t\t"fill": "#56a7cc"\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": 50,\r\n\t\t\t\t\t"y": 25\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"graphic": {\r\n\t\t\t\t"type": "Sprite",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"texture": "star_club/fue3.png",\r\n\t\t\t\t\t"scale": {\r\n\t\t\t\t\t\t"x": 1.86,\r\n\t\t\t\t\t\t"y": 1.86\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 134\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t"bodyCopy": {\r\n\t\t\t\t"type": "Text",\r\n\t\t\t\t"params": {\r\n\t\t\t\t\t"text": "sc_fue.fue3.description",\r\n\t\t\t\t\t"fontSize": 40,\r\n\t\t\t\t\t"font": "Segoe UI",\r\n\t\t\t\t\t"fontFamily": "segoe",\r\n\t\t\t\t\t"align": "left",\r\n\t\t\t\t\t"fill": "#ffffff",\r\n\t\t\t\t\t"wordWrap": true,\r\n\t\t\t\t\t"wordWrapWidth": 1185\r\n\t\t\t\t},\r\n\t\t\t\t"position": {\r\n\t\t\t\t\t"x": "center",\r\n\t\t\t\t\t"y": 430\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}'
}),define("text!scaleparams.json",[],function(){return'{\r\n  "MenuConfigs": {\r\n    "MainMenuConfigs": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "none",\r\n          "type": "xl",\r\n          "maxWidth": 1875\r\n        },\r\n        {\r\n          "screenHeight": 452,\r\n          "screenWidth": 812,\r\n          "align": "center",\r\n          "type": "sm",\r\n          "maxWidth": 1100\r\n        }\r\n      ]\r\n    },\r\n    "SCMenuConfigs": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "none",\r\n          "type": "xl"\r\n        },\r\n        {\r\n          "screenWidth": 1405,\r\n          "maxWidth": 1750,\r\n          "align": "none",\r\n          "type": "lg"\r\n        },\r\n        {\r\n          "screenWidth": 1096,\r\n          "maxWidth": 1362,\r\n          "align": "none",\r\n          "type": "md"\r\n        },\r\n        {\r\n          "screenWidth": 779,\r\n          "maxWidth": 962,\r\n          "posX": 125,\r\n          "type": "sm"\r\n        }\r\n      ]\r\n    },\r\n    "SCCollectionMenuConfigs": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "none",\r\n          "type": "xl"\r\n        },\r\n        {\r\n          "screenWidth": 1399,\r\n          "maxWidth": 1725,\r\n          "align": "none",\r\n          "type": "lg"\r\n        },\r\n        {\r\n          "screenWidth": 1069,\r\n          "maxWidth": 1325,\r\n          "type": "md"\r\n        },\r\n        {\r\n          "screenWidth": 731,\r\n          "maxWidth": 909,\r\n          "type": "sm"\r\n        }\r\n      ]\r\n    },\r\n    "SCChallengeMenu": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "none",\r\n          "type": "xl"\r\n        },\r\n        {\r\n          "screenWidth": 1408,\r\n          "maxWidth": 1750,\r\n          "align": "none",\r\n          "type": "lg"\r\n        },\r\n        {\r\n          "screenWidth": 1088,\r\n          "maxWidth": 1350,\r\n          "type": "md"\r\n        },\r\n        {\r\n          "screenWidth": 759,\r\n          "maxWidth": 937,\r\n          "containerPosY": 150,\r\n          "type": "sm"\r\n        }\r\n      ]\r\n    },\r\n    "DCMenuConfigs": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "center",\r\n          "type": "xl"\r\n        }\r\n      ]\r\n    },\r\n    "AwardsMenuConfigs": {\r\n      "layoutConfigs": [\r\n        {\r\n          "screenHeight": 1920,\r\n          "screenWidth": 1080,\r\n          "align": "none",\r\n          "type": "xl",\r\n          "maxWidth": 1875\r\n        },\r\n        {\r\n          "screenWidth": 1090,\r\n          "align": "none",\r\n          "type": "lg",\r\n          "maxWidth": 1700\r\n        },\r\n        {\r\n          "screenWidth": 780,\r\n          "align": "none",\r\n          "type": "md",\r\n          "maxWidth": 1500\r\n        },\r\n        {\r\n          "screenWidth": 624,\r\n          "align": "none",\r\n          "type": "sm",\r\n          "maxWidth": 1200\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  "SC-CollectionGroupsMenuConfigs": {\r\n    "GamesCollection": {\r\n      "label": "GamesCollection"\r\n    },\r\n    "MixedCollection": {\r\n      "label": "MixedCollection"\r\n    }\r\n  },\r\n  "SCChallengePacks": {\r\n    "GamesCollection": {\r\n    },\r\n    "MixedCollection": {\r\n    }\r\n  },\r\n  "SCGamePacks": {\r\n  },\r\n  "StatisticsMenuConfig": {\r\n  }\r\n}\r\n'}),define("absolute/particlesystem",["proton"],function(t){return{init:function(){this.proton=new t,this.particleRenderer=new t.Renderer("other",this.proton),this.particleRenderer.start()},update:function(){this.proton.update()},addEmitter:function(t){this.proton.addEmitter(t)},removeEmitter:function(t){this.proton.removeEmitter(t)},_getEmitterCount:function(){return this.proton.emitters.length},cleanUp:function(){t.prototype.destory.call(this.proton)}}}),define("MenuUI/htp/HtpTile",["pixi","absolute","lodash","Solitaire/SolitaireGameMode","MenuUI/MenuTile","util/CustomWordWrapper"],function(t,e,i,n,r,o){var a=function(t,e){var n={wideTile:!1};this.initHtpTile(i.extend(n,t),e)};return a.prototype=Object.create(r.prototype),a.prototype.initHtpTile=function(i,n){r.call(this,i);var a=new t.Graphics,s=e.Platform.isMobile()?this.config.wideTile?e.Coords.x(1606.5):e.Coords.x(920):this.config.wideTile?e.Coords.x(945):e.Coords.x(420),l=e.Platform.isMobile()?e.Coords.x(20):e.Coords.x(10),h=s-2*l,u=e.Platform.isMobile()?n?e.Coords.x(8):e.Coords.x(4):n?e.Coords.x(4):e.Coords.x(2),d=e.Platform.isMobile()?this.config.wideTile?e.Coords.x(0):e.Coords.x(640+l):this.config.wideTile?e.Coords.x(600):e.Coords.x(320),c=e.Platform.isMobile()&&this.config.wideTile?e.Coords.y(850):e.Coords.y(20),p=n?35*e.ScreenMetrics.getResScale()*(e.Platform.isMobile()?2:1)+"px Segoe UI":30*e.ScreenMetrics.getResScale()*(e.Platform.isMobile()?2:1)+"px Segoe UI",g={font:p,fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"center"},f={font:23*e.ScreenMetrics.getResScale()*(e.Platform.isMobile()?2:1)+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left",wordWrap:!0,wordWrapWidth:h},y=new t.Text(this.config.headline,g),m=new t.Text(this.config.description,f);e.StringManager.shrinkToFit(m,23*e.ScreenMetrics.getResScale()*(e.Platform.isMobile()?2:1),"",null,e.Coords.y(this.height-100)*(e.Platform.isMobile()?1.5:1)),e.StringManager.shrinkToFit(y,e.StringManager.extractNumbersFromString(p),"",e.Coords.x(400)*(e.Platform.isMobile()?2:1)),y.x=d+l,y.y=c+l,this.addChild(y),a.moveTo(0,0),a.lineStyle(u,16777215,1),a.lineTo(s,0),a.x=d+l,a.y=e.Platform.isMobile()?c+(n?e.Coords.y(120):e.Coords.y(110)):n?e.Coords.y(65):e.Coords.y(60),this.addChild(a),m.x=d+l,m.y=e.Platform.isMobile()?c+(n?e.Coords.y(150):e.Coords.y(140)):n?e.Coords.y(75):e.Coords.y(70),this.addChild(m),this.interactive=!1,this.buttonMode=!1,this._hasFocus=!1,this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(e.Coords.x(3),16777215);var C=e.Coords.x(-4);this.focusIndicator.drawRect(C,C,this.width-2*C,this.height-2*C),o.doTextCustomWrap(m,23*e.ScreenMetrics.getResScale(),"",h,e.Coords.y(this.height-50))},a.prototype.handleClick=function(){},a.prototype._focusChanged=function(){this._hasFocus?this.addChild(this.focusIndicator):-1!==this.children.indexOf(this.focusIndicator)&&this.removeChild(this.focusIndicator)},Object.defineProperty(a.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),a}),define("MenuUI/htp/HtpScreen",["pixi","absolute","absolute/screenmetrics","lodash","gameconfig","MenuUI/MenuTile","MenuUI/Menu","MenuUI/MultiPageMenu","MenuUI/htp/HtpTile","MenuUI/SideBar","MenuUI/ControlFocusManager","Managers/ScaleManager","Managers/ScrollManager","Solitaire/SolitaireGameMode"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){var g=function(t,e){this.initHtpScreen(t,e)};return g.prototype=Object.create(e.Screen.prototype),g.prototype.initHtpScreen=function(i,n){this.clickHandler=this.handleGameInput.bind(this),window.addEventListener("click",this.clickHandler),e.Screen.call(this),this.ui=i,this.game=n,this.controlFocusManager=new u,d.addElement(this,{scaleChangeSource:"Full"});var r=t.Sprite.fromFrame("win10_MS_bg.png");this.addChild(r)},g.prototype.initSidebar=function(){this.sidebar=new h({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(1900),e.Coords.y(67)),this.updateSidebar()},g.prototype.updateSidebar=function(){if(this.sidebar&&this.scrollable){var t=this.game.menuBar.menuBarHeight,i=d.width/e.Coords.x(1920),n=d.height/e.Coords.y(1080);this.sidebar.scale.set(1,1),this.sidebar.width=this.sidebar.width/i,this.sidebar.height=this.sidebar.height/n,this.sidebar.y=t/n,this.sidebar.x=e.Coords.x(1900)-(this.sidebar.width-this.sidebar.width*i);var r,o,a;r=this.scrollableFakeHeight,o=e.Coords.x(1080),a=r-e.Coords.y(1080),this.sidebar.resetDimensions(r,o,function(t){var e=-Math.abs(a)*t/100;this.scrollable.y=e,this.scrollable.y>0&&(this.scrollable.y=0),Math.abs(this.scrollable.y)>a&&(this.scrollable.y=-a)}.bind(this),d.height-t),this.sidebar.visible=o<r,this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(a))}},g.prototype.handleResize=function(){this.scrollable&&(this.scrollTo(this.scrollable.y),this.scrollable.height=e.Coords.y(985)/d.height*(d.width/e.Coords.x(1920))*this.currentHeight,this.container.y=(this.game.menuBar.menuButton.y+this.game.menuBar.menuButton.height)*(e.Coords.x(1920)/d.width)*(d.height/e.Coords.y(980)),this.scrollableFakeHeight=this.scrollable.height+e.Coords.x(150),this.scrollable.y<0&&this.scrollableFakeHeight+this.scrollable.y<e.Coords.y(1080)&&(this.scrollable.y=e.Coords.y(1080)-this.scrollableFakeHeight),this.updateSidebar())},g.prototype.onShow=function(){this.ui.showLoadingScreen(),e.Screen.prototype.onShow.call(this);var i=new e.Loader,n=[{name:"htp_"+this.mode.toLowerCase()}];i.loadArt(n,function(t){this.ui.loadingScreen.updateLoadingProgress(t)}.bind(this),function(){this.ui.loadingScreen.finishLoadingProgress(),this.ui.loadingScreen.resetLoadingProgress(),this.htpContentLayer=new t.DisplayObjectContainer,this.buildMenu(),this.addChild(this.htpContentLayer),this.addChild(this.game.menuBar),this.game.menuBar.onShow(!0,!0,!1,e.StringManager("titles.howToPlay")+" "+e.StringManager("tiles."+this.mode)),this.ui.hideLoadingScreen(),this.ui.refreshBackground=!0,this.currentHeight=this.scrollable.height+e.Coords.y(150),this.handleResize(),this.handleResize()}.bind(this)),c.add(this,this.doScroll,this)},g.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var i=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=i,this.touchContainer.addChild(this.scrollable),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},g.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y,this.enableButtons(!1)},g.prototype.handleDrag=function(t){if(this.dragging){var e=t.getLocalPosition(this.parent),n=e.y-this.startY;this.scrollTo(this.scrollable.y+(n-this.lastDeltaY)*i.devicePixelRatio),this.lastDeltaY=n}},g.prototype.handleDragEnd=function(t){this.dragging&&(this.dragging=!1)},g.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.scrollable.children.length;e<i;e++)this.scrollable.children[e].interactive=t},g.prototype.onHide=function(){e.Screen.prototype.onHide.call(this),c.remove(this),this.htpContentLayer&&(this.htpContentLayer.removeChild(this.paginatedMenu),this.removeChild(this.htpContentLayer),this.htpContentLayer=null,this.paginatedMenu=null),this.sidebar&&(this.removeChild(this.sidebar),this.sidebar=null),this.htpTexts=null,this.scrollable.children=[],this.controlFocusManager.removeAllControls(),this.sectionSelected=!1,this.removeChild(this.sidebar)},g.prototype.handleOrientationChange=function(t){e.Screen.prototype.handleOrientationChange.call(this,t)},g.prototype.buildMenu=function(){this.initControls();var i=n.cloneDeep(r.UI.htpLayouts[this.mode]),o=[],a={Klondike:1880805,Spider:10712548,FreeCell:13780293,Pyramid:16288292,TriPeaks:8171815,DailyChallenge:1277385,StarClub:66900};if(n.each(i,function(i,r){var s,h;e.Platform.isMobile()||(s="page1"===r,h=new t.DisplayObjectContainer),n.each(i,function(i,n){e.Platform.isMobile()&&(s="page1"===r,h=new t.DisplayObjectContainer);var u,d=new t.DisplayObjectContainer,c=t.Sprite.fromFrame(i.image),p=new t.Graphics;if(e.Platform.isMobile()?o.length>0||n>0?c.scale.set(2,2):c.scale.set(2.54,2.54):c.scale.set(.9,.9),i.headline=this.getText(i.text,"headline",i.genericText),i.description=this.getText(i.text,"description",i.genericText),i.needTitle){var g={font:25*e.ScreenMetrics.getResScale()*5+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center"},f=new t.Text(i.headline,g);e.StringManager.shrinkToFit(f,25*e.ScreenMetrics.getResScale()*5,"",e.Coords.x(600)),f.anchor.set(.5,.5),f.x=c.width/2+e.Coords.x(15),f.y=c.height/2+e.Coords.y(108),c.addChild(f)}p.beginFill(a[this.mode]),p.drawRect(0,0,!e.Platform.isMobile()&&(o.length>0||n>0)?e.Coords.x(820):e.Coords.x(1664),e.Platform.isMobile()?o.length>0||n>0?e.Coords.y(704):e.Coords.y(1408):e.Coords.y(352)),p.endFill(),d.addChild(p),c.x=e.Coords.x(20),c.y=e.Coords.x(32),d.addChild(c),i.image=new t.Sprite(d.generateTexture()),e.Platform.isMobile()?(u=new l(i,!1),u.x=0,u.y=0):(u=new l(i,s&&0===n),0===o.length?(u.x=n>1?e.Coords.x(846):0,u.y=n>0?e.Coords.y(376):0):(u.x=n%2==0?0:e.Coords.x(846),u.y=n>1?e.Coords.y(376):0)),this.controlFocusManager.addControl(u,!1,"HtpPage"),h.addChild(u),e.Platform.isMobile()&&o.push(h)},this),e.Platform.isMobile()||o.push(h)},this),this.scrollable=new t.DisplayObjectContainer,this.container=new t.DisplayObjectContainer,e.Platform.isMobile())for(var s=0;s<o.length;s++){var h=o[s],u=o[s-1]?o[s-1].y+o[s-1].height:e.Coords.y(50);h.x=e.Coords.x(110),h.y=u,this.container.addChild(h)}else for(var s=0;s<o.length;s++){var h=o[s],u=o[s-1]?o[s-1].y+o[s-1].height:e.Coords.y(50);h.x=e.Coords.x(110),h.y=u,this.container.addChild(h)}this.scrollable.addChild(this.container),this.htpContentLayer.addChild(this.scrollable),this.initTouchInterface(),this.initSidebar()},g.prototype.initControls=function(){this.controlFocusManager.addControl(this.game.menuBar.controlGroup[0],!1,"LeftButtons"),this.controlFocusManager.addControl(this.game.menuBar.controlGroup[1],!1,"LeftButtons"),this.game.menuBar.fullScreenEnabled&&this.controlFocusManager.addControl(this.game.menuBar.controlGroup[3],!1,"RightButtons")},g.prototype.getText=function(t,i,r){return this.htpTexts||(this.htpTexts=e.StringManager("howToPlay."+this.mode.toLowerCase(),null,!0),this.htpGenericTexts=e.StringManager("howToPlay.general",null,!0)),n.find(r?this.htpGenericTexts:this.htpTexts,{id:t})[i]},g.prototype.scrollTo=function(t){if(this.scrollable){if(this.scrollableFakeHeight<=e.Coords.y(1080))return void(this.scrollable.y=0);this.scrollable.y=t,this.scrollable.y>0&&(this.scrollable.y=0);var i=this.scrollableFakeHeight-e.Coords.y(1080);Math.abs(this.scrollable.y)>i&&(this.scrollable.y=-i),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.scrollable.y)/Math.abs(i))}},g.prototype.handleCommand=function(t,e){if("Down"===t||"Up"===t){"Down"===t?this.scrollTo(this.scrollable.y-40):this.scrollTo(this.scrollable.y+40)}},g.prototype.doScroll=function(t){if(!(this.scrollableFakeHeight<e.Coords.y(1080))){var i=0;t||(t=window.event),t.wheelDelta?i=t.wheelDelta/15:t.detail&&(i=-t.detail/3),this.scrollTo(this.scrollable.y+100*i),t.preventDefault()}},g.prototype.handleCommand=function(t,e){if(!e)switch(this.selectSection(t,e),t){case"Right":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(1),e||this.scrollToCurrentFocused();break;case"Left":if(!this.sectionSelected)return;this.controlFocusManager.focusNextControl(-1),e||this.scrollToCurrentFocused();break;case"Up":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(-1)?this.startScrolling(-2):this.scrollToCurrentFocused():this.startScrolling(-2);break;case"Down":this.controlFocusManager.getCurrentControl()?this.controlFocusManager.focusNextControl(1)?this.startScrolling(2):this.scrollToCurrentFocused():this.startScrolling(2);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}},g.prototype.scrollToCurrentFocused=function(){current=this.controlFocusManager.getCurrentControl(),this.scrollTo(-current._bounds.y+2*current.height)},g.prototype.handlePageChange=function(t,e){switch(e){case 0:this.controlFocusManager.setFocusGroup("LeftButtons");break;case 1:this.controlFocusManager.setFocusGroup("RightButtons");break;case 2:this.controlFocusManager.setFocusGroup("HtpPage")}},g.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},g.prototype.selectSection=function(t,e){if("Tab"===t||"ShiftTab"===t){switch(this.controlFocusManager.focusCurrentControl(),this.sectionSelected=!0,"Tab"===t?2===this.page?(this.handlePageChange(this.page,0),this.page=0):this.controlFocusManager.nextFocusGroup():"ShiftTab"===t&&(0===this.page?(this.handlePageChange(this.page,2),this.page=2):this.controlFocusManager.prevFocusGroup()),this.controlFocusManager.currentFocusGroup){case"LeftButtons":this.page=0;break;case"RightButtons":this.page=1;break;case"HtpPage":this.page=2}var i=this.controlFocusManager.getCurrentControl();e||this.scrollTo(-i._bounds.y+2*i.height)}},g.prototype.handleGameInput=function(){this.resetControlManager()},g.prototype.resetControlManager=function(){this.controlFocusManager.unfocusCurrentControl()},g}),define("MenuUI/WarningModal",["pixi","absolute","MenuUI/MsftModal","lodash","Arkadium/GameEngine/Core/EngineManagers","util/NineSliceButton","util/eventhandler","Managers/ScaleManager","util/CustomWordWrapper"],function(t,e,i,n,r,o,a,s,l){var h=function(t,e,i,n){this.initWarningModal(t,e,i,n)};return h.prototype=Object.create(t.DisplayObjectContainer.prototype),h.prototype.initWarningModal=function(i,n,r,a){t.DisplayObjectContainer.call(this),this.layoutType="large",this.parentToAdd=i,this.buildOverlay(),this.parentToAdd.addChild(this),this.popupContainer=new t.DisplayObjectContainer;var l,h,u,d,c,p=e.Coords.x(820),g=e.Coords.y(350),f=new t.Sprite.fromFrame("warning_dialogues/_cmn_backgroundTile.png");h=new t.Sprite.fromFrame("warning_dialogues/_cmn_UI2_bg_vignette.png"),h.width=p,h.height=g,h.alpha=.6,l=new t.Graphics,l.beginFill(16645887),l.lineStyle(5,16645887),l.drawRect(0,0,p,g),u=new t.Sprite.fromFrame("warning_dialogues/_cmn_popup_image_alert.png"),u.position.set(e.Coords.x(30),e.Coords.y(30)),u.width=e.Coords.x(135),u.height=e.Coords.y(160),this.icon=u,this.titleFontSize=43;var y={font:e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"};d=new t.Text(e.StringManager(n),y),d.position.set(e.Coords.x(195),e.Coords.y(20)),this.title=d,this.bodyFontSize=28;var m={font:e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",wordWrap:!0,wordWrapWidth:e.Coords.x(600)};c=new t.Text(e.StringManager(r),m),c.position.set(e.Coords.x(195),e.Coords.y(100)),this.body=c;var C={font:29*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(0),y:e.Coords.y(3)};this.playButton=new o("warning_dialogues/popup_button_Play_click.png","warning_dialogues/popup_button_Play_over.png","warning_dialogues/popup_button_Play.png",e.Coords.x(335),e.Coords.y(100),25,25,25,25,e.StringManager("buttons.ok"),C),this.playButton.onClick.add(a),this.popupContainer.addChild(l),this.popupContainer.addChild(f),this.popupContainer.addChild(h),this.popupContainer.addChild(u),this.popupContainer.addChild(d),this.popupContainer.addChild(c),this.popupContainer.addChild(this.playButton),this.addChild(this.popupContainer),this.popupContainer.visible=!0,this.playButton.anchor.set(.5,.5),this.playButton.position.set(p/2,e.Coords.y(280)),this.initForceScaleSprite(),s.addElement(this,{scaleChangeSource:"Full"})},h.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(20),this.forceOffsetY=e.Coords.y(20),this.forceScaleSprite.width=e.Coords.x(835),this.forceScaleSprite.height=e.Coords.y(365),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},h.prototype.handleResize=function(){s.scaleFactorX<=.35?this.changeToSmallLayout("small"):this.changeToLargeLayout("large"),this.updateBodyTextCustomWrap(),this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/s.width,a=e.Coords.y(1080)/s.height,l=s.width,h=s.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>l){this.width=e.Coords.x(1920);var f=l/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>l){this.width=e.Coords.x(1920);var f=l/c;this.height=r*a*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY},h.prototype.changeToSmallLayout=function(t){this.layoutType!==t&&(this.icon.visible=!1,this.title.position.set(this.icon.x,this.icon.y),this.title.style.font=e.ScreenMetrics.getResScale()*(this.titleFontSize+7)+"px Segoe UI",this.title.updateText(),this.body.x=this.icon.x,this.body.style.font=e.ScreenMetrics.getResScale()*(this.bodyFontSize+7)+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(750),this.body.updateText(),this.layoutType=t)},h.prototype.changeToLargeLayout=function(t){this.layoutType!==t&&(this.icon.visible=!0,this.title.position.set(e.Coords.x(195),e.Coords.y(20)),this.title.style.font=e.ScreenMetrics.getResScale()*this.titleFontSize+"px Segoe UI",this.title.updateText(),this.body.position.set(e.Coords.x(195),e.Coords.y(100)),this.body.style.font=e.ScreenMetrics.getResScale()*this.bodyFontSize+"px Segoe UI",this.body.style.wordWrapWidth=e.Coords.x(600),this.body.updateText(),this.layoutType=t)},h.prototype.buildOverlay=function(){this.screenOverlay=new t.Graphics,this.screenOverlay.beginFill(0),this.screenOverlay.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.screenOverlay.alpha=.8,this.screenOverlay.interactive=!0,this.bindScreenOverlayInteractions(),this.parentToAdd.addChild(this.screenOverlay)},h.prototype.bindScreenOverlayInteractions=function(){this.screenOverlay.mouseover=function(t){},this.screenOverlay.mouseout=function(t){},this.screenOverlay.mousedown=function(t){},this.screenOverlay.mouseup=function(t){},this.screenOverlay.touchstart=function(t){},this.screenOverlay.touchend=function(t){},this.screenOverlay.touchendoutside=function(t){}},h.prototype.updateBodyTextCustomWrap=function(){var t=e.Coords.x("small"===this.layoutType?750:600);l.doTextCustomWrap(this.body,this.bodyFontSize*e.ScreenMetrics.getResScale(),"",t,e.Coords.y(100)),l.doTextCustomWrap(this.title,this.titleFontSize*e.ScreenMetrics.getResScale(),"",t,e.Coords.y(50))},h.prototype.close=function(){this.parentToAdd.removeChild(this.screenOverlay),this.parentToAdd.removeChild(this),s.removeElement(this)},h}),define("Solitaire/MvvmStructure/Service/NewsService",["pixi","Solitaire/MvvmStructure/Service/ManifestService"],function(t,e){"use strict";return{_cache:null,LoadJsonFromCDN:function(e,i,n){function r(){a.removeEventListener("loaded",r),a.removeEventListener("error",n),i(a.json)}function o(t){a.removeEventListener("loaded",r),a.removeEventListener("error",n),n()}var a=new t.JsonLoader(e,!0);a.addEventListener("loaded",r),a.addEventListener("error",o),a.load()},LoadDataFromCDN:function(t,i){var n=e.GetSettings("News","Defaulthtml");n&&n.Path?this.LoadJsonFromCDN(n.Path,t,i):i()},GetLatestNews:function(t,e){this._cache?setTimeout(function(){t(this._cache)}.bind(this),0):this.LoadDataFromCDN(function(e){this._cache=e,t(this._cache)}.bind(this),e)}}}),define("MenuUI/CreditsDialog",["Solitaire/MvvmStructure/Service/NewsService","util/SettingsManager","absolute/stringmanager"],function(t,e,i){"use strict";var n=function(){this.initCreditsData(),this.initCreditsDialog(),this.initScrollHandlers()};return n.prototype.initCreditsData=function(){var t=document.getElementById("credits"),e=t.innerHTML,n=e.match(/{(.*)}/g).map(function(t){return t.match(/\{.(.*?)\}/)[1]});t.innerHTML=n.reduce(function(t,e){return t.replace("{{"+e+"}}",i("credits."+e))},e),document.getElementById("closeCredits").innerHTML=i("buttons.close")},n.prototype.initCreditsDialog=function(){this.overlayContainer=document.getElementById("overlayContentWrapper"),this.credits=document.getElementById("credits"),this.creditsOverlay=document.getElementById("htmlBoxOverlay"),this.creditsCloseButton=document.getElementById("closeCredits"),this.creditsCloseButton.onmouseup=this.creditsCloseButton.ontouchend=function(){this.hide(),event.preventDefault()}.bind(this)},n.prototype.show=function(t){this.overlayContainer.style.display="block",this.credits.style.display="block",this.creditsOverlay.style.display="block",this.closeCallback=t},n.prototype.hide=function(){this.overlayContainer.style.display="none",this.credits.style.display="none",this.creditsOverlay.style.display="none","function"==typeof this.closeCallback&&this.closeCallback()},n.prototype.initScrollHandlers=function(){var t=$(".creditsContent");$(document).keydown(function(e){38==e.keyCode?t.scrollTop(t.scrollTop()-50):40==e.keyCode&&t.scrollTop(t.scrollTop()+50)})},Object.defineProperty(n.prototype,"showing",{get:function(){return"block"==this.credits.style.display}}),n}),define("gameui",["lodash","absolute","MenuUI/LoadingScreen","MenuUI/LoadingSingleScreen","mainmenu","gamescreen","MenuUI/DailyChallengeMenu","MenuUI/StarClubMenu","MenuUI/StarClubCollectionMenu","MenuUI/StarClubChallengeMenu","MenuUI/AwardsMenu","MenuUI/AwardsAchievementsMenu","MenuUI/StatsDetailMenu","MenuUI/ThemesScreen","text!ui/assetmap.json","text!ui/layout.json","text!scaleparams.json","absolute/particlesystem","MenuUI/htp/HtpScreen","MenuUI/WarningModal","MenuUI/CreditsDialog","pixi","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x){function T(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=i.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var M=function(t,e){this._initGenericGameUI(t,e),document.getElementById("preLoader").classList.add("loaded")};return M.constuctor=M,M.prototype=Object.create(e.GameUI.prototype),M.prototype._initGenericGameUI=function(t,i){e.GameUI.call(this,i.container,i.width,i.height,i.backgroundColor,e.Platform.supportsDeviceOrientation(),!1,!0,!0),e.AssetMap.load(g),e.UIBuilder.load(f),w.load(y),this.game=t,this.layout=i.layout,e.LayoutHelper.setLayoutMap(this.layout),m.init(),this.particleSystem=m},M.prototype.load=function(t,i,n){this.game.config.singleGame.enabled&&this.filterOutNonSingleGameAssets(t);var r=new e.Loader,o=Date.now();this.loadLanguagePack(e.StringManager.getUserLanguage(),function(){var a=this.game.config.singleGame.enabled?"singlegame":"loading";r.loadArt([a],function(){},function(){this.blockClicks(),this.buildLoadingScreen(),this.showScreen(this.loadingScreen),this.loadingScreen.show(!0),this.animate(),this.unBlockClicks(),setTimeout(function(){(new e.Loader).loadAssets(t,function(t){this.loadingScreen.updateLoadingProgress(t),i(t)}.bind(this),function(){var t=Date.now()-o,i=3e3-t;i<0&&(i=0),this.buildGameScreens(),e.MusicManager.setMuted(e.MusicManager.isMuted()),window.setTimeout(function(){this.game.config.singleGame.enabled&&this.loadingScreen.finishLoadingProgress(),n()}.bind(this),i)}.bind(this))}.bind(this),0)}.bind(this))}.bind(this))},M.prototype.loadLanguagePack=function(t,i){jQuery.get("static/localization/strings-"+t+".json",function(t){e.StringManager.load(t),i()})},M.prototype.buildLoadingScreen=function(){this.game.config.singleGame.enabled?this.loadingScreen=new n(this,this.game):this.loadingScreen=new i(this,this.game)},M.prototype.buildGameScreens=function(){x.initialize(),this.gameScreen=new o(this,this.game),this.mainMenu=new r(this,this.game,T("mode"))},M.prototype.showScreen=function(t,i){e.GameUI.prototype.showScreen.call(this,t,i)},M.prototype.showMainMenu=function(){this.showScreen(this.mainMenu)},M.prototype.showDailyChallengeMenu=function(){this.dailyChallengeMenu||(this.dailyChallengeMenu=new a(this,this.game)),this.showScreen(this.dailyChallengeMenu)},M.prototype.showAwardsMenu=function(t){this.awardsMenu||(this.awardsMenu=new u(this,this.game,t)),this.awardsMenu.initialize(this,t,this.game),this.showScreen(this.awardsMenu)},M.prototype.showAwardsAchievementsMenu=function(){this.awardsAchievementsMenu||(this.awardsAchievementsMenu=new d(this,this.game)),this.showScreen(this.awardsAchievementsMenu)},M.prototype.showStarClubMenu=function(){this.starClubMenu||(this.starClubMenu=new s(this,this.game)),this.showScreen(this.starClubMenu)},M.prototype.showStarClubCollectionMenu=function(){this.starClubCollectionMenu||(this.starClubCollectionMenu=new l(this,this.game)),this.showScreen(this.starClubCollectionMenu)},M.prototype.showStarClubChallengeMenu=function(){this.starClubChallengeMenu||(this.starClubChallengeMenu=new h(this,this.game)),this.showScreen(this.starClubChallengeMenu)},M.prototype.setStarClubCollection=function(t){this.starClubCollectionMenu||(this.starClubCollectionMenu=new l(this,this.game)),this.starClubCollectionMenu.loadCollection(t)},M.prototype.setStarClubChallengePack=function(t){this.starClubChallengeMenu||(this.starClubChallengeMenu=new h(this,this.game)),this.starClubChallengeMenu.loadChallenges(t)},M.prototype.setStatsDetailModel=function(t){this.statsDetailMenu||(this.statsDetailMenu=new c(this,this.game)),this.statsDetailMenu.loadStats(t)},M.prototype.showStatsDetailMenu=function(){this.statsDetailMenu||(this.statsDetailMenu=new c(this,this.game)),this.showScreen(this.statsDetailMenu)},M.prototype.showThemesScreen=function(){this.themesScreen||(this.themesScreen=new p(this,this.game)),this.showScreen(this.themesScreen)},M.prototype.showGameScreen=function(t){this.showScreen(this.gameScreen,t)},M.prototype.beforeRender=function(){m.update(),this.currentScreen.beforeRender()},M.prototype.afterRender=function(){this.currentScreen.afterRender()},M.prototype.addEmitter=function(t){m.addEmitter(t)},M.prototype.removeEmitter=function(t){m.removeEmitter(t)},M.prototype.setLevel=function(t){this.gameScreen.setLevel(t)},M.prototype.showHtpScreen=function(t){this.htpScreen||(this.htpScreen=new C(this,this.game)),this.htpScreen.mode=t,this.showScreen(this.htpScreen)},M.prototype.showLoadingScreen=function(){this.stage[0].addChild(this.loadingScreen),this.loadingScreen.show(!1)},M.prototype.hideLoadingScreen=function(){this.stage[0].removeChild(this.loadingScreen),this.loadingScreen.hide()},M.prototype.showWarning=function(t,e,i){var n=new S(this.game.ui.currentScreen,t,e,function(){"function"==typeof i&&i(),n.close()})},M.prototype.handleCommand=function(t,e){if(!e){if(this.game&&this.game.menuBar&&"FullScreen"===t&&this.game.menuBar.handleCommand("FullScreen"),e=!!e,window.AH_isAdShowing&&window.AH_isAdShowing())return!1;if(this.hasModal())this.modalStack[this.modalStack.length-1].handleCommand(t);else if(this.creditsDialog&&this.creditsDialog.showing)"Activate"==t&&this.creditsDialog.hide();else{if(this.game.menuBar.gameOptionsPopup)return void this.game.menuBar.gameOptionsPopup.handleCommand(t);"Menu"==t||this.game.menuBar&&this.game.menuBar.menuOpen?("Menu"==t&&this.currentScreen.handleCommand("Unfocus",e),this.game.gameScreenUI.handleCommand(t,e)):this.currentScreen&&this.currentScreen.handleCommand(t,e)}}},M.prototype.showCreditsDialog=function(){this.creditsDialog||(this.creditsDialog=new b),this.creditsDialog.show()},M.prototype.blockClicks=function(){
void 0!==this.inputInterceptOverlay&&null!=this.inputInterceptOverlay||(this.inputInterceptOverlay=new v.Graphics,this.inputInterceptOverlay.beginFill(1,0),this.inputInterceptOverlay.drawRect(0,0,this.width,this.height),this.inputInterceptOverlay.endFill(),this.inputInterceptOverlay.hitArea=new v.Rectangle(0,0,this.width,this.height),e.SpriteUtils.bindInteraction(this.inputInterceptOverlay,function(){}.bind(this),!0),this.inputInterceptOverlay.buttonMode=!1,this.stage[0].addChild(this.inputInterceptOverlay))},M.prototype.unBlockClicks=function(){void 0===this.inputInterceptOverlay&&null==this.inputInterceptOverlay||(this.stage[0].removeChild(this.inputInterceptOverlay),this.inputInterceptOverlay=null)},M.prototype.filterOutNonSingleGameAssets=function(e){var i=["menu","htp_starclub","htp_dailychallenge","fue","dc_menu","dailychallenge","dailychallenge_bg","aw_menu"];e.artAssets=t.filter(e.artAssets,function(e){return!t.some(i,function(t){return t===e.name})})},M}),define("MenuUI/MsftSlideOutIconButton",["pixi","absolute","lodash","MenuUI/MsftButton","absolute/stringmanager"],function(t,e,i,n,r){var o=function(t){this._initMsftSlideOutIconButton(t)};return o.constructor=o,o.prototype=Object.create(n.prototype),o.prototype._initMsftSlideOutIconButton=function(t){this.fontSize=23*e.ScreenMetrics.getResScale();var r={letterStyle:{font:this.fontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},upStroke:!0,hoverColor:5665691};t.textColor&&(r.letterStyle.fill=t.textColor),n.call(this,i.extend(r,t))},o.prototype.handleAction=function(){e.AudioManager.playSound("button"),this.options.action(this.options.data,this)},o.prototype._createTexture=function(i,n){var o=new t.DisplayObjectContainer,a=t.Sprite.fromFrame(this.options.icon),s=new t.Text(this.options.text,this.options.letterStyle),l=new t.Graphics,h=e.Coords.x(50);return r.shrinkToFit(s,this.fontSize,"",215*e.ScreenMetrics.getResScale()),s.anchor.set(.5,.5),l.beginFill(this.options.hoverColor,"over"==n||"down"==n?1:0),l.drawRect(0,0,e.Coords.x(360),e.Coords.x(53)),l.endFill(),o.addChild(l),a.x=h,a.y=e.Coords.y(10),s.x=h+s.width/2+e.Coords.x(45),s.y=e.Coords.y(32),o.addChild(a),o.addChild(s),o.generateTexture()},o}),define("MenuUI/RadioButton",["pixi","absolute","lodash"],function(t,e,i){var n=function(t){var n={label:"",selected:!1,letterStyle:{font:23*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},radio:"radio_off.png",radioDot:"toggle_dot.png"};this._initRadioButton(i.extend(n,t))};return n.constructor=n,n.prototype=Object.create(t.Sprite.prototype),n.prototype._initRadioButton=function(i){this.options=i,this.container=new t.DisplayObjectContainer,this.value=this.options.value,this.selected=this.options.selected,this.label=e.StringManager(this.options.label),this.id=this.options.label,this.value=this.options.value,this.upTexture=this._createTexture("up"),this.overTexture=this._createTexture("over"),this.downTexture=this._createTexture("down"),this.selectedTexture=this._createTexture("selected"),t.Sprite.call(this,this.selected?this.selectedTexture:this.upTexture),this.interactive=!0,this.buttonMode=!0,this.focusIndicator=new t.Graphics,this.focusIndicator.lineStyle(1,16777215);var n=e.Coords.x(-2);this.focusIndicator.drawRect(n,n,this.width-2*n,this.height-2*n),this.hitArea=new t.Rectangle(0,0,1.2*this.width,1.2*this.height),e.Platform.supportsTouch()?(this.touchstart=function(t){this.handleAction()},(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this.bindMouseEvents()):this.bindMouseEvents()},n.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.selected?this.setTexture(this.selectedTexture):this.setTexture(this.overTexture)},this.mouseout=function(t){this.selected?this.setTexture(this.selectedTexture):this.setTexture(this.upTexture)},this.mousedown=function(t){this.setTexture(this.downTexture)}.bind(this),this.mouseup=function(t){this.handleAction()}.bind(this)},n.prototype.handleAction=function(){e.AudioManager.playSound("button"),this.options.action(this.id)},n.prototype.select=function(){this.selected=!0,this.setTexture(this.selectedTexture)},n.prototype.deselect=function(){this.selected=!1,this.setTexture(this.upTexture)},n.prototype._createTexture=function(i){var n,r=new t.DisplayObjectContainer,o=t.Sprite.fromFrame(this.options.radio),a=new t.Text(this.label,this.options.letterStyle);if(o.scale.set(1.2,1.2),a.x=o.width+e.Coords.x(10),a.y=o.y+e.Coords.y(3)+(o.height-a.height)/2,r.addChild(a),r.addChild(o),"selected"===i){var s=t.Sprite.fromFrame(this.options.radioDot);s.scale.set(1.4,1.4),s.x=o.x+(o.width-s.width)/2,s.y=o.y+(o.height-s.height)/2,o.tint=4231614,r.addChild(s)}return n=r.generateTexture(),"over"!==i&&"down"!==i||(n=e.SpriteUtils.brightness(n,.2)),n},n.prototype.handleActivate=function(){this.handleAction()},n.prototype.destroy=function(){},n.prototype._focusChanged=function(){this._hasFocus?this.addChild(this.focusIndicator):-1!=this.children.indexOf(this.focusIndicator)&&this.removeChild(this.focusIndicator)},Object.defineProperty(n.prototype,"focus",{get:function(){return this._hasFocus},set:function(t){return this._hasFocus=t,this._focusChanged(),t}}),n}),define("MenuUI/RadioGroup",["pixi","absolute","lodash","MenuUI/RadioButton"],function(t,e,n,r){var o=function(t){var i={radioButtons:[],letterStyle:{font:23*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},title:"fix this",action:""};this._initRadioGroup(n.extend(i,t))};return o.constructor=o,o.prototype=Object.create(t.DisplayObjectContainer.prototype),o.prototype._initRadioGroup=function(i){t.DisplayObjectContainer.call(this),this.options=i,this.selectedValue="",this.buttons={},this._height=0,this.controlGroup=[];var o=0,a=new t.Text(this.options.title,this.options.letterStyle);this.addChild(a),n.each(this.options.radioButtons,function(t){if(0!=t.visible){o++,t.action=this.handleAction.bind(this),t.hoverColor=this.options.hoverColor,this.options.setting==t.value?t.selected=!0:t.selected=!1;var i=new r(t);i.y=e.Coords.y(0)+o*e.Coords.y(35),this.buttons[t.label]=i,this.options.isGameOption&&(i.x+=e.Coords.x(10)),this.controlGroup.push(i),this.addChild(i),this._height=i.y+i.height}},this),this._height+=e.Coords.x(20)},o.prototype.handleActivate=function(t){if(this.buttons.count){for(i=0;i<this.buttons.count;i++)if(this.buttons[i].selected){this.buttons[i].deselect(),i<this.buttons.count-1?this.buttons[i+1].select():this.buttons[0].select();break}}else this.buttons["buttons.left"]&&this.buttons["buttons.right"]&&(!0===this.buttons["buttons.left"].selected?(this.buttons["buttons.left"].deselect(),this.buttons["buttons.right"].select()):(this.buttons["buttons.right"].deselect(),this.buttons["buttons.left"].select()))},o.prototype.handleAction=function(t){var e=this.buttons[t];n.each(this.buttons,function(t){t.deselect()}),e.select(),this.options.action(this.options.settingPrefix,this.options.settingsKey,e.value)},o.prototype.updateState=function(t){this.options.setting=t,n.each(this.buttons,function(t){this.options.setting==t.value?t.select():t.deselect()},this)},o}),define("MenuUI/InputButton",["pixi","absolute","lodash","MenuUI/MsftButton","Managers/KeyboardManager","Managers/ScaleManager"],function(t,e,i,n,r,o){var a=function(t,n){var r={text:"",setting:"",labelLetterStyle:{font:23*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},letterStyle:{font:23*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#000001",align:"left"},buttonOptions:{text:"Broken",threeSlice:{multistate:!0,images:{left:"MS_3slice_btn_greymodal_01.png",center:"MS_3slice_btn_greymodal_02.png",right:"MS_3slice_btn_greymodal_03.png"}}},action:function(t){},maxValueLength:10};this.game=n,this._initInputButton(i.extend(r,t))};return a.constructor=a,a.prototype=Object.create(t.DisplayObjectContainer.prototype),a.prototype._initInputButton=function(i){t.DisplayObjectContainer.call(this),this.options=i,this.value=[],this.inputBoxBound=!1,this.label=new t.Text(this.options.text,this.options.labelLetterStyle),this.options.buttonOptions.letterStyle=this.options.letterStyle,this.options.buttonOptions.action=function(){},this.options.buttonOptions.text=e.StringManager(this.options.buttonOptions.text),this.submitButton=new n(this.options.buttonOptions),this.createInputBox(),this.submitButton.x=this.inputBox.x+this.inputBox.width+e.Coords.x(20),this.submitButton.y=this.inputBox.y+(this.inputBox.height-this.submitButton.height)/2,this.submitButton.width*=e.ScreenMetrics.getResScale(),this.submitButton.height*=e.ScreenMetrics.getResScale(),this.valueDisplay=new t.Text(" ",this.options.letterStyle),this.valueDisplay.x=e.Coords.x(15),this.valueDisplay.y=this.inputBox.y+e.Coords.y(12),this.addChild(this.label),this.addChild(this.valueDisplay),this.addChild(this.submitButton),this.tempInputField=document.getElementById("highScoreEntry"),this._height=this.inputBox.height+e.Coords.y(50)},a.prototype.createInputBox=function(){this.inputBox=new t.Graphics,this.inputBox.beginFill(16777215),this.inputBox.lineStyle(e.Coords.x(2),0,1),this.inputBox.drawRect(0,0,e.Coords.x(180),e.Coords.y(60)),this.inputBox.endFill(),this.inputBox.hitArea=new t.Rectangle(0,0,this.inputBox.width,this.inputBox.height),this.bindInteraction(this.inputBox,function(){if(e.Platform._isAndroid()){var t=window.prompt(e.StringManager("buttons.gameNumber"));t=t.replace(/[^\w]/g,""),this.value=t.split(""),this.tempInputField.value="",this.tempInputField.focus(),this.updateValueDisplay(),this.handleAction()}else this.updateTempInputField(),this.tempInputField.style.display="block",this.tempInputField.focus(),this.updateValueDisplay(),this.inputBox.visible=!1,this.enable()}.bind(this)),this.inputBox.y=this.label.y+this.label.height+e.Coords.y(20),this.addChild(this.inputBox)},a.prototype.updateTempInputField=function(){var t="0px",i=parseInt(t.slice(0,t.indexOf("px"))),n="0px",r=parseInt(n.slice(0,n.indexOf("px"))),a=o.scaleFactorY<=.6?o.scaleFactorY+.2:1;this.tempInputField.style.top=this.inputBox.worldTransform.ty*o.scaleFactorY+i+"px",this.tempInputField.style.left=this.inputBox.worldTransform.tx*o.scaleFactorX+r+"px",this.tempInputField.style.width=(this.inputBox.width-e.Coords.x(13))*a+"px",this.tempInputField.style.height=(this.inputBox.height-e.Coords.x(4))*a+"px"},a.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,e.Platform.supportsTouch()?(t.touchstart=i.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(t.mousedown=i.bind(this))):t.mousedown=i.bind(this)},a.prototype.handleAction=function(){this.value.length&&this.options.validate(this.value.join(""))&&(this.tempInputField&&this.tempInputField.blur(),this.options.action(this.options.settingPrefix,this.options.settingsKey,this.value.join("")),this.disable())},a.prototype.updateState=function(t){},a.prototype._createTexture=function(i){var n=new t.DisplayObjectContainer,r=t.Sprite.fromFrame("on"==i?this.options.toggleOn:this.options.toggleOff),o=new t.Text(this.options.text,this.options.letterStyle),a=new t.Text("off"==i?this.offLabel:this.onLabel,this.options.letterStyle);return o.y=-o.height-e.Coords.y(25),a.x=r.width+e.Coords.x(10),a.y=(r.height-a.height)/2-e.Coords.y(7),n.addChild(o),n.addChild(r),n.addChild(a),n.generateTexture()},a.prototype.disable=function(){r.removeAnyKeyPressHandler(),r.removeAnyKeyHandler(this.handlerRef),this.inputBoxBound=!1,this.value=[],this.tempInputField.style.display="none",this.updateValueDisplay(),this.inputBox.visible=!0},a.prototype.enable=function(){this.inputBoxBound||(this.handlerRef=this.handleKeyPress.bind(this),r.setAnyKeyPressHandler(this.handlerRef),r.setAnyKeyHandler(this.handlerRef),this.inputBoxBound=!0)},a.prototype.addLetter=function(t){this.value.push(t),this.tempInputField.value=this.value.join(""),this.updateValueDisplay()},a.prototype.removeLetter=function(){this.value.pop(),this.updateValueDisplay()},a.prototype.updateValueDisplay=function(){this.tempInputField.value=this.value.join("")},a.prototype.handleKeyPress=function(t){var e=0,i=null,n=!1;return null==t.which?e=t.keyCode:0!=t.which&&(e=t.which),13===e?this.value.length>=1&&(this.handleAction(),n=!0):8===e?(this.removeLetter(),n=!0):this.value.length<this.options.maxValueLength&&(i=String.fromCharCode(e).toUpperCase(),/[0-9]/g.test(i)?(this.addLetter(i),n=!0):window.setTimeout(function(){this.updateValueDisplay()}.bind(this),500)),n},a.prototype.onMenuToggle=function(t){t||this.disable()},a}),define("MenuUI/SlideOutMenu",["pixi","absolute","lodash","MenuUI/MsftSlideOutIconButton","MenuUI/RadioGroup","MenuUI/MsftToggleButton","util/SettingsManager","MenuUI/InputButton","version","MenuUI/ControlFocusManager","MenuUI/MsftButton","MenuUI/MsftIconButton","MenuUI/SideBar","util/eventhandler","Managers/ScaleManager","Managers/ScrollManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){var y=function(t){var e={backgroundColor:1,defaultWidth:360,width:360,height:658,breakPointWidth:262.2,verticalBreakPoint:640,verticalThreshold:500,buttonHandler:"",contentLayout:"",isMainMenu:!1,position:{x:0,y:66}};this.initSlideOutMenu(i.extend(e,t))};return y.prototype=Object.create(t.DisplayObjectContainer.prototype),y.prototype.initSlideOutMenu=function(n){t.DisplayObjectContainer.call(this),i.isArray(n.contentLayout)?i.each(n.contentLayout,function(t){var n=e.UIBuilder.getConfigData(t);this.layoutConfig=i.merge(this.layoutConfig||{},n,function(t,e){if(i.isArray(t))return t.concat(e)})},this):this.layoutConfig=e.UIBuilder.getConfigData(n.contentLayout),this.config=i.extend(n,this.layoutConfig),this.settingsManager=a,this.buttons=[],this.currentButtonIndex=-1,this.isOpen=!1,this.slideOutStart=0,this.slideOutEnd=e.Coords.x(1920)/g.width,this.scale.set(1,1),this.x=e.Coords.x(this.config.position.x),this.y=e.Coords.y(this.config.position.y),this.initBackground(),this.initLayoutMask(),this.initTouchContainer(),this.controlFocusManager=new h,this.buildLayout(),this.initSideBar(),this.isSubMenuOpen=!1,this.onSubMenuToggle=new p,g.addElement(this,{scaleChangeSource:"Full"}),this.config.width=this.width,this.config.height=this.height,this.visible=!1,this.scale.set(0,0),this.isUnopened=!0},y.prototype.initSideBar=function(){this.sideBar=new c({availableHeight:100,partialHeight:20}),this.sideBar.setListenersForHandleInteraction(function(){this.enableButtons(!1)}.bind(this),function(){this.enableButtons(!0)}.bind(this)),this.sideBar.position.set(e.Coords.x(340),0),this.updateSideBar(),this.addChild(this.sideBar)},y.prototype.updateSideBar=function(){if(e.Platform.isMobile()&&this.parent){const t=g.height/e.Coords.y(1080);this.y=this.parent.game.menuBar.menuBarHeight/t*.7}this.layoutGroup.updateTransform();var i=e.ScreenMetrics.getResScale(),n=e.Coords.y(this.config.verticalThreshold),r=this.layoutGroup.height+e.Coords.y(40),o=g.height<n?n:g.height;g.width<this.config.verticalBreakPoint&&(o*=this.config.defaultWidth/this.config.breakPointWidth*i),o-=this.y/this.scale.y,this.layoutHeight=r,this.screenHeight=o,o<r?(this.layoutGroup.y<0&&o+Math.abs(this.layoutGroup.y)>r&&(this.layoutGroup.y=o-r),this.sideBar.visible=!0,this.sideBar.resetDimensions(r,o,function(t){var e=-Math.abs(r-o)*t/100;this.layoutGroup.y=e}.bind(this),o),this.sideBar&&this.sideBar.updateHandleByPercent(100*Math.abs(this.layoutGroup.y)/Math.abs(o-r))):(this.layoutGroup.y=0,this.sideBar.visible=!1)},y.prototype.initLayoutMask=function(){this.layoutMask=new t.Graphics,this.layoutMask.beginFill(16777011,.4),this.layoutMask.drawRect(0,0,e.Coords.x(this.config.width),4e4),this.layoutMask.endFill(),this.layoutGroup&&(this.layoutGroup.mask=this.layoutMask),this.addChild(this.layoutMask)},y.prototype.initBackground=function(){this.background=new t.Graphics,this.background.beginFill(this.config.backgroundColor,1),this.background.drawRect(0,0,e.Coords.x(this.config.width),4e4),this.background.endFill(),this.background.interactive=!0,this.background.hitArea=new t.Rectangle(0,0,e.Coords.x(this.config.width),4e4),this.bindInteraction(this.background,function(){}),this.addChild(this.background)},y.prototype.initTouchContainer=function(){new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080));this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=new t.Rectangle(0,0,e.Coords.x(this.config.width),4e4),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.addChild(this.touchContainer)},y.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,e.Platform.supportsTouch()?(t.touchstart=i.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(t.mousedown=i.bind(this),t.mouseup=function(){})):(t.mousedown=i.bind(this),t.mouseup=function(){})},y.prototype.buildLayout=function(){this.layoutGroup=new t.DisplayObjectContainer;var a=e.Coords.y(15),h=this.layoutConfig.buttonSections?this.layoutConfig.buttonSections.length:0,d=0,c=a;if(this.config.isSubMenu){this.backCircleButton=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.backCircleButton.interactive=!0;var p=new t.DisplayObjectContainer,g=new t.DisplayObjectContainer;p.addChild(t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png")),g.addChild(t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Down.png")),this.backCircleButton.downTexture=g.generateTexture(),this.backCircleButton.upTexture=p.generateTexture(),this.backCircleButton.handleAction=function(){this.parent&&this.parent.handleCommand&&this.parent.handleCommand("Back")}.bind(this),this._modifyButtonInput(this.backCircleButton),this.backCircleButton.x=e.Coords.x(25),this.backCircleButton.y=e.Coords.y(40),this.layoutGroup.addChild(this.backCircleButton)}i.each(this.layoutConfig.buttonSections,function(p){if(d++,!p.hideOnMainMenu||!this.config.isMainMenu){var g,f,y,m=0,C={font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},S={font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#bcc4c6",align:"left"};""!==p.title&&(g=new t.Text(e.StringManager(p.title),C),g.x=e.Coords.x(40),g.y=c+a,c=g.y+g.height+(p.titlePadding?e.Coords.y(p.titlePadding):e.Coords.y(-8)),this.config.isSubMenu&&(g.x+=e.Coords.x(40),g.y+=e.Coords.y(20),c+=e.Coords.y(40)),this.layoutGroup.addChild(g),m++),void 0!==p.description&&""!==p.description&&(f=new t.Text(e.StringManager(p.description,[l.shortVersion()]),S),f.x=e.Coords.x(50),f.y=c+a,c=f.y+f.height+(p.titlePadding?e.Coords.y(p.titlePadding):1.5*a),this.layoutGroup.addChild(f),m++),i.each(p.buttons,function(t){if(!t.hideOnMainMenu||!this.config.isMainMenu){if("function"!=typeof t.action&&t.id&&t.id.toLowerCase().indexOf("fullscreen")>-1){if(!this.config.fullScreenEnabled)return;if(!e.Platform.supportsFullscreenApi()&&e.Platform._isIE())t.text="buttons.toggleFullScreen";else if(!e.Platform.supportsFullscreenApi())return}this.config.isSubMenu?t.hoverColor=5665691:t.hoverColor=10078,"function"!=typeof t.action&&(t.text=e.StringManager(t.text),t.action=this.config.buttonHandler[t.action]);var a,l=t.type||"iconButton",h=e.Coords.x(53),d=t.settingsKey&&p.settingsPrefix?this.settingsManager.getSetting(p.settingsPrefix,t.settingsKey):null;switch(l){case"button":i.extend(t,{threeSlice:{multistate:!0,images:{left:e.AssetMap("buttonThreeSliceGrey.left"),center:e.AssetMap("buttonThreeSliceGrey.center"),right:e.AssetMap("buttonThreeSliceGrey.right")}},width:e.Coords.x(255),height:e.Coords.y(36),letterStyle:{font:"Bold "+22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#000001",align:"left"}}),a=new u(t),a.updateState=this.config.buttonHandler[t.updateState],a.x=e.Coords.x(55),c-=2/e.ScreenMetrics.getResScale();break;case"iconButton":a=new n(t);break;case"radio":a=new r(i.extend(t,{radioButtons:t.options,title:t.text,action:t.action,settingPrefix:p.settingsPrefix,setting:d})),h=a._height,"scoringType"===t.settingsKey&&(h-=e.Coords.y(50)),a.x=e.Coords.x(40);break;case"toggle":a=new o(i.extend(t,{settingPrefix:p.settingsPrefix,setting:d})),h=a._height,a.x=e.Coords.x(40);break;case"input":a=new s(i.extend(t,{settingPrefix:p.settingsPrefix,setting:d,validate:function(t){return!0}})),h=a._height+e.Coords.y(20),a.x=e.Coords.x(40)}if("radio"===l?i.each(a.buttons,function(t){this._modifyButtonInput(t)}.bind(this)):this._modifyButtonInput(a),a.y=c,m++,this.layoutGroup.addChild(a),t.hide?a.visible=!1:c=a.y+h,a instanceof r)for(var g=0;g<a.controlGroup.length;g++)this.controlFocusManager.addControl(a.controlGroup[g],a.controlGroup[g].visible);else this.controlFocusManager.addControl(a,a.visible);this.buttons.push(a)}},this),d==h||p.hideHorizontalRule||(y=new t.Graphics,y.moveTo(0,0),y.lineStyle(e.Coords.x(2),16777215,1),y.lineTo(e.Coords.x(273),0),y.x=e.Coords.x(40),y.y=c+a,c=y.y+y.height,this.layoutGroup.addChild(y))}},this),this.layoutGroup&&(this.layoutGroup.mask=this.layoutMask),this.touchContainer.addChild(this.layoutGroup)},y.prototype.toggle=function(t){this.isUnopened&&(this.isUnopened=!1,this.scale.set(1,1));var e,i,n,r=this;this.isOpen?(this.isOpen=!1,f.remove(this),this.controlFocusManager.unfocusCurrentControl()):(this.isOpen=!0,f.add(this,this.doScroll,this),this.visible=!0),e=0,this.handleResize(),this.isOpen?(i=e-this.width,n=e):(i=e,n=e-this.width),this.handleResize(),this.config.isSubMenu?(this.isSubMenuOpen=!this.isSubMenuOpen,this.onSubMenuToggle.handleEvent(this,this.isSubMenuOpen),r.isOpen&&(r.alpha=1),this.menuTween=new TWEEN.Tween({x:i}).to({x:n},300).easing(TWEEN.Easing.Quadratic.In).onStart(function(){r.toggleButtons()}).onUpdate(function(){r.x=this.x}).onComplete(function(){r.isOpen||(r.layoutGroup.y=0,r.visible=!1,r.alpha=0),"function"==typeof t&&t()}).start()):(r.isOpen&&(r.alpha=1),this.menuTween=new TWEEN.Tween({x:i}).to({x:n},300).easing(TWEEN.Easing.Quadratic.In).onUpdate(function(){r.x=this.x}).onComplete(function(){r.isOpen||(r.layoutGroup.y=0,r.visible=!1,r.alpha=0),r.toggleButtons(),window.setTimeout(function(){"function"==typeof t&&t()},100)}).start())},y.prototype.handleResize=function(){if(this.isOpen){this.moveWithHeader();var t=this.layoutGroup.y;this.layoutGroup.y=0,this.sideBar.updateHandleByPercent(0);var i=g.width<this.config.verticalBreakPoint?this.config.breakPointWidth:this.config.width,n=this.config.height*i/this.config.width;this.width=i*(e.Coords.x(1920)/g.width),this.height=n*(e.Coords.y(1080)/g.height);var r=e.Coords.y(this.config.verticalThreshold);g.height<r&&(this.width*=g.height/r,this.height*=g.height/r),this.layoutGroup.y=t,this.updateSideBar()}},y.prototype.toggleButtons=function(){i.each(this.buttons,function(t){"function"==typeof t.onMenuToggle&&t.onMenuToggle(this.isOpen)},this)},y.prototype.onShow=function(t,e){i.each(this.buttons,function(t){void 0!==t.options.setting?(t.updateState(this.settingsManager.getSetting(t.options.settingPrefix,t.options.settingsKey)),this.checkAndFadeOutSingleTap(t,e)):"button"==t.options.type&&t.updateState(),this.controlFocusManager.setControlActive(t,t.visible)},this)},y.prototype.getButton=function(t){return i.find(this.buttons,function(e){return e.options.id===t})},y.prototype.handleCommand=function(t){switch(t){case"Tab":case"Down":this.controlFocusManager.focusNextControl(1);break;case"Up":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},y.prototype.checkAndFadeOutSingleTap=function(t,e){"singleTapToMove"===t.options.settingsKey&&(!e||"Pyramid"!==e&&"TriPeaks"!==e?(t.alpha=1,t.interactive=!0):(t.alpha=.2,t.interactive=!1))},y.prototype.handleDragStart=function(t){this.isDragging=!0,this.dragLastDeltaY=0,this.dragStartY=t.getLocalPosition(this.parent).y},y.prototype.handleDrag=function(t){if(this.isOpen&&this.isDragging){var e=t.getLocalPosition(this.parent),i=e.y-this.dragStartY;i/=this.scale.y,i!==this.dragLastDeltaY&&(this.scrollTo(this.layoutGroup.y+(i-this.dragLastDeltaY)),this.dragLastDeltaY=i)}},y.prototype.handleDragEnd=function(t){this.isDragging&&(this.isDragging=!1)},y.prototype.doScroll=function(t){if(this.layoutGroup&&this.isOpen){var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/35:t.detail&&(e=-t.detail/3),e/=5,this.scrollTo(this.layoutGroup.y+100*e)}},y.prototype.scrollTo=function(t){if(this.sideBar.visible){this.layoutGroup.y=t,this.layoutGroup.y>0&&(this.layoutGroup.y=0);var e=this.screenHeight-this.layoutHeight;this.layoutGroup.y<e&&(this.layoutGroup.y=e),this.sideBar&&this.sideBar.updateHandleByPercent(100*Math.abs(this.layoutGroup.y/e))}},y.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.layoutGroup.children.length;e<i;e++)this.layoutGroup.children[e].interactive=t},y.prototype._modifyButtonInput=function(t){e.Platform.supportsTouch()?(this._bindButtonTouchInput(t),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this._bindButtonMouseInput(t)):this._bindButtonMouseInput(t)},y.prototype._bindButtonMouseInput=function(t){var e=function(t,e,i){e&&t.setTexture(e),t.hasBeenDown=i};t.mousedown=function(i){e(t,t.downTexture,!0)}.bind(t),t.mouseover=function(i){t.hasBeenDown&&e(t,t.overTexture,!0)}.bind(t),t.mouseout=function(i){t.hasBeenDown&&e(t,t.upTexture,!0)}.bind(t),t.mouseupoutside=function(){e(t,t.upTexture,!1)}.bind(t),t.mouseup=function(i){t.hasBeenDown&&(e(t,t.upTexture,!1),"function"==typeof t.handleAction&&t.handleAction())}.bind(t)},y.prototype._bindButtonTouchInput=function(t){var e=function(t,e,i){e&&t.setTexture(e),t.hasBeenDown=i};t.touchstart=function(i){e(t,t.downTexture,!0)}.bind(t),t.touchend=function(i){t.hasBeenDown&&(e(t,t.upTexture,!1),"function"==typeof t.handleAction&&t.handleAction())}.bind(t),t.touchendoutside=function(i){e(t,t.upTexture,!1)}.bind(t),t.touchmove=function(i){t.getBounds().contains(i.global.x,i.global.y)||e(t,t.upTexture,!1)}.bind(t)},y.prototype.destroy=function(){f.remove(this),t.DisplayObjectContainer.prototype.call(this)},y.prototype.moveWithHeader=function(){var t=this.parent.game;if(t){var e=!!t.solitaire&&!!t.solitaire.Authority,i=Math.max(Math.min(g.height/1080+.3,1),.7),n=Math.max(Math.min(g.width/1920+.3,1),.7),r=Math.min(i,n),o=t.menuBar.menuBarHeight,a=e?r*(o/g.scaleFactorY):o/g.scaleFactorY;this.y=a}},y}),define("MenuUI/NewsDialog",["absolute","Solitaire/MvvmStructure/Service/NewsService","util/SettingsManager"],function(t,e,i){"use strict";var n=function(){this.initNewsDialog()};return n.prototype.initNewsDialog=function(){this.overlayContainer=document.getElementById("overlayContentWrapper"),this.news=document.getElementById("news"),this.newsOverlay=document.getElementById("htmlBoxOverlay"),this.newsCloseButton=document.getElementById("closenews"),this.newsCloseButton.onmouseup=this.newsCloseButton.ontouchstart=function(){this.hide()}.bind(this),jQuery(this.overlayContainer).bind("mousewheel",function(t){t.stopPropagation(),t.preventDefault()})},n.prototype.show=function(t,e,n){var r=!1;t=!!t,this.closeCallback=n,this.getNewsData(function(){if(t){var n=Date.now();this._expirationDate&&n<this._expirationDate.getTime()&&!i.getSetting("motd",this._id)&&(r=this.buildNews())}else r=this.buildNews();e&&e(r)}.bind(this))},n.prototype.shouldShowLink=function(t){this.getNewsData(function(){t(!!(this._expirationDate&&Date.now()<this._expirationDate.getTime()))}.bind(this))},n.prototype.newsAvailable=function(){return this._expirationDate&&Date.now()<this._expirationDate.getTime()},n.prototype.getNewsData=function(t){this._messageDate&&this._headerImage&&this._content?t&&t():e.GetLatestNews(function(e){var i=e.News[0];this._messageDate=new Date(i.MessageDate),this._expirationDate=new Date(i.ExpirationDate),this._headerImage=i.ImageUrl,this._content=i.MessageBlock,this._id=i.MessageId,this._webSiteUrl=i.WebSiteUrl,t&&t()}.bind(this),function(){t&&t()})},n.prototype.buildNews=function(){if(this._messageDate&&this._headerImage&&this._content){var e=t.StringManager("months",null,!0),n=document.getElementById("newsimage"),r=document.getElementById("newsdate"),o=document.createElement("img");o.src=this._headerImage,n.innerHTML="",r.innerHTML=e[this._messageDate.getMonth()]+" "+this._messageDate.getDate()+", "+this._messageDate.getFullYear(),n.appendChild(o);var a=document.getElementById("newsframe");return a.contentWindow.document.open(),this._content+="<script>document.documentElement.addEventListener('touchstart', function(event){if(event.touches.length > 1) {event.preventDefault();}});<\/script>",this._content+="<script>var aTags = document.getElementsByTagName('a');if(aTags && aTags.length > 0) aTags[0].onclick = function (e) {e.preventDefault();window.open(e.target.href);};<\/script>",a.contentWindow.document.write(this._content),a.contentWindow.document.close(),this.overlayContainer.style.display="block",this.news.style.display="block",this.newsOverlay.style.display="block",i.setSetting("motd",this._id,!0),!0}return this._webSiteUrl&&window.open(this._webSiteUrl),!1},n.prototype.hide=function(){this.overlayContainer.style.display="none",this.news.style.display="none",this.newsOverlay.style.display="none","function"==typeof this.closeCallback&&this.closeCallback(),this._webSiteUrl&&window.open(this._webSiteUrl)},n}),define("util/ScaleParams",[],function(){return{slideOutMenu:{widthBreakPoint:640},menuBar:{menuButton:{x:0,width:81,height:66},backButton:{width:81,height:66,x:110},fullScreenButton:{offsetX:0,width:81,height:66},newsButton:{y:3},widthBreakPoint:741,pageLabelHidePoint:560},gameScreenUI:{fontSize:33,labelsY:18,icon:{x:200,y:.1},gameLabel:{offsetX:5,y:17},boardsCompleteLabelX:1050,timeLabelX:200,timeX:1160,boardsCompleteOffsetX:30,dealLabelFontSize:25,gameNumberLabel:{x:1639,y:15},gameNumber:{x:1750,y:15}}}}),define("MenuUI/GameOptionsPopup",["pixi","absolute","absolute/stringmanager","Managers/ScaleManager","Arkadium/GameEngine/Scenes/Nodes/SpriteNode","lodash","MenuUI/MsftButton","MenuUI/MsftIconButton","MenuUI/InputButton","MenuUI/MsftSlideOutIconButton","MenuUI/RadioGroup","MenuUI/MsftToggleButton","util/SettingsManager","MenuUI/SideBar","util/eventhandler","MenuUI/ControlFocusManager","Managers/ScrollManager","MenuUI/DealWarningModal"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m){var C=function(t,e){this.initialize(t,e)};return C.constructor=C,C.prototype=Object.create(t.DisplayObjectContainer.prototype),C.prototype.initialize=function(e,i){t.DisplayObjectContainer.call(this),this.initVariables(e,i),this.initOverlay(),this.initPopupContainer(),this.initBackground(),this.initHeader(),this.initHeaderLabel(),this.initControlFocusManager(),this.initBodyContainer(),this.initBodyContent(),this.initBodyMask(),this.initCloseButton(),this.positionPopupContainer(),this.initSideBar(),this.initScrolling(),this.initTouchInterface(),this.updateChildIndexes(),this.alpha=0,this.overlay.alpha=0,this.focusGroupToggle=!1,this.openPopup(),n.addElement(this,{scaleChangeSource:"Full"})},C.prototype.handleResize=function(){var i=n.scaleFactorX,r=n.scaleFactorY;this.scrollTo(this.bodyContainer.y+this.header.height);var o=this.config.popupWidth/(.6*e.Coords.y(1080));if(n.scaleFactorY>=.6?(this.popupContainer.scale.x=1/i,this.popupContainer.scale.y=1/r,this.updateSidebar(!0)):(this.popupContainer.scale.y=1/.6,this.popupContainer.width=e.Coords.y(n.height)*(o/i),this.updateSidebar(!1)),n.width<420&&n.height>550){var a=this.config.popupWidth/(.23*e.Coords.x(640));this.popupContainer.height=e.Coords.x(n.width)*(a/r),this.popupContainer.scale.x=1/.23,this.popupContainer.scale.y=1/r,this.updateSidebar(!0)}this.resizeMask(r),this.popupContainer.x=.5*(e.Coords.x(1920)-this.popupContainer.width),this.popupContainer.y=.5*(e.Coords.x(1080)-this.background.height),
this.background.clear(),this.background.beginFill(1193578),this.background.drawRect(0,0,this.config.popupWidth,this.config.popupHeight*(r>=.6?r:.6)),this.background.endFill(),this.background.hitArea=new t.Rectangle(0,0,this.config.popupWidth,this.config.popupHeight*(r>=.6?r:.6)),this.inputButton&&this.inputButton.disable()},C.prototype.resizeMask=function(t){this.maskRef.scale.y=t>=.6?t:.6},C.prototype.initVariables=function(t,i){this.game=i,this.overlay=null,this.background=null,this.header=null,this.headerLabel=null,this.popupContainer=null,this.closeBtn=null,this.bodyContainer=null,this.layoutConfig=null,this.settingsManager=c,this.previousBtnY=0,this.previousBtnHeight=0,this.bodyHeight=0,this.onClose=new g,this.config=o.extend({letterStyle:{font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},popupWidth:e.Coords.x(420),popupHeight:e.Coords.y(980),headerWidth:e.Coords.x(420),headerHeight:e.Coords.y(56),bodyPadding:e.Coords.y(5),buttonHandler:"",optionsName:"Klondike"},t),console.log(this.config.optionsName),this.specificOptionName="GameOptions"+this.config.optionsName,this.sharedOptionsName="GameOptionsShared",this.showDifficultyName="GameOptionsShowDifficulty",this.tutorialOptionsName="GameOptionsTutorials"},C.prototype.initOverlay=function(){var i=new t.Graphics;i.beginFill(0,.8),i.drawRect(0,0,e.Coords.x(1920),e.Coords.y(1080)),i.endFill(),i.interactive=!0,i.buttonMode=!1,i.hitArea=new t.Rectangle(0,0,e.Coords.x(1920),e.Coords.y(1080)),e.SpriteUtils.bindInteraction(i,this.closePopup.bind(this)),i.mouseup=function(){},this.overlay=i},C.prototype.initPopupContainer=function(){this.popupContainer=new t.DisplayObjectContainer,this.addChild(this.popupContainer)},C.prototype.initBackground=function(){var i=new t.Graphics;i.beginFill(1193578),i.drawRect(0,0,this.config.popupWidth,this.config.popupHeight),i.endFill(),i.hitArea=new t.Rectangle(0,0,this.config.popupWidth,this.config.popupHeight),e.SpriteUtils.bindInteraction(i,function(){}),i.mouseup=function(){},this.popupContainer.addChild(i),this.background=i},C.prototype.initHeader=function(){var e=new t.Graphics;e.beginFill(2519786),e.drawRect(0,0,this.config.headerWidth,this.config.headerHeight),e.endFill(),this.popupContainer.addChild(e),this.header=e},C.prototype.initHeaderLabel=function(){var n=new t.Text(i("buttons.options"),this.config.letterStyle);n.position.set(.5*(this.header.width-n.width),.5*(this.header.height-n.height)+e.Coords.y(3)),this.popupContainer.addChild(n),this.headerLabel=n},C.prototype.initCloseButton=function(){var t=new r("Buttons/Deal/Deal.png");t.rotation=Math.PI/4,t.position.set(this.header.width-t.width-e.Coords.x(10),.5*this.header.height),t.interactive=!0,t.buttonMode=!0,t.onMouseDownEvent=function(){this.closePopup()}.bind(this),t.PointDown.add(function(){this.closePopup()}.bind(this)),this.popupContainer.addChild(t),t.handleActivate=function(){e.AudioManager.playSound("button"),this.closePopup()}.bind(this),this.controlFocusManager.addControl(t,!1,"close"),this.closeBtn=t,this.createCloseButtonHighlight(),this.controlFocusManager.setFocusGroup("body",!0)},C.prototype.createCloseButtonHighlight=function(){var i=new t.Graphics,n=e.Coords.x(5);i.beginFill(0,0),i.lineStyle(1,16777215),i.drawRect(0,0,this.closeBtn.width+n,this.closeBtn.height+n),i.position.set(this.closeBtn.x-(n+this.closeBtn.width)/2,this.closeBtn.y-(n+this.closeBtn.height)/2),i.endFill(),this.closeBtn.highlight=i},C.prototype.initBodyContainer=function(){var e=new t.DisplayObjectContainer;e.y=this.header.y+this.header.height+this.config.bodyPadding,this.popupContainer.addChild(e),this.bodyContainer=e},C.prototype.initControlFocusManager=function(){this.controlFocusManager=new f},C.prototype.initBodyContent=function(){this.initOptionsContent(this.specificOptionName),this.initOptionsContent(this.sharedOptionsName),this.bodyHeight=this.previousBtnY+this.previousBtnHeight,this.game.config.singleGame.enabled||this.initShowDifficultyOptions(),this.game.config.singleGame.enabled||this.initShowTutorialOptions()},C.prototype.initBodyMask=function(){var e=new t.Graphics;e.beginFill(0,0),e.drawRect(0,0,this.header.width,this.background.height),e.endFill(),this.popupContainer.addChild(e),this.popupContainer.mask=e,this.maskRef=e},C.prototype.initSideBar=function(){this.sidebar=new p({availableHeight:200,partialHeight:100,onScrollUpdate:function(t){}.bind(this)}),this.popupContainer.addChild(this.sidebar),this.sidebar.position.set(e.Coords.x(465),this.header.height),this.sidebar.x=this.popupContainer.width-this.sidebar.width-e.Coords.x(65),this.updateSidebar()},C.prototype.initScrolling=function(){y.add(this,this.doScroll,this)},C.prototype.initTouchInterface=function(){this.lastDeltaY=0,this.startY=0;var e=new t.Rectangle(0,0,this.config.popupWidth-this.sidebar.width,this.config.popupHeight);this.touchContainer=new t.DisplayObjectContainer,this.touchContainer.interactive=!0,this.touchContainer.hitArea=e,this.touchContainer.addChild(this.bodyContainer),this.touchContainer.mousedown=this.touchContainer.touchstart=this.handleDragStart.bind(this),this.touchContainer.mousemove=this.touchContainer.touchmove=this.handleDrag.bind(this),this.touchContainer.mouseupoutside=this.touchContainer.mouseup=this.touchContainer.touchend=this.touchContainer.touchendoutside=this.handleDragEnd.bind(this),this.popupContainer.addChild(this.touchContainer)},C.prototype.handleDragStart=function(t){this.dragging=!0,this.lastDeltaY=0,this.startY=t.getLocalPosition(this.parent).y},C.prototype.handleDragEnd=function(t){this.dragging=!1,this.enableButtons(!0)},C.prototype.handleDrag=function(t){if(this.dragging){e.Platform.supportsTouch()||this.enableButtons(!1);var i=t.getLocalPosition(this.parent),n=i.y-this.startY;this.scrollTo(this.bodyContainer.y+(n-this.lastDeltaY)),this.lastDeltaY=n}},C.prototype.enableButtons=function(t){var e,i;for(e=0,i=this.bodyContainer.children.length;e<i;e++)this.bodyContainer.children[e].interactive=t},C.prototype.updateSidebar=function(t){if(this.sidebar&&this.bodyContainer){this.sidebar.scale.set(1,1);var i,r,o;o=t?n.scaleFactorY:.6,i=this.bodyHeight+e.Coords.y(65)+this.config.popupHeight*(1-o),r=this.background.height,this.sidebar.resetDimensions(i,r,function(t){var e=-Math.abs(i-r)*t/100+this.header.height+this.config.bodyPadding;this.bodyContainer.y=e,this.inputButton&&this.inputButton.disable()}.bind(this),r*o-this.header.height),this.sidebar.visible=r<i}},C.prototype.initOptionsContent=function(t){var i=e.UIBuilder.getConfigData(t);if(i&&i.buttonSections){var n=i.buttonSections[0].buttons;if(n){var r=i.buttonSections[0].settingsPrefix,o=e.Coords.y(15),a=e.Coords.x(34);n.forEach(function(t,e){var i=this.checkAndCreateButton(t,r);i&&(i.y=this.previousBtnY+this.previousBtnHeight+o,this.previousBtnY=i.y,this.previousBtnHeight=i.height,i.x=a,this.bodyContainer.addChild(i),this.controlFocusManager.addControl(i,!1,"body"))}.bind(this))}}},C.prototype.initShowDifficultyOptions=function(){var n=e.UIBuilder.getConfigData(this.showDifficultyName),r=n.buttonSections[0],o=r.buttons[0],a=["Klondike","Spider","FreeCell"];const s=i(r.title);var l={font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},h={font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},u=new t.Text(s,l),d=e.Coords.y(15),c=e.Coords.x(34);e.StringManager.shrinkToFit(u,e.StringManager.extractNumbersFromString(l.font),"",e.Coords.x(300)),u.x=c,u.y=this.previousBtnY+this.previousBtnHeight+d,this.bodyContainer.addChild(u),this.previousBtnY=u.y,this.previousBtnHeight=u.height,a.forEach(function(n){o.label=n,o.settingsKey="showDifficulty",o.action=this.config.buttonHandler.changeSetting;var r=this.checkAndCreateButton(o,n.toLowerCase()),a=new t.Text(i(n),h);r&&(r.y=this.previousBtnY+this.previousBtnHeight+d,a.y=this.previousBtnY+this.previousBtnHeight+d,this.previousBtnY=r.y,this.previousBtnHeight=r.height,a.x=c,r.x=e.Coords.x(150),e.StringManager.shrinkToFit(a,e.StringManager.extractNumbersFromString(h.font),"",e.Coords.x(110)),this.bodyContainer.addChild(a),this.bodyContainer.addChild(r),this._modifyButtonInput(r),this.controlFocusManager.addControl(r,!1,"body"))}.bind(this)),this.bodyHeight=this.previousBtnY+this.previousBtnHeight},C.prototype.initShowTutorialOptions=function(){var n=e.UIBuilder.getConfigData(this.tutorialOptionsName),r=n.buttonSections[0],o=r.buttons[0],a=["Klondike","Spider","FreeCell","Pyramid","TriPeaks"];const s=i(r.title);var l={font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},h={font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},u=new t.Text(s,l),d=e.Coords.y(15),c=e.Coords.x(34);e.StringManager.shrinkToFit(u,e.StringManager.extractNumbersFromString(l.font),"",e.Coords.x(300)),u.x=c,u.y=this.previousBtnY+this.previousBtnHeight+d,this.bodyContainer.addChild(u),this.previousBtnY=u.y,this.previousBtnHeight=u.height,a.forEach(function(n){o.label=n,o.settingsKey="showTutorial",o.action=this.config.buttonHandler.changeSetting;var r=this.checkAndCreateButton(o,n.toLowerCase()),a=new t.Text(i(n),h);r&&(r.y=this.previousBtnY+this.previousBtnHeight+d,a.y=this.previousBtnY+this.previousBtnHeight+d,this.previousBtnY=r.y,this.previousBtnHeight=r.height,a.x=c,r.x=e.Coords.x(150),e.StringManager.shrinkToFit(a,e.StringManager.extractNumbersFromString(h.font),"",e.Coords.x(110)),this.bodyContainer.addChild(a),this.bodyContainer.addChild(r),this._modifyButtonInput(r),this.controlFocusManager.addControl(r,!1,"body"))}.bind(this)),this.bodyHeight=this.previousBtnY+this.previousBtnHeight},C.prototype.checkAndCreateButton=function(t,e){var n=null;t.text=i(t.text),t.isGameOption=!0,t.action=this.config.buttonHandler.changeSetting;var r=t.settingsKey&&e?this.settingsManager.getSetting(e,t.settingsKey):null;switch(t.type){case"button":n="resetCumulativeScore"===t.id?this.createResetCumulativeScoreBtn(t):this.buildButton(t);break;case"radio":n=this.buildRadioGroup(t,e,r);break;case"toggle":n=this.buildToggleButton(t,e,r);break;case"input":n=this.buildInput(t,e,r),this.inputButton=n;break;case"iconButton":n=this.buildIconButton(t);default:n=this.buildIconButton(t)}return"radio"===t.type?o.each(n.buttons,function(t){this._modifyButtonInput(t)}.bind(this)):this._modifyButtonInput(n),n},C.prototype.buildButton=function(t){return o.extend(t,{threeSlice:{multistate:!0,images:{left:e.AssetMap("buttonThreeSliceGrey.left"),center:e.AssetMap("buttonThreeSliceGrey.center"),right:e.AssetMap("buttonThreeSliceGrey.right")}},width:e.Coords.x(295),height:e.Coords.y(54),maxWidth:e.Coords.x(280),minHeight:e.Coords.y(54),border:{color:16777215,thickness:e.Coords.x(5)},downFill:"#ffffff",letterStyle:{font:"Bold "+22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"}}),new a(t)},C.prototype.buildRadioGroup=function(t,e,i){return new u(o.extend(t,{radioButtons:t.options,title:t.text,action:t.action,settingPrefix:e,setting:i}))},C.prototype.buildToggleButton=function(t,e,i){return new d(o.extend(t,{settingPrefix:e,setting:i}))},C.prototype.buildInput=function(t,e,i){return new l(o.extend(t,{settingPrefix:e,setting:i,validate:function(t){return!0}}),this.game)},C.prototype.buildIconButton=function(t){return new h(t)},C.prototype.positionPopupContainer=function(){this.popupContainer.x=.5*(e.Coords.x(1920)-this.background.width),this.popupContainer.y=.5*(e.Coords.y(1080)-this.background.height)-e.Coords.y(70)},C.prototype.updateChildIndexes=function(){this.popupContainer.setChildIndex(this.header,this.popupContainer.children.length-1),this.popupContainer.setChildIndex(this.headerLabel,this.popupContainer.children.length-1),this.popupContainer.setChildIndex(this.closeBtn,this.popupContainer.children.length-1)},C.prototype.openPopup=function(){var t=this;this.showFadeInTween=new TWEEN.Tween({alpha:this.alpha}).to({alpha:1},250).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){t.alpha=this.alpha,t.overlay.alpha=this.alpha}).onComplete(function(){}).start()},C.prototype.closePopup=function(){var t=this;this.showFadeOutTween=new TWEEN.Tween({alpha:this.alpha}).to({alpha:0},250).easing(TWEEN.Easing.Cubic.Out).onUpdate(function(){t.alpha=this.alpha,t.overlay.alpha=this.alpha}).onComplete(function(){t.showFadeOutTween.stop(),t.destroy()}).start(),this.onClose.handleEvent(this),this.inputButton&&this.inputButton.disable()},C.prototype.destroy=function(){this.overlay.parent&&this.overlay.parent.removeChild(this.overlay),this.parent&&this.parent.removeChild(this),y.remove(this)},C.prototype.doScroll=function(t){var e=0;t||(t=window.event),t.wheelDelta?e=t.wheelDelta/15:t.detail&&(e=-t.detail/3),this.scrollTo(this.bodyContainer.y+10*e)},C.prototype.scrollTo=function(t){var i,r,o=Math.max(n.scaleFactorY,.6);if(i=this.bodyHeight+e.Coords.y(65)+this.config.popupHeight*(1-o),r=this.background.height,i<=r)return void(this.bodyContainer.y=this.header.height);this.bodyContainer.y=t,this.bodyContainer.y<=r-i?this.bodyContainer.y=r-i:this.bodyContainer.y>=this.header.height&&(this.bodyContainer.y=this.header.height),this.sidebar&&this.sidebar.updateHandleByPercent(100*Math.abs(this.bodyContainer.y-this.header.height)/Math.abs(i-r+this.header.height)),this.inputButton&&this.inputButton.disable()},C.prototype._modifyButtonInput=function(t){e.Platform.supportsTouch()?(this._bindButtonTouchInput(t),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&this._bindButtonMouseInput(t)):this._bindButtonMouseInput(t)},C.prototype._bindButtonMouseInput=function(t){var e=function(t,e,i){e&&t.setTexture(e),t.hasBeenDown=i};t.mousedown=function(i){e(t,t.downTexture,!0)}.bind(t),t.mouseover=function(i){t.hasBeenDown&&e(t,t.overTexture,!0)}.bind(t),t.mouseout=function(i){t.hasBeenDown&&e(t,t.upTexture,!0)}.bind(t),t.mouseupoutside=function(){e(t,t.upTexture,!1)}.bind(t),t.mouseup=function(i){t.hasBeenDown&&(e(t,t.upTexture,!1),"function"==typeof t.handleAction&&t.handleAction())}.bind(t)},C.prototype._bindButtonTouchInput=function(t){var e=function(t,e,i){e&&t.setTexture(e),t.hasBeenDown=i};t.touchstart=function(i){e(t,t.downTexture,!0)}.bind(t),t.touchend=function(i){t.hasBeenDown&&(e(t,t.upTexture,!1),"function"==typeof t.handleAction&&t.handleAction())}.bind(t),t.touchendoutside=function(i){e(t,t.upTexture,!1)}.bind(t),t.touchmove=function(i){t.getBounds().contains(i.global.x,i.global.y)||e(t,t.upTexture,!1)}.bind(t)},C.prototype.handleCommand=function(t,e){if(!e)switch(t){case"Right":this.startScrolling(12);break;case"Left":this.startScrolling(-12);break;case"Up":this.controlFocusManager.focusNextControl(-1),this.startScrolling(-9);break;case"Down":this.controlFocusManager.focusNextControl(1),this.startScrolling(9);break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Unfocus":this.controlFocusManager.unfocusCurrentControl();break;case"Activate":this.controlFocusManager.activateCurrentControl();break;case"Tab":this.focusGroupToggle=!this.focusGroupToggle,this.focusGroupToggle?(this.controlFocusManager.setFocusGroup("close",!0),this.popupContainer.addChild(this.closeBtn.highlight),this.scrollTo(100)):(this.controlFocusManager.setFocusGroup("body",!0),this.popupContainer.removeChild(this.closeBtn.highlight),this.scrollTo(100));break;case"ShiftTab":this.focusGroupToggle=!0,this.controlFocusManager.setFocusGroup("close",!0),this.popupContainer.addChild(this.closeBtn.highlight),this.scrollTo(100)}},C.prototype.createResetCumulativeScoreBtn=function(t){return t.action=function(){var t=new m(this.game.ui.currentScreen,"dialogs.newDealHeadline","dialogs.newDealContent",function(){this.closePopup();var e=this.game.solitaire.ActiveMode.Name;this.game.startGame(e,null,!0,!0),t.close()}.bind(this),function(){t.close()})}.bind(this),this.buildButton(t)},C.prototype.startScrolling=function(t){this.sidebar.updateByArrow(t)},C}),define("MenuUI/MenuBar",["pixi","absolute","absolute/stringmanager","lodash","MenuUI/SlideOutMenu","MenuUI/MsftIconButton","Solitaire/Solitaire","Solitaire/SolitaireGameMode","util/SettingsManager","MenuUI/DealWarningModal","gameconfig","MenuUI/NewsDialog","MenuUI/StarCountDisplay","Solitaire/MvvmStructure/Service/SolitaireStarClubService","Solitaire/MvvmStructure/Service/ManifestService","MenuUI/CreditsDialog","MenuUI/WarningModal","Managers/TelemetryManager","Managers/BrowserUtils","Managers/ScaleManager","util/ScaleParams","MenuUI/GameOptionsPopup","MenuUI/DetailStatsItemModel"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w){var x=function(t,i,r){var o={tiles:[],label:"",letterStyle:{font:35*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",tint:16777215,align:"left"},tilePaddingX:e.Coords.x(24),tilePaddingY:e.Coords.x(50)};this.fullScreenEnabled=e.GameConfig.defaults.config.UI.fullScreenEnabled,this.initMenuBar(n.extend(o,t),i,r)};return x.prototype=Object.create(t.DisplayObjectContainer.prototype),x.prototype.initMenuBar=function(i,n,r){t.DisplayObjectContainer.call(this),this.supportUrl=e.UIBuilder.getConfigData("AboutSlideOut").buttonSections[0].buttons.filter(function(t){return"buttons.support"===t.text})[0].data,this.privacyUrl=e.UIBuilder.getConfigData("AboutSlideOut").buttonSections[0].buttons.filter(function(t){return"buttons.privacy"===t.text})[0].data,this.config=i,this.ui=n,this.game=r,this.settingsManager=l,this.backHandler=this._defaultBackHandler.bind(this),this.menuHandler=this.toggleMainSlideOut.bind(this),this.subMenuOpen=!1,this.menuBarHeight=e.Coords.y(66),this.topBar=new t.Graphics,this.topBar.beginFill(1451584,1),this.topBar.drawRect(0,0,this.ui.width,e.Coords.y(this.menuBarHeight)),this.topBar.endFill(),this.addChild(this.topBar),this.inputInterceptOverlay=new t.Graphics,this.inputInterceptOverlay.beginFill(1,0),this.inputInterceptOverlay.drawRect(0,0,this.ui.width,this.ui.height),this.inputInterceptOverlay.endFill(),this.inputInterceptOverlay.visible=!1,this.inputInterceptOverlay.interactive=!0,this.inputInterceptOverlay.hitArea=new t.Rectangle(0,0,this.ui.width,this.ui.height),this.bindInteraction(this.inputInterceptOverlay,function(){this.toggleMainSlideOut()}.bind(this)),this.inputInterceptOverlay.mousedown=function(){},this.addChild(this.inputInterceptOverlay),this.buildSlideOutMenus(),this.menuButton=new o({text:e.StringManager("buttons.menu"),icon:"Buttons/Menu/Menu.png",iconDown:"Buttons/Menu/Menu_inv.png",buttonOptions:{isDownBkgColor:5275053,isUpBkgColor:5275053,isDownStrokeColor:9810125,isUpStrokeColor:7370886,isOverStrokeFill:5275053,isUpStrokeFill:1451584,bkgOpacity:1},width:e.Coords.x(b.menuBar.menuButton.width),height:e.Coords.x(b.menuBar.menuButton.height),upStroke:!1,textY:e.Coords.y(38),action:function(){this.parent.addChild(this),this.menuHandler()}.bind(this)}),this.backButton=new o({text:e.StringManager("buttons.back"),icon:"Buttons/Back/Back.png",iconDown:"Buttons/Back/Back_inv.png",buttonOptions:{isDownBkgColor:5275053,isUpBkgColor:5275053,isDownStrokeColor:9810125,isUpStrokeColor:7370886,isOverStrokeFill:5275053,isUpStrokeFill:1451584,bkgOpacity:1},width:e.Coords.x(b.menuBar.backButton.width),height:e.Coords.x(b.menuBar.backButton.height),upStroke:!1,textY:e.Coords.y(38),action:function(){this.showExitWarning(this.backHandler.bind(this))}.bind(this)}),this.fullScreenButton=new o({text:"",icon:"icon_fullscreen.png",buttonOptions:{isDownBkgColor:5275053,isUpBkgColor:5275053,isDownStrokeColor:9810125,isUpStrokeColor:7370886,isOverStrokeFill:5275053,isUpStrokeFill:1451584,bkgOpacity:1},iconSize:{width:e.Coords.x(45),height:e.Coords.x(45)},iconDown:"icon_fullscreen.png",width:e.Coords.x(b.menuBar.fullScreenButton.width),height:e.Coords.x(b.menuBar.fullScreenButton.height),upStroke:!1,textY:e.Coords.y(35),action:function(){this.getButtonHandler().toggleFullscreen()}.bind(this)}),this.fullScreenButton.visible=this.fullScreenEnabled,this.menuButton.x=e.Coords.x(b.menuBar.menuButton.x),this.backButton.x=e.Coords.x(b.menuBar.backButton.x),this.fullScreenButton.x=(this.ui.width-this.fullScreenButton.width-e.Coords.x(b.menuBar.fullScreenButton.offsetX))*S.scaleFactorX,this.backButton.visible=!1,this.addChild(this.menuButton),this.addChild(this.fullScreenButton),this.addChild(this.backButton),this.firstRun=!0,this.newsDialog=new d,this.newsButton=t.Sprite.fromFrame("btn_news.png"),this.newsButtonWidth=this.newsButton.width,this.newsButtonHeight=this.newsButton.height,this.newsButton.x=this.fullScreenButton.visible?this.fullScreenButton.x-(this.newsButton.width+e.Coords.x(10))*S.scaleFactorX:this.fullScreenButton.x,this.newsButton.y=e.Coords.y(b.menuBar.newsButton.y)*S.scaleFactorY,this.bindInteraction(this.newsButton,function(){g.IsValid()?this.newsDialog.show():this.showManifestWarning()}.bind(this)),this.addChild(this.newsButton),this.starCountDisplay=new c({},this,this.game),this.starCountDisplay.x=this.fullScreenEnabled?e.Coords.x(1617):e.Coords.x(1710),this.starCountDisplay.y=e.Coords.y(0),this.starCountDisplay.visible=!1,this.starCountWidth=this.starCountDisplay.width,this.starCountHeight=this.starCountDisplay.height,this.addChild(this.starCountDisplay),this.pageLabel=new t.Text("",this.config.letterStyle),this.addChild(this.pageLabel),this.domGameContainer=document.documentElement,this.controlGroup=[this.menuButton,this.backButton,this.starCountDisplay,this.fullScreenButton],S.addElement(this,{scaleChangeSource:"Full"})},x.prototype._defaultBackHandler=function(){this.activeMenu&&this.activeMenu.isOpen?this.toggleMainSlideOut(function(){this.game.navBack()}.bind(this)):this.game.navBack()},x.prototype.showExitWarning=function(t){if(this.game.solitaire&&this.game.solitaire.CurrentChallenge&&"playing"===this.game.fsm.current){var e=new h(this.ui.currentScreen,"dialogs.warningHeadline","dialogs.challengeExitWarning",function(){var i=this.game.solitaire.CurrentChallenge,n=i.GetModeName(),r=Math.floor(this.game.solitaire.Authority.CardSupply.PreciseTimePlayed),o=i.config.Difficulty;if(i.config.Date){var a=i.config.Date.substring(6,19),s=new Date(parseInt(a)),l=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();m.challengeComplete("Abandoned",n,r,l,o)}else{var h=p.currentCollection.Name,u=p.currentPack.Name;m.starClubComplete("Abandoned",r,n,o,h,u)}t(),e.close()}.bind(this),function(){e.close()}.bind(this));this.game.gameScreenUI.warning=e}else t()},x.prototype.setBackHandler=function(t){this.backHandler=t,this.menuHandler=t},x.prototype.removeBackHandler=function(t){this.backHandler=this._defaultBackHandler.bind(this),this.menuHandler=this.toggleMainSlideOut.bind(this)},x.prototype.toggleMainSlideOut=function(t){var e=function(){this.activeMenu.toggle(t),this.inputInterceptOverlay.visible=this.activeMenu.isOpen}.bind(this);this.addChild(this.activeMenu),this.subMenu&&this.subMenu.isOpen&&this.toggleSubMenu(),e(),this.fullScreenEnabled&&this.checkFullScreenStatus()},x.prototype.checkFullScreenStatus=function(){var t=this.ui.isFullScreen(),e=this.activeMenu.getButton("fullScreen"),i=this.activeMenu.getButton("exitFullScreen");e&&i&&(e.visible=!t,i.visible=t)},x.prototype.toggleSubMenu=function(t,e){t&&e&&!this.subMenuOpen?(this.subMenuButton=t,this.subMenuButton.oldUp=this.subMenuButton.upTexture,this.subMenuButton.upTexture=this.subMenuButton.downTexture,this.subMenuOpen=!0,this.subMenu=e,this.subMenu.onShow(!1,this.game.solitaire&&this.game.solitaire.Authority?this.game.solitaire.Authority.CardSupply.GameName:null)):this.subMenuOpen&&this.subMenuButton&&(this.subMenuOpen=!1,this.subMenuButton.upTexture=this.subMenuButton.oldUp,this.subMenuButton.setTexture(this.subMenuButton.upTexture)),this.removeChild(this.subMenu),this.addChild(this.subMenu),this.subMenu.toggle()},x.prototype.openGameOptions=function(t){var e=null;if(this.isGame){var i=this.game.gameScreenUI.gameName;i+=this.game.gameScreenUI.isChallenge?"Challenge":"",e=new v({contentLayout:"MainSlideOut",buttonHandler:this.getButtonHandler(),optionsName:i},this.game)}else e=new v({contentLayout:"MainSlideOut",buttonHandler:this.getButtonHandler(),optionsName:""},this.game);this.addChild(e.overlay),this.addChild(e),this.gameOptionsPopup=e,e.onClose.add(function(){this.gameOptionsPopup=null}.bind(this)),t&&this.toggleMainSlideOut()},x.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,e.Platform.supportsTouch()?(t.touchstart=i.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(t.click=i.bind(this))):t.click=i.bind(this)},x.prototype.openDirectlyToOptions=function(){this.toggleMainSlideOut(),window.setTimeout(function(){this.subMenu=this.gameOptionsSlideout,this.toggleSubMenu()}.bind(this),500)},x.prototype.getButtonHandler=function(){return{hintAction:function(t){t=!!t,this.game.solitaire.Hint(),t||this.toggleMainSlideOut()}.bind(this),switchGame:function(t){this.showExitWarning(function(){this.toggleMainSlideOut(function(){this.game.startGame(s[t],null,!1)}.bind(this))}.bind(this)),m.menuOptionSelected(t+"FlyoutItem")}.bind(this),navDaily:function(){this.showExitWarning(function(){this.toggleMainSlideOut(function(){this.game.navDaily()}.bind(this))}.bind(this)),m.menuOptionSelected("DailyChallengeFlyoutItem")}.bind(this),navStarClub:function(){this.showExitWarning(function(){this.toggleMainSlideOut(function(){this.game.navStarClub()}.bind(this))}.bind(this)),m.menuOptionSelected("StarClubFlyoutItem")}.bind(this),openOptions:function(t,e){m.menuOptionSelected("OptionsFlyoutItem"),this.openGameOptions(!0)}.bind(this),changeSetting:function(t,e,i){m.gameSettingChanged(t,e,i),this.backButton.interactive=!1;var n=function(){this.settingsManager.setSetting(t,e,i),this.game.solitaire?this.game.solitaire.updateSetting(e,i):this.game.updateSetting(e,i)}.bind(this),r=function(t){this.game.gameScreenUI.onHide(),this.game.menuBar.onHide(),n();var r;if("gameNumber"===e&&(r="$"+i),r){var o=function(){i?this.game.solitaire.DealNewGame(r,t):this.game.solitaire.DealNewGame(null,t),this.ui.hideLoadingScreen()}.bind(this);this.game.solitaire.SupplyView.CardSupply.CardAnimator.IsShuffleAnimationRunning()?(this.ui.showLoadingScreen(),this.game.solitaire.SupplyView.CardSupply.CardAnimator.OnShuffleFinished=function(){o(),this.game.menuBar.onShow()}.bind(this)):(o(),this.game.menuBar.onShow(!1,!0,!1))}else{var a=this.game.solitaire.ActiveMode.Name;this.game.solitaire.Template.SaveGameOptions(this.game.solitaire.Authority.CardSupply),this.game.solitaire.Authority.CardSupply.IsCardDragging=!1,this.game.startGame(a,null,!0,a!==s.Klondike,this.game.solitaire.Authority.CardSupply.HasMovedCards,!1)}this.gameOptionsPopup&&this.gameOptionsPopup.destroy()}.bind(this);if(u.settingRequiresRedeal[e]&&this.game.solitaire.Authority.CardSupply.HasMovedCards)var o=new h(this.ui.currentScreen,"dialogs.newDealHeadline","dialogs.newDealContent",function(){r(!1),o.close(),this.backButton.interactive=!0}.bind(this),function(){o.close(),this.backButton.interactive=!0}.bind(this));else u.settingRequiresRedeal[e]?(r(!1),this.backButton.interactive=!0):(n(),this.backButton.interactive=!0)}.bind(this),openHtpMenu:function(t,e){m.menuOptionSelected("HowToPlayFlyoutItem");var i=function(){var t=s.getModeById([this.game.mode]);this.toggleMainSlideOut(function(){this.game.navHtp(t)}.bind(this))}.bind(this);"playing"===this.game.fsm.current||this.game.config.singleGame.enabled?this.showExitWarning(i):this.toggleSubMenu(e,this.htpSlideout)}.bind(this),openHtp:function(t){this.toggleMainSlideOut(function(){this.game.navHtp(t)}.bind(this))}.bind(this),openLink:function(t){t===this.supportUrl&&m.menuOptionSelected("SupportFlyoutItem"),t==this.privacyUrl&&"en-us"!==e.StringManager.getUserLanguage().toLowerCase()&&(t=t.replace("en-us",e.StringManager.getUserLanguage())),window.open(t,"_blank").focus()}.bind(this),openStatistics:function(){var t=new w(s[this.game.config.singleGame.mode]);this.toggleMainSlideOut(this.game.navStatsDetail.bind(this.game,t))}.bind(this),openThemes:function(){this.toggleMainSlideOut(this.game.navThemes.bind(this.game))}.bind(this),openAbout:function(t,e){m.menuOptionSelected("AboutFlyoutItem"),this.toggleSubMenu(e,this.aboutSlideout)}.bind(this),openCredits:function(){this.toggleMainSlideOut(),this.ui.showCreditsDialog()}.bind(this),toggleFullscreen:function(t,n){if(e.Platform.supportsFullscreenApi()){var r=this.ui.isFullScreen();if(n){var o=this.activeMenu.getButton(r?"fullScreen":"exitFullScreen");n.visible=!1,o.visible=!0,this.toggleMainSlideOut()}r?this.ui.exitFullScreen(this.domGameContainer):this.ui.requestFullscreen(this.domGameContainer)}else var a=new y(this.ui.currentScreen,i("dialogs.fullScreenTitle"),i("dialogs.fullScreenContent"),function(){a.close()});m.fullscreenButtonClick(this.ui.isFullScreen())}.bind(this),resetCumulativeScore:function(){var t=new h(this.ui.currentScreen,"dialogs.newDealHeadline","dialogs.newDealContent",function(){var e=this.game.solitaire.ActiveMode.Name;this.toggleMainSlideOut(function(){this.game.startGame(e,null,!0,!0),t.close()}.bind(this))}.bind(this),function(){t.close()})}.bind(this),updateResetCumulativeScoreState:function(){var t=this.settingsManager.getSetting("klondike","scoringType");this.subMenu.getButton("resetCumulativeScore").visible="LASVEGASCUMULATIVE"===t}.bind(this)}},x.prototype.buildSlideOutMenus=function(){var t=this.game.config.singleGame.enabled?"SingleGameSlideOut":"MainSlideOut";this.mainMenuSlideout=new r({contentLayout:t,buttonHandler:this.getButtonHandler(),isMainMenu:!0,fullScreenEnabled:this.fullScreenEnabled}),this.gameSlideout=new r({contentLayout:t,buttonHandler:this.getButtonHandler(),isMainMenu:!1}),this.gameSlideout.visible=!1,this.gameOptionsSlideouts={},this.htpSlideout=new r({contentLayout:"HowToPlaySlideOut",buttonHandler:this.getButtonHandler(),isMainMenu:!1,isSubMenu:!0}),this.aboutSlideout=new r({contentLayout:"AboutSlideOut",buttonHandler:this.getButtonHandler(),isMainMenu:!1,isSubMenu:!0}),this.activeMenu=this.mainMenuSlideout,this.addChild(this.mainMenuSlideout),this.addChild(this.gameSlideout),this.addChild(this.htpSlideout),this.addChild(this.aboutSlideout)},x.prototype.onShow=function(t,i,n,r){this.visible=!0,this.backButton.visible=i,this.gameSlideout.visible=!t&&this.game.solitaire&&!this.game.solitaire.CurrentChallenge,this.mainMenuSlideout.visible=t||this.game.solitaire&&this.game.solitaire.CurrentChallenge,this.newsDialog.shouldShowLink(function(e){this.newsButton.visible=!(!t||!e)}.bind(this)),this.starCountDisplay.visible=!!n,t||this.game.solitaire&&this.game.solitaire.CurrentChallenge?(this.activeMenu=this.mainMenuSlideout,this.mainMenuSlideout.onShow(t),C.detectPrivateMode(function(t){if(this.firstRun)if(t)var e=new y(this.ui.currentScreen,"dialogs.privateBrowsingWarningHeadline","dialogs.privateBrowsingWarningContent",function(){e.close(),this.ui.mainScreen.initTutorial()}.bind(this));else this.ui.mainScreen.initTutorial();n&&this.starCountDisplay.onShow(p.GetStarClubGlobalStats().totalStarsEarned,this.firstRun),this.firstRun=!1},this)):(this.activeMenu=this.gameSlideout,this.gameSlideout.onShow(t)),this.pageLabel.x=i?this.backButton.x+this.backButton.width+e.Coords.x(20):this.backButton.x,this.pageLabel.y=this.topBar.y+(this.topBar.height-this.pageLabel.height)/2,this.pageLabel.setText(r||""),this.handleResize()},x.prototype.onHide=function(t){this.visible=!1,t&&this.starCountDisplay.onHide()},x.prototype.showManifestWarning=function(){this.ui.showWarning(i("dialogs.manifestWarningHeadline"),i("dialogs.manifestWarningContent"),function(){this.ui.hideLoadingScreen(),this.game.navBack()}.bind(this))},x.prototype.handleCommand=function(t){this.gameOptionsPopup?this.gameOptionsPopup.handleCommand(t):this.activeMenu&&this.activeMenu.handleCommand(t)},x.prototype.handleCommand=function(t){
"Back"===t?this.subMenuOpen&&this.subMenu?this.toggleSubMenu():this.activeMenu&&this.toggleMainSlideOut():this.subMenuOpen&&this.subMenu?this.subMenu.handleCommand(t):this.activeMenu&&this.activeMenu.handleCommand(t)},Object.defineProperty(x.prototype,"menuOpen",{get:function(){return this.activeMenu&&this.activeMenu.isOpen}}),x.prototype.handleResize=function(t){if(this.isGame=!!this.game.solitaire&&!!this.game.solitaire.Authority,this.subMenu){var e=this.subMenu.getButton("seedInput");void 0!==e&&e.updateTempInputField()}this.yScale=Math.max(Math.min(S.height/1080+.3,1),.7),this.xScale=Math.max(Math.min(S.width/1920+.3,1),.7),this.resizeScale=Math.min(this.yScale,this.xScale),this.resizeTopBar(),this.resizeMenuButton(),this.resizeBackButton(),this.resizePageLabel(),this.resizeFullScreenButton(),this.resizeNewsButton(),this.resizeStarCountDisplay()},x.prototype.resizeStarCountDisplay=function(){this.starCountDisplay.width=this.starCountWidth/S.scaleFactorX,this.starCountDisplay.height=this.starCountHeight/S.scaleFactorY,this.starCountDisplay.x=this.fullScreenEnabled?this.fullScreenButton.x-this.starCountDisplay.width-e.Coords.x(10)*S.scaleFactorX:this.ui.width-this.starCountDisplay.width-e.Coords.x(10)*S.scaleFactorX,e.Platform.isMobile()&&(this.starCountDisplay.width=this.starCountWidth/S.scaleFactorX*.7,this.starCountDisplay.height=this.starCountHeight/S.scaleFactorY*.7,this.starCountDisplay.x=this.ui.width-this.starCountDisplay.width)},x.prototype.resizeBackButton=function(){var t=b.menuBar.backButton;if(this.backButton.x=this.menuButton.x+this.menuButton.width+e.Coords.x(15),this.isGame||e.Platform.isMobile()){var i=this.resizeScale*(e.Coords.x(t.height)/S.scaleFactorY),n=this.resizeScale*(e.Coords.x(t.width)/S.scaleFactorX);this.backButton.height=i,this.backButton.width=n}else this.backButton.width=e.Coords.x(t.width)/S.scaleFactorX,this.backButton.height=e.Coords.x(t.height)/S.scaleFactorY;this.isGame&&e.Platform.isMobile()?(this.menuButton.visible=!1,this.backButton.x=this.menuButton.x):(this.menuButton.visible=!0,this.backButton.x=this.menuButton.x+this.menuButton.width+e.Coords.x(15))},x.prototype.resizeFullScreenButton=function(){if(this.isGame||e.Platform.isMobile()){var t=this.resizeScale*(e.Coords.x(b.menuBar.fullScreenButton.height)/S.scaleFactorY),i=this.resizeScale*(e.Coords.x(b.menuBar.fullScreenButton.width)/S.scaleFactorX);this.fullScreenButton.height=t,this.fullScreenButton.width=i}else this.fullScreenButton.width=e.Coords.x(b.menuBar.fullScreenButton.width)/S.scaleFactorX,this.fullScreenButton.height=e.Coords.x(b.menuBar.fullScreenButton.height)/S.scaleFactorY;this.fullScreenButton.x=this.ui.width-this.fullScreenButton.width-b.menuBar.fullScreenButton.offsetX},x.prototype.resizeNewsButton=function(){if(this.isGame||e.Platform.isMobile()){var t=this.resizeScale*(e.Coords.x(this.newsButtonHeight)/S.scaleFactorY),i=this.resizeScale*(e.Coords.x(this.newsButtonWidth)/S.scaleFactorX);this.newsButton.height=t,this.newsButton.width=i}else this.newsButton.width=e.Coords.x(this.newsButtonWidth)/S.scaleFactorX,this.newsButton.height=e.Coords.x(this.newsButtonHeight)/S.scaleFactorY;this.newsButton.x=this.fullScreenButton.visible?this.fullScreenButton.x-(this.newsButton.width+10):this.fullScreenButton.x,this.newsButton.y=e.Coords.y(b.menuBar.newsButton.y)*S.scaleFactorY},x.prototype.resizeMenuButton=function(){var t=b.menuBar.menuButton;if(this.isGame||e.Platform.isMobile()){var i=this.resizeScale*(e.Coords.x(t.height)/S.scaleFactorY),n=this.resizeScale*(e.Coords.x(t.width)/S.scaleFactorX);this.menuButton.x=e.Coords.x(t.x)*this.resizeScale,this.menuButton.height=i,this.menuButton.width=n}else this.menuButton.x=e.Coords.x(t.x)/S.scaleFactorX,this.menuButton.width=e.Coords.x(t.width)/S.scaleFactorX,this.menuButton.height=e.Coords.x(t.height)/S.scaleFactorY},x.prototype.resizePageLabel=function(){this.removeChild(this.pageLabel),this.pageLabel=new t.Text(this.pageLabel.text,this.config.letterStyle),this.pageLabel.scale.set(1/S.scaleFactorX,1/S.scaleFactorY),e.Platform.isMobile()?(this.pageLabel.scale.set(1/(2*S.scaleFactorX),1/(2*S.scaleFactorY)),this.pageLabel.visible=!0,this.backButton.visible?this.pageLabel.x=this.backButton.x+this.backButton.width+e.Coords.x(50):this.pageLabel.x=this.menuButton.x+this.menuButton.width+e.Coords.x(50),this.pageLabel.y=e.Coords.y(5)+this.topBar.y+(this.topBar.height-this.pageLabel.height)/2):(this.backButton.visible?this.pageLabel.x=this.backButton.x+this.backButton.width+e.Coords.x(20):this.pageLabel.x=e.Coords.x(b.menuBar.backButton.x)/S.scaleFactorX,this.pageLabel.y=e.Coords.y(5)+this.topBar.y+(this.topBar.height-this.pageLabel.height)/2,this.newsButton.visible&&this.newsButton.x<=this.pageLabel.x+this.pageLabel.width?this.pageLabel.visible=!1:this.fullScreenButton.visible&&this.fullScreenButton.x<=this.pageLabel.x+this.pageLabel.width?this.pageLabel.visible=!1:this.fullScreenButton.visible&&this.backButton.visible&&S.width<=b.menuBar.pageLabelHidePoint-e.Coords.x(b.menuBar.fullScreenButton.width)-e.Coords.x(b.menuBar.backButton.width)?this.pageLabel.visible=!1:this.fullScreenButton.visible&&S.width<=b.menuBar.pageLabelHidePoint-e.Coords.x(b.menuBar.fullScreenButton.width)?this.pageLabel.visible=!1:this.backButton.visible&&S.width<=b.menuBar.pageLabelHidePoint-e.Coords.x(b.menuBar.backButton.width)?this.pageLabel.visible=!1:S.width<=b.menuBar.pageLabelHidePoint?this.pageLabel.visible=!1:this.pageLabel.visible=!0),this.addChild(this.pageLabel),this.gameOptionsPopup&&this.setChildIndex(this.pageLabel,this.children.length-4)},x.prototype.resizeTopBar=function(){if(this.removeChild(this.topBar),this.topBar=new t.Graphics,this.isGame||e.Platform.isMobile()){var i=this.resizeScale*(this.menuBarHeight/S.scaleFactorY);this.topBar.beginFill(1,.5),this.topBar.drawRect(0,0,this.ui.width,i)}else this.topBar.beginFill(1451584,1),this.topBar.drawRect(0,0,this.ui.width,this.menuBarHeight/S.scaleFactorY);this.topBar.endFill(),this.addChild(this.topBar),this.setChildIndex(this.topBar,0)},x.prototype.resetTopBar=function(e){this.removeChild(this.topBar),this.topBar=new t.Graphics,this.topBar.beginFill(e?1:1451584,e?.5:1),this.topBar.drawRect(0,0,this.ui.width/S.scaleFactorX,this.menuBarHeight/S.scaleFactorY),this.topBar.endFill(),this.addChild(this.topBar),this.setChildIndex(this.topBar,0),this.menuButton.updateTexture(e),this.backButton.updateTexture(e),this.addChild(this.menuButton),this.addChild(this.backButton),this.setChildIndex(this.menuButton,1),this.setChildIndex(this.backButton,2),this.handleResize()},x}),define("MenuUI/MsftRectButton",["pixi","absolute","lodash","MenuUI/MsftButton"],function(t,e,i,n){var r=function(t){this._initMsftRectButton(t)};return r.constructor=r,r.prototype=Object.create(n.prototype),r.prototype._initMsftRectButton=function(t){n.call(this,t)},r.prototype._createTexture=function(e,i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(this.options.rect[i+"_color"],1),r.drawRect(0,0,this.options.width,this.options.height),r.endFill();var o=new t.Text(this.options.text,this.options.letterStyle),a=new t.Sprite(o.generateTexture());return a.anchor.x=a.anchor.y=.5,a.x=this.options.width/2,a.y=this.options.height/2,n.addChild(r),n.addChild(a),n.generateTexture()},r.prototype.destroy=function(){this.threeSlice&&this.threeSlice.destroy()},r}),define("MenuUI/ChallengeKickoff",["pixi","absolute","lodash","MenuUI/MsftButton","MenuUI/MsftRectButton","MenuUI/ControlFocusManager","MenuUI/ColorConstants","absolute/stringmanager"],function(t,e,i,n,r,o,a,s){var l=function(t,n,r){this.fontSize=40*e.ScreenMetrics.getResScale();var o={headline:"Fix headline",goalText:"Fix goalText",gameDifficulty:"Easy",rewardAmount:"0",bonusText:"Complete all of the day's Challenges to get",bonusAmount:"0",currencyIcon:"DC_kickoff_coin.png",letterStyleHeadline:{font:40*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},letterStyleLabel:{font:"Bold "+30*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},letterStyleContent:{font:30*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},completed:!1,playAction:function(){r.solitaire.DealNewGame()}};this.initChallengeKickoff(i.extend(o,t),n,r)};return l.prototype=Object.create(t.DisplayObjectContainer.prototype),l.prototype.bindInteraction=function(t,i){t.interactive=!0,t.buttonMode=!0,e.Platform.supportsTouch()?(t.touchstart=i.bind(this),(e.Platform._isWindows()||e.Platform._isMac()&&!e.Platform._isIOS())&&(t.mousedown=i.bind(this),t.mouseup=function(){})):(t.mousedown=i.bind(this),t.mouseup=function(){})},l.prototype.initChallengeKickoff=function(r,a,l){t.DisplayObjectContainer.call(this);var h=e.StringManager,u=e.Coords.x,d=u(255);this.config=r,this.game=l,this.ui=a,this.state="init",this.animationStarted=!1,this.kickOffContainer=new t.DisplayObjectContainer,this.descriptionContainer=new t.DisplayObjectContainer,this.headlineContainer=new t.DisplayObjectContainer;var c=new t.Graphics;c.clear(),c.beginFill(16777215,1),c.drawRect(0,0,e.Coords.x(1920),e.Coords.y(433)),c.endFill(),this.kickOffContainer.addChild(c),this.kickOffContainer.mask=c,this.godSparkleLeft=t.Sprite.fromFrame("ray.png"),this.godSparkleRight=t.Sprite.fromFrame("glow2.png"),this.godSparkleLeft.x=-u(102),this.godSparkleLeft.y=u(159),this.godSparkleRight.x=u(246),this.godSparkleRight.y=u(378),this.inputInterceptOverlay=new t.Graphics,this.inputInterceptOverlay.beginFill(1,0),this.inputInterceptOverlay.drawRect(0,0,this.ui.width,this.ui.height),this.inputInterceptOverlay.endFill(),this.inputInterceptOverlay.interactive=!0,this.inputInterceptOverlay.buttonMode=!1,this.inputInterceptOverlay.hitArea=new t.Rectangle(0,0,this.ui.width,this.ui.height),this.bindInteraction(this.inputInterceptOverlay,function(){}.bind(this)),this.addChild(this.inputInterceptOverlay),this.drawBackground(),this.icon=t.Sprite.fromFrame(this.config.icon),this.icon.x=u(167),this.icon.y=u(0),this.headline=new t.Text(h(this.config.headlineText).replace("\n",""),this.config.letterStyleHeadline),this.headline.anchor.set(0,.5),this.headline.x=u(265),this.headline.y=this.headline.height/2+u(7),this.goalHeadline=new t.Text(h("kickoff.goal"),this.config.letterStyleHeadline);var p=s.extractNumbersFromString(this.config.letterStyleHeadline.font);s.shrinkToFit(this.goalHeadline,p,"",105*e.ScreenMetrics.getResScale()),this.goalHeadline.anchor.set(.5,.5),this.goalHeadline.x=u(70)+this.goalHeadline.width/2,this.goalHeadline.y=u(35),this.goalHeadline.visible=!1,this.goalLabel=this.getTextSprite("kickoff.goal",this.config.letterStyleLabel,"right",230,90),this.goalText=new t.Text(h(this.config.goalText),i.cloneDeep(this.config.letterStyleContent)),this.goalText.x=d,this.goalText.y=u(91),this.difficultyLabel=this.getTextSprite("kickoff.difficulty",this.config.letterStyleLabel,"right",230,159),this.difficultyText=new t.Text(h(this.config.gameDifficulty),i.cloneDeep(this.config.letterStyleContent)),this.difficultyText.x=d,this.difficultyText.y=u(160),this.rewardLabel=this.getTextSprite("kickoff.reward",this.config.letterStyleLabel,"right",230,224),this.config.complete?(this.rewardText=new t.Text(h("dialogs.alreadyEarned"),i.cloneDeep(this.config.letterStyleContent)),this.rewardText.x=d,this.rewardText.y=u(225)):(this.rewardCurrency=this.getCurrencySprite(this.config.rewardAmount),this.rewardCurrency.x=d,this.rewardCurrency.y=u(225)),this.bonusLabel=this.getTextSprite("kickoff.bonus",this.config.letterStyleLabel,"right",230,288),this.bonusText=new t.Text(h(this.config.bonusText),i.cloneDeep(this.config.letterStyleContent)),this.bonusText.x=d,this.bonusText.y=u(289),this.bonusCurrency=this.getCurrencySprite(this.config.bonusAmount),this.bonusCurrency.x=this.bonusText.x+this.bonusText.width+u(10),this.bonusCurrency.y=u(289),this.name=new t.Text(h(this.config.gameName),this.config.letterStyleContent),this.name.anchor.set(.5,.5),e.StringManager.shrinkToFit(this.name,e.StringManager.extractNumbersFromString(this.config.letterStyleContent.font),"",e.Coords.x(160)),this.name.x=this.icon.x-this.name.width/2-u(5),this.name.y=u(37),this.playButton=new n({text:e.StringManager("buttons.play"),threeSlice:{multistate:!0,images:{left:"MS_3slice_btn_bluemodal_01.png",center:"MS_3slice_btn_bluemodal_02.png",right:"MS_3slice_btn_bluemodal_03.png"}},maxWidth:63*e.ScreenMetrics.getResScale(),keepTintOnDown:!0,maxWidth:63*e.ScreenMetrics.getResScale(),letterStyle:{font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},width:u(75),height:u(36),action:this.handlePlay.bind(this)}),this.playButton.x=u(273),this.playButton.y=u(this.config.isStarClub?300:365),this.cancelButton=new n({text:e.StringManager("buttons.cancel"),threeSlice:{multistate:!0,images:{left:"MS_3slice_btn_bluemodal_01.png",center:"MS_3slice_btn_bluemodal_02.png",right:"MS_3slice_btn_bluemodal_03.png"}},maxWidth:80*e.ScreenMetrics.getResScale(),keepTintOnDown:!0,maxWidth:80*e.ScreenMetrics.getResScale(),letterStyle:{font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},width:u(95),height:u(36),action:this.game.navBack.bind(this.game)}),this.cancelButton.x=u(363),this.cancelButton.y=u(this.config.isStarClub?300:365),this.headlineContainer.addChild(this.icon),this.headlineContainer.addChild(this.name),this.headlineContainer.addChild(this.headline),this.headlineContainer.addChild(this.goalHeadline),this.descriptionContainer.addChild(this.goalLabel),this.descriptionContainer.addChild(this.goalText),this.descriptionContainer.addChild(this.difficultyLabel),this.descriptionContainer.addChild(this.difficultyText),this.descriptionContainer.addChild(this.rewardLabel),this.config.complete||this.descriptionContainer.addChild(this.rewardCurrency),this.rewardText&&this.descriptionContainer.addChild(this.rewardText),this.config.isStarClub||(this.descriptionContainer.addChild(this.bonusLabel),this.descriptionContainer.addChild(this.bonusText),this.descriptionContainer.addChild(this.bonusCurrency)),this.descriptionContainer.addChild(this.playButton),this.descriptionContainer.addChild(this.cancelButton),this.addPipe(243,80,this.descriptionContainer),this.addPipe(243,150,this.descriptionContainer),this.addPipe(243,217,this.descriptionContainer),this.config.isStarClub||this.addPipe(243,283,this.descriptionContainer),this.kickOffContainer.y=u(378),this.kickOffContainer.addChild(this.descriptionContainer),this.kickOffContainer.addChild(this.headlineContainer),this.addChild(this.kickOffContainer),this.controlFocusManager=new o,this.controlFocusManager.addControl(this.playButton,!0),this.controlFocusManager.addControl(this.cancelButton,!0)},l.prototype.getBox=function(i,n,r,o){return this.graphics||(this.graphics=new t.Graphics),o=!!o,this.graphics.clear(),this.graphics.beginFill(i,1),this.graphics.drawRect(0,0,e.Coords.x(n),e.Coords.x(r)),this.graphics.endFill(),o?graphics:this.graphics.generateTexture()},l.prototype.drawBackground=function(){this.config.isStarClub?this.baseBackground=new t.Sprite(this.getBox(1591187,1920,368)):this.baseBackground=new t.Sprite(this.getBox(1591187,1920,433)),this.topLeftBackground=new t.Sprite(this.getBox(a[this.config.gameName],246,60)),this.topRightBackground=new t.Sprite(this.getBox(a[this.config.gameName],1674,60)),this.topRightBackground.x=this.topLeftBackground.width,this.descriptionContainer.addChild(this.baseBackground),this.headlineContainer.addChild(this.topLeftBackground),this.headlineContainer.addChild(this.topRightBackground),this.addPipe(this.topLeftBackground.width-3,3,this.headlineContainer)},l.prototype.getCurrencySprite=function(n){var r=new t.DisplayObjectContainer;if(this.config.isStarClub)i.times(n,function(e){var i=t.Sprite.fromFrame(this.config.currencyIcon);i.x=e*i.width,r.addChild(i)},this);else{var o=t.Sprite.fromFrame(this.config.currencyIcon),a=new t.Text("x",this.config.letterStyleLabel),s=new t.Text(e.StringManager(n),this.config.letterStyleLabel);a.anchor.set(.5,.5),s.anchor.set(.5,.5),a.x=o.width+e.Coords.x(10)+a.width/2,a.y=o.height/2,s.x=a.x+a.width/2+e.Coords.x(10)+s.width/2,s.y=o.height/2,r.addChild(o),r.addChild(a),r.addChild(s)}return new t.Sprite(r.generateTexture())},l.prototype.getTextSprite=function(i,n,r,o,a){var s=new t.Text(e.StringManager(i),n),l=new t.Sprite(s.generateTexture());return"right"==r&&(l.anchor.x=1),l.x=e.Coords.x(o),l.y=e.Coords.y(a),l},l.prototype.addPipe=function(i,n,r){if(!this.pipeTexture){var o=new t.Graphics;o.beginFill(16777215,1),o.drawRect(0,0,e.Coords.x(2),e.Coords.x(55)),o.endFill(),this.pipeTexture=o.generateTexture()}var a=new t.Sprite(this.pipeTexture);a.x=e.Coords.x(i),a.y=e.Coords.x(n),r.addChild(a)},l.prototype.handlePlay=function(){var t=this;e.AudioManager.playSound("ui_kickOffClose"),this.playButton.interactive=!1,this.cancelButton.interactive=!1,this.name.visible=!1,this.playTween=new TWEEN.Tween({y:0}).to({y:-this.baseBackground.height},300).easing(TWEEN.Easing.Quadratic.In).onUpdate(function(){t.descriptionContainer.y=this.y}).onComplete(function(){t.config.playAction(),t.inputInterceptOverlay.visible=!1,t.animationStarted=!0}).start(),this.sparkleTween=new TWEEN.Tween({alpha:0}).delay(500).to({alpha:[1,0]},800).onStart(function(){t.addChild(t.godSparkleLeft),t.addChild(t.godSparkleRight),t.headline.setText(e.StringManager(t.config.goalText)),t.goalHeadline.visible=!0}).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){t.godSparkleLeft.alpha=this.alpha,t.godSparkleRight.alpha=this.alpha}).onComplete(function(){}),this.slideDownTween=new TWEEN.Tween({y:this.kickOffContainer.y}).delay(500).to({y:this.ui.height-this.topLeftBackground.height},800).easing(TWEEN.Easing.Quadratic.InOut).onStart(function(){e.AudioManager.playSound("dc_fly")}).onUpdate(function(){t.kickOffContainer.y=this.y}).onComplete(function(){t.state="collapsed"}),this.playTween.chain(this.sparkleTween),this.sparkleTween.chain(this.slideDownTween)},l.prototype.onShow=function(){},l.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},l}),define("MenuUI/ChallengeHud",["pixi","absolute/threeslice","absolute","Managers/ScaleManager"],function(t,e,i,n){var r=function(t,e){this.init(t,e)};return r.prototype=Object.create(t.DisplayObjectContainer.prototype),r.prototype.init=function(e){switch(t.DisplayObjectContainer.call(this),this.huds=[],e){case 1:this.initOneHud();break;case 2:this.initTwoHuds();break;case 3:this.initThreeHuds();break;default:this.initSingleHud()}this.challengeHudHeight=this.height,this.challengeHudWidth=this.width},r.prototype.initOneHud=function(){this.addChild(this.initSingleHud())},r.prototype.initTwoHuds=function(){var t=this.initSingleHud(),e=this.initSingleHud();e.x=t.x+t.width,this.addChild(t),this.addChild(e)},r.prototype.initThreeHuds=function(){var t=this.initSingleHud(),e=this.initSingleHud(),n=this.initSingleHud();e.x=t.x+t.width-i.Coords.x(5),n.x=e.x+e.width,this.addChild(t),this.addChild(e),this.addChild(n)},r.prototype.initSingleHud=function(){var e=new t.DisplayObjectContainer,i=this.initLeft();e.addChild(i);var n=this.initRight();return e.addChild(n),n.x=i.x+i.width,e.rightBackground=n,e.leftBackground=i,this.huds.push(e),e},r.prototype.setLabel=function(t,e){t.x=this.huds[e].x+(this.huds[e].leftBackground.width-t.width)/2+i.Coords.x(10),t.y=(this.height-t.height)/2-i.Coords.y(3),this.huds[e].label=t,this.addChild(t)},r.prototype.setData=function(t,e){var n=i.Coords.x(5);this.huds[e].rightBackground.addChild(t),this.huds[e].data=t,this.huds[e].data.x=(this.huds[e].rightBackground.width-this.huds[e].data.width)/2-n},r.prototype.initLeft=function(){var t={width:"90",images:{left:"challenge_left_cap.png",center:"challenge_left_stretch.png",right:"challenge_left_stretch.png"}};return this._generateThreeSliceAsset(t)},r.prototype.initRight=function(){var t={width:"86",images:{left:"challenge_mid_cap.png",center:"challenge_right_stretch.png",right:"challenge_right_cap.png"}};return this._generateThreeSliceAsset(t)},r.prototype.handleResize=function(){var t=Math.max(Math.min(n.height/1080+.3,1),.5),e=Math.max(Math.min(n.width/1920+.3,1),.5),r=Math.min(t,e),o=r*(this.challengeHudHeight/n.scaleFactorY),a=r*(this.challengeHudWidth/n.scaleFactorX);this.width=a,this.height=o,this.huds.forEach(function(t){var e=i.Coords.x(5);t.data.y=(t.height-t.data.height)/2+i.Coords.y(3)*r,t.label.y=(t.height-t.label.height)/2+i.Coords.y(3)*r,t.data.position.x=(t.rightBackground.width-t.data.width)/2-e})},r.prototype._generateThreeSliceAsset=function(t){return new e(t)},r}),define("MenuUI/ChallengeFooter",["pixi","absolute","lodash","MenuUI/MsftButton","MenuUI/MsftRectButton","MenuUI/ControlFocusManager","absolute/stringmanager","util/NineSliceButton","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l){var h=function(e,i,n){t.DisplayObjectContainer.call(this),this.parentToAdd=e,this.game=i,this.config=n,this.initBkg(),e.addChild(this),this.initInfo(),this.initForceScaleSprite(),l.addElement(this,{scaleChangeSource:"Full"}),this.alpha=0,this.bkgGroup.alpha=0},u={Klondike:{right:"#1b9ecb",left:"#48cffd"},Spider:{right:"#9757ce",left:"#d5a4ff"},FreeCell:{right:"#d62c29",left:"#ff7070"},Pyramid:{right:"#d98a01",left:"#fb9a00"},TriPeaks:{right:"#79b31b",left:"#8ac91d"}};return h.prototype=Object.create(t.DisplayObjectContainer.prototype),h.prototype.appear=function(){var t=this,e=this.bkgGroup;new TWEEN.Tween({alpha:0}).to({alpha:1},150).easing(TWEEN.Easing.Linear.None).onUpdate(function(){t.alpha=this.alpha,e.alpha=this.alpha}).start()},h.prototype.destroy=function(){this.parentToAdd.removeChild(this),this.parentToAdd.removeChild(this.bkgGroup),l.removeElement(this)},h.prototype.initBkg=function(){this.bkgGroup=new t.Graphics;var i=new t.Graphics,n=u[this.config.gameName].right,r=u[this.config.gameName].left;i.beginFill(parseInt(n.replace("#",""),16),1),i.drawRect(0,e.Coords.y(546),1e4,1e4),i.endFill(),i.beginFill(parseInt(r.replace("#",""),16),1),i.drawRect(0,e.Coords.y(546),e.Coords.x(190),1e4),i.endFill(),this.bkgGroup.addChild(i),this.parentToAdd.addChild(this.bkgGroup)},h.prototype.initInfo=function(){var i,n,r,o;r=this.config,o={font:22*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},i=new t.Text(e.StringManager("kickoff.goal"),o),n=new t.Text(r.gameDescription,o),i.anchor.set(1,0),n.anchor.set(0,0),i.position.set(e.Coords.x(178),e.Coords.y(556)),n.position.set(e.Coords.x(200),e.Coords.y(556)),this.addChild(i),this.addChild(n)},h.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceScaleSprite.width=e.Coords.x(960),this.forceScaleSprite.height=e.Coords.y(590),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},h.prototype.handleResize=function(){this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/l.width,a=e.Coords.y(1080)/l.height,s=l.width,h=l.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>s){this.width=e.Coords.x(1920);var f=s/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>s){this.width=e.Coords.x(1920);var f=s/c;this.height=r*a*f}}this.x=0,this.y=e.Coords.y(1080)-this.height,this.bkgGroup.scale.set(this.scale.x,this.scale.y),this.bkgGroup.position.set(this.x,this.y)},h}),define("MenuUI/ChallengeStartModal",["pixi","absolute","lodash","MenuUI/MsftButton","MenuUI/MsftRectButton","MenuUI/ControlFocusManager","absolute/stringmanager","util/NineSliceButton","Managers/ScaleManager","MenuUI/ChallengeFooter","Managers/TelemetryManager"],function(t,e,i,n,r,o,a,s,l,h,u){var d=function(e,i,n,r,o){t.DisplayObjectContainer.call(this),this.parentToAdd=e,this.game=i,this.config=n,this.challengeFooter=r,this.isRestart=o,this.initModal(),e.addChild(this),this.initBkg(),this.initRibbon(),this.initInfo(),this.initButtons(),this.initForceScaleSprite(),l.addElement(this,{scaleChangeSource:"Full"})},c={Klondike:{right:"#1b9ecb",left:"#48cffd"},Spider:{right:"#9757ce",left:"#d5a4ff"},FreeCell:{right:"#d62c29",left:"#ff7070"},Pyramid:{right:"#d98a01",left:"#fb9a00"},TriPeaks:{right:"#79b31b",left:"#8ac91d"}};return d.prototype=Object.create(t.DisplayObjectContainer.prototype),d.prototype.initModal=function(){this.modal=new t.Graphics,this.modal.beginFill(0),this.modal.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.modal.alpha=.8,this.modal.interactive=!0,this.bindModalInput(),this.parentToAdd.addChild(this.modal),this.controlFocusManager=new o},d.prototype.bindModalInput=function(){this.modal.mouseover=function(t){},this.modal.mouseout=function(t){},this.modal.mousedown=function(t){},this.modal.mouseup=function(t){},this.modal.touchstart=function(t){},this.modal.touchend=function(t){},this.modal.touchendoutside=function(t){}},d.prototype.initBkg=function(){this.bodyGroup=new t.DisplayObjectContainer,this.bottomHalf=t.Sprite.fromFrame("challenge_start/bkg_bottom.png"),this.topHalf=t.Sprite.fromFrame("challenge_start/bkg_top.png"),this.bottomHalf.position.set(0,e.Coords.y(70)),this.addChild(this.topHalf),this.addChild(this.bodyGroup),this.bodyGroup.addChild(this.bottomHalf);var i=new t.Graphics,n=new t.Graphics;this.addChild(i),this.addChild(n),i.beginFill(16773939),i.drawRect(0,0,this.topHalf.width,this.topHalf.height),i.endFill(),n.beginFill(3358719),n.drawRect(0,e.Coords.y(70),this.bottomHalf.width,this.bottomHalf.height),n.endFill(),this.topHalf.mask=i,this.bodyGroup.mask=n},d.prototype.initRibbon=function(){this.ribbonGroup=new t.DisplayObjectContainer;var i=this.config.gameName,n=c[i].right,r=c[i].left;this.addChild(this.ribbonGroup);var o=new t.Sprite.fromFrame("challenge_start/banner_"+i+"_left_corner.png"),a=new t.Sprite.fromFrame("challenge_start/banner_"+i+"_right_corner.png");this.ribbonGroup.addChild(o),this.ribbonGroup.addChild(a),o.position.set(e.Coords.x(-17),e.Coords.y(80)),a.position.set(e.Coords.x(955),e.Coords.y(80));var s=new t.Graphics;this.ribbonGroup.addChild(s),s.beginFill(parseInt(r.replace("#",""),16),1),s.drawRect(e.Coords.x(-17),e.Coords.y(25),e.Coords.x(270),e.Coords.y(55)),s.endFill(),s.beginFill(parseInt(n.replace("#",""),16),1),s.drawRect(e.Coords.x(253),e.Coords.y(25),e.Coords.x(720),e.Coords.y(55)),s.endFill(),s.beginFill(0,.3),s.drawRect(e.Coords.x(2),e.Coords.y(80),e.Coords.x(953),e.Coords.y(4)),s.endFill(),this.ribbonLeftCorner=o,this.ribbonRightCorner=a},d.prototype.initInfo=function(){var i,n,r,o,a,s,l,h,u,d;u=this.config,d={font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},i=new t.Text(u.gameName,d),n=new t.Sprite.fromFrame("icon_"+u.gameName.toLowerCase()+"_topUI.png"),r=new t.Text(u.gameDescription,{font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"}),e.StringManager.shrinkToFit(r,31,"",e.Coords.x(650),e.Coords.y(55)),o=new t.Text(e.StringManager("kickoff.difficulty")+":",d),a=new t.Text(e.StringManager(u.difficultyName),{font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:c[u.gameName].right}),s=new t.Text(e.StringManager("kickoff.reward")+":",d),l=new t.Sprite.fromFrame(u.rewardIcon),l.scale.set(.65,.65);var p=u.isCompleted?e.StringManager("dialogs.alreadyEarned"):u.rewardAmount+" "+e.StringManager(u.rewardType);h=new t.Text(p,d),this.ribbonGroup.addChild(i),this.ribbonGroup.addChild(n),this.ribbonGroup.addChild(r),i.position.set(e.Coords.x(30),e.Coords.y(35)),n.position.set(e.Coords.x(200),e.Coords.y(50)),n.anchor.set(.5,.5),r.position.set(e.Coords.x(265),e.Coords.y(35)),this.bodyGroup.addChild(o),this.bodyGroup.addChild(a),this.bodyGroup.addChild(s),this.bodyGroup.addChild(h),this.bodyGroup.addChild(l),o.anchor.set(1,0),s.anchor.set(1,0),o.position.set(e.Coords.x(460),e.Coords.y(150)),s.position.set(e.Coords.x(460),e.Coords.y(200)),a.position.set(e.Coords.x(470),e.Coords.y(150)),h.position.set(e.Coords.x(520),e.Coords.y(200)),l.position.set(e.Coords.x(490),e.Coords.y(220)),l.anchor.set(.5,.5)},d.prototype.initButtons=function(){var t={font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(0),y:e.Coords.y(3)};this.playButton=new s("warning_dialogues/popup_button_Play_click.png","warning_dialogues/popup_button_Play_over.png","warning_dialogues/popup_button_Play.png",e.Coords.x(270),e.Coords.y(100),25,25,25,25,e.StringManager("buttons.play"),t),this.closeButton=new s("warning_dialogues/popup_button_Cancel_click.png","warning_dialogues/popup_button_Cancel_over.png","warning_dialogues/popup_button_Cancel.png",e.Coords.x(270),e.Coords.y(100),25,25,25,25,e.StringManager("buttons.cancel"),t),this.bodyGroup.addChild(this.playButton),this.bodyGroup.addChild(this.closeButton),this.playButton.position.set(e.Coords.x(340),e.Coords.y(352)),this.closeButton.position.set(e.Coords.x(620),e.Coords.y(352)),this.playButton.anchor.set(.5,.5),this.closeButton.anchor.set(.5,.5),this.playButton.onClick.add(function(){e.AudioManager.playSound("button");var t=this.game.solitaire.CurrentChallenge;if(t.config.Date){var i=new Date(parseInt(t.config.Date.substring(6,19))),n=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear();u.challengeStart(n,t.config.Data.GameMode,this.isRestart)}else u.starClubStart(t.config.Data.GameMode);this.game.solitaire.DealNewGame(),this.game.solitaire.Authority.CardSupply.IsWaitingForAds=!1,this.playButton.interactive=!1,this.closeButton.interactive=!1,this.playButton.alpha=.5,this.closeButton.alpha=.5,this.doAnimation()}.bind(this)),this.closeButton.onClick.add(function(){e.AudioManager.playSound("button"),this.game.navBack(),this.destroy()}.bind(this)),this.controlFocusManager.addControl(this.playButton,!0,null,0),this.controlFocusManager.addControl(this.closeButton,!0,null,1),this.controlFocusManager.unfocusCurrentControl(),this.controlFocusManager.focusCurrentControl()},d.prototype.doAnimation=function(){this.game&&this.game.gameScreenUI&&(this.game.gameScreenUI.challengeStartModal=null);var t=this.topHalf,i=this.modal,n=this.bodyGroup,r=this.destroy.bind(this),o=this.showFooter.bind(this),a=this,s=new TWEEN.Tween({alpha:1}).to({alpha:0},300).easing(TWEEN.Easing.Linear.None).onUpdate(function(){a.alpha=this.alpha,this.alpha<=i.alpha&&(i.alpha=this.alpha)}).onComplete(function(){r(),o()}),l=(new TWEEN.Tween({y:0}).to({y:e.Coords.y(100)},800).easing(TWEEN.Easing.Linear.None).onUpdate(function(){t.y=this.y}).onComplete(function(){u.visible=!1,s.start()}).start(),new TWEEN.Tween({y:0}).to({y:e.Coords.y(-500)},700).easing(TWEEN.Easing.Linear.None).onUpdate(function(){n.y=this.y}).onComplete(function(){d.visible=!1}).start(),this.ribbonLeftCorner),h=this.ribbonRightCorner,u=this.topHalf,d=this.bodyGroup;new TWEEN.Tween({y:e.Coords.y(80)}).to({y:e.Coords.y(60)},400).easing(TWEEN.Easing.Linear.None).onUpdate(function(){l.y=this.y,h.y=this.y}).onComplete(function(){l.visible=!1,h.visible=!1}).start()},d.prototype.showFooter=function(){this.challengeFooter.appear()},d.prototype.destroy=function(){l.removeElement(this),this.parentToAdd.removeChild(this),this.parentToAdd.removeChild(this.modal)},d.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(80),this.forceOffsetY=e.Coords.y(50),this.forceScaleSprite.width=e.Coords.x(1020),this.forceScaleSprite.height=e.Coords.y(465),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},d.prototype.handleResize=function(){this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1)
;var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/l.width,a=e.Coords.y(1080)/l.height,s=l.width,h=l.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>s){this.width=e.Coords.x(1920);var f=s/c;if(this.height=r*a*f,this.height/a>h){this.height=e.Coords.y(1080);var f=h/p;this.width=n*o*f}g=!0}if(!g&&d>h){this.height=e.Coords.y(1080);var f=h/p;if(this.width=n*o*f,this.width/o>s){this.width=e.Coords.x(1920);var f=s/c;this.height=r*a*f}}this.x=.5*e.Coords.x(1920)-this.width/2+this.forceOffsetX,this.y=.5*e.Coords.y(1080)-this.height/2+this.forceOffsetY},d.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},d}),define("MenuUI/HowToPlayPopup",["lodash","pixi","absolute/coords","absolute/screenmetrics","absolute/stringmanager","MenuUI/MsftButton","MenuUI/MsftToggleButton","absolute/textutils","absolute","MenuUI/ControlFocusManager","util/CustomWordWrapper","Managers/ScaleManager"],function(t,e,i,n,r,o,a,s,l,h,u,d){var c=function(e,r){var o={text:"",gameMode:"klondike",letterStyle:{font:25*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},letterStyleTitle:{font:30*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},indicatorLetterStyle:{font:20*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},width:i.x(1036),height:i.y(280),largeWidth:i.x(634),largeHeight:i.x(356),buttonWidth:i.x(172),buttonHeight:i.y(54),headline:"titles.howToPlay",threeSliceOptions:{multistate:!0,images:{left:"MS_3slice_btn_black_01.png",center:"MS_3slice_btn_black_02.png",right:"MS_3slice_btn_black_03.png"}},onClose:function(){},onToggleAlerts:function(){}};this.init(t.extend(o,e),r)};return c.constuctor=c,c.prototype=Object.create(e.DisplayObjectContainer.prototype),c.prototype.init=function(t,i){e.DisplayObjectContainer.call(this),this.config=t,this.ui=i,this.layoutType=d.scaleFactorX<.45?"large":"small",this.overlay=null,this.background=null,this.title=null,this.bodyText=null,this.nextButton=null,this.backButton=null,this.closeButton=null,this.playButton=null,this.doNotShowButton=null,this.pageIndicator=null,this.isTweening=!0,this.bodyLabels=[],this.bodyTexts=[],this.instructions=r("howToPlay."+this.config.gameMode,null,!0),this.pageIndex=0,this.controlFocusManager=new h,this.initOverlay(),this.initPageContainer(),this.initBackground(),this.initTitle(),this.initBodyLabels(),this.initBodyTexts(),this.initButtons(),this.initDoNotShowButton(),this.initControlFocusManager(),this.initPageIndicator(),this.initForceScaleSprite(),d.addElement(this,{scaleChangeSource:"Full"}),this.repositionPageContainer(),this.open()},c.prototype.initForceScaleSprite=function(){this.forceScaleSprite&&this.removeChild(this.forceScaleSprite),this.forceScaleSprite=e.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=l.Coords.x(10),this.forceOffsetY=l.Coords.y(10),this.forceScaleSprite.width="small"===this.layoutType?this.config.width:this.config.largeWidth,this.forceScaleSprite.height="small"===this.layoutType?this.config.height:this.config.largeHeight,this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},c.prototype.handleResize=function(){this.parent&&this.updateTransform();var t=d.scaleFactorX<.45?"large":"small";this.checkAndChangeLayout(t);var e=this.scale.x,i=this.scale.y;this.pageContainer.scale.set(1,1);var n=this.pageContainer.width,r=this.pageContainer.height;this.pageContainer.scale.set(e,i);var o=l.Coords.x(1920)/d.width,a=l.Coords.y(1080)/d.height,s=d.width,h=d.height;this.pageContainer.width=n*o,this.pageContainer.height=r*a;var u=this.pageContainer.width/o,c=this.pageContainer.height/a,p=n,g=r,f=!1;if(u>s){this.pageContainer.width=l.Coords.x(1920);var y=s/p;if(this.pageContainer.height=r*a*y,this.pageContainer.height/a>h){this.pageContainer.height=l.Coords.y(1080);var y=h/g;this.pageContainer.width=n*o*y}f=!0}if(!f&&c>h){this.pageContainer.height=l.Coords.y(1080);var y=h/g;if(this.pageContainer.width=n*o*y,this.pageContainer.width/o>s){this.pageContainer.width=l.Coords.x(1920);var y=s/p;this.pageContainer.height=r*a*y}}this.isTweening||(this.pageContainer.x=.5*l.Coords.x(1920)-this.pageContainer.width/2+this.forceOffsetX,this.pageContainer.y=.5*l.Coords.y(1080)-this.pageContainer.height/2+this.forceOffsetY)},c.prototype.initOverlay=function(){this.overlay&&this.removeChild(this.overlay);var t=new e.Graphics;t.beginFill(0,.3),t.drawRect(0,0,this.ui.width,this.ui.height),t.endFill(),t.interactive=!0,t.buttonMode=!1,t.hitArea=new e.Rectangle(0,0,this.ui.width,this.ui.height),l.SpriteUtils.bindInteraction(t,function(t){}.bind(this)),t.mouseup=function(){},this.addChild(t),this.overlay=t},c.prototype.initPageContainer=function(){this.pageContainer=new e.DisplayObjectContainer,this.addChild(this.pageContainer)},c.prototype.initBackground=function(){var t="small"===this.layoutType?this.config.width:this.config.largeWidth,i="small"===this.layoutType?this.config.height:this.config.largeHeight;this.background&&this.pageContainer.removeChild(this.background);var n=new e.Graphics;n.beginFill(0),n.drawRect(0,0,t,i),n.endFill(),this.pageContainer.addChild(n),this.background=n},c.prototype.initTitle=function(){this.title&&this.pageContainer.removeChild(this.headline);var t=new e.Text(r(this.config.headline||this.instructions[0].headline),this.config.letterStyleTitle);t.x=l.Coords.x(20),t.y=l.Coords.x(15),this.title=t,this.pageContainer.addChild(t)},c.prototype.initBodyLabels=function(t){this.instructions.filter(function(t){return-1!==t.id.indexOf("fue")||t.fue}).forEach(function(t){this.bodyLabels.push(t.description)}.bind(this))},c.prototype.initBodyTexts=function(){this.bodyText&&this.pageContainer.removeChild(this.bodyText),this.bodyLabels.forEach(function(t){var i=new e.Text(t,this.config.letterStyle);i.x=l.Coords.x(20),i.y=this.title.height+l.Coords.y(26),i.visible=!1,this.bodyTexts.push(i),this.pageContainer.addChild(i)}.bind(this)),this.bodyText=this.bodyTexts[this.pageIndex],this.bodyText.visible=!0,this.wrapBodyText()},c.prototype.initButtons=function(){this.initNextButton(),this.initPlayButton(),this.initBackButton(),this.initCloseButton(),this.initDoNotShowButton(),this.initControlFocusManager(),this.updateButtons()},c.prototype.initNextButton=function(){this.nextButton&&this.pageContainer.removeChild(this.nextButton);var t=this.buildButton(this.handlePageChanged.bind(this,!0),r("buttons.next"));t.x=this.pageContainer.width-t.width-i.x(20),t.y=this.pageContainer.y+this.pageContainer.height-t.height-l.Coords.x(20)*d.scaleFactorX,this.pageContainer.addChild(t),this.nextButton=t},c.prototype.initPlayButton=function(){this.playButton&&this.pageContainer.removeChild(this.playButton);var t=this.buildButton(this.closePopup.bind(this),r("buttons.play"));t.x=this.nextButton.x,t.y=this.nextButton.y,t.visible=!1,this.pageContainer.addChild(t),this.playButton=t},c.prototype.initBackButton=function(){this.backButton&&this.pageContainer.removeChild(this.backButton);var t=this.buildButton(this.handlePageChanged.bind(this,!1),r("buttons.back"));t.x=this.nextButton.x-this.nextButton.width-l.Coords.x(10)*d.scaleFactorX,t.y=this.nextButton.y,t.visible=!1,this.pageContainer.addChild(t),this.backButton=t},c.prototype.initCloseButton=function(){this.closeButton&&this.pageContainer.removeChild(this.closeButton);var t=this.buildButton(this.closePopup.bind(this),r("buttons.close")),e=this.backButton.visible?this.backButton:this.nextButton;t.x=e.x-e.width-l.Coords.x(10)*d.scaleFactorX,t.y=this.nextButton.y,this.pageContainer.addChild(t),this.closeButton=t},c.prototype.initDoNotShowButton=function(){this.doNotShowButton&&this.pageContainer.removeChild(this.doNotShowButton);var t=new a({action:function(t,e,i){this.config.onToggleAlerts(!i)}.bind(this),settingPrefix:"general",settingsKey:"showAlerts",text:"",setting:!1,letterStyle:{font:"bold "+20*n.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},toggleOff:"checkbox_off.png",toggleOn:"checkbox_on.png",onLabel:"buttons.doNotShowAgain",offLabel:"buttons.doNotShowAgain",toggleDot:"noDot"}),e="small"===this.layoutType?this.pageContainer.height-t.height-l.Coords.x(20)*d.scaleFactorX:this.nextButton.y-t.height-l.Coords.x(10)*d.scaleFactorX;t.x=l.Coords.x(20),t.y=e,this.pageContainer.addChild(t),this.doNotShowButton=t},c.prototype.initControlFocusManager=function(){this.controlFocusManager.addControl(this.playButton,!1,null,3),this.controlFocusManager.addControl(this.doNotShowButton,!0,null,0),this.controlFocusManager.addControl(this.closeButton,!0,null,1),this.controlFocusManager.addControl(this.backButton,!1,null,2),this.controlFocusManager.addControl(this.nextButton,!0,null,3),this.updateButtons()},c.prototype.initPageIndicator=function(){this.pageIndicator&&this.pageContainer.removeChild(this.pageIndicator),this.pageIndicator=new e.Text("",this.config.indicatorLetterStyle),this.pageContainer.addChild(this.pageIndicator),this.updatePageIndicator()},c.prototype.repositionPageContainer=function(){this.pageContainer.updateTransform(),this.pageContainer.x=-this.background.width,this.pageContainer.y=.5*l.Coords.x(1080)-this.pageContainer.height/2+this.forceOffsetY},c.prototype.checkAndChangeLayout=function(t){this.layoutType!==t&&(this.removePageContainer(),this.layoutType=t,this.bodyTexts=[],this.addChild(this.pageContainer),this.initBackground(),this.initTitle(),this.initBodyTexts(),this.initButtons(),this.initPageIndicator(),this.initForceScaleSprite(),this.handleResize(),this.repositionPageContainer())},c.prototype.removePageContainer=function(){this.pageContainer&&this.pageContainer.children&&(this.pageContainer.children.forEach(function(t){t.parent.removeChild(t)}),this.pageContainer.parent.removeChild(this.pageContainer),this.pageContainer=null,this.pageContainer=new e.DisplayObjectContainer)},c.prototype.open=function(){var t=this,e=.5*l.Coords.x(1920)-this.pageContainer.width/2+this.forceOffsetX,i=new TWEEN.Tween({x:this.pageContainer.x}).to({x:e},500).easing(TWEEN.Easing.Cubic.Out).onUpdate(function(){t.pageContainer.x=this.x}).onComplete(function(){TWEEN.remove(i),this.controlFocusManager.focusCurrentControl(),this.isTweening=!1}.bind(this)).start()},c.prototype.closePopup=function(){var t=this,e=-this.pageContainer.width,i=new TWEEN.Tween({x:this.pageContainer.x}).to({x:e},500).easing(TWEEN.Easing.Cubic.Out).onUpdate(function(){t.pageContainer.x=this.x}).onComplete(function(){"function"==typeof t.config.onClose&&t.config.onClose(),this.visible=!1,this.isTweening=!1,TWEEN.remove(i)}.bind(this)).start()},c.prototype.removeScaling=function(){d.removeElement(this)},c.prototype.wrapBodyText=function(){this.bodyText.style.wordWrap=!0,this.bodyText.style.wordWrapWidth=this.background.width-l.Coords.x(80),u.doTextCustomWrap(this.bodyText,r.extractNumbersFromString(this.config.letterStyle.font),"",this.bodyText.style.wordWrapWidth,.4*this.background.height)},c.prototype.updatePageIndicator=function(){this.pageIndicator.setText((this.pageIndex+1).toString()+" "+r("of")+" "+this.bodyLabels.length.toString()),this.pageIndicator.x=this.background.width-this.pageIndicator.width-i.x(20),this.pageIndicator.y=l.Coords.x(15)},c.prototype.handlePageChanged=function(t){this.bodyText.visible=!1,this.pageIndex+=t?1:-1,this.pageIndex=Math.max(0,this.pageIndex),this.pageIndex=Math.min(this.bodyLabels.length-1,this.pageIndex),this.bodyText=this.bodyTexts[this.pageIndex],this.bodyText.visible=!0,this.updateButtons(),this.updatePageIndicator(),this.wrapBodyText()},c.prototype.updateButtons=function(){this.controlFocusManager.unfocusCurrentControl(),this.nextButton.visible=this.pageIndex!==this.bodyLabels.length-1,this.playButton.visible=this.pageIndex===this.bodyLabels.length-1,this.backButton.visible=this.pageIndex>0,this.closeButton.visible=this.pageIndex!==this.bodyLabels.length-1,this.updateButtonsPositions(),this.updateControlFocuseManager()},c.prototype.updateControlFocuseManager=function(){this.controlFocusManager.setControlActive(this.playButton,this.playButton.visible),this.controlFocusManager.setControlActive(this.nextButton,this.nextButton.visible),this.controlFocusManager.setControlActive(this.backButton,this.backButton.visible),this.controlFocusManager.setControlActive(this.closeButton,this.closeButton.visible),this.controlFocusManager.sortActives(),this.controlFocusManager.focusCurrentControl(),this.pageIndex===this.bodyLabels.length-1&&this.controlFocusManager.focusNextControl(1)},c.prototype.updateButtonsPositions=function(){this.nextButton.x=this.background.width-this.nextButton.width-i.x(20);var t=this.backButton.visible?this.backButton:this.nextButton;this.closeButton.x=t.x-t.width-l.Coords.x(10)*d.scaleFactorX,this.backButton.x=this.nextButton.x-this.nextButton.width-l.Coords.x(10)*d.scaleFactorX},c.prototype.buildButton=function(t,e){return new o({action:t,text:e,width:this.config.buttonWidth,minHeight:this.config.buttonHeight,letterStyle:this.config.letterStyle,threeSlice:this.config.threeSliceOptions})},c.prototype.handleCommand=function(t){switch(t){case"Tab":case"Right":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":case"Left":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.activateCurrentControl()}},c}),define("util/DetailedButton",["pixi","absolute","util/eventhandler"],function(t,e,i){var n=function(e,n,r,o,a){this.upTexture=e,this.downTexture=r,this.overTexture=n,this.selectTexture=o,this.disabledTexture=a,this.interactive=!0,this.onClick=new i,t.Sprite.call(this,this.upTexture),this.bindListeners(),this.disabled=!1,this.selected=!1,this.hasFocus=!1};return n.prototype=Object.create(t.Sprite.prototype),n.prototype.constructor=n,n.prototype.bindListeners=function(){this.interactive=!0,this.buttonMode=!0,e.Platform.supportsTouch()?(this.bindTouchEvents(),e.Platform._isWindows()?this.bindMouseEvents():e.Platform._isMac()&&!e.Platform._isIOS()&&this.bindMouseEvents()):this.bindMouseEvents()},n.prototype.bindTouchEvents=function(){this.touchstart=function(t){this.selected&&!this.isDropDownButton||this.disabled||this.setTexture(this.downTexture)}.bind(this),this.touchend=function(t){this.selected&&!this.isDropDownButton||this.disabled||(this.setTexture(this.upTexture),this.handleInputUp())}.bind(this),this.touchendoutside=function(t){this.selected&&!this.isDropDownButton||this.disabled||this.setTexture(this.upTexture)}},n.prototype.bindMouseEvents=function(){this.mouseover=function(t){this.selected||this.disabled||this.setTexture(this.overTexture)},this.mouseout=function(t){this.selected||this.disabled||this.setTexture(this.upTexture)},this.mousedown=function(t){this.selected&&!this.isDropDownButton||this.disabled||this.setTexture(this.downTexture)}.bind(this),this.mouseup=function(t){this.selected&&!this.isDropDownButton||this.disabled||(this.setTexture(this.overTexture),this.handleInputUp())}.bind(this)},n.prototype.handleInputUp=function(){this.selected&&!this.isDropDownButton||this.disabled||(e.AudioManager.playSound("button"),this.onClick.handleEvent(this))},n.prototype.handleActivate=function(){this.selected&&!this.isDropDownButton||this.disabled||(e.AudioManager.playSound("button"),this.onClick.handleEvent(this))},n.prototype.toggle=function(){this.selected?this.deselect():this.select()},n.prototype.select=function(){this.disabled||(this.selected=!0,this.setTexture(this.selectTexture))},n.prototype.deselect=function(){this.disabled||(this.selected=!1,this.hasFocus?this.setTexture(this.overTexture):this.setTexture(this.upTexture))},n.prototype.enable=function(){this.disabled&&(this.disabled=!1,this.setTexture(this.upTexture))},n.prototype.disable=function(){this.disabled||(this.disabled=!0,this.setTexture(this.disabledTexture))},n.prototype._focusChanged=function(){this.selected||(this.hasFocus?this.setTexture(this.overTexture):this.setTexture(this.upTexture))},Object.defineProperty(n.prototype,"focus",{get:function(){return this.hasFocus},set:function(t){if(!this.disabled)return this.hasFocus=t,this._focusChanged(),t}}),n}),define("MenuUI/DifficultySelectionModal",["pixi","absolute","lodash","MenuUI/MsftButton","MenuUI/MsftRectButton","MenuUI/ControlFocusManager","absolute/stringmanager","util/NineSliceButton","util/DetailedButton","Managers/ScaleManager","MenuUI/ChallengeFooter","Managers/TelemetryManager","util/SettingsManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c){var p=function(e,i,n,r,o){t.DisplayObjectContainer.call(this),this.parentToAdd=e,this.game=i,this.config=n,this.challengeFooter=r,this.isRestart=o,this.radioButtons=[],this.difficultySelected=0,this.dropDownButtons=[],this.gameModeSelected=0,this.dropDownButtonsGroup=new t.DisplayObjectContainer,this.dropDownButton,this.toggleButton,this.toggleButtonCheck=!1,this.initModal(),e.addChild(this),this.initBackground(),this.initRibbon(),this.initInfo(),this.initOptions(),this.initNavigationButtons(),this.initToggleButton(),this.initForceScaleSprite(),h.addElement(this,{scaleChangeSource:"Full"})},g={Klondike:{right:"#1b9ecb",left:"#48cffd"},Spider:{right:"#9757ce",left:"#d5a4ff"},FreeCell:{right:"#d62c29",left:"#ff7070"},Pyramid:{right:"#d98a01",left:"#fb9a00"},TriPeaks:{right:"#79b31b",left:"#8ac91d"}};return p.prototype=Object.create(t.DisplayObjectContainer.prototype),p.prototype.initModal=function(){this.modal=new t.Graphics,this.modal.beginFill(0),this.modal.drawRect(0,0,e.Coords.x(1e4),e.Coords.y(1e4)),this.modal.alpha=.8,this.modal.interactive=!0,this.bindModalInput(),this.parentToAdd.addChild(this.modal),this.controlFocusManager=new o},p.prototype.bindModalInput=function(){this.modal.mouseover=function(t){},this.modal.mouseout=function(t){},this.modal.mousedown=function(t){},this.modal.mouseup=function(t){},this.modal.touchstart=function(t){},this.modal.touchend=function(t){},this.modal.touchendoutside=function(t){}},p.prototype.initBackground=function(){this.bodyGroup=new t.DisplayObjectContainer,this.addChild(this.bodyGroup);var i=new t.Graphics,n=new t.Graphics;this.bodyGroup.addChild(i),this.bodyGroup.addChild(n);const r=2*this.config.buttonHeight/3,o=this.config.gameModes.length>1?1.5*this.config.buttonHeight:0;this.config.height=2*this.config.padding+r+this.config.buttonSpacing+o+this.config.buttonSpacing+this.config.buttons.length*(this.config.buttonHeight+this.config.buttonSpacing),this.config.height+=2*this.config.borderSize,this.config.height+=5*this.config.padding,this.config.height+=this.config.toggleButtonSize,this.config.height+=this.config.ribbonHeight,this.config.height+=100,i.beginFill(this.config.borderColor),i.drawRect(0,0,e.Coords.x(this.config.width),e.Coords.y(this.config.height)),i.endFill(),n.beginFill(this.config.backgroundColor),n.drawRect(e.Coords.x(this.config.borderSize),e.Coords.y(this.config.borderSize),e.Coords.x(this.config.width-2*this.config.borderSize),e.Coords.y(this.config.height-2*this.config.borderSize)),n.endFill()},p.prototype.initOptions=function(){this.optionsGroup=new t.DisplayObjectContainer,this.addChild(this.optionsGroup);const i=2*this.config.buttonHeight/3,n=this.config.gameModes.length>1?1.5*this.config.buttonHeight:0,r=this.config.borderSize+this.config.ribbonHeight+2*this.config.padding,o=r+this.config.buttonSpacing,a=o+i+this.config.buttonSpacing,s=a+n+this.config.buttonSpacing,l=2*this.config.padding+i+this.config.buttonSpacing+n+this.config.buttonSpacing+this.config.buttons.length*(this.config.buttonHeight+this.config.buttonSpacing);var h=new t.Graphics;if(this.optionsGroup.addChild(h),h.beginFill(206660),h.drawRoundedRect(e.Coords.x(this.config.borderSize+this.config.padding),e.Coords.y(r),e.Coords.x(this.config.width-2*(this.config.borderSize+this.config.padding)),e.Coords.y(l),15),h.endFill(),textStyle={font:e.ScreenMetrics.getResScale()*i+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},optionDescription=new t.Text(this.config.modalDescription,textStyle),this.optionsGroup.addChild(optionDescription),optionDescription.position.set(e.Coords.x(this.config.width/2),e.Coords.y(o)),optionDescription.anchor.set(.5,0),textStyle={font:e.ScreenMetrics.getResScale()*i/2+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},optionDisclaimer=new t.Text(this.config.modalDisclaimer,textStyle),this.optionsGroup.addChild(optionDisclaimer),optionDisclaimer.position.set(e.Coords.x(this.config.width/2),e.Coords.y(r+l-(this.config.padding+this.config.buttonSpacing)/2)),optionDisclaimer.anchor.set(.5,.5),this.initOptionsButtons(this.optionsGroup,s),this.config.gameModes.length>1){var u=new t.Graphics;u.beginFill(6916513,1),u.drawRect(e.Coords.x(this.config.borderSize+2*this.config.padding),e.Coords.y(a),e.Coords.x(this.config.width-2*(this.config.borderSize+2*this.config.padding)),e.Coords.y(1.5*this.config.buttonHeight)),u.endFill(),this.optionsGroup.addChild(u);var d=new t.Graphics;d.beginFill(6916513,1),d.drawRect(e.Coords.x(this.config.borderSize+2*this.config.padding),e.Coords.y(a+1.5*this.config.buttonHeight),e.Coords.x(this.config.width-2*(this.config.borderSize+2*this.config.padding)),e.Coords.y((1.5*this.config.buttonHeight-2*this.config.borderSize)*this.config.gameModes.length+this.config.borderSize)),d.endFill(),this.dropDownButtonsGroup.addChild(d),textStyle={font:e.ScreenMetrics.getResScale()*i*(2/3)+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},this.dropDownButton=this.addDropDownButton("Error: No Value",a+this.config.borderSize,0,!0),this.createDropDown(this.dropDownButtonsGroup,a+2*this.config.borderSize),this.optionArrowBottomImage=new t.Text("v",textStyle),this.optionArrowBottomImage.position.set(e.Coords.x(this.config.width-(2*this.config.borderSize+3*this.config.padding)),e.Coords.y(a+n/2)),this.optionArrowBottomImage.anchor.set(.5,.5)}this.config.gameModes.length>1&&(this.optionsGroup.addChild(this.dropDownButton),this.optionsGroup.addChild(this.dropDownButtonsGroup),this.optionsGroup.addChild(this.optionArrowBottomImage))},p.prototype.initOptionsButtons=function(t,e){for(var i=0,n=0;n<this.config.buttons.length;n++){const r=this.addOptionButton(this.config.buttons[n].name,e,i);t.addChild(r),this.radioButtons.push(r),i++}const o=c.getSetting(this.config.gameName.toLowerCase(),"difficulty");this.selectCurrentDifficulty(o)},p.prototype.selectCurrentDifficulty=function(t){for(var e=0;e<this.config.buttons.length;e++)this.config.buttons[e].value===t&&(this.radioButtons[e].select(),this.difficultySelected=e)},p.prototype.createDropDown=function(t,e){for(var i=1,n=0;n<this.config.gameModes.length;n++){const r=this.addDropDownButton(this.config.gameModes[n].name,e,i,!1);t.addChild(r),this.dropDownButtons.push(r),i++}if("klondike"===this.config.gameName.toLowerCase()){const o=c.getSetting(this.config.gameName.toLowerCase(),"scoringType"),a=c.getSetting(this.config.gameName.toLowerCase(),"cardsPerDraw");this.selectKlondikeGameMode(o,a)}else if("spider"===this.config.gameName.toLowerCase()){const s=c.getSetting(this.config.gameName.toLowerCase(),"suits");this.selectSpiderGameMode(s)}this.dropDownButtonsGroup.visible=!1},p.prototype.selectKlondikeGameMode=function(t,e){for(var i=0;i<this.config.gameModes.length;i++)this.config.gameModes[i].scoringType===t&&this.config.gameModes[i].cardsPerDraw===e&&this.selectDropDownButton(this.dropDownButtons[i],i)},p.prototype.selectSpiderGameMode=function(t){for(var e=0;e<this.config.gameModes.length;e++)console.log(this.config.gameModes[e].suits),this.config.gameModes[e].suits===t&&this.selectDropDownButton(this.dropDownButtons[e],e)},p.prototype.addDropDownButton=function(i,n,r,o){var a={primaryColor:parseInt(g[this.config.gameName].right.replace("#",""),16),backgroundColor:137001,height:1.5*this.config.buttonHeight-2*this.config.borderSize,width:this.config.width-4*this.config.borderSize-4*this.config.padding,positionX:2*(this.config.borderSize+this.config.padding),positionY:n+(1.5*this.config.buttonHeight-2*this.config.borderSize)*r};const s=a.height/3;textStyle={font:e.ScreenMetrics.getResScale()*s+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"};const h=new t.Text(i,textStyle);h.position.set(e.Coords.x(a.height/2),e.Coords.y(a.height/2+2)),h.anchor.set(0,.5);var u=this.createDropDownButtonUp(a,h),d=this.createDropDownButtonOver(a,h),c=this.createDropDownButtonDown(a,h),p=this.createDropDownButtonSelected(a,h),f=new l(u,d,c,p,c);return f.isDropDownButton=!0,f.position.set(e.Coords.x(a.positionX),e.Coords.y(a.positionY)),f.anchor.set(0,0),o?f.onClick.add(function(){this.dropDownButtonsGroup.visible=!this.dropDownButtonsGroup.visible}.bind(this)):f.onClick.add(function(){for(var t=0;t<this.dropDownButtons.length;t++)this.dropDownButtons[t].deselect();this.selectDropDownButton(this.dropDownButtons[r-1],r-1),this.dropDownButtonsGroup.visible=!1}.bind(this)),this.controlFocusManager.addControl(f,!0,"DropDownButtons",r),f},p.prototype.selectDropDownButton=function(t,e){t.select(),this.gameModeSelected=e,this.dropDownButton.upTexture=t.upTexture,this.dropDownButton.downTexture=t.downTexture,this.dropDownButton.overTexture=t.overTexture,this.dropDownButton.selectTexture=t.selectTexture,this.dropDownButton.disabledTexture=t.disabledTexture,this.dropDownButton.setTexture(this.dropDownButton.upTexture),this.ableOptions(this.config.gameModes[e].disables)},p.prototype.ableOptions=function(t){for(var e=0;e<this.radioButtons.length;e++){this.radioButtons[e].enable();for(var i=0;i<t.length;i++)this.config.buttons[e].value===t[i]&&(this.difficultySelected===e&&(this.radioButtons[e].deselect(),this.radioButtons[e+1].select(),this.difficultySelected=e+1),this.radioButtons[e].disable())}},p.prototype.addOptionButton=function(i,n,r){var o={primaryColor:parseInt(g[this.config.gameName].right.replace("#",""),16),backgroundColor:137001,height:this.config.buttonHeight,spacing:this.config.buttonSpacing,width:this.config.width-2*this.config.borderSize-4*this.config.padding,positionX:this.config.borderSize+2*this.config.padding,positionY:n+(this.config.buttonHeight+this.config.buttonSpacing)*r};const a=o.height/2;textStyle={font:e.ScreenMetrics.getResScale()*a+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},optionButtonLabel=new t.Text(i,textStyle),optionButtonLabel.position.set(e.Coords.x(o.height+o.height/3),e.Coords.y((o.height-a)/2-1));var s=this.createOptionButtonUp(o,optionButtonLabel),h=this.createOptionButtonOver(o,optionButtonLabel),u=this.createOptionButtonDown(o,optionButtonLabel),d=this.createOptionButtonSelected(o,optionButtonLabel),c=this.createOptionButtonDisabled(o,optionButtonLabel),p=new l(s,h,u,d,c);return p.position.set(e.Coords.x(o.positionX),e.Coords.y(o.positionY)),p.onClick.add(function(){for(var t=0;t<this.radioButtons.length;t++)this.radioButtons[t].deselect();this.radioButtons[r].select(),this.difficultySelected=r}.bind(this)),this.controlFocusManager.addControl(p,!1,"OptionButtons",r),p},p.prototype.initRibbon=function(){this.ribbonGroup=new t.DisplayObjectContainer;var i=this.config.gameName,n=g[i].right;g[i].left;const r=this.config.borderSize+this.config.padding+this.config.ribbonHeight;this.addChild(this.ribbonGroup);var o=new t.Sprite.fromFrame("challenge_start/banner_"+i+"_left_corner.png"),a=new t.Sprite.fromFrame("challenge_start/banner_"+i+"_right_corner.png");this.ribbonGroup.addChild(o),this.ribbonGroup.addChild(a),o.position.set(e.Coords.x(-19),e.Coords.y(r)),a.position.set(e.Coords.x(this.config.width),e.Coords.y(r));var s=new t.Graphics;this.ribbonGroup.addChild(s),s.beginFill(parseInt(n.replace("#",""),16),1),s.drawRect(e.Coords.x(-19),e.Coords.y(this.config.borderSize+this.config.padding),e.Coords.x(38+this.config.width),e.Coords.y(this.config.ribbonHeight)),s.endFill(),s.beginFill(0,.3),s.drawRect(e.Coords.x(-19),e.Coords.y(r),e.Coords.x(38+this.config.width),e.Coords.y(4)),s.endFill(),this.ribbonLeftCorner=o,this.ribbonRightCorner=a},p.prototype.initInfo=function(){var i,n,r,o;const a=this.config.borderSize+this.config.padding+this.config.ribbonHeight/2;r=this.config,o={font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},i=new t.Text(r.gameNameText,o),n=new t.Sprite.fromFrame("icon_"+r.gameName.toLowerCase()+"_topUI.png"),this.ribbonGroup.addChild(i),this.ribbonGroup.addChild(n),i.position.set(e.Coords.x(80),e.Coords.y(a)),i.anchor.set(0,.5),n.position.set(e.Coords.x(30),e.Coords.y(a-3)),n.anchor.set(.5,.5)},p.prototype.initNavigationButtons=function(){var t={font:31*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left",anchor:{x:.5,y:.5},x:e.Coords.x(0),y:e.Coords.y(3)},i={width:270,height:100};this.closeButton=new s("warning_dialogues/popup_button_Cancel_click.png","warning_dialogues/popup_button_Cancel_over.png","warning_dialogues/popup_button_Cancel.png",e.Coords.x(i.width),e.Coords.y(i.height),25,25,25,25,e.StringManager("buttons.cancel"),t),this.playButton=new s("warning_dialogues/popup_button_Play_click.png","warning_dialogues/popup_button_Play_over.png","warning_dialogues/popup_button_Play.png",e.Coords.x(i.width),e.Coords.y(i.height),25,25,25,25,e.StringManager("buttons.play"),t),this.bodyGroup.addChild(this.closeButton),this.bodyGroup.addChild(this.playButton),this.closeButton.position.set(e.Coords.x(this.config.padding+this.config.borderSize+i.width/2),e.Coords.y(this.config.height-(2*this.config.padding+this.config.borderSize+i.height/2+this.config.toggleButtonSize))),this.playButton.position.set(e.Coords.x(this.config.width-(this.config.padding+this.config.borderSize+i.width/2)),e.Coords.y(this.config.height-(2*this.config.padding+this.config.borderSize+i.height/2+this.config.toggleButtonSize))),this.closeButton.anchor.set(.5,.5),this.playButton.anchor.set(.5,.5),this.playButton.onClick.add(function(){e.AudioManager.playSound("button"),c.setSetting(this.config.gameName.toLowerCase(),"showDifficulty",!this.toggleButtonCheck),c.setSetting(this.config.gameName.toLowerCase(),"difficulty",this.config.buttons[this.difficultySelected].value),this.game.solitaire.Authority.CardSupply.Options.DIFFICULTY=this.config.buttons[this.difficultySelected].value,"klondike"===this.config.gameName.toLowerCase()?(c.setSetting(this.config.gameName.toLowerCase(),"scoringType",this.config.gameModes[this.gameModeSelected].scoringType),c.setSetting(this.config.gameName.toLowerCase(),"cardsPerDraw",this.config.gameModes[this.gameModeSelected].cardsPerDraw),this.game.solitaire.Authority.CardSupply.Options.DRAW=this.config.gameModes[this.gameModeSelected].cardsPerDraw,this.game.solitaire.Authority.CardSupply.Options.SCORING=this.config.gameModes[this.gameModeSelected].scoringType):"spider"===this.config.gameName.toLowerCase()&&(c.setSetting(this.config.gameName.toLowerCase(),"suits",this.config.gameModes[this.gameModeSelected].suits),this.game.solitaire.Authority.CardSupply.NumSuits=this.config.gameModes[this.gameModeSelected].suits),this.game.gameScreenUI.updateLayout(),this.game.solitaire.DealNewGame(),this.game.solitaire.Authority.CardSupply.IsWaitingForAds=!1,this.playButton.interactive=!1,this.closeButton.interactive=!1,this.playButton.alpha=.5,this.closeButton.alpha=.5,this.destroy()}.bind(this)),this.closeButton.onClick.add(function(){e.AudioManager.playSound("button"),this.destroy()}.bind(this)),this.controlFocusManager.addControl(this.closeButton,!1,"ActionButtons",0),this.controlFocusManager.addControl(this.playButton,!1,"ActionButtons",1)},p.prototype.initToggleButton=function(){var i={primaryColor:parseInt(g[this.config.gameName].right.replace("#",""),16),backgroundColor:this.config.backgroundColor,borderSize:this.config.borderSize/2,height:this.config.toggleButtonSize,width:this.config.toggleButtonSize,positionX:this.config.borderSize+this.config.padding,positionY:this.config.height-(this.config.padding+this.config.borderSize+this.config.toggleButtonSize)},n={font:e.ScreenMetrics.getResScale()*i.height+"px Segoe UI",
fontFamily:"segoe",fill:"#ffffff"};this.toggleButtonCheckImage=new t.Text("x",n);var r=this.createToggleButtonUp(i),o=this.createToggleButtonOver(i),a=this.createToggleButtonDown(i),s=this.createToggleButtonSelected(i),h=this.createToggleButtonDisabled(i);this.toggleButton=new l(r,o,a,s,h),this.toggleButton.position.set(e.Coords.x(i.positionX),e.Coords.y(i.positionY)),this.toggleButton.onClick.add(function(){this.toggleButtonCheck?(this.toggleButtonCheckImage.visible=!1,this.toggleButtonCheck=!1):(this.toggleButtonCheckImage.visible=!0,this.toggleButtonCheck=!0)}.bind(this)),this.optionsGroup.addChild(this.toggleButton),this.optionsGroup.addChild(this.toggleButtonCheckImage),this.toggleButtonCheckImage.position.set(e.Coords.x(i.positionX+i.width/2),e.Coords.y(i.positionY+i.height/2)),this.toggleButtonCheckImage.anchor.set(.5,.5),this.optionsGroup.addChild(this.toggleButtonCheckImage),this.toggleButtonCheckImage.visible=!1,n={font:e.ScreenMetrics.getResScale()*i.height*2/3+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff"},toggleLabel=new t.Text(e.StringManager("solvable.alwaysRememberSelection"),n),this.optionsGroup.addChild(toggleLabel),toggleLabel.position.set(e.Coords.x(i.positionX+1.5*i.width),e.Coords.y(i.positionY+i.height/2+2)),toggleLabel.anchor.set(0,.5),this.controlFocusManager.addControl(this.toggleButton,!1,"ToggleButton",0)},p.prototype.destroy=function(){h.removeElement(this),this.parentToAdd.removeChild(this),this.parentToAdd.removeChild(this.modal)},p.prototype.initForceScaleSprite=function(){this.forceScaleSprite=t.Sprite.fromFrame("Buttons/SubMenuBack/SubMenuBack-Up.png"),this.forceOffsetX=e.Coords.x(this.config.offsetX+56),this.forceOffsetY=e.Coords.y(this.config.offsetY),this.forceScaleSprite.width=e.Coords.x(this.config.width),this.forceScaleSprite.height=e.Coords.y(this.config.height),this.forceScaleSprite.alpha=0,this.addChild(this.forceScaleSprite)},p.prototype.handleResize=function(){this.parent&&this.updateTransform();var t=this.scale.x,i=this.scale.y;this.scale.set(1,1);var n=this.width,r=this.height;this.scale.set(t,i);var o=e.Coords.x(1920)/h.width,a=e.Coords.y(1080)/h.height,s=h.width,l=h.height;this.width=n*o,this.height=r*a;var u=this.width/o,d=this.height/a,c=n,p=r,g=!1;if(u>s){this.width=e.Coords.x(1920);var f=s/c;if(this.height=r*a*f,this.height/a>l){this.height=e.Coords.y(1080);var f=l/p;this.width=n*o*f}g=!0}if(!g&&d>l){this.height=e.Coords.y(1080);var f=l/p;if(this.width=n*o*f,this.width/o>s){this.width=e.Coords.x(1920);var f=s/c;this.height=r*a*f}}this.x=e.Coords.x(1920)/2-this.width/2+this.forceOffsetX,this.y=e.Coords.y(1080)/2-this.height/2+this.forceOffsetY},p.prototype.handleCommand=function(t){switch(t){case"Tab":this.controlFocusManager.currentFocusGroup,this.controlFocusManager.nextFocusGroup();break;case"Right":"ActionButtons"===this.controlFocusManager.currentFocusGroup?this.controlFocusManager.focusNextControl(1):this.controlFocusManager.nextFocusGroup();break;case"Left":"ActionButtons"===this.controlFocusManager.currentFocusGroup?this.controlFocusManager.focusNextControl(-1):this.controlFocusManager.prevFocusGroup();break;case"Up":"ActionButtons"===this.controlFocusManager.currentFocusGroup||"ToggleButton"===this.controlFocusManager.currentFocusGroup?this.controlFocusManager.prevFocusGroup():this.controlFocusManager.focusNextControl(-1);break;case"Down":"ActionButtons"===this.controlFocusManager.currentFocusGroup||"ToggleButton"===this.controlFocusManager.currentFocusGroup?this.controlFocusManager.nextFocusGroup():this.controlFocusManager.focusNextControl(1);break;case"Activate":return void this.controlFocusManager.activateCurrentControl();case"Unfocus":this.controlFocusManager.unfocusCurrentControl()}"DropDownButtons"===this.controlFocusManager.currentFocusGroup?this.dropDownButtonsGroup.visible=!0:this.dropDownButtonsGroup.visible=!1},p.prototype.createOptionButtonUp=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),o.endFill(),r.addChild(o);var a=new t.Graphics;return a.lineStyle(3,i.primaryColor),a.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.7*i.height/2)),a.endFill(),r.addChild(a),r.addChild(n),r.generateTexture()},p.prototype.createOptionButtonOver=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.primaryColor,.5),o.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(this.config.width-2*(this.config.borderSize+this.config.padding)*2),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),o.endFill(),r.addChild(o);var a=new t.Graphics;return a.lineStyle(3,i.primaryColor),a.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.7*i.height/2)),a.endFill(),r.addChild(a),r.addChild(n),r.generateTexture()},p.prototype.createOptionButtonDown=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.primaryColor,.3),o.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(this.config.width-2*(this.config.borderSize+this.config.padding)*2),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),o.endFill(),r.addChild(o);var a=new t.Graphics;return a.lineStyle(3,i.primaryColor),a.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.7*i.height/2)),a.endFill(),r.addChild(a),r.addChild(n),r.generateTexture()},p.prototype.createOptionButtonSelected=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.primaryColor,1),o.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(this.config.width-2*(this.config.borderSize+this.config.padding)*2),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),o.endFill(),r.addChild(o);var a=new t.Graphics;a.lineStyle(3,16777215),a.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.7*i.height/2)),a.endFill(),r.addChild(a);var s=new t.Graphics;return s.beginFill(16777215,1),s.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.5*i.height/2)),s.endFill(),r.addChild(s),r.addChild(n),r.generateTexture()},p.prototype.createOptionButtonDisabled=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),o.endFill(),r.addChild(o);var a=new t.Graphics;a.lineStyle(3,i.primaryColor),a.drawCircle(e.Coords.x(i.height/2),e.Coords.y(i.height/2),e.Coords.y(.7*i.height/2)),a.endFill(),r.addChild(a),r.addChild(n);var s=new t.Graphics;return s.beginFill(0,.5),s.drawRoundedRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height),e.Coords.y((i.height-2)/2)),s.endFill(),r.addChild(s),r.generateTexture()},p.prototype.createDropDownButtonUp=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;return o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o),r.addChild(n),r.generateTexture()},p.prototype.createDropDownButtonOver=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o);var o=new t.Graphics;return o.beginFill(16777215,.2),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o),r.addChild(n),r.generateTexture()},p.prototype.createDropDownButtonDown=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o);var o=new t.Graphics;return o.beginFill(16777215,.1),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o),r.addChild(n),r.generateTexture()},p.prototype.createDropDownButtonSelected=function(i,n){var r=new t.DisplayObjectContainer,o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o);var o=new t.Graphics;return o.beginFill(i.primaryColor,.5),o.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),o.endFill(),r.addChild(o),r.addChild(n),r.generateTexture()},p.prototype.createToggleButtonUp=function(i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(16777215,1),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r);var o=new t.Graphics;return o.beginFill(i.backgroundColor,.8),o.drawRect(e.Coords.x(i.borderSize),e.Coords.y(i.borderSize),e.Coords.x(i.width-2*i.borderSize),e.Coords.y(i.height-2*i.borderSize)),o.endFill(),n.addChild(o),n.generateTexture()},p.prototype.createToggleButtonOver=function(i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(16777215,1),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r);var o=new t.Graphics;return o.beginFill(i.backgroundColor,.5),o.drawRect(e.Coords.x(i.borderSize),e.Coords.y(i.borderSize),e.Coords.x(i.width-2*i.borderSize),e.Coords.y(i.height-2*i.borderSize)),o.endFill(),n.addChild(o),n.generateTexture()},p.prototype.createToggleButtonDown=function(i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(16777215,1),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r);var o=new t.Graphics;return o.beginFill(i.backgroundColor,.3),o.drawRect(e.Coords.x(i.borderSize),e.Coords.y(i.borderSize),e.Coords.x(i.width-2*i.borderSize),e.Coords.y(i.height-2*i.borderSize)),o.endFill(),n.addChild(o),n.generateTexture()},p.prototype.createToggleButtonSelected=function(i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(16777215,1),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r);var o=new t.Graphics;return o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(i.borderSize),e.Coords.y(i.borderSize),e.Coords.x(i.width-2*i.borderSize),e.Coords.y(i.height-2*i.borderSize)),o.endFill(),n.addChild(o),n.generateTexture()},p.prototype.createToggleButtonDisabled=function(i){var n=new t.DisplayObjectContainer,r=new t.Graphics;r.beginFill(16777215,1),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r);var o=new t.Graphics;o.beginFill(i.backgroundColor,1),o.drawRect(e.Coords.x(i.borderSize),e.Coords.y(i.borderSize),e.Coords.x(i.width-2*i.borderSize),e.Coords.y(i.height-2*i.borderSize)),o.endFill(),n.addChild(o);var r=new t.Graphics;return r.beginFill(0,.5),r.drawRect(e.Coords.x(),e.Coords.y(),e.Coords.x(i.width),e.Coords.y(i.height)),r.endFill(),n.addChild(r),n.generateTexture()},p}),define("MenuUI/GameScreenUI",["pixi","absolute","absolute/stringmanager","lodash","MenuUI/MsftIconButton","util/SettingsManager","Solitaire/SolitaireGameMode","util/TipManager","MenuUI/DealWarningModal","MenuUI/ChallengeKickoff","SolitaireShared/CardLogic/IDailyAuthority","CardUI/KeyboardNavigator","absolute/particleemitter","MenuUI/DetailStatsItemModel","Managers/KeyboardManager","MenuUI/ControlFocusManager","Managers/TelemetryManager","Managers/ScaleManager","Managers/AdManager","util/ScaleParams","MenuUI/ChallengeHud","MenuUI/ChallengeStartModal","MenuUI/ChallengeFooter","MenuUI/HowToPlayPopup","Solitaire/MvvmStructure/Service/SolitaireStarClubService","MenuUI/DifficultySelectionModal"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M){var _=function(){this.initGameViewDummy()};_.prototype.initGameViewDummy=function(){this.visible=!0,this.handleActivate=function(){}};var P=function(t,i,r){this.challengeLetterFontSize=24*e.ScreenMetrics.getResScale();var o={letterStyle:{font:45*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},challengeLetterStyle:{font:this.challengeLetterFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"}};this.fullScreenEnabled=e.GameConfig.defaults.config.UI.fullScreenEnabled,this.initGameScreenUI(n.extend(o,t),i,r)};return P.prototype=Object.create(t.DisplayObjectContainer.prototype),P.prototype.initGameScreenUI=function(e,i,n){t.DisplayObjectContainer.call(this),this.config=e,this.ui=i,this.game=n,this.settingsManager=o,this.gameName="Klondike",this.mode="klondike",this.dealsLeft=0,this.isChallenge=!1,this.buttonsHidden=!1,this.anyKeyHandler=null,this.updateHandlers={updateChallengeTime:null,updateChallengeScore:null,updateChallengeMoves:null,updateChallengeStacks:null,updateChallengeCardsPlayed:null,updateChallengeDeals:null,updateChallengeBoards:null},this.controlFocusManager=new f,this.controlGroup=[],this.buildButtons(),this.buildLabels(),this.actionHandlers=this.game.menuBar.getButtonHandler(),this.isRestart=!1,s.init(i,n,this)},P.prototype.handleKeyUp=function(t){if("Ctrl"===this.getCommandFromKeyboardEvent(t))return this.crtlDown=!1,t.preventDefault(),!1},P.prototype.setAnyKeyHandler=function(t){this.anyKeyHandler=t},P.prototype.removeAnyKeyHandler=function(t){this.anyKeyHandler=null},P.prototype.handleCommand=function(t){if(this.wildCardTip)return this.wildCardTip.handleCommand(t);if(this.htp)return this.htp.handleCommand(t);if(s.dialogShowing)return s.tipDialog.handleCommand(t);if(this.warning)return this.warning.handleCommand(t);if(this.challengeStartModal)return this.challengeStartModal.handleCommand(t);if(this.difficultySelectionModal)return this.difficultySelectionModal.handleCommand(t);if(this.game.menuBar.gameOptionsPopup)return this.game.menuBar.gameOptionsPopup.handleCommand(t);var e=!1,i=this.actionHandlers[t];if("function"==typeof i)i(!0),e=!0;else if(this.game.solitaire&&this.game.solitaire.SupplyView&&this.game.solitaire.SupplyView.IsCardDragging)e=!1;else switch(t){case"Undo":this.game.solitaire.Undo(),e=!0;break;case"Statistics":if(this.game.solitaire&&this.game.solitaire.ActiveMode){var n=new p(this.game.solitaire.ActiveMode.Name);this.game.navStatsDetail(n),e=!0}break;case"NewGame":this.game.solitaire.SupplyView&&!this.game.solitaire.SupplyView.CardSupply.CardAnimator.IsShuffleAnimationRunning()&&this.confirmNewDeal(),e=!0;break;case"Draw":this.game.solitaire.SupplyView.GameInputInterpreter.DealNextFromStock(this.game.solitaire.SupplyView),this.game.solitaire.Template.UpdateStockAppearance&&this.game.solitaire.Template.UpdateStockAppearance(this.game.solitaire.SupplyView),e=!0;break;case"Menu":this.game.menuBar.toggleMainSlideOut(),this.game.menuBar.parent.addChild(this.game.menuBar),e=!0;break;case"Back":this.game.menuBar.menuOpen?this.game.menuBar.handleCommand(t):this.isChallenge?this.game.menuBar.showExitWarning(this.game.navBack.bind(this.game)):this.game.navBack(),e=!0;break;case"Up":case"Down":case"Left":case"Right":case"Tab":case"ShiftTab":case"Activate":if(this.game.menuBar.menuOpen)this.game.menuBar.handleCommand(t);else switch(t){case"Tab":this.controlFocusManager.focusNextControl(1);break;case"ShiftTab":this.controlFocusManager.focusNextControl(-1);break;case"Activate":this.controlFocusManager.getCurrentControl()===this.gameViewDummy||null===this.controlFocusManager.getCurrentControl()?this.game.solitaire&&this.game.solitaire.SupplyView&&this.game.solitaire.SupplyView.handleCommand(t):this.controlFocusManager.activateCurrentControl();break;default:this.controlFocusManager.unfocusCurrentControl(),this.game.solitaire&&this.game.solitaire.SupplyView&&this.game.solitaire.SupplyView.handleCommand(t)}this.game.solitaire&&this.game.solitaire.SupplyView&&(this.game.solitaire.SupplyView.Focused=this.controlFocusManager.getCurrentControl()===this.gameViewDummy||null===this.controlFocusManager.getCurrentControl()),e=!0}return!e&&void 0},P.prototype.triggerNewDeal=function(){const t=this.game.solitaire.Authority.CardSupply.GameName;if(!this.settingsManager.getSetting(this.gameName.toLowerCase(),"showDifficulty")||"Klondike"!==t&&"Spider"!==t&&"FreeCell"!==t)this.game.solitaire.DealNewGame();else{var i={gameName:t,gameNameText:e.StringManager("tiles."+t.toLowerCase()),modalDescription:e.StringManager("solvable.chooseGame"),modalDisclaimer:"*"+e.StringManager("solvable.randomDeckUnsolvable"),toggleButtonSize:25,ribbonHeight:55,buttons:this.getGameSpecificDifficultyButtons(t),gameModes:this.getGameSpecificGameModeButtons(t),buttonHeight:45,buttonSpacing:10,isCompleted:!1,borderSize:4,borderColor:16777215,backgroundColor:867447,width:600,height:850,offsetX:0,offsetY:0,padding:25};this.difficultySelectionModal=new M(this.ui.currentScreen,this.game,i,null,!1)}},P.prototype.getGameSpecificDifficultyButtons=function(t){return"klondike"===t.toLowerCase()?[{name:e.StringManager("buttons.easy"),value:"EASY"},{name:e.StringManager("buttons.medium"),value:"MEDIUM"},{name:e.StringManager("buttons.hard"),value:"HARD"},{name:e.StringManager("buttons.expert"),value:"EXPERT"},{name:e.StringManager("buttons.master"),value:"MASTER"},{name:e.StringManager("buttons.grandmaster"),value:"GRANDMASTER"},{name:e.StringManager("buttons.random"),value:"RANDOM"}]:"spider"===t.toLowerCase()?[{name:e.StringManager("buttons.easy"),value:"EASY"},{name:e.StringManager("buttons.medium"),value:"MEDIUM"},{name:e.StringManager("buttons.hard"),value:"HARD"},{name:e.StringManager("buttons.expert"),value:"EXPERT"},{name:e.StringManager("buttons.master"),value:"MASTER"},{name:e.StringManager("buttons.grandmaster"),value:"GRANDMASTER"},{name:e.StringManager("buttons.random"),value:"RANDOM"}]:"freecell"===t.toLowerCase()?[{name:e.StringManager("buttons.easy"),value:"EASY"},{name:e.StringManager("buttons.medium"),value:"MEDIUM"},{name:e.StringManager("buttons.hard"),value:"HARD"},{name:e.StringManager("buttons.expert"),value:"EXPERT"},{name:e.StringManager("buttons.random"),value:"RANDOM"}]:"pyramid"===t.toLowerCase()?[]:(t.toLowerCase(),[])},P.prototype.getGameSpecificGameModeButtons=function(t){return"klondike"===t.toLowerCase()?[{name:e.StringManager("buttons.standard")+" ("+e.StringManager("buttons.draw1")+")",scoringType:"STANDARD",cardsPerDraw:"1",disables:[]},{name:e.StringManager("buttons.standard")+" ("+e.StringManager("buttons.draw3")+")",scoringType:"STANDARD",cardsPerDraw:"3",disables:["EASY"]},{name:e.StringManager("buttons.lasVegas")+" ("+e.StringManager("buttons.draw1")+")",scoringType:"LASVEGAS",cardsPerDraw:"1",disables:["EASY"]},{name:e.StringManager("buttons.lasVegas")+" ("+e.StringManager("buttons.draw3")+")",scoringType:"LASVEGAS",cardsPerDraw:"3",disables:["EASY"]},{name:e.StringManager("buttons.cumulativeVegas")+" ("+e.StringManager("buttons.draw1")+")",scoringType:"LASVEGASCUMULATIVE",cardsPerDraw:"1",disables:["EASY"]},{name:e.StringManager("buttons.cumulativeVegas")+" ("+e.StringManager("buttons.draw3")+")",scoringType:"LASVEGASCUMULATIVE",cardsPerDraw:"3",disables:["EASY"]}]:"spider"===t.toLowerCase()?[{name:e.StringManager("buttons.suits1"),suits:"1",disables:["GRANDMASTER"]},{name:e.StringManager("buttons.suits2"),suits:"2",disables:["EASY","MEDIUM"]},{name:e.StringManager("buttons.suits4"),suits:"4",disables:["EASY","MEDIUM","HARD"]}]:"freecell"===t.toLowerCase()?[]:"pyramid"===t.toLowerCase()?[]:(t.toLowerCase(),[])},P.prototype.confirmNewDeal=function(){this.game.solitaire.Authority.CardSupply.HasMovedCards?this.warning=new l(this.ui.currentScreen,"dialogs.warningHeadline","dialogs.newDealContent",function(){this.game.boostType="no",y.classicGameComplete("Abandoned",this.game.solitaire.Authority.CardSupply.GameName,Math.floor(this.game.solitaire.Authority.CardSupply.PreciseTimePlayed),this.game.solitaire.ScoringOption,this.game.solitaire.DrawOption,this.game.solitaire.SuitsOption),this.triggerNewDeal(),this.warning.close()}.bind(this),function(){this.warning.close()}.bind(this)):(this.game.boostType="no",this.triggerNewDeal())},P.prototype.buildButtons=function(){for(var t=0;t<this.game.menuBar.controlGroup.length;t++)this.controlGroup.push(this.game.menuBar.controlGroup[t]);this.newDealButton=new r({text:i("buttons.newDeal"),icon:"Buttons/Deal/Deal.png",iconDown:"Buttons/Deal/Deal_inv.png",width:e.Coords.x(120),height:e.Coords.y(64),maxWidth:100*e.ScreenMetrics.getResScale(),action:function(){this.game.solitaire.SupplyView&&!this.game.solitaire.SupplyView.CardSupply.CardAnimator.IsShuffleAnimationRunning()&&this.confirmNewDeal()}.bind(this)}),this.controlGroup.push(this.newDealButton,!0),this.settingsButton=new r({text:i("buttons.options"),icon:"icon_settings.png",iconDown:"icon_settings.png",width:e.Coords.x(120),height:e.Coords.y(64),iconY:-8,textY:e.Coords.y(38),maxWidth:100*e.ScreenMetrics.getResScale(),action:function(){this.game.menuBar.openGameOptions(!1),handled=!0}.bind(this)}),this.controlGroup.push(this.settingsButton,!0),this.hintButton=new r({text:i("buttons.hint"),icon:"Buttons/hint.png",iconDown:"Buttons/hint.png",width:e.Coords.x(120),height:e.Coords.y(64),iconY:-5,textY:e.Coords.y(38),maxWidth:100*e.ScreenMetrics.getResScale(),action:function(){this.game.solitaire.Hint(),handled=!0}.bind(this)}),this.controlGroup.push(this.hintButton,!0),this.tryAgainButton=new r({text:i("buttons.tryAgain"),icon:"Buttons/tryagain/tryagain.png",iconDown:"Buttons/tryagain/tryagain_inv.png",width:e.Coords.x(120),height:e.Coords.y(64),textY:e.Coords.y(38),maxWidth:100*e.ScreenMetrics.getResScale(),action:function(){this.warning=new l(this.ui.currentScreen,"dialogs.warningHeadline","dialogs.challengeExitWarning",function(){var t=this.game.solitaire.ActiveMode.Name,e=this.game.solitaire.CurrentChallenge,i=e.GetModeName(),n=Math.floor(this.game.solitaire.Authority.CardSupply.PreciseTimePlayed),r=e.config.Difficulty;if(e.config.Date){var o=e.config.Date.substring(6,19),a=new Date(parseInt(o)),s=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();y.challengeComplete("Abandoned",i,n,s,r),this.isRestart=!0}else{var l=T.currentCollection.Name,h=T.currentPack.Name;y.starClubComplete("Abandoned",n,i,r,l,h)}this.game.solitaire.StopGame(!1),this.game.startGame(t,e),this.warning.close()}.bind(this),function(){this.warning.close()}.bind(this))}.bind(this)}),this.controlGroup.push(this.tryAgainButton,!0),this.undoButton=new r({text:i("buttons.undo"),icon:"Buttons/Undo/undo.png",iconDown:"Buttons/Undo/undo_inv.png",width:e.Coords.x(120),height:e.Coords.y(64),maxWidth:115*e.ScreenMetrics.getResScale(),action:function(){this.game.solitaire.Undo()}.bind(this)}),this.controlGroup.push(this.undoButton,!0),this.undoBoardButton=new r({text:i("buttons.undoBoard"),icon:"Buttons/Undo/undo.png",iconDown:"Buttons/Undo/undo_inv.png",width:e.Coords.x(120),height:e.Coords.y(64),maxWidth:115*e.ScreenMetrics.getResScale(),action:function(){if(!this.settingsManager.getSetting("general","showUndoBoardAlert")){this.game.solitaire.Undo(!0);var t=this.game.solitaire.Authority;return void(t._chainNumber&&(t.CardsChained=0,t._chainNumber=0))}this.warning=new l(this.ui.currentScreen,"dialogs.boardUndoWarningHeadline","dialogs.boardUndoWarning",function(){this.game.solitaire.Undo(!0);var t=this.game.solitaire.Authority;t._chainNumber&&(t.CardsChained=0,t._chainNumber=0),this.warning.close()}.bind(this),function(){this.warning.close()}.bind(this))}.bind(this)}),this.controlGroup.push(this.undoBoardButton,!0),this.solveButton=new r({text:i("buttons.solve"),icon:"Buttons/Solve/autosolve.png",iconDown:"Buttons/Solve/autosolve_inv.png",width:e.Coords.x(155),height:e.Coords.y(82),textY:e.Coords.y(41),letterStyle:{font:28*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"},action:function(){this.hideButtons(),this.game.solitaire.AutoSolve()}.bind(this)}),this.controlGroup.push(this.solveButton,!0);var n="1"===o.getSetting("pyramid","layoutDirection")?"left":"right";this.drawButton=new r({text:e.Platform.isMobile()?"":i("buttons.draw"),textY:e.Coords.y(39),icon:"btn_pyramid_draw_"+n+".png",iconDown:"btn_pyramid_draw_inv_"+n+".png",iconY:e.Platform.isMobile()?e.Coords.y(10):e.Coords.y(0),width:e.Coords.x(76),height:e.Coords.y(69),action:function(){this.game.solitaire.SupplyView.ClearHints(),this.game.solitaire.SupplyView.GameInputInterpreter.HighlightedCard=null,this.game.solitaire.SupplyView.GameInputInterpreter.DealNextFromStock(this.game.solitaire.SupplyView),this.game.solitaire.Template.UpdateStockAppearance(this.game.solitaire.SupplyView)}.bind(this)}),this.controlGroup.push(this.drawButton,!0),this.dealButton=new r({text:i("buttons.deal"),fontSize:25,width:e.Coords.x(76),height:e.Coords.y(69),maxWidth:60*e.ScreenMetrics.getResScale(),textY:e.Coords.y(38),action:function(){this.game.solitaire.Authority.Deal()}.bind(this)}),this.controlGroup.push(this.dealButton,!0),this.challengeModeButtonY=e.Coords.y(935),this.classicModeButtonY=e.Coords.y(1004),this.klondikeSolveButtonY=e.Coords.y(-376),this.newDealButton.x=this.tryAgainButton.x=e.Coords.x(14),this.newDealButton.y=this.tryAgainButton.y=this.classicModeButtonY,this.tryAgainButton.visible=!1,this.undoButton.x=e.Coords.x(1785),this.undoButton.y=this.classicModeButtonY,this.undoBoardButton.x=e.Coords.x(1630),this.undoBoardButton.y=this.classicModeButtonY,this.solveButton.visible=!1,this.solveButton.x=e.Coords.x(550),this.solveButton.y=this.klondikeSolveButtonY,this.drawButton.visible=!1,this.drawButton.x=e.Coords.x(-37),this.drawButton.y=e.Coords.y(300),this.dealButton.visible=!1,this.dealButton.x=e.Coords.x(-37),this.dealButton.y=e.Coords.y(380),this.settingsButton.visible=!1,this.settingsButton.y=this.newDealButton.y,this.settingsButton.x=e.Coords.x(520),this.hintButton.visible=!1,this.hintButton.y=this.newDealButton.y,this.hintButton.x=e.Coords.x(1030),this.addChild(this.newDealButton),this.addChild(this.tryAgainButton),this.addChild(this.undoButton),this.addChild(this.undoBoardButton),this.addChild(this.settingsButton),this.addChild(this.hintButton),this.settingsButtonWidth=this.settingsButton.width,this.settingsButtonHeight=this.settingsButton.height,this.hintButtonWidth=this.hintButton.width,this.hintButtonHeight=this.hintButton.height,this.newDealButtonWidth=this.newDealButton.width,this.newDealButtonHeight=this.newDealButton.height,this.tryAgainButtonWidth=this.tryAgainButton.width,this.tryAgainButtonHeight=this.tryAgainButton.height,this.undoButtonWidth=this.undoButton.width,this.undoButtonHeight=this.undoButton.height,this.undoBoardButtonWidth=this.undoBoardButton.width,this.undoBoardButtonHeight=this.undoBoardButton.height,this.gameViewDummy=new _,this.controlGroup.push(this.gameViewDummy);for(var t=0;t<this.controlGroup.length;t++)this.controlFocusManager.addControl(this.controlGroup[t],this.controlGroup[t].visible)},P.prototype.updateUndoButtonsState=function(t){t?(this.undoButton.alpha=1,this.undoButton.interactive=!0,this.undoBoardButton.alpha=1,this.undoBoardButton.interactive=!0):(this.undoButton.alpha=.5,this.undoButton.interactive=!1,this.undoBoardButton.alpha=.5,this.undoBoardButton.interactive=!1)},P.prototype.updateControlFocus=function(){for(var t=0;t<this.controlGroup.length;t++)this.controlFocusManager.setControlActive(this.controlGroup[t],this.controlGroup[t].visible)},P.prototype.hideButtons=function(){this.buttonsHidden=!0,this.newDealButton.visible=!1,this.undoButton.visible=!1,this.undoBoardButton.visible=!1,this.solveButton.visible=!1,this.drawButton.visible=!1,this.dealButton.visible=!1,this.dealCountLabel.visible=!1,this.settingsButton.visible=!1,this.hintButton.visible=!1,this.updateControlFocus()},P.prototype.showButtons=function(){this.buttonsHidden=!1,this.newDealButton.visible=!0,this.undoButton.visible=!0,this.undoBoardButton.visible=this.canShowUndoBoard(),this.solveButton.visible=!0,this.drawButton.visible=!0,this.dealButton.visible=!0,this.dealCountLabel.visible=!0,e.Platform.isMobile()&&(this.settingsButton.visible=!0,this.hintButton.visible=!0),this.updateControlFocus()},P.prototype.canShowUndoBoard=function(){return 2===this.game.solitaire.ActiveMode.Name||3===this.game.solitaire.ActiveMode.Name},P.prototype.buildLabels=function(){var n=28*e.ScreenMetrics.getResScale(),r={font:n+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"left"};this.supplyBackground=new t.Graphics,e.Platform.isMobile()?(n=22*e.ScreenMetrics.getResScale(),r.font=n+"px Segoe UI",S.gameScreenUI.dealLabelFontSize=45*e.ScreenMetrics.getResScale(),this.supplyBackground.beginFill(1,.3),this.supplyBackground.drawRoundedRect(0,0,e.Coords.x(691),e.Coords.y(272),e.Coords.x(20)),this.supplyBackground.endFill(),this.supplyBackground.visible=!1,this.supplyBackground.x=e.Coords.x(-350),this.supplyBackground.y=e.Coords.y(783)):(this.supplyBackground.beginFill(1,.3),this.supplyBackground.drawRoundedRect(0,0,e.Coords.x(491),e.Coords.y(272),e.Coords.x(20)),this.supplyBackground.endFill(),this.supplyBackground.visible=!1,this.supplyBackground.x=e.Coords.x(-250),this.supplyBackground.y=e.Coords.y(783));var o=S.gameScreenUI;this.labelContainer=new t.DisplayObjectContainer,this.gameIcon=t.Sprite.fromFrame("icon_"+this.mode+"_topUI.png"),this.gameIcon.x=this.game.menuBar.backButton.x+e.Coords.x(5),this.game.menuBar.backButton.visible&&(this.gameIcon.x+=this.game.menuBar.backButton.width),this.gameIconWidth=this.gameIcon.width,this.gameIconHeight=this.gameIcon.height,this.gameLabel=new t.Text(this.gameName,r),this.gameLabel.x=this.gameIcon.x+this.gameIcon.width+e.Coords.x(o.gameLabel.offsetX)/m.scaleFactorX,this.gameLabel.updateText(),this.gameLabelWidth=100,this.gameLabelHeight=this.gameLabel.height,this.difficultyText=new t.Text("",r),i.shrinkToFit(this.difficultyText,n,"",0),this.scoreLabel=new t.Text(i("titles.score"),r),this.scoreLabelWidth=this.scoreLabel.width,this.scoreLabelHeight=this.scoreLabel.height,this.score=new t.Text(i("0"),r),this.scoreWidth=this.score.width,this.scoreHeight=this.score.height,this.timeLabel=new t.Text(i("titles.time"),r),this.timeLabelWidth=this.timeLabel.width,this.timeLabelHeight=this.timeLabel.height,this.time=new t.Text(i("0:00"),r),this.timeWidth=this.time.width,this.timeHeight=this.time.height,this.boardsCompleteLabel=new t.Text(i("titles.boardsComplete"),r),this.boardsCompleteLabelWidth=this.boardsCompleteLabel.width,this.boardsCompleteLabelHeight=this.boardsCompleteLabel.height,this.boardsComplete=new t.Text(i("0"),r),this.boardsCompleteWidth=this.boardsComplete.width,this.boardsCompleteHeight=this.boardsComplete.height,this.boardsCompleteLabel.y=this.boardsComplete.y=this.timeLabel.y=this.time.y=this.scoreLabel.y=this.score.y=e.Coords.y(o.labelsY*m.scaleFactorY),this.boardsCompleteLabel.x=this.timeLabel.x=this.score.x+this.score.width+e.Coords.x(o.timeLabelX),this.time.x=e.Coords.x(o.timeX),this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(o.boardsCompleteOffsetX),this.dealLabel=new t.Text(this.dealsLeft.toString()+" "+i("titles.dealsLeft"),{font:e.ScreenMetrics.getResScale()*o.dealLabelFontSize+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center"}),this.dealLabel.anchor.set(.5,.5),this.dealLabel.visible=!1,this.dealCountLabel=new t.Text("0",{font:50*e.ScreenMetrics.getResScale()+"px Segoe UI",fontFamily:"segoe",fill:"#ffffff",align:"center"}),this.dealCountLabel.anchor.set(.5,0),this.dealCountLabel.visible=!1,this.dealCountLabel.x=e.Coords.x(0),this.dealCountLabel.y=e.Coords.y(430),this.gameNumberLabel=new t.Text(i("titles.gameNumber"),r),this.gameNumberLabelWidth=this.gameNumberLabel.width,this.gameNumberLabelHeight=this.gameNumberLabel.height,this.gameNumber=new t.Text("",r),this.gameNumber.updateText(),this.gameNumberHeight=this.gameNumber.height,this.gameNumberWidth=this.gameNumber.width,this.gameNumberLabel.x=e.Coords.x(o.gameNumberLabel.x),this.gameNumber.x=e.Coords.x(1750),this.gameNumber.y=this.gameNumberLabel.y=e.Coords.y(o.gameNumber.y),this.labelContainer.addChild(this.difficultyText),this.labelContainer.addChild(this.gameLabel),this.labelContainer.addChild(this.gameIcon),this.labelContainer.addChild(this.scoreLabel),this.labelContainer.addChild(this.score),this.labelContainer.addChild(this.timeLabel),
this.labelContainer.addChild(this.time),this.labelContainer.addChild(this.boardsCompleteLabel),this.labelContainer.addChild(this.boardsComplete),this.labelContainer.addChild(this.gameNumberLabel),this.labelContainer.addChild(this.gameNumber)},P.prototype.updateLayout=function(){if(this.game.menuBar.resetTopBar(!0),this.newDealButton.visible=!this.isChallenge,this.tryAgainButton.visible=this.isChallenge,this.solveButton.y=this.klondikeSolveButtonY,this.timeLabel.visible=this.time.visible=this.showTimer,this.scoreLabel.visible=this.score.visible=this.showScore,this.boardsCompleteLabel.visible=this.boardsComplete.visible=this.showBoardsComplete,this.gameNumberLabel.visible=this.gameNumber.visible=this.showGameNumber||!1,this.gameLabel.setText(i(this.gameName)),this.gameLabel.updateText(),this.gameLabelWidth=this.gameLabel._width,this.gameLabelHeight=this.gameLabel._height,this.gameIcon.setTexture(new t.Texture.fromFrame("icon_"+this.mode+"_topUI.png")),this.gameIcon.x=this.game.menuBar.backButton.x+e.Coords.x(5),this.game.menuBar.backButton.visible&&(this.gameIcon.x+=this.game.menuBar.backButton.width),this.gameLabel.x=this.gameIcon.x+this.gameIcon.width+e.Coords.x(5)*this.xScale,e.Platform.isMobile()){var r=0;e.ScreenMetrics.isPortrait()&&(r=e.Coords.x(400)),this.timeLabel.x=this.width-e.Coords.x(400+r)*this.xScale,this.time.x=this.timeLabel.x+this.timeLabel.width+e.Coords.x(25),this.showScore&&!this.showTimer&&this.showBoardsComplete?(this.scoreLabel.x=e.Coords.x(1350)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale,this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(550),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale),this.boardsCompleteLabel.x=this.score.x+this.score.width+e.Coords.x(200),this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(30)*this.xScale):this.showScore&&this.showTimer&&this.showBoardsComplete?(this.scoreLabel.x=e.Coords.x(600)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25),this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(650),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale),this.boardsCompleteLabel.x=this.score.x+this.score.width+e.Coords.x(250)*this.resizeScale,this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(30)*this.xScale):this.showTimer||this.showBoardsComplete?(this.scoreLabel.x=e.Coords.x(1350)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25),this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(650),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale)):(this.scoreLabel.x=e.Coords.x(1350)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale)}else if(this.showScore||!this.showTimer||this.showBoardsComplete)if(this.showScore&&!this.showTimer&&this.showBoardsComplete)this.scoreLabel.x=e.Coords.x(830)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale,this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(550),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale),this.boardsCompleteLabel.x=this.score.x+this.score.width+e.Coords.x(200),this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(30)*this.xScale;else if(this.showScore&&this.showTimer&&this.showBoardsComplete)this.scoreLabel.x=e.Coords.x(600)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25),this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(550),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale),this.boardsCompleteLabel.x=this.score.x+this.score.width+e.Coords.x(250)*this.resizeScale,this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(30)*this.xScale,this.timeLabel.x=this.boardsComplete.x+e.Coords.x(this.boardsComplete.width)+e.Coords.x(110)*this.xScale,this.time.x=this.timeLabel.x+this.timeLabel.width+e.Coords.x(25);else if(this.showTimer||this.showBoardsComplete){this.scoreLabel.x=e.Coords.x(830)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25),this.scoreLabel.x<=e.Coords.x(550)&&(this.scoreLabel.x=e.Coords.x(550),this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale);var r=e.Coords.x(S.gameScreenUI.timeLabelX);m.width<=700&&(r-=e.Coords.x(150)),this.timeLabel.x=this.score.x+this.score.width+r/this.xScale,this.time.x=this.timeLabel.x+this.timeLabel.width+e.Coords.x(25)}else this.scoreLabel.x=e.Coords.x(871)*this.xScale,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale;else this.timeLabel.x=e.Coords.x(820)*this.xScale,this.time.x=this.timeLabel.x+this.timeLabel.width+e.Coords.x(25)*this.xScale;this.showGameNumber&&this.game.solitaire.Authority.CardSupply.DeckSeed&&(this.gameNumber.setText(this.game.solitaire.Authority.CardSupply.DeckSeed.substring(1)),this.gameNumber.updateText(),this.gameNumberWidth=this.gameNumber._width,this.gameNumberHeight=this.gameNumber._height,e.Platform.isMobile()?this.gameNumberLabel.x=this.scoreLabel.x:this.gameNumberLabel.x=this.time.x+this.time.width+e.Coords.x(250),this.gameNumber.x=this.gameNumberLabel.x+this.gameNumberLabel.width+e.Coords.x(9),this.fullScreenEnabled&&(this.gameNumber.x-=e.Coords.x(100)*this.xScale,this.gameNumberLabel.x-=e.Coords.x(100)*this.xScale));var a=this.isChallenge?this.game.solitaire.CurrentChallenge.DifficultyName:this.game.solitaire.Authority.CardSupply.Options.DIFFICULTY;if(a=a?e.StringManager("buttons."+a.toLowerCase()):"",this.difficultyText.text=i(a),this.difficultyText.updateText(),this.difficultyText.x=this.gameLabel.x+this.gameLabel.width+e.Coords.x(20),this.scoreLabel.x+=e.Coords.x(70),this.score.x+=e.Coords.x(70),this.timeLabel.x+=e.Coords.x(70),this.time.x+=e.Coords.x(70),this.gameNumber.x-=e.Coords.x(70),this.gameNumberLabel.x-=e.Coords.x(70),this.game.solitaire.SupplyView.addChild(this.solveButton),this.solveButton.destroy=function(){this.parent=null},this.solveButton.x=e.Coords.x(-400),this.solveButton.y=this.klondikeSolveButtonY,"spider"===this.mode&&(this.settingsManager.getSetting(this.gameName.toLowerCase(),"showDifficulty"),this.game.solitaire.updateSetting("layoutDirection",this.settingsManager.getSetting("spider","layoutDirection"))),this.supplyBackground.y=e.Coords.y(250),this.dealButton.y=e.Coords.y(380),this.dealCountLabel.y=e.Coords.y(385),this.drawButton.y=e.Coords.y(300),this.dealLabel.x=e.Coords.x(0),this.dealLabel.y=e.Coords.x(500),"pyramid"===this.mode||"tripeaks"===this.mode){e.Platform.isMobile()&&(this.drawButton.scale.set(1.5),this.drawButton.x=e.Coords.x(-55),this.drawButton.y=e.Coords.y(275),this.dealButton.scale.set(1.5),this.dealButton.x=this.drawButton.x,this.dealButton.y=this.drawButton.y+e.Coords.y(125),this.dealCountLabel.y=this.dealButton.y+e.Coords.y(5)),this.supplyBackground.visible=!0,this.dealButton.visible=!0,this.dealCountLabel.visible=!0,this.game.solitaire.SupplyView.addChild(this.dealButton),this.game.solitaire.SupplyView.addChild(this.dealCountLabel),this.game.solitaire.SupplyView.addChildAt(this.supplyBackground,0),this.game.solitaire.SupplyView.addChild(this.dealLabel),this.dealLabel.destroy=function(){this.parent=null},this.drawButton.destroy=function(){this.parent=null},this.dealButton.destroy=function(){this.parent=null},this.dealCountLabel.destroy=function(){this.parent=null};var s=e.Coords.x(51);"pyramid"===this.mode?(this.drawButton.visible=!0,this.game.solitaire.SupplyView.addChild(this.drawButton)):"tripeaks"===this.mode&&(this.drawButton.visible=!1),this.isChallenge&&(this.drawButton.y-=s,this.supplyBackground.y-=s,this.dealLabel.y-=s,this.dealButton.y-=s,this.dealCountLabel.y-=s)}else this.supplyBackground.visible=!1,this.drawButton.visible=!1,this.dealButton.visible=!1,this.dealCountLabel.visible=!1;if(this.challengeHud&&!this.alreadyShown&&this.isChallenge&&(this.labelContainer.removeChild(this.challengeHud),this.updateHandlers={updateChallengeTime:null,updateChallengeScore:null,updateChallengeMoves:null,updateChallengeStacks:null,updateChallengeCardsPlayed:null,updateChallengeDeals:null,updateChallengeBoards:null}),this.isChallenge||(this.gameLabel.x+this.gameLabel.width>=this.scoreLabel.x||this.gameLabel.x+this.gameLabel.width>=this.timeLabel.x&&this.showTimer?this.gameLabel.visible=!1:this.gameLabel.visible=!0,this.gameIcon.x+this.gameIcon.width>=this.scoreLabel.x||this.gameIcon.x+this.gameIcon.width>=this.timeLabel.x&&this.showTimer?this.gameIcon.visible=!1:this.gameIcon.visible=!0,this.difficultyText&&(this.difficultyText.x+this.difficultyText.width>=this.scoreLabel.x||this.difficultyText.x+this.difficultyText.width>=this.timeLabel.x&&this.showTimer?this.difficultyText.visible=!1:this.difficultyText.visible=!0)),this.isChallenge&&!this.alreadyShown){if(this.solveButton.y=this.klondikeSolveButtonY,this.isChallenge&&!this.challengeFooter){var l={gameName:this.game.solitaire.CurrentChallenge.GetModeName(),gameDescription:this.game.solitaire.CurrentChallenge.GetGoalDescription(),difficultyName:this.game.solitaire.CurrentChallenge.DifficultyName,rewardAmount:this.isStarClub?this.game.solitaire.CurrentChallenge.Difficulty.toString():this.game.solitaire.CurrentChallenge.Coins.toString(),rewardType:this.isStarClub?"kickoff.stars":"kickoff.coins",rewardIcon:this.isStarClub?"kickoff_star.png":"DC_kickoff_coin.png",isCompleted:this.game.solitaire.CurrentChallenge.Completed};this.challengeFooter=new w(this.ui.currentScreen,this.game,l),this.challengeStartModal=new v(this.ui.currentScreen,this.game,l,this.challengeFooter,this.isRestart),this.isRestart=!1}this.mapNumberToCard={two:"Card_Twos",2:"Card_Twos",three:"Card_Threes",3:"Card_Threes",four:"Card_Fours",4:"Card_Fours",five:"Card_Fives",5:"Card_Fives",six:"Card_Sixes",6:"Card_Sixes",seven:"Card_Sevens",7:"Card_Sevens",eight:"Card_Eights",8:"Card_Eights",nine:"Card_Nines",9:"Card_Nines",ten:"Card_Tens",10:"Card_Tens",jack:"Card_Jacks",J:"Card_Jacks",queen:"Card_Queens",Q:"Card_Queens",king:"Card_Kings",K:"Card_Kings",ace:"Card_Aces",A:"Card_Aces"};var h=this.getGoalTypeKey(this.game.solitaire.CurrentChallenge.ChallengeType),u=parseInt(this.game.solitaire.CurrentChallenge.config.Data.CHDEF_AllowedMoves)>0,d=(("tripeaks"===this.mode||"pyramid"===this.mode)&&parseInt(this.game.solitaire.CurrentChallenge.config.Data.PARAM_MAXDEALS),parseInt(this.game.solitaire.CurrentChallenge.config.Data.CHDEF_AllowedTime)>0),c=0,p=[];switch(u&&(c++,p.push({labelString:"titles.moves",handler:"updateChallengeMoves"})),d&&(c++,p.push({labelString:"titles.time",startingValue:this.formatTime(this.game.solitaire.Authority.StartingTime),handler:"updateChallengeTime"})),h){case"AchieveScore":c++,p.push({labelString:"titles.score",handler:"updateChallengeScore"});break;case"SolveGame":case"PlayCard":u||d||(c++,p.push({labelString:"titles.time",handler:"updateChallengeTime"}));break;case"PlayValues":c++;var g=this.game.solitaire.CurrentChallenge.config.Data.PARAM_VALUETOPLAY;p.push({labelString:this.mapNumberToCard[g.toLowerCase()],handler:"updateChallengeCardsPlayed"});break;case"BuildStacks":c++,p.push({labelString:"titles.stacks",handler:"updateChallengeStacks"});break;case"ClearBoards":c++,p.push({labelString:"titles.boards",handler:"updateChallengeBoards"});break;default:throw"error: challenge/goal type not supported"}if(c>3)throw"Error: You should never have more than three hud items.";this.challengeHud=new b(c),this.challengeDataOriginalX={},n.each(p,function(r,o){var a=new t.Text(i(r.labelString),n.extend({},this.config.challengeLetterStyle)),s=new t.Text(r.startingValue||"0",n.extend({},this.config.challengeLetterStyle));i.shrinkToFit(a,this.challengeLetterFontSize,"",e.Coords.x(75)),this.challengeHud.setLabel(a,o),this.challengeHud.setData(s,o),this.challengeDataOriginalX[r.labelString]=s.x+s.width/2,this.updateHandlers[r.handler]=s},this),this.challengeHud.x=e.Coords.x(this.ui.width-this.challengeHud.width);var f=this.game.menuBar.backButton;this.challengeHud.y=f.y+(f.height-this.challengeHud.height)/2,this.labelContainer.addChild(this.challengeHud)}var y=(this.xScale,this.yScale,e.Coords.y(S.gameScreenUI.labelsY)/m.scaleFactorY);if(this.updateControlFocus(),this.difficultyText&&(this.difficultyText.y=y,this.difficultyText.x=this.gameLabel.x+this.gameLabel.width+e.Coords.x(20)/m.scaleFactorX,this.isChallenge&&(this.difficultyText.visible=this.difficultyText.x+this.difficultyText.width+e.Coords.x(10)<=this.challengeHud.x)),this.gameIcon.y=S.gameScreenUI.icon.y*this.resizeScale,this.isChallenge&&this.challengeHud&&(this.gameLabel.x+this.gameLabel.width>=this.challengeHud.x?this.gameLabel.visible=!1:this.gameLabel.visible=!0,this.gameIcon.x+this.gameIcon.width>=this.challengeHud.x?this.gameIcon.visible=!1:this.gameIcon.visible=!0),this.gameLabel.y=e.Coords.y(S.gameScreenUI.gameLabel.y)*this.resizeScale/m.scaleFactorY,this.difficultyText&&(this.difficultyText.y=this.gameLabel.y),this.gameNumberLabel.y=this.gameNumber.y=this.boardsCompleteLabel.y=this.boardsComplete.y=this.timeLabel.y=this.time.y=this.scoreLabel.y=this.score.y=e.Coords.y(S.gameScreenUI.labelsY)*this.resizeScale/m.scaleFactorY,e.Platform.isMobile())if(this.settingsButton.visible=!0,this.hintButton.visible=!this.isChallenge,e.ScreenMetrics.isPortrait()&&m.width<450){if(this.difficultyText.visible=this.gameLabel.visible=!0,this.gameLabel.y=e.Coords.y(S.gameScreenUI.gameLabel.y-10)*this.resizeScale/m.scaleFactorY,this.difficultyText.x=this.gameLabel.x,this.difficultyText.y=e.Coords.y(S.gameScreenUI.gameLabel.y+15)*this.resizeScale/m.scaleFactorY,this.scoreLabel.x=this.timeLabel.x,this.scoreLabel.y=this.score.y=this.gameLabel.y,this.score.x=this.scoreLabel.x+this.scoreLabel.width+e.Coords.x(25)*this.xScale,this.timeLabel.y=e.Coords.y(S.gameScreenUI.gameLabel.y+15)*this.resizeScale/m.scaleFactorY,this.time.x=this.timeLabel.x+this.timeLabel.width+e.Coords.x(25),this.time.y=this.timeLabel.y,this.gameNumberLabel.visible=!1,this.gameNumber.y=this.gameLabel.y,this.gameNumber.x=this.timeLabel.x,"freecell"===this.mode&&this.game.solitaire.Authority.CardSupply.DeckSeed&&(this.gameNumber.setText("#"+this.game.solitaire.Authority.CardSupply.DeckSeed.substring(1)),this.gameNumber.updateText()),this.boardsCompleteLabel.x=this.gameLabel.x,this.boardsCompleteLabel.y=e.Coords.y(S.gameScreenUI.gameLabel.y+18)*this.resizeScale/m.scaleFactorY,this.boardsComplete.x=this.boardsCompleteLabel.x+this.boardsCompleteLabel.width+e.Coords.x(30)*this.xScale,this.boardsComplete.y=this.boardsCompleteLabel.y,this.newDealButton.x=e.Coords.x(25),this.settingsButton.x=e.Coords.x(500),this.hintButton.x=e.Coords.x(975),this.undoButton.x=e.Coords.x(1450),"pyramid"===this.mode||"tripeaks"===this.mode){if(this.undoBoardButton.x=this.undoButton.x,this.undoBoardButton.y=this.newDealButton.y-1.5*this.newDealButton.height,this.dealLabel.y=e.Coords.y(475),"tripeaks"===this.mode){this.dealLabel.y=e.Coords.x(465);var C="1"===o.getSetting("tripeaks","layoutDirection");this.dealLabel.x=C?e.Coords.x(200):e.Coords.x(-200),this.dealButton.x=this.dealLabel.x+e.Coords.x(-50),this.dealButton.y=this.dealLabel.y+e.Coords.y(-135)}this.dealCountLabel.y=this.dealButton.y+e.Coords.y(5),this.dealCountLabel.x=this.dealButton.x+e.Coords.x(55),this.isChallenge&&(this.undoBoardButton.x=this.hintButton.x,this.undoBoardButton.y=this.hintButton.y,this.dealLabel.y-=s)}}else if("pyramid"===this.mode||"tripeaks"===this.mode){if(this.dealLabel.y=e.Coords.y(465),"tripeaks"===this.mode){this.dealLabel.y=e.Coords.y(475);var C="1"===o.getSetting("tripeaks","layoutDirection");this.dealLabel.x=C?e.Coords.x(200):e.Coords.x(-200),this.dealButton.x=this.dealLabel.x+e.Coords.x(-50),this.dealButton.y=this.dealLabel.y+e.Coords.y(-135)}this.dealCountLabel.y=this.dealButton.y+e.Coords.y(5),this.dealCountLabel.x=this.dealButton.x+e.Coords.x(55),this.newDealButton.x=e.Coords.x(25),this.undoBoardButton.x=this.undoButton.x,this.undoBoardButton.y=this.undoButton.y-1.25*this.undoButton.height,e.ScreenMetrics.screenWidth,this.settingsButton.x=this.newDealButton.x+this.newDealButton.width+e.Coords.x(100)*this.xScale,this.hintButton.x=this.undoButton.x-this.undoButton.width-e.Coords.x(100)*this.xScale,this.isChallenge&&(this.undoBoardButton.x=this.hintButton.x,this.undoBoardButton.y=this.hintButton.y,this.dealLabel.y-=s)}else this.settingsButton.x=e.Coords.x(520),this.hintButton.x=e.Coords.x(1030)},P.prototype.getGoalTypeKey=function(t){var e="";return n.each(this.game.solitaire.CurrentChallenge.GoalType,function(i,n){if(t===i)return void(e=n)}),e},P.prototype.handleResize=function(){m.addElement(this,{scaleChangeSource:"Full"}),this.game.menuBar.resetTopBar(!0);var t=S.gameScreenUI;this.yScale=Math.max(Math.min(m.height/1080+.2,1),.7),this.xScale=Math.max(Math.min(m.width/1920+.2,1),.7),this.resizeScale=Math.min(this.yScale,this.xScale),this.resizeGameIcon(),this.resizeGameLabel(t),this.difficultyText&&this.resizeDifficultyLabel(t),this.resizeGameScoreLabel(t),this.resizeGameScore(t),this.resizeTimeLabel(t),this.resizeTime(t),this.resizeBoardCompleteLabel(t),this.resizeBoardCompleteNumber(t),this.resizeGameNumberLabel(t),this.resizeGameNumber(t),this.resizeButtons(t),this.isChallenge&&this.challengeHud&&this.repositionChallengeHud(),this.updateLayout()},P.prototype.resizeButtons=function(t){var i=m.width/e.Coords.x(1920),n=m.height/e.Coords.y(1080);this.newDealButton.width=this.newDealButtonWidth/i,this.newDealButton.height=this.newDealButtonHeight/n,this.tryAgainButton.width=this.tryAgainButtonWidth/i,this.tryAgainButton.height=this.tryAgainButtonHeight/n,this.undoButton.width=this.undoButtonWidth/i,this.undoButton.height=this.undoButtonHeight/n,this.undoBoardButton.width=this.undoBoardButtonWidth/i,this.undoBoardButton.height=this.undoBoardButtonHeight/n,this.settingsButton.width=this.settingsButtonWidth/i,this.settingsButton.height=this.settingsButtonHeight/n,this.hintButton.width=this.hintButtonWidth/i,this.hintButton.height=this.hintButtonHeight/n,i<1&&n<1&&(this.newDealButton.width*=this.resizeScale,this.newDealButton.height*=this.resizeScale,this.tryAgainButton.width*=this.resizeScale,this.tryAgainButton.height*=this.resizeScale,this.undoButton.width*=this.resizeScale,this.undoButton.height*=this.resizeScale,this.undoBoardButton.width*=this.resizeScale,this.undoBoardButton.height*=this.resizeScale,this.settingsButton.width*=this.resizeScale,this.settingsButton.height*=this.resizeScale,this.hintButton.width*=this.resizeScale,this.hintButton.height*=this.resizeScale);var r=this.isChallenge?e.Coords.y(935):e.Coords.y(1010);this.newDealButton.y=r-(this.newDealButton.height-this.newDealButton.height*n),this.tryAgainButton.y=r-(this.tryAgainButton.height-this.tryAgainButton.height*n),this.undoButton.y=r-(this.undoButton.height-this.undoButton.height*n),this.undoButton.x=e.Coords.y(1800)-(this.undoButton.width-this.undoButton.width*i),this.undoBoardButton.y=r-(this.undoBoardButton.height-this.undoBoardButton.height*n),this.undoBoardButton.x=this.undoButton.x-this.undoBoardButton.width,this.settingsButton.y=this.newDealButton.y,this.hintButton.y=this.newDealButton.y},P.prototype.repositionChallengeHud=function(){this.challengeHud.handleResize();var t=this.game.menuBar.backButton;this.challengeHud.x=e.Coords.x(this.ui.width-this.challengeHud.width),this.challengeHud.y=t.y+(t.height-this.challengeHud.height)/2;var t=this.game.menuBar.backButton;this.challengeHud.x<=t.x+t.width+e.Coords.x(15)&&(this.challengeHud.x=t.x+t.width+e.Coords.x(15)),e.Platform.isMobile()&&(this.challengeHud.x-=e.Coords.x(100))},P.prototype.resizeGameNumber=function(t){var e=this.resizeScale*(this.gameNumberHeight/m.scaleFactorY),i=this.resizeScale*(this.gameNumberWidth/m.scaleFactorX);this.gameNumber.width=i,this.gameNumber.height=e,this.gameNumber.y=this.gameLabel.y,this.gameNumber.updateText()},P.prototype.resizeGameNumberLabel=function(t){var e=this.resizeScale*(this.gameNumberLabelHeight/m.scaleFactorY),i=this.resizeScale*(this.gameNumberLabelWidth/m.scaleFactorX);this.gameNumberLabel.width=i,this.gameNumberLabel.height=e,this.gameNumberLabel.y=this.gameLabel.y,this.gameNumberLabel.updateText()},P.prototype.resizeBoardCompleteNumber=function(t){var e=this.resizeScale*(this.boardsCompleteHeight/m.scaleFactorY),i=this.resizeScale*(this.boardsCompleteWidth/m.scaleFactorX);this.boardsComplete.width=i,this.boardsComplete.height=e,this.boardsComplete.y=this.gameLabel.y,this.boardsComplete.updateText()},P.prototype.resizeBoardCompleteLabel=function(t){var e=this.resizeScale*(this.boardsCompleteLabelHeight/m.scaleFactorY),i=this.resizeScale*(this.boardsCompleteLabelWidth/m.scaleFactorX);this.boardsCompleteLabel.width=i,this.boardsCompleteLabel.height=e,this.boardsCompleteLabel.y=this.gameLabel.y,this.boardsCompleteLabel.updateText()},P.prototype.resizeTime=function(t){var e=this.resizeScale*(this.timeHeight/m.scaleFactorY),i=this.resizeScale*(this.timeWidth/m.scaleFactorX);this.time.width=i,this.time.height=e,this.time.y=this.gameLabel.y,this.time.updateText()},P.prototype.resizeTimeLabel=function(t){var e=this.resizeScale*(this.timeLabelHeight/m.scaleFactorY),i=this.resizeScale*(this.timeLabelWidth/m.scaleFactorX);this.timeLabel.width=i,this.timeLabel.height=e,this.timeLabel.y=this.gameLabel.y,this.timeLabel.updateText()},P.prototype.resizeGameScore=function(t){var e=this.resizeScale*(this.scoreHeight/m.scaleFactorY),i=this.resizeScale*(this.scoreWidth/m.scaleFactorX);this.score.width=i,this.score.height=e,this.score.y=this.gameLabel.y,this.score.updateText()},P.prototype.resizeGameScoreLabel=function(t){var e=this.resizeScale*(this.scoreLabelHeight/m.scaleFactorY),i=this.resizeScale*(this.scoreLabelWidth/m.scaleFactorX);this.scoreLabel.width=i,this.scoreLabel.height=e,this.scoreLabel.y=this.gameLabel.y,this.scoreLabel.updateText()},P.prototype.resizeGameLabel=function(t){var e=this.resizeScale*(this.gameLabelHeight/m.scaleFactorY),i=this.resizeScale*(this.gameLabelWidth/m.scaleFactorX);this.gameLabel.width=i,this.gameLabel.height=e,this.gameLabel.updateText()},P.prototype.resizeDifficultyLabel=function(t){this.difficultyTextWidth=this.difficultyText._width,this.difficultyTextHeight=this.difficultyText._height;var e=this.resizeScale*(this.difficultyTextHeight/m.scaleFactorY),i=this.resizeScale*(this.difficultyTextWidth/m.scaleFactorX);this.difficultyText.width=i,this.difficultyText.height=e,this.difficultyText.y=this.gameLabel.y,this.difficultyText.updateText()},P.prototype.resizeGameIcon=function(){var t=this.resizeScale*(this.gameIconHeight/m.scaleFactorY),e=this.resizeScale*(this.gameIconWidth/m.scaleFactorX);this.gameIcon.width=e,this.gameIcon.height=t,this.gameIcon.y=m.scaleFactorY},P.prototype.onShow=function(t,e,i){this.visible=!0,this.buttonsHidden=!1,this.game.menuBar.addChild(this.labelContainer),this.handleScoreChange(t),this.handleTimeChange(e),this.handleBoardCompleteChange(i),this.mode=a.getModeById(this.game.solitaire.ActiveMode.Name).toLowerCase(),this.gameName=a.getModeById(this.game.solitaire.ActiveMode.Name),this.isChallenge=this.game.solitaire.Authority.IsChallenge,this.isStarClub=this.game.solitaire.CurrentChallenge&&this.game.solitaire.CurrentChallenge.IsStarClub,void 0===this.settingsManager.getSetting(this.gameName.toLowerCase(),"showDifficulty")&&this.settingsManager.setSetting(this.gameName.toLowerCase(),"showDifficulty",!0),this.showTimer=!(!this.settingsManager.getSetting(this.mode,"timer")||this.isChallenge),this.showScore=!(!this.settingsManager.getSetting(this.mode,"score")||this.isChallenge),this.showBoardsComplete=void 0!==this.settingsManager.getSetting(this.mode,"boardsComplete")&&!this.isChallenge,this.showGameNumber=!(!this.settingsManager.getSetting(this.mode,"gameNumber")||this.isChallenge),this.dealLabel.visible=!1,this.updateLayout(),void 0===this.settingsManager.getSetting(this.gameName.toLowerCase(),"showTutorial")&&this.settingsManager.setSetting(this.gameName.toLowerCase(),"showTutorial",!0),!this.settingsManager.getSetting(this.gameName.toLowerCase(),"showTutorial")||this.isChallenge||this.isSavedGame||this.htp||(this.htp=new x({gameMode:this.mode,onClose:function(){this.closeFUE()}.bind(this),onToggleAlerts:function(t){this.settingsManager.setSetting(this.gameName.toLowerCase(),"showTutorial",t)}.bind(this)},this.ui),this.labelContainer.addChild(this.htp)),this.settingsManager.getSetting("general","showAlerts")&&(this.game.boostType&&"wildCard"===this.game.boostType&&(this.wildCardTip=new x({gameMode:"wildCard",headline:null,onClose:function(){this.labelContainer.removeChild(this.wildCardTip),this.wildCardTip=null}.bind(this),onToggleAlerts:function(t){this.settingsManager.setSetting("general","showAlerts",t)}.bind(this)},this.ui),this.labelContainer.addChild(this.wildCardTip)),"wildCard"!==this.game.boostType&&"extraDeal"!==this.game.boostType||this.showBoostFireworks(this.game.boostType)),this.updateControlFocus(),setTimeout(this.handleResize.bind(this),100),setTimeout(this.game.menuBar.handleResize.bind(this.game.menuBar),100),this.alreadyShown=!0},P.prototype.closeFUE=function(){this.htp&&(this.labelContainer.removeChild(this.htp),this.htp.removeScaling(),e.SpriteUtils.destroyAllChildren(this.htp),this.htp=null)},P.prototype.showBoostFireworks=function(i){var n=[t.Texture.fromFrame("Star_orng_dot.png"),t.Texture.fromFrame("Star_yellow_dot.png"),t.Texture.fromFrame("Star_yel.png")],r={rate:{numpan:{a:2,b:4,center:!0},timepan:{a:.01,b:.002,center:null}},mass:1,rotation:{a:[0,1],b:[0,3],style:"add"},velocity:[.5,1],alpha:{a:.5,b:0},scale:{a:[.3,.3,.5],b:0,center:null},gravity:0,life:{a:1,b:2,center:null},radius:1,crossZone:null,randomDrift:null},o=new c(this.ui,n,r);this.labelContainer.addChild(o),"wildCard"===i?(o.x=(this.mode,e.Coords.x(230)),o.y="pyramid"===this.mode?e.Coords.y(895):e.Coords.y(885)):(o.x=this.dealLabel.x+e.Coords.x(8),o.y=this.dealLabel.y+e.Coords.y(20)),o.start(),window.setTimeout(function(){o.stop()}.bind(this),600),window.setTimeout(function(){o&&(this.labelContainer.removeChild(o),o.destroy(),o=null)}.bind(this),5e3)},P.prototype.onHide=function(){this.visible=!1,m.removeElement(this),this.game.boostType=null,this.wildCardTip&&(this.labelContainer.removeChild(this.wildCardTip),this.wildCardTip=null),this.isChallenge&&this.challengeFooter&&(this.challengeFooter.destroy(),this.challengeFooter=null),this.htp&&(this.labelContainer.removeChild(this.htp),e.SpriteUtils.destroyAllChildren(this.htp),this.htp=null),s.hideTipDialog(),this.game.menuBar.resetTopBar(!1),this.game.menuBar.removeChild(this.labelContainer),this.labelContainer.removeChild(this.challengeHud),this.alreadyShown=!1,this.isChallenge=!1},P.prototype.update=function(t,n){if(this.gameState=t,this.buttonsHidden||(this.solveButton.visible=n&&n.CanAutoSolve(),this.solveButton.x=e.Coords.x("1"===o.getSetting("klondike","layoutDirection")?-438:189),this.undoButton.visible=!0,this.undoBoardButton.visible=this.canShowUndoBoard(),this.tryAgainButton.visible=this.isChallenge),"pyramid"!==this.mode&&"tripeaks"!==this.mode||(this.dealsLeft=this.game.solitaire.Authority.NumDealsLeft(),this.dealButton.visible=this.game.solitaire.Authority.AllowDealNextDeck()&&this.dealsLeft>0,this.dealCountLabel.visible=this.dealButton.visible,this.dealLabel.visible=!this.dealButton.visible,1===this.dealsLeft?this.dealLabel.setText(this.dealsLeft.toString()+" "+i("titles.dealLeft").toLowerCase()):this.dealLabel.setText(this.dealsLeft.toString()+" "+i("titles.dealsLeft").toLowerCase()),this.dealCountLabel.setText(this.dealsLeft.toString())),this.isChallenge){if(this.updateHandlers.updateChallengeStacks&&this.centerChallengeDataDisplay("titles.stacks",this.updateHandlers.updateChallengeStacks,this.game.solitaire.Authority.GetCompletedStacks().toString()),this.updateHandlers.updateChallengeMoves){var r=this.game.solitaire.Authority.TotalMoves>1?this.game.solitaire.Authority.TotalMoves-1:0;this.centerChallengeDataDisplay("titles.moves",this.updateHandlers.updateChallengeMoves,r.toString())}if(this.updateHandlers.updateChallengeCardsPlayed){var a=this.game.solitaire.CurrentChallenge.config.Data.PARAM_VALUETOPLAY;this.centerChallengeDataDisplay(this.mapNumberToCard[a.toLowerCase()],this.updateHandlers.updateChallengeCardsPlayed,this.game.solitaire.Authority.NumberPlayed.toString())}if(this.updateHandlers.updateChallengeDeals){var s=this.game.solitaire.Authority.TotalDeals-this.game.solitaire.Authority.NumDealsLeft()-this.game.solitaire.Authority.FreeDeals-1,l=0===this.game.solitaire.Authority.CurrentDeal?this.dealsLeft-1:this.dealsLeft;s<0&&(s=0),this.centerChallengeDataDisplay("titles.deals",this.updateHandlers.updateChallengeDeals,s.toString()),this.dealCountLabel.setText(l.toString()),this.dealLabel.setText(l.toString()+" "+i("titles.dealsLeft").toLowerCase())}}this.updateControlFocus()},P.prototype.centerChallengeDataDisplay=function(t,e,i){var n=e.x;this.challengeDataOriginalX&&(n=this.challengeDataOriginalX[t]),e.setText(i),e.updateText(),e.x=n-e.width/2},P.prototype.handleScoreChange=function(t){this.score.setText(t?e.TextUtils.formatInt(t,e.StringManager.getUserLanguage()):"0"),this.score.updateText(),this.scoreWidth=this.score._width,this.scoreHeight=this.score._height,this.updateHandlers.updateChallengeScore&&this.centerChallengeDataDisplay("titles.score",this.updateHandlers.updateChallengeScore,t?e.TextUtils.formatInt(t):"0")},P.prototype.handleTimeChange=function(t){var e=this.formatTime(t);this.time.setText(e),this.updateHandlers.updateChallengeTime&&this.centerChallengeDataDisplay("titles.time",this.updateHandlers.updateChallengeTime,e)},P.prototype.formatTime=function(t){t=Math.floor(t);var e=Math.floor(t/60),i=String(t%60);return e+":"+(i<10?"0"+i:i)},P.prototype.handleBoardCompleteChange=function(t){this.boardsComplete.setText(t.toString()),this.boardsComplete.updateText(),this.boardsCompleteWidth=this.boardsComplete._width,this.boardsCompleteHeight=this.boardsComplete._height,this.updateHandlers.updateChallengeBoards&&this.centerChallengeDataDisplay("titles.boards",this.updateHandlers.updateChallengeBoards,t.toString())},P.prototype.showNetworkErrorDialog=function(){this.ui.showWarning(i("dialogs.networkErrorHeadline"),i("dialogs.networkErrorContent"),function(){this.ui.hideLoadingScreen(),this.game.navBack()}.bind(this))},P}),define("game",["absolute","state-machine","gameui","util/SettingsManager","util/ThemeManager","MenuUI/MenuBar","Solitaire/SolitaireGameMode","Solitaire/Solitaire","Solitaire/DailyChallenges/KlondikeChallenge","Solitaire/DailyChallenges/SpiderChallenge","MenuUI/GameScreenUI","Arkadium/GameEngine/Core/EngineManagers","Managers/KeyboardManager","Managers/TelemetryManager"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p){var g=function(t,e){this._initGenericGame(t,e)};return g.prototype=Object.create(t.Game.prototype),g.prototype._initGenericGame=function(e,n){this.checkForSeparateGame(n),t.Game.call(this,e,{version:1,musicEnabled:!0,sfxEnabled:!0,lastLevel:0,completedLevels:[],config:n.config}),this.lastState="loading",this.firstRun=!0,this.currentLevel=0,this.initStateMachine(),this.ui=new i(this,n),c.initialize(this.ui)},g.prototype.checkForSeparateGame=function(t){for(var e={},i=window.location.search,n=("?"===i[0]?i.substr(1):i).split("&"),r=0;r<n.length;r++){var o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}e.singleGame&&a[e.singleGame]>=0?t.config.singleGame={enabled:!0,mode:e.singleGame}:t.config.singleGame={enabled:!1}},g.prototype.makeGame=function(){this.solitaire=new s(this.ui,this),s.Current=this.solitaire},g.prototype.startGame=function(e,i,o,a,s,l){"playing"==this.fsm.current&&this.solitaire.StopGame(!1),this.makeGame(),this.mode=e,this.newDeal=!!o,this.resetScoring=!!a,this.statLossRedeal=!!s,i?(r.CurrentTheme=i.Theme,t.Platform.isMobile()&&(r.CurrentTheme="mobile"),
this.solitaire.CurrentChallenge=i,this.startChallengeLevel()):(r.CurrentTheme=n.getSetting("theme","selected"),t.Platform.isMobile()&&(r.CurrentTheme="mobile"),this.startLevel(l))},g.prototype.makeCannedChallenge=function(){var t,e={CARDTOPLAY:"5S",SCORING:"STANDARD",DRAW:"3"};return t=new l(l.GoalType.PlayCard,e),t.ChallengeName="5S to Foundation",t.DealScript="BEGIN MOVE Root Tableau0 1 MOVE Root FaceDown1 1 MOVE Root Tableau1 1 MOVE Root FaceDown2 2 MOVE Root Tableau2 1 MOVE Root FaceDown3 3 MOVE Root Tableau3 1 MOVE Root FaceDown4 4 MOVE Root Tableau4 1 MOVE Root FaceDown5 5 MOVE Root Tableau5 1 MOVE Root FaceDown6 6 MOVE Root Tableau6 1 MOVE Root Stock 24 END",t.DeckSeeds.push("47706333570411672787770178916737634662827145888245233918205149382562"),t},g.prototype.handleVisibilityChange=function(e){t.Game.prototype.handleVisibilityChange.call(this,e),e?(t.MusicManager.stopMusic(),t.AudioManager.isSfxEnabled()&&t.AudioManager.muteAll()):"loading"!==this.fsm.current&&(t.AudioManager.isSfxEnabled()&&t.AudioManager.unmuteAllSfx(),this.ui&&this.ui.currentScreen&&"function"==typeof this.ui.currentScreen.handleVisibilityChange&&this.ui.currentScreen.handleVisibilityChange(e))},g.prototype.load=function(t,e,i){this.ui.load(t,e,i)},g.prototype.initStateMachine=function(){this.fsm=e.create({events:[{name:"init",from:"none",to:"loading"},{name:"start",from:"loading",to:"mainmenu"},{name:"startlevel",from:"",to:"playing"},{name:"navmain",from:"",to:"mainmenu"},{name:"navdaily",from:"",to:"dailymenu"},{name:"navawards",from:"",to:"awards"},{name:"navawardsachievements",from:"",to:"awardsachievements"},{name:"navstarclub",from:"",to:"starclubmenu"},{name:"navsccollection",from:"",to:"sccollectionmenu"},{name:"navscchallenge",from:"",to:"scchallengemenu"},{name:"startchallengelevel",from:"",to:"playing"},{name:"navstatsdetail",from:"",to:"statsdetailmenu"},{name:"navhtp",from:"",to:"htp"},{name:"navthemes",from:"",to:"themes"}],callbacks:{onnavmain:this.onNavMain.bind(this),onstart:this.onStart.bind(this),onstartlevel:function(t,e,i,n){this.onStartLevel(n)}.bind(this),onendlevel:this.onEndLevel.bind(this),onnavdaily:this.onNavDaily.bind(this),onnavawards:this.onNavAwards.bind(this),onnavawardsachievements:this.onNavAwardsAchievements.bind(this),onnavstarclub:this.onNavStarClub.bind(this),onnavsccollection:this.onNavSCCollection.bind(this),onnavscchallenge:this.onNavSCChallenge.bind(this),onstartchallengelevel:this.onStartLevel.bind(this),onnavstatsdetail:this.onNavStatsDetail.bind(this),onnavhtp:this.onNavHtp.bind(this),onnavthemes:this.onNavThemes.bind(this),onleaveplaying:this.onLeavePlaying.bind(this),onchangestate:function(e,i,n){this.lastState=i,t.Debug.log("CHANGED STATE: "+i+" to "+n)}.bind(this)}}),this.fsm.init()},g.prototype.onStart=function(){this.menuBar||(this.menuBar=new o({},this.ui,this)),this.gameScreenUI||(this.gameScreenUI=new u({},this.ui,this)),this.config.singleGame.enabled?this.startGame(a[this.config.singleGame.mode]):this.ui.showMainMenu()},g.prototype.onNavMain=function(){this.config.singleGame.enabled?this.startGame(a[this.config.singleGame.mode]):this.ui.showMainMenu()},g.prototype.onStartLevel=function(t){this.ui.showGameScreen(t)},g.prototype.onNavDaily=function(){this.ui.showDailyChallengeMenu()},g.prototype.onNavAwards=function(t,e,i,n){this.ui.showAwardsMenu(n)},g.prototype.onNavAwardsAchievements=function(){this.ui.showAwardsAchievementsMenu()},g.prototype.onNavStarClub=function(){this.ui.showStarClubMenu()},g.prototype.onNavSCCollection=function(){this.ui.showStarClubCollectionMenu()},g.prototype.onNavSCChallenge=function(){this.ui.showStarClubChallengeMenu()},g.prototype.onEndLevel=function(){this.solitaire&&(this.solitaire.CurrentChallenge=null),"dailymenu"==this.fsm.current?this.ui.showDailyChallengeMenu():"scchallengemenu"==this.fsm.current?this.ui.showStarClubChallengeMenu():this.config.singleGame.enabled?this.startGame(a[this.config.singleGame.mode]):this.ui.showMainMenu()},g.prototype.onNavStatsDetail=function(){this.ui.showStatsDetailMenu()},g.prototype.onNavHtp=function(){this.ui.showHtpScreen(this.htpMode)},g.prototype.onNavThemes=function(){this.ui.showThemesScreen()},g.prototype.start=function(){this.fsm.start()},g.prototype.startLevel=function(t){this.fsm.startlevel(t)},g.prototype.startChallengeLevel=function(){this.fsm.startchallengelevel()},g.prototype.endLevel=function(){this.fsm.endlevel()},g.prototype.onLeavePlaying=function(){this.solitaire.StopGame(!1)},g.prototype.navBack=function(){if(this.config.singleGame.enabled)return void this.startGame(this.mode,null,null,null,null,!1);if(("awardsachievements"==this.fsm.current||"awards"==this.fsm.current||"playing"==this.fsm.current||"htp"==this.fsm.current||"statsdetailmenu"==this.fsm.current&&"playing"==this.lastState)&&"statsdetailmenu"!==this.lastState&&"awards"!==this.lastState)switch(this.lastState){case"dailymenu":this.fsm.navdaily();break;case"scchallengemenu":this.fsm.navscchallenge();break;case"mainmenu":this.fsm.navmain();break;case"awardsachievements":this.fsm.navawardsachievements();break;case"playing":this.startGame(this.mode,this.solitaire.CurrentChallenge,null,null,null,!1);break;case"starclubmenu":this.fsm.navstarclub();break;case"sccollectionmenu":this.fsm.navsccollection();break;case"scchallengemenu":this.fsm.navscchallenge();break;case"statsdetailmenu":this.navStatsDetail(this.statsDetailModel);break;case"htp":this.fsm.navmain()}else switch(this.fsm.current){case"playing":case"dailymenu":case"awardsachievements":this.fsm.navmain();break;case"scchallengemenu":this.fsm.navsccollection();break;case"sccollectionmenu":this.fsm.navstarclub();break;case"starclubmenu":case"statsdetailmenu":this.fsm.navmain()}},g.prototype.navDaily=function(){this.fsm.navdaily()},g.prototype.navStarClub=function(){this.fsm.navstarclub()},g.prototype.navStarClubCollection=function(t){this.ui.setStarClubCollection(t),this.fsm.navsccollection()},g.prototype.navStarClubChallenge=function(t){this.ui.setStarClubChallengePack(t),this.fsm.navscchallenge()},g.prototype.navStatsDetail=function(t){this.statsDetailModel=t,this.ui.setStatsDetailModel(t),this.fsm.navstatsdetail()},g.prototype.navAwards=function(t){this.fsm.navawards(t)},g.prototype.navAwardsAchievements=function(){this.fsm.navawardsachievements()},g.prototype.navHtp=function(t){this.htpMode=t,this.fsm.navhtp()},g.prototype.navThemes=function(){this.fsm.navthemes()},g.prototype.navMain=function(){this.fsm.navmain()},g.prototype.updateSetting=function(t,e){switch(t){case"soundFx":d.Sounds.UpdateSoundState(e,-1);break;case"music":d.Sounds.UpdateSoundState(-1,e)}},g.prototype.isBrowserSupported=function(){return t.Platform._isIE()||t.Platform._isChromeGeneric()||t.Platform._isFirefox()||t.Platform._isSafari()},g}),function(t,e){"use strict";function i(i,n){function r(t){return yt.preferFlash&&ht&&!yt.ignoreFlash&&yt.flash[t]!==e&&yt.flash[t]}function o(t){return function(e){var i,n=this._s;return n&&n._a?i=t.call(this,e):(n&&n.id?yt._wD(n.id+": Ignoring "+e.type):yt._wD(vt+"Ignoring "+e.type),i=null),i}}this.setupOptions={url:i||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.movieID="sm2-container",this.id=n||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20140901",this.version=null,this.movieURL=null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var a,s,l,h,u,d,c,p,g,f,y,m,C,S,b,v,w,x,T,M,_,P,A,k,D,F,E,I,G,O,B,L,R,N,U,V,H,W,K,z,j,Y,X,q,Z,J,Q,$,tt,et,it,nt,rt,ot,at,st,lt,ht,ut,dt,ct,pt,gt,ft,yt=this,mt=null,Ct=null,St="soundManager",bt=St+": ",vt="HTML5::",wt=navigator.userAgent,xt=t.location.href.toString(),Tt=document,Mt=[],_t=!0,Pt=!1,At=!1,kt=!1,Dt=!1,Ft=!1,Et=0,It=["log","info","warn","error"],Gt=null,Ot=null,Bt=!1,Lt=!1,Rt=0,Nt=null,Ut=[],Vt=null,Ht=Array.prototype.slice,Wt=!1,Kt=0,zt=wt.match(/(ipad|iphone|ipod)/i),jt=wt.match(/android/i),Yt=wt.match(/msie/i),Xt=wt.match(/webkit/i),qt=wt.match(/safari/i)&&!wt.match(/chrome/i),Zt=wt.match(/opera/i),Jt=wt.match(/(mobile|pre\/|xoom)/i)||zt||jt,Qt=!xt.match(/usehtml5audio/i)&&!xt.match(/sm2\-ignorebadua/i)&&qt&&!wt.match(/silk/i)&&wt.match(/OS X 10_6_([3-7])/i),$t=t.console!==e&&console.log!==e,te=Tt.hasFocus!==e?Tt.hasFocus():null,ee=qt&&(Tt.hasFocus===e||!Tt.hasFocus()),ie=!ee,ne=/(mp3|mp4|mpa|m4a|m4b)/i,re=Tt.location?Tt.location.protocol.match(/http/i):null,oe=re?"":"http://",ae=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,se=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],le=new RegExp("\\.("+se.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!re,W={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},this.hasHTML5=function(){try{return Audio!==e&&(Zt&&opera!==e&&opera.version()<10?new Audio(null):new Audio).canPlayType!==e}catch(t){return!1}}(),this.setup=function(t){var i=!yt.url;return t!==e&&kt&&Vt&&yt.ok()&&(t.flashVersion!==e||t.url!==e||t.html5Test!==e)&&Y(U("setupLate")),y(t),t&&(i&&F&&t.url!==e&&yt.beginDelayedInit(),F||t.url===e||"complete"!==Tt.readyState||setTimeout(k,1)),yt},this.ok=function(){return Vt?kt&&!Dt:yt.useHTML5Audio&&yt.hasHTML5},this.supported=this.ok,this.getMovie=function(e){return s(e)||Tt[e]||t[e]},this.createSound=function(t,i){function n(){return s=z(s),yt.sounds[s.id]=new a(s),yt.soundIDs.push(s.id),yt.sounds[s.id]}var r,o,s,l=null;if(r=St+".createSound(): ",o=r+U(kt?"notOK":"notReady"),!kt||!yt.ok())return Y(o),!1;if(i!==e&&(t={id:t,url:i}),s=f(t),s.url=Q(s.url),void 0===s.id&&(s.id=yt.setupOptions.idPrefix+Kt++),s.id.toString().charAt(0).match(/^[0-9]$/)&&yt._wD(r+U("badID",s.id),2),yt._wD(r+s.id+(s.url?" ("+s.url+")":""),1),X(s.id,!0))return yt._wD(r+s.id+" exists",1),yt.sounds[s.id];if(et(s))l=n(),yt._wD(s.id+": Using HTML5"),l._setup_html5(s);else{if(yt.html5Only)return yt._wD(s.id+": No HTML5 support for this sound, and no Flash. Exiting."),n();if(yt.html5.usingFlash&&s.url&&s.url.match(/data\:/i))return yt._wD(s.id+": data: URIs not supported via Flash. Exiting."),n();d>8&&(null===s.isMovieStar&&(s.isMovieStar=!!(s.serverURL||s.type&&s.type.match(ae)||s.url&&s.url.match(le))),s.isMovieStar&&(yt._wD(r+"using MovieStar handling"),s.loops>1&&p("noNSLoop"))),s=j(s,r),l=n(),8===d?Ct._createSound(s.id,s.loops||1,s.usePolicyFile):(Ct._createSound(s.id,s.url,s.usePeakData,s.useWaveformData,s.useEQData,s.isMovieStar,!!s.isMovieStar&&s.bufferTime,s.loops||1,s.serverURL,s.duration||null,s.autoPlay,!0,s.autoLoad,s.usePolicyFile),s.serverURL||(l.connected=!0,s.onconnect&&s.onconnect.apply(l))),s.serverURL||!s.autoLoad&&!s.autoPlay||l.load(s)}return!s.serverURL&&s.autoPlay&&l.play(),l},this.destroySound=function(t,e){if(!X(t))return!1;var i,n=yt.sounds[t];for(n._iO={},n.stop(),n.unload(),i=0;i<yt.soundIDs.length;i++)if(yt.soundIDs[i]===t){yt.soundIDs.splice(i,1);break}return e||n.destruct(!0),n=null,delete yt.sounds[t],!0},this.load=function(t,e){return!!X(t)&&yt.sounds[t].load(e)},this.unload=function(t){return!!X(t)&&yt.sounds[t].unload()},this.onPosition=function(t,e,i,n){return!!X(t)&&yt.sounds[t].onposition(e,i,n)},this.onposition=this.onPosition,this.clearOnPosition=function(t,e,i){return!!X(t)&&yt.sounds[t].clearOnPosition(e,i)},this.play=function(t,e){var i=null,n=e&&!(e instanceof Object);if(!kt||!yt.ok())return Y(St+".play(): "+U(kt?"notOK":"notReady")),!1;if(X(t,n))n&&(e={url:e});else{if(!n)return!1;n&&(e={url:e}),e&&e.url&&(yt._wD(St+'.play(): Attempting to create "'+t+'"',1),e.id=t,i=yt.createSound(e).play())}return null===i&&(i=yt.sounds[t].play(e)),i},this.start=this.play,this.setPosition=function(t,e){return!!X(t)&&yt.sounds[t].setPosition(e)},this.stop=function(t){return!!X(t)&&(yt._wD(St+".stop("+t+")",1),yt.sounds[t].stop())},this.stopAll=function(){var t;yt._wD(St+".stopAll()",1);for(t in yt.sounds)yt.sounds.hasOwnProperty(t)&&yt.sounds[t].stop()},this.pause=function(t){return!!X(t)&&yt.sounds[t].pause()},this.pauseAll=function(){var t;for(t=yt.soundIDs.length-1;t>=0;t--)yt.sounds[yt.soundIDs[t]].pause()},this.resume=function(t){return!!X(t)&&yt.sounds[t].resume()},this.resumeAll=function(){var t;for(t=yt.soundIDs.length-1;t>=0;t--)yt.sounds[yt.soundIDs[t]].resume()},this.togglePause=function(t){return!!X(t)&&yt.sounds[t].togglePause()},this.setPan=function(t,e){return!!X(t)&&yt.sounds[t].setPan(e)},this.setVolume=function(t,e){return!!X(t)&&yt.sounds[t].setVolume(e)},this.mute=function(t){var e=0;if(t instanceof String&&(t=null),t)return!!X(t)&&(yt._wD(St+'.mute(): Muting "'+t+'"'),yt.sounds[t].mute());for(yt._wD(St+".mute(): Muting all sounds"),e=yt.soundIDs.length-1;e>=0;e--)yt.sounds[yt.soundIDs[e]].mute();return yt.muted=!0,!0},this.muteAll=function(){yt.mute()},this.unmute=function(t){var e;if(t instanceof String&&(t=null),t)return!!X(t)&&(yt._wD(St+'.unmute(): Unmuting "'+t+'"'),yt.sounds[t].unmute());for(yt._wD(St+".unmute(): Unmuting all sounds"),e=yt.soundIDs.length-1;e>=0;e--)yt.sounds[yt.soundIDs[e]].unmute();return yt.muted=!1,!0},this.unmuteAll=function(){yt.unmute()},this.toggleMute=function(t){return!!X(t)&&yt.sounds[t].toggleMute()},this.getMemoryUse=function(){var t=0;return Ct&&8!==d&&(t=parseInt(Ct._getMemoryUse(),10)),t},this.disable=function(i){var n;if(i===e&&(i=!1),Dt)return!1;for(Dt=!0,p("shutdown",1),n=yt.soundIDs.length-1;n>=0;n--)L(yt.sounds[yt.soundIDs[n]]);return g(i),st.remove(t,"load",b),!0},this.canPlayMIME=function(t){var e;return yt.hasHTML5&&(e=it({type:t})),!e&&Vt&&(e=t&&yt.ok()?!!((d>8?t.match(ae):null)||t.match(yt.mimePattern)):null),e},this.canPlayURL=function(t){var e;return yt.hasHTML5&&(e=it({url:t})),!e&&Vt&&(e=t&&yt.ok()?!!t.match(yt.filePattern):null),e},this.canPlayLink=function(t){return!(t.type===e||!t.type||!yt.canPlayMIME(t.type))||yt.canPlayURL(t.href)},this.getSoundById=function(t,e){if(!t)return null;var i=yt.sounds[t];return i||e||yt._wD(St+'.getSoundById(): Sound "'+t+'" not found.',2),i},this.onready=function(e,i){var n=!1;if("function"!=typeof e)throw U("needFunction","onready");return kt&&yt._wD(U("queue","onready")),i||(i=t),C("onready",e,i),S(),n=!0,n},this.ontimeout=function(e,i){var n="ontimeout",r=!1;if("function"!=typeof e)throw U("needFunction",n);return kt&&yt._wD(U("queue",n)),i||(i=t),C(n,e,i),S({type:n}),r=!0,r},this._writeDebug=function(t,i){var n,r;return!!yt.debugMode&&(!!($t&&yt.useConsole&&(i&&"object"==typeof i?console.log(t,i):It[i]!==e?console[It[i]](t):console.log(t),yt.consoleOnly))||!!(n=s("soundmanager-debug"))&&(r=Tt.createElement("div"),++Et%2==0&&(r.className="sm2-alt"),i=i===e?0:parseInt(i,10),r.appendChild(Tt.createTextNode(t)),i&&(i>=2&&(r.style.fontWeight="bold"),3===i&&(r.style.color="#ff3333")),n.insertBefore(r,n.firstChild),n=null,!0))},-1!==xt.indexOf("sm2-debug=alert")&&(this._writeDebug=function(e){t.alert(e)}),this._wD=this._writeDebug,this._debug=function(){var t,e;for(p("currentObj",1),t=0,e=yt.soundIDs.length;t<e;t++)yt.sounds[yt.soundIDs[t]]._debug()},this.reboot=function(e,i){yt.soundIDs.length&&yt._wD("Destroying "+yt.soundIDs.length+" SMSound object"+(1!==yt.soundIDs.length?"s":"")+"...");var n,r,o;for(n=yt.soundIDs.length-1;n>=0;n--)yt.sounds[yt.soundIDs[n]].destruct();if(Ct)try{Yt&&(Ot=Ct.innerHTML),Gt=Ct.parentNode.removeChild(Ct)}catch(t){p("badRemove",2)}if(Ot=Gt=Vt=Ct=null,yt.enabled=F=kt=Bt=Lt=Pt=At=Dt=Wt=yt.swfLoaded=!1,yt.soundIDs=[],yt.sounds={},Kt=0,e)Mt=[];else for(n in Mt)if(Mt.hasOwnProperty(n))for(r=0,o=Mt[n].length;r<o;r++)Mt[n][r].fired=!1;return i||yt._wD(St+": Rebooting..."),yt.html5={usingFlash:null},yt.flash={},yt.html5Only=!1,yt.ignoreFlash=!1,t.setTimeout(function(){A(),i||yt.beginDelayedInit()},20),yt},this.reset=function(){return p("reset"),yt.reboot(!0,!0)},this.getMoviePercent=function(){return Ct&&"PercentLoaded"in Ct?Ct.PercentLoaded():null},this.beginDelayedInit=function(){Ft=!0,k(),setTimeout(function(){return!Lt&&(I(),P(),Lt=!0,!0)},20),v()},this.destruct=function(){yt._wD(St+".destruct()"),yt.disable(!0)},a=function(t){var i,n,r,o,a,s,l,h,u,g,y=this,m=!1,C=[],S=0,b=null;u={duration:null,time:null},this.id=t.id,this.sID=this.id,this.url=t.url,this.options=f(t),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,g=!this.url,this.id3={},this._debug=function(){yt._wD(y.id+": Merged options:",y.options)},this.load=function(t){var i,n=null;if(t!==e?y._iO=f(t,y.options):(t=y.options,y._iO=t,b&&b!==y.url&&(p("manURL"),y._iO.url=y.url,y.url=null)),y._iO.url||(y._iO.url=y.url),y._iO.url=Q(y._iO.url),y.instanceOptions=y._iO,i=y._iO,yt._wD(y.id+": load ("+i.url+")"),!i.url&&!y.url)return yt._wD(y.id+": load(): url is unassigned. Exiting.",2),y;if(y.isHTML5||8!==d||y.url||i.autoPlay||yt._wD(y.id+": Flash 8 load() limitation: Wait for onload() before calling play().",1),i.url===y.url&&0!==y.readyState&&2!==y.readyState)return p("onURL",1),3===y.readyState&&i.onload&&ft(y,function(){i.onload.apply(y,[!!y.duration])}),y;if(y.loaded=!1,y.readyState=1,y.playState=0,y.id3={},et(i))n=y._setup_html5(i),n._called_load?yt._wD(y.id+": Ignoring request to load again"):(y._html5_canplay=!1,y.url!==i.url&&(yt._wD(p("manURL")+": "+i.url),y._a.src=i.url,y.setPosition(0)),y._a.autobuffer="auto",y._a.preload="auto",y._a._called_load=!0);else{if(yt.html5Only)return yt._wD(y.id+": No flash support. Exiting."),y;if(y._iO.url&&y._iO.url.match(/data\:/i))return yt._wD(y.id+": data: URIs not supported via Flash. Exiting."),y;try{y.isHTML5=!1,y._iO=j(z(i)),y._iO.autoPlay&&(y._iO.position||y._iO.from)&&(yt._wD(y.id+": Disabling autoPlay because of non-zero offset case"),y._iO.autoPlay=!1),i=y._iO,8===d?Ct._load(y.id,i.url,i.stream,i.autoPlay,i.usePolicyFile):Ct._load(y.id,i.url,!!i.stream,!!i.autoPlay,i.loops||1,!!i.autoLoad,i.usePolicyFile)}catch(t){p("smError",2),c("onload",!1),G({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return y.url=i.url,y},this.unload=function(){return 0!==y.readyState&&(yt._wD(y.id+": unload()"),y.isHTML5?(o(),y._a&&(y._a.pause(),b=rt(y._a))):8===d?Ct._unload(y.id,"about:blank"):Ct._unload(y.id),i()),y},this.destruct=function(t){yt._wD(y.id+": Destruct"),y.isHTML5?(o(),y._a&&(y._a.pause(),rt(y._a),Wt||r(),y._a._s=null,y._a=null)):(y._iO.onfailure=null,Ct._destroySound(y.id)),t||yt.destroySound(y.id,!0)},this.play=function(t,i){var n,r,o,l,u,c,p,C=!0,S=null;if(n=y.id+": play(): ",i=i===e||i,t||(t={}),y.url&&(y._iO.url=y.url),y._iO=f(y._iO,y.options),y._iO=f(t,y._iO),y._iO.url=Q(y._iO.url),y.instanceOptions=y._iO,!y.isHTML5&&y._iO.serverURL&&!y.connected)return y.getAutoPlay()||(yt._wD(n+" Netstream not connected yet - setting autoPlay"),y.setAutoPlay(!0)),y;if(et(y._iO)&&(y._setup_html5(y._iO),a()),1!==y.playState||y.paused||(r=y._iO.multiShot,r?yt._wD(n+"Already playing (multi-shot)",1):(yt._wD(n+"Already playing (one-shot)",1),y.isHTML5&&y.setPosition(y._iO.position),S=y)),null!==S)return S;if(t.url&&t.url!==y.url&&(y.readyState||y.isHTML5||8!==d||!g?y.load(y._iO):g=!1),y.loaded?yt._wD(n.substr(0,n.lastIndexOf(":"))):0===y.readyState?(yt._wD(n+"Attempting to load"),y.isHTML5||yt.html5Only?y.isHTML5?y.load(y._iO):(yt._wD(n+"Unsupported type. Exiting."),S=y):(y._iO.autoPlay=!0,y.load(y._iO)),y.instanceOptions=y._iO):2===y.readyState?(yt._wD(n+"Could not load - exiting",2),S=y):yt._wD(n+"Loading - attempting to play..."),null!==S)return S;if(!y.isHTML5&&9===d&&y.position>0&&y.position===y.duration&&(yt._wD(n+"Sound at end, resetting to position:0"),t.position=0),y.paused&&y.position>=0&&(!y._iO.serverURL||y.position>0))yt._wD(n+"Resuming from paused state",1),y.resume();else{if(y._iO=f(t,y._iO),(!y.isHTML5&&null!==y._iO.position&&y._iO.position>0||null!==y._iO.from&&y._iO.from>0||null!==y._iO.to)&&0===y.instanceCount&&0===y.playState&&!y._iO.serverURL){if(l=function(){y._iO=f(t,y._iO),y.play(y._iO)},y.isHTML5&&!y._html5_canplay?(yt._wD(n+"Beginning load for non-zero offset case"),y.load({_oncanplay:l}),S=!1):y.isHTML5||y.loaded||y.readyState&&2===y.readyState||(yt._wD(n+"Preloading for non-zero offset case"),y.load({onload:l}),S=!1),null!==S)return S;y._iO=h()}(!y.instanceCount||y._iO.multiShotEvents||y.isHTML5&&y._iO.multiShot&&!Wt||!y.isHTML5&&d>8&&!y.getAutoPlay())&&y.instanceCount++,y._iO.onposition&&0===y.playState&&s(y),y.playState=1,y.paused=!1,y.position=y._iO.position===e||isNaN(y._iO.position)?0:y._iO.position,y.isHTML5||(y._iO=j(z(y._iO))),y._iO.onplay&&i&&(y._iO.onplay.apply(y),m=!0),y.setVolume(y._iO.volume,!0),y.setPan(y._iO.pan,!0),y.isHTML5?y.instanceCount<2?(a(),o=y._setup_html5(),y.setPosition(y._iO.position),o.play()):(yt._wD(y.id+": Cloning Audio() for instance #"+y.instanceCount+"..."),u=new Audio(y._iO.url),c=function(){st.remove(u,"ended",c),y._onfinish(y),rt(u),u=null},p=function(){st.remove(u,"canplay",p);try{u.currentTime=y._iO.position/1e3}catch(t){Y(y.id+": multiShot play() failed to apply position of "+y._iO.position/1e3)}u.play()},st.add(u,"ended",c),void 0!==y._iO.volume&&(u.volume=Math.max(0,Math.min(1,y._iO.volume/100))),y.muted&&(u.muted=!0),y._iO.position?st.add(u,"canplay",p):u.play()):(C=Ct._start(y.id,y._iO.loops||1,9===d?y.position:y.position/1e3,y._iO.multiShot||!1),9!==d||C||(yt._wD(n+"No sound hardware, or 32-sound ceiling hit",2),y._iO.onplayerror&&y._iO.onplayerror.apply(y)))}return y},this.start=this.play,this.stop=function(t){var e,i=y._iO;return 1===y.playState&&(yt._wD(y.id+": stop()"),y._onbufferchange(0),y._resetOnPosition(0),y.paused=!1,y.isHTML5||(y.playState=0),l(),i.to&&y.clearOnPosition(i.to),y.isHTML5?y._a&&(e=y.position,y.setPosition(0),y.position=e,y._a.pause(),y.playState=0,y._onTimer(),o()):(Ct._stop(y.id,t),i.serverURL&&y.unload()),y.instanceCount=0,y._iO={},i.onstop&&i.onstop.apply(y)),y},this.setAutoPlay=function(t){yt._wD(y.id+": Autoplay turned "+(t?"on":"off")),y._iO.autoPlay=t,y.isHTML5||(Ct._setAutoPlay(y.id,t),t&&(y.instanceCount||1!==y.readyState||(y.instanceCount++,yt._wD(y.id+": Incremented instance count to "+y.instanceCount))))},this.getAutoPlay=function(){return y._iO.autoPlay},this.setPosition=function(t){t===e&&(t=0);var i,n,r=y.isHTML5?Math.max(t,0):Math.min(y.duration||y._iO.duration,Math.max(t,0));if(y.position=r,n=y.position/1e3,y._resetOnPosition(y.position),y._iO.position=r,y.isHTML5){if(y._a){if(y._html5_canplay){if(y._a.currentTime!==n){yt._wD(y.id+": setPosition("+n+")");try{y._a.currentTime=n,(0===y.playState||y.paused)&&y._a.pause()}catch(t){yt._wD(y.id+": setPosition("+n+") failed: "+t.message,2)}}}else if(n)return yt._wD(y.id+": setPosition("+n+"): Cannot seek yet, sound not ready",2),y;y.paused&&y._onTimer(!0)}}else i=9===d?y.position:n,y.readyState&&2!==y.readyState&&Ct._setPosition(y.id,i,y.paused||!y.playState,y._iO.multiShot);return y},this.pause=function(t){return y.paused||0===y.playState&&1!==y.readyState?y:(yt._wD(y.id+": pause()"),y.paused=!0,y.isHTML5?(y._setup_html5().pause(),o()):(t||t===e)&&Ct._pause(y.id,y._iO.multiShot),y._iO.onpause&&y._iO.onpause.apply(y),y)},this.resume=function(){var t=y._iO;return y.paused?(yt._wD(y.id+": resume()"),y.paused=!1,y.playState=1,y.isHTML5?(y._setup_html5().play(),a()):(t.isMovieStar&&!t.serverURL&&y.setPosition(y.position),Ct._pause(y.id,t.multiShot)),!m&&t.onplay?(t.onplay.apply(y),m=!0):t.onresume&&t.onresume.apply(y),y):y},this.togglePause=function(){return yt._wD(y.id+": togglePause()"),0===y.playState?(y.play({position:9!==d||y.isHTML5?y.position/1e3:y.position}),y):(y.paused?y.resume():y.pause(),y)},this.setPan=function(t,i){return t===e&&(t=0),i===e&&(i=!1),y.isHTML5||Ct._setPan(y.id,t),y._iO.pan=t,i||(y.pan=t,y.options.pan=t),y},this.setVolume=function(t,i){return t===e&&(t=100),i===e&&(i=!1),y.isHTML5?y._a&&(yt.muted&&!y.muted&&(y.muted=!0,y._a.muted=!0),y._a.volume=Math.max(0,Math.min(1,t/100))):Ct._setVolume(y.id,yt.muted&&!y.muted||y.muted?0:t),y._iO.volume=t,i||(y.volume=t,y.options.volume=t),y},this.mute=function(){return y.muted=!0,y.isHTML5?y._a&&(y._a.muted=!0):Ct._setVolume(y.id,0),y},this.unmute=function(){y.muted=!1;var t=y._iO.volume!==e;return y.isHTML5?y._a&&(y._a.muted=!1):Ct._setVolume(y.id,t?y._iO.volume:y.options.volume),y},this.toggleMute=function(){return y.muted?y.unmute():y.mute()},this.onPosition=function(t,i,n){return C.push({position:parseInt(t,10),method:i,scope:n!==e?n:y,fired:!1}),y},this.onposition=this.onPosition,this.clearOnPosition=function(t,e){var i;if(t=parseInt(t,10),isNaN(t))return!1;for(i=0;i<C.length;i++)t===C[i].position&&(e&&e!==C[i].method||(C[i].fired&&S--,C.splice(i,1)))},this._processOnPosition=function(){var t,e,i=C.length;if(!i||!y.playState||S>=i)return!1;for(t=i-1;t>=0;t--)e=C[t],!e.fired&&y.position>=e.position&&(e.fired=!0,S++,e.method.apply(e.scope,[e.position]),i=C.length);return!0},this._resetOnPosition=function(t){var e,i,n=C.length;if(!n)return!1;for(e=n-1;e>=0;e--)i=C[e],i.fired&&t<=i.position&&(i.fired=!1,S--);return!0},h=function(){var t,e,i=y._iO,n=i.from,r=i.to;return e=function(){yt._wD(y.id+': "To" time of '+r+" reached."),y.clearOnPosition(r,e),y.stop()},t=function(){yt._wD(y.id+': Playing "from" '+n),null===r||isNaN(r)||y.onPosition(r,e)},null===n||isNaN(n)||(i.position=n,i.multiShot=!1,t()),i},s=function(){var t,e=y._iO.onposition;if(e)for(t in e)e.hasOwnProperty(t)&&y.onPosition(parseInt(t,10),e[t])},l=function(){var t,e=y._iO.onposition;if(e)for(t in e)e.hasOwnProperty(t)&&y.clearOnPosition(parseInt(t,10))},a=function(){y.isHTML5&&q(y)},o=function(){y.isHTML5&&Z(y)},i=function(t){t||(C=[],S=0),m=!1,y._hasTimer=null,y._a=null,y._html5_canplay=!1,y.bytesLoaded=null,y.bytesTotal=null,y.duration=y._iO&&y._iO.duration?y._iO.duration:null,y.durationEstimate=null,y.buffered=[],y.eqData=[],y.eqData.left=[],y.eqData.right=[],y.failures=0,y.isBuffering=!1,y.instanceOptions={},y.instanceCount=0,y.loaded=!1,y.metadata={},y.readyState=0,y.muted=!1,y.paused=!1,y.peakData={left:0,right:0},y.waveformData={left:[],right:[]},y.playState=0,y.position=null,y.id3={}},i(),this._onTimer=function(t){var e,i,n=!1,r={};if(y._hasTimer||t)return y._a&&(t||(y.playState>0||1===y.readyState)&&!y.paused)&&(e=y._get_html5_duration(),e!==u.duration&&(u.duration=e,y.duration=e,n=!0),y.durationEstimate=y.duration,i=1e3*y._a.currentTime||0,i!==u.time&&(u.time=i,n=!0),(n||t)&&y._whileplaying(i,r,r,r,r)),n},this._get_html5_duration=function(){var t=y._iO,e=y._a&&y._a.duration?1e3*y._a.duration:t&&t.duration?t.duration:null;return e&&!isNaN(e)&&e!==1/0?e:null},this._apply_loop=function(t,e){!t.loop&&e>1&&yt._wD("Note: Native HTML5 looping is infinite.",1),t.loop=e>1?"loop":""},this._setup_html5=function(t){var e,r=f(y._iO,t),o=Wt?mt:y._a,a=decodeURI(r.url);if(Wt?a===decodeURI(lt)&&(e=!0):a===decodeURI(b)&&(e=!0),o){if(o._s)if(Wt)o._s&&o._s.playState&&!e&&o._s.stop();else if(!Wt&&a===decodeURI(b))return y._apply_loop(o,r.loops),o;e||(b&&i(!1),o.src=r.url,y.url=r.url,b=r.url,lt=r.url,o._called_load=!1)}else r.autoLoad||r.autoPlay?(y._a=new Audio(r.url),y._a.load()):y._a=Zt&&opera.version()<10?new Audio(null):new Audio,o=y._a,o._called_load=!1,Wt&&(mt=o);return y.isHTML5=!0,y._a=o,o._s=y,n(),y._apply_loop(o,r.loops),r.autoLoad||r.autoPlay?y.load():(o.autobuffer=!1,o.preload="auto"),o},n=function(){if(y._a._added_events)return!1;var t;y._a._added_events=!0;for(t in ct)ct.hasOwnProperty(t)&&function(t,e,i){y._a&&y._a.addEventListener(t,e,i||!1)}(t,ct[t]);return!0},r=function(){var t;yt._wD(y.id+": Removing event listeners"),y._a._added_events=!1;for(t in ct)ct.hasOwnProperty(t)&&function(t,e,i){y._a&&y._a.removeEventListener(t,e,i||!1)}(t,ct[t])},this._onload=function(t){var e,i=!!t||!y.isHTML5&&8===d&&y.duration;return e=y.id+": ",yt._wD(e+(i?"onload()":"Failed to load / invalid sound?"+(y.duration?" -":" Zero-length duration reported.")+" ("+y.url+")"),i?1:2),i||y.isHTML5||(!0===yt.sandbox.noRemote&&yt._wD(e+U("noNet"),1),!0===yt.sandbox.noLocal&&yt._wD(e+U("noLocal"),1)),y.loaded=i,y.readyState=i?3:2,y._onbufferchange(0),y._iO.onload&&ft(y,function(){y._iO.onload.apply(y,[i])}),!0},this._onbufferchange=function(t){return 0!==y.playState&&(!(t&&y.isBuffering||!t&&!y.isBuffering)&&(y.isBuffering=1===t,y._iO.onbufferchange&&(yt._wD(y.id+": Buffer state change: "+t),y._iO.onbufferchange.apply(y,[t])),!0))},this._onsuspend=function(){return y._iO.onsuspend&&(yt._wD(y.id+": Playback suspended"),y._iO.onsuspend.apply(y)),!0},this._onfailure=function(t,e,i){y.failures++,yt._wD(y.id+": Failure ("+y.failures+"): "+t),y._iO.onfailure&&1===y.failures?y._iO.onfailure(t,e,i):yt._wD(y.id+": Ignoring failure")},this._onwarning=function(t,e,i){y._iO.onwarning&&y._iO.onwarning(t,e,i)},this._onfinish=function(){var t=y._iO.onfinish;y._onbufferchange(0),y._resetOnPosition(0),y.instanceCount&&(y.instanceCount--,y.instanceCount||(l(),y.playState=0,y.paused=!1,y.instanceCount=0,y.instanceOptions={},y._iO={},o(),y.isHTML5&&(y.position=0)),y.instanceCount&&!y._iO.multiShotEvents||t&&(yt._wD(y.id+": onfinish()"),ft(y,function(){t.apply(y)})))},this._whileloading=function(t,e,i,n){var r=y._iO;y.bytesLoaded=t,y.bytesTotal=e,y.duration=Math.floor(i),y.bufferLength=n,y.isHTML5||r.isMovieStar?y.durationEstimate=y.duration:r.duration?y.durationEstimate=y.duration>r.duration?y.duration:r.duration:y.durationEstimate=parseInt(y.bytesTotal/y.bytesLoaded*y.duration,10),y.isHTML5||(y.buffered=[{start:0,end:y.duration}]),(3!==y.readyState||y.isHTML5)&&r.whileloading&&r.whileloading.apply(y)},this._whileplaying=function(t,i,n,r,o){var a,s=y._iO;return!isNaN(t)&&null!==t&&(y.position=Math.max(0,t),y._processOnPosition(),!y.isHTML5&&d>8&&(s.usePeakData&&i!==e&&i&&(y.peakData={left:i.leftPeak,right:i.rightPeak}),s.useWaveformData&&n!==e&&n&&(y.waveformData={left:n.split(","),right:r.split(",")}),s.useEQData&&o!==e&&o&&o.leftEQ&&(a=o.leftEQ.split(","),y.eqData=a,y.eqData.left=a,o.rightEQ!==e&&o.rightEQ&&(y.eqData.right=o.rightEQ.split(",")))),
1===y.playState&&(y.isHTML5||8!==d||y.position||!y.isBuffering||y._onbufferchange(0),s.whileplaying&&s.whileplaying.apply(y)),!0)},this._oncaptiondata=function(t){yt._wD(y.id+": Caption data received."),y.captiondata=t,y._iO.oncaptiondata&&y._iO.oncaptiondata.apply(y,[t])},this._onmetadata=function(t,e){yt._wD(y.id+": Metadata received.");var i,n,r={};for(i=0,n=t.length;i<n;i++)r[t[i]]=e[i];y.metadata=r,console.log("updated metadata",y.metadata),y._iO.onmetadata&&y._iO.onmetadata.call(y,y.metadata)},this._onid3=function(t,e){yt._wD(y.id+": ID3 data received.");var i,n,r=[];for(i=0,n=t.length;i<n;i++)r[t[i]]=e[i];y.id3=f(y.id3,r),y._iO.onid3&&y._iO.onid3.apply(y)},this._onconnect=function(t){t=1===t,yt._wD(y.id+": "+(t?"Connected.":"Failed to connect? - "+y.url),t?1:2),y.connected=t,t&&(y.failures=0,X(y.id)&&(y.getAutoPlay()?y.play(e,y.getAutoPlay()):y._iO.autoLoad&&y.load()),y._iO.onconnect&&y._iO.onconnect.apply(y,[t]))},this._ondataerror=function(t){y.playState>0&&(yt._wD(y.id+": Data error: "+t),y._iO.ondataerror&&y._iO.ondataerror.apply(y))},this._debug()},E=function(){return Tt.body||Tt.getElementsByTagName("div")[0]},s=function(t){return Tt.getElementById(t)},f=function(t,i){var n,r,o=t||{};n=i===e?yt.defaultOptions:i;for(r in n)n.hasOwnProperty(r)&&o[r]===e&&("object"!=typeof n[r]||null===n[r]?o[r]=n[r]:o[r]=f(o[r],n[r]));return o},ft=function(e,i){e.isHTML5||8!==d?i():t.setTimeout(i,0)},m={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},y=function(t,i){var n,r=!0,o=i!==e,a=yt.setupOptions,s=m;if(t===e){r=[];for(n in a)a.hasOwnProperty(n)&&r.push(n);for(n in s)s.hasOwnProperty(n)&&("object"==typeof yt[n]?r.push(n+": {...}"):yt[n]instanceof Function?r.push(n+": function() {...}"):r.push(n));return yt._wD(U("setup",r.join(", "))),!1}for(n in t)if(t.hasOwnProperty(n))if("object"!=typeof t[n]||null===t[n]||t[n]instanceof Array||t[n]instanceof RegExp)o&&s[i]!==e?yt[i][n]=t[n]:a[n]!==e?(yt.setupOptions[n]=t[n],yt[n]=t[n]):s[n]===e?(Y(U(yt[n]===e?"setupUndef":"setupError",n),2),r=!1):yt[n]instanceof Function?yt[n].apply(yt,t[n]instanceof Array?t[n]:[t[n]]):yt[n]=t[n];else{if(s[n]!==e)return y(t[n],n);Y(U(yt[n]===e?"setupUndef":"setupError",n),2),r=!1}return r},st=function(){function e(t){var e=Ht.call(t),i=e.length;return o?(e[1]="on"+e[1],i>3&&e.pop()):3===i&&e.push(!1),e}function i(t,e){var i=t.shift(),n=[a[e]];o?i[n](t[0],t[1]):i[n].apply(i,t)}function n(){i(e(arguments),"add")}function r(){i(e(arguments),"remove")}var o=t.attachEvent,a={add:o?"attachEvent":"addEventListener",remove:o?"detachEvent":"removeEventListener"};return{add:n,remove:r}}(),ct={abort:o(function(){yt._wD(this._s.id+": abort")}),canplay:o(function(){var t,i=this._s;if(i._html5_canplay)return!0;if(i._html5_canplay=!0,yt._wD(i.id+": canplay"),i._onbufferchange(0),t=i._iO.position===e||isNaN(i._iO.position)?null:i._iO.position/1e3,this.currentTime!==t){yt._wD(i.id+": canplay: Setting position to "+t);try{this.currentTime=t}catch(e){yt._wD(i.id+": canplay: Setting position of "+t+" failed: "+e.message,2)}}i._iO._oncanplay&&i._iO._oncanplay()}),canplaythrough:o(function(){var t=this._s;t.loaded||(t._onbufferchange(0),t._whileloading(t.bytesLoaded,t.bytesTotal,t._get_html5_duration()),t._onload(!0))}),durationchange:o(function(){var t,e=this._s;t=e._get_html5_duration(),isNaN(t)||t===e.duration||(yt._wD(this._s.id+": durationchange ("+t+")"+(e.duration?", previously "+e.duration:"")),e.durationEstimate=e.duration=t)}),ended:o(function(){var t=this._s;yt._wD(t.id+": ended"),t._onfinish()}),error:o(function(){yt._wD(this._s.id+": HTML5 error, code "+this.error.code),this._s._onload(!1)}),loadeddata:o(function(){var t=this._s;yt._wD(t.id+": loadeddata"),t._loaded||qt||(t.duration=t._get_html5_duration())}),loadedmetadata:o(function(){yt._wD(this._s.id+": loadedmetadata")}),loadstart:o(function(){yt._wD(this._s.id+": loadstart"),this._s._onbufferchange(1)}),play:o(function(){this._s._onbufferchange(0)}),playing:o(function(){yt._wD(this._s.id+": playing "+String.fromCharCode(9835)),this._s._onbufferchange(0)}),progress:o(function(t){var e,i,n,r=this._s,o=0,a="progress"===t.type,s=t.target.buffered,l=t.loaded||0,h=t.total||1;if(r.buffered=[],s&&s.length){for(e=0,i=s.length;e<i;e++)r.buffered.push({start:1e3*s.start(e),end:1e3*s.end(e)});if(o=1e3*(s.end(0)-s.start(0)),l=Math.min(1,o/(1e3*t.target.duration)),a&&s.length>1){for(n=[],i=s.length,e=0;e<i;e++)n.push(1e3*t.target.buffered.start(e)+"-"+1e3*t.target.buffered.end(e));yt._wD(this._s.id+": progress, timeRanges: "+n.join(", "))}a&&!isNaN(l)&&yt._wD(this._s.id+": progress, "+Math.floor(100*l)+"% loaded")}isNaN(l)||(r._whileloading(l,h,r._get_html5_duration()),l&&h&&l===h&&ct.canplaythrough.call(this,t))}),ratechange:o(function(){yt._wD(this._s.id+": ratechange")}),suspend:o(function(t){var e=this._s;yt._wD(this._s.id+": suspend"),ct.progress.call(this,t),e._onsuspend()}),stalled:o(function(){yt._wD(this._s.id+": stalled")}),timeupdate:o(function(){this._s._onTimer()}),waiting:o(function(){var t=this._s;yt._wD(this._s.id+": waiting"),t._onbufferchange(1)})},et=function(t){return!(!t||!(t.type||t.url||t.serverURL))&&(!(t.serverURL||t.type&&r(t.type))&&(t.type?it({type:t.type}):it({url:t.url})||yt.html5Only||t.url.match(/data\:/i)))},rt=function(t){var e;return t&&(e=qt?"about:blank":yt.html5.canPlayType("audio/wav")?"data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==":"about:blank",t.src=e,void 0!==t._called_unload&&(t._called_load=!1)),Wt&&(lt=null),e},it=function(t){if(!yt.useHTML5Audio||!yt.hasHTML5)return!1;var i,n,o,a,s=t.url||null,l=t.type||null,h=yt.audioFormats;if(l&&yt.html5[l]!==e)return yt.html5[l]&&!r(l);if(!nt){nt=[];for(a in h)h.hasOwnProperty(a)&&(nt.push(a),h[a].related&&(nt=nt.concat(h[a].related)));nt=new RegExp("\\.("+nt.join("|")+")(\\?.*)?$","i")}return o=s?s.toLowerCase().match(nt):null,o&&o.length?o=o[1]:l?(n=l.indexOf(";"),o=(-1!==n?l.substr(0,n):l).substr(6)):i=!1,o&&yt.html5[o]!==e?i=yt.html5[o]&&!r(o):(l="audio/"+o,i=yt.html5.canPlayType({type:l}),yt.html5[o]=i,i=i&&yt.html5[l]&&!r(l)),i},at=function(){function t(t){var e,i,n=!1,r=!1;if(!a||"function"!=typeof a.canPlayType)return n;if(t instanceof Array){for(o=0,i=t.length;o<i;o++)(yt.html5[t[o]]||a.canPlayType(t[o]).match(yt.html5Test))&&(r=!0,yt.html5[t[o]]=!0,yt.flash[t[o]]=!!t[o].match(ne));n=r}else e=!(!a||"function"!=typeof a.canPlayType)&&a.canPlayType(t),n=!(!e||!e.match(yt.html5Test));return n}if(!yt.useHTML5Audio||!yt.hasHTML5)return yt.html5.usingFlash=!0,Vt=!0,!1;var i,n,r,o,a=Audio!==e?Zt&&opera.version()<10?new Audio(null):new Audio:null,s={};r=yt.audioFormats;for(i in r)if(r.hasOwnProperty(i)&&(n="audio/"+i,s[i]=t(r[i].type),s[n]=s[i],i.match(ne)?(yt.flash[i]=!0,yt.flash[n]=!0):(yt.flash[i]=!1,yt.flash[n]=!1),r[i]&&r[i].related))for(o=r[i].related.length-1;o>=0;o--)s["audio/"+r[i].related[o]]=s[i],yt.html5[r[i].related[o]]=s[i],yt.flash[r[i].related[o]]=s[i];return s.canPlayType=a?t:null,yt.html5=f(yt.html5,s),yt.html5.usingFlash=tt(),Vt=yt.html5.usingFlash,!0},_={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:St+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:bt+"Verify that %s is a valid path.",tryDebug:"Try "+St+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:bt+"Non-HTTP page ("+Tt.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:bt+"Special case: Waiting for SWF to load with window focus...",waitForever:bt+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:bt+"Waiting for 100% SWF load...",needFunction:bt+"Function object expected for %s",badID:'Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:bt+"_debug(): Current sound objects",waitOnload:bt+"Waiting for window.onload()",docLoaded:bt+"Document already loaded",onload:bt+"initComplete(): calling soundManager.onload()",onloadOK:St+".onload() complete",didInit:bt+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:bt+"Failed to remove Flash node.",shutdown:St+".disable(): Shutting down",queue:bt+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+W.swfTimedout+" CSS...",fbLoaded:"Flash loaded",fbHandler:bt+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:St+".load(): current URL already assigned.",badFV:St+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:bt+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:bt+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:St+".setup(): allowed parameters: %s",setupError:St+'.setup(): "%s" cannot be assigned with this method.',setupUndef:St+'.setup(): Could not find option "%s"',setupLate:St+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:bt+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready. "+String.fromCharCode(10003),reset:St+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device."},U=function(){var t,e,i,n,r;if(t=Ht.call(arguments),n=t.shift(),(r=_&&_[n]?_[n]:"")&&t&&t.length)for(e=0,i=t.length;e<i;e++)r=r.replace("%s",t[e]);return r},z=function(t){return 8===d&&t.loops>1&&t.stream&&(p("as2loop"),t.stream=!1),t},j=function(t,e){return t&&!t.usePolicyFile&&(t.onid3||t.usePeakData||t.useWaveformData||t.useEQData)&&(yt._wD((e||"")+U("policy")),t.usePolicyFile=!0),t},Y=function(t){$t&&console.warn!==e?console.warn(t):yt._wD(t)},l=function(){return!1},L=function(t){var e;for(e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(t[e]=l);e=null},R=function(t){t===e&&(t=!1),(Dt||t)&&yt.disable(t)},N=function(t){var e;if(t)if(t.match(/\.swf(\?.*)?$/i)){if(t.substr(t.toLowerCase().lastIndexOf(".swf?")+4))return t}else t.lastIndexOf("/")!==t.length-1&&(t+="/");return e=(t&&-1!==t.lastIndexOf("/")?t.substr(0,t.lastIndexOf("/")+1):"./")+yt.movieURL,yt.noSWFCache&&(e+="?ts="+(new Date).getTime()),e},T=function(){8!==(d=parseInt(yt.flashVersion,10))&&9!==d&&(yt._wD(U("badFV",d,8)),yt.flashVersion=d=8);var t=yt.debugMode||yt.debugFlash?"_debug.swf":".swf";yt.useHTML5Audio&&!yt.html5Only&&yt.audioFormats.mp4.required&&d<9&&(yt._wD(U("needfl9")),yt.flashVersion=d=9),yt.version=yt.versionNumber+(yt.html5Only?" (HTML5-only mode)":9===d?" (AS3/Flash 9)":" (AS2/Flash 8)"),d>8?(yt.defaultOptions=f(yt.defaultOptions,yt.flash9Options),yt.features.buffering=!0,yt.defaultOptions=f(yt.defaultOptions,yt.movieStarOptions),yt.filePatterns.flash9=new RegExp("\\.(mp3|"+se.join("|")+")(\\?.*)?$","i"),yt.features.movieStar=!0):yt.features.movieStar=!1,yt.filePattern=yt.filePatterns[8!==d?"flash9":"flash8"],yt.movieURL=(8===d?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",t),yt.features.peakData=yt.features.waveformData=yt.features.eqData=d>8},O=function(t,e){if(!Ct)return!1;Ct._setPolling(t,e)},B=function(){if(yt.debugURLParam.test(xt)&&(yt.debugMode=!0),s(yt.debugID))return!1;var t,e,i,n,r;if(yt.debugMode&&!s(yt.debugID)&&(!$t||!yt.useConsole||!yt.consoleOnly)){t=Tt.createElement("div"),t.id=yt.debugID+"-toggle",n={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},t.appendChild(Tt.createTextNode("-")),t.onclick=K,t.title="Toggle SM2 debug console",wt.match(/msie 6/i)&&(t.style.position="absolute",t.style.cursor="hand");for(r in n)n.hasOwnProperty(r)&&(t.style[r]=n[r]);if(e=Tt.createElement("div"),e.id=yt.debugID,e.style.display=yt.debugMode?"block":"none",yt.debugMode&&!s(t.id)){try{i=E(),i.appendChild(t)}catch(t){throw new Error(U("domError")+" \n"+t.toString())}i.appendChild(e)}}i=null},X=this.getSoundById,p=function(t,e){return t?yt._wD(U(t),e):""},K=function(){var t=s(yt.debugID),e=s(yt.debugID+"-toggle");if(!t)return!1;_t?(e.innerHTML="+",t.style.display="none"):(e.innerHTML="-",t.style.display="block"),_t=!_t},c=function(i,n,r){if(t.sm2Debugger!==e)try{sm2Debugger.handleEvent(i,n,r)}catch(t){return!1}return!0},H=function(){var t=[];return yt.debugMode&&t.push(W.sm2Debug),yt.debugFlash&&t.push(W.flashDebug),yt.useHighPerformance&&t.push(W.highPerf),t.join(" ")},V=function(){var t=U("fbHandler"),e=yt.getMoviePercent(),i=W,n={type:"FLASHBLOCK"};if(yt.html5Only)return!1;yt.ok()?(yt.didFlashBlock&&yt._wD(t+": Unblocked"),yt.oMC&&(yt.oMC.className=[H(),i.swfDefault,i.swfLoaded+(yt.didFlashBlock?" "+i.swfUnblocked:"")].join(" "))):(Vt&&(yt.oMC.className=H()+" "+i.swfDefault+" "+(null===e?i.swfTimedout:i.swfError),yt._wD(t+": "+U("fbTimeout")+(e?" ("+U("fbLoaded")+")":""))),yt.didFlashBlock=!0,S({type:"ontimeout",ignoreInit:!0,error:n}),G(n))},C=function(t,i,n){Mt[t]===e&&(Mt[t]=[]),Mt[t].push({method:i,scope:n||null,fired:!1})},S=function(t){if(t||(t={type:yt.ok()?"onready":"ontimeout"}),!kt&&t&&!t.ignoreInit)return!1;if("ontimeout"===t.type&&(yt.ok()||Dt&&!t.ignoreInit))return!1;var e,i,n={success:t&&t.ignoreInit?yt.ok():!Dt},r=t&&t.type?Mt[t.type]||[]:[],o=[],a=[n],s=Vt&&!yt.ok();for(t.error&&(a[0].error=t.error),e=0,i=r.length;e<i;e++)!0!==r[e].fired&&o.push(r[e]);if(o.length)for(e=0,i=o.length;e<i;e++)o[e].scope?o[e].method.apply(o[e].scope,a):o[e].method.apply(this,a),s||(o[e].fired=!0);return!0},b=function(){t.setTimeout(function(){yt.useFlashBlock&&V(),S(),"function"==typeof yt.onload&&(p("onload",1),yt.onload.apply(t),p("onloadOK",1)),yt.waitForWindowLoad&&st.add(t,"load",b)},1)},ut=function(){if(ht!==e)return ht;var i,n,r,o=!1,a=navigator,s=a.plugins,l=t.ActiveXObject;if(s&&s.length)n="application/x-shockwave-flash",(r=a.mimeTypes)&&r[n]&&r[n].enabledPlugin&&r[n].enabledPlugin.description&&(o=!0);else if(l!==e&&!wt.match(/MSAppHost/i)){try{i=new l("ShockwaveFlash.ShockwaveFlash")}catch(t){i=null}o=!!i,i=null}return ht=o,o},tt=function(){var t,e,i=yt.audioFormats;if(zt&&!!wt.match(/os (1|2|3_0|3_1)\s/i)?(yt.hasHTML5=!1,yt.html5Only=!0,yt.oMC&&(yt.oMC.style.display="none")):yt.useHTML5Audio&&(yt.html5&&yt.html5.canPlayType||(yt._wD("SoundManager: No HTML5 Audio() support detected."),yt.hasHTML5=!1),Qt&&yt._wD(bt+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(ht?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1)),yt.useHTML5Audio&&yt.hasHTML5){$=!0;for(e in i)i.hasOwnProperty(e)&&i[e].required&&(yt.html5.canPlayType(i[e].type)?yt.preferFlash&&(yt.flash[e]||yt.flash[i[e].type])&&(t=!0):($=!1,t=!0))}return yt.ignoreFlash&&(t=!1,$=!0),yt.html5Only=yt.hasHTML5&&yt.useHTML5Audio&&!t,!yt.html5Only},Q=function(t){var e,i,n,r=0;if(t instanceof Array){for(e=0,i=t.length;e<i;e++)if(t[e]instanceof Object){if(yt.canPlayMIME(t[e].type)){r=e;break}}else if(yt.canPlayURL(t[e])){r=e;break}t[r].url&&(t[r]=t[r].url),n=t[r]}else n=t;return n},q=function(t){t._hasTimer||(t._hasTimer=!0,!Jt&&yt.html5PollingInterval&&(null===Nt&&0===Rt&&(Nt=setInterval(J,yt.html5PollingInterval)),Rt++))},Z=function(t){t._hasTimer&&(t._hasTimer=!1,!Jt&&yt.html5PollingInterval&&Rt--)},J=function(){var t;if(null!==Nt&&!Rt)return clearInterval(Nt),Nt=null,!1;for(t=yt.soundIDs.length-1;t>=0;t--)yt.sounds[yt.soundIDs[t]].isHTML5&&yt.sounds[yt.soundIDs[t]]._hasTimer&&yt.sounds[yt.soundIDs[t]]._onTimer()},G=function(i){i=i!==e?i:{},"function"==typeof yt.onerror&&yt.onerror.apply(t,[{type:i.type!==e?i.type:null}]),i.fatal!==e&&i.fatal&&yt.disable()},dt=function(){if(!Qt||!ut())return!1;var t,e,i=yt.audioFormats;for(e in i)if(i.hasOwnProperty(e)&&("mp3"===e||"mp4"===e)&&(yt._wD(St+": Using flash fallback for "+e+" format"),yt.html5[e]=!1,i[e]&&i[e].related))for(t=i[e].related.length-1;t>=0;t--)yt.html5[i[e].related[t]]=!1},this._setSandboxType=function(t){var i=yt.sandbox;i.type=t,i.description=i.types[i.types[t]!==e?t:"unknown"],"localWithFile"===i.type?(i.noRemote=!0,i.noLocal=!1,p("secNote",2)):"localWithNetwork"===i.type?(i.noRemote=!1,i.noLocal=!0):"localTrusted"===i.type&&(i.noRemote=!1,i.noLocal=!1)},this._externalInterfaceOK=function(t){if(yt.swfLoaded)return!1;var e;if(c("swf",!0),c("flashtojs",!0),yt.swfLoaded=!0,ee=!1,Qt&&dt(),!t||t.replace(/\+dev/i,"")!==yt.versionNumber.replace(/\+dev/i,""))return e=St+': Fatal: JavaScript file build "'+yt.versionNumber+'" does not match Flash SWF build "'+t+'" at '+yt.url+". Ensure both are up-to-date.",setTimeout(function(){throw new Error(e)},0),!1;setTimeout(u,Yt?100:1)},I=function(t,i){function n(){var t,e=[],i=[];t="SoundManager "+yt.version+(!yt.html5Only&&yt.useHTML5Audio?yt.hasHTML5?" + HTML5 audio":", no HTML5 audio support":""),yt.html5Only?yt.html5PollingInterval&&e.push("html5PollingInterval ("+yt.html5PollingInterval+"ms)"):(yt.preferFlash&&e.push("preferFlash"),yt.useHighPerformance&&e.push("useHighPerformance"),yt.flashPollingInterval&&e.push("flashPollingInterval ("+yt.flashPollingInterval+"ms)"),yt.html5PollingInterval&&e.push("html5PollingInterval ("+yt.html5PollingInterval+"ms)"),yt.wmode&&e.push("wmode ("+yt.wmode+")"),yt.debugFlash&&e.push("debugFlash"),yt.useFlashBlock&&e.push("flashBlock")),e.length&&(i=i.concat([e.join(" + ")])),yt._wD(t+(i.length?" + "+i.join(", "):""),1),pt()}function r(t,e){return'<param name="'+t+'" value="'+e+'" />'}if(Pt&&At)return!1;if(yt.html5Only)return T(),n(),yt.oMC=s(yt.movieID),u(),Pt=!0,At=!0,!1;var o,a,l,h,d,c,p,g,f=i||yt.url,y=yt.altURL||f,m=E(),C=H(),S=null,b=Tt.getElementsByTagName("html")[0];if(S=b&&b.dir&&b.dir.match(/rtl/i),t=t===e?yt.id:t,T(),yt.url=N(re?f:y),i=yt.url,yt.wmode=!yt.wmode&&yt.useHighPerformance?"transparent":yt.wmode,null!==yt.wmode&&(wt.match(/msie 8/i)||!Yt&&!yt.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Ut.push(_.spcWmode),yt.wmode=null),o={name:t,id:t,src:i,quality:"high",allowScriptAccess:yt.allowScriptAccess,bgcolor:yt.bgColor,pluginspage:oe+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:yt.wmode,hasPriority:"true"},yt.debugFlash&&(o.FlashVars="debug=1"),yt.wmode||delete o.wmode,Yt)a=Tt.createElement("div"),h=['<object id="'+t+'" data="'+i+'" type="'+o.type+'" title="'+o.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+oe+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',r("movie",i),r("AllowScriptAccess",yt.allowScriptAccess),r("quality",o.quality),yt.wmode?r("wmode",yt.wmode):"",r("bgcolor",yt.bgColor),r("hasPriority","true"),yt.debugFlash?r("FlashVars",o.FlashVars):"","</object>"].join("");else{a=Tt.createElement("embed");for(l in o)o.hasOwnProperty(l)&&a.setAttribute(l,o[l])}if(B(),C=H(),m=E())if(yt.oMC=s(yt.movieID)||Tt.createElement("div"),yt.oMC.id)g=yt.oMC.className,yt.oMC.className=(g?g+" ":W.swfDefault)+(C?" "+C:""),yt.oMC.appendChild(a),Yt&&(d=yt.oMC.appendChild(Tt.createElement("div")),d.className=W.swfBox,d.innerHTML=h),At=!0;else{if(yt.oMC.id=yt.movieID,yt.oMC.className=W.swfDefault+" "+C,c=null,d=null,yt.useFlashBlock||(yt.useHighPerformance?c={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(c={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},S&&(c.left=Math.abs(parseInt(c.left,10))+"px"))),Xt&&(yt.oMC.style.zIndex=1e4),!yt.debugFlash)for(p in c)c.hasOwnProperty(p)&&(yt.oMC.style[p]=c[p]);try{Yt||yt.oMC.appendChild(a),m.appendChild(yt.oMC),Yt&&(d=yt.oMC.appendChild(Tt.createElement("div")),d.className=W.swfBox,d.innerHTML=h),At=!0}catch(t){throw new Error(U("domError")+" \n"+t.toString())}}return Pt=!0,n(),!0},P=function(){return yt.html5Only?(I(),!1):!Ct&&(yt.url?(Ct=yt.getMovie(yt.id),Ct||(Gt?(Yt?yt.oMC.innerHTML=Ot:yt.oMC.appendChild(Gt),Gt=null,Pt=!0):I(yt.id,yt.url),Ct=yt.getMovie(yt.id)),"function"==typeof yt.oninitmovie&&setTimeout(yt.oninitmovie,1),gt(),!0):(p("noURL"),!1))},v=function(){setTimeout(w,1e3)},x=function(){t.setTimeout(function(){Y(bt+"useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false..."),yt.setup({preferFlash:!1}).reboot(),yt.didFlashBlock=!0,yt.beginDelayedInit()},1)},w=function(){var e,i=!1;return!!yt.url&&(!Bt&&(Bt=!0,st.remove(t,"load",v),ht&&ee&&!te?(p("waitFocus"),!1):(kt||(e=yt.getMoviePercent())>0&&e<100&&(i=!0),void setTimeout(function(){if(e=yt.getMoviePercent(),i)return Bt=!1,yt._wD(U("waitSWF")),t.setTimeout(v,1),!1;kt||(yt._wD(St+": No Flash response within expected time. Likely causes: "+(0===e?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(yt.debugFlash?" "+U("checkSWF"):""),2),!re&&e&&(p("localFail",2),yt.debugFlash||p("tryDebug",2)),0===e&&yt._wD(U("swf404",yt.url),1),c("flashtojs",!1," (Check flash security or flash blockers)")),!kt&&ie&&(null===e?yt.useFlashBlock||0===yt.flashLoadTimeout?(yt.useFlashBlock&&V(),p("waitForever")):!yt.useFlashBlock&&$?x():(p("waitForever"),S({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}})):0===yt.flashLoadTimeout?p("waitForever"):!yt.useFlashBlock&&$?x():R(!0))},yt.flashLoadTimeout))))},M=function(){function e(){st.remove(t,"focus",M)}return te||!ee?(e(),!0):(ie=!0,te=!0,p("gotFocus"),Bt=!1,v(),e(),!0)},gt=function(){Ut.length&&(yt._wD("SoundManager 2: "+Ut.join(" "),1),Ut=[])},pt=function(){gt();var t,e=[];if(yt.useHTML5Audio&&yt.hasHTML5){for(t in yt.audioFormats)yt.audioFormats.hasOwnProperty(t)&&e.push(t+" = "+yt.html5[t]+(!yt.html5[t]&&Vt&&yt.flash[t]?" (using flash)":yt.preferFlash&&yt.flash[t]&&Vt?" (preferring flash)":yt.html5[t]?"":" ("+(yt.audioFormats[t].required?"required, ":"")+"and no flash support)"));yt._wD("SoundManager 2 HTML5 support: "+e.join(", "),1)}},g=function(e){if(kt)return!1;if(yt.html5Only)return p("sm2Loaded",1),kt=!0,b(),c("onload",!0),!0;var i,n=yt.useFlashBlock&&yt.flashLoadTimeout&&!yt.getMoviePercent(),r=!0;return n||(kt=!0),i={type:!ht&&Vt?"NO_FLASH":"INIT_TIMEOUT"},yt._wD("SoundManager 2 "+(Dt?"failed to load":"loaded")+" ("+(Dt?"Flash security/load error":"OK")+") "+String.fromCharCode(Dt?10006:10003),Dt?2:1),Dt||e?(yt.useFlashBlock&&yt.oMC&&(yt.oMC.className=H()+" "+(null===yt.getMoviePercent()?W.swfTimedout:W.swfError)),S({type:"ontimeout",error:i,ignoreInit:!0}),c("onload",!1),G(i),r=!1):c("onload",!0),Dt||(yt.waitForWindowLoad&&!Ft?(p("waitOnload"),st.add(t,"load",b)):(yt.waitForWindowLoad&&Ft&&p("docLoaded"),b())),r},h=function(){var t,i=yt.setupOptions;for(t in i)i.hasOwnProperty(t)&&(yt[t]===e?yt[t]=i[t]:yt[t]!==i[t]&&(yt.setupOptions[t]=yt[t]))},u=function(){function e(){st.remove(t,"load",yt.beginDelayedInit)}if(kt)return p("didInit"),!1;if(yt.html5Only)return kt||(e(),yt.enabled=!0,g()),!0;P();try{Ct._externalInterfaceTest(!1),O(!0,yt.flashPollingInterval||(yt.useHighPerformance?10:50)),yt.debugMode||Ct._disableDebug(),yt.enabled=!0,c("jstoflash",!0),yt.html5Only||st.add(t,"unload",l)}catch(t){return yt._wD("js/flash exception: "+t.toString()),c("jstoflash",!1),G({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),R(!0),g(),!1}return g(),e(),!0},k=function(){return!F&&(F=!0,h(),B(),function(){var t="sm2-usehtml5audio=",e="sm2-preferflash=",i=null,n=null,r=xt.toLowerCase();-1!==r.indexOf(t)&&(i="1"===r.charAt(r.indexOf(t)+t.length),$t&&console.log((i?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),yt.setup({useHTML5Audio:i})),-1!==r.indexOf(e)&&(n="1"===r.charAt(r.indexOf(e)+e.length),$t&&console.log((n?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),yt.setup({preferFlash:n}))}(),!ht&&yt.hasHTML5&&(yt._wD("SoundManager 2: No Flash detected"+(yt.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5."),1),yt.setup({useHTML5Audio:!0,preferFlash:!1})),at(),!ht&&Vt&&(Ut.push(_.needFlash),yt.setup({flashLoadTimeout:1})),Tt.removeEventListener&&Tt.removeEventListener("DOMContentLoaded",k,!1),P(),!0)},ot=function(){return"complete"===Tt.readyState&&(k(),Tt.detachEvent("onreadystatechange",ot)),!0},D=function(){Ft=!0,k(),st.remove(t,"load",D)},A=function(){Jt&&(yt.setupOptions.useHTML5Audio&&!yt.setupOptions.preferFlash||Ut.push(_.mobileUA),yt.setupOptions.useHTML5Audio=!0,yt.setupOptions.preferFlash=!1,(zt||jt&&!wt.match(/android\s2\.3/i))&&(Ut.push(_.globalHTML5),zt&&(yt.ignoreFlash=!0),Wt=!0))},A(),ut(),st.add(t,"focus",M),st.add(t,"load",v),st.add(t,"load",D),Tt.addEventListener?Tt.addEventListener("DOMContentLoaded",k,!1):Tt.attachEvent?Tt.attachEvent("onreadystatechange",ot):(c("onload",!1),G({type:"NO_DOM2_EVENTS",fatal:!0}))}if(!t||!t.document)throw new Error("SoundManager requires a browser with window and document objects.");var n=null;void 0!==t.SM2_DEFER&&SM2_DEFER||(n=new i),"object"==typeof module&&module&&"object"==typeof module.exports?(t.soundManager=n,module.exports.SoundManager=i,module.exports.soundManager=n):"function"==typeof define&&define.amd?define("SoundManager",[],function(){return{SoundManager:i,soundManager:n}}):(t.SoundManager=i,t.soundManager=n)}(window),define("Managers/ExceptionManager",["gameconfig","Managers/TelemetryManager"],function(t,e){"use strict";return{throttleByMessageNextLogInstant:new Map,throttleByNameNextLogInstant:new Map,throttleByStackNextLogInstant:new Map,throttleCooldownMilliseconds:6e4,getErrorCategory:function(t){var e={matchValue:"",throttleMap:null};if(void 0!==t.message&&null!==t.message&&""!==t.message)e.matchValue=t.message,e.throttleMap=this.throttleByMessageNextLogInstant;else if(void 0!==t.name&&null!==t.name&&""!==t.name)e.matchValue=t.name,e.throttleMap=this.throttleByNameNextLogInstant;else if(void 0!==t.stack){var i=String(t.stack);null!==i&&""!==i&&(e.matchValue=i,e.throttleMap=this.throttleByStackNextLogInstant)}return e},isErrorThrottled:function(t){return!(null===t.throttleMap||!t.throttleMap.has(t.matchValue))&&t.throttleMap.get(t.matchValue)>=Date.now()},onErrorHandler:function(t,i,n,r,o){if(o){var a=this.getErrorCategory(o);if(this.isErrorThrottled(a))return!0;if(null!==a.throttleMap)return a.throttleMap.set(a.matchValue,Date.now()+this.throttleCooldownMilliseconds),e.appException(o||{}),!1}else t?e.appException(t||{}):e.appException("undefined")},initialize:function(){window.onerror=this.onErrorHandler.bind(this)}}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("ApplicationInsights",["exports"],e):e((t.Microsoft=t.Microsoft||{},t.Microsoft.ApplicationInsights=t.Microsoft.ApplicationInsights||{}))}(this,function(t){"use strict";function e(){return typeof globalThis!==Et&&globalThis?globalThis:typeof self!==Et&&self?self:typeof window!==Et&&window?window:typeof global!==Et&&global?global:null}function i(t){function e(){}var i=Object.create;if(i)return i(t);if(null==t)return{};var n=typeof t;if(n!==Ft&&n!==Dt)throw new TypeError("Object prototype may only be an Object:"+t);return e[It]=t,new e}function n(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object[It][Gt].call(e,r)&&(t[r]=e[r])}return t}function r(t,e){function n(){this.constructor=t}Ot(t,e),t[It]=null===e?i(e):(n[It]=e[It],new n)}function o(t){var e=$t();return e&&e[t]?e[t]:t===Ht&&a()?window:null}function a(){return Boolean(typeof window===Nt&&window)}function s(){return a()?window:o(Ht)}function l(){return Boolean(typeof document===Nt&&document)}function h(){return l()?document:o(Wt)}function u(){return Boolean(typeof navigator===Nt&&navigator)}function d(){return u()?navigator:o(Kt)}function c(){return Boolean(typeof history===Nt&&history)}function p(){return c()?history:o(zt)}function g(){return typeof location===Nt&&location?location:o(jt)}function f(){return typeof console!==Rt?console:o(Yt)}function y(){return o(Xt)}function m(){return Boolean(typeof JSON===Nt&&JSON||null!==o(qt))}function C(){return m()?JSON||o(qt):null}function S(){return o(Zt)}function b(){return o(Jt)}function v(){var t=d();return!(!t||!t.product)&&t.product===Qt}function w(t){t<0&&(t>>>=0),he=123456789+t&ae,ue=987654321-t&ae,le=!0}function x(){w(Math.random()*oe^(new Date).getTime())}function T(t,e){return typeof t===e}function M(t){return T(t,Et)||void 0===t}function _(t){return M(t)||null===t}function P(t,e){return t&&Object[It].hasOwnProperty.call(t,e)}function A(t){return T(t,Ft)}function k(t){return T(t,Dt)}function D(t,e,i,n){void 0===n&&(n=!1);var r=!1;if(!_(t))try{_(t[ie])?_(t[ee])||(t[ee](te+e,i),r=!0):(t[ie](e,i,n),r=!0)}catch(t){}return r}function F(t,e,i,n){if(void 0===n&&(n=!1),!_(t))try{_(t[re])?_(t[ne])||t[ne](te+e,i):t[re](e,i,n)}catch(t){}}function E(t,e,i,n){var r=Object.defineProperty;if(r)try{var o={enumerable:!0,configurable:!0};return i&&(o.get=i),n&&(o.set=n),r(t,e,o),!0}catch(t){}return!1}function I(t){var e=t,i=/([^\w\d_$])/g;return i.test(t)&&(e=t.replace(i,"_")),e}function G(t,e){if(t&&A(t))for(var i in t)P(t,i)&&e.call(t,i,t[i])}function O(t,e,i){if(t&&e&&t!==e&&A(t)&&A(e)){for(var n in e)!function(n){if(de.isString(n)){var r=e[n];k(r)?i&&!i(n,!0,e,t)||(t[n]=function(t){return function(){var i=arguments;return e[t].apply(e,i)}}(n)):i&&!i(n,!1,e,t)||(P(t,n)&&delete t[n],E(t,n,function(){return e[n]},function(t){e[n]=t})||(t[n]=r))}}(n)}return t}function B(t,e){return t&&Object[ye].hasOwnProperty.call(t,e)}function L(t){return typeof t===me}function R(t){return t&&(t===Object[ye]||t===Array[ye])}function N(t){return R(t)||t===Function[ye]}function U(t){if(t){if(ke)return ke(t);var e=t[_e]||t[ye]||t[fe];if(e)return e}return null}function V(t,e,i){return e!==fe&&L(t[e])&&(i||B(t,e))}function H(t){throw new TypeError("DynamicProto: "+t)}function W(t){var e={};for(var i in t)!e[i]&&V(t,i,!1)&&(e[i]=t[i]);return e}function K(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return!0;return!1}function z(t,e,i,n){function r(t,e,i){var r=e[a];if(r[Se]&&n){var o=t[Ce]||{};!1!==o[xe]&&(r=(o[e[be]]||{})[i]||r)}return function(){return r.apply(t,arguments)}}var o={};for(var a in i)o[a]=r(e,i,a);for(var s=U(t),l=[];s&&!N(s)&&!K(l,s);){for(var a in s)!o[a]&&V(s,a,!ke)&&(o[a]=r(e,s,a));l.push(s),s=U(s)}return o}function j(t,e,i,n){var r=null;if(t&&B(i,be)){var o=t[Ce]||{};if(r=(o[i[be]]||{})[e],r||H("Missing ["+e+"] "+me),!r[we]&&!1!==o[xe]){for(var a=!B(t,e),s=U(t),l=[];a&&s&&!N(s)&&!K(l,s);){var h=s[e];if(h){a=h===n;break}l.push(s),s=U(s)}try{a&&(t[e]=r),r[we]=1}catch(t){o[xe]=!1}}}return r}function Y(t,e,i){var n=e[t];return n===i&&(n=U(e)[t]),L(n)||H("["+t+"] is not a "+me),n}function X(t,e,i,n,r){if(!R(t)){var o=i[Ce]=i[Ce]||{},a=o[e]=o[e]||{};!1!==o[xe]&&(o[xe]=!!r);for(var s in i)V(i,s,!1)&&i[s]!==n[s]&&(a[s]=i[s],delete i[s],(!B(t,s)||t[s]&&!t[s][Se])&&(t[s]=function(t,e){var i=function(){return(j(this,e,t,i)||Y(e,t,i)).apply(this,arguments)};return i[Se]=1,i}(t,s)))}}function q(t,e){for(var i=U(e);i&&!N(i);){if(i===t)return!0;i=U(i)}return!1}function Z(t,e){return B(t,ye)?t.name||e||Me:((t||{})[fe]||{}).name||e||Me}function J(t,e,i,n){B(t,ye)||H("theClass is an invalid class definition.");var r=t[ye];q(r,e)||H("["+Z(t)+"] is not in class hierarchy of ["+Z(e)+"]");var o=null
;B(r,be)?o=r[be]:(o=ve+Z(t,"_")+"$"+De,De++,r[be]=o);var a=J[Te],s=!!a[Pe];s&&n&&void 0!==n[Pe]&&(s=!!n[Pe]);var l=W(e);i(e,z(r,e,l,s));var h=!!ke&&!!a[Ae];h&&n&&(h=!!n[Ae]),X(r,o,e,l,!1!==h)}function Q(t){return t?'"'+t.replace(/\"/g,"")+'"':""}function $(t,e,i,n,r){if(t){var o=t;if(o&&de.isFunction(o.getPerfMgr)&&(o=o.getPerfMgr()),o){var a=void 0,s=o.getCtx(Ve);try{if(a=o.create(e(),n,r)){if(s&&a.setCtx&&(a.setCtx(Ne.ParentContextKey,s),s.getCtx&&s.setCtx)){var l=s.getCtx(Ne.ChildrenContextKey);l||(l=[],s.setCtx(Ne.ChildrenContextKey,l)),l.push(a)}return o.setCtx(Ve,a),i(a)}}catch(t){a&&a.setCtx&&a.setCtx("exception",t)}finally{a&&o.fire(a),o.setCtx(Ve,s)}}}return i()}function tt(t,e){var i=[];if(t&&t.length>0)for(var n=null,r=0;r<t.length;r++){var o=t[r];if(o&&de.isFunction(o.processTelemetry)){var a=new We(o,e);i.push(a),n&&n.setNext(a),n=a}}return i.length>0?i[0]:null}function et(t,e,i){var n=[],r=!i;if(t)for(;t;){var o=t.getPlugin();(r||o===i)&&(r=!0,n.push(o)),t=t.getNext()}return r||n.push(i),tt(n,e)}function it(t,e,i){var n=t,r=!1;return i&&t&&(n=[],de.arrForEach(t,function(t){(r||t===i)&&(r=!0,n.push(t))})),i&&!r&&(n||(n=[]),n.push(i)),tt(n,e)}function nt(t,e){for(var i=[],n=null,r=t.getNext();r;){var o=r.getPlugin();o&&(n&&qe(n[Qe])&&qe(o[Ze])&&n[Qe](o),qe(o[$e])&&o[$e]()||i.push(o),n=o,r=r.getNext())}de.arrForEach(i,function(i){i.initialize(t.getCfg(),t.core(),e,t.getNext())})}function rt(t){return t.sort(function(t,e){var i=0,n=qe(e[Ze]);return qe(t[Ze])?i=n?t[Je]-e[Je]:1:n&&(i=-1),i})}function ot(t,e){if(t)for(var i=0;i<t.length&&!e(t[i],i);i++);}function at(t,e,i,n,r){r>=0&&r<=2&&ot(t,function(t,o){var a=t.cbks,s=a[ci[r]];if(s){e.ctx=function(){return n[o]=n[o]||{}};try{s.apply(e.inst,i)}catch(t){var l=e.err;try{var h=a[ci[2]];h&&(e.err=t,h.apply(e.inst,i))}catch(t){}finally{e.err=l}}}})}function st(t){return function(){function e(t,e){return ot(e,function(e){t.push(e)}),t}function i(t,i){r=e([],r),r[t]=i,l=e([a],r)}var n=this,r=arguments,o=t.h,a={name:t.n,inst:n,ctx:null,set:i},s=[],l=e([a],r);at(o,a,l,s,0);var h=t.f;try{a.rslt=h.apply(n,r)}catch(t){throw a.err=t,at(o,a,l,s,3),t}return at(o,a,l,s,1),a.rslt}}function lt(t){if(t){if(fi)return fi(t);var e=t[pi]||t[Ut]||t[gi];if(e)return e}return null}function ht(t,e,i){var n=null;return t&&(de.hasOwnProperty(t,e)?n=t:i&&(n=ht(lt(t),e,!1))),n}function ut(t,e,i){return t?dt(t[Ut],e,i,!1):null}function dt(t,e,i,n){if(void 0===n&&(n=!0),t&&e&&i){var r=ht(t,e,n);if(r){var o=r[e];if(typeof o===Vt){var a=o[di];if(!a){a={i:0,n:e,f:o,h:[]};var s=st(a);s[di]=a,r[e]=s}var l={id:a.i,cbks:i,rm:function(){var t=this.id;ot(a.h,function(e,i){if(e.id===t)return a.h.splice(i,1),1})}};return a.i++,a.h.push(l),l}}}return null}function ct(t,e){var i=t.length,n=i-e.length;return t.substring(n>=0?n:0,i)===e}function pt(t){return"hasFullStack"in t&&"typeName"in t}function gt(t){return"ver"in t&&"exceptions"in t&&"properties"in t}function ft(t){var e="";if(t&&!(e=t.typeName||t.name||""))try{var i=/function (.{1,})\(/,n=i.exec(t.constructor.toString());e=n&&n.length>1?n[1]:""}catch(t){}return e}function yt(t,e){t&&t.dispatchEvent&&e&&t.dispatchEvent(e)}function mt(t,e,i){return t&&i?(t[e]=i,t[e]):null}function Ct(t){try{return t.responseText}catch(t){}return null}function St(t,e,i){var n=0,r=t[e],o=t[i];return r&&o&&(n=Pi.GetDuration(r,o)),n}function bt(t,e,i,n,r){var o=0,a=St(i,n,r);return a&&(o=vt(t,e,xi.msToTimeSpan(a))),o}function vt(t,e,i){var n=0;if(t&&e&&i){(t.ajaxPerf=t.ajaxPerf||{})[e]=i,n=1}return n}function wt(t,e){var i=t.perfTiming,n=e[Jn]||{},r=0,o=de.isString,a="redirect",s=a+"Start",l=a="End";if(i){r|=bt(n,a,i,s,l),r|=bt(n,"domainLookup",i,"domainLookupStart","domainLookupEnd"),r|=bt(n,"connect",i,"connectStart","connectEnd"),r|=bt(n,"request",i,"requestStart","requestEnd"),r|=bt(n,"response",i,"responseStart","responseEnd"),r|=bt(n,"networkConnect",i,"startTime","connectEnd"),r|=bt(n,"sentRequest",i,"requestStart","responseEnd");var h=i.duration;h||(h=St(i,"startTime","responseEnd")||0),r|=vt(n,"duration",h),r|=vt(n,"perfTotal",h);var u=i.serverTiming;if(u){var d={};$n(u,function(t,e){var i=I(t.name||""+e),n=d[i]||{};G(t,function(t,e){("name"!==t&&o(e)||de.isNumber(e))&&(n[t]&&(e=n[t]+";"+e),!e&&o(e)||(n[t]=e))}),d[i]=n}),r|=vt(n,"serverTiming",d)}r|=vt(n,"transferSize",i.transferSize),r|=vt(n,"encodedBodySize",i.encodedBodySize),r|=vt(n,"decodedBodySize",i.decodedBodySize)}else t.perfMark&&(r|=vt(n,"missing",t.perfAttempts));r&&(e[Jn]=n)}function xt(){var t=$t();return!t||lr(t.Request)||lr(t.Request[Ut])||lr(t[sr])?null:t[sr]}function Tt(t){var e=!1;if(typeof XMLHttpRequest!==Rt&&!lr(XMLHttpRequest)){var i=XMLHttpRequest[Ut];e=!(lr(i)||lr(i.open)||lr(i.send)||lr(i.abort))}var n=xi.getIEVersion();if(n&&n<9&&(e=!1),e)try{(new XMLHttpRequest)[or]={};var r=XMLHttpRequest[Ut].open;XMLHttpRequest[Ut].open=r}catch(i){e=!1,_t(t,ge.FailedMonitorAjaxOpen,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:xi.dump(i)})}return e}function Mt(t){var e="";try{lr(t)||lr(t[or])||lr(t[or].requestUrl)||(e+="(url: '"+t[or].requestUrl+"')")}catch(t){}return e}function _t(e,i,n,r,o){e[rr]()[ar](t.LoggingSeverity.CRITICAL,i,n,r,o)}function Pt(e,i,n,r,o){e[rr]()[ar](t.LoggingSeverity.WARNING,i,n,r,o)}function At(t,e,i){return function(n){_t(t,e,i,{ajaxDiagnosticsMessage:Mt(n.inst),exception:xi.dump(n.err)})}}function kt(t,e){return t&&e?t.indexOf(e):-1}var Dt="function",Ft="object",Et="undefined",It="prototype",Gt="hasOwnProperty",Ot=function(t,e){return(Ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e[Gt](i)&&(t[i]=e[i])})(t,e)},Bt=e()||{};!function(t,e,i){t.__assign||(t.__assign=Object.assign||e),t.__extends||(t.__extends=i)}(Bt,n,r),__assign||(__assign=Bt.__assign),__extends||(__extends=Bt.__extends);var Lt={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},Rt=Et,Nt=Ft,Ut=It,Vt=Dt,Ht="window",Wt="document",Kt="navigator",zt="history",jt="location",Yt="console",Xt="performance",qt="JSON",Zt="crypto",Jt="msCrypto",Qt="ReactNative",$t=e,te="on",ee="attachEvent",ie="addEventListener",ne="detachEvent",re="removeEventListener",oe=4294967296,ae=4294967295,se=null,le=!1,he=123456789,ue=987654321,de=function(){function t(){}return t.isDate=function(t){return"[object Date]"===Object[It].toString.call(t)},t.isArray=function(t){return"[object Array]"===Object[It].toString.call(t)},t.isError=function(t){return"[object Error]"===Object[It].toString.call(t)},t.isString=function(t){return T(t,"string")},t.isNumber=function(t){return T(t,"number")},t.isBoolean=function(t){return T(t,"boolean")},t.disableCookies=function(){t._canUseCookies=!1},t.newGuid=function(){function e(){return t.randomValue(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(ce,function(t){var i=0|e();return("x"===t?i:3&i|8).toString(16)})},t.toISOString=function(e){if(t.isDate(e)){var i=function(t){var e=String(t);return 1===e.length&&(e="0"+e),e};return e.getUTCFullYear()+"-"+i(e.getUTCMonth()+1)+"-"+i(e.getUTCDate())+"T"+i(e.getUTCHours())+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}},t.arrForEach=function(t,e,i){for(var n=t.length,r=0;r<n;r++)r in t&&e.call(i||t,t[r],r,t)},t.arrIndexOf=function(t,e,i){for(var n=t.length,r=i||0,o=Math.max(r>=0?r:n-Math.abs(r),0);o<n;o++)if(o in t&&t[o]===e)return o;return-1},t.arrMap=function(t,e,i){for(var n=t.length,r=i||t,o=new Array(n),a=0;a<n;a++)a in t&&(o[a]=e.call(r,t[a],t));return o},t.arrReduce=function(t,e,i){var n,r=t.length,o=0;if(arguments.length>=3)n=arguments[2];else{for(;o<r&&!(o in t);)o++;n=t[o++]}for(;o<r;)o in t&&(n=e(n,t[o],o,t)),o++;return n},t.strTrim=function(e){return t.isString(e)?e.replace(/^\s+|\s+$/g,""):e},t.objKeys=function(t){var e=!{toString:null}.propertyIsEnumerable("toString");if(!(k(t)||A(t)&&null!==t))throw new TypeError("objKeys called on non-object");var i=[];for(var n in t)P(t,n)&&i.push(n);if(e)for(var r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=r.length,a=0;a<o;a++)P(t,r[a])&&i.push(r[a]);return i},t.addEventHandler=function(t,e){var i=!1,n=s();n&&(i=D(n,t,e),i=D(n.body,t,e)||i);var r=h();return r&&(i=pe.Attach(r,t,e)||i),i},t.dateNow=function(){var t=Date;return t.now?t.now():(new t).getTime()},t.perfNow=function(){var e=y();return e&&e.now?e.now():t.dateNow()},t.newId=function(e){void 0===e&&(e=22);for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=t.random32()>>>0,r=0,o="";o.length<e;)r++,o+=i.charAt(63&n),n>>>=6,5===r&&(n=(t.random32()<<2&4294967295|3&n)>>>0,r=0);return o},t.isIE=function(){if(null===se){var t=d()||{},e=(t.userAgent||"").toLowerCase();se=-1!==e.indexOf("msie")||-1!==e.indexOf("trident/")}return se},t.randomValue=function(e){return e>0?Math.floor(t.random32()/ae*(e+1))>>>0:0},t.random32=function(e){var i,n=S()||b();return n&&n.getRandomValues?i=n.getRandomValues(new Uint32Array(1))[0]&ae:t.isIE()?(le||x(),i=t.mwcRandom32()&ae):i=Math.floor(oe*Math.random()|0),e||(i>>>=0),i},t.mwcRandomSeed=function(t){t?w(t):x()},t.mwcRandom32=function(t){ue=36969*(65535&ue)+(ue>>16)&ae,he=18e3*(65535&he)+(he>>16)&ae;var e=(ue<<16)+(65535&he)>>>0&ae|0;return t||(e>>>=0),e},t.generateW3CId=function(){for(var e,i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n="",r=0;r<4;r++)e=t.random32(),n+=i[15&e]+i[e>>4&15]+i[e>>8&15]+i[e>>12&15]+i[e>>16&15]+i[e>>20&15]+i[e>>24&15]+i[e>>28&15];var o=i[8+(3&t.random32())|0];return n.substr(0,8)+n.substr(9,4)+"4"+n.substr(13,3)+o+n.substr(16,3)+n.substr(19,12)},t.isTypeof=T,t.isUndefined=M,t.isNullOrUndefined=_,t.hasOwnProperty=P,t.isFunction=k,t.isObject=A,t.objCreate=i,t.objDefineAccessors=E,t}(),ce=/[xy]/g,pe=function(){function t(){}return t.Attach=D,t.AttachEvent=D,t.Detach=F,t.DetachEvent=F,t}();!function(t){t[t.CRITICAL=1]="CRITICAL",t[t.WARNING=2]="WARNING"}(t.LoggingSeverity||(t.LoggingSeverity={}));var ge={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103},fe="constructor",ye="prototype",me="function",Ce="_dynInstFuncs",Se="_isDynProxy",be="_dynClass",ve="_dynCls$",we="_dynInstChk",xe=we,Te="_dfOpts",Me="_unknown_",_e="__proto__",Pe="useBaseInst",Ae="setInstFuncs",ke=Object.getPrototypeOf,De=0,Fe={setInstFuncs:!0,useBaseInst:!0};J[Te]=Fe;var Ee,Ie="AI (Internal): ",Ge="AI: ",Oe="AITR_",Be=function(){function t(t,e,i,n){void 0===i&&(i=!1);var r=this;r.messageId=t,r.message=(i?Ge:Ie)+t;var o="";m()&&(o=C().stringify(n));var a=(e?" message:"+Q(e):"")+(n?" props:"+Q(o):"");r.message+=a}return t.dataType="MessageData",t}(),Le=function(){function e(i){this.identifier="DiagnosticLogger",this.queue=[];var n=0,r={};J(e,this,function(e){function o(t,e){var n=i[t];return s(n)?e:n}function a(){return n>=e.maxInternalMessageLimit()}var s=de.isNullOrUndefined,l=de.isUndefined,h=de.isFunction;s(i)&&(i={}),e.consoleLoggingLevel=function(){return o("loggingLevelConsole",0)},e.telemetryLoggingLevel=function(){return o("loggingLevelTelemetry",1)},e.maxInternalMessageLimit=function(){return o("maxMessageLimit",25)},e.enableDebugExceptions=function(){return o("enableDebugExceptions",!1)},e.throwInternal=function(i,n,o,a,s){void 0===s&&(s=!1);var h=new Be(n,o,s,a);if(e.enableDebugExceptions())throw h;if(!l(h)&&h&&!l(h.message)){if(s){var u=+h.messageId;!r[u]&&e.consoleLoggingLevel()>=t.LoggingSeverity.WARNING&&(e.warnToConsole(h.message),r[u]=!0)}else e.consoleLoggingLevel()>=t.LoggingSeverity.WARNING&&e.warnToConsole(h.message);e.logInternalMessage(i,h)}},e.warnToConsole=function(t){var e=f();if(e){var i="log";e.warn&&(i="warn"),h(e[i])&&e[i](t)}},e.resetInternalMessageCount=function(){n=0,r={}},e.logInternalMessage=function(t,i){if(!a()){var o=!0,s=Oe+i.messageId;if(r[s]?o=!1:r[s]=!0,o&&(t<=e.telemetryLoggingLevel()&&(e.queue.push(i),n++),n===e.maxInternalMessageLimit())){var l="Internal events throttle limit per PageView reached for this app.",h=new Be(ge.MessageLimitPerPVExceeded,l,!1);e.queue.push(h),e.warnToConsole(l)}}}})}return e}(),Re="ctx",Ne=function(){function t(e,i,n){var r=this,o=!1;if(r.start=de.dateNow(),r.name=e,r.isAsync=n,r.isChildEvt=function(){return!1},de.isFunction(i)){var a;o=de.objDefineAccessors(r,"payload",function(){return!a&&de.isFunction(i)&&(a=i(),i=null),a})}r.getCtx=function(e){return e?e===t.ParentContextKey||e===t.ChildrenContextKey?r[e]:(r[Re]||{})[e]:null},r.setCtx=function(e,i){if(e)if(e===t.ParentContextKey)r[e]||(r.isChildEvt=function(){return!0}),r[e]=i;else if(e===t.ChildrenContextKey)r[e]=i;else{var n=r[Re]=r[Re]||{};n[e]=i}},r.complete=function(){var e=0,n=r.getCtx(t.ChildrenContextKey);if(de.isArray(n))for(var a=0;a<n.length;a++){var s=n[a];s&&(e+=s.time)}r.time=de.dateNow()-r.start,r.exTime=r.time-e,r.complete=function(){},!o&&de.isFunction(i)&&(r.payload=i())}}return t.ParentContextKey="parent",t.ChildrenContextKey="childEvts",t}(),Ue=function(){function t(e){this.ctx={},J(t,this,function(t){t.create=function(t,e,i){return new Ne(t,e,i)},t.fire=function(t){t&&(t.complete(),e&&e.perfEvent(t))},t.setCtx=function(e,i){if(e){(t[Re]=t[Re]||{})[e]=i}},t.getCtx=function(e){return(t[Re]||{})[e]}})}return t}(),Ve="CoreUtils.doPerf",He=de.isFunction,We=function(){function e(e,i){var n=this,r=null,o=He(e.processTelemetry),a=He(e.setNextPlugin);n._hasRun=!1,n.getPlugin=function(){return e},n.getNext=function(){return r},n.setNext=function(t){r=t},n.processTelemetry=function(s,l){l||(l=i);var h=e?e.identifier:"TelemetryPluginChain";$(l?l.core():null,function(){return h+":processTelemetry"},function(){if(e&&o){n._hasRun=!0;try{l.setNext(r),a&&e.setNextPlugin(r),r&&(r._hasRun=!1),e.processTelemetry(s,l)}catch(n){var i=r&&r._hasRun;r&&i||l.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.PluginException,"Plugin ["+e.identifier+"] failed during processTelemetry - "+n),r&&!i&&r.processTelemetry(s,l)}}else r&&(n._hasRun=!0,r.processTelemetry(s,l))},function(){return{item:s}},!s.sync)}}return e}(),Ke=de.isNullOrUndefined,ze=function(){function t(e,i,n,r){var o=this,a=null;null!==r&&(e&&de.isFunction(e.getPlugin)?a=et(e,o,r||e.getPlugin()):r?a=it(e,o,r):de.isUndefined(r)&&(a=tt(e,o))),o.core=function(){return n},o.diagLog=function(){var t=(n||{}).logger;return t||(t=new Le(i||{})),t},o.getCfg=function(){return i},o.getExtCfg=function(t,e){void 0===e&&(e={});var n;if(i){var r=i.extensionConfig;r&&t&&(n=r[t])}return n||e},o.getConfig=function(t,e,n){void 0===n&&(n=!1);var r,a=o.getExtCfg(t,null);return a&&!Ke(a[e])?r=a[e]:i&&!Ke(i[e])&&(r=i[e]),Ke(r)?n:r},o.hasNext=function(){return null!=a},o.getNext=function(){return a},o.setNext=function(t){a=t},o.processNext=function(t){var e=a;e&&(a=e.getNext(),e.processTelemetry(t,o))},o.createNew=function(e,r){return void 0===e&&(e=null),new t(e||a,i,n,r)}}return t}(),je=de.isFunction,Ye="getPlugin",Xe=function(){function t(){var t=this,e=!1,i=null,n=null;t.core=null,t.diagLog=function(e){return t._getTelCtx(e).diagLog()},t.isInitialized=function(){return e},t.setInitialized=function(t){e=t},t.setNextPlugin=function(t){n=t},t.processNext=function(t,e){e?e.processNext(t):n&&je(n.processTelemetry)&&n.processTelemetry(t,null)},t._getTelCtx=function(e){void 0===e&&(e=null);var r=e;if(!r){var o=i||new ze(null,{},t.core);r=n&&n[Ye]?o.createNew(null,n[Ye]):o.createNew(null,n)}return r},t._baseTelInit=function(r,o,a,s){r&&(r.extensionConfig=r.extensionConfig||[]),!s&&o&&(s=o.getProcessTelContext().getNext());var l=n;n&&n[Ye]&&(l=n[Ye]()),t.core=o,i=new ze(s,r,o,l),e=!0}}return t.prototype.initialize=function(t,e,i,n){this._baseTelInit(t,e,i,n)},t}(),qe=de.isFunction,Ze="processTelemetry",Je="priority",Qe="setNextPlugin",$e="isInitialized",ti=500,ei="Channel has invalid priority",ii=de.objDefineAccessors,ni=function(t){function e(){function i(t){s(t,function(t){if(t.priority<ti)throw Error(ei+t.identifier)})}function n(t){t&&t.length>0&&(t=t.sort(function(t,e){return t.priority-e.priority}),i(t),a.push(t))}function r(t,e){if(a=[],t&&s(t,function(t){return n(t)}),e){var i=[];s(e,function(t){t.priority>ti&&i.push(t)}),n(i)}}var o=t.call(this)||this;o.identifier="ChannelControllerPlugin",o.priority=ti;var a,s=de.arrForEach;return J(e,o,function(t,e){t.setNextPlugin=function(t){},t.processTelemetry=function(t,e){a&&s(a,function(i){if(i.length>0){o._getTelCtx(e).createNew(i).processNext(t)}})},t.getChannelControls=function(){return a},t.initialize=function(i,n,o){t.isInitialized()||(e.initialize(i,n,o),i.isCookieUseDisabled&&de.disableCookies(),r((i||{}).channels,o),s(a,function(t){return nt(new ze(t,i,n),o)}))}}),o}return __extends(e,t),e._staticInit=function(){ii(e.prototype,"ChannelControls",e.prototype.getChannelControls),ii(e.prototype,"channelQueue",e.prototype.getChannelControls)}(),e}(Xe),ri="Extensions must provide callback to initialize",oi=de.arrForEach,ai=de.isNullOrUndefined,si="_notificationManager",li=function(){function t(){var e,i,n,r,o=!1;J(t,this,function(t){t._extensions=new Array,i=new ni,t.logger=de.objCreate({throwInternal:function(t,e,i,n,r){void 0===r&&(r=!1)},warnToConsole:function(t){},resetInternalMessageCount:function(){}}),e=[],t.isInitialized=function(){return o},t.initialize=function(e,r,a,s){if(t.isInitialized())throw Error("Core should not be initialized more than once");if(!e||ai(e.instrumentationKey))throw Error("Please provide instrumentation key");n=s,t[si]=s,t.config=e||{},e.extensions=ai(e.extensions)?[]:e.extensions,(e.extensionConfig=ai(e.extensionConfig)?{}:e.extensionConfig).NotificationManager=s,a&&(t.logger=a);var l=[];l.push.apply(l,r.concat(e.extensions)),l=rt(l);var h=[],u={};if(oi(l,function(t){if(ai(t)||ai(t.initialize))throw Error(ri);var e=t.priority,n=t.identifier;t&&e&&(ai(u[e])?u[e]=n:a.warnToConsole("Two extensions have same priority #"+e+" - "+u[e]+", "+n)),(!e||e<i.priority)&&h.push(t)}),l.push(i),h.push(i),l=rt(l),t._extensions=l,nt(new ze([i],e,t),l),nt(new ze(h,e,t),l),t._extensions=h,0===t.getTransmissionControls().length)throw new Error("No channels available");o=!0,t.releaseQueue()},t.getTransmissionControls=function(){return i.getChannelControls()},t.track=function(i){i.iKey||(i.iKey=t.config.instrumentationKey),i.time||(i.time=de.toISOString(new Date)),ai(i.ver)&&(i.ver="4.0"),t.isInitialized()?t.getProcessTelContext().processNext(i):e.push(i)},t.getProcessTelContext=function(){var e=t._extensions,n=e;return e&&0!==e.length||(n=[i]),new ze(n,t.config,t)},t.getNotifyMgr=function(){return n||(n=de.objCreate({addNotificationListener:function(t){},removeNotificationListener:function(t){},eventsSent:function(t){},eventsDiscarded:function(t,e){},eventsSendRequest:function(t,e){}}),t[si]=n),n},t.getPerfMgr=function(){return r||t.config&&t.config.enablePerfMgr&&(r=new Ue(t.getNotifyMgr())),r},t.setPerfMgr=function(t){r=t},t.eventCnt=function(){return e.length},t.releaseQueue=function(){e.length>0&&(oi(e,function(e){t.getProcessTelContext().processNext(e)}),e=[])}})}return t}(),hi=function(){function t(e){this.listeners=[];var i=de.arrForEach,n=!!(e||{}).perfEvtsSendAll;J(t,this,function(t){t.addNotificationListener=function(e){t.listeners.push(e)},t.removeNotificationListener=function(e){for(var i=de.arrIndexOf(t.listeners,e);i>-1;)t.listeners.splice(i,1),i=de.arrIndexOf(t.listeners,e)},t.eventsSent=function(e){i(t.listeners,function(t){t&&t.eventsSent&&setTimeout(function(){return t.eventsSent(e)},0)})},t.eventsDiscarded=function(e,n){i(t.listeners,function(t){t&&t.eventsDiscarded&&setTimeout(function(){return t.eventsDiscarded(e,n)},0)})},t.eventsSendRequest=function(e,n){i(t.listeners,function(t){if(t&&t.eventsSendRequest)if(n)setTimeout(function(){return t.eventsSendRequest(e,n)},0);else try{t.eventsSendRequest(e,n)}catch(t){}})},t.perfEvent=function(e){e&&(!n&&e.isChildEvt()||i(t.listeners,function(t){if(t&&t.perfEvent)if(e.isAsync)setTimeout(function(){return t.perfEvent(e)},0);else try{t.perfEvent(e)}catch(t){}}))}})}return t}(),ui=function(t){function e(){var i=t.call(this)||this;return J(e,i,function(t,e){function i(t){if(de.isNullOrUndefined(t.name))throw n(t),Error("telemetry name required")}function n(e){var i=t.getNotifyMgr();i&&i.eventsDiscarded([e],Lt.InvalidEvent)}t.initialize=function(t,i,n,r){e.initialize(t,i,n||new Le(t),r||new hi(t))},t.track=function(r){$(t.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){if(null===r)throw n(r),Error("Invalid telemetry item");i(r),e.track(r)},function(){return{item:r}},!r.sync)},t.addNotificationListener=function(e){var i=t.getNotifyMgr();i&&i.addNotificationListener(e)},t.removeNotificationListener=function(e){var i=t.getNotifyMgr();i&&i.removeNotificationListener(e)},t.pollInternalLogs=function(e){var i=t.config.diagnosticLogInterval;return i&&i>0||(i=1e4),setInterval(function(){var i=t.logger?t.logger.queue:[];de.arrForEach(i,function(i){var n={name:e||"InternalMessageId: "+i.messageId,iKey:t.config.instrumentationKey,time:de.toISOString(new Date),baseType:Be.dataType,baseData:{message:i.message}};t.track(n)}),i.length=0},i)}}),i}return __extends(e,t),e}(li),di="_aiHooks",ci=["req","rsp","hkErr","fnErr"],pi="__proto__",gi="constructor",fi=Object.getPrototypeOf;!function(t){t[t.LocalStorage=0]="LocalStorage",t[t.SessionStorage=1]="SessionStorage"}(Ee||(Ee={}));var yi;!function(t){t[t.Default=0]="Default",t[t.Required=1]="Required",t[t.Array=2]="Array",t[t.Hidden=4]="Hidden"}(yi||(yi={})),function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C",t[t.W3C=2]="W3C"}(t.DistributedTracingModes||(t.DistributedTracingModes={}));var mi,Ci=function(){function t(){}return t.requestContextHeader="Request-Context",t.requestContextTargetKey="appId",t.requestContextAppIdFormat="appId=cid-v1:",t.requestIdHeader="Request-Id",t.traceParentHeader="traceparent",t.sdkContextHeader="Sdk-Context",t.sdkContextHeaderAppIdRequest="appId",t.requestContextHeaderLowerCase="request-context",t}(),Si=function(){function e(){}return e.sanitizeKeyAndAddUniqueness=function(t,i,n){var r=i.length,o=e.sanitizeKey(t,i);if(o.length!==r){for(var a=0,s=o;void 0!==n[s];)a++,s=o.substring(0,e.MAX_NAME_LENGTH-3)+e.padNumber(a);o=s}return o},e.sanitizeKey=function(i,n){var r;return n&&(n=e.trim(n.toString()),n.length>e.MAX_NAME_LENGTH&&(r=n.substring(0,e.MAX_NAME_LENGTH),i.throwInternal(t.LoggingSeverity.WARNING,ge.NameTooLong,"name is too long.  It has been truncated to "+e.MAX_NAME_LENGTH+" characters.",{name:n},!0))),r||n},e.sanitizeString=function(i,n,r){void 0===r&&(r=e.MAX_STRING_LENGTH);var o;return n&&(r=r||e.MAX_STRING_LENGTH,n=e.trim(n),n.toString().length>r&&(o=n.toString().substring(0,r),i.throwInternal(t.LoggingSeverity.WARNING,ge.StringValueTooLong,"string value is too long. It has been truncated to "+r+" characters.",{value:n},!0))),o||n},e.sanitizeUrl=function(t,i){return e.sanitizeInput(t,i,e.MAX_URL_LENGTH,ge.UrlTooLong)},e.sanitizeMessage=function(i,n){var r;return n&&n.length>e.MAX_MESSAGE_LENGTH&&(r=n.substring(0,e.MAX_MESSAGE_LENGTH),i.throwInternal(t.LoggingSeverity.WARNING,ge.MessageTruncated,"message is too long, it has been truncated to "+e.MAX_MESSAGE_LENGTH+" characters.",{message:n},!0)),r||n},e.sanitizeException=function(i,n){var r;return n&&n.length>e.MAX_EXCEPTION_LENGTH&&(r=n.substring(0,e.MAX_EXCEPTION_LENGTH),i.throwInternal(t.LoggingSeverity.WARNING,ge.ExceptionTruncated,"exception is too long, it has been truncated to "+e.MAX_EXCEPTION_LENGTH+" characters.",{exception:n},!0)),r||n},e.sanitizeProperties=function(i,n){if(n){var r={};G(n,function(n,o){if(de.isObject(o)&&m())try{o=C().stringify(o)}catch(e){i.throwInternal(t.LoggingSeverity.WARNING,ge.CannotSerializeObjectNonSerializable,"custom property is not valid",{exception:e},!0)}o=e.sanitizeString(i,o,e.MAX_PROPERTY_LENGTH),n=e.sanitizeKeyAndAddUniqueness(i,n,r),r[n]=o}),n=r}return n},e.sanitizeMeasurements=function(t,i){if(i){var n={};G(i,function(i,r){i=e.sanitizeKeyAndAddUniqueness(t,i,n),n[i]=r}),i=n}return i},e.sanitizeId=function(t,i){return i?e.sanitizeInput(t,i,e.MAX_ID_LENGTH,ge.IdTooLong).toString():i},e.sanitizeInput=function(i,n,r,o){var a;return n&&(n=e.trim(n),n.length>r&&(a=n.substring(0,r),i.throwInternal(t.LoggingSeverity.WARNING,o,"input is too long, it has been truncated to "+r+" characters.",{data:n},!0))),a||n},e.padNumber=function(t){var e="00"+t;return e.substr(e.length-3)},e.trim=function(t){return de.isString(t)?t.replace(/^\s+|\s+$/g,""):t},e.MAX_NAME_LENGTH=150,e.MAX_ID_LENGTH=128,e.MAX_PROPERTY_LENGTH=8192,e.MAX_STRING_LENGTH=1024,e.MAX_URL_LENGTH=2048,e.MAX_MESSAGE_LENGTH=32768,e.MAX_EXCEPTION_LENGTH=32768,e}(),bi=d(),vi=de.isString,wi=null,xi=function(){function e(){}return e.createDomEvent=function(t){var e=null;if(de.isFunction(Event))e=new Event(t);else{var i=h();i&&i.createEvent&&(e=i.createEvent("Event"),e.initEvent(t,!0,!0))}return e},e.disableStorage=function(){e._canUseLocalStorage=!1,e._canUseSessionStorage=!1},e._getLocalStorageObject=function(){return e.canUseLocalStorage()?e._getVerifiedStorageObject(Ee.LocalStorage):null},e._getVerifiedStorageObject=function(t){var e,i,n=null;try{if(de.isNullOrUndefined($t()))return null;i=new Date,n=o(t===Ee.LocalStorage?"localStorage":"sessionStorage"),n.setItem(i.toString(),i.toString()),e=n.getItem(i.toString())!==i.toString(),n.removeItem(i.toString()),e&&(n=null)}catch(t){n=null}return n},e.isInternalApplicationInsightsEndpoint=function(t){return-1!==e._internalEndpoints.indexOf(t.toLowerCase())},e.canUseLocalStorage=function(){return void 0===e._canUseLocalStorage&&(e._canUseLocalStorage=!!e._getVerifiedStorageObject(Ee.LocalStorage)),e._canUseLocalStorage},e.getStorage=function(i,n){var r=e._getLocalStorageObject();if(null!==r)try{return r.getItem(n)}catch(n){e._canUseLocalStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+e.getExceptionName(n),{exception:e.dump(n)})}return null},e.setStorage=function(i,n,r){var o=e._getLocalStorageObject();if(null!==o)try{return o.setItem(n,r),!0}catch(n){e._canUseLocalStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+e.getExceptionName(n),{exception:e.dump(n)})}return!1},e.removeStorage=function(i,n){var r=e._getLocalStorageObject();if(null!==r)try{return r.removeItem(n),!0}catch(n){e._canUseLocalStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserFailedRemovalFromLocalStorage,"Browser failed removal of local storage item. "+e.getExceptionName(n),{exception:e.dump(n)})}return!1},e._getSessionStorageObject=function(){return e.canUseSessionStorage()?e._getVerifiedStorageObject(Ee.SessionStorage):null},e.canUseSessionStorage=function(){return void 0===e._canUseSessionStorage&&(e._canUseSessionStorage=!!e._getVerifiedStorageObject(Ee.SessionStorage)),e._canUseSessionStorage},e.getSessionStorageKeys=function(){var t=[];return e.canUseSessionStorage()&&G(o("sessionStorage"),function(e){t.push(e)}),t},e.getSessionStorage=function(i,n){var r=e._getSessionStorageObject();if(null!==r)try{return r.getItem(n)}catch(n){e._canUseSessionStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserCannotReadSessionStorage,"Browser failed read of session storage. "+e.getExceptionName(n),{exception:e.dump(n)})}return null},e.setSessionStorage=function(i,n,r){var o=e._getSessionStorageObject();if(null!==o)try{return o.setItem(n,r),!0}catch(n){e._canUseSessionStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserCannotWriteSessionStorage,"Browser failed write to session storage. "+e.getExceptionName(n),{exception:e.dump(n)})}return!1},e.removeSessionStorage=function(i,n){var r=e._getSessionStorageObject();if(null!==r)try{return r.removeItem(n),!0}catch(n){e._canUseSessionStorage=!1,i.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserFailedRemovalFromSessionStorage,"Browser failed removal of session storage item. "+e.getExceptionName(n),{exception:e.dump(n)})}return!1},e.disableCookies=function(){de.disableCookies()},e.canUseCookies=function(i){if(void 0===de._canUseCookies){de._canUseCookies=!1;try{de._canUseCookies=void 0!==e.document.cookie}catch(n){i.throwInternal(t.LoggingSeverity.WARNING,ge.CannotAccessCookie,"Cannot access document.cookie - "+e.getExceptionName(n),{exception:e.dump(n)})}}return de._canUseCookies},e.disallowsSameSiteNone=function(t){return!!vi(t)&&(-1!==t.indexOf("CPU iPhone OS 12")||-1!==t.indexOf("iPad; CPU OS 12")||(-1!==t.indexOf("Macintosh; Intel Mac OS X 10_14")&&-1!==t.indexOf("Version/")&&-1!==t.indexOf("Safari")||(!(-1===t.indexOf("Macintosh; Intel Mac OS X 10_14")||!ct(t,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||(-1!==t.indexOf("Chrome/5")||-1!==t.indexOf("Chrome/6")||(-1!==t.indexOf("UnrealEngine")&&-1===t.indexOf("Chrome")||(-1!==t.indexOf("UCBrowser/12")||-1!==t.indexOf("UCBrowser/11")))))))},e.setCookie=function(t,i,n,r){if(e.canUseCookies(t)){var o="",a="";r&&(o=";domain="+r);var s=g();s&&"https:"===s.protocol&&(a=";secure",null===wi&&(wi=e.disallowsSameSiteNone((d()||{}).userAgent)),wi||(n+=";SameSite=None")),e.document.cookie=i+"="+n+o+";path=/"+a}},e.stringToBoolOrDefault=function(t,e){return void 0===e&&(e=!1),void 0===t||null===t?e:"true"===t.toString().toLowerCase()},e.getCookie=function(t,i){if(e.canUseCookies(t)){var n="";if(i&&i.length)for(var r=i+"=",o=e.document.cookie.split(";"),a=0;a<o.length;a++){var s=o[a];if((s=e.trim(s))&&0===s.indexOf(r)){n=s.substring(r.length,o[a].length);break}}return n}},e.deleteCookie=function(t,i){e.canUseCookies(t)&&(e.document.cookie=i+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;")},e.random32=function(){return de.random32(!0)},e.getIEVersion=function(t){void 0===t&&(t=null);var e=t?t.toLowerCase():bi?(bi.userAgent||"").toLowerCase():"";if(-1!==e.indexOf("msie"))return parseInt(e.split("msie")[1]);if(e.indexOf("trident/")){var i=parseInt(e.split("trident/")[1]);if(i)return i+4}return null},e.msToTimeSpan=function(t){(isNaN(t)||t<0)&&(t=0),
t=Math.round(t);var e=""+t%1e3,i=""+Math.floor(t/1e3)%60,n=""+Math.floor(t/6e4)%60,r=""+Math.floor(t/36e5)%24,o=Math.floor(t/864e5);return e=1===e.length?"00"+e:2===e.length?"0"+e:e,i=i.length<2?"0"+i:i,n=n.length<2?"0"+n:n,r=r.length<2?"0"+r:r,(o>0?o+".":"")+r+":"+n+":"+i+"."+e},e.isCrossOriginError=function(t,e,i,n,r){return("Script error."===t||"Script error"===t)&&!r},e.dump=function(t){var e=Object[Ut].toString.call(t),i="";return"[object Error]"===e?i="{ stack: '"+t.stack+"', message: '"+t.message+"', name: '"+t.name+"'":m()&&(i=C().stringify(t)),e+i},e.getExceptionName=function(t){return"[object Error]"===Object[Ut].toString.call(t)?t.name:""},e.addEventHandler=function(t,e){return pe.Attach(s(),t,e)},e.IsBeaconApiSupported=function(){return"sendBeacon"in bi&&bi.sendBeacon},e.getExtension=function(t,e){for(var i=null,n=0;!i&&n<t.length;)t[n]&&t[n].identifier===e&&(i=t[n]),n++;return i},e.document=h()||{},e._canUseLocalStorage=void 0,e._canUseSessionStorage=void 0,e._internalEndpoints=["//donttrackmepls"],e.NotSpecified="not_specified",e.trim=de.strTrim,e.newId=de.newId,e.generateW3CId=de.generateW3CId,e.isArray=de.isArray,e.isError=de.isError,e.isDate=de.isDate,e.toISOStringForIE8=de.toISOString,e}(),Ti=function(){function t(){}return t.parseUrl=function(e){var i=t._htmlAnchorIdx,n=t._htmlAnchorElement,r=n[i];return t.document.createElement?n[i]||(r=n[i]=t.document.createElement("a")):r={host:t.parseHost(e,!0)},r.href=e,i++,i>=n.length&&(i=0),t._htmlAnchorIdx=i,r},t.getAbsoluteUrl=function(e){var i,n=t.parseUrl(e);return n&&(i=n.href),i},t.getPathName=function(e){var i,n=t.parseUrl(e);return n&&(i=n.pathname),i},t.getCompleteUrl=function(t,e){return t?t.toUpperCase()+" "+e:e},t.parseHost=function(e,i){var n=t.parseFullHost(e,i);if(n){var r=n.match(/(www[0-9]?\.)?(.[^/:]+)(\:[\d]+)?/i);if(null!=r&&r.length>3&&vi(r[2])&&r[2].length>0)return r[2]+(r[3]||"")}return n},t.parseFullHost=function(t,e){var i=null;if(t){var n=t.match(/(\w*):\/\/(.[^/:]+)(\:[\d]+)?/i);if(null!=n&&n.length>2&&vi(n[2])&&n[2].length>0&&(i=n[2]||"",e&&n.length>2)){var r=(n[1]||"").toLowerCase(),o=n[3]||"";"http"===r&&":80"===o?o="":"https"===r&&":443"===o&&(o=""),i+=o}}return i},t.document=h()||{},t._htmlAnchorIdx=0,t._htmlAnchorElement=[null,null,null,null,null],t}(),Mi=function(){function t(){}return t.canIncludeCorrelationHeader=function(t,e,i){if(!e||t&&t.disableCorrelationHeaders)return!1;if(t&&t.correlationHeaderExcludePatterns)for(var n=0;n<t.correlationHeaderExcludePatterns.length;n++)if(t.correlationHeaderExcludePatterns[n].test(e))return!1;var r=Ti.parseUrl(e).host.toLowerCase();if(!r||-1===r.indexOf(":443")&&-1===r.indexOf(":80")||(r=(Ti.parseFullHost(e,!0)||"").toLowerCase()),!(t&&t.enableCorsCorrelation||r===i))return!1;var o=t&&t.correlationHeaderDomains;if(o){var a;if(de.arrForEach(o,function(t){var e=new RegExp(t.toLowerCase().replace(/\./g,".").replace(/\*/g,".*"));a=a||e.test(r)}),!a)return!1}var s=t&&t.correlationHeaderExcludedDomains;if(!s||0===s.length)return!0;for(var n=0;n<s.length;n++){if(new RegExp(s[n].toLowerCase().replace(/\./g,".").replace(/\*/g,".*")).test(r))return!1}return r&&r.length>0},t.getCorrelationContext=function(e){if(e){var i=t.getCorrelationContextValue(e,Ci.requestContextTargetKey);if(i&&i!==t.correlationIdPrefix)return i}},t.getCorrelationContextValue=function(t,e){if(t)for(var i=t.split(","),n=0;n<i.length;++n){var r=i[n].split("=");if(2===r.length&&r[0]===e)return r[1]}},t.correlationIdPrefix="cid-v1:",t}(),_i=function(){function t(){}return t.ParseDependencyPath=function(t,e,i,n){var r,o=n,a=n;if(e&&e.length>0){var s=Ti.parseUrl(e);if(r=s.host,!o)if(null!=s.pathname){var l=0===s.pathname.length?"/":s.pathname;"/"!==l.charAt(0)&&(l="/"+l),a=s.pathname,o=Si.sanitizeString(t,i?i+" "+l:l)}else o=Si.sanitizeString(t,e)}else r=n,o=n;return{target:r,name:o,data:a}},t}(),Pi=function(){function t(){}return t.Now=function(){var t=y();if(t&&t.now&&t.timing){var e=t.now()+t.timing.navigationStart;if(e>0)return e}return(new Date).getTime()},t.GetDuration=function(t,e){var i=null;return 0===t||0===e||de.isNullOrUndefined(t)||de.isNullOrUndefined(e)||(i=e-t),i},t}(),Ai="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",ki="sampleRate",Di="ProcessLegacy",Fi=function(){function t(){}return t.parse=function(e){if(!e)return{};var i=e.split(t._FIELDS_SEPARATOR),n=de.arrReduce(i,function(e,i){var n=i.split(t._FIELD_KEY_VALUE_SEPARATOR);if(2===n.length){var r=n[0].toLowerCase(),o=n[1];e[r]=o}return e},{});if(de.objKeys(n).length>0){if(n.endpointsuffix){var r=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+r+"dc."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||"https://dc.services.visualstudio.com"}return n},t._FIELDS_SEPARATOR=";",t._FIELD_KEY_VALUE_SEPARATOR="=",t}(),Ei=function(){function t(){}return t}(),Ii=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(Ei),Gi=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}(),Oi=function(t){function e(e,i,n){var r=t.call(this)||this;return r.name=Si.sanitizeString(e,n)||xi.NotSpecified,r.data=i,r.time=de.toISOString(new Date),r.aiDataContract={time:yi.Required,iKey:yi.Required,name:yi.Required,sampleRate:function(){return 100===r.sampleRate?yi.Hidden:yi.Required},tags:yi.Required,data:yi.Required},r}return __extends(e,t),e}(Gi),Bi=function(){function t(){}return t}(),Li=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return __extends(e,t),e}(Bi),Ri=function(t){function e(e,i,n,r){var o=t.call(this)||this;return o.aiDataContract={ver:yi.Required,name:yi.Required,properties:yi.Default,measurements:yi.Default},o.name=Si.sanitizeString(e,i)||xi.NotSpecified,o.properties=Si.sanitizeProperties(e,n),o.measurements=Si.sanitizeMeasurements(e,r),o}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.Event",e.dataType="EventData",e}(Li),Ni=function(){function t(){}return t}(),Ui=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.exceptions=[],e.properties={},e.measurements={},e}return __extends(e,t),e}(Bi),Vi=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}(),Hi="error",Wi=function(t){function e(e,i,n,r,o,a){var s=t.call(this)||this;return s.aiDataContract={ver:yi.Required,exceptions:yi.Required,severityLevel:yi.Default,properties:yi.Default,measurements:yi.Default},gt(i)?(s.exceptions=i.exceptions,s.properties=i.properties,s.measurements=i.measurements,i.severityLevel&&(s.severityLevel=i.severityLevel),i.id&&(s.id=i.id),i.problemGroup&&(s.problemGroup=i.problemGroup),s.ver=2,de.isNullOrUndefined(i.isManual)||(s.isManual=i.isManual)):(s.exceptions=[new Ki(e,i)],s.properties=Si.sanitizeProperties(e,n)||{},s.measurements=Si.sanitizeMeasurements(e,r),o&&(s.severityLevel=o),a&&(s.id=a)),s}return __extends(e,t),e.CreateFromInterface=function(t,i,n,r){var o=i.exceptions&&de.arrMap(i.exceptions,function(e){return Ki.CreateFromInterface(t,e)});return new e(t,__assign({},i,{exceptions:o}),n,r)},e.prototype.toInterface=function(){var t=this,e=t.exceptions,i=t.properties,n=t.measurements,r=t.severityLevel,o=(t.ver,t.problemGroup),a=t.id,s=t.isManual;return{ver:"4.0",exceptions:e instanceof Array&&de.arrMap(e,function(t){return t.toInterface()})||void 0,severityLevel:r,properties:i,measurements:n,problemGroup:o,id:a,isManual:s}},e.CreateSimpleException=function(t,e,i,n,r,o){return{exceptions:[{hasFullStack:!0,message:t,stack:r,typeName:e}]}},e.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",e.dataType="ExceptionData",e}(Ui),Ki=function(t){function e(i,n){var r=t.call(this)||this;if(r.aiDataContract={id:yi.Default,outerId:yi.Default,typeName:yi.Required,message:yi.Required,hasFullStack:yi.Default,stack:yi.Default,parsedStack:yi.Array},pt(n))r.typeName=n.typeName,r.message=n.message,r.stack=n.stack,r.parsedStack=n.parsedStack,r.hasFullStack=n.hasFullStack;else{var o=n;xi.isError(o)||(o=o[Hi]||o.evt||o),r.typeName=Si.sanitizeString(i,ft(o))||xi.NotSpecified,r.message=Si.sanitizeMessage(i,n.message)||xi.NotSpecified;var a=n.stack;r.parsedStack=e.parseStack(a),r.stack=Si.sanitizeException(i,a),r.hasFullStack=xi.isArray(r.parsedStack)&&r.parsedStack.length>0}return r}return __extends(e,t),e.prototype.toInterface=function(){var t=this.parsedStack instanceof Array&&de.arrMap(this.parsedStack,function(t){return t.toInterface()});return{id:this.id,outerId:this.outerId,typeName:this.typeName,message:this.message,hasFullStack:this.hasFullStack,stack:this.stack,parsedStack:t||void 0}},e.CreateFromInterface=function(t,i){var n=i.parsedStack instanceof Array&&de.arrMap(i.parsedStack,function(t){return zi.CreateFromInterface(t)})||i.parsedStack;return new e(t,__assign({},i,{parsedStack:n}))},e.parseStack=function(t){var e;if(de.isString(t)){var i=t.split("\n");e=[];for(var n=0,r=0,o=0;o<=i.length;o++){var a=i[o];if(zi.regex.test(a)){var s=new zi(i[o],n++);r+=s.sizeInBytes,e.push(s)}}if(r>32768)for(var l=0,h=e.length-1,u=0,d=l,c=h;l<h;){var p=e[l].sizeInBytes,g=e[h].sizeInBytes;if((u+=p+g)>32768){var f=c-d+1;e.splice(d,f);break}d=l,c=h,l++,h--}}return e},e}(Vi),zi=function(t){function e(i,n){var r=t.call(this)||this;if(r.sizeInBytes=0,r.aiDataContract={level:yi.Required,method:yi.Required,assembly:yi.Default,fileName:yi.Default,line:yi.Default},"string"==typeof i){var o=i;r.level=n,r.method="<no_method>",r.assembly=xi.trim(o),r.fileName="",r.line=0;var a=o.match(e.regex);a&&a.length>=5&&(r.method=xi.trim(a[2])||r.method,r.fileName=xi.trim(a[4]),r.line=parseInt(a[5])||0)}else r.level=i.level,r.method=i.method,r.assembly=i.assembly,r.fileName=i.fileName,r.line=i.line,r.sizeInBytes=0;return r.sizeInBytes+=r.method.length,r.sizeInBytes+=r.fileName.length,r.sizeInBytes+=r.assembly.length,r.sizeInBytes+=e.baseSize,r.sizeInBytes+=r.level.toString().length,r.sizeInBytes+=r.line.toString().length,r}return __extends(e,t),e.CreateFromInterface=function(t){return new e(t,null)},e.prototype.toInterface=function(){return{level:this.level,method:this.method,assembly:this.assembly,fileName:this.fileName,line:this.line}},e.regex=/^([\s]+at)?(.*?)(\@|\s\(|\s)([^\(\@\n]+):([0-9]+):([0-9]+)(\)?)$/,e.baseSize=58,e}(Ni),ji=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.metrics=[],e.properties={},e.measurements={},e}return __extends(e,t),e}(Bi);!function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"}(mi||(mi={}));var Yi=function(){function t(){this.kind=mi.Measurement}return t}(),Xi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiDataContract={name:yi.Required,kind:yi.Default,value:yi.Required,count:yi.Default,min:yi.Default,max:yi.Default,stdDev:yi.Default},e}return __extends(e,t),e}(Yi),qi=function(t){function e(e,i,n,r,o,a,s,l){var h=t.call(this)||this;h.aiDataContract={ver:yi.Required,metrics:yi.Required,properties:yi.Default};var u=new Xi;return u.count=r>0?r:void 0,u.max=isNaN(a)||null===a?void 0:a,u.min=isNaN(o)||null===o?void 0:o,u.name=Si.sanitizeString(e,i)||xi.NotSpecified,u.value=n,h.metrics=[u],h.properties=Si.sanitizeProperties(e,s),h.measurements=Si.sanitizeMeasurements(e,l),h}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",e.dataType="MetricData",e}(ji),Zi=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return __extends(e,t),e}(Li),Ji=function(t){function e(e,i,n,r,o,a,s){var l=t.call(this)||this;return l.aiDataContract={ver:yi.Required,name:yi.Default,url:yi.Default,duration:yi.Default,properties:yi.Default,measurements:yi.Default,id:yi.Default},l.id=Si.sanitizeId(e,s),l.url=Si.sanitizeUrl(e,n),l.name=Si.sanitizeString(e,i)||xi.NotSpecified,isNaN(r)||(l.duration=xi.msToTimeSpan(r)),l.properties=Si.sanitizeProperties(e,o),l.measurements=Si.sanitizeMeasurements(e,a),l}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",e.dataType="PageviewData",e}(Zi),Qi=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.success=!0,e.properties={},e.measurements={},e}return __extends(e,t),e}(Bi),$i=function(t){function e(e,i,n,r,o,a,s,l,h,u,d,c){void 0===h&&(h="Ajax");var p=t.call(this)||this;p.aiDataContract={id:yi.Required,ver:yi.Required,name:yi.Default,resultCode:yi.Default,duration:yi.Default,success:yi.Default,data:yi.Default,target:yi.Default,type:yi.Default,properties:yi.Default,measurements:yi.Default,kind:yi.Default,value:yi.Default,count:yi.Default,min:yi.Default,max:yi.Default,stdDev:yi.Default,dependencyKind:yi.Default,dependencySource:yi.Default,commandName:yi.Default,dependencyTypeName:yi.Default},p.id=i,p.duration=xi.msToTimeSpan(o),p.success=a,p.resultCode=s+"",p.type=Si.sanitizeString(e,h);var g=_i.ParseDependencyPath(e,n,l,r);return p.data=Si.sanitizeUrl(e,r)||g.data,p.target=Si.sanitizeString(e,g.target),u&&(p.target=p.target+" | "+u),p.name=Si.sanitizeString(e,g.name),p.properties=Si.sanitizeProperties(e,d),p.measurements=Si.sanitizeMeasurements(e,c),p}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",e.dataType="RemoteDependencyData",e}(Qi),tn=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return __extends(e,t),e}(Bi),en=function(t){function e(e,i,n,r,o){var a=t.call(this)||this;return a.aiDataContract={ver:yi.Required,message:yi.Required,severityLevel:yi.Default,properties:yi.Default},i=i||xi.NotSpecified,a.message=Si.sanitizeMessage(e,i),a.properties=Si.sanitizeProperties(e,r),a.measurements=Si.sanitizeMeasurements(e,o),n&&(a.severityLevel=n),a}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.Message",e.dataType="MessageData",e}(tn),nn=function(t){function e(){var e=t.call(this)||this;return e.ver=2,e.properties={},e.measurements={},e}return __extends(e,t),e}(Zi),rn=function(t){function e(e,i,n,r,o,a,s){var l=t.call(this)||this;return l.aiDataContract={ver:yi.Required,name:yi.Default,url:yi.Default,duration:yi.Default,perfTotal:yi.Default,networkConnect:yi.Default,sentRequest:yi.Default,receivedResponse:yi.Default,domProcessing:yi.Default,properties:yi.Default,measurements:yi.Default},l.url=Si.sanitizeUrl(e,n),l.name=Si.sanitizeString(e,i)||xi.NotSpecified,l.properties=Si.sanitizeProperties(e,o),l.measurements=Si.sanitizeMeasurements(e,a),s&&(l.domProcessing=s.domProcessing,l.duration=s.duration,l.networkConnect=s.networkConnect,l.perfTotal=s.perfTotal,l.receivedResponse=s.receivedResponse,l.sentRequest=s.sentRequest),l}return __extends(e,t),e.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",e.dataType="PageviewPerformanceData",e}(nn),on=function(t){function e(e,i){var n=t.call(this)||this;return n.aiDataContract={baseType:yi.Required,baseData:yi.Required},n.baseType=e,n.baseData=i,n}return __extends(e,t),e}(Ii);!function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"}(t.SeverityLevel||(t.SeverityLevel={}));var an,sn=function(){function t(){}return t.getConfig=function(t,e,i,n){void 0===n&&(n=!1);var r;return r=i&&t.extensionConfig&&t.extensionConfig[i]&&!de.isNullOrUndefined(t.extensionConfig[i][e])?t.extensionConfig[i][e]:t[e],de.isNullOrUndefined(r)?n:r},t}(),ln=function(){function t(){this.applicationVersion="ai.application.ver",this.applicationBuild="ai.application.build",this.applicationTypeId="ai.application.typeId",this.applicationId="ai.application.applicationId",this.applicationLayer="ai.application.layer",this.deviceId="ai.device.id",this.deviceIp="ai.device.ip",this.deviceLanguage="ai.device.language",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceFriendlyName="ai.device.friendlyName",this.deviceNetwork="ai.device.network",this.deviceNetworkName="ai.device.networkName",this.deviceOEMName="ai.device.oemName",this.deviceOS="ai.device.os",this.deviceOSVersion="ai.device.osVersion",this.deviceRoleInstance="ai.device.roleInstance",this.deviceRoleName="ai.device.roleName",this.deviceScreenResolution="ai.device.screenResolution",this.deviceType="ai.device.type",this.deviceMachineName="ai.device.machineName",this.deviceVMName="ai.device.vmName",this.deviceBrowser="ai.device.browser",this.deviceBrowserVersion="ai.device.browserVersion",this.locationIp="ai.location.ip",this.locationCountry="ai.location.country",this.locationProvince="ai.location.province",this.locationCity="ai.location.city",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationRootId="ai.operation.rootId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.sessionIsNew="ai.session.isNew",this.userAccountAcquisitionDate="ai.user.accountAcquisitionDate",this.userAccountId="ai.user.accountId",this.userAgent="ai.user.userAgent",this.userId="ai.user.id",this.userStoreRegion="ai.user.storeRegion",this.userAuthUserId="ai.user.authUserId",this.userAnonymousUserAcquisitionDate="ai.user.anonUserAcquisitionDate",this.userAuthenticatedUserAcquisitionDate="ai.user.authUserAcquisitionDate",this.cloudName="ai.cloud.name",this.cloudRole="ai.cloud.role",this.cloudRoleVer="ai.cloud.roleVer",this.cloudRoleInstance="ai.cloud.roleInstance",this.cloudEnvironment="ai.cloud.environment",this.cloudLocation="ai.cloud.location",this.cloudDeploymentUnit="ai.cloud.deploymentUnit",this.internalNodeName="ai.internal.nodeName",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalSnippet="ai.internal.snippet",this.internalSdkSrc="ai.internal.sdkSrc"}return t}(),hn=function(){function t(){}return t.create=function(t,e,i,n,r,o){if(i=Si.sanitizeString(n,i)||xi.NotSpecified,de.isNullOrUndefined(t)||de.isNullOrUndefined(e)||de.isNullOrUndefined(i))throw Error("Input doesn't contain all required fields");var a={name:i,time:de.toISOString(new Date),iKey:"",ext:o||{},tags:[],data:{},baseType:e,baseData:t};return de.isNullOrUndefined(r)||G(r,function(t,e){a.data[t]=e}),a},t}(),un=function(){function t(){}return t.UserExt="user",t.DeviceExt="device",t.TraceExt="trace",t.WebExt="web",t.AppExt="app",t.OSExt="os",t.SessionExt="ses",t.SDKExt="sdk",t}(),dn=new ln,cn="AppInsightsPropertiesPlugin",pn="AppInsightsChannelPlugin",gn="ApplicationInsightsAnalytics",fn={PropertiesPluginIdentifier:cn,BreezeChannelIdentifier:pn,AnalyticsPluginIdentifier:gn,Util:xi,CorrelationIdHelper:Mi,UrlHelper:Ti,DateTimeUtils:Pi,ConnectionStringParser:Fi,FieldType:function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(yi),RequestHeaders:Ci,DisabledPropertyName:Ai,ProcessLegacy:Di,SampleRate:ki,HttpMethod:"http.method",DEFAULT_BREEZE_ENDPOINT:"https://dc.services.visualstudio.com",AIData:Ii,AIBase:Ei,Envelope:Oi,Event:Ri,Exception:Wi,Metric:qi,PageView:Ji,PageViewData:Zi,RemoteDependencyData:$i,Trace:en,PageViewPerformance:rn,Data:on,SeverityLevel:function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(t.SeverityLevel),ConfigurationManager:sn,ContextTagKeys:ln,DataSanitizer:Si,TelemetryItemCreator:hn,CtxTagKeys:dn,Extensions:un,DistributedTracingModes:function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(t.DistributedTracingModes)},yn=function(){function e(i,n,r,o){J(e,this,function(e){function a(){r&&u(r.getTransmissionControls(),function(t){u(t,function(t){return t.flush(!0)})})}function s(t){p.push(t),c||(c=setInterval(function(){var t=p.slice(0),e=!1;p=[],u(t,function(t){t()?e=!0:p.push(t)}),0===p.length&&(clearInterval(c),c=null),e&&a()},100))}var l,u=de.arrForEach,d=de.isNullOrUndefined,c=null,p=[],f=!1;r&&(l=r.logger),e.trackPageView=function(e,r){var u=e.name;if(d(u)||"string"!=typeof u){var c=h();u=e.name=c&&c.title||""}var p=e.uri;if(d(p)||"string"!=typeof p){var y=g();p=e.uri=y&&y.href||""}if(!o.isPerformanceTimingSupported())return i.sendPageViewInternal(e,r),a(),void l.throwInternal(t.LoggingSeverity.WARNING,ge.NavigationTimingNotSupported,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.");var m,C=!1,S=o.getPerformanceTiming().navigationStart;S>0&&(m=Pi.GetDuration(S,+new Date),o.shouldCollectDuration(m)||(m=void 0));var b;d(r)||d(r.duration)||(b=r.duration),!n&&isNaN(b)||(isNaN(b)&&(r||(r={}),r.duration=m),i.sendPageViewInternal(e,r),a(),C=!0);r||(r={}),s(function(){var n=!1;try{if(o.isPerformanceTimingDataReady()){n=!0;var a={name:u,uri:p};o.populatePageViewPerformanceEvent(a),a.isValid||C?(C||(r.duration=a.durationMs,i.sendPageViewInternal(e,r)),f||(i.sendPageViewPerformanceInternal(a,r),f=!0)):(r.duration=m,i.sendPageViewInternal(e,r))}else S>0&&Pi.GetDuration(S,+new Date)>6e4&&(n=!0,C||(r.duration=6e4,i.sendPageViewInternal(e,r)))}catch(e){l.throwInternal(t.LoggingSeverity.CRITICAL,ge.TrackPVFailedCalc,"trackPageView failed on page load calculation: "+xi.getExceptionName(e),{exception:xi.dump(e)})}return n})}})}return e}(),mn=function(){function t(t,e){this.prevPageVisitDataKeyName="prevPageVisitData",this.pageVisitTimeTrackingHandler=e,this._logger=t}return t.prototype.trackPreviousPageVisit=function(t,e){try{var i=this.restartPageVisitTimer(t,e);i&&this.pageVisitTimeTrackingHandler(i.pageName,i.pageUrl,i.pageVisitTime)}catch(t){this._logger.warnToConsole("Auto track page visit time failed, metric will not be collected: "+xi.dump(t))}},t.prototype.restartPageVisitTimer=function(t,e){try{var i=this.stopPageVisitTimer();return this.startPageVisitTimer(t,e),i}catch(t){return this._logger.warnToConsole("Call to restart failed: "+xi.dump(t)),null}},t.prototype.startPageVisitTimer=function(t,e){try{if(xi.canUseSessionStorage()){if(null!=xi.getSessionStorage(this._logger,this.prevPageVisitDataKeyName))throw new Error("Cannot call startPageVisit consecutively without first calling stopPageVisit");var i=new Cn(t,e),n=C().stringify(i);xi.setSessionStorage(this._logger,this.prevPageVisitDataKeyName,n)}}catch(t){this._logger.warnToConsole("Call to start failed: "+xi.dump(t))}},t.prototype.stopPageVisitTimer=function(){try{if(xi.canUseSessionStorage()){var t=de.dateNow(),e=xi.getSessionStorage(this._logger,this.prevPageVisitDataKeyName);if(e&&m()){var i=C().parse(e);return i.pageVisitTime=t-i.pageVisitStartTime,xi.removeSessionStorage(this._logger,this.prevPageVisitDataKeyName),i}return null}return null}catch(t){return this._logger.warnToConsole("Stop page visit timer failed: "+xi.dump(t)),null}},t}(),Cn=function(){function t(t,e){this.pageVisitStartTime=de.dateNow(),this.pageName=t,this.pageUrl=e}return t}(),Sn=function(){function e(t){this.MAX_DURATION_ALLOWED=36e5,t&&(this._logger=t.logger)}return e.prototype.populatePageViewPerformanceEvent=function(e){e.isValid=!1;var i=this.getPerformanceNavigationTiming(),n=this.getPerformanceTiming();if(i||n){if(i)var r=i.duration,o=Pi.GetDuration(i.startTime,i.connectEnd),a=Pi.GetDuration(i.requestStart,i.responseStart),s=Pi.GetDuration(i.responseStart,i.responseEnd),l=Pi.GetDuration(i.responseEnd,i.loadEventEnd);else var r=Pi.GetDuration(n.navigationStart,n.loadEventEnd),o=Pi.GetDuration(n.navigationStart,n.connectEnd),a=Pi.GetDuration(n.requestStart,n.responseStart),s=Pi.GetDuration(n.responseStart,n.responseEnd),l=Pi.GetDuration(n.responseEnd,n.loadEventEnd);0===r?this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.ErrorPVCalc,"error calculating page view performance.",{total:r,network:o,request:a,response:s,dom:l}):this.shouldCollectDuration(r,o,a,s,l)?r<Math.floor(o)+Math.floor(a)+Math.floor(s)+Math.floor(l)?this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.ClientPerformanceMathError,"client performance math error.",{total:r,network:o,request:a,response:s,dom:l}):(e.durationMs=r,e.perfTotal=e.duration=xi.msToTimeSpan(r),e.networkConnect=xi.msToTimeSpan(o),e.sentRequest=xi.msToTimeSpan(a),e.receivedResponse=xi.msToTimeSpan(s),e.domProcessing=xi.msToTimeSpan(l),e.isValid=!0):this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.InvalidDurationValue,"Invalid page load duration value. Browser perf data won't be sent.",{total:r,network:o,request:a,response:s,dom:l})}},e.prototype.getPerformanceTiming=function(){return this.isPerformanceTimingSupported()?y().timing:null},e.prototype.getPerformanceNavigationTiming=function(){return this.isPerformanceNavigationTimingSupported()?y().getEntriesByType("navigation")[0]:null},e.prototype.isPerformanceNavigationTimingSupported=function(){var t=y();return t&&t.getEntriesByType&&t.getEntriesByType("navigation").length>0},e.prototype.isPerformanceTimingSupported=function(){var t=y();return t&&t.timing},e.prototype.isPerformanceTimingDataReady=function(){var t=y(),e=t?t.timing:0;return e&&e.domainLookupStart>0&&e.navigationStart>0&&e.responseStart>0&&e.requestStart>0&&e.loadEventEnd>0&&e.responseEnd>0&&e.connectEnd>0&&e.domLoading>0},e.prototype.shouldCollectDuration=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=d()||{},n=["googlebot","adsbot-google","apis-google","mediapartners-google"],r=i.userAgent,o=!1;if(r)for(var a=0;a<n.length;a++)o=o||-1!==r.toLowerCase().indexOf(n[a]);if(o)return!1;for(var a=0;a<t.length;a++)if(t[a]<0||t[a]>=this.MAX_DURATION_ALLOWED)return!1;return!0},e}(),bn=function(e){function i(){var t=e.call(this)||this;t.identifier=gn,t.priority=180,t.autoRoutePVDelay=500,t._trackAjaxAttempts=0;var i=g();return t._prevUri=i&&i.href||"",t}return __extends(i,e),i.getDefaultConfig=function(t){return t||(t={}),t.sessionRenewalMs=18e5,t.sessionExpirationMs=864e5,t.disableExceptionTracking=xi.stringToBoolOrDefault(t.disableExceptionTracking),t.autoTrackPageVisitTime=xi.stringToBoolOrDefault(t.autoTrackPageVisitTime),t.overridePageViewDuration=xi.stringToBoolOrDefault(t.overridePageViewDuration),t.enableUnhandledPromiseRejectionTracking=xi.stringToBoolOrDefault(t.enableUnhandledPromiseRejectionTracking),(isNaN(t.samplingPercentage)||t.samplingPercentage<=0||t.samplingPercentage>=100)&&(t.samplingPercentage=100),t.isCookieUseDisabled=xi.stringToBoolOrDefault(t.isCookieUseDisabled),t.isStorageUseDisabled=xi.stringToBoolOrDefault(t.isStorageUseDisabled),t.isBrowserLinkTrackingEnabled=xi.stringToBoolOrDefault(t.isBrowserLinkTrackingEnabled),t.enableAutoRouteTracking=xi.stringToBoolOrDefault(t.enableAutoRouteTracking),t.namePrefix=t.namePrefix||"",t},i.prototype.processTelemetry=function(e,i){var n=this;$(this.core,function(){return n.identifier+":processTelemetry"},function(){var r=!1,o=n._telemetryInitializers.length;i=n._getTelCtx(i);for(var a=0;a<o;++a){var s=n._telemetryInitializers[a];if(s)try{if(!1===s.apply(null,[e])){r=!0;break}}catch(e){i.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+xi.getExceptionName(e),{exception:xi.dump(e)},!0)}}r||n.processNext(e,i)},function(){return{item:e}},!e.sync)},i.prototype.trackEvent=function(e,i){try{var n=hn.create(e,Ri.dataType,Ri.envelopeType,this.diagLog(),i);this.core.track(n)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.startTrackEvent=function(e){try{this._eventTracking.start(e)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.StartTrackEventFailed,"startTrackEvent failed, event will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.stopTrackEvent=function(e,i,n){try{this._eventTracking.stop(e,void 0,i)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.StopTrackEventFailed,"stopTrackEvent failed, event will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.trackTrace=function(e,i){try{var n=hn.create(e,en.dataType,en.envelopeType,this.diagLog(),i);this.core.track(n)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TrackTraceFailed,"trackTrace failed, trace will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.trackMetric=function(e,i){try{var n=hn.create(e,qi.dataType,qi.envelopeType,this.diagLog(),i);this.core.track(n)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TrackMetricFailed,"trackMetric failed, metric will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.trackPageView=function(e,i){try{var n=e||{};this._pageViewManager.trackPageView(n,__assign({},n.properties,n.measurements,i)),this.config.autoTrackPageVisitTime&&this._pageVisitTimeManager.trackPreviousPageVisit(n.name,n.uri)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TrackPVFailed,"trackPageView failed, page view will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.sendPageViewInternal=function(t,e,i){var n=h();n&&(t.refUri=void 0===t.refUri?n.referrer:t.refUri);var r=hn.create(t,Ji.dataType,Ji.envelopeType,this.diagLog(),e,i);this.core.track(r),this._trackAjaxAttempts=0},i.prototype.sendPageViewPerformanceInternal=function(t,e,i){var n=hn.create(t,rn.dataType,rn.envelopeType,this.diagLog(),e,i);this.core.track(n)},i.prototype.trackPageViewPerformance=function(e,i){try{this._pageViewPerformanceManager.populatePageViewPerformanceEvent(e),this.sendPageViewPerformanceInternal(e,i)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TrackPVFailed,"trackPageViewPerformance failed, page view will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.startTrackPage=function(e){try{if("string"!=typeof e){var i=h();e=i&&i.title||""}this._pageTracking.start(e)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.StartTrackFailed,"startTrackPage failed, page view may not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.stopTrackPage=function(e,i,n,r){try{if("string"!=typeof e){var o=h();e=o&&o.title||""}if("string"!=typeof i){var a=g();i=a&&a.href||""}this._pageTracking.stop(e,i,n,r),this.config.autoTrackPageVisitTime&&this._pageVisitTimeManager.trackPreviousPageVisit(e,i)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.StopTrackFailed,"stopTrackPage failed, page view will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype.sendExceptionInternal=function(t,e,i){var n=new Wi(this.diagLog(),t.exception||new Error(xi.NotSpecified),t.properties,t.measurements,t.severityLevel,t.id).toInterface(),r=hn.create(n,Wi.dataType,Wi.envelopeType,this.diagLog(),e,i);this.core.track(r)},i.prototype.trackException=function(e,i){try{this.sendExceptionInternal(e,i)}catch(e){this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TrackExceptionFailed,"trackException failed, exception will not be collected: "+xi.getExceptionName(e),{exception:xi.dump(e)})}},i.prototype._onerror=function(e){try{var i={url:e&&e.url||(h()||{}).URL,lineNumber:e.lineNumber,columnNumber:e.columnNumber,message:e.message};if(xi.isCrossOriginError(e.message,e.url,e.lineNumber,e.columnNumber,e.error))this._sendCORSException(i.url);else{if(!xi.isError(e.error)){var n="window.onerror@"+i.url+":"+e.lineNumber+":"+(e.columnNumber||0);e.error=new Error(e.message),e.error.stack=n}this.trackException({exception:e.error,severityLevel:t.SeverityLevel.Error},i)}}catch(i){var r=e.error?e.error.name+", "+e.error.message:"null"
;this.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.ExceptionWhileLoggingError,"_onError threw exception while logging error, error will not be collected: "+xi.getExceptionName(i),{exception:xi.dump(i),errorString:r})}},i.prototype.addTelemetryInitializer=function(t){this._telemetryInitializers.push(t)},i.prototype.initialize=function(t,n,r,o){var a=this;if(!this.isInitialized()){if(de.isNullOrUndefined(n))throw Error("Error initializing");e.prototype.initialize.call(this,t,n,r,o),this.setInitialized(!1);var l=this._getTelCtx(),h=this.identifier;this._globalconfig={instrumentationKey:t.instrumentationKey,endpointUrl:t.endpointUrl||"//donttrackmepls"},this.config=l.getExtCfg(h);var u=i.getDefaultConfig();void 0!==u&&(G(u,function(t,e){a.config[t]=l.getConfig(h,t,e)}),this._globalconfig&&G(u,function(t,e){void 0===a._globalconfig[t]&&(a._globalconfig[t]=e)})),this.config.isCookieUseDisabled&&xi.disableCookies(),this.config.isStorageUseDisabled&&xi.disableStorage();var d={instrumentationKey:function(){return t.instrumentationKey},accountId:function(){return a.config.accountId||t.accountId},sessionRenewalMs:function(){return a.config.sessionRenewalMs||t.sessionRenewalMs},sessionExpirationMs:function(){return a.config.sessionExpirationMs||t.sessionExpirationMs},sampleRate:function(){return a.config.samplingPercentage||t.samplingPercentage},cookieDomain:function(){return a.config.cookieDomain||t.cookieDomain},sdkExtension:function(){return a.config.sdkExtension||t.sdkExtension},isBrowserLinkTrackingEnabled:function(){return a.config.isBrowserLinkTrackingEnabled||t.isBrowserLinkTrackingEnabled},appId:function(){return a.config.appId||t.appId}};this._pageViewPerformanceManager=new Sn(this.core),this._pageViewManager=new yn(this,this.config.overridePageViewDuration,this.core,this._pageViewPerformanceManager),this._pageVisitTimeManager=new mn(this.diagLog(),function(t,e,i){return a.trackPageVisitTime(t,e,i)}),this._telemetryInitializers=this._telemetryInitializers||[],this._addDefaultTelemetryInitializers(d),this._eventTracking=new vn(this.diagLog(),"trackEvent"),this._eventTracking.action=function(t,e,i,n){n||(n={}),n.duration=i.toString(),a.trackEvent({name:t,properties:n})},this._pageTracking=new vn(this.diagLog(),"trackPageView"),this._pageTracking.action=function(t,e,i,n,r){de.isNullOrUndefined(n)&&(n={}),n.duration=i.toString();var o={name:t,uri:e,properties:n,measurements:r};a.sendPageViewInternal(o,n)};var c=s(),f=p(),y=g(),m=this;if(!1===this.config.disableExceptionTracking&&!this.config.autoExceptionInstrumented&&c){var C=c.onerror;c.onerror=function(t,e,i,n,r){var o=C&&C(t,e,i,n,r);return!0!==o&&m._onerror({message:t,url:e,lineNumber:i,columnNumber:n,error:r}),o},this.config.autoExceptionInstrumented=!0}if(!1===this.config.disableExceptionTracking&&!0===this.config.enableUnhandledPromiseRejectionTracking&&!this.config.autoUnhandledPromiseInstrumented&&c){var S=c.onunhandledrejection;c.onunhandledrejection=function(t){var e=S&&S.call(c,t);return!0!==e&&m._onerror({message:t.reason.toString(),error:t.reason instanceof Error?t.reason:new Error(t.reason.toString()),url:y?y.href:"",lineNumber:0,columnNumber:0}),e},this.config.autoUnhandledPromiseInstrumented=!0}if(!0===this.config.enableAutoRouteTracking&&f&&de.isFunction(f.pushState)&&de.isFunction(f.replaceState)&&c&&"undefined"!=typeof Event){var b=this;de.arrForEach(r,function(t){t.identifier===cn&&(a._properties=t)}),f.pushState=function(t){return function(){var e=t.apply(this,arguments);return yt(c,xi.createDomEvent(b.config.namePrefix+"pushState")),yt(c,xi.createDomEvent(b.config.namePrefix+"locationchange")),e}}(f.pushState),f.replaceState=function(t){return function(){var e=t.apply(this,arguments);return yt(c,xi.createDomEvent(b.config.namePrefix+"replaceState")),yt(c,xi.createDomEvent(b.config.namePrefix+"locationchange")),e}}(f.replaceState),c.addEventListener&&(c.addEventListener(b.config.namePrefix+"popstate",function(){yt(c,xi.createDomEvent(b.config.namePrefix+"locationchange"))}),c.addEventListener(b.config.namePrefix+"locationchange",function(){b._properties&&b._properties.context&&b._properties.context.telemetryTrace&&(b._properties.context.telemetryTrace.traceID=xi.generateW3CId(),b._properties.context.telemetryTrace.name=y&&y.pathname||"_unknown_"),a._currUri?(a._prevUri=a._currUri,a._currUri=y&&y.href||""):a._currUri=y&&y.href||"",setTimeout(function(t){b.trackPageView({refUri:t,properties:{duration:0}})}.bind(a,a._prevUri),b.autoRoutePVDelay)}))}this.setInitialized(!0)}},i.prototype.trackPageVisitTime=function(t,e,i){var n={PageName:t,PageUrl:e};this.trackMetric({name:"PageVisitTime",average:i,max:i,min:i,sampleCount:1},n)},i.prototype._addDefaultTelemetryInitializers=function(t){if(!t.isBrowserLinkTrackingEnabled()){var e=["/browserLinkSignalR/","/__browserLink/"],i=function(t){if(t.baseType===$i.dataType){var i=t.baseData;if(i)for(var n=0;n<e.length;n++)if(i.target&&i.target.indexOf(e[n])>=0)return!1}return!0};this._addTelemetryInitializer(i)}},i.prototype._addTelemetryInitializer=function(t){this._telemetryInitializers.push(t)},i.prototype._sendCORSException=function(t){var e={message:"Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",url:t,lineNumber:0,columnNumber:0,error:void 0},i=hn.create(e,Wi.dataType,Wi.envelopeType,this.diagLog(),{url:t});this.core.track(i)},i.Version="2.5.11",i}(Xe),vn=function(){function e(t,e){this._name=e,this._events={},this._logger=t}return e.prototype.start=function(e){void 0!==this._events[e]&&this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.StartCalledMoreThanOnce,"start was called more than once for this event without calling stop.",{name:this._name,key:e},!0),this._events[e]=+new Date},e.prototype.stop=function(e,i,n,r){var o=this._events[e];if(isNaN(o))this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.StopCalledWithoutStart,"stop was called without a corresponding start.",{name:this._name,key:e},!0);else{var a=+new Date,s=Pi.GetDuration(o,a);this.action(e,i,s,n,r)}delete this._events[e],this._events[e]=void 0},e}(),wn=function(){function t(e){var i=[];J(t,this,function(t){t.enqueue=function(t){i.push(t)},t.count=function(){return i.length},t.clear=function(){i.length=0},t.getItems=function(){return i.slice(0)},t.batchPayloads=function(t){if(t&&t.length>0){return e.emitLineDelimitedJson()?t.join("\n"):"["+t.join(",")+"]"}return null},t.markAsSent=function(e){t.clear()},t.clearSent=function(t){}})}return t}(),xn=function(){function e(i,n){var r,o=!1;J(e,this,function(a){function s(t,e){var i=[];return de.arrForEach(e,function(e){de.isFunction(e)||-1!==de.arrIndexOf(t,e)||i.push(e)}),i}function l(e){var r=e;try{r=n.namePrefix&&n.namePrefix()?n.namePrefix()+"_"+r:r;var o=xi.getSessionStorage(i,r);if(o){var a=C().parse(o);if(de.isString(a)&&(a=C().parse(a)),a&&xi.isArray(a))return a}}catch(e){i.throwInternal(t.LoggingSeverity.CRITICAL,ge.FailedToRestoreStorageBuffer," storage key: "+r+", "+xi.getExceptionName(e),{exception:xi.dump(e)})}return[]}function h(e,r){var o=e;try{o=n.namePrefix&&n.namePrefix()?n.namePrefix()+"_"+o:o;var a=JSON.stringify(r);xi.setSessionStorage(i,o,a)}catch(e){xi.setSessionStorage(i,o,JSON.stringify([])),i.throwInternal(t.LoggingSeverity.WARNING,ge.FailedToSetStorageBuffer," storage key: "+o+", "+xi.getExceptionName(e)+". Buffer cleared",{exception:xi.dump(e)})}}var u=l(e.BUFFER_KEY),d=l(e.SENT_BUFFER_KEY);r=u.concat(d),r.length>e.MAX_BUFFER_SIZE&&(r.length=e.MAX_BUFFER_SIZE),h(e.SENT_BUFFER_KEY,[]),h(e.BUFFER_KEY,r),a.enqueue=function(n){if(r.length>=e.MAX_BUFFER_SIZE)return void(o||(i.throwInternal(t.LoggingSeverity.WARNING,ge.SessionStorageBufferFull,"Maximum buffer size reached: "+r.length,!0),o=!0));r.push(n),h(e.BUFFER_KEY,r)},a.count=function(){return r.length},a.clear=function(){r=[],h(e.BUFFER_KEY,[]),h(e.SENT_BUFFER_KEY,[]),o=!1},a.getItems=function(){return r.slice(0)},a.batchPayloads=function(t){if(t&&t.length>0){return n.emitLineDelimitedJson()?t.join("\n"):"["+t.join(",")+"]"}return null},a.markAsSent=function(n){r=s(n,r),h(e.BUFFER_KEY,r);var o=l(e.SENT_BUFFER_KEY);o instanceof Array&&n instanceof Array&&(o=o.concat(n),o.length>e.MAX_BUFFER_SIZE&&(i.throwInternal(t.LoggingSeverity.CRITICAL,ge.SessionStorageBufferFull,"Sent buffer reached its maximum size: "+o.length,!0),o.length=e.MAX_BUFFER_SIZE),h(e.SENT_BUFFER_KEY,o))},a.clearSent=function(t){var i=l(e.SENT_BUFFER_KEY);i=s(t,i),h(e.SENT_BUFFER_KEY,i)}})}return e.BUFFER_KEY="AI_buffer",e.SENT_BUFFER_KEY="AI_sentBuffer",e.MAX_BUFFER_SIZE=2e3,e}(),Tn=de.isNullOrUndefined,Mn=function(){function e(){}return e.extractPropsAndMeasurements=function(t,e,i){Tn(t)||G(t,function(t,n){de.isNumber(n)?i[t]=n:de.isString(n)?e[t]=n:m()&&(e[t]=C().stringify(n))})},e.createEnvelope=function(t,i,n,r){var o=new Oi(t,r,i);mt(o,"sampleRate",n[ki]),(n.baseData||{}).startTime&&(o.time=de.toISOString(n.baseData.startTime)),o.iKey=n.iKey;var a=n.iKey.replace(/-/g,"");return o.name=o.name.replace("{0}",a),e.extractPartAExtensions(n,o),n.tags=n.tags||[],o},e.extractPartAExtensions=function(t,i){var n=i.tags=i.tags||{},r=t.ext=t.ext||{},o=t.tags=t.tags||[],a=r.user;a&&(mt(n,dn.userAuthUserId,a.authId),mt(n,dn.userId,a.id||a.localId));var s=r.app;s&&mt(n,dn.sessionId,s.sesId);var l=r.device;l&&(mt(n,dn.deviceId,l.id||l.localId),mt(n,dn.deviceType,l.deviceClass),mt(n,dn.deviceIp,l.ip),mt(n,dn.deviceModel,l.model),mt(n,dn.deviceType,l.deviceType));var h=t.ext.web;if(h){mt(n,dn.deviceLanguage,h.browserLang),mt(n,dn.deviceBrowserVersion,h.browserVer),mt(n,dn.deviceBrowser,h.browser);var u=i.data=i.data||{},d=u.baseData=u.baseData||{},c=d.properties=d.properties||{};mt(c,"domain",h.domain),mt(c,"isManual",h.isManual?"true":null),mt(c,"screenRes",h.screenRes),mt(c,"userConsent",h.userConsent?"true":null)}var p=r.os;p&&mt(n,dn.deviceOS,p.name);var g=r.trace;g&&(mt(n,dn.operationParentId,g.parentID),mt(n,dn.operationName,g.name),mt(n,dn.operationId,g.traceID));for(var f={},y=o.length-1;y>=0;y--){G(o[y],function(t,e){f[t]=e}),o.splice(y,1)}G(o,function(t,e){f[t]=e}),i.tags=__assign({},n,f),i.tags[dn.internalSdkVersion]||(i.tags[dn.internalSdkVersion]="javascript:"+e.Version)},e.prototype.Init=function(e,i){this._logger=e,Tn(i.baseData)&&this._logger.throwInternal(t.LoggingSeverity.CRITICAL,ge.TelemetryEnvelopeInvalid,"telemetryItem.baseData cannot be null.")},e.Version="2.5.11",e}(),_n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n=i.baseData.measurements||{},r=i.baseData.properties||{};Mn.extractPropsAndMeasurements(i.data,r,n);var o=i.baseData;if(Tn(o))return e.warnToConsole("Invalid input for dependency data"),null;var a=o.properties&&o.properties["http.method"]?o.properties["http.method"]:"GET",s=new $i(e,o.id,o.target,o.name,o.duration,o.success,o.responseCode,a,o.type,o.correlationContext,r,n),l=new on($i.dataType,s);return Mn.createEnvelope(e,$i.envelopeType,i,l)},e.DependencyEnvelopeCreator=new e,e}(Mn),Pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n={},r={};i.baseType!==Ri.dataType&&(n.baseTypeSource=i.baseType),i.baseType===Ri.dataType?(n=i.baseData.properties||{},r=i.baseData.measurements||{}):i.baseData&&Mn.extractPropsAndMeasurements(i.baseData,n,r),Mn.extractPropsAndMeasurements(i.data,n,r);var o=i.baseData.name,a=new Ri(e,o,n,r),s=new on(Ri.dataType,a);return Mn.createEnvelope(e,Ri.envelopeType,i,s)},e.EventEnvelopeCreator=new e,e}(Mn),An=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n=i.baseData.measurements||{},r=i.baseData.properties||{};Mn.extractPropsAndMeasurements(i.data,r,n);var o=i.baseData,a=Wi.CreateFromInterface(e,o,r,n),s=new on(Wi.dataType,a);return Mn.createEnvelope(e,Wi.envelopeType,i,s)},e.ExceptionEnvelopeCreator=new e,e}(Mn),kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n=i.baseData,r=n.properties||{},o=n.measurements||{};Mn.extractPropsAndMeasurements(i.data,r,o);var a=new qi(e,n.name,n.average,n.sampleCount,n.min,n.max,r,o),s=new on(qi.dataType,a);return Mn.createEnvelope(e,qi.envelopeType,i,s)},e.MetricEnvelopeCreator=new e,e}(Mn),Dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n,r=i.baseData;Tn(r)||Tn(r.properties)||Tn(r.properties.duration)?Tn(i.data)||Tn(i.data.duration)||(n=i.data.duration,delete i.data.duration):(n=r.properties.duration,delete r.properties.duration);var o,a=i.baseData;((i.ext||{}).trace||{}).traceID&&(o=i.ext.trace.traceID);var s=a.id||o,l=a.name,h=a.uri,u=a.properties||{},d=a.measurements||{};if(Tn(a.refUri)||(u.refUri=a.refUri),Tn(a.pageType)||(u.pageType=a.pageType),Tn(a.isLoggedIn)||(u.isLoggedIn=a.isLoggedIn.toString()),!Tn(a.properties)){G(a.properties,function(t,e){u[t]=e})}Mn.extractPropsAndMeasurements(i.data,u,d);var c=new Ji(e,l,h,n,u,d,s),p=new on(Ji.dataType,c);return Mn.createEnvelope(e,Ji.envelopeType,i,p)},e.PageViewEnvelopeCreator=new e,e}(Mn),Fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n=i.baseData,r=n.name,o=n.uri||n.url,a=n.properties||{},s=n.measurements||{};Mn.extractPropsAndMeasurements(i.data,a,s);var l=new rn(e,r,o,void 0,a,s,n),h=new on(rn.dataType,l);return Mn.createEnvelope(e,rn.envelopeType,i,h)},e.PageViewPerformanceEnvelopeCreator=new e,e}(Mn),En=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.Create=function(e,i){t.prototype.Init.call(this,e,i);var n=i.baseData.message,r=i.baseData.severityLevel,o=i.baseData.properties||{},a=i.baseData.measurements||{};Mn.extractPropsAndMeasurements(i.data,o,a);var s=new en(e,n,r,o,a),l=new on(en.dataType,s);return Mn.createEnvelope(e,en.envelopeType,i,l)},e.TraceEnvelopeCreator=new e,e}(Mn),In=function(){function e(i){J(e,this,function(e){function n(e,a){var s={};if(!e)return i.throwInternal(t.LoggingSeverity.CRITICAL,ge.CannotSerializeObject,"cannot serialize object because it is null or undefined",{name:a},!0),s;if(e.__aiCircularRefCheck)return i.throwInternal(t.LoggingSeverity.WARNING,ge.CircularReferenceDetected,"Circular reference detected while serializing object",{name:a},!0),s;if(!e.aiDataContract){if("measurements"===a)s=o(e,"number",a);else if("properties"===a)s=o(e,"string",a);else if("tags"===a)s=o(e,"string",a);else if(xi.isArray(e))s=r(e,a);else{i.throwInternal(t.LoggingSeverity.WARNING,ge.CannotSerializeObjectNonSerializable,"Attempting to serialize an object which does not implement ISerializable",{name:a},!0);try{C().stringify(e),s=e}catch(e){i.throwInternal(t.LoggingSeverity.CRITICAL,ge.CannotSerializeObject,e&&de.isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}}return s}return e.__aiCircularRefCheck=!0,G(e.aiDataContract,function(o,l){var h=de.isFunction(l)?l()&yi.Required:l&yi.Required,u=de.isFunction(l)?l()&yi.Hidden:l&yi.Hidden,d=l&yi.Array,c=void 0!==e[o],p=de.isObject(e[o])&&null!==e[o];if(!h||c||d){if(!u){var g=void 0;g=p?d?r(e[o],o):n(e[o],o):e[o],void 0!==g&&(s[o]=g)}}else i.throwInternal(t.LoggingSeverity.CRITICAL,ge.MissingRequiredFieldSpecification,"Missing required field specification. The field is required but not present on source",{field:o,name:a})}),delete e.__aiCircularRefCheck,s}function r(e,r){var o;if(e)if(xi.isArray(e)){o=[];for(var a=0;a<e.length;a++){var s=e[a],l=n(s,r+"["+a+"]");o.push(l)}}else i.throwInternal(t.LoggingSeverity.CRITICAL,ge.ItemNotInArray,"This field was specified as an array in the contract but the item is not an array.\r\n",{name:r},!0);return o}function o(e,n,r){var o;return e&&(o={},G(e,function(e,a){if("string"===n)void 0===a?o[e]="undefined":null===a?o[e]="null":a.toString?o[e]=a.toString():o[e]="invalid field: toString() is not defined.";else if("number"===n)if(void 0===a)o[e]="undefined";else if(null===a)o[e]="null";else{var s=parseFloat(a);isNaN(s)?o[e]="NaN":o[e]=s}else o[e]="invalid field: "+r+" is of unknown type.",i.throwInternal(t.LoggingSeverity.CRITICAL,o[e],null,!0)})),o}e.serialize=function(e){var r=n(e,"root");try{return C().stringify(r)}catch(e){i.throwInternal(t.LoggingSeverity.CRITICAL,ge.CannotSerializeObject,e&&de.isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}}})}return e}(),Gn=function(){function t(){var e=s(),i=h(),n=!1,r=!0;J(t,this,function(t){function o(){r=!0}function a(){r=!1}try{if(e&&pe.Attach(e,"online",o)&&(pe.Attach(e,"offline",a),n=!0),i){var s=i.body||i;de.isUndefined(s.ononline)||(s.ononline=o,s.onoffline=a,n=!0)}}catch(t){n=!1}t.isListening=n,t.isOnline=function(){var t=!0,e=d();return n?t=r:e&&!de.isNullOrUndefined(e.onLine)&&(t=e.onLine),t},t.isOffline=function(){return!t.isOnline()}})}return t.Offline=new t,t}(),On=Gn.Offline,Bn=function(){function t(){}return t.prototype.getHashCodeScore=function(e){return this.getHashCode(e)/t.INT_MAX_VALUE*100},t.prototype.getHashCode=function(e){if(""===e)return 0;for(;e.length<t.MIN_INPUT_LENGTH;)e=e.concat(e);for(var i=5381,n=0;n<e.length;++n)i=(i<<5)+i+e.charCodeAt(n),i&=i;return Math.abs(i)},t.INT_MAX_VALUE=2147483647,t.MIN_INPUT_LENGTH=8,t}(),Ln=function(){function t(){this.hashCodeGeneragor=new Bn,this.keys=new ln}return t.prototype.getSamplingScore=function(t){return t.tags&&t.tags[this.keys.userId]?this.hashCodeGeneragor.getHashCodeScore(t.tags[this.keys.userId]):t.ext&&t.ext.user&&t.ext.user.id?this.hashCodeGeneragor.getHashCodeScore(t.ext.user.id):t.tags&&t.tags[this.keys.operationId]?this.hashCodeGeneragor.getHashCodeScore(t.tags[this.keys.operationId]):t.ext&&t.ext.telemetryTrace&&t.ext.telemetryTrace.traceID?this.hashCodeGeneragor.getHashCodeScore(t.ext.telemetryTrace.traceID):100*Math.random()},t}(),Rn=function(){function e(e,i){this.INT_MAX_VALUE=2147483647,this._logger=de.isNullOrUndefined(i)?new Le:i,(e>100||e<0)&&(this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.SampleRateOutOfRange,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),this.sampleRate=100),this.sampleRate=e,this.samplingScoreGenerator=new Ln}return e.prototype.isSampledIn=function(t){var e=this.sampleRate;return null===e||void 0===e||e>=100||(t.baseType===qi.dataType||this.samplingScoreGenerator.getSamplingScore(t)<e)},e}(),Nn=function(e){function i(){var n=e.call(this)||this;n.priority=1001,n.identifier=pn,n._XMLHttpRequestSupported=!1;var r,a,l,h;return J(i,n,function(e,u){function c(){throw new Error("Method not implemented.")}function p(t){return e._sample.isSampledIn(t)}function g(i,n){var r=e._senderConfig.endpointUrl(),o=e._buffer.batchPayloads(i),a=new Blob([o],{type:"text/plain;charset=UTF-8"});d().sendBeacon(r,a)?(e._buffer.markAsSent(i),e._onSuccess(i,i.length)):(f(i,!0),e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TransmissionFailed,". Failed to send telemetry with Beacon API, retried with xhrSender."))}function f(t,i){var n=new XMLHttpRequest,r=e._senderConfig.endpointUrl();try{n[Ai]=!0}catch(t){}n.open("POST",r,i),n.setRequestHeader("Content-type","application/json"),xi.isInternalApplicationInsightsEndpoint(r)&&n.setRequestHeader(Ci.sdkContextHeader,Ci.sdkContextHeaderAppIdRequest),n.onreadystatechange=function(){return e._xhrReadyStateChange(n,t,t.length)},n.onerror=function(i){return e._onError(t,w(n),i)};var o=e._buffer.batchPayloads(t);n.send(o),e._buffer.markAsSent(t)}function y(i){try{if(i&&""!==i){var n=C().parse(i);if(n&&n.itemsReceived&&n.itemsReceived>=n.itemsAccepted&&n.itemsReceived-n.itemsAccepted===n.errors.length)return n}}catch(n){e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.InvalidBackendResponse,"Cannot parse the response. "+xi.getExceptionName(n),{response:i})}return null}function m(t,i){if(void 0===i&&(i=1),t&&0!==t.length){e._buffer.clearSent(t),r++;for(var n=0,o=t;n<o.length;n++){var a=o[n];e._buffer.enqueue(a)}S(i),b()}}function S(t){var e;if(r<=1)e=10;else{var i=(Math.pow(2,r)-1)/2,n=Math.floor(Math.random()*i*10)+1;n*=t,e=Math.max(Math.min(n,3600),10)}var o=de.dateNow()+1e3*e;a=o}function b(){if(!l){var t=a?Math.max(0,a-de.dateNow()):0,i=Math.max(e._senderConfig.maxBatchInterval(),t);l=setTimeout(function(){e.triggerSend(!0,null,1)},i)}}function v(t){return 408===t||429===t||500===t||503===t}function w(t,e){return t?"XMLHttpRequest,Status:"+t.status+",Response:"+Ct(t)||t.response||"":e}function x(i,n){var r=s(),o=new XDomainRequest;o.onload=function(){return e._xdrOnLoad(o,i)},o.onerror=function(t){return e._onError(i,T(o),t)};var a=r&&r.location&&r.location.protocol||"";if(0!==e._senderConfig.endpointUrl().lastIndexOf(a,0))return e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TransmissionFailed,". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."),void e._buffer.clear();var l=e._senderConfig.endpointUrl().replace(/^(https?:)/,"");o.open("POST",l);var h=e._buffer.batchPayloads(i);o.send(h),e._buffer.markAsSent(i)}function T(t,e){return t?"XDomainRequest,Response:"+Ct(t)||"":e}function M(){return e.core.getNotifyMgr?e.core.getNotifyMgr():e.core._notificationManager}function _(i,n){var r=M();if(r&&r.eventsSendRequest)try{r.eventsSendRequest(i,n)}catch(i){e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.NotificationException,"send request notification failed: "+xi.getExceptionName(i),{exception:xi.dump(i)})}}function P(t){if(!de.isNullOrUndefined(t.disableInstrumentationKeyValidation)&&t.disableInstrumentationKeyValidation)return!0;return new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(t.instrumentationKey)}e.pause=c,e.resume=c,e.flush=function(){try{e.triggerSend(!0,null,1)}catch(i){e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.FlushFailed,"flush failed, telemetry will not be collected: "+xi.getExceptionName(i),{exception:xi.dump(i)})}},e.onunloadFlush=function(){if(!1!==e._senderConfig.onunloadDisableBeacon()&&!1!==e._senderConfig.isBeaconApiDisabled()||!xi.IsBeaconApiSupported())e.flush();else try{e.triggerSend(!0,g,2)}catch(i){e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.FailedToSendQueuedTelemetry,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+xi.getExceptionName(i),{exception:xi.dump(i)})}},e.teardown=c,e.initialize=function(n,s,l,d){u.initialize(n,s,l,d);var c=e._getTelCtx(),p=e.identifier;h=new In(s.logger),r=0,a=null,e._sender=null;var y=i._getDefaultAppInsightsChannelConfig();if(e._senderConfig=i._getEmptyAppInsightsChannelConfig(),G(y,function(t,i){e._senderConfig[t]=function(){return c.getConfig(p,t,i())}}),e._buffer=e._senderConfig.enableSessionStorageBuffer()&&xi.canUseSessionStorage()?new xn(e.diagLog(),e._senderConfig):new wn(e._senderConfig),e._sample=new Rn(e._senderConfig.samplingPercentage(),e.diagLog()),P(n)||e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.InvalidInstrumentationKey,"Invalid Instrumentation key "+n.instrumentationKey),!e._senderConfig.isBeaconApiDisabled()&&xi.IsBeaconApiSupported())e._sender=g;else if(void 0!==typeof XMLHttpRequest){var m=o("XMLHttpRequest");if(m){var C=new m;"withCredentials"in C?(e._sender=f,e._XMLHttpRequestSupported=!0):void 0!==typeof XDomainRequest&&(e._sender=x)}}},e.processTelemetry=function(n,r){r=e._getTelCtx(r);try{if(e._senderConfig.disableTelemetry())return;if(!n)return void r.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.CannotSendEmptyTelemetry,"Cannot send empty telemetry");if(n.baseData&&!n.baseType)return void r.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.InvalidEvent,"Cannot send telemetry without baseData and baseType");if(n.baseType||(n.baseType="EventData"),!e._sender)return void r.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.SenderNotInitialized,"Sender was not initialized");if(!p(n))return void r.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TelemetrySampledAndNotSent,"Telemetry item was sampled out and not sent",{SampleRate:e._sample.sampleRate});n[ki]=e._sample.sampleRate;var o=i.constructEnvelope(n,e._senderConfig.instrumentationKey(),r.diagLog());if(!o)return void r.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.CreateEnvelopeError,"Unable to create an AppInsights envelope");var a=!1;if(n.tags&&n.tags[Di]&&(de.arrForEach(n.tags[Di],function(e){try{e&&!1===e(o)&&(a=!0,r.diagLog().warnToConsole("Telemetry processor check returns false"))}catch(e){r.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TelemetryInitializerFailed,"One of telemetry initializers failed, telemetry item will not be sent: "+xi.getExceptionName(e),{exception:xi.dump(e)},!0)}}),delete n.tags[Di]),a)return;var s=h.serialize(o),l=e._buffer.getItems(),u=e._buffer.batchPayloads(l);u&&u.length+s.length>e._senderConfig.maxBatchSizeInBytes()&&e.triggerSend(!0,null,10),e._buffer.enqueue(s),b()}catch(e){r.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.FailedAddingTelemetryToBuffer,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+xi.getExceptionName(e),{exception:xi.dump(e)})}e.processNext(n,r)},e._xhrReadyStateChange=function(i,n,o){if(4===i.readyState){var a=null;if(e._appId||(a=y(Ct(i)||i.response))&&a.appId&&(e._appId=a.appId),(i.status<200||i.status>=300)&&0!==i.status)!e._senderConfig.isRetryDisabled()&&v(i.status)?(m(n),e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TransmissionFailed,". Response code "+i.status+". Will retry to send "+n.length+" items.")):e._onError(n,w(i));else if(On.isOffline()){if(!e._senderConfig.isRetryDisabled()){m(n,10),e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TransmissionFailed,". Offline - Response Code: "+i.status+". Offline status: "+On.isOffline()+". Will retry to send "+n.length+" items.")}}else 206===i.status?(a||(a=y(Ct(i)||i.response)),a&&!e._senderConfig.isRetryDisabled()?e._onPartialSuccess(n,a):e._onError(n,w(i))):(r=0,e._onSuccess(n,o))}},e.triggerSend=function(i,r,o){void 0===i&&(i=!0);try{if(e._senderConfig.disableTelemetry())e._buffer.clear();else if(e._buffer.count()>0){var s=e._buffer.getItems();_(o||0,i),r?r.call(n,s,i):e._sender(s,i)}clearTimeout(l),l=null,a=null}catch(i){var h=xi.getIEVersion();(!h||h>9)&&e.diagLog().throwInternal(t.LoggingSeverity.CRITICAL,ge.TransmissionFailed,"Telemetry transmission failed, some telemetry will be lost: "+xi.getExceptionName(i),{exception:xi.dump(i)})}},e._onError=function(i,n,r){e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.OnError,"Failed to send telemetry.",{message:n}),e._buffer.clearSent(i)},e._onPartialSuccess=function(i,n){for(var r=[],o=[],a=n.errors.reverse(),s=0,l=a;s<l.length;s++){var h=l[s],u=i.splice(h.index,1)[0];v(h.statusCode)?o.push(u):r.push(u)}i.length>0&&e._onSuccess(i,n.itemsAccepted),r.length>0&&e._onError(r,w(null,["partial success",n.itemsAccepted,"of",n.itemsReceived].join(" "))),o.length>0&&(m(o),e.diagLog().throwInternal(t.LoggingSeverity.WARNING,ge.TransmissionFailed,"Partial success. Delivered: "+i.length+", Failed: "+r.length+". Will retry to send "+o.length+" our of "+n.itemsReceived+" items"))},e._onSuccess=function(t,i){e._buffer.clearSent(t)},e._xdrOnLoad=function(t,i){var n=Ct(t);if(!t||n+""!="200"&&""!==n){var o=y(n);o&&o.itemsReceived&&o.itemsReceived>o.itemsAccepted&&!e._senderConfig.isRetryDisabled()?e._onPartialSuccess(i,o):e._onError(i,T(t))}else r=0,e._onSuccess(i,0)}}),n}return __extends(i,e),i.constructEnvelope=function(t,e,i){var n;switch(n=e===t.iKey||de.isNullOrUndefined(e)?t:__assign({},t,{iKey:e}),n.baseType){case Ri.dataType:return Pn.EventEnvelopeCreator.Create(i,n);case en.dataType:return En.TraceEnvelopeCreator.Create(i,n);case Ji.dataType:return Dn.PageViewEnvelopeCreator.Create(i,n);case rn.dataType:return Fn.PageViewPerformanceEnvelopeCreator.Create(i,n);case Wi.dataType:return An.ExceptionEnvelopeCreator.Create(i,n);case qi.dataType:return kn.MetricEnvelopeCreator.Create(i,n);case $i.dataType:return _n.DependencyEnvelopeCreator.Create(i,n);default:return Pn.EventEnvelopeCreator.Create(i,n)}},i._getDefaultAppInsightsChannelConfig=function(){return{endpointUrl:function(){return"//donttrackmepls"},emitLineDelimitedJson:function(){return!1},maxBatchInterval:function(){return 15e3},maxBatchSizeInBytes:function(){return 102400},disableTelemetry:function(){return!1},enableSessionStorageBuffer:function(){return!0},isRetryDisabled:function(){return!1},isBeaconApiDisabled:function(){return!0},onunloadDisableBeacon:function(){return!1},instrumentationKey:function(){},namePrefix:function(){},samplingPercentage:function(){return 100}}},i._getEmptyAppInsightsChannelConfig=function(){return{endpointUrl:void 0,emitLineDelimitedJson:void 0,maxBatchInterval:void 0,maxBatchSizeInBytes:void 0,disableTelemetry:void 0,enableSessionStorageBuffer:void 0,isRetryDisabled:void 0,isBeaconApiDisabled:void 0,onunloadDisableBeacon:void 0,instrumentationKey:void 0,namePrefix:void 0,samplingPercentage:void 0}},i}(Xe),Un=function(){function t(){}return t}(),Vn=function(){function e(t,i){var n=this;de.isNullOrUndefined(i)?this._logger=new Le:this._logger=i,t||(t={}),"function"!=typeof t.sessionExpirationMs&&(t.sessionExpirationMs=function(){return e.acquisitionSpan}),"function"!=typeof t.sessionRenewalMs&&(t.sessionRenewalMs=function(){return e.renewalSpan}),this.config=t,this._storageNamePrefix=function(){return n.config.namePrefix&&n.config.namePrefix()?e.cookieNameConst+n.config.namePrefix():e.cookieNameConst},this.automaticSession=new Un}return e.prototype.update=function(){this.automaticSession.id||this.initializeAutomaticSession();var t=(new Date).getTime(),i=0!==this.config.sessionExpirationMs()&&t-this.automaticSession.acquisitionDate>this.config.sessionExpirationMs(),n=0!==this.config.sessionExpirationMs()&&t-this.automaticSession.renewalDate>this.config.sessionRenewalMs();i||n?this.renew():(!this.cookieUpdatedTimestamp||t-this.cookieUpdatedTimestamp>e.cookieUpdateInterval)&&(this.automaticSession.renewalDate=t,this.setCookie(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate))},e.prototype.backup=function(){this.setStorage(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate)},e.prototype.initializeAutomaticSession=function(){var t=xi.getCookie(this._logger,this._storageNamePrefix());if(t&&"function"==typeof t.split)this.initializeAutomaticSessionWithData(t);else{var e=xi.getStorage(this._logger,this._storageNamePrefix());e&&this.initializeAutomaticSessionWithData(e)}this.automaticSession.id||this.renew()},e.prototype.initializeAutomaticSessionWithData=function(e){var i=e.split("|");i.length>0&&(this.automaticSession.id=i[0]);try{if(i.length>1){var n=+i[1];this.automaticSession.acquisitionDate=+new Date(n),this.automaticSession.acquisitionDate=this.automaticSession.acquisitionDate>0?this.automaticSession.acquisitionDate:0}if(i.length>2){var r=+i[2];this.automaticSession.renewalDate=+new Date(r),this.automaticSession.renewalDate=this.automaticSession.renewalDate>0?this.automaticSession.renewalDate:0}}catch(e){this._logger.throwInternal(t.LoggingSeverity.CRITICAL,ge.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+xi.getExceptionName(e),{exception:xi.dump(e)})}0===this.automaticSession.renewalDate&&this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")},e.prototype.renew=function(){
var e=(new Date).getTime();this.automaticSession.id=xi.newId(this.config&&this.config.idLength?this.config.idLength():22),this.automaticSession.acquisitionDate=e,this.automaticSession.renewalDate=e,this.setCookie(this.automaticSession.id,this.automaticSession.acquisitionDate,this.automaticSession.renewalDate),xi.canUseLocalStorage()||this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")},e.prototype.setCookie=function(t,e,i){var n=e+this.config.sessionExpirationMs(),r=i+this.config.sessionRenewalMs(),o=new Date,a=[t,e,i];n<r?o.setTime(n):o.setTime(r);var s=this.config.cookieDomain?this.config.cookieDomain():null,l=0===this.config.sessionExpirationMs()?"0":o.toUTCString();xi.setCookie(this._logger,this._storageNamePrefix(),a.join("|")+";expires="+l,s),this.cookieUpdatedTimestamp=(new Date).getTime()},e.prototype.setStorage=function(t,e,i){xi.setStorage(this._logger,this._storageNamePrefix(),[t,e,i].join("|"))},e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e.cookieNameConst="ai_session",e}(),Hn=function(){function t(){}return t}(),Wn=function(){function t(){this.id="browser",this.deviceClass="Browser"}return t}(),Kn="2.5.11",zn=function(){function t(t){this.sdkVersion=(t.sdkExtension&&t.sdkExtension()?t.sdkExtension()+"_":"")+"javascript:"+Kn}return t}(),jn=function(){function e(t,i){this.isNewUser=!1,this._logger=i;var n=xi.getCookie(this._logger,e.userCookieName);if(n){this.isNewUser=!1;var r=n.split(e.cookieSeparator);r.length>0&&(this.id=r[0])}if(this.config=t,!this.id){this.id=de.newId(t&&t.idLength?t.idLength():22);var o=new Date,a=de.toISOString(o);this.accountAcquisitionDate=a,this.isNewUser=!0,o.setTime(o.getTime()+31536e6);var s=[this.id,a],l=this.config.cookieDomain?this.config.cookieDomain():void 0;xi.setCookie(this._logger,e.userCookieName,s.join(e.cookieSeparator)+";expires="+o.toUTCString(),l);var h=t.namePrefix&&t.namePrefix()?t.namePrefix()+"ai_session":"ai_session";xi.removeStorage(this._logger,h)}this.accountId=t.accountId?t.accountId():void 0;var u=xi.getCookie(this._logger,e.authUserCookieName);if(u){u=decodeURI(u);var d=u.split(e.cookieSeparator);d[0]&&(this.authenticatedId=d[0]),d.length>1&&d[1]&&(this.accountId=d[1])}}return e.prototype.setAuthenticatedUserContext=function(i,n,r){if(void 0===r&&(r=!1),!this.validateUserInput(i)||n&&!this.validateUserInput(n))return void this._logger.throwInternal(t.LoggingSeverity.WARNING,ge.SetAuthContextFailedAccountName,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);this.authenticatedId=i;var o=this.authenticatedId;n&&(this.accountId=n,o=[this.authenticatedId,this.accountId].join(e.cookieSeparator)),r&&xi.setCookie(this._logger,e.authUserCookieName,encodeURI(o),this.config.cookieDomain())},e.prototype.clearAuthenticatedUserContext=function(){this.authenticatedId=null,this.accountId=null,xi.deleteCookie(this._logger,e.authUserCookieName)},e.prototype.validateUserInput=function(t){return!("string"!=typeof t||!t||t.match(/,|;|=| |\|/))},e.cookieSeparator="|",e.userCookieName="ai_user",e.authUserCookieName="ai_authUser",e}(),Yn=function(){function t(){}return t}(),Xn=function(){function t(t,e,i,n){this.traceID=t||xi.generateW3CId(),this.parentID=e,this.name=i;var r=g();!i&&r&&r.pathname&&(this.name=r.pathname),this.name=Si.sanitizeString(n,this.name)}return t}(),qn=function(){function t(t,e){var i=this;i.application=new Hn,i.internal=new zn(e),a()&&(i.sessionManager=new Vn(e,t),i.device=new Wn,i.location=new Yn,i.user=new jn(e,t),i.telemetryTrace=new Xn(void 0,void 0,void 0,t),i.session=new Un),i.appId=function(){return null}}return t.prototype.applySessionContext=function(t,e){var i=this.session,n=this.sessionManager,r=i||n&&n.automaticSession;r&&de.isString(r.id)&&(t.ext.app.sesId=r.id),i&&(de.isString(i.id)?t.ext.app.sesId=i.id:t.ext.app.sesId=n.automaticSession.id)},t.prototype.applyOperatingSystemContxt=function(t,e){var i=this.os;i&&i.name&&(t.ext.os=i)},t.prototype.applyApplicationContext=function(t,e){var i=this.application;i&&(de.isString(i.ver)&&(t.tags[dn.applicationVersion]=i.ver),de.isString(i.build)&&(t.tags[dn.applicationBuild]=i.build))},t.prototype.applyDeviceContext=function(t,e){var i=this.device;i&&(de.isString(i.id)&&(t.ext.device.localId=i.id),de.isString(i.ip)&&(t.ext.device.ip=i.ip),de.isString(i.model)&&(t.ext.device.model=i.model),de.isString(i.deviceClass)&&(t.ext.device.deviceClass=i.deviceClass))},t.prototype.applyInternalContext=function(t,e){var i=this.internal;i&&(de.isString(i.agentVersion)&&(t.tags[dn.internalAgentVersion]=i.agentVersion),de.isString(i.sdkVersion)&&(t.tags[dn.internalSdkVersion]=i.sdkVersion),t.baseType!==Be.dataType&&t.baseType!==Ji.dataType||(de.isString(i.snippetVer)&&(t.tags[dn.internalSnippet]=i.snippetVer),de.isString(i.sdkSrc)&&(t.tags[dn.internalSdkSrc]=i.sdkSrc)))},t.prototype.applyLocationContext=function(t,e){var i=this.location;i&&de.isString(i.ip)&&(t.tags[dn.locationIp]=i.ip)},t.prototype.applyOperationContext=function(t,e){var i=this.telemetryTrace;if(i){var n=t.ext.trace||{traceID:void 0,parentID:void 0};de.isString(i.traceID)&&(n.traceID=i.traceID),de.isString(i.name)&&(n.name=i.name),de.isString(i.parentID)&&(n.parentID=i.parentID),t.ext.trace=n}},t.prototype.applyWebContext=function(t,e){var i=this.web;i&&(t.ext.web=t.ext.web||{},t.ext.web=i)},t.prototype.applyUserContext=function(t,e){var i=this.user;i&&(t.tags||(t.tags=[]),de.isString(i.accountId)&&(t.tags[dn.userAccountId]=i.accountId),de.isString(i.id)&&(t.ext.user.id=i.id),de.isString(i.authenticatedId)&&(t.ext.user.authId=i.authenticatedId))},t.prototype.cleanUp=function(t,e){t.ext[un.DeviceExt]&&0===de.objKeys(t.ext[un.DeviceExt]).length&&delete t.ext[un.DeviceExt],t.ext[un.UserExt]&&0===de.objKeys(t.ext[un.UserExt]).length&&delete t.ext[un.UserExt],t.ext[un.WebExt]&&0===de.objKeys(t.ext[un.WebExt]).length&&delete t.ext[un.WebExt],t.ext[un.OSExt]&&0===de.objKeys(t.ext[un.OSExt]).length&&delete t.ext[un.OSExt],t.ext[un.AppExt]&&0===de.objKeys(t.ext[un.AppExt]).length&&delete t.ext[un.AppExt],t.ext[un.TraceExt]&&0===de.objKeys(t.ext[un.TraceExt]).length&&delete t.ext[un.TraceExt]},t}(),Zn=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.priority=110,t.identifier=cn,t}return __extends(i,e),i.getDefaultConfig=function(){return{instrumentationKey:function(){},accountId:function(){return null},sessionRenewalMs:function(){return 18e5},samplingPercentage:function(){return 100},sessionExpirationMs:function(){return 864e5},cookieDomain:function(){return null},sdkExtension:function(){return null},isBrowserLinkTrackingEnabled:function(){return!1},appId:function(){return null},namePrefix:function(){},idLength:function(){return 22}}},i.prototype.initialize=function(t,n,r,o){var a=this;e.prototype.initialize.call(this,t,n,r,o);var s=this._getTelCtx(),l=this.identifier,h=i.getDefaultConfig();this._extensionConfig=this._extensionConfig||i.getDefaultConfig(),G(h,function(t,e){a._extensionConfig[t]=function(){return s.getConfig(l,t,e())}}),this.context=new qn(n.logger,this._extensionConfig),this._breezeChannel=xi.getExtension(r,pn),this.context.appId=function(){return a._breezeChannel?a._breezeChannel._appId:null}},i.prototype.processTelemetry=function(e,i){if(de.isNullOrUndefined(e));else{if(i=this._getTelCtx(i),e.name===Ji.envelopeType&&i.diagLog().resetInternalMessageCount(),this.context.session&&"string"!=typeof this.context.session.id&&this.context.sessionManager.update(),this._processTelemetryInternal(e,i),this.context&&this.context.user&&this.context.user.isNewUser){this.context.user.isNewUser=!1;var n=new Be(ge.SendBrowserInfoOnUserInit,(d()||{}).userAgent||"");i.diagLog().logInternalMessage(t.LoggingSeverity.CRITICAL,n)}this.processNext(e,i)}},i.prototype._processTelemetryInternal=function(t,e){t.tags||(t.tags=[]),t.ext||(t.ext={});var i=t.ext;i[un.DeviceExt]=i[un.DeviceExt]||{},i[un.WebExt]=i[un.WebExt]||{},i[un.UserExt]=i[un.UserExt]||{},i[un.OSExt]=i[un.OSExt]||{},i[un.AppExt]=i[un.AppExt]||{},i[un.TraceExt]=i[un.TraceExt]||{};var n=this.context;n.applySessionContext(t,e),n.applyApplicationContext(t,e),n.applyDeviceContext(t,e),n.applyOperationContext(t,e),n.applyUserContext(t,e),n.applyOperatingSystemContxt(t,e),n.applyWebContext(t,e),n.applyLocationContext(t,e),n.applyInternalContext(t,e),n.cleanUp(t,e)},i}(Xe),Jn="properties",Qn=de.objKeys,$n=de.arrForEach,tr=function(){function t(){var t=this;t.openDone=!1,t.setRequestHeaderDone=!1,t.sendDone=!1,t.abortDone=!1,t.stateChangeAttached=!1}return t}(),er=function(){function t(e,i,n){var r=this,o=n;r.perfMark=null,r.completed=!1,r.requestHeadersSize=null,r.requestHeaders=null,r.responseReceivingDuration=null,r.callbackDuration=null,r.ajaxTotalDuration=null,r.aborted=0,r.pageUrl=null,r.requestUrl=null,r.requestSize=0,r.method=null,r.status=null,r.requestSentTime=null,r.responseStartedTime=null,r.responseFinishedTime=null,r.callbackFinishedTime=null,r.endTime=null,r.xhrMonitoringState=new tr,r.clientFailure=0,r.traceID=e,r.spanID=i,J(t,r,function(t){t.getAbsoluteUrl=function(){return t.requestUrl?Ti.getAbsoluteUrl(t.requestUrl):null},t.getPathName=function(){return t.requestUrl?Si.sanitizeUrl(o,Ti.getCompleteUrl(t.method,t.requestUrl)):null},t.CreateTrackItem=function(e,i,n){if(t.ajaxTotalDuration=Math.round(1e3*Pi.GetDuration(t.requestSentTime,t.responseFinishedTime))/1e3,t.ajaxTotalDuration<0)return null;var r=(l={id:"|"+t.traceID+"."+t.spanID,target:t.getAbsoluteUrl(),name:t.getPathName(),type:e,duration:t.ajaxTotalDuration,success:+t.status>=200&&+t.status<400,responseCode:+t.status,method:t.method},l[Jn]={HttpMethod:t.method},l);if(wt(t,r),i&&Qn(t.requestHeaders).length>0&&(r[Jn]=r[Jn]||{},r[Jn].requestHeaders=t.requestHeaders),n){var o=n();if(o){var a=o.correlationContext;if(a&&(r.correlationContext=a),o.headerMap&&Qn(o.headerMap).length>0&&(r[Jn]=r[Jn]||{},r[Jn].responseHeaders=o.headerMap),t.status>=400){var s=o.type;r[Jn]=r[Jn]||{},""!==s&&"text"!==s||(r[Jn].responseText=o.responseText?o.statusText+" - "+o.responseText:o.statusText),"json"===s&&(r[Jn].responseText=o.response?o.statusText+" - "+JSON.stringify(o.response):o.statusText)}}}return r;var l}})}return t}(),ir=function(){function t(e,i){var n=this;n.traceFlag=t.DEFAULT_TRACE_FLAG,n.version=t.DEFAULT_VERSION,e&&t.isValidTraceId(e)?n.traceId=e:n.traceId=xi.generateW3CId(),i&&t.isValidSpanId(i)?n.spanId=i:n.spanId=xi.generateW3CId().substr(0,16)}return t.isValidTraceId=function(t){return t.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==t},t.isValidSpanId=function(t){return t.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==t},t.prototype.toString=function(){var t=this;return t.version+"-"+t.traceId+"-"+t.spanId+"-"+t.traceFlag},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}(),nr="ai.ajxmn.",rr="diagLog",or="ajaxData",ar="throwInternal",sr="fetch",lr=de.isNullOrUndefined,hr=de.arrForEach,ur=0,dr=function(e){function i(){var n=e.call(this)||this;n.identifier=i.identifier,n.priority=120;var r,o,a,s,l="trackDependencyDataInternal",h=g(),u=!1,d=!1,c=h&&h.host&&h.host.toLowerCase(),p=i.getEmptyConfig(),f=!1,m=0,C=!1,S=0,b=!1,v=[],w={};return J(i,n,function(e,n){function h(){var t=xt();if(t){var i=$t(),n=t.polyfill;!1===p.disableFetchTracking?(v.push(dt(i,sr,{req:function(t,i,r){var o;if(u&&!T(null,i,r)&&(!n||!d)){var a=t.ctx();o=I(i,r);var s=e.includeCorrelationHeaders(o,i,r);s!==r&&t.set(1,s),a.data=o}},rsp:function(t,e){var i=t.ctx().data;i&&(t.rslt=t.rslt.then(function(e){return B(t,(e||{}).status,e,i,function(){var t={statusText:e.statusText,headerMap:null,correlationContext:L(e)};if(b){var i={};e.headers.forEach(function(t,e){i[e]=t}),t.headerMap=i}return t}),e}).catch(function(n){throw B(t,0,e,i,null,{error:n.message}),n}))},hkErr:At(e,ge.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.")})),u=!0):n&&v.push(dt(i,sr,{req:function(t,e,i){T(null,e,i)}})),n&&(i[sr].polyfill=n)}}function g(t,e,i){v.push(ut(t,e,i))}function x(){Tt(e)&&!d&&(g(XMLHttpRequest,"open",{req:function(t,e,i,n){var r=t.inst,o=r[or];T(r,i)||!M(r,!0)||o&&o.xhrMonitoringState.openDone||_(r,e,i,n)},hkErr:At(e,ge.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.")}),g(XMLHttpRequest,"send",{req:function(t,i){var n=t.inst,r=n[or];M(n)&&!r.xhrMonitoringState.sendDone&&(F("xhr",r),r.requestSentTime=Pi.Now(),n=e.includeCorrelationHeaders(r,void 0,void 0,n),r.xhrMonitoringState.sendDone=!0)},hkErr:At(e,ge.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.")}),g(XMLHttpRequest,"abort",{req:function(t){var e=t.inst,i=e[or];M(e)&&!i.xhrMonitoringState.abortDone&&(i.aborted=1,i.xhrMonitoringState.abortDone=!0)},hkErr:At(e,ge.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.")}),f&&g(XMLHttpRequest,"setRequestHeader",{req:function(t,e,i){var n=t.inst;M(n)&&(n[or].requestHeaders[e]=i)},hkErr:At(e,ge.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.")}),d=!0)}function T(t,e,i){var n=!1,r=((de.isString(e)?e:(e||{}).url||"")||"").toLowerCase(),o=kt(r,"?"),a=kt(r,"#");return(-1===o||-1!==a&&a<o)&&(o=a),-1!==o&&(r=r.substring(0,o)),lr(t)?lr(e)||(n="object"==typeof e&&!0===e[Ai]||!!i&&!0===i[Ai]):n=!0===t[Ai]||!0===r[Ai],n?w[r]||(w[r]=1):w[r]&&(n=!0),n}function M(t,e){var i=!0,n=d;return lr(t)||(i=!0===e||!lr(t[or])),n&&i}function _(t,i,n,o){var a=r&&r.telemetryTrace&&r.telemetryTrace.traceID||xi.generateW3CId(),s=xi.generateW3CId().substr(0,16),l=new er(a,s,e[rr]());l.method=i,l.requestUrl=n,l.xhrMonitoringState.openDone=!0,l.requestHeaders={},l.async=o,t[or]=l,P(t)}function P(t){t[or].xhrMonitoringState.stateChangeAttached=pe.Attach(t,"readystatechange",function(){try{t&&4===t.readyState&&M(t)&&k(t)}catch(n){var i=xi.dump(n);i&&-1!==kt(i.toLowerCase(),"c00c023f")||_t(e,ge.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:Mt(t),exception:i})}})}function A(t){try{var e=t.responseType;if(""===e||"text"===e)return t.responseText}catch(t){}return null}function k(t){function i(i,n){var r=n||{};r.ajaxDiagnosticsMessage=Mt(t),i&&(r.exception=xi.dump(i)),Pt(e,ge.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",r)}var n=t[or];n.responseFinishedTime=Pi.Now(),n.status=t.status,E("xmlhttprequest",n,function(){try{var r=n.CreateTrackItem("Ajax",f,function(){var e={statusText:t.statusText,headerMap:null,correlationContext:D(t),type:t.responseType,responseText:A(t),response:t.response};if(b){var i=t.getAllResponseHeaders();if(i){var n=de.strTrim(i).split(/[\r\n]+/),r={};hr(n,function(t){var e=t.split(": "),i=e.shift(),n=e.join(": ");r[i]=n}),e.headerMap=r}}return e});r?e[l](r):i(null,{requestSentTime:n.requestSentTime,responseFinishedTime:n.responseFinishedTime})}finally{try{t[or]=null}catch(t){}}},function(t){i(t,null)})}function D(t){try{var i=t.getAllResponseHeaders();if(null!==i){if(-1!==kt(i.toLowerCase(),Ci.requestContextHeaderLowerCase)){var n=t.getResponseHeader(Ci.requestContextHeader);return Mi.getCorrelationContext(n)}}}catch(i){Pt(e,ge.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:Mt(t),exception:xi.dump(i)})}}function F(t,e){if(e.requestUrl&&s&&C){var i=y();if(i&&de.isFunction(i.mark)){ur++;var n=s+t+"#"+ur;i.mark(n);var r=i.getEntriesByName(n);r&&1===r.length&&(e.perfMark=r[0])}}}function E(t,e,i,n){var r=e.perfMark,o=y(),a=p.maxAjaxPerfLookupAttempts,s=p.ajaxPerfLookupDelay,l=e.requestUrl,h=0;!function u(){try{if(o&&r){h++;for(var d=null,c=o.getEntries(),p=c.length-1;p>=0;p--){var g=c[p];if(g){if("resource"===g.entryType)g.initiatorType!==t||-1===kt(g.name,l)&&-1===kt(l,g.name)||(d=g);else if("mark"===g.entryType&&g.name===r.name){e.perfTiming=d;break}if(g.startTime<r.startTime-1e3)break}}}!r||e.perfTiming||h>=a||!1===e.async?(r&&de.isFunction(o.clearMarks)&&o.clearMarks(r.name),e.perfAttempts=h,i()):setTimeout(u,s)}catch(t){n(t)}}()}function I(t,i){var n=r&&r.telemetryTrace&&r.telemetryTrace.traceID||xi.generateW3CId(),o=xi.generateW3CId().substr(0,16),a=new er(n,o,e[rr]());a.requestSentTime=Pi.Now(),t instanceof Request?a.requestUrl=t?t.url:"":a.requestUrl=t;var s="GET";i&&i.method?s=i.method:t&&t instanceof Request&&(s=t.method),a.method=s;var l={};if(f){new Headers((i?i.headers:0)||(t instanceof Request?t.headers||{}:{})).forEach(function(t,e){l[e]=t})}return a.requestHeaders=l,F("fetch",a),a}function O(t){var i="";try{lr(t)||(i+="string"==typeof t?"(url: '"+t+"')":"(url: '"+t.url+"')")}catch(t){_t(e,ge.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:xi.dump(t)})}return i}function B(t,i,n,r,o,a){function s(t,i,r){var o=r||{};o.fetchDiagnosticsMessage=O(n),i&&(o.exception=xi.dump(i)),Pt(e,t,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",o)}r&&(r.responseFinishedTime=Pi.Now(),r.status=i,E("fetch",r,function(){var t=r.CreateTrackItem("Fetch",f,o);t?e[l](t):s(ge.FailedMonitorAjaxDur,null,{requestSentTime:r.requestSentTime,responseFinishedTime:r.responseFinishedTime})},function(t){s(ge.FailedMonitorAjaxGetCorrelationHeader,t,null)}))}function L(t){if(t&&t.headers)try{var i=t.headers.get(Ci.requestContextHeader);return Mi.getCorrelationContext(i)}catch(i){Pt(e,ge.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:O(t),exception:xi.dump(i)})}}e.initialize=function(l,u,d,c){if(!e.isInitialized()){n.initialize(l,u,d,c);var g=e._getTelCtx();G(i.getDefaultConfig(),function(t,e){p[t]=g.getConfig(i.identifier,t,e)});var y=p.distributedTracingMode;if(f=p.enableRequestHeaderTracking,C=p.enableAjaxPerfTracking,S=p.maxAjaxCallsPerView,b=p.enableResponseHeaderTracking,a=y===t.DistributedTracingModes.AI||y===t.DistributedTracingModes.AI_AND_W3C,o=y===t.DistributedTracingModes.AI_AND_W3C||y===t.DistributedTracingModes.W3C,C){var m=l.instrumentationKey||"unkwn";s=m.length>5?nr+m.substring(m.length-5)+".":nr+m+"."}if(!1===p.disableAjaxTracking&&x(),h(),d.length>0&&d){for(var v=void 0,w=0;!v&&w<d.length;)d[w]&&d[w].identifier===cn&&(v=d[w]),w++;v&&(r=v.context)}}},e.teardown=function(){hr(v,function(t){t.rm()}),v=[],u=!1,d=!1,e.setInitialized(!1)},e.trackDependencyData=function(t,i){e[l](t,i)},e.includeCorrelationHeaders=function(t,i,n,s){var l=e._currentWindowHost||c;if(i){if(Mi.canIncludeCorrelationHeader(p,t.getAbsoluteUrl(),l)){if(n||(n={}),n.headers=new Headers(n.headers||(i instanceof Request?i.headers||{}:{})),a){var h="|"+t.traceID+"."+t.spanID;n.headers.set(Ci.requestIdHeader,h),f&&(t.requestHeaders[Ci.requestIdHeader]=h)}var u=p.appId||r&&r.appId();if(u&&(n.headers.set(Ci.requestContextHeader,Ci.requestContextAppIdFormat+u),f&&(t.requestHeaders[Ci.requestContextHeader]=Ci.requestContextAppIdFormat+u)),o){var d=new ir(t.traceID,t.spanID);n.headers.set(Ci.traceParentHeader,d.toString()),f&&(t.requestHeaders[Ci.traceParentHeader]=d.toString())}}return n}if(s){if(Mi.canIncludeCorrelationHeader(p,t.getAbsoluteUrl(),l)){if(a){var h="|"+t.traceID+"."+t.spanID;s.setRequestHeader(Ci.requestIdHeader,h),f&&(t.requestHeaders[Ci.requestIdHeader]=h)}var u=p.appId||r&&r.appId();if(u&&(s.setRequestHeader(Ci.requestContextHeader,Ci.requestContextAppIdFormat+u),f&&(t.requestHeaders[Ci.requestContextHeader]=Ci.requestContextAppIdFormat+u)),o){var d=new ir(t.traceID,t.spanID);s.setRequestHeader(Ci.traceParentHeader,d.toString()),f&&(t.requestHeaders[Ci.traceParentHeader]=d.toString())}}return s}},e[l]=function(i,n,r){if(-1===S||m<S){p.distributedTracingMode!==t.DistributedTracingModes.W3C&&p.distributedTracingMode!==t.DistributedTracingModes.AI_AND_W3C||"string"!=typeof i.id||"."===i.id[i.id.length-1]||(i.id+="."),de.isNullOrUndefined(i.startTime)&&(i.startTime=new Date);var o=hn.create(i,$i.dataType,$i.envelopeType,e[rr](),n,r);e.core.track(o)}else m===S&&_t(e,ge.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++m}}),n}return __extends(i,e),i.getDefaultConfig=function(){return{maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,disableCorrelationHeaders:!1,distributedTracingMode:t.DistributedTracingModes.AI,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1,enableAjaxErrorStatusText:!1,enableAjaxPerfTracking:!1,maxAjaxPerfLookupAttempts:3,ajaxPerfLookupDelay:25}},i.getEmptyConfig=function(){var t=this.getDefaultConfig();return G(t,function(e){t[e]=void 0}),t},i.prototype.processTelemetry=function(t,e){this.processNext(t,e)},i.identifier="AjaxDependencyPlugin",i}(Xe),cr=de.arrForEach,pr=de.isString,gr=de.isFunction,fr=["snippet","dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],yr=fn,mr=function(){function e(t){var e=this;e._snippetVersion=""+(t.sv||t.version||""),t.queue=t.queue||[],t.version=t.version||2;var i=t.config||{};if(i.connectionString){var n=Fi.parse(i.connectionString),r=n.ingestionendpoint;i.endpointUrl=r?r+"/v2/track":i.endpointUrl,i.instrumentationKey=n.instrumentationkey||i.instrumentationKey}e.appInsights=new bn,e.properties=new Zn,e.dependencies=new dr,e.core=new ui,e.snippet=t,e.config=i,e.getSKUDefaults()}return e.prototype.trackEvent=function(t,e){this.appInsights.trackEvent(t,e)},e.prototype.trackPageView=function(t){var e=t||{};this.appInsights.trackPageView(e)},e.prototype.trackPageViewPerformance=function(t){var e=t||{};this.appInsights.trackPageViewPerformance(e)},e.prototype.trackException=function(t){t&&!t.exception&&t.error&&(t.exception=t.error),this.appInsights.trackException(t)},e.prototype._onerror=function(t){this.appInsights._onerror(t)},e.prototype.trackTrace=function(t,e){this.appInsights.trackTrace(t,e)},e.prototype.trackMetric=function(t,e){this.appInsights.trackMetric(t,e)},e.prototype.startTrackPage=function(t){this.appInsights.startTrackPage(t)},e.prototype.stopTrackPage=function(t,e,i,n){this.appInsights.stopTrackPage(t,e,i,n)},e.prototype.startTrackEvent=function(t){this.appInsights.startTrackEvent(t)},e.prototype.stopTrackEvent=function(t,e,i){this.appInsights.stopTrackEvent(t,e,i)},e.prototype.addTelemetryInitializer=function(t){return this.appInsights.addTelemetryInitializer(t)},e.prototype.setAuthenticatedUserContext=function(t,e,i){void 0===i&&(i=!1),this.properties.context.user.setAuthenticatedUserContext(t,e,i)},e.prototype.clearAuthenticatedUserContext=function(){this.properties.context.user.clearAuthenticatedUserContext()},e.prototype.trackDependencyData=function(t){this.dependencies.trackDependencyData(t)},e.prototype.flush=function(t){var e=this;void 0===t&&(t=!0),$(this.core,function(){return"AISKU.flush"},function(){cr(e.core.getTransmissionControls(),function(e){cr(e,function(e){e.flush(t)})})},null,t)},e.prototype.onunloadFlush=function(t){void 0===t&&(t=!0),cr(this.core.getTransmissionControls(),function(e){cr(e,function(e){e.onunloadFlush?e.onunloadFlush():e.flush(t)})})},e.prototype.loadAppInsights=function(t,e,i){function n(e){if(e){var i="";de.isNullOrUndefined(o._snippetVersion)||(i+=o._snippetVersion),t&&(i+=".lg"),o.context&&o.context.internal&&(o.context.internal.snippetVer=i||"-"),G(o,function(t,i){pr(t)&&!gr(i)&&t&&"_"!==t[0]&&-1===fr.indexOf(t)&&(e[t]=i)})}}var r=this;void 0===t&&(t=!1);var o=this;if(t&&o.config.extensions&&o.config.extensions.length>0)throw new Error("Extensions not allowed in legacy mode");return $(o.core,function(){return"AISKU.loadAppInsights"},function(){var t=[],a=new Nn;t.push(a),t.push(o.properties),t.push(o.dependencies),t.push(o.appInsights),o.core.initialize(o.config,t,e,i),o.context=o.properties.context,an&&o.context&&(o.context.internal.sdkSrc=an),n(o.snippet),o.emptyQueue(),o.pollInternalLogs(),o.addHousekeepingBeforeUnload(r)}),o},e.prototype.updateSnippetDefinitions=function(t){O(t,this,function(t){return t&&-1===fr.indexOf(t)})},e.prototype.emptyQueue=function(){var t=this;try{if(xi.isArray(t.snippet.queue)){for(var e=t.snippet.queue.length,i=0;i<e;i++){(0,t.snippet.queue[i])()}t.snippet.queue=void 0,delete t.snippet.queue}}catch(t){var n={};t&&gr(t.toString)&&(n.exception=t.toString())}},e.prototype.pollInternalLogs=function(){this.core.pollInternalLogs()},e.prototype.addHousekeepingBeforeUnload=function(e){if(a()||l()){var i=function(){e.onunloadFlush(!1);var t=e.appInsights.core._extensions[cn];t&&t.context&&t.context._sessionManager&&t.context._sessionManager.backup()};if(!e.appInsights.config.disableFlushOnBeforeUnload){var n=de.addEventHandler("beforeunload",i);n=de.addEventHandler("pagehide",i)||n,n||v()||e.appInsights.core.logger.throwInternal(t.LoggingSeverity.CRITICAL,ge.FailedToAddHandlerForOnBeforeUnload,"Could not add handler for beforeunload and pagehide")}e.appInsights.config.disableFlushOnUnload||de.addEventHandler("pagehide",i)}},e.prototype.getSKUDefaults=function(){var t=this;t.config.diagnosticLogInterval=t.config.diagnosticLogInterval&&t.config.diagnosticLogInterval>0?t.config.diagnosticLogInterval:1e4},e}();!function(){var t=null,e=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var i=(document||{}).currentScript;i&&(t=i.src)}catch(t){}if(t)try{var n=t.toLowerCase();if(n)for(var r="",o=0;o<e.length;o++)if(-1!==n.indexOf(e[o])){r="cdn"+(o+1),-1===n.indexOf("/scripts/")&&(-1!==n.indexOf("/next/")?r+="-next":-1!==n.indexOf("/beta/")&&(r+="-beta")),an=r+"";break}}catch(t){}}();var Cr=["snippet","getDefaultConfig","_hasLegacyInitializers","_queue","_processLegacyInitializers"],Sr=function(){function t(e,i){this._hasLegacyInitializers=!1,this._queue=[],this.config=t.getDefaultConfig(e.config),this.appInsightsNew=i,this.context={addTelemetryInitializer:this.addTelemetryInitializers.bind(this)}}return t.getDefaultConfig=function(t){t||(t={});var e=xi.stringToBoolOrDefault;return t.endpointUrl=t.endpointUrl||"//donttrackmepls",t.sessionRenewalMs=18e5,t.sessionExpirationMs=864e5,t.maxBatchSizeInBytes=t.maxBatchSizeInBytes>0?t.maxBatchSizeInBytes:102400,t.maxBatchInterval=isNaN(t.maxBatchInterval)?15e3:t.maxBatchInterval,t.enableDebug=e(t.enableDebug),t.disableExceptionTracking=e(t.disableExceptionTracking),t.disableTelemetry=e(t.disableTelemetry),t.verboseLogging=e(t.verboseLogging),t.emitLineDelimitedJson=e(t.emitLineDelimitedJson),t.diagnosticLogInterval=t.diagnosticLogInterval||1e4,t.autoTrackPageVisitTime=e(t.autoTrackPageVisitTime),(isNaN(t.samplingPercentage)||t.samplingPercentage<=0||t.samplingPercentage>=100)&&(t.samplingPercentage=100),t.disableAjaxTracking=e(t.disableAjaxTracking),t.maxAjaxCallsPerView=isNaN(t.maxAjaxCallsPerView)?500:t.maxAjaxCallsPerView,t.isBeaconApiDisabled=e(t.isBeaconApiDisabled,!0),t.disableCorrelationHeaders=e(t.disableCorrelationHeaders),t.correlationHeaderExcludedDomains=t.correlationHeaderExcludedDomains||["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],t.disableFlushOnBeforeUnload=e(t.disableFlushOnBeforeUnload),t.disableFlushOnUnload=e(t.disableFlushOnUnload,t.disableFlushOnBeforeUnload),t.enableSessionStorageBuffer=e(t.enableSessionStorageBuffer,!0),t.isRetryDisabled=e(t.isRetryDisabled),t.isCookieUseDisabled=e(t.isCookieUseDisabled),t.isStorageUseDisabled=e(t.isStorageUseDisabled),t.isBrowserLinkTrackingEnabled=e(t.isBrowserLinkTrackingEnabled),t.enableCorsCorrelation=e(t.enableCorsCorrelation),t},t.prototype.addTelemetryInitializers=function(t){var e=this;this._hasLegacyInitializers||(this.appInsightsNew.addTelemetryInitializer(function(t){e._processLegacyInitializers(t)}),this._hasLegacyInitializers=!0),this._queue.push(t)},t.prototype.startTrackPage=function(t){this.appInsightsNew.startTrackPage(t)},t.prototype.stopTrackPage=function(t,e,i,n){this.appInsightsNew.stopTrackPage(t,e,i)},t.prototype.trackPageView=function(t,e,i,n,r){var o={name:t,uri:e,properties:i,measurements:n};this.appInsightsNew.trackPageView(o)},t.prototype.trackEvent=function(t,e,i){this.appInsightsNew.trackEvent({name:t})},t.prototype.trackDependency=function(t,e,i,n,r,o,a){this.appInsightsNew.trackDependencyData({id:t,target:i,type:n,duration:r,properties:{HttpMethod:e},success:o,responseCode:a})},t.prototype.trackException=function(t,e,i,n,r){this.appInsightsNew.trackException({exception:t})},t.prototype.trackMetric=function(t,e,i,n,r,o){this.appInsightsNew.trackMetric({name:t,average:e,sampleCount:i,min:n,max:r})},t.prototype.trackTrace=function(t,e,i){this.appInsightsNew.trackTrace({message:t,severityLevel:i})},t.prototype.flush=function(t){this.appInsightsNew.flush(t)},t.prototype.setAuthenticatedUserContext=function(t,e,i){this.appInsightsNew.context.user.setAuthenticatedUserContext(t,e,i)},t.prototype.clearAuthenticatedUserContext=function(){this.appInsightsNew.context.user.clearAuthenticatedUserContext()},t.prototype._onerror=function(t,e,i,n,r){this.appInsightsNew._onerror({message:t,url:e,lineNumber:i,columnNumber:n,error:r})},t.prototype.startTrackEvent=function(t){this.appInsightsNew.startTrackEvent(t)},t.prototype.stopTrackEvent=function(t,e,i){this.appInsightsNew.stopTrackEvent(t,e,i)},t.prototype.downloadAndSetup=function(t){throw new Error("downloadAndSetup not implemented in web SKU")},t.prototype.updateSnippetDefinitions=function(t){O(t,this,function(t){return t&&-1===Cr.indexOf(t)})},t.prototype.loadAppInsights=function(){var t=this;if(this.config.iKey){var e=this.trackPageView;this.trackPageView=function(i,n,r){e.apply(t,[null,i,n,r])}}"function"==typeof this.snippet.logPageView&&(this.logPageView=function(e,i,n){t.trackPageView(null,e,i,n)});return"function"==typeof this.snippet.logEvent&&(this.logEvent=function(e,i,n){t.trackEvent(e,i,n)}),this},t.prototype._processLegacyInitializers=function(t){return t.tags[Di]=this._queue,t},t}(),br=function(){function t(){}return t.getAppInsights=function(t,e){var i=new mr(t),n=2!==e;if(2===e)return i.updateSnippetDefinitions(t),i.loadAppInsights(n),i;var r=new Sr(t,i);return r.updateSnippetDefinitions(t),i.loadAppInsights(n),r},t}();t.ApplicationInsights=mr,t.Telemetry=yr,t.ApplicationInsightsContainer=br,t.AppInsightsCore=ui,t._InternalMessageId=ge,t.PerfEvent=Ne,t.PerfManager=Ue,t.doPerf=$,t.NotificationManager=hi,t.Util=xi,t.Event=Ri,t.Exception=Wi,t.Metric=qi,t.PageView=Ji,t.PageViewPerformance=rn,t.RemoteDependencyData=$i,t.Trace=en,t.Sender=Nn,t.ApplicationAnalytics=bn,t.PropertiesPlugin=Zn,t.DependenciesPlugin=dr,function(t,e,i){var n=Object.defineProperty;if(n)try{return n(t,"__esModule",i)}catch(t){}i&&void 0!==typeof i.value&&(t.__esModule=i.value)}(t,0,{value:!0})}),define("appInsightsConfig",["ApplicationInsights"],function(t){return AppInsightsConfig=new t.ApplicationInsights({config:{instrumentationKey:"4e0ad11e-ab1b-42bb-bb32-d5cc074095da",namePrefix:"microsoft.casualgames.microsoftsolitairecollection.appInsights",disableAjaxTracking:!0}}),AppInsightsConfig.loadAppInsights(),AppInsightsConfig.trackPageView(),console.info("AppInsightsEvent: ","HostingPageLoad"),AppInsightsConfig.trackEvent({name:"HostingPageLoad"}),AppInsightsConfig}),require.config({waitSeconds:0,
paths:{text:"dependencies/bower_components/requirejs-text/text",pixi:"dependencies/bower_components/pixi/bin/pixi.dev",absolute:"dependencies/absolute/absolute",absoluteaudio:"dependencies/absoluteaudio/absoluteaudio","state-machine":"dependencies/bower_components/javascript-state-machine/state-machine",tween:"dependencies/bower_components/tweenjs/src/Tween",fpsmeter:"dependencies/bower_components/fpsmeter/dist/fpsmeter",BigInteger:"dependencies/bower_components/biginteger/BigInteger",jszip:"dependencies/bower_components/jszip/dist/jszip",jsziputils:"dependencies/bower_components/jszip-utils/dist/jszip-utils",requireLib:"dependencies/bower_components/requirejs/require",proton:"dependencies/bower_components/Proton/build/proton-1.0.0",SoundManager:"dependencies/bower_components/soundmanager2/script/soundmanager2",ApplicationInsights:"../../node_modules/@microsoft/applicationinsights-web/dist/applicationinsights-web"},packages:[{name:"lodash",location:"dependencies/bower_components/lodash-amd/modern"}],shim:{"state-machine":{exports:"StateMachine"},tween:{exports:"TWEEN"},fpsmeter:{exports:"FPSMeter"},BigInteger:{exports:"bigInt"},proton:{exports:"Proton"}}}),require(["version","absolute","absolute/stringmanager","audiosprites","artassets","gameconfig","game","Solitaire/MvvmStructure/Service/ManifestService","SoundManager","MenuUI/DealWarningModal","MenuUI/WarningModal","pixi","Managers/TelemetryManager","Managers/AdManager","Managers/ExceptionManager","appInsightsConfig"],function(t,e,i,n,r,o,a,s,l,h,u,d,c,p,g,f){c.appLaunch(f),g.initialize(),e.Platform.hasChromeTintingBug(function(t){t&&(d.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.crop;i.width=Math.max(r.width,258),i.height=Math.max(r.height,258),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},d.CanvasTinter.tintMethod=d.CanvasTinter.canUseMultiply?d.CanvasTinter.tintWithMultiply:d.CanvasTinter.tintWithPerPixel)},"static/img/test-tint.png");for(var y,m=!1,C={},S=/\+/g,b=/([^&=]+)=?([^&]*)/g,v=function(t){return decodeURIComponent(t.replace(S," "))},w=window.location.search.substring(1);y=b.exec(w);)C[v(y[1])]=v(y[2]);m=C.debug&&"true"===C.debug,C.portrait&&C.portrait,e.Debug.enabled=m,e.ScreenMetrics.resClasses=[{id:"r384",resfloor:0},{id:"r768",resfloor:384},{id:"r960",resfloor:768},{id:"r1366",resfloor:960},{id:"r1536",resfloor:1366},{id:"r1920",resfloor:1536}],e.ScreenMetrics.getResScale=function(){switch(this.getResClass()){case"r384":return.2;case"r768":return.4;case"r960":return.5;case"r1366":return.7;case"r1536":return.8;case"r1920":default:return 1}},e.ScreenMetrics.getResClass=function(){return this.resClass="r1920",this.resClass},e.Debug.log('Starting "'+t.name()+'" '+t.id()+" "+t.version()),e.ScreenMetrics.refresh(),e.ScreenMetrics.log(),e.Platform.artPathPrefix="spritesheets",e.Platform.soundPathPrefix="sound";var x=function(){var l=new a(t.id(),{container:"container",width:1920*e.ScreenMetrics.getResScale(),height:1080*e.ScreenMetrics.getResScale(),gameId:t.id(),gameVersion:t.version(),config:o,backgroundColor:11184810});l.load({audioAssets:n,artAssets:r},function(t){e.Debug.log(100*t+"% loaded")},function(){s.Load(function(){e.Debug.log("load complete"),window.AHGameLoaded=!0,p.initialize(l),l.start()},function(t){console.info(t),"RangeError"!==t.name&&"ReferenceError"!==t.name&&"SyntaxError"!==t.name&&"TypeError"!==t.name||g.appException(t),c.manifestError(t.message),l.start(),l.ui.hideLoadingScreen(),l.ui.showLoadingScreen();var e=new u(l.ui.loadingScreen.parent,i("dialogs.manifestWarningHeadline"),i("dialogs.manifestWarningContent"),function(){l.ui.hideLoadingScreen(),e.close()})})})};if("undefined"!=typeof cordova){var T=function(){document.addEventListener("pause",function(t){e.MusicManager.stopMusic()},!1),document.addEventListener("backbutton",function(t){navigator.app.exitApp()},!1),x()};document.addEventListener("deviceready",T,!1)}else if(e.Platform._isIE()){var M=new l.SoundManager("code/dependencies/bower_components/soundmanager2/swf/");M.setup({url:"code/dependencies/bower_components/soundmanager2/swf/",preferFlash:!0,useHighPerformance:!0,flashVersion:9,onready:function(){x()},debugMode:e.Debug.enabled}),M.beginDelayedInit(),window.soundManager=M}else x()}),define("main",function(){});
//# sourceMappingURL=MSC.js.map